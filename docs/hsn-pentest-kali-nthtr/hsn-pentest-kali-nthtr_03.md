# 第二章：了解渗透测试过程的阶段

在**信息技术**（**IT**）的早期，人们不需要担心系统中的任何安全威胁或漏洞。随着技术和移动设备的进步，很多人寻求了解如何利用计算系统和网络。互联网的创建是一个重要的里程碑，它改善了信息的共享和可用性，不仅在一个机构内部，而且在全球范围内。随着信息和知识变得更加容易获得，很多人在数字世界中利用它来进行良性和恶性的活动。

想象一个人只是坐在家里上网，研究如何利用另一个人的计算机或网络上的漏洞/弱点。这真的很可怕，不是吗？一个简单的例子是一个在组织内担任行政人员的不满员工，他对网络安全或计算机领域不了解。这个不满的员工可能想在离开公司时对组织造成伤害，比如破坏公司本地文件服务器中存储的数据。如果他们决定在空闲时间研究各种黑客技术，这最终可能会变成一种内部威胁。

在网络安全领域，渗透测试对许多 IT 专业人士来说是一条非常有趣的道路。让这个过程如此有趣的是，渗透测试人员必须发现许多成功利用系统的方法。有时，一个漏洞可能在一个客户或目标系统上起作用，但在另一个系统上却不起作用。这就是渗透测试人员创造性思维最需要的地方。就我个人而言，我喜欢尝试进入一个看起来有点具有挑战性的系统（作为渗透测试人员）；如果一切都容易被黑客入侵，那还有什么乐趣呢？

在本章中，我们将涵盖以下主题：

+   在网络安全领域中，什么是渗透测试？

+   渗透测试方法论

+   渗透测试的阶段

+   使用方法或过程的动机

+   进行渗透测试的预期交付成果

让我们开始吧！

# 渗透测试的需求

在计算机发展的早期，**黑客**这个词是用来形容那些在计算机系统上有非凡技能的人。这种人通常被称为**计算机高手**。如今，**黑客**这个词是用来形容那些利用计算机进行某种恶意行为或对个人、组织或系统造成伤害的人。

随着新的威胁每天不断出现，黑客们装备了一系列工具和资源，对网络安全专业人员的需求非常高。组织意识到他们的资产面临风险，需要保护免受任何恶意行为者的侵害，无论是内部还是外部。组织寻求了解和发现其系统中的漏洞，如计算机、服务器、交换机、路由器、防火墙、终端设备和员工。公司很快意识到需要聘请网络安全专家来帮助提高组织的安全姿态。渗透测试人员的角色就此在网络安全领域中产生。

# 黑客的类型

如果你问几个黑客他们黑客背后的意图或动机是什么，你可能会得到不同的答案。人们做恶意的事情有很多原因；在网络安全领域也是如此。有些人喜欢为了好玩而黑客，有些人为了钱而黑客，而其他人则是为了对抗一个国家或地区内的政客而这样做。

# 白帽

**白帽**黑客在网络安全领域只是好人。他们利用自己的黑客技能和技术来帮助分析威胁，测试系统和网络，并实施缓解措施。

# 灰帽黑客

灰帽骇客处于 IT 安全的攻击和防御两端。这群骇客利用他们的知识和技能做好事和坏事。

# 黑帽

黑帽骇客是一个具有非常独特技能的人，利用他们的知识进行恶意活动。

# 脚本小子

在渗透测试领域开始时，大多数骇客和专业人士通常从一个脚本小子开始。脚本小子是一个不熟练的骇客，他使用其他骇客的脚本和工具，主要是图形用户界面（GUI）工具来破坏目标系统或网络。

# 自杀骇客

自杀骇客是一个目标是不惜一切代价摧毁目标系统的骇客，即使这意味着受到法律惩罚。

# 骇客活动分子

正如你可能知道的，活动人士是为社会或政治议程而奋斗的人。有些活动人士反对动物虐待。在数字世界中，有一些骇客活动人士反对各种议程。骇客活动人士是利用他们的技能来推动社会或政治议程的骇客。一个著名的骇客活动人士团体的例子是众所周知的匿名骇客团体。

# 国家赞助的骇客

这群骇客通常是由一个国家的政府为了发动网络战争攻击和对另一个国家进行侦察而创建的。

# 渗透测试

有时在面试中，管理团队可能会问面试者：“为什么我们要雇佣一个骇客？”管理层有时认为具有骇客技能的人会是一个巨大的安全风险，这是准确的。然而，另一个问题出现了：为什么他们不雇佣一个骇客？一个具有骇客技能和善良心灵的人可以利用他们的知识来帮助防止内部和外部安全威胁，并发现组织系统和网络基础设施中的任何隐藏缺陷。

道德骇客，或白帽骇客，通常是指利用他们的信息安全专业知识和渗透组织的系统和网络的能力的人。道德骇客或渗透测试人员发现隐藏的漏洞，并模拟真实世界的攻击来测试组织的安全系统和减轻控制。然而，道德骇客/渗透测试人员必须在进行任何安全测试之前获得客户和相关当局的合法许可。

白帽骇客，道德骇客和渗透测试人员是一样的；这些术语可以互换使用。

为什么有人要对网络或系统进行渗透测试？许多组织认为他们的网络和资产对坏人（骇客）是安全的，但实际上并非如此。正如思科系统前任执行主席兼首席执行官曾经说过的：“有两种公司：被黑客攻击过的和不知道自己被黑客攻击过的。”通常，许多组织并不知道他们的网络上发生了安全漏洞，而发现的时间通常是攻击发生后数月。到那时，攻击者可能已经能够窃取大量数据，创建新的后门，并在公司中植入高级持续威胁（APT）。

要打败一个黑客，你必须像他们一样思考。这就是渗透测试人员的角色。渗透测试人员会发现内部安全团队可能忽略的常规和隐藏的漏洞，并对组织的系统和网络进行模拟真实世界的攻击，以利用发现的任何漏洞。在恶意黑客之前发现缺陷和弱点可以让组织在实施预防和减轻技术和网络控制方面占据上风，从而减少组织的攻击面。

# 蓝队对红队对紫队

许多组织意识到他们公司需要一个网络安全团队。IT 安全团队通常分为两种颜色：红色和蓝色。每个团队都有其独特的目标，而两个团队的总体目标是确保保持健康的安全姿态，并减少信息安全风险。

# 蓝队

蓝队的目标是什么？他们做什么？为什么需要他们？重视其资产（有形、无形和员工）的组织将确保它们免受恶意黑客的侵害，因为网络攻击可能随时从内部或外部发起。最困难的任务之一是实时检测网络攻击并加以缓解。通常，在**信息技术和通信**（**ICT**）部门内聘请一组网络安全人员，以积极加固组织系统和网络基础设施的安全。这个团队被称为蓝队。

**蓝队**不断监视网络，以防范公司内部或外部的新威胁。然而，对立的红队有不同的目标。

# 红队

红队的目标与蓝队大不相同。红队专注于不断攻击组织的系统和网络。你可能会想为什么会有这样的目标的团队存在。正如在《Kali NetHunter 简介》中提到的，黑客总是试图以各种原因未经授权地进入另一个人或公司的系统。然而，未经授权地进入另一个系统或网络是非法的，因为它是侵入性的。由于数字世界中威胁不断增长，组织需要不断改善其安全姿态。

**红队**是外部承包商或内部团队，其目标是不断模拟真实世界的网络攻击。这是为了确保发现所有漏洞，并确定如何才能被真正的恶意黑客利用。红队就像黑帽黑客一样，他们被组织承包来发现所有隐藏的漏洞，利用任何缺陷，并在测试结束时提供详细报告。

# 紫队

**紫队**是红队和蓝队的结合。该团队既致力于进行攻击性安全测试，又致力于防御网络攻击者。与红队和蓝队不同，他们既不专门从事攻击性安全，也不专门从事防御性安全，而是为组织提供统一的安全咨询服务。

# 渗透测试的类型

每当渗透测试人员被指派对目标组织进行模拟真实世界的攻击时，通常会进行三种类型的渗透测试：白盒、灰盒和黑盒。每种类型都将决定哪些资产暴露给内部威胁和外部方，比如黑客。

**白盒**测试是一种简单的渗透测试，因为在模拟攻击之前已经完全了解了目标系统和网络。这对于渗透测试人员来说是有益的，因为他们会对目标网络有充分的信息，并且可以更好地利用工具和资源来创建、交付和执行可能在第一次尝试时成功的有效载荷。然而，这种类型的渗透测试也有缺点。道德黑客或渗透测试人员很可能不会寻找任何在测试之前提供的知识之外的隐藏漏洞和系统，或者完全了解系统的基础设施。

**黑盒**测试是指渗透测试人员对目标系统或基础设施没有任何信息或知识。渗透测试人员将表现得像一个真正的黑客，以获取对目标的访问权限。有时唯一提供的信息是公司的名称或者只是网站。道德黑客或渗透测试人员需要做出所有努力来确定组织的类型和行业、网络基础设施中存在的网络和安全设备类型、其员工等。

**灰盒**测试介于白盒和黑盒渗透测试之间。在实际进行安全审计或渗透测试之前，渗透测试人员对目标基础设施的信息非常有限。

# 渗透测试的阶段

在对系统或网络进行渗透测试之前，我们必须首先制定*参与规则*或行动计划。如果渗透测试人员仅仅匆忙进入网络并对目标发动随机攻击，那将不够专业。此外，制定行动计划可以使在决定基于目标漏洞的工具和攻击类型时，工作变得更加简单。

# 预攻击阶段

**预攻击阶段**侧重于渗透测试的规划和准备工作，这是在直接与目标系统或网络进行任何接触之前完成的。在这个阶段，渗透测试人员将创建一系列工具、脚本和操作系统，以便在攻击阶段使用。在实际渗透测试之前确定渗透方法是非常重要的，它将为实现每个渗透测试目标创建一个系统化的方法。

在预攻击阶段，我们不能忘记其中一个最重要的目标，即与客户讨论参与规则。这一点非常重要，因为渗透测试人员和客户双方必须就将进行的测试类型、测试持续时间、目标系统和网络、如果进行远程测试-尽可能提供源 IP 地址、侵入性或非侵入性测试等达成共识和理解。

到目前为止，我们已经了解到组织会聘请安全专业人员，如渗透测试人员，来检查其系统或网络中的安全控制并发现任何隐藏的漏洞。有时，组织可能会聘请渗透测试人员模拟对其 Web 应用程序的真实攻击，而另一家公司可能希望对其 Windows 服务器进行安全审计。从渗透测试人员的角度来看，单一的方法并不总是适用于每个目标。这就是渗透测试人员可以根据目标所需的测试类型制定自己的方法的地方。

在攻击阶段之前尽可能获取有关目标的信息非常有帮助。让我们把这看作是一次军事行动；在发动攻击之前，将军或高级官员会派遣一支士兵小组进行侦察，并在不被发现的情况下收集有关目标的尽可能多的信息。这个概念也适用于渗透测试；对目标了解的信息越多，将有助于渗透测试人员发现漏洞和弱点。一旦在目标上发现了漏洞（弱点），下一步就是利用工作漏洞来利用这个漏洞/弱点。这是在攻击阶段完成的。

在渗透测试的预攻击阶段通常会发现信息，如开放端口、设备类型、操作系统、网络布局、安全设备和网络共享。

# 攻击阶段

**攻击阶段**对于渗透测试人员来说可能有些具有挑战性。在这个阶段，利用漏洞来获取对目标系统和/或网络的访问权限。有时，一个利用可能无法生效，这可能会有点令人沮丧。拥有一个利用开发环境对于特定有效负载无法破坏目标的情况非常有用。然而，渗透测试人员不应该仅仅依赖于一个入口点，而是应该有多种获取访问权限的方法。这个概念不仅展示了渗透测试人员的技术技能，也展示了目标本身的许多缺陷。

在攻击前阶段收集的有关目标的信息将被用来确定在目标上使用的利用类型。可以使用现有的利用，这些利用可以从**Offensive Security 的 Exploit Database**（[www.exploit-db.com](http://www.exploit-db.com)）等可靠的在线存储库中找到，或者使用**Metasploit**（[`www.rapid7.com/products/metasploit/`](https://www.rapid7.com/products/metasploit/)）等利用开发框架。

通常，攻击者会破坏目标系统上的标准帐户以减少被发现的可能性，然后他们将尝试提升权限到系统/管理或根权限。在这个阶段，渗透测试人员会在受损系统中植入恶意代码，以创建远程访问的后门，并开始在网络上进行横向移动，以破坏其他潜在目标。

# 攻击后阶段

**攻击后阶段**侧重于清理攻击阶段留下的任何物品。这些是在渗透测试期间使用的有效负载、脚本和其他文件。报告通常在这个阶段结束时完成，并交付给客户，概述了执行的各种安全测试及其结果。

# 渗透测试方法和框架

在本节中，我们将看一下各种渗透测试方法和框架。首先，我们必须了解什么是方法论。**方法论**是一套应用于研究领域或活动的方法，采用系统化的方法。在渗透测试领域中，另一个重要的术语是框架。**渗透测试框架**是一个全面的指南，详细介绍了每个渗透测试类别的使用和安全审计工具。

完成第一次渗透测试培训可能会非常令人兴奋，你可能非常渴望去攻击某些东西。想象一下，你在客户的网络上，然后你开始一次性刺激你的攻击，专注于特定一组漏洞或系统。可能会发生很多失误 - 利用可能会击中未在渗透测试协议范围内指定的目标 - 这可能对业务造成不良影响，并且会产生不良的声誉。其次，如果不使用系统化的方法，可能最终无法获得期望的结果。

因此，在渗透测试的攻击前阶段，最好选择一个最适合潜在目标基础设施的方法论或框架。框架将确保渗透测试人员遵循一组特定的指南，以获得期望的输出和结果的解释。

以下是一些较受欢迎的渗透测试方法和框架：

+   OWASP 测试指南

+   PCI 渗透测试指南

+   渗透测试执行标准

+   **开源安全测试方法手册**（**OSSTMM**）

# OWASP 测试框架

**开放式 Web 应用安全项目**（**OWASP**）测试框架被定义为常见 Web 应用程序和安全服务问题的低级渗透测试指南。它被开发为一个最佳实践的渗透测试框架，供任何人在其组织内实施。

OWASP 测试指南 v4 可在[`www.owasp.org/index.php/OWASP_Testing_Project`](https://www.owasp.org/index.php/OWASP_Testing_Project)找到。

OWASP 测试框架概述了五个阶段：

+   **第 1 阶段：开发之前**

+   定义系统开发生命周期（SDLC）

+   审查政策

+   制定测量和度量标准并确保追踪

+   **第 2 阶段：在定义和设计期间**

+   审查安全要求

+   审查设计和架构

+   创建和审查 UML 模型

+   创建和审查威胁模型

+   **第 3 阶段：开发期间**

+   代码演练

+   代码审查

+   **第 4 阶段：在部署期间**

+   应用渗透测试

+   配置管理测试

+   **第 5 阶段：维护和运营**

+   进行操作管理审查

+   进行定期健康检查

+   确保变更验证

有关 OWASP 测试框架的更多信息，请访问[`www.owasp.org/index.php/The_OWASP_Testing_Framework`](https://www.owasp.org/index.php/The_OWASP_Testing_Framework)。

此外，OWASP 一直在全球范围内提供网络安全意识和改进网络安全的方法。他们的**OWASP 十大**是网络应用中最关键的安全风险列表。

以下是**OWASP 十大-2017**网络应用关键安全风险列表：

+   A1:2017-注入

+   A2:2017-破坏身份验证

+   A3:2017-敏感数据暴露

+   A4:2017-XML 外部实体（XXE）

+   A5:2017-破坏访问控制

+   A6:2017-安全配置错误

+   A7:2017-跨站脚本（XSS）

+   A8:2017-不安全的反序列化

+   A9:2017-使用已知漏洞的组件

+   A10:2017-日志记录和监控不足

关于 OWASP 十大-2017 列表的每个类别的更多详细信息可在[`www.owasp.org/index.php/Top_10-2017_Top_10`](https://www.owasp.org/index.php/Top_10-2017_Top_10)找到。

# PCI 渗透测试指南

计划或参与任何形式的支付卡交易的组织，如信用卡等，都需要符合**支付卡行业数据安全标准（PCI DSS）**。 PCI DSS 政策和标准用于保护和改善信用卡，借记卡和现金交易的安全性，同时保护持卡人的**个人可识别信息**（PII）。

PCI 渗透测试指南概述了其方法中的以下阶段：

+   预参与（规划）

+   参与：渗透测试（发现和攻击）

+   后参与（后攻击）

# 渗透测试执行标准

**渗透测试执行标准**（**PTES**）由七个阶段组成，涵盖了渗透测试的所有方面：

+   预参与互动

+   情报收集

+   威胁建模

+   漏洞分析

+   利用

+   后利用

+   报告

有关 PTES 的更多信息，请访问[`www.pentest-standard.org/index.php/Main_Page`](http://www.pentest-standard.org/index.php/Main_Page)。

# 开放源安全测试方法手册

**开放源安全测试方法手册**（**OSSTMM**）由**安全和开放方法研究所**（**ISECOM**）开发和发布，作为如何改进安全测试和实施的指南。

OSSTMM 与先前提到的方法和框架有些不同，该方法还测试组织，运营和电信安全和合规性。

以下是 OSSTMM 中的领域：

+   操作安全度量

+   信任分析

+   工作流程

+   人员安全测试

+   物理安全测试

+   无线安全测试

+   电信安全测试

+   数据网络安全测试

+   合规法规

+   使用 STAR（安全测试审计报告）进行报告

# 渗透测试的阶段

到目前为止，我们已经了解了各种渗透方法和框架。现在，你可能想知道如何把它们整合起来。在渗透测试培训课程中，你学到的第一件事就是黑客的五个阶段。在每个阶段，作为渗透测试人员/道德黑客，都有要完成的目标；一个阶段导致下一个，直到完成最后阶段：

+   侦察

+   扫描

+   获取访问权限

+   保持访问权限

+   清除痕迹

# 侦察

侦察阶段是最重要的阶段。这个阶段是关于收集有关目标的信息；渗透测试人员对目标了解得越多，就越容易利用它。在这个阶段，通常进行以下操作：

+   使用雅虎、必应和谷歌等搜索引擎

+   在社交网络网站上搜索有关公司和员工（过去和现在）的信息

+   执行谷歌黑客技术以收集有关目标的更精确信息

+   使用各种工具对目标网站进行足迹识别

+   执行有关目标的域注册信息收集

+   直接和间接的社会工程

# 扫描

这个阶段是更直接地接触实际目标。扫描阶段帮助渗透测试人员识别网络上的开放和关闭端口、活动主机、系统和网络上运行的服务、操作系统类型以及系统上的漏洞。在扫描阶段，收集到的信息将为渗透测试人员提供目标环境的拓扑视图。

以下是扫描的目标：

+   检查活动机器

+   检查入侵防护系统（IPS）

+   检查防火墙

+   检查开放和关闭的端口

+   检查服务版本

+   检查漏洞

+   创建网络图

# 获取访问权限

这是利用阶段，渗透测试人员试图攻破目标系统或网络。在这个阶段，渗透可能会创建一个自定义有效载荷，以远程执行或在实际目标上执行。

这个阶段有两个目标：

+   获取访问权限

+   提升权限

# 保持访问权限

一旦目标系统被攻破，渗透测试人员将尝试创建多个后门访问实例，以防止他们无法再通过漏洞访问系统。一些渗透测试人员利用这个机会植入远程访问特洛伊木马（RATs）或创建一个僵尸网络来控制被攻破的系统。

这个阶段有以下目标：

+   创建和维护远程访问

+   隐藏文件

+   窃取数据

# 清除痕迹

这个阶段用于清除目标系统和网络上入侵的所有可能痕迹；作为渗透测试人员，我们希望尽可能隐秘，以模拟真实世界的攻击。

这个阶段有两个目标：

+   清除所有日志

+   掩盖痕迹

# 可交付成果

在渗透测试结束时，会向客户提供一份报告，其中详细列出了发现的所有漏洞。渗透测试报告还包含了每个系统受到的漏洞威胁的证据，以表明概念的证明。这对客户的安全团队实施减轻技术和预防控制措施对他们的基础设施可能是有帮助的。一些渗透测试报告包含减轻技术，而其他一些则没有。这取决于客户和渗透测试服务提供者之间的共同协议。

最重要的是，报告是对所进行的测试事件和行动以及每个测试的结果的全面总结。作为渗透测试人员，我们的报告有时倾向于过于技术化，然而我们的最终报告应该以高管层次编写，非技术人员可以阅读和理解。

# 总结

在本章中，我们看到了当今世界和未来进行渗透测试的必要性。随着新威胁的出现，我们的资产和数据的安全风险比以往任何时候都更大。我们对不同类型的黑客及其可能的黑客动机进行了简要比较和对比。此外，我们讨论了组织内各种安全团队的必要性，以帮助改善不断增长的威胁格局的安全状况，最后，我们讨论了黑客方法和概念。

在下一章中，我们将介绍情报收集工具。
