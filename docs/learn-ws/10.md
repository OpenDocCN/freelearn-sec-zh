# 七、使用显示和捕获过滤器

无论是在捕获流量时实时分析数据，还是调查预先捕获的文件，您通常都会面临大量数据。你如何理解所有这些信息？最有可能的是，您将受益于过滤通信量以缩小范围，这样 Wireshark 只显示您想要查看的通信量。本章回顾了在 Wireshark 中过滤流量的许多方法。

处理数据时，似乎捕获和显示过滤器是相同的。然而，尽管两者都可以过滤流量，但它们都有自己的语法，在创建过滤器时必须使用这些语法。为了帮助您更好地理解优化视图的不同方法，我们将介绍何时过滤流量，并概述显示过滤器和捕获过滤器之间的区别。为了使您能够在瞄准特定流量时提高技能，我们将回顾通过构建表达式来深入到特定字段值的方法。此外，我们将学习如何使用逻辑运算符创建更复杂的过滤器。最后，由于过滤器非常有用，我们将介绍一些技巧、快捷方式和常用过滤器，帮助您实现更有效的分析。

本章将涵盖以下内容:

*   过滤网络流量
*   理解显示过滤器
*   创建捕获过滤器
*   了解表达式生成器
*   发现快捷方式和方便的过滤器

# 过滤网络流量

Wireshark 以及许多其他数据包分析工具可以捕获大量数据，过滤特定类型的流量，并优化您的视图以帮助分析。在 Wireshark 中，有几个选项可用于过滤流量:

*   **显示过滤器**:在活动捕获期间或在预捕获文件上使用
*   **捕获过滤器**:在捕获之前应用，仅显示特定类型的流量
*   **表达式**:使用逻辑操作符创建复杂的过滤器
*   **快捷方式**:在分析数据包时，动态构建过滤器

Wireshark 具有捕获和显示过滤器，可用于优化您的视图。分析流量时，每个过滤器都在特定时间内应用。在下一节中，让我们探索应用过滤器的最佳时机。

## 分析流量

在检查流量时，数据包分析有四个主要阶段，如使用 Wireshark 的 [*第 2 章*](B18389_02_ePub.xhtml#_idTextAnchor036) 、*中所述。这些阶段是**采集**、**解码**、**分析**、**显示**，如下图所示:*

![Figure 7.1 – Phases of packet analysis 
](img/B18389_07_001.jpg)

图 7.1–数据包分析的各个阶段

当您使用捕获过滤器收集流量时，可以开始优化您的视图。在数据包呈现给用户之前，过滤器会移除不需要的流量。

### 捕获流量

在收集网络流量时，数据包通过适当的捕获引擎，如 Npcap 或 WinPcap。如果您只想查看特定的流量，您将需要使用捕获过滤器，当使用时，Wireshark 将丢弃任何不在过滤器中的数据包。例如，当捕获**无线局域网** ( **WLAN** )流量，并且您想要过滤掉任何信标帧时，您将应用这个捕获过滤器:`wlan[0] != 0x80`。

捕获过滤器将删除任何不必要的流量。但是，要在保留所有流量的同时过滤掉不需要的数据包，您应该使用显示过滤器。

### 查看流量

一旦数据包通过 Wireshark 的**增强型数据包分析器** ( **EPAN** )，它就会将解析后的流量通过**图形用户界面** ( **GUI** )呈现给用户，然后进行分析。在 Wireshark 界面中显示数据包时，您可以使用适当的语法应用显示过滤器，并在捕获之前、期间或之后应用过滤器。

类似于我们前面的例子，当捕获无线流量时，如果您想要过滤掉任何信标帧，同时保留所有数据包，您将应用这个显示过滤器:`!(wlan.fc.type_subtype == 8)`。

在构建捕获或显示过滤器时，Wireshark 将检查语法以查看字符串是否有效。让我们看看这是如何工作的。

### 检查语法

在分析流量的同时创建过滤器时，我们天生就知道要构建什么，并且在大多数情况下，我们会生成一个有效的过滤器。Wireshark 通过在运行捕获之前检查语法来帮助我们创建合适的过滤器。语法检查器的工作方式如下:

*   有效的显示过滤器将使背景变成绿色，并且过滤器*将*运行。
*   无效或不完整的字符串将使背景变红，过滤器*将不会*运行。
*   未知的显示过滤器或字符串将使背景变成黄色，过滤器*可能会*运行。

虽然常见的是绿色或红色背景，但在极少数情况下，您可能会看到黄色背景。例如，在过滤**动态主机配置协议** ( **DHCP** )时，如果输入`bootp`而不是`dhcp`，背景会变成黄色，如下图所示:

![Figure 7.2 – Syntax checker with a yellow background
](img/B18389_07_002.jpg)

图 7.2–黄色背景的语法检查器

虽然过滤器可能会运行，但您可能会得到意外的结果。

在下一节中，我们将概述 Wireshark 文件夹中的两个文件`dfilters.txt`和`cfilters.txt`的用途，这两个文件用于保存过滤器列表。

## 比较过滤器的文件

在 Wireshark 文件夹中，有两个文本文件用于 Wireshark 的内置过滤器和任何用户保存的过滤器，它们如下:

*   `dfilters.txt`保存显示过滤器列表。
*   `cfilters.txt`保存捕获过滤器列表。

这些文件与显示或捕获过滤栏左侧的硬上的**书签**图标相关。如此处所示，我们看到显示过滤栏上的蓝色图标:

![Figure 7.3 – Viewing the bookmark icon
](img/B18389_07_003.jpg)

图 7.3–查看书签图标

使用任一单词过滤器文件，一旦被修改，它们可以被复制，然后与同事共享。此外，当使用特定的配置文件时，您可以定制任一文件，这样您就可以通过简单地切换配置文件来访问定制的过滤器。

首先，我们来看看显示过滤器文件。

### 调查显示过滤器

您将在`dfilters.txt`文件中找到一个包含显示过滤器的列表。找到文件后，您可以在记事本中打开它，如下所示:

![Figure 7.4 – dfilters.txt
](img/B18389_07_004.jpg)

图 7.4–d filters . txt

过滤器由一个**名称** | **过滤器**配对来表示。例如，当检查排除**地址解析协议** ( **ARP** )流量的过滤器时，您会看到以下内容:

*   **名称**:滤镜的名称，用引号括起来。比如`"No ARP"`。
*   **过滤器**:过滤器的语法。比如`not arp`。

接下来，我们将查看捕获过滤器是如何存储的。

### 检查捕获过滤器

`cfilters.txt`文件包含捕获过滤器的列表，如下面的屏幕截图所示:

![Figure 7.5 – cfilters.txt
](img/B18389_07_005.jpg)

图 7.5–c filters . txt

与显示过滤器类似，捕获过滤器也由一个**名称** | **过滤器**对表示。例如，当检查仅包含**传输控制协议** ( **TCP** )流量的过滤器时，您将看到以下内容:

*   **名称**:滤镜的名称，用引号括起来。比如`"TCP only"`。
*   **Filter**: The syntax for the filter. For example, `tcp`.

    注意

    虽然可以在记事本中打开和修改这两个文件，但如图所示，使用 Wireshark 界面来更改过滤器更安全、更方便。例如，通过进入**分析** | **显示过滤器…** 菜单选项，然后在对话框中编辑，您可以保留正确的语法。

现在您已经看到了主要的区别，让我们更仔细地看看显示过滤器。

# 理解显示过滤器

在捕获流量或分析预先捕获的文件时，显示过滤器有助于缩小范围并锁定特定类型的流量。捕获超过 3000 个包含多种不同类型流量的数据包并不罕见。

当您启动 Wireshark 时，您会看到启动屏幕。图标下方的顶部是过滤器工具栏。工具栏中有文本 **Apply a display filter…** ，您可以在其中轻松应用和编辑显示过滤器，如下所示:

![Figure 7.6 – Wireshark startup screen
](img/B18389_07_006.jpg)

图 7.6–Wireshark 启动屏幕

通过使用单个协议或添加逻辑运算符，您可以在 Wireshark 支持的任何协议上创建简单的过滤器。例如，如果您想查看 TCP 或 ARP 流量，那么您可以使用`tcp || arp`显示过滤器。

Wireshark 的显示过滤器很容易修改。以下部分说明了如何编辑显示过滤器来定制您的工作流程。

## 编辑显示过滤器

使用显示过滤器后，您可能需要更改 IP 地址、端口号或进行其他更改。要编辑显示过滤器，进入**分析**菜单，然后选择**显示过滤器…** ，将弹出以下对话框:

![Figure 7.7 – Display Filters dialog box
](img/B18389_07_007.jpg)

图 7.7–显示过滤器对话框

在那里，您可以选择三个图标中的一个，如**显示过滤器**对话框左下角所示:

*   加号图标将*添加*一个新的显示过滤器。选中时，Wireshark 会在左侧创建一个空间，您可以在此输入名称，在右侧输入实际的过滤器，如图*图 7.7* 所示。
*   减号图标将*删除*一个显示过滤器。选择(突出显示)想要移除的过滤器，点击减号从对话框中移除过滤器，并更新`dfilters.txt`文件。
*   一个复制图标将*复制*一个显示过滤器。复制后，您可以在不更改原始过滤器的情况下修改过滤器。Wireshark 会将新的过滤器添加到`dfilters.txt`文件中。

在下一节中，我们将看到当你得到一个有效的显示过滤器，并且你想重用它时，你如何把它保存到一个书签中。

## 使用书签

在显示过滤器的右侧，有一个名为**书签**的蓝色工具栏图标。这就是 Wireshark 的内置过滤器和任何用户保存的过滤器所在的位置。如果单击图标，您将看到选项，以及几个您可以使用的预装过滤器，如下所示:

![Figure 7.8 – Display filter bookmark dropdown
](img/B18389_07_008.jpg)

图 7.8–显示过滤器书签下拉列表

使用书签时，您将看到包括以下内容的配置选项:

*   **保存该过滤器**:创建过滤器后，可以通过选择该选项将过滤器保存到书签。
*   **删除该过滤器**:这将删除当前正在使用的过滤器，该过滤器存储在`dfilters.txt`文件中。
*   **管理显示过滤器**:这将打开**显示过滤器**对话框。
*   **滤镜按钮首选项…** :这将打开**首选项**对话框，其中**滤镜按钮**选项高亮显示。

在选项下面，您会看到一个过滤器列表。即使您从未保存过过滤器，您也会看到列表，因为 Wireshark 会显示在`dfilters.txt`文件中找到的过滤器列表。

一旦您创建了自己的过滤器或从下拉列表中选择了一个，您可以按*输入*或点击显示过滤器右侧的蓝色箭头来运行过滤器。

显示过滤器的最右侧是一个下拉箭头(插入符号)。选中后，您可以看到以前使用的过滤器，如下面的屏幕截图所示:

![Figure 7.9 – Previously used display filters
](img/B18389_07_009.jpg)

图 7.9–以前使用的显示过滤器

可以在数据包捕获之前、期间或之后应用显示过滤器。当您准备清除过滤器时，选择过滤器右侧的 **X** ，如下所示:

![Figure 7.10 – The display filter toolbar
](img/B18389_07_010.jpg)

图 7.10–显示过滤器工具栏

正如我们所看到的，显示过滤器非常有助于提供更有针对性的捕获视图。然而，有时你可能只想收集某种类型的流量。在这种情况下，您将使用一个捕获过滤器，我们将在下一节讨论。

# 创建捕获过滤器

了解如何使用显示过滤器很重要。但是，捕获过滤器有助于仅锁定您想要查看的流量。此外，过滤可以消除许多噪音，如管理流量和 ARP 广播。

您可以通过以下几种方式创建捕获过滤器:

*   转到启动屏幕的中间，进入**之后的过滤器...使用该滤波器:**如图*图 7.6* 所示。
*   进入**捕获**菜单，然后选择**选项...**，如下图所示:

![Figure 7.11 – Capture menu dropdown
](img/B18389_07_011.jpg)

图 7.11–捕获菜单下拉菜单

在那里，您将看到捕获选项，并且在对话框的底部，您将看到捕获过滤器区域，如下面的屏幕截图所示:

![Figure 7.12 – Location to add a capture filter 
](img/B18389_07_012.jpg)

图 7.12–添加捕获过滤器的位置

虽然这两个选项都可以让你创建一个捕获过滤器，但我通常会去**捕获**菜单选择并选择**选项...**，因为这将允许我看到所有的界面。

通过使用单个或多个协议并添加逻辑运算符，您可以在 Wireshark 支持的任何协议上创建捕获过滤器。要清除过滤器，选择捕获过滤器右侧的 **X** 。

要查看您以前使用的捕获过滤器，请转到捕获过滤器的右侧，并选择向下箭头以显示列表。这类似于显示过滤器下拉列表，如图*图 7.8* 所示。

除了能够修改显示过滤器之外，您还可以自定义捕获过滤器，如下一节所述。

## 修改捕获过滤器

要编辑捕获过滤器，进入**捕获**菜单选项，然后选择**捕获过滤器**，这将显示预构建过滤器的列表，如以下截图所示:

![Figure 7.13 – Capture Filters dialog box
](img/B18389_07_013.jpg)

图 7.13–捕获过滤器对话框

在对话框的底部有三个图标:

*   加号图标将*添加*一个新的捕获过滤器。选中后，Wireshark 将创建一个空间，您可以在左边输入名称，在右边输入实际的过滤器。
*   减号图标将*删除*一个捕获过滤器。选择(突出显示)想要移除的过滤器，点击减号从对话框中删除过滤器，并更新`cfilters.txt`文件。
*   复制图标将*复制*一个捕获过滤器。复制后，您可以在不更改原始过滤器的情况下修改过滤器。Wireshark 会将新的过滤器添加到`cfilters.txt`文件中。

尽管“捕获过滤器”界面可能看起来像“显示过滤器”工具栏，但语法是不同的。因此，在制作一个捕获过滤器时，你需要小心，因为它使用了 **Berkeley 数据包过滤器** ( **BPF** )语法。在下一节中，我们将通过一个例子来使用适当的语法创建一个捕获文件。

### 识别 BPF 语法

捕获过滤器可以减少通过只收集*你想看到的流量类型获得的数据包数量。例如，如果我需要一个过滤器来捕获**文件传输协议** ( **FTP** )流量，那么我可以在捕获过滤器中输入`ftp`，就像我在显示过滤器中一样。但是，您会看到语法检查器变成红色，这意味着这是一个无效的过滤器，如下所示:*

*![Figure 7.14 – Invalid capture filter syntax
](img/B18389_07_014.jpg)

图 7.14–无效的捕获过滤器语法

虽然这个过滤器可以作为显示过滤器，但是您必须使用正确的语法编写一个捕获过滤器。

创建新的捕获过滤器时，尝试使用一个预构建的过滤器作为指南来正确构建您的过滤器。让我们看看这是如何工作的。

### 制作捕获过滤器

当你需要创建一个捕获过滤器时，找到一个与你需要的相似的捕获过滤器*，选择过滤器，点击复制图标。Wireshark 将复制过滤器并将其放在末尾，您可以在那里对其进行编辑。*

让我们来看一个通过复制现有过滤器来创建 FTP 捕获过滤器的示例:

1.  进入**捕获**菜单，选择**捕获滤镜**。
2.  选择`HTTP TCP port (80)`捕获过滤器，然后点击复制图标。Wireshark 会将复制的过滤器放在列表的末尾，如下面的屏幕截图所示:

![Figure 7.15 – Create new capture filter
](img/B18389_07_015.jpg)

图 7.15–创建新的捕获过滤器

1.  要编辑过滤器，将名称更改为`FTP`，并将过滤器更改为`tcp port ftp`或`tcp port 21`。
2.  关闭**捕获过滤器**对话框。
3.  重新启动 Wireshark，以便识别新创建的捕获过滤器。

要使用新创建的过滤器，请遵循以下步骤:

1.  转到**捕获**菜单选项，然后选择**选项...**。
2.  单击将用于捕获流量的接口。比如下面的截图，选择了**微软:Wi-Fi** 界面。
3.  在 capture filter 区域，下拉绿色书签并选择您刚刚创建的过滤器。书签将变成黄色，如下所示:

![Figure 7.16 – FTP capture filter
](img/B18389_07_016.jpg)

图 7.16–FTP 捕获过滤器

1.  Once you click **Start** to begin your capture, you will only capture FTP traffic.

    注意

    当你使用完一个捕获滤镜时，进入**捕获**菜单，然后进入**选项，确保你移除了滤镜的任何痕迹...**。一旦打开，删除捕获过滤器，以便您可以再次捕获所有流量。

您可能已经使用了一个运行良好的捕获过滤器，并且您希望保留该过滤器以供将来使用。接下来，让我们看看如何将捕获过滤器保存到书签中。

## 给过滤器添加书签

在捕获过滤器的右侧是一个名为**书签**的绿色工具栏图标，内置的捕获过滤器存储在这里。每当您创建并保存过滤器时，Wireshark 都会将过滤器存储在书签中。

如果单击绿色工具栏图标，您将看到一个捕获过滤器列表，如以下屏幕截图所示:

![Figure 7.17 – Capture filter bookmark drop-down
](img/B18389_07_017.jpg)

图 7.17–捕获过滤器书签下拉列表

在那里，您可以选择一个过滤器，Wireshark 将填充 capture filter 字段。

如果您创建了一个过滤器并想要保存它，请下拉书签图标并选择**保存该过滤器**，Wireshark 会将该过滤器保存在书签中。

捕获过滤器可能很有用；但是，请记住，在使用捕获过滤器时，您可能会错过在故障排除或搜索入侵证据时有所帮助的重要流量。

在分析过程中，您可能需要使用特定的字段值来创建一个表达式。以下部分概述了如何使用表达式生成器。

# 了解表达式生成器

除了构建简单的显示过滤器，Wireshark 还能够创建一个表达式，将特定字段值归零。要构建表达式，请转到**分析**，然后选择**显示过滤表达式**，如下图所示:

![Figure 7.18– The Display Filter Expression menu choice
](img/B18389_07_018.jpg)

图 7.18–显示过滤器表达式菜单选项

单击链接启动表达式构建器。在左侧，您会看到 Wireshark 支持的所有协议的列表，如下面的屏幕截图所示:

![Figure 7.19 – Display Filter Expression
](img/B18389_07_019.jpg)

图 7.19–显示过滤器表达式

Wireshark 能够解析数百个协议，并且不断添加新的协议，因此列表会很长。

为了进一步细化过滤器，您可以从右侧列出的四个变量中选择:

*   **关系**:这是使用逻辑运算符将一个字段值与另一个值进行比较的比较运算符列表:
    *   **存在**:表示所选字段存在于抓图中
    *   **==** :等于
    *   **！=** :不等于
    *   **>** :大于
    *   **<** :小于
    *   **> =** :大于等于
    *   **< =** :小于或等于
*   **值**:表示所需的适当值。Wireshark 用适当类型的值填充它，即布尔或字符串。
*   **预定义值** : Wireshark 为给定字段填充适当的值。
*   **范围(偏移量:长度)**:这允许您输入一个整数范围，如`4-8`或`12-20`，如果它们是该字段或过滤器的合适选择。

现在您已经很好地理解了表达式生成器的功能，让我们来看一个构建自定义过滤器的简单示例。

## 建立表情

在这个例子中，我希望过滤器显示所有带有 **TCP SYN** 标志的数据包。在**显示过滤表达式**对话框的左侧，我向下钻取并选择了`tcp.flag.syn`值。Wireshark 将在对话框的右侧填充以下内容:

*   **关系** : **==**
*   **值** : `1`
*   **预定义值** : **设定**

**Range** is grayed out as this is not an appropriate selection for this field value.

一旦选择了所有的值，Wireshark 就会用生成的表达式填充底部的显示过滤器区域。在这种情况下，过滤器是`tcp.flags.syn == 1`，如下所示:

![Figure 7.20 – TCP SYN flag filter
](img/B18389_07_020.jpg)

图 7.20–TCP SYN 标志过滤器

此时，我们可以选择以下任一选项:

*   **取消**:这将退出表达式生成器，并且不会创建过滤器。
*   **OK** :这将把过滤器放置在显示过滤器工具栏中。

一旦过滤器出现在显示过滤器工具栏中，您就可以进行任何必要的修改，比如将`tcp.flags.syn == 1`更改为修改过的过滤器，比如`tcp.flags.syn == 0`。一旦您对过滤器感到满意，您可以通过按下*回车*或点击显示过滤器右侧的蓝色箭头来运行过滤器。

如您所见，表达式构建器是构建定制过滤器的一种简单方法。

在下一节中，我们将看到，在处理数据包捕获时，Wireshark 有许多快捷方式，允许您快速创建过滤器来简化您的工作流程。

# 发现快捷方式和便捷的过滤器

多年来，Wireshark 不断发展。现在，在进行分析时，只需右键单击并选择应用或准备为过滤器，即可非常轻松地动态创建显示过滤器。

在这一节中，让我们来看看应用过滤器的许多方法，而不必经历启动表达式生成器的复杂练习。此外，我们将看到一些方便的过滤器，您可以使用这些过滤器直接进入问题。我们将从过滤流量时使用的许多快捷方式的概述开始。

## 拥抱滤镜快捷键

在使用 Wireshark 的**数据包详细信息**面板中的时，您可能想要过滤特定的 IP 地址或特定的端口号。一旦您确定了感兴趣的项目，您可以右键单击它，您将看到几个过滤器快捷方式，如下所示:

![Figure 7.21 – Right-click to view filter shortcuts
](img/B18389_07_021.jpg)

图 7.21–右键单击查看过滤器快捷方式

虽然右击时有很多选项，但是在中间可以看到处理滤镜的快捷方式。以下是可用的选项:

*   **Apply as Filter** :选中时，将创建并运行选中的字段值。
*   **准备为过滤器**:选中时，它将创建所选字段值并将其放置在显示过滤器区域，让您有机会对过滤器进行任何修改或添加。
*   **会话过滤器**:选中后，可以根据协议跟踪会话，如**以太网**、 **IPv6** 、 **TCP** ，如下截图所示:

![Figure 7.22 – Conversation Filter selections
](img/B18389_07_022.jpg)

图 7.22–对话过滤器选择

*   **用过滤器着色**:这允许你给一个特定的对话着色。正如你所看到的，你可以从许多可用的颜色中选择，或者你可以创建自己的着色规则，如下图所示:

![Figure 7.23 – Colorize with Filter
](img/B18389_07_023.jpg)

图 7.23–用滤镜着色

注意

如果您已经应用了过滤器对特定的流进行着色，然后想要撤销您的更改，请前往**查看** | **着色对话**，然后选择**重置着色**。

当您右键单击字段值上的并选择**应用为过滤器**或**准备过滤器**时，您将看到构建过滤器时的附加选项。让我们研究一下这是如何工作的。

### 查看附加选项

即使在快捷方式中，当使用**应用为过滤器**或**准备为过滤器**时，您也会发现其他方法来过滤流量。如图*图 7.21* 所示，可以右键查看过滤快捷方式。以下列表显示了如何选择简单过滤器或添加逻辑运算符:

*   **选中**:选择当前字段值。
*   **未选中**:创建一个过滤器，删除选中的字段。例如，如果我右键单击目的端口`443`并选择**未选择**，Wireshark 将生成`!(tcp.dstport == 443)`并将其放入显示过滤器。
*   **...并选择**:向过滤器添加一个字段值。
*   **...或者选中**:创建一个`OR`滤镜。
*   **...未选中的**:添加一个过滤器，删除选中的字段。
*   **...或未选择的**:创建一个`OR`过滤器，该过滤器用于删除所选字段。

使用过滤器是帮助你找到问题的工具之一。下一节提供了一些有用的过滤器建议，可以帮助您搜索特定类型的流量。

## 应用有用的过滤器

Wireshark 是开发人员、网络管理员、学生和安全分析器常用的工具。网络管理员使用 Wireshark 调查许多可能出现并导致网络降级或传播恶意软件的问题。

一旦您使用 Wireshark 工作了一段时间，您将会学到简化工作流程的技巧和技术。一个常见的任务是应用各种显示过滤器。

### 使用显示过滤器

虽然您可以随时构建过滤器，但通常有一些方便的显示过滤器，包括以下内容:

*   `http.request`:这将在捕获文件中搜索任何`HTTP GET`或`POST`请求。
*   `tcp.port==xxx`:如果您使用特定端口监控 TCP 流量，请使用此过滤器。
*   `tcp.stream eq X`:该过滤器将跟随特定的流，其中`X`是流索引。
*   `!(arp or icmp or dns)`:该过滤器将消除`arp`、`dns`和`icmp`流量。
*   `vlan.id ==X`:显示具体的`vlan`。

Wireshark 还提供了一个方便的拖放功能，您可以简单地从数据包树中拖动一个字段，并将其放入显示过滤器中。

除了显示过滤器之外，有时还会使用捕获过滤器来收集特定的流量。

### 使用捕获过滤器

众所周知，捕获过滤器在捕获流量时缩小了范围。一些实例包括如下:

*   `port ftp || port ftp-data`:这将捕获 FTP 流量。
*   `ip host x.x.x.x`:这将捕获来自特定主机的流量。
*   `ip multicast`:这将捕获多播流量。

Wireshark wiki 还列出了几个用于检测恶意软件的捕获过滤器。例如，`dst port 135 and tcp port 135 and ip[2:2]==48`会显示 Blaster 蠕虫病毒的证据。

注意

通过访问[https://docs . Microsoft . com/en-us/trouble shooting/windows-server/security-and-malware/Blaster-worm-virus-alert](https://docs.microsoft.com/en-us/troubleshoot/windows-server/security-and-malware/blaster-worm-virus-alert)了解更多关于 Blaster 蠕虫病毒的信息。

有许多方法可以过滤流量，只显示您想要查看的流量，这有助于删除不必要的流量并提高您的分析技能。根据您每天使用的网络类型，您很可能会建立自己的过滤器库。

# 总结

Wireshark 是一个强大的工具，让我们能够捕获和分析流量。在本章中，我们回顾了如何通过使用内置的过滤函数来更有效地研究捕获。我们学习了如何使用显示过滤器，并讨论了它如何提供仅显示单个协议的简单过滤器或字段值的组合。然后，我们回顾了如何编辑显示过滤器，以及如何创建自己的过滤器并将其存储在书签中以便于参考。

然后，我们讲述了如何在收集流量之前应用捕获过滤器，以便只显示特定类型的流量。我们还看到了如何通过构建表达式来深入查看特定的字段值。此外，我们看到，在执行粒度调查时，我们可以创建包含逻辑运算符和特定字段值的过滤器。有了许多过滤流量的方法，我们在进行分析的同时，研究了动态构建过滤器的捷径。最后，我们发现了在您的武器库中拥有几个有用的过滤器的好处。

在下一章中，我们将看一看**开放系统互连** ( **OSI** )模型，这是为了有效地进行数据包分析而必须掌握的基本概念。为了让您更好地理解 OSI 模型，我们将逐一回顾七层。我们将讨论寻址、协议数据单元以及每层中的协议。此外，我们将逐步完成封装过程，因为数据已准备好形成帧，以便通过适当的介质发送。

# 问题

现在，是时候检查你的知识了。选择最佳答案，然后对照*评估*附录中提供的答案检查您的答案:

1.  创建显示过滤器时，如果背景是 ____，则您输入了有效的过滤器。
    1.  红色
    2.  绿色的
    3.  黄色
    4.  蓝绿色
2.  当使用表达式生成器创建表达式时，您可以通过修改右侧列出的四个变量中的任何一个来优化过滤器，这四个变量是**关系**、_ _ _ _ _ _、**预定义值**和**范围**。
    1.  **浮动**
    2.  **整数**
    3.  **值**
    4.  **布尔型**
3.  要创建一个只查看 DNS 请求和响应的*捕获*过滤器，您应该在捕获过滤器中输入 _____。
    1.  `tcp port 53`
    2.  `DNS`
    3.  `dns`
    4.  `udp port 53`
4.  如果您需要构建一个过滤器来关注特定的字段值，您可以使用 _____ 构建器。
    1.  表示
    2.  伯克利
    3.  EPAN
    4.  解剖器
5.  当使用**应用为过滤器**或**准备为过滤器**时，您将看到创建简单过滤器或添加逻辑运算符的附加选项。_____ 添加删除选定字段的过滤器。
    1.  **...或者选中**
    2.  **...并选择了**
    3.  **未选中**
    4.  **...并且没有被选中**
6.  在 Wireshark 中，捕获过滤器使用 _____ 语法。
    1.  表示
    2.  BPF
    3.  EPAN
    4.  解剖器
7.  当选择快捷方式 _____ 时，它将创建选定的字段值并将其放置在显示筛选区域，使您有机会对筛选进行任何修改或添加。
    1.  **准备过滤器**
    2.  **应用为过滤器**
    3.  **构建过滤器**
    4.  **生成过滤器**

# 延伸阅读

请参考以下链接了解更多信息:

*   阅读更多关于 Berkeley 包过滤器的内容，*BSD 包过滤器:一种用于用户级包捕获的新架构*，它位于 https://www.tcpdump.org/papers/bpf-usenix93.pdf。
*   要查看方便的`802.11`过滤器列表，请访问[https://semfionetworks . com/WP-content/uploads/2021/04/wireshark _ 802.11 _ filters _-_ reference _ sheet . pdf](https://semfionetworks.com/wp-content/uploads/2021/04/wireshark_802.11_filters_-_reference_sheet.pdf)。
*   要了解更多有关无线过滤器的信息以及几个示例，请访问[https://tie bing . blogspot . com/2015/02/wireshark-display-filters . html](https://tiebing.blogspot.com/2015/02/wireshark-display-filters.html)。
*   如需获取捕获过滤器示例的详细列表，请访问 Wireshark wiki，网址为[https://wiki.wireshark.org/CaptureFilters](https://wiki.wireshark.org/CaptureFilters)。
*   要查找用于构建过滤器的内置字段值的完整列表，请转到[https://www.wireshark.org/docs/dfref/](https://www.wireshark.org/docs/dfref/)，在这里您可以选择一个协议链接并了解有关支持的字段值的更多信息。*