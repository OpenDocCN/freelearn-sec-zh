# 零、前言

21 世纪初，一位同事向我介绍了 Wireshark 的前身 Ethereal。我记得当我的笔记本电脑吞噬流量时，我看着屏幕，心想:“我不知道这是什么，但我想知道！”在接下来的几年里，我沉浸在使用 Wireshark 学习尽可能多的数据包分析知识中。我参加培训，观看视频，阅读书籍，这些帮助我汇编和整理我的知识，并尊重这些信息包告诉我们的东西。

我教授网络和安全课程，并在会议上介绍使用 Wireshark 的诸多好处。在这第二版*学习 Wireshark* 中，我想和你分享我的知识。每章都有多次实践的机会。使用这些示例，您将理解数据的含义，并理解数据包告诉您的内容。我将概述如何进行详细的搜索、跟踪数据流并识别端点，以便您可以解决延迟问题并主动识别网络攻击。加入我的旅程，你会很快意识到了解网络上发生的事情的能力是一种超能力！

# 这本书是给谁的

本书面向网络管理员、安全分析器、学生、教师以及任何有兴趣学习使用 Wireshark 进行数据包分析的人。网络基础、设备和协议的基本知识，以及对不同拓扑的理解，将有助于您阅读材料。

# 这本书涵盖了什么

[*第一章*](B18389_01_ePub.xhtml#_idTextAnchor015) 、*赏析流量分析*，描述了无数进行数据包分析的地点和原因。此外，我们还将介绍使用 Wireshark 的诸多好处，Wireshark 是一款开源协议分析器，包含许多丰富的特性。

[*第 2 章*](B18389_02_ePub.xhtml#_idTextAnchor036) ，*使用 Wireshark* ，首先概述当今 Wireshark 的起源。我们将研究接口并回顾数据包分析的各个阶段。最后，我们将讨论内置工具，更仔细地看看`tshark`(或基于终端的 Wireshark)，Wireshark 的一个轻量级替代。

[*第三章*](B18389_03_ePub.xhtml#_idTextAnchor054) 、*安装 Wireshark* ，说明 Wireshark 如何为不同的操作系统提供支持。我们将比较不同的捕获引擎，如 WinPCap、LibPcap 和 nPCap，完成一个标准的 Windows 安装，然后查看在[https://www.wireshark.org/](https://www.wireshark.org/)可获得的资源。

[*第 4 章*](B18389_04_ePub.xhtml#_idTextAnchor077) 、*探索 Wireshark 接口*，深入探究 Wireshark 的一些常见元素，以改进您的工作流程。我们将研究欢迎屏幕和常见菜单选项，例如**文件**、**编辑**和**视图**，以便您可以在分析过程中轻松导航界面。

[*第 5 章*](B18389_05_ePub.xhtml#_idTextAnchor100)*进入数据流*，从不同网络架构的比较开始，然后继续讨论各种捕获选项。您将发现接入数据流时将看到的对话和端点，然后了解网络流量基线的重要性。

[*第六章*](B18389_06_ePub.xhtml#_idTextAnchor117)*个性化界面*，帮助你实现所有你可以自定义的界面的许多方面。您将学习如何个性化布局和一般外观，创建定制的配置文件，调整列、字体和颜色，以及创建按钮。

[*第 7 章*](B18389_07_ePub.xhtml#_idTextAnchor135) ，*使用显示和捕获过滤器*，帮助你让检查一个数据包捕获变得不那么势不可挡。我们将看看如何通过过滤网络流量来缩小范围。我们将比较显示和捕获过滤器，发现用于构建过滤器的快捷方式，并以对表达式构建器的回顾结束。

[*第 8 章*](B18389_08_ePub.xhtml#_idTextAnchor153)*概述了 OSI 模型*，提供了**开放系统互连** ( **OSI** )模型的概述，这是一个七层框架，概述了操作系统如何准备数据在网络上传输。我们将回顾每一层的目的、协议和**协议数据单元**(**PDU**)，探索封装过程，并演示 Wireshark 中的帧形成。

[*第 9 章*](B18389_09_ePub.xhtml#_idTextAnchor175) 、*解码 TCP 和 UDP* ，深入探讨传输层中的两个关键协议——传输控制协议 ( **TCP** )和用户数据报协议 ( **UDP** )。我们将回顾传输层的目的，然后评估 TCP 和 UDP 的报头和字段值。

[*第十章*](B18389_10_ePub.xhtml#_idTextAnchor194) ，*管理 TCP 连接*，从考察三次握手开始。我们将发现 TCP 选项，更好地理解 TCP 协议首选项，然后以 TCP 拆卸过程的概述结束。

[*第十一章*](B18389_11_ePub.xhtml#_idTextAnchor211) ，*解析 IPv4 和 IPv6* ，提供了分解**互联网协议** ( **IP** )。我们将概述 IPv4 和报头字段，然后探索 IPv6 的简化报头。我们将通过讨论协议首选项进行总结，并了解 IPv4 和 IPv6 如何通过使用隧道协议共存。

[*第十二章*](B18389_12_ePub.xhtml#_idTextAnchor226) ，*发现 ICMP* ，详细介绍**互联网控制消息协议** ( **ICMP** )。我们将剖析 ICMP 和 ICMPv6，比较查询和错误消息，并讨论 ICMP 类型和代码值。我们将讨论 ICMP 如何被恶意使用，并概述配置防火墙规则的重要性。

[*第十三章*](B18389_13_ePub.xhtml#_idTextAnchor248) 、*潜入 DNS* ，概述了**域名系统** ( **DNS** )的意义。您将了解 DNS 如何将主机名解析为 IP 地址。我们将比较不同类型的记录，逐步执行查询和响应，查看 DNS 头，并使用 Wireshark 计算 DNS 响应时间。

[*第十四章*](B18389_14_ePub.xhtml#_idTextAnchor270) ，*检查 DHCP* ，首先解释**动态主机配置协议** ( **DHCP** )。然后，我们将概述 **DORA** 流程—**发现要约请求确认**。我们将剖析 DHCP 报头，查看所有字段值、标志和端口号，然后通过一个 DHCP 示例来结束。

[*第十五章*](B18389_15_ePub.xhtml#_idTextAnchor298) ，*解码 HTTP* ，重点介绍了**超文本传输协议** ( **HTTP** )，一种浏览网页时使用的应用层协议。我们将学习 HTTP 的细节，探索常见的传输方法，并剖析报头和字段。然后我们将比较请求和响应消息，然后通过一个 HTTP 流进行总结。

[*第十六章*](B18389_16_ePub.xhtml#_idTextAnchor323) ，*了解 ARP* ，仔细看看**地址解析协议** ( **ARP** )，这是一个在传递数据中很重要的协议。我们将概述 ARP 的作用和目的，探索报头和字段，描述不同类型的 ARP，并简要了解 ARP 攻击。

[*第 17 章*](B18389_17_ePub.xhtml#_idTextAnchor345) 、*确定网络延迟问题*，概述了即使是初学者也能诊断网络问题的方法。我们将探索颜色规则和智能滚动条，然后以专家信息的概述结束，专家信息将警报分为不同的类别，并指导您进行更有针对性的评估。

[*第 18 章*](B18389_18_ePub.xhtml#_idTextAnchor360) 、*子集化、保存和导出捕获*，帮助您探索将数据包捕获分解成更小文件进行分析的许多不同方法。我们将讨论保存文件时的不同选项，探索导出对象、会话密钥和包字节等组件的方法，然后概述为什么以及如何添加注释。

[*第 19 章*](B18389_19_ePub.xhtml#_idTextAnchor377) ，*发现 I/O 和流图*，首先介绍统计菜单在分析捕获文件时可以帮助我们的许多方式。我们将创建基本的 I/O 图来帮助可视化网络问题，并通过比较不同的 TCP 流图如何提供流的可视化表示来进行总结。

[*第二十章*](B18389_20_ePub.xhtml#_idTextAnchor401) ，*使用 CloudShark 进行数据包分析*，涵盖了 CloudShark，一个类似于 Wireshark 的在线应用。您将学习如何过滤流量和生成图表。然后，我们将回顾您如何与同事分享捕获，并概述您可以在哪里找到样本捕获，以便您可以继续提高您的技能。

# 为了充分利用这本书

要准备使用 Wireshark，请在您的系统上下载并安装最新版本。详细说明见第三章 、*安装 Wireshark* 。

为了最大限度地利用每一章，当有数据包捕获的参考时，下载文件，以便您可以跟随课程。

除此之外，请自行练习您的技能，特别是复习 TCP/IP 套件中的常用协议，以便加深您的知识并更加精通数据包分析。

# 下载示例代码文件

书中引用了所有 Wireshark 捕获文件。从在线存储库中下载适当的捕获文件，这样您就可以学习这些课程。

# 下载彩色图片

我们还提供了一个 PDF 文件，其中有本书中使用的截图和图表的彩色图像。你可以在这里下载:[https://packt.link/iF8Fj](https://packt.link/iF8Fj)。

# 使用的惯例

本书通篇使用了许多文本约定。

`Code in text`:表示文本中的码字、数据库表名、文件夹名、文件名、文件扩展名、路径名、伪 URL、用户输入和 Twitter 句柄。下面是一个例子:“要写入一个文件，使用`-w`，然后是文件名和路径。”

任何命令行输入或输出都按如下方式编写:

c:\ Program Files \ Wireshark > t shark-I " Ethernet 2 "-w Test-t shark . pcap-a 时长:10

**Bold** :表示一个新术语、一个重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词以**粗体**出现。下面是一个例子:“一旦你进入 CloudShark，选择**导出** | **下载文件**下拉菜单。”

提示或重要注意事项

像这样出现。

# 取得联系

我们随时欢迎读者的反馈。

**总体反馈**:如果您对本书的任何方面有疑问，请发邮件至 customercare@packtpub.com[给我们，并在邮件主题中提及书名。](mailto:customercare@packtpub.com)

**勘误表**:虽然我们已经尽力确保内容的准确性，但错误还是会发生。如果你在这本书里发现了一个错误，请告诉我们，我们将不胜感激。请访问 www.packtpub.com/support/errata[并填写表格。](http://www.packtpub.com/support/errata)

**盗版**:如果您在互联网上遇到我们作品的任何形式的非法拷贝，如果您能提供我们的地址或网站名称，我们将不胜感激。请通过 copyright@packt.com 的[联系我们，并提供材料链接。](mailto:copyright@packt.com)

**如果你有兴趣成为一名作家**:如果有你擅长的主题，并且你有兴趣写书或投稿，请访问 authors.packtpub.com。

# 分享你的想法

一旦您阅读了 *Learn Wireshark -第二版*，我们很想听听您的想法！请点击这里直接进入亚马逊对这本书的评论页面，并分享你的反馈。

您的评论对我们和技术社区非常重要，将有助于我们确保提供高质量的内容。