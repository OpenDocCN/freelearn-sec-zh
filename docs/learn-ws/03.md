# 一、了解流量分析

今天的网络是复杂的，很多时候，当面临问题时，你能解决问题的唯一方法是你能看到问题。正是因为这个原因，使用 Wireshark 等工具的数据包分析已经存在了很多年。除了使用 Wireshark 手动进行数据包分析之外，当今的设备还具备从网络中提取数据并检查其内容的能力。此功能有助于网络管理员排除故障、测试、基线和监控网络威胁。

本章将帮助您认识到使用 Wireshark 进行数据包分析的诸多好处。您将了解它作为一个优秀的开源软件产品的历史，它包含许多丰富的特性。您将发现各种群体如何从使用数据包分析中受益，如网络管理员、学生和安全分析器。此外，我们将涵盖许多进行数据包分析的地方，包括在**局域网** ( **LAN** )、主机或现实世界中。最后，您将了解 Wireshark 如何能够解码数百种不同的协议，并不断得到改进，使其成为监控网络的最佳工具。

在本章中，我们将通过涵盖以下主题来解决所有这些问题:

*   查看数据包分析
*   了解谁会从数据包分析中受益
*   确定在哪里使用数据包分析
*   概述何时使用数据包分析
*   了解 Wireshark

# 查看数据包分析

数据包分析通过实时捕获或使用之前捕获的文件，检查数据包以了解流量的特征和结构。分析器可以通过一次研究一个数据包或完整捕获来完成数据包分析。

当监控网络进行分析时，我们使用 Wireshark 或`tshark`等专业软件捕获流量。一旦数据被捕获，我们保存文件，软件将数据存储在一个文件中，该文件通常被称为**数据包捕获**或 **PCAP** 文件。

数据包分析有利于许多群体，包括:

*   **网络管理员**:使用数据包分析获得当前网络状况的信息。
*   **安全分析器**:在进行取证调查时，使用数据包分析来确定流量是否有任何异常或可疑之处。
*   学生们:使用数据包分析作为学习工具，更好地理解不同协议的工作原理。
*   **黑客**:使用数据包分析来嗅探网络流量，同时进行足迹和侦察，以获取有关网络的有价值信息。

我们在许多地方使用数据包分析，包括在局域网、主机或现实世界中。此外，我们在排除延迟问题、测试**物联网** ( **物联网**)设备以及为网络设定基线时将作为工具时，会使用数据包分析。

今天，使用 Wireshark 进行数据包分析是一项很有价值的技能。然而，分析数据包在网络世界中已经存在很多年了。早在 20 世纪 90 年代，各种工具使分析器能够在网络上执行数据包分析，以排除错误并监控服务器行为。在下一节中，我们将研究一些用于监控网络活动的早期工具。

## 探索早期的数据包嗅探器

数据包分析作为一种诊断工具，已经以某种形式存在了 20 多年，用于观察网络中传输的数据和其他信息。数据包分析是也称为**嗅探**。这个术语指的是早期的数据包嗅探器，即*嗅探*或捕获穿过网络的流量。20 世纪 90 年代，软件公司 Novell 开发了 Novell LANalyzer，它有一个图形用户界面和仪表板来检查网络流量。同时，微软推出了它的网络监视器。

在过去的 20 年里，出现了许多其他的数据包分析器和工具来嗅探流量，包括:

![Table 1.1 – Packet analyzers and tools
](img/B18389_table_1.1.jpg)

表 1.1–数据包分析器和工具

大多数数据包分析器都以类似的方式工作。它们捕获数据，然后根据适当的**请求注解** ( **RFC** )或其他规范对字段值中的原始位进行解码。一旦完成，数据将以有意义的方式呈现。

数据包分析工具在外观和功能方面各不相同，如下所示:

*   它们提供简单的基于文本的分析，比如基于终端的 Wireshark ( `tshark`)。
*   它们提供了丰富的图形用户界面，带有基于专家系统的先进的人工智能，引导分析器进行更有针对性的评估。

在下一节中，我们将看看目前使用数据包分析的各种设备。

## 评估使用数据包分析的设备

网络上的许多设备都使用数据包分析和流量嗅探，包括路由器、交换机和防火墙设备。当数据在网络中流动时，设备收集并解释数据包的原始位，检查每个数据包中的字段值，以决定应该采取什么措施。

设备以下列方式检查网络流量:

*   作为路由过程的一部分，**路由器**捕获流量，并检查 IP 报头以确定将流量发送到哪里。
*   一个 **IDS** 检查流量，如果有任何异常或可疑的行为，就向网络管理员发出警报。
*   一个**防火墙**监控所有流量，并将丢弃任何不符合**访问控制列表** ( **ACL** )的数据包。

例如，当数据通过防火墙时，设备会检查流量，并根据 ACL 确定是允许还是拒绝数据包。

### 使用 ACL

当使用防火墙时，ACL 控制网络上允许的流量类型。例如，ACL 包含以下条目:

*   允许出站 SYN 数据包。目的港是`80`。
*   允许入站 SYN-ACK 数据包。源端口是`80`。

为了决定是允许还是拒绝数据包，防火墙必须在数据包通过设备时检查每个报头。它将确定诸如 IP 地址、**传输控制协议** ( **TCP** )标志和正在使用的端口号等变量。如果数据包不符合 ACL 条目，防火墙将丢弃该数据包。如下图所示，目的端口为`80`的入站 SYN 数据包因不符合规则而被阻塞:

![Figure 1.1 – A firewall with an ACL
](img/B18389_01_001.jpg)

图 1.1–带有 ACL 的防火墙

值得注意的是，数据包嗅探器会检查流量，但不会以任何方式修改内容。它只是在流量通过网络时收集流量进行分析。

如您所见，数据包嗅探和分析作为管理网络的要素已经影响了很多年。然而，分析的第一步是捕获流量，这是我们接下来要探讨的。

## 捕获网络流量

在今天的网络上，一个**网络接口卡** ( **网卡**)将*只*监控发往那个主机的流量。然而，我们可以将卡置于一种称为**混杂模式**的状态，这种模式将允许适配器收集网络上的所有流量。因此，要捕获和监控所有网络流量，网卡必须处于混杂模式。

在 Windows 计算机上，您可以通过在 PowerShell 中运行以下命令来检查接口卡是否处于混杂模式:

Windows PowerShell

版权所有(C) 2014 微软公司。保留所有权利。

PS C:\ Users \ Admin > Get-net adapter | Format-List-Property 杂乱模式

混杂模式:假

我们使用数据包分析来了解流量的特征。虽然您可以在实时捕获过程中进行数据包分析，但是捕获流量并保存以供进一步分析是很常见的。捕获数据包进行分析的常见步骤包括:

1.  安装 Wireshark 和适当的数据包捕获引擎。
2.  启动 Wireshark 并选择捕获选项。
3.  开始捕获并运行，直到捕获 2，000–3，000 个数据包。
4.  停止捕获，并以适当的格式保存跟踪文件。
5.  通过一次研究一个数据包或作为一个完整的捕获来分析捕获。

在某些情况下，您可能需要将数据包捕获发送给公司或安全分析器进行进一步分析。

Wireshark 允许我们从单个或多个网络接口捕获、显示和过滤实时数据。此外，您可以检查预先捕获的数据包，搜索详细信息，并跟踪数据流。因此，数据包分析非常有利，因为它可以帮助您了解网络的本质。下一节概述了许多不同的人，他们可以从使用 Wireshark 进行数据包分析中受益。

# 识别谁从数据包分析中受益

几乎每个人都能从数据包分析中受益，包括开发人员、网络管理员、学生和安全分析器。让我们看看每一组，并探索通过数据包分析可以获得的好处。我们将从开发人员开始，因为他们可以看到他们的程序如何实时响应网络上的请求。

## 协助开发者

应用性能问题会影响底线，尤其是在任务关键的情况下。开发人员努力开发优雅高效的软件。在发布应用之前，开发人员运行功能和回归测试，并对服务器施加压力，以确保应用得到优化。

通常，开发人员在一个完美的环境中测试应用，该环境具有高带宽和低延迟。然而，一旦应用从本地(或测试)环境转移到生产网络，客户可能会抱怨响应时间慢。程序员会仔细检查应用；然而，在许多场合，他们无法发现任何异常。

开发人员必须确定响应时间慢的原因。一旦进一步测试确定不是应用导致了问题，Wireshark 等数据包分析工具可以帮助开发人员。

通过使用数据包分析，开发人员可以发现传输中的常见问题，并帮助确定延迟响应时间的根本原因。网络中可能会出现往返时间延迟和组织内部拥塞迹象等问题，从而影响响应时间。

仅仅优化应用是不够的。所有开发生命周期都应该包括检查网络上发生了什么，因为问题会影响整体性能。

除了开发人员之外，网络管理员通常也使用 Wireshark 来排除网络故障，我们将在下面看到。

## 帮助网络管理员监控网络

网络管理员使用数据包分析来获取当前网络状况的信息。Wireshark 可以帮助识别网络中可能需要调整和/或更换设备以提高整体性能的错误和/或问题。

Wireshark 的一个强大功能是能够快速检测捕获中的问题。网络管理员既可以使用专家系统，也可以使用智能滚动条，智能滚动条以颜色标记潜在的问题并帮助分析，我们将在下一节中看到。

### 专家系统和智能滚动条

Wireshark 允许我们在执行分析时可视化问题。专家系统对各种流量状况进行分类。每个级别都有一个颜色代码，便于识别一般工作流程和可能的关键事件:

*   **聊天颜色(蓝色):**它提供有关典型工作流的信息，例如 TCP 窗口更新或连接完成。
*   **注意颜色(青色):**表示感兴趣的项目，如重复确认和 TCP keepalive 段。
*   **警告色(黄色):**表示警告，如 TCP 零窗口或连接重置。
*   **错误颜色(红色):**这是最高级别，因为可能存在严重问题，如重新传输或数据包格式错误。

专家系统的画面在左下角，如下图所示:

![Figure 1.2 – Expert system and intelligent scroll bar
](img/B18389_01_002.jpg)

图 1.2-专家系统和智能滚动条

Wireshark 还有一个智能滚动条，它提供了检测问题的视觉效果。在前面的截图中，我们可以看到根据应用中设置的着色规则，右侧有一个明显的着色图案。

借助智能滚动条，管理员可以轻松点击色带，锁定可能出现的问题。请记住，智能滚动条只有在颜色规则处于活动状态时才可见；但是，默认情况下，颜色规则是打开的。

一旦发现任何问题，您就可以对流量进行分组、添加注释、保存和导出数据包捕获。

### 子集化流量、评论、保存和导出

有时，网络管理员可能只想与团队的其他成员共享一小部分流量。Wireshark 可以对大量捕获进行子集化，这样您就可以专注于问题领域。

例如，除了数据之外，大型数据包捕获很可能会有几种不同类型的流量，如管理帧和 802.11 控制帧。您可以使用**轻松应用过滤器...并且没有选择**选项来排除与分析无关的数据包。

一旦您创建了一个较小的文件，您就可以导出指定的数据包并以多种格式保存它们。格式包括默认的 PCAPNG，以及 PCAP、Sun Snoop、DMP 等。

在新创建的子集中，您可以包含注释。您可以通过几种不同的方式找到注释:

*   选择左下角看起来像便笺簿和铅笔的注释图标，为单个数据包添加注释。
*   导航到**编辑** | **数据包注释**菜单选项，为单个数据包添加注释。
*   Navigate to the **Statistics** | **Capture file properties** menu choice and include comments for an entire packet capture in the comment area at the bottom of the window.

    注意

    如果添加注释，则必须以 PCAPNG 格式保存文件，因为并非所有文件格式都支持使用注释。

除了网络管理员之外，学生还将通过使用 Wireshark 检查协议的报头和字段值，深入了解网络上实际发生的情况。

## 对学生进行协议教育

学生可以使用数据包分析作为学习工具来更好地理解协议。比如在复习的**动态主机配置协议** ( **DHCP** )的时候，一本教材会显示过程的四个阶段: **D** iscover、 **O** ffer、 **R** equest、**A**CK knowledge(**DORA**)。请看下图:

![Figure 1.3 – The DORA process
](img/B18389_01_003.jpg)

图 1.3–DORA 流程

虽然上图显示了由四部分组成的每个事务，但它没有显示四个数据包交换的每个部分的详细信息。

在下面的截图中，我们可以看到 Wireshark 中的一个实际的 DHCP 事务。除此之外，学生还可以看到每个交换的细节，包括传输协议、IP、**媒体访问控制** ( **MAC** )地址和 DHCP 报头标志:

![Figure 1.4 – The DORA process in Wireshark
](img/B18389_01_004.jpg)

图 1.4–Wireshark 中的 DORA 流程

通过学习常见协议的正常行为和目的，学生将能够排除将来可能出现的任何问题。

如您所见，数据包分析对许多人都有很多好处。由于能够真正检查网络上发生的事情，使用数据包分析的另一个关键群体是安全分析器。

## 向安全分析器发出威胁警报

为了有效地发现潜在的问题，安全分析器必须是数据包分析方面的专家，因为他们以各种方式使用数据包分析:

*   确定流量是否有任何异常或可疑之处。
*   在完成法庭调查时，发现网络上发生了什么。

Wireshark 可以帮助安全分析器更好地理解特定类型的攻击，以便他们能够制定防火墙规则。为了磨练安全分析技能，分析器可以在各种存储库上发现并下载许多 PCAPs。位于 https://www.honeynet.org 的蜜网项目是一个很好的起点。导航到关于**挑战**的部分，该部分提供了许多取证练习的示例，以回顾和了解在当今网络中发现的许多常见威胁。

一旦你进入**挑战**页面，搜索`Challenge 12 - Hiding in Plain Sight`，阅读关于挑战的详细信息。然后，为了加强你的分析技巧，下载页面底部的文件并完成问题。答案也可以在页面底部找到，还有其他感兴趣的文件。

安全分析器认为 Wireshark 是一个有价值的工具，因为它提供了对网络上发生的事情的洞察。由于 Wireshark 能够洞察网络上发生的事情，因此也被黑客用于侦察，以收集和分析流量。这可能在攻击之前或主动攻击期间多次发生，我们将在接下来讨论。

## 用信息武装黑客

恶意参与者使用数据包分析来嗅探网络流量，目的是获取敏感信息。此外，他们还可以利用收集到的信息发动主动攻击。

当被用作攻击的前兆时，黑客在侦察期间收集信息，这也被称为足迹**。让我们看看黑客使用 Wireshark 进行被动攻击的几种方式。**

 **### 概述被动攻击

利用 Wireshark(或类似的工具)，恶意行为者将试图获取机密信息,通过网络传播以达到以下目的:

*   **足迹和侦察**:作为主动攻击的前兆，恶意行为者捕获流量以收集尽可能多的目标信息。除此之外，Wireshark 还可用于收集其他信息，如 IP 和 MAC 地址、开放的端口和服务以及可能的防御方法。
*   **嗅探纯文本**:数据包嗅探的另一个用途是寻找以纯文本形式发送的密码。此外，以纯文本形式发送的 SNMP、HTTP、FTP、Telnet 和 VoIP 等协议容易受到数据包嗅探器的攻击。一旦被捕获，协议就可以暴露关于网络和/或系统的信息。

一个组织可以用几种方法来防御未经授权的数据包嗅探。有反嗅探器软件可以检测网络上的嗅探器。然而，防止数据泄露的最好方法之一是使用加密。如果有人捕获了流量，那么加密的数据将显得毫无意义。

接下来，我们将了解黑客如何通过主动嗅探和监控流量来使用 Wireshark，作为**地址解析协议** ( **ARP** )欺骗攻击的一部分。

### 了解主动攻击

恶意行为者在网络上发起许多不同类型的攻击，如如**拒绝服务** ( **DoS** )、网络钓鱼，或**结构化查询语言** ( **SQL** )注入攻击。接下来，我们来看看另一种类型的攻击:ARP 缓存毒攻击。

#### 毒害缓存

ARP 缓存中毒，也称为 **ARP 欺骗**，在**中间人** ( **MitM** )攻击中使用。为了理解为什么这是一种有效的攻击，让我们来看看 ARP 在局域网上的正常使用。

在局域网中，主机通过它们的 MAC(或物理)地址来识别。为了与正确的主机通信，每个设备在 ARP 或 MAC 地址表中跟踪所有局域网主机的 MAC 地址，也称为 **ARP 缓存表**。

ARP 或 MAC 地址表中的条目将在一段时间后超时。正常情况下，当设备需要与网络上的另一台设备通信时，它需要自己的 MAC 地址。首先，设备将检查 ARP 缓存，如果表中没有条目，设备将向网络上的所有主机发送 ARP 请求广播。

ARP 请求询问以下问题:谁拥有(被请求的)IP 地址？告诉我(请求的)IP 地址。然后，设备将等待 ARP 回复，如下面的屏幕截图所示:

![Figure 1.5 – ARP broadcast on a network
](img/B18389_01_005.jpg)

图 1.5–网络上的 ARP 广播

ARP 回复是一个包含主机 IP 地址和请求的 MAC 地址信息的响应。一旦收到地址，ARP 缓存就会更新以反映 MAC 地址。

在 ARP 欺骗攻击中，恶意参与者会执行以下操作:

1.  向 LAN 上的所有主机发送未经请求的 ARP 回复消息，其中包含攻击者机器的假冒 MAC 地址。
2.  收到 ARP 回复后，局域网上的所有设备都会用不正确的 MAC 地址更新它们的 ARP(或 MAC 地址)表。这实际上*毒害了*终端设备上的缓存。
3.  一旦 ARP 表中毒，这将允许入侵者假冒另一台主机来访问敏感信息。

ARP 欺骗是在 MitM 攻击过程中完成的，它允许恶意行为者获取通常发往另一台主机的流量。

在下图中，恶意参与者发送了一个伪造的 ARP 回复，然后毒害了所有网络设备中的缓存。网络上的所有主机现在都认为`10.40.10.103`在`46:89:FF:4C:57:BB`处，而不是`00:80:68:B4:87:EF`处，并将使用伪造的 MAC 地址去找攻击者:

![Figure 1.6 – An ARP spoof attack
](img/B18389_01_006.jpg)

图 1.6-ARP 欺骗攻击

然后，恶意参与者将使用*主动*嗅探来收集被误导的流量，试图获取敏感信息。在大多数情况下，发送给恶意行为者的流量被转发给受害者，而受害者并不知道有什么不对劲。

现在，我们已经看到许多人可以从数据包分析中受益。在下一节中，我们将研究数据包分析在哪里最有效。

# 确定在哪里使用数据包分析

要进行有效的数据包分析，第一步是获得良好的捕获。有许多地方可以进行数据包分析，包括 LAN、主机或现实世界。让我们从在局域网上使用数据包分析开始。

## 分析局域网上的流量

今天的网络很复杂。企业网络为网络上的客户端提供连接、数据应用和服务，如下图所示:

![Figure 1.7 – A LAN
](img/B18389_01_007.jpg)

图 1.7–局域网

大多数局域网是异构的，有各种操作系统，如 Windows、Linux 和 macOS，以及各种设备，如软电话、平板电脑、笔记本电脑和移动设备。根据业务需求，网络可能包括广域网连接和电话。

要有效地使用数据包分析，放置是关键。并不是所有的流量都是一样的。根据位置的不同，您可能只能捕获总网络流量的一部分。如果数据包嗅探器位于主机或终端设备上，那么它将能够看到网段冲突域上的流量。如果嗅探器镜像主干上的所有流量，那么它将能够看到所有流量。

在某些情况下，您可能需要在个人主机(如 PC)上执行数据包分析，以便只监控目的地为该主机的流量。在其他情况下，您可能需要收集交换机上的流量，以查看通过交换机端口的流量。

### 嗅探网络流量

数据包分析可以在单个主机上、在交换机内或根据流量进行。区别如下:

*   如果协议分析器安装在连接到交换机的客户端设备上，则网络流量视图会受到限制。在单个交换机端口上嗅探流量时，您只会看到广播、组播和您自己的单播流量。
*   要查看交换机上的所有流量，网络管理员可以使用端口监控或**交换端口分析器** ( **SPAN** )。在某些情况下，您可以在交换机内进行监控，因为 Wireshark 内置于 Cisco Nexus 7000 系列和许多其他设备中。
*   另一种选择是使用与流量一致的全双工分路器。分路器对流量进行复制或镜像，并将其导入设备进行分析。如果使用这个选项，那么您可能需要一个特殊的适配器。

除了在 LAN 或主机上使用数据包分析之外，数据包分析还可以在现实世界中用于监控流量中的威胁。

### 在现实世界中使用数据包分析

数据包分析在现实世界中以多种形式使用。一个例子是国土安全部**(**DHS**)爱因斯坦系统，该系统在联邦政府网络安全中发挥着积极作用。美国政府不断面临多种类型攻击的风险，包括 DoS 攻击、恶意软件、未经授权的访问以及主动扫描和探测。**

 **爱因斯坦系统会主动监控流量中的威胁。它的两个主要功能如下:

*   观察和报告可能的网络威胁
*   检测和阻止危害联邦机构的攻击

爱因斯坦系统提供了对主动攻击采取主动措施所必需的态势感知。收集的情报有助于机构防御持续的威胁。

如图所示，数据包分析在许多地方都很有效。以下部分提供了在什么情况下数据包分析将获得最大收益的指导。

# 概述何时使用数据包分析

我们在许多方面使用数据包分析。我们可以解决延迟问题，测试物联网设备，监控威胁，并为网络设定基线。让我们从故障排除开始，评估一些此类活动，故障排除是数据包分析的常见用途。

## Troubleshooting latency issues

Wireshark can be a valuable asset when troubleshooting issues on the network. There are many built-in tools designed to gather and report network statistics. We can analyze network problems and monitor bandwidth usage per application and process. The information gathered can help identify choke points and maintain efficient network data transmission.

协议分析使网络管理员能够监控网络上的流量，发现问题，确定性能可以微调的地方。例如，如果您怀疑有延迟，可以在您怀疑有问题的区域获取一个捕获，然后运行 Stevens 图，如下面的屏幕截图所示:

![Figure 1.8 – A Stevens graph
](img/B18389_01_008.jpg)

图 1.8-史蒂文斯曲线图

一旦图完成，您就可以检查能够突出通信流中的错误的细节。例如，沿着图表的顶部，我们看到一条持续大约四(4)秒的直线。该线代表传输中的间隙，可能需要进一步调查。

除了排除网络故障之外，许多人还发现 Wireshark 在组织实施物联网设备之前如何成为测试物联网设备的宝贵资产。

## 测试物联网设备

物联网是智能设备的无处不在的转变，这些智能设备嵌入到连接到互联网的日常物品中，使它们能够发送和接收数据。物联网有几个组成部分:人、基础设施、事物、流程和数据。物联网已经成为一个价值数十亿美元的行业，消费者和行业都从中受益。

即使有这些好处，在将物联网设备连接到网络之前，最好还是进行一些测试。使用 Wireshark 可以帮助您了解将设备接入网络时会发生什么。以下是 Wireshark 可以帮助确定的问题列表:

*   一旦设备处于活动状态，它们如何进行通信？他们会主动打电话回家吗？
*   它们传达什么信息？用户名和密码是明文发送的吗？

了解这些设备行为的唯一方法是插入一个设备，捕获数据交换，并分析数据包捕获。获得的信息可以为物联网设备的漏洞提供有价值的见解。

除了故障排除和测试之外，Wireshark 还有助于主动威胁评估。

## 监控威胁

监控威胁有三种方式:

*   **主动**:通过使用 IDS 等设备监控您的系统并防范威胁。
*   **主动**:主动通过进行数据包分析和监控日志文件来寻找威胁。
*   **反应**:系统成为攻击的受害者，事件响应团队管理攻击，随后进行取证练习。

Wireshark 可以帮助安全分析器积极监控威胁。虽然 Wireshark 不提供任何警报，但它可以与 IDS 结合使用，调查可能的恶意网络活动。

例如，在使用 snort(一种开源 IDS)时，传感器产生了以下警报，这可能表示受保护网络上有恶意活动:

删除的 WEB-MISC text/html content-type 不带 HTML-可能是恶意软件 C&C(检测到非标准协议或事件)[16460]

此警报表示受感染的主机可能正在与外部实体通信，并将在网络上收集的信息发送给僵尸主机。安全分析器应立即采取行动，在网络的不同网段进行捕获，以识别和缓解威胁。

行业也看到了使用 Wireshark 进行威胁监控的价值。例如，在*Cisco Certified cyber ops Associate*认证预备课程中，学生们学习如何使用 Wireshark 观察和监控异常流量模式，同时磨练他们的技能，准备在**安全运营中心** ( **SOC** )与网络安全分析器一起工作。

为了确定哪些流量是异常的，或者正确地排除网络故障，您必须能够确定什么是正常的网络活动。这是通过执行基线来实现的，如下一节所述。

## 建立网络基线

网络基线是定义正常活动的一组参数。基线使用 Wireshark 或`tshark`提供了一段时间内网络流量的快照。基线的关键特征包括利用率、网络协议、有效吞吐量、转发速率和网络延迟。网络团队可以使用基线进行预测和规划，以及优化、调整和故障排除。

基线流程经历几个阶段:计划、捕获、保存和分析。完成基线后，网络分析器就可以查看捕获的数据，以评估端到端通信的总体性能。建立网络基线有助于获得有关网络健康状况的有价值信息，并可能发现当前的网络问题。除此之外，后续的基线练习可以帮助预测未来的问题。

每当计划安装新设备时，最好在改变之前做一个基线。实施后，进行另一次捕获，以便您可以识别通信流中可能存在的问题，然后微调配置。

如您所见，我们可以通过多种方式使用数据包分析来进行监控、测试、基线和故障排除。但是，由于能够获取敏感信息或作为攻击的前兆，数据包分析只应在以下情况下进行:

*   网络是您自己的，或者您已经获得明确的许可来进行数据包分析以进行安全扫描。
*   它是在排除网络连接问题时完成的。

此外，应考虑维护所收集数据的隐私，并采用适当的方法来获取、分析和保留任何数据包捕获。

如上所述，我们现在知道了使用数据包分析的许多原因。让我们总结一下 Wireshark，它是当今最强大的数据包分析工具之一。

# 了解 Wireshark

20 世纪 90 年代末，Gerald Combs 需要一种工具来分析网络问题。当时有便携式嗅探器，但价格昂贵。Gerald 在一些朋友的帮助下开发了 Ethereal，这个后来变成了 Wireshark。它已经存在了 20 多年，并随着时间的推移继续发展和改进。

Wireshark 的优势是能够通过使用解码器或解析器将捕获的比特解码成可读格式。

剖析器提供如何根据适当的 RFC 或其他规范将协议分解成适当格式的信息。

Wireshark 可以解码数百种不同的协议。新的解剖器定期添加到库中。此外，您可以通过开发自己的解析器来解码专有和专业协议。

Wireshark 与许多其他嗅探器兼容，并且具有多种用于导入和导出的文件格式。其他一些特性包括如下:

*   合并数据包捕获。
*   提供 VoIP 流量的详细分析。
*   创建基本和高级 I/O 图形。

Wireshark 可以安装在大多数操作系统上，包括 Windows、Solaris、Linux 和 macOS。

使用 Wireshark 一段时间后，您可以观察它如何帮助网络管理员了解流量、排除性能问题或建立网络基线。

# 总结

鉴于当今网络上传输的数据的多样性和数量，很容易理解为什么使用 Wireshark 进行数据包分析应该成为每个人的技能。在这一章中，我们简要地看了一下数据包分析是如何在 20 世纪 90 年代随着硬件嗅探器的使用而开始的。快进到今天，我们可以看到网络上的几乎每台设备都使用数据包分析来收集流量、检查内容，然后决定采取什么措施。

我们了解了开发人员、网络管理员、学生和安全分析器如何从数据包分析中获益。我们研究了许多进行数据包分析的地方:局域网、主机和现实世界。除此之外，我们还发现了数据包分析在当今网络中的各种用途，包括故障排除、测试物联网设备、监控威胁和基线。我们现在可以体会到 Wireshark 是一款出色的开源软件产品，它包含丰富的功能和各种工具，可以轻松解决问题和分析网络流量。

在下一章中，我们将研究 Wireshark 接口并回顾数据包分析的各个阶段。我们还将回顾内置的**命令行界面** ( **CLI** )工具，如`dumpcap`和`editcap`。此外，因为 Wireshark 可能是资源密集型的，我们将了解`tshark`(或基于终端的 Wireshark)如何提供 Wireshark 的轻量级替代方案。

# 问题

现在是时候检查你的知识了。选择最佳答案，然后检查您的答案，这些答案可在*评估*附录中找到:

1.  数据包分析作为一种诊断工具，用于观察网络中传输的数据和其他信息，自 _____ 以来就以某种形式出现了。
    1.  20 世纪 50 年代
    2.  60 年代
    3.  20 世纪 70 年代
    4.  20 世纪 90 年代
2.  数据包分析在现实世界中以多种形式使用。一个是 DHS _ _ _ _ _ 系统，用于监控威胁。
    1.  雕工
    2.  小包裹
    3.  爱因斯坦
    4.  目的地 3
3.  在专家系统中，_____ 提供有关典型工作流的信息，如 TCP 窗口更新或连接完成。
    1.  注意
    2.  闲谈
    3.  错误
    4.  警告
4.  ___ 使用 Wireshark 或`tshark`提供一段时间内网络流量的快照。特征可以包括利用率、网络协议和有效吞吐量转发速率。
    1.  一系列
    2.  多拉过程
    3.  基线
    4.  温切克
5.  威胁监控有三种方式。_____ 是指系统成为攻击的受害者，事件响应团队管理攻击，随后进行取证工作。
    1.  积极主动的
    2.  反应的
    3.  活跃的
    4.  反应的
6.  使用 Wireshark 测试 _____ 时，您将能够确定他们一旦激活后如何通信，并查看他们是否在没有提示的情况下呼叫总部。
    1.  美国学术团体委员会
    2.  专家系统
    3.  物联网设备
    4.  IDSes
7.  当获得 IP 地址时，DHCP 将经历一个称为 _____ 的四部分交易。
    1.  一系列
    2.  多拉过程
    3.  基线
    4.  温切克****