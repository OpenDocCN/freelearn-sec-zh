# 第四章：Metasploit Web 界面

在上一章中，我们学习了 Metasploit Framework 的基础知识，并查看了一些我们可以在 Metasploit 中使用的功能。在本章中，我们将专注于 Metasploit Framework 的 Web 界面。该界面确实帮助那些对命令行界面（CLI）经验较少的用户。从侦察到报告，该界面让我们可以使用单个界面处理渗透测试的所有阶段。在本章中，我们将学习如何安装和使用 Metasploit Web 界面。稍后，我们将学习如何使用 Web 界面执行侦察并访问 Meterpreter 有效载荷。

在本章中，我们将涵盖以下主题：

+   Metasploit Web 界面简介

+   安装和设置 Web 界面

+   开始使用 Metasploit Web 界面

# 技术要求

以下是本章所需的技术要求：

+   具有 Metasploit Web 界面的 Metasploit 社区版（CE）

+   *nix 系统或 Microsoft Windows 系统

# Metasploit Web 界面简介

Metasploit Web 界面是一个基于浏览器的界面，提供了对导航菜单的轻松访问，并允许您更改任务的配置页面。您可以在 Metasploit Web 界面中执行在 Metasploit Framework（MSF）中执行的每个任务，从使用辅助程序执行发现扫描到弹出 Meterpreter。

对于那些更喜欢使用图形用户界面（GUI）工具进行渗透测试的人，可以使用 Metasploit Web 界面。Web 界面是 Metasploit CE（免费）、Metasploit Pro（付费）、Metasploit Express（付费）和 Nexpose Ultimate（付费）的一部分。与 Metasploit 的付费版本中提供的更高级功能不同，免费的 CE 是最基本的。

# 安装和设置 Web 界面

Metasploit Web 界面的安装过程非常简单。

您可以在[`www.rapid7.com/products/metasploit/download/community/`](https://www.rapid7.com/products/metasploit/download/community/)下载社区版。

开始安装过程，您需要填写下载 Metasploit CE 所需的信息。之后，您将被重定向到下载页面，如下面的截图所示：

![](img/632ebce9-7665-4d6e-9fc3-3b8c28a4c995.png)

注意：如果您不想填写表格，您可以打开一个直接链接来下载 Metasploit Web 界面，网址为[`www.rapid7.com/products/metasploit/download/community/thank-you`](https://www.rapid7.com/products/metasploit/download/community/thank-you)。

您还可以从 Rapid7 在 GitHub 上的存储库下载，但您将无法获得激活密钥。

# 在 Windows 上安装 Metasploit 社区版

要在 Windows 上成功安装，请按照以下步骤进行：

1.  首先，请确保您已在系统上禁用了反病毒软件（AV）和防火墙。 AV 通常会检测并标记 Metasploit CE 中的某些文件为恶意文件：

![](img/c434a59b-e8ba-41f8-b7d2-613677ca06e9.png)

1.  此外，请确保如果您在 Windows 上运行，请将 Metasploit 安装文件夹放入 AV 和防火墙的例外列表中。这样，您生成的有效载荷将不受 AV 的影响。

![](img/c65e1172-5e8d-4c9a-b029-5fbff6623e49.png)

1.  由于 Metasploit CE 也可以通过 Web 界面（通过 SSL）访问，请确保为 SSL 证书生成过程提供正确的服务器名称（主机名）：

![](img/e9572261-1f93-49b3-a09a-c3acdd489053.png)

1.  安装完成后，您可以检查`C:\metasploit`目录中的所有文件：

![](img/e5224e7e-4842-4199-81d3-e866ab3cf393.png)

1.  在您可以开始使用 Web 界面之前，您需要初始化用户帐户。如果尝试使用主机名而不是 localhost 访问 Web 服务器，将收到警告消息。要继续，请按照给定的说明进行：

![](img/a087dc88-6b9b-49c5-bdf5-5789f7782939.png)

1.  要初始化用户帐户，您需要在`C:\metasploit`目录中执行`createuser`批处理脚本：

![](img/2c0f5d8b-ca7e-4170-b1d6-b68e7eb2b245.png)

1.  现在只剩下最后一步了。创建用户后，您将被重定向到激活页面。要激活 CE 实例，您需要获取产品密钥，该密钥可以从注册时使用的注册电子邮件 ID 中检索（这就是注册重要的原因-这样您就可以通过电子邮件接收激活代码）：

![](img/89d86bf9-c595-4ff4-a491-f28a265adff3.png)

1.  使用您的电子邮件中的产品密钥激活 Metasploit CE：

![](img/4dc07bbb-3e50-43b0-bf20-4c40890b8bba.png)

成功激活后，您将被重定向到项目列表页面：

![](img/c87643a0-e08c-4497-83d9-c6aada60bb39.png)

在您可以开始使用 Metasploit Web 界面之前，您需要了解界面本身。

**注意：**试用密钥无法重复使用，并将在 14 天后过期。

# 在 Linux/Debian 上安装 Metasploit Community Edition

要在 Linux/Debian 上成功安装，请按照以下步骤进行：

1.  下载 Metasploit CE Linux 安装程序。您需要更改安装程序的权限为`execute`，可以使用`chmod`命令完成：

![](img/aa64bf19-a086-4d27-8f08-6759e6926d82.png)

1.  运行 Linux 安装程序，并按屏幕上显示的说明进行操作。安装完成后，将显示 Web 界面的 URI：

![](img/97643a84-c567-4dfb-b718-d5e7740e0456.png)

1.  您需要访问 URI 才能访问 Web 界面。默认情况下，URI 将是`https://localhost:3790/`：

![](img/f6c1a85a-9b1f-450e-a5fb-1d6355372254.png)

1.  一旦初始化过程和设置完成（通常需要几分钟），屏幕上将显示警告消息。按照屏幕上的说明通过诊断 shell 创建用户：

![](img/ffd5831b-1024-4c86-b7dc-e2bc71455681.png)

1.  在执行诊断 shell 后，Metasploit 环境将为您的 shell 设置，并且您可以执行`createuser`脚本。您还可以看到 Web 界面，在那里您将找到一个新用户设置页面。填写用户详细信息以创建帐户：

![](img/065b8082-5eba-4634-b9dc-b1053dd24fa6.png)

1.  从您的电子邮件 ID 获取产品密钥并激活 CE 以继续：

![](img/08b5c5bf-e746-4e2b-84dd-52e94359d91e.png)

注意：不支持 32 位 Linux（包括 Kali）和 macOS。

接下来，让我们开始使用 Metasploit Web 界面。

# 开始使用 Metasploit Web 界面

Metasploit Web 界面具有非常易于使用的界面，可以帮助对 CLI 经验较少的测试人员。在我们开始测试之前，让我们了解界面。

# 界面

Metasploit Web 界面可以分为以下菜单：

+   主菜单

+   项目标签栏

+   导航面包屑

+   任务栏

让我们逐个查看这些菜单。

# 主菜单

主菜单可以在页面顶部看到。在主菜单中，您可以从项目菜单访问项目设置，从帐户菜单访问帐户设置，并从管理菜单管理管理任务。

任何警报都可以从通知中心查看：

![](img/32413e21-5f18-42e9-b234-d4c0e7cbbe23.png)

让我们详细看一下它们：

+   **项目菜单**：用于从项目菜单创建、编辑、打开和管理项目。

+   **帐户菜单**：用于管理帐户信息，例如更改密码、设置时区和联系信息。

+   **管理菜单**：用于进行任何管理更改，如更新系统、许可密钥、编辑用户帐户和配置全局设置。

+   **通知中心**：在通知中心，您将找到所有警报，表示任务已完成或软件更新已提供。单击警报将显示下拉菜单，其中包含所有项目的最新警报。

接下来，我们将看一下项目选项卡栏。

# 项目选项卡栏

项目选项卡栏是位于主菜单正下方的选项卡菜单。可以从该选项卡菜单管理正在运行的项目、漏洞分析、已打开的 Meterpreter/shell 会话、网络钓鱼活动、Web 应用程序测试、模块、凭证、报告、导出和任务：

![](img/ea92a539-22a4-4a1f-8273-474d90aa1595.png)

让我们详细看一下它们：

+   概述：显示高级图形信息，如发现的主机和服务数量以及会话和凭证数量。在运行扫描或导入主机之前，这些信息不会显示。

+   分析：此选项卡允许我们将大型网络/主机分类为组，这样我们就可以更容易地管理和利用它们。

+   会话：会话选项卡显示了我们在目标上的活动会话。

+   活动：此选项卡允许我们在一组目标上创建、管理和运行社会工程活动，包括电子邮件、网页、便携文件等。

+   Web 应用程序：这是专业版功能，允许我们扫描 Web 应用程序并识别漏洞。

+   模块：此选项卡允许我们搜索可用模块、查看它们的信息，并在目标上执行它们。

+   凭证：此选项卡允许我们添加/编辑或删除通过利用收集到的凭证。

+   报告：这也是专业版功能。此选项卡允许我们查看并创建我们的发现报告。

+   导出：此选项卡允许我们将数据（如凭证）导出为多种格式，如 XML 和 ZIP。

+   任务：此选项卡允许我们管理工具当前正在运行的任务的状态。

接下来，我们将看一下**导航面包屑**。

# 导航面包屑

您可以使用**导航面包屑**来确定项目中的当前位置：

![](img/c5e04b77-31d8-4eba-91d9-efad7faac501.png)

这可以帮助我们更高效地工作。

# 任务栏

您可以使用**任务栏**快速执行列出的任务，如下图所示：

![](img/705b40f9-9aef-4f86-8703-c9c20965121e.png)

接下来，我们将看一下项目创建。

# 项目创建

就像 Metasploit 使用*工作空间*来组织已收集的数据一样，CE 使用*项目*来分隔数据集。默认情况下，CE 内部有一个默认项目。如果您不创建自定义项目，您所做的一切都将保存在此项目下。

# 默认项目

每当我们使用 Web 界面时，使用的第一个项目将是“默认”项目。该项目将显示我们扫描的主机数量、维护的会话数量以及在“默认”项目处于活动状态时分配给主机的任务数量。下图显示了名为“默认”的列出项目：

![](img/bc5b7411-097a-4287-86a8-6580d89b8e0b.png)

接下来，让我们学习如何创建我们自己的自定义项目。

# 创建自定义项目

Metasploit CE 还允许我们创建自己的自定义项目：

1.  这可以通过单击“项目”菜单并选择“新建项目”来完成。这将带我们到下图所示的页面。在这里，我们将指定项目详细信息，如项目名称、描述和网络范围：

![](img/fbe883c9-782a-4302-9387-ad22c243c064.png)

1.  单击“创建项目”按钮后，您将进入项目仪表板页面。在这里，您将看到不同的部分，显示迄今为止执行的任务的摘要及其结果：

![](img/afba9d3f-f40d-4050-8dd4-626e3a7b89f7.png)

1.  返回主页，您应该能够看到两个项目。一个称为`default`，另一个称为`Web Exploitation Project`，这是我们刚刚创建的：

![](img/4ee56451-c1da-4feb-b94e-f3b43a76ae9e.png)

接下来，让我们开始枚举。

# 目标枚举

现在我们已经创建了我们的项目，让我们从第一步开始-枚举。执行枚举有两种方法：使用 Metasploit 的内置扫描模块，或者导入由 Nmap 或其他 MSF 支持的工具完成的扫描。

# 使用内置选项

Metasploit web 界面为我们提供了一些内置的选项/模块，我们可以使用这些选项/模块对目标系统执行枚举。按照以下步骤使用内置选项执行枚举：

1.  要使用内置选项，请从项目仪表板单击扫描按钮，如下截图所示：

![](img/b286700f-1c79-475e-bd22-7b66da7ff39a.png)

1.  在下一页中，我们输入要扫描的 IP 地址。我们还为扫描定义了高级选项，例如要排除的端口和自定义范围：

![](img/bba34673-bc4f-4aa6-8881-5bac22f1d21d.png)

1.  单击“显示高级选项”按钮可以设置扫描的一些扩展功能：

![](img/64125184-9795-4d54-88fe-852d7a84427b.png)

1.  一切设置好后，您可以单击“启动扫描”按钮。该工具将以您指定的选项在后台启动 Nmap 扫描，如下截图所示：

![](img/29e320ae-6746-45d9-a540-d08272e28f3b.png)

1.  您可以通过单击项目菜单 -> [工作空间] -> 主机来查看主机：

![](img/32b708bc-ff21-43a5-ba09-57eda3f9fb48.png)

如下截图所示，扫描的主机已添加到主机列表中：

![](img/fc1ade70-4e86-4759-a334-f6dbe90ae0f2.png)

1.  要查看扫描主机上运行的服务，您可以单击上一步中显示的主机，或者您可以打开项目菜单 -> [工作空间] -> 服务：

![](img/d0483bf2-9809-478d-bd01-d60f09547354.png)

在两种情况下，您都可以看到扫描主机上运行的服务。但是，不建议通过 Web 界面执行扫描，因为它使用的是相当古老的 Nmap 版本 4。

# 导入扫描结果

或者，我们也可以使用第三方工具执行枚举。然后，可以将工具的结果导入到 MSF 中。按照以下步骤导入扫描结果：

1.  在使用 Metasploit 进行利用之前，最好先进行端口扫描和服务枚举。您可以使用 Nmap 单独进行扫描，并使用`-oX`开关以 XML 格式保存扫描结果，而不是使用 Metasploit 的内置端口扫描程序：

![](img/8844d50f-3488-45ce-8726-db827425b59f.png)

1.  就像在`msfconsole`中使用的`db_import`命令一样，您可以通过单击导入按钮在 Metasploit web 界面中使用相同的功能：

![](img/fcc57c8f-a066-4fd0-86ff-c53d6e074be9.png)

1.  单击导入按钮后，您将被重定向到导入数据页面，在那里您将有选项导入您的数据。

1.  您可以从 Nexpose、Sonar（Sonar 项目是 Rapid7 进行的安全研究项目，通过不同的服务和协议在全球范围内进行互联网调查，以获得有关常见漏洞全球暴露情况的见解）和第三方扫描工具（如 Acunetix、Nessus、Nmap 等）支持的文件中导入数据。在这种情况下，我们进行了全端口扫描，并将 Nmap 结果以 XML 格式保存：

![](img/9896db7b-2116-411c-94d4-45f279d2036d.png)

1.  作为一个可选功能，您可以启用自动标记，根据其操作系统，它将主机标记为`os_windows`、`os_linux`和`os_unknown`。单击“导入数据”，扫描将被导入：

![](img/b90f6536-e600-4731-bf5b-5699c2c4763b.png)

1.  您可以返回到项目概述菜单，查看更新后的项目空间：

![](img/4ff0579a-a156-41ac-9762-8707359fcd2f.png)

1.  如前面的屏幕截图所示，添加了一个新主机，上面运行了 15 个服务。单击检测到的 15 个服务的超链接，将显示服务页面。

1.  您可以通过单击**项目**菜单 -> [工作空间] -> 服务来查看相同的页面：

![](img/0a0f513e-da8b-4986-883c-e27c8a093c16.png)

在下一节中，您将了解用于进一步枚举和利用目标主机的 Metasploit 模块。

注意：以下是所有支持的第三方扫描报告，可以导入：**Foundstone Network Inventory XML, Microsoft MBSA SecScan XML, nCircle IP360 XMLv3 and ASPL, NetSparker XML, Nessus NBE, Nessus XML v1 and v2, Qualys Asset XML, Qualys Scan XML, Burp Sessions XML, Burp Issues XML, Acunetix XML, AppScan XML, Nmap XML, Retina XML, Amap Log, Critical Watch VM XML, IP Address List, Libpcap Network Capture, Spiceworks Inventory Summary CSV, **和** Core Impact XML.**

# 模块选择

Metasploit CE 中使用的模块与 MSF 中使用的模块相同。根据情况，我们可以使用辅助模块、利用模块或后利用模块。让我们先看看辅助模块。

# 辅助模块

在这种情况下，我们有一个目标主机，IP 为`192.168.2.17`。您可以在以下屏幕截图中看到在此主机上运行的服务：

![](img/416f774c-30c4-4d0d-b281-b9b4e9f624e9.png)

从网络渗透测试的角度来看，攻击者肯定会研究端口`445/tcp`（SMB）以进行利用，因此让我们使用 SMB 模块：

1.  点击**项目**选项卡中的模块选项卡以显示模块页面：

![](img/fb401e53-2d4c-4899-8dea-654b544a87a7.png)

1.  对于 SMB，您可以使用 SMB 版本检测辅助模块，可以使用搜索栏搜索：

![](img/8e5f2a7b-456b-4c95-95f8-b554cb930121.png)

1.  选择模块后，将显示模块选项页面。您可以设置目标地址，以及其他一些选项（如果需要）：

![](img/d29dad9c-1d3e-4fff-a0d7-ed57903dbfab.png)

1.  点击“运行模块”（如前面的屏幕截图所示）将执行该模块，并显示模块的输出：

![](img/3ec6cd12-2c56-4206-b2d6-987d86efd88b.png)

1.  您可以通过转到**项目**选项卡 -> 分析 -> 注释来确认模块找到的结果：

![](img/788c3d2f-b59d-48f2-90e6-5071892b8d04.png)

枚举目标后，您可以使用利用模块。

# 使用利用模块

要使用利用模块，请按照以下步骤进行：

1.  点击**项目**选项卡上的模块选项卡，搜索`EternalBlue` exploit。这是一个非常可靠的利用，可以在这种情况下使用：

![](img/9c581e9c-6032-4de1-82f0-ce0f1de17d8d.png)

1.  在这里，您可以设置目标地址和有效载荷选项。执行利用后，有效载荷（比如说，Meterpreter）将被注入内存，并且将打开一个 Meterpreter shell：

![](img/fe3acb1b-ad29-40f5-96c3-3bc827b42429.png)

1.  点击“运行模块”将启动利用模块。结果将显示在屏幕上，并为任务分配一个任务 ID：

![](img/59355723-3128-43bf-bde6-9f7e22dcd626.png)

成功利用后，您将收到有关新打开会话的通知。

# 会话交互

成功利用后，会打开一个会话，并且您将在**项目**选项卡上收到通知：

1.  要查看已打开的会话，您需要点击**项目**选项卡中的**会话**选项卡：

![](img/8f3423bd-6575-4e9a-8169-e32abf70723f.png)

1.  与任何打开的会话进行交互，只需点击“会话[ID]”，如前面的屏幕截图所示。MSF Web 界面支持的会话交互功能可以在以下屏幕截图中看到：

![](img/4b9d87e3-01da-4b7e-80bd-f8601adca775.png)

以下是您可以用于会话交互的选项：

+   **收集系统数据**：此选项将允许您收集系统证据和敏感数据，如密码、系统信息、屏幕截图等。此功能仅在 Metasploit Pro 版本中可用。

+   **虚拟桌面**：此选项将注入**虚拟网络计算**（**VNC**）DLL，并在给定端口上启动 VNC 服务：

![](img/d66b8562-2ee0-40b4-8126-9f1775719fe8.png)

您可以通过此端口与目标系统上运行的桌面进行交互：

![](img/1f3a09f9-51d8-462f-bb63-6849a0e8c21e.png)

注意：用户将收到 VNC 连接的通知。

+   **访问文件系统**：使用此选项，您可以浏览文件系统。您甚至可以上传、下载和删除文件：

![](img/be7c6ada-12c5-4dee-8469-066f5d375311.png)

+   **搜索文件系统**：如果您想要搜索特定文件或执行通配符搜索，可以使用此选项：

![](img/27986ef9-9936-425f-aa58-9ef681ad4978.png)

+   **命令行 Shell**：如果您想要访问 Meterpreter 命令行 Shell，可以单击此按钮打开命令行 Shell：

![](img/120f6bd2-d353-477a-bbf5-1b7ea2d739ea.png)

您可以在给定的输入框中执行命令。结果将显示如下：

![](img/183652fe-4998-4768-9951-a5e4deea65b6.png)

此窗口仅支持 Meterpreter 命令。可以使用`shell`命令运行系统命令：

![](img/a858add3-1918-4146-87bc-00640fa8bfb4.png)

+   **创建代理枢纽**：创建代理枢纽与添加枢纽路由相同：

![](img/b7d20321-c0e8-4e77-9665-f15721ba7421.png)

您可以使用此选项，如果您想要连接到内部网络进行进一步的利用：

![](img/bd6036ff-5ca7-412f-b39f-95dc2fe51d96.png)

+   **创建 VPN 枢纽**：此选项将允许您在受损的计算机中创建一个加密的二层隧道，然后通过目标机器路由任何网络流量。这将授予您完整的网络访问权限，就像您在本地网络上一样，没有周边防火墙来阻止您的流量。

+   **更改传输**：要更改会话的传输机制，可以使用此选项，如下图所示：

![](img/98b7985d-d9ab-4369-a7be-7fef82c16736.png)

首先，您需要为特定传输启动处理程序；否则，该过程将失败。

+   **终止会话**：一旦使用此选项，会话将被终止。要与会话交互，您将需要重新开始利用过程。

接下来，让我们看看 Web 界面中可用的后渗透模块。

# 后渗透模块

对于后渗透，您可以使用界面中可用的后渗透模块，如下图所示：

![](img/da9411fe-a8f0-4f8e-8a75-aedf2aff5cc5.png)

1.  对于前面截图中显示的目标，让我们使用`hashdump`后渗透模块。要使用此模块，只需检查模块需要执行的会话：

![](img/98d1a906-33a2-4155-9aef-4006d6d807cf.png)

1.  单击“运行模块”以执行`hashdump`模块。此模块将从 SAM 数据库中转储 NTLM 哈希。此模块将被分配一个新的任务 ID。您可以在任务栏中检查任务：

![](img/45e0e625-5b38-422e-bcbc-a6b3cb3dd286.png)

1.  提取的哈希可以在**项目**选项卡栏的凭据菜单中查看：

![](img/7ea33316-97f7-48c3-8ae8-4d7fb1d5e59d.png)

您可以使用不同的后渗透模块，具体取决于情况。

# 总结

在本章中，我们讨论了 MSF 的 Web 界面。我们首先安装了 Metasploit 并设置了其配置。然后，我们继续讨论模块，如创建项目和从不同工具导入扫描结果。之后，我们查看了辅助和利用，然后学习了 Metasploit Web 界面中可用的后渗透模块。

在下一章中，我们将学习如何使用 Metasploit 对不同类型的目标、协议和端口进行侦察。

# 问题

1.  Metasploit web 界面具有哪些功能？

1.  在我的组织中，我必须在使用的任何 Web 服务器上使用公司的 SSL 证书。我可以为 Metasploit web 界面提供自定义 SSL 证书吗？

1.  哪些 Web 浏览器与 Metasploit web 界面兼容？

1.  Metasploit 支持 RESTful API 吗？

1.  Metasploit web 界面支持自定义报告吗？

# 进一步阅读

有关 Web 界面的更多信息，请访问官方文档页面[`metasploit.help.rapid7.com/docs/metasploit-web-interface-overview`](https://metasploit.help.rapid7.com/docs/metasploit-web-interface-overview)。
