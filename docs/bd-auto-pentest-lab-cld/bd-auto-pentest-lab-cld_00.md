# 序言

随着全球越来越多的组织将其数据和工作负载迁移到云端，工程团队以及安全专业人士面临着在生产环境中防范日益增多的与云相关的威胁和风险的复杂任务。这导致了对能够攻击和防御云应用程序和系统的安全专业人员的需求激增。寻求职业发展并希望在职业生涯中脱颖而出的安全专业人士应该学会如何在云中建立各种类型的易受攻击的实验环境，以进一步磨练他们的技能。

我写这本书是为了帮助您和其他专业人士设计、构建和自动化运行在**亚马逊网络服务**（**AWS**）、**微软 Azure**和**谷歌云平台**（**GCP**）上的渗透测试实验室环境。您将学习如何使用**基础设施即代码**（**IaC**）解决方案和策略自动化准备和配置云资源。您将有机会利用**生成式人工智能**工具的潜力，显著加速构建和自动化易受攻击的实验环境的过程。除此之外，您还将学习如何使用各种攻击性安全工具和技术来验证和测试我们基于云的实验室中的漏洞和配置错误。

通过本书，您应该能够在多个云平台上构建和自动化各种类型的渗透测试实验室，从而可以练习和尝试不同类型的攻击和技术。

# 本书适合对象

本书旨在面向安全工程师、云工程师和有志于学习更多有关渗透测试、云安全和基础设施自动化的安全专业人士。它强调了使用**基础设施即代码**解决方案以及**生成式人工智能**工具，加速在`AWS`、`Azure`和`GCP`上准备易受攻击的实验环境。如果您计划在云安全领域发展自己的职业，并希望学习如何管理在云中构建和管理黑客实验环境所涉及的复杂性、成本和风险，那么这本书适合您。

# 本书涵盖内容

*第一章*，*开始使用云中的渗透测试实验室*，介绍了帮助您开始构建云中渗透测试实验室的关键概念。在本章中，我们还将研究在云中构建这些易受攻击的实验环境时涉及的考虑因素和风险。

*第二章*，*准备我们的第一个易受攻击的云实验室环境*，让您通过在云中设置和配置您的第一个易受攻击的实验环境来入门。

*第三章*, *成功使用基础设施即代码工具和策略*，详细介绍了如何使用 IaC 解决方案自动构建渗透测试实验室环境。

*第四章*, *在 GCP 上设置隔离渗透测试实验室环境*，展示了如何使用正确配置的网络环境将脆弱的实验室资源与外部未授权攻击隔离和保护。在这个安全的网络环境中，我们将设置一个目标虚拟机实例，托管一个故意存在漏洞的 Web 应用程序，名为 OWASP Juice Shop。除此之外，我们还将启动一个攻击者虚拟机实例，并将其配置为通过浏览器访问其桌面环境。

*第五章*, *在 Azure 上设置隔离渗透测试实验室环境*，介绍了如何在 Azure 上设置和自动化一个隔离的渗透测试实验室环境。在本章中，我们将构建一个实验室，练习容器突破技术，以便未经授权访问主机系统。此外，我们还将讨论如何滥用 Azure 中的托管身份，以获得对其他云资源的未授权访问。

*第六章*, *在 AWS 上设置隔离渗透测试实验室环境*，重点讲解如何在 AWS 上构建和自动化隔离的渗透测试实验室环境的准备工作。在本章中，我们将准备一个实验室环境，练习可以使用初始被攻破的机器访问内部系统和网络的枢纽技术。

*第七章*, *设计和构建 IAM 权限提升实验室*，展示了如何在 AWS 上设置一个脆弱的 IAM 权限提升实验室环境。在本章中，我们还将首次了解如何使用生成性 AI 解决方案生成代码，用于渗透测试模拟。

*第八章*, *设计和构建脆弱的 Active Directory 实验室*，重点讲解如何在 Azure 上设置一个脆弱的 Active Directory 实验室。在这里，我们还将学习如何使用各种工具，如 Kerbrute、Impacket 和 John the Ripper，来验证和评估渗透测试实验室环境是否已正确设置和（误）配置。

*第九章*, *推荐的策略和最佳实践*，介绍了改善和增强前几章中讨论的实验室环境的最佳实践和技术。在本章中，我们还将深入探讨如何使用生成性 AI 工具来创建 IaC 模板代码、进行基础设施成本估算和开发自动化脚本。

# 为了最大化本书的学习效果

你需要一个 AWS 账户、一个 Microsoft Azure 账户、一个 GCP 账户以及一个 ChatGPT（即 OpenAI）账户，并且需要稳定的互联网连接，才能完成本书中的动手实验。

| 本书中涵盖的软件/硬件 | 操作系统要求 |
| --- | --- |
| Chrome/Firefox/Safari/Edge/Opera（或其他替代浏览器） | Windows/macOS/Linux |

**如果你使用的是本书的数字版，我们建议你自己输入代码或通过本书的 GitHub 仓库访问代码（下一节将提供相关链接）。这样做可以帮助你避免与复制粘贴代码相关的潜在错误` `。**

# 下载示例代码文件

你可以从 GitHub 下载本书的示例代码文件，链接为 [`github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud`](https://github.com/PacktPublishing/Building-and-Automating-Penetration-Testing-Labs-in-the-Cloud)。如果代码有更新，它会在 GitHub 仓库中更新。

我们还有其他来自丰富书籍和视频目录的代码包，可以在 [`github.com/PacktPublishing/`](https://github.com/PacktPublishing/) 上找到。快来看看吧！

# 使用的约定

本书中使用了许多文本约定。

**文中的代码**：表示文本中的代码词汇、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟网址、用户输入和 Twitter 账号。例如：“确保将`<ATTACKER VM PUBLIC IP ADDRESS>`替换为运行`terraform apply`命令后得到的`attacker_vm_public_ip`输出值。”

代码块如下所示：

```
 module "attacker_vm" {
  source = "./attacker_vm"
}
```

当我们希望引起你对代码块中特定部分的注意时，相关的行或项目会以粗体显示：

```
 module "attacker_vm" {
  source = "./attacker_vm"my_public_ssh_key = var.my_public_ssh_key source_image_id = var.kali_image_id rg_location = module.secure_network.rg_02_location rg_name = module.secure_network.rg_02_name subnet = module.secure_network.subnet_02 asg = module.secure_network.asg_02 nsg = module.secure_network.nsg_02 }
```

**粗体**：表示新术语、重要词汇或屏幕上显示的词语。例如，菜单或对话框中的词汇会以**粗体**显示。示例：“在最后一个标签页（**EC2 串行控制台**）中，点击**连接**按钮通过 EC2 串行控制台访问实例。”

提示或重要说明

如下所示。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果你对本书的任何部分有疑问，请通过电子邮件与我们联系：customercare@packtpub.com，并在邮件主题中提及书名。

**勘误表**：尽管我们已尽最大努力确保内容的准确性，但难免会出现错误。如果你在本书中发现任何错误，我们非常感谢你向我们报告。请访问 [www.packtpub.com/support/errata](https://www.packtpub.com/support/errata) 并填写表格。

**盗版**：如果你在互联网上发现我们的作品的非法复制版本，烦请提供该材料的地址或网站名称。请通过 copyright@packtpub.com 与我们联系，并附上该材料的链接。

**如果您有兴趣成为作者**：如果您擅长某个话题，并且有兴趣撰写或参与书籍的创作，请访问 [authors.packtpub.com](https://authors.packtpub.com)。

# 分享您的想法

在阅读完*《云端渗透测试实验室的构建与自动化》*后，我们非常希望听到您的反馈！请[点击这里直接进入亚马逊的评论页面](https://packt.link/r/1837632391)并分享您的想法。

您的评价对我们和技术社区非常重要，将帮助我们确保提供高质量的内容。

# 下载本书的免费 PDF 副本

感谢购买本书！

您是否喜欢在路上阅读，但又无法随身携带纸质书籍？

您的电子书购买是否与您选择的设备不兼容？

不用担心，现在购买每本 Packt 书籍，您都会免费获得该书的无 DRM PDF 版本。

在任何地方、任何设备上随时阅读。搜索、复制并将您最喜欢的技术书籍中的代码直接粘贴到您的应用程序中。

福利不仅仅是这些，您还可以获得独家的折扣、新闻通讯以及每天直接发送到您邮箱的精彩免费内容。

按照这些简单的步骤来获取福利：

1.  扫描二维码或访问以下链接

![](img/B19755_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781837632398`](https://packt.link/free-ebook/9781837632398)

1.  提交您的购买凭证

1.  就是这样！我们会直接通过电子邮件向您发送免费的 PDF 和其他福利。

# 第一部分：易受攻击设计环境简明介绍

本部分将介绍如何在云端构建和自动化渗透测试实验室的关键概念。

本部分包含以下章节：

+   *第一章*，*云端渗透测试实验室入门*

+   *第二章*，*准备我们的第一个易受攻击的云实验室环境*

+   *第三章*，*成功使用基础设施即代码工具和策略*
