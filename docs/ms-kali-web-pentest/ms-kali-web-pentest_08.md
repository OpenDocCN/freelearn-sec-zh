# 第九章：压力测试认证和会话管理

如果攻击者能够找到或表现得像合法用户，并且应用程序相信他，那么任何下游保护都无法阻止非法操作。在第八章 *通过加密测试利用信任*中，我们看到攻击者如何拦截并经过一些努力——代理或即时解密信息。要使这些攻击生效，需要发生很多事情，而攻击者可能会被网络防御或警觉的用户注意到。应用程序使用的认证是另一回事。用户不断向 Web 应用程序和安全团队施压，以简化和改进登录体验，而这种压力往往直接冲突于应用程序的安全性。因为应用程序所有者不愿意推动用户使用更新的硬件和软件，经历任何中断或冗长的登录过程，并放弃访问自由和多任务处理能力，他们通常设计应用程序以适应更不安全、更常见的客户端配置文件。应用程序登录和会话管理流程一直很慢地采用措施，以防止导致最近历史上一些最大的入侵事件的许多缺陷。

会话管理的诞生是为了使安全性更加灵活。用户不喜欢通过**虚拟专用网络（VPN）**隧道连接，因此 Web 应用程序已经从使用唯一的会话密钥发展到认证 cookie，现在是认证令牌，每个都允许用户持续访问和服务器跟踪有状态信息。这在初始认证后是一个巨大的帮助，因为它允许 HTTP 在不断证明其身份的麻烦下扩展其使用。对于黑客来说，会话管理方法现在是他们可以打败的机制——拥有凭据不再是劫持会话或冒充用户的必要条件。

认证和会话管理漏洞通常是协调的入侵行动的第二层。虽然其他妥协会在目标环境中启用初始的“海滩头”，但在环境中使用用户存储的暴力破解通常是允许攻击者通过横向移动和特权升级来保持访问的关键部分。与企业使用**轻量级目录访问协议（LDAP）**、微软**活动目录（AD）**或其他身份存储不同，Web 门户通常经过大量定制，购买时很少或从未得到适当的加固。这就是我们将要操作的地方——暴露目标环境认证的所有裂缝。在本章中，我们将看到各种形式的认证是如何执行的，以及如何最好地测试它们。在这个过程中，我们将了解以下主题：

+   学习基本、基于表单或摘要的 HTTP 认证是如何实现的，以及每种方法的优缺点

+   使用 Burp Suite 的 Intruder 模块来规避这些认证墙

+   讨论**双因素认证**（**2FA**）的影响以及克服它的方法

+   了解功能级访问控制的工作原理，如何可能被错误配置，以及如何通过伪造来利用

+   讨论暴力破解和字典攻击的可能性

## 敲敲，谁在那里？

* * *

认证是确定某人是谁的艺术，并且要有确定性地这样做。自从互联网出现以来，这个过程变得很危险，因为处理不当的后果可能会危及其他环境。尽管潜在影响很大，但这种风险通常被非安全人员忽视——用户的便利性再次导致了安全上的放松。OWASP 将其列为网络安全中最紧迫的威胁之一，并将威胁描述为具有严重影响，如下截图所示：

![](img/B03918_09_01.png)

OWASP 对破损的认证和会话管理的总结

### 认证必须很难吗？

大多数认证方法都以这样一个前提开始，即通常有不同特权级别的有效用户需要访问某些内容。现在，我们如何确认他们是他们所说的人？这些所谓的**凭据**在很大程度上类似于物理安全措施。正确的人既看起来像他们所说的人，而且希望有适当的钥匙或回答挑战的答案。过去，基于用户名和密码的认证是完全可以接受的，但现在我们已经到了这样一个程度，即这种有缺陷的单因素方法已经不能保证连接的客户是可信的。

近年来，网站和应用程序已经纳入了所谓的 2FA，以提高忠诚度。 2FA 在所需的认证检查中添加了第二因素，大大降低了窃取凭证成功获得非法访问的可能性。这些因素通常被描述为你是谁（例如用户名或电子邮件）、你知道的东西（密码或口令）和你拥有的东西（通常是软令牌、RSA 密钥或其他**一次性密码**（**OTP**））。在前提认证使用中，我们甚至看到指纹、视网膜扫描和其他生物识别技术的使用。再加上安全问题、**CAPTCHA**或其他图片验证技术，甚至证书，我们可以理解为什么这足以使寻求便利的用户不知所措，而不是进行测谎测试。

以下是一般认证方法的截图：

![](img/B03918_09_02-1.png)

网站的一般认证方法

### 认证 2.0 - 抢夺一个金奖券

如果您熟悉罗尔德·达尔（Roald Dahl）的著作《查理和巧克力工厂》，您会知道孩子们在糖果中找到的**金奖券**为他们打开了一些非常独特的大门，并帮助查理·巴克特赢得了最终的奖品。虽然我们的目标可能不会给受害者糖果，但他们正在发放自己的*券—*提供持续和特权访问的令牌。对我们来说，诀窍在于了解如何利用这一点。

为了解决用户群体繁重的认证问题，需要不断发展解决方案。最初的尝试是将用户与会话关联起来，网页开发人员将唯一的会话 ID 代码嵌入后认证数据包中，以便记住用户、跟踪他们的活动并提供持续访问。这些有状态的密钥是不受保护的，有时仍然是不受保护的；黑客要么窃取和重复使用这些密钥，要么使用**会话固定**来欺骗用户，使其认可攻击者创建的会话 ID 或令牌，使用包含会话 ID 的恶意重定向，然后进行认证。保护这些 ID 的努力已经取得了长足的进步，我们现在看到使用加密令牌，这些令牌既模糊了令牌本身，甚至还使用客户端脚本来帮助确保关系的完整性。

### 注意

无论可用的对策如何，应用程序开发人员都是习惯动物，他们会使用 cookie 和令牌来携带各种敏感信息。听起来像是渗透测试员要解决的有趣问题！

通常使用三种方法来提取和传输凭据：基本身份验证、基于表单的身份验证和基于摘要的身份验证。下表帮助我们了解每种方法的优势、劣势、应用和特殊注意事项：

|  | **优势** | **劣势** | **典型应用** |
| --- | --- | --- | --- |
| **基本** | 通常是 SSL/TLS 加密的。 | 如果没有适当加密，容易受到客户端脚本的攻击和捕获 |

+   Web API

+   移动应用程序持久性

|

| **基于表单的** | 对用户干扰最小 | 这最有可能是不受保护的，推断数据库内容，或者暴露未使用的字段 |
| --- | --- | --- |

+   网站和门户的传统凭据挑战。

|

| **基于摘要的** | 基本 + 机器哈希 | 这相对安全 - 在当前技术水平下是最好的 |
| --- | --- | --- |

+   Web API

+   移动应用程序持久性

|

让我们看看用户在他们端看到的内容，然后我们可以开始攻击！

#### 基本身份验证

一些网站允许用户凭据通过 HTTP 请求本身中专门用于此目的的字段传递到认证的 Web 服务器。这被称为基本身份验证，可以通过用户输入或更常见的是通过在客户端脚本或浏览器插件中实现的预配置配置文件来配置。虽然这似乎是一种容易受到攻击的方式，但如果做得正确，该机制通常受到 TLS 加密的保护，并且实体都在利用证书来提供更大的确定性。这在**应用程序编程接口**（**API**）和操作员和支持人员使用的企业内部网络应用程序中非常常见，一些移动应用程序也会使用这种技术来保持对其服务器的安全访问。

#### 基于表单的身份验证

尽管存在基本身份验证，大多数用户将熟悉不同形式的默认用户界面。基于表单的身份验证对用户将会是相当直观的。向客户端发出的身份验证挑战是一个表单，通常需要用户名或电子邮件地址，至少需要一个密码或口令。在大多数情况下，没有对服务器进行验证和身份验证--基于表单的身份验证假设服务器是一个受信任的设备。这是攻击者倾向于利用的一个重大弱点。

用户提供的变量在提交时实际上是作为与 HTTP 请求本身相关的带外执行的，作为一些封装数据而不是使用内置的 HTTP 身份验证规定。黑客也会发现这些提交值值得攻击，因为单个用户的有效凭据可以提供足够的空间，使他们能够发起一系列其他攻击并避开几层保护，伪装成真正的经过身份验证的用户。

#### 基于摘要的身份验证

基于摘要的身份验证采用基本身份验证的基本原理，但应用 MD5 哈希和一个一次性码，希望比单独的基本身份验证提供更高的安全性。一次性码就像是一次性密码的机器版本--一个只能应用一次并且只有一次有效的数字，使哈希免受重放攻击的影响。

### 信任但要验证

公众对简单凭据身份验证的局限性的认识终于开始赶上，因为现在许多人现在需要在他们的身份验证过程中使用额外的因素。双因素认证现在已经成为主流，虽然它起初是在企业 VPN 使用中出现的，但现在已经传播到各种应用程序甚至是消费者产品和服务。谷歌、Dropbox、Facebook 以及它们的竞争对手--现在都提供不同形式的双因素认证来帮助保护他们的用户并减少公司的负面曝光。以下是一些额外因素（不仅仅是密码）：

+   硬件令牌：作为最早的措施之一，由几家公司提供的硬件令牌专门发放给员工或承包商，并显示出提供第二因素的时间代码。随着其他更容易部署的机制的兴起，这些硬件令牌已经逐渐减少了。

+   一次性密码（通过受信任的设备）：今天在消费者和企业应用程序中得到广泛使用（如下图中的 Dropbox），这种技术是硬件令牌的软件版本。除了通过短信、短信或电子邮件提供代码外，许多应用程序还允许将它们的一次性密码与 Google Authenticator、PingID 等应用程序同步。

![](img/B03918_09_03.png)

Dropbox 2FA in action

+   智能卡：这些卡通常出现在更严格的环境中（政府、国防等），在这些环境中，不仅需要防止对应用程序的访问，还需要防止对运行该应用程序的工作站或设备的访问。通常情况下，使用智能芯片的卡，还有使用 USB dongles、磁性令牌和老式的机械钥匙的实现。

+   生物识别：作为 2FA 的最新补充，生物识别扫描和测试长期以来一直是物理访问控制的关键元素。常见的测试包括指纹或手印扫描、视网膜扫描、语音识别，现在甚至连面部识别也开始悄悄地出现。一些移动设备制造商和现在的金融应用程序正在利用面部和语音识别来解锁设备，并为移动应用程序提供额外的因素。

与前述方法相比，以下额外信息的安全性要低得多，这些信息通常被传统应用程序或自定义认证门户使用，以阻止暴力破解尝试或模糊测试。话虽如此，这些方法也经常受到攻击者的攻击，因为它们都是社会工程攻击的常见素材，很容易从相关信息泄漏中提炼出来，缺乏时间敏感性，有时在暗网上作为被破坏的账户列表的一部分可获得。如果正在使用这些方法，它们应该是前述更加严格的 2FA 方法的补充：

+   安全问题：通常来自常见选项列表的一个或多个问题是典型的，考虑到多年来这些问题已经被用于攻击验证，它们在暗网的泄漏中几乎和用户名本身一样普遍。用户经常在多个服务中类似地回答这些问题，这些问题通常是账户恢复过程的一部分。如果攻击者猜到答案或购买答案，就有很大可能发生重大的多站点违规行为。

+   图片回忆：一些应用程序将更传统的凭据与记忆图片结合起来，要求用户从随机场景或对象中进行选择，并期望用户记住这些内容以供将来登录。这种保护还可以防止自动暴力破解尝试和模糊测试，因为需要进行空间输入。人类行为是什么样子，用户会选择代表他们兴趣的图片。社会工程可以极大地提高猜测的机会。

+   账户信息：最早的*增强*认证形式之一是要求门户网站从账户号码、地址或电话号码中请求数字。我希望这是不言而喻的，但如果这是我们客户对 2FA 的理解，他们急需进行一些有效的渗透测试，并随后指导正确的安全性。

## 这就是你要找的会话

* * *

现在我们已经看到了 Web 应用程序开发人员试图让我们的工作变得困难的所有方法，让我们看看我们如何测试他们的工作。我们将看到我们可以攻击信任链的几个地方，测试会话管理机制的弹性，并学会克服它们。

### 吃点饼干？

大多数攻击者和渗透测试人员会发现，会话信息的松散管理通常是入侵应用程序的最简单途径。 Cookies 是会话信息的一个相当广泛的术语，拦截和篡改这些信息可能会带来意外收获。 Burp Suite 非常适合使用其**代理拦截**和**重复器**功能来帮助进行此操作。对于这个测试，我们将通过 Firefox 登录到我们的**Mutillidae**（OWASP Broken Web App VM）应用程序的**`A2 - Broken Authentication and Session Management`** | **`Privilege Escalation`** | **`Login`**页面（如下截图所示）：

![](img/B03918_09_04.png)

选择 Mutillidae 会话管理实验

对于这个测试，让我们继续使用我们之前刚好找到的一些凭据（通过社会工程或第七章中涵盖的各种方法，*注入和溢出测试*）并在用户名和密码中输入`user`。一旦我们经过身份验证，我们将打开**代理拦截**并刷新页面，允许我们捕获 HTTP 消息（如下截图所示）以及它们包含的 cookie 数据。

![](img/B03918_09_05.png)

寻找模糊的 cookies

我们可以很清楚地看到，Web 开发人员试图在 cookie 中做很多事情，但不知何故忘记了保护它。我们可以看到我们会话的用户名、用户 ID（`uid`）和 PHP 会话 ID（`PHPSESSID`）都包括在内，而且似乎会话没有关联的超时（`max-age=0`）。让我们将这个请求传递给我们的 Burp Repeater，看看我们能造成什么样的破坏。右键单击事件，然后单击**`Send to Repeater`**将请求加载到**`Repeater`**工具中；单击它现在突出显示的选项卡，并选择**`Params`**选项卡，以显示以下截图中的选项：

![](img/B03918_09_06.png)

使用 Repeater 工具进行 cookie 操作

正如你所希望的那样，cookie 本身的参数可以被改变（由橙色字段标出）。我们还可以添加或删除（使用绿色标出的适当按钮）cookie 的部分，以确定它们对会话完整性的重要性和影响。当我们逐步进行修改时，我们可以查看右侧（在**`Response`**部分的**`Render`**选项卡中）来查看我们操纵的最终结果（在这种情况下，登录状态和用户名的变化，用红色标出）。如果你走得太远，剥夺或改变太多，也不用担心-前进和后退按钮可以帮助你随时返回查看影响。

在这种情况下，UID 和 PHPSESSID 都能够独立地维护会话的状态（如下截图所示），这意味着只有当你同时从请求中删除这两个时，你才会失去会话并看到注销。

![](img/B03918_09_07.png)

使用 cookie 的基本要素维护状态

这也意味着每个用户只有一个有效的会话，但如果需要的话，你可以很容易地创建自己的经过身份验证的会话。嗯，我想知道我们现在真的想成为哪个用户？嗯，假设默认的 SQL、XML 或其他用户表格式已经就位，而且没有采取加固措施，我们可以尝试在下面的截图中做一些更有抱负的事情：

![](img/B03918_09_08.png)

模糊 UID 以提供管理员权限

正如你所看到的，这个简单的例子帮助你学会了通过使用 Burp Suite 的**`Repeater`**工具中的一些有趣的技巧来操纵 cookie 的组件从而获得 root 权限。当然，这需要我们捕获一个经过身份验证的会话。但是如果我们没有一个，或者我们想要欺骗用户解锁我们可能遇到的所有 2FA 陷阱呢？

### 不要吃模糊的 cookies

当一个单独的 Cookie 需要处理时，更加手动的**`Repeater`**过程可能是很有意义的。然而，当我们想要暴力破解 Cookie 时，使用 Burp Suite 的顺序器可能更能节省我们的时间，因为它可以帮助我们分析应用程序如何维护会话随机性。

为此，我们需要访问一个应用程序并捕获带有会话 ID 的请求。选择独立的**Damn Vulnerable Web**（**DVWA**）应用程序（独立的而不是 OWASP BWA 捆绑版本，后者无法适当地暴露 Cookie）。让我们选择一个合适的请求，右键单击事件，然后**`Send to Sequencer`**，就像我们在下面的截图中看到的那样：

![](img/B03918_09_09.png)

找到适合顺序的请求

在**`Sequencer`**选项卡中，我们可以开始突出显示我们想要使用**`Sequencer`**进行随机化的字段，如下截图所示。对于这个测试，我们真正关心的是应用程序如何随机化 PHPSESSID，因此我们将相应地选择它，然后点击**`Start Live Capture`**按钮：

![](img/B03918_09_10.png)

配置顺序器

这将弹出一个特殊窗口，允许您查看完成了多少次迭代。在至少运行了 100 次或更多次迭代之后，您可以选择停止该过程或继续迭代；与此同时，您还可以对随机性进行分析。如果一个应用在这方面得分较低，通常意味着我们有合理的机会对会话密钥进行模糊处理，并劫持与该会话关联的可怜用户的访问。我们可以看到当我让测试运行超过 5700 个会话时的情况（这只需要几分钟），如下截图所示：

![](img/B03918_09_11.png)

会话随机性的顺序器分析

如果我们想要保存 Cookie 以备后续会话固定候选人使用，我们可以将它们放入文件并保存以备将来使用。

会话随机化是衡量应用程序构建得有多好以及客户开发人员有多注重安全性的重要指标。还记得我们讨论过的 Web 开发人员如何使用 Cookie 来存储会话 ID 以外的内容吗？顺序器在 Web 应用程序渗透测试中有很多其他应用，因为令牌用于远不止跟踪会话状态。Burp Suite 的文档在帮助理解工具的其他功能方面做得非常好（在**`Help`**菜单中可用），而 Packt 书籍*Burp Suite Essentials*（[`www.packtpub.com/hardware-and-creative/burp-suite-essentials`](https://www.packtpub.com/hardware-and-creative/burp-suite-essentials)）可能是一个很好的资源。

### 绝地会话技巧

黑客对自定义身份验证前端的常见攻击是会话固定。黑客依赖于开发人员没有考虑如何充分保护和排序他们的会话 ID。通过社会工程学（简单的电子邮件或即时消息就可以），黑客能够传递一个带有预置无效会话 ID 的 URL 字符串。如果这是我们的测试，我们肯定希望有其他流量用作模板或从扫描或秘密收集中了解应用程序，以便我们能够提供应用程序期望的会话 ID 格式和长度。配置不当的身份验证门户将允许我们的受害者携带自己的会话 ID（哈！BYOSID？），并通过验证自己的凭据甚至 2FA，使会话 ID 合法化。我们等待的测试人员随后可以使用这个新的合法会话 ID 肆意妄为，并冒充受害者。

一个安全的应用程序应该通过确保会话 ID 或 cookie 在认证时发生变化来防止造成损害，但事实证明，这并不像我们所希望的那样标准。这在在线购物网站中也很常见，这是非常危险的，因为合法用户可能只需进行一次快速的社交攻击就可以获取支付信息。进行会话固定攻击的常见方法如下截图所示：

![](img/B03918_09_12-1.png)

会话固定的一般方法

当然，最容易使用这种攻击的网站可能是那些将会话 ID 或 cookie 作为 URL 字符串的一部分的网站。然而，我们通常需要通过一些巧妙的客户端脚本或元标签包含来设置 cookie。在 OWASP BWA VM 上包含的**WebGoat**应用程序是一个练习整个过程的好方法，从生成虚假链接欺骗用户进行认证，从而使其合法化，最终结果类似于以下截图，Joe Hacker 通过欺骗受害者 Jane，能够使用他的会话 ID 使她进行认证，然后跟在她后面获得完全的账户访问权限：

![](img/B03918_09_13.png)

使用 WebGoat 练习会话固定

最可怕的部分实际上可能是一旦进入账户，Joe Hacker 实际上可以强制更改账户密码，重定银行交易，并锁定用户！许多保险、人力资源和金融网站很少被普通员工使用，因此黑客通常可以在账户通知提示受害者被骗之前有一个月甚至更长的时间来采取行动。

## 功能访问级别控制

* * *

到目前为止，我们讨论的大多数技术和问题都涉及到坏人（或我们）获取他们本不应该拥有的*信息*。在 OWASP 2013 年十大安全威胁中（[`www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References`](https://www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References)），这被称为**不安全的直接对象引用**（**IDOR**），排名第 4。然而，还有另一个问题，曾经是排名第 7 的，被称为**缺失的功能访问级别控制**（**[`www.owasp.org/index.php/Top_10_2013-A7-Missing_Function_Level_Access_Control`](https://www.owasp.org/index.php/Top_10_2013-A7-Missing_Function_Level_Access_Control)**），其 2013 年 OWASP 总结如下截图所示。这个类别意味着不小心或不适当地向攻击者披露*功能*而不是*信息*。

![](img/B03918_09_14.png)

OWASP 2013 年第 7 号威胁：缺失的功能访问级别控制

在大多数情况下，当试图访问隐藏页面或在认证会话中尝试隐藏命令时，这种缺陷就会被注意到，这些命令本不应该具有这些特权。Web 开发人员可能会误将混淆视为安全，而不是与策略引擎搏斗，他们只是依靠隐藏功能或命令而不是明确地阻止它们的使用。使用 Burp Suite 或 OWASP ZAP 进行扫描可以快速找到目标站点值得测试的候选区域，并且扫描过程甚至可能提供问题的部分验证。

## 精炼暴徒的词汇

* * *

我们上面看到的许多攻击企图劫持会话，欺骗用户代表他们建立会话，或者利用应用程序无法强制执行规则的能力。最终，我们将找到一个需要解决的问题，那就是猜测密码。有大量的工具可以尝试这个非常基本的任务，但总的来说，它们的方法是一样的——通过使用通过全面暴力引擎生成的单词列表（例如使用**crunch**），精炼的单词列表和音节引擎（**John the Ripper**，**THC-Hydra**等），甚至通过使用预先计算的解决方案（使用彩虹表和类似的解决方案）进行迭代。

对于 Web 应用程序，Burp Suite 是一个用于暴力攻击的好工具，您可以参考第五章，***Â **使用 OWASP ZAP 和 Burp Suite 进行代理操作*，看看它可能如何使用，并仅将相同的模糊技术应用于密码字段。我们还可以使用 THC-Hydra 等工具对 Web 登录页面进行暴力攻击。当熟悉 THC-Hydra 的功能和格式时，练习使用**xHydra** GUI 前端是有帮助的。要使用 xHydra（也称为**hydra-gtk**），您可以使用下面截图中显示的菜单中的快捷方式调用该进程，或者在 CLI 中键入`xhydra`：

![](img/B03918_09_15.png)

寻找 Hydra 的 GUI 前端

一旦我们打开了 Hydra 的 GUI，我们就可以开始配置我们需要解决目标的选项。**`Target`**标签（如下截图所示）允许我们指向正确的 IP 或主机名，识别我们正在针对的请求提交类型（在本例中为`http-post-form`），甚至切换日志记录、调试和详细模式：

![](img/B03918_09_16.png)

Hydra 目标信息

在**`Passwords`**标签中（如下截图所示），我们可以配置 hydra 使用单个提交或从用户名和密码列表中提取。许多应用程序缺乏密码复杂性规则，将允许用户在某些帐户中使用用户名或空格，因此提供了复选框，以允许我们检查这些内容。**反向登录**允许您尝试颠倒用户名的顺序并尝试将其作为密码。

![](img/B03918_09_17.png)

设置用户名和密码列表

我们最后的调整将出现在**`Specific`**标签中（如下截图所示）。在这里，我们正在测试的所有重要 URL 模式被定义。我们填写的字段需要从浏览器的**`View Source`**，浏览器的插件，或者使用 Burp Suite 的 Proxy Intercept 中获取。无论哪种情况，由**`Passwords`**标签填充的变量将被标记为`^USER^`和`^PASS^`。最后一个字符串实际上是任何表示失败身份验证的标识字符串。在 DVWA 中，该字符串将在返回的结果中看到`login.php`，从而将我们推向相同的登录门户。如果我们将其应用于 Mutillidae，我们可以使用`Not Logged In`。

目标的适用 URL 答案会因网站而异，这些信息通常是通过扫描、蜘蛛爬行或传统的冲浪收集的。

![](img/B03918_09_18.png)

指定评估的 URL

我们最后一步是实际从**`Start`**标签运行扫描（如下截图所示）。我们可以观察扫描的迭代——由于我们的详细标志，任何成功的结果都将在输出的底部说明。我们还可以看到我们的 GUI 配置的 CLI 等效，以便您可以重复这些扫描作为脚本的一部分或移动到 CLI 中进行调整。一个警告或澄清——我发现 CLI 很挑剔，它在使用的 URL 字符串的格式化方面存在问题，或者为选项添加的顺序标志有时会产生非常不同的结果。使用 GUI 工具可以消除很多不确定性，是避免这些相同陷阱的好方法。

![](img/B03918_09_19.png)

查看 Hydra 的结果和命令行版本

Hydra 作为一个专门用于暴力破解的工具，是解决网络和非网络凭证黑客攻击的一种绝妙方式。老话说“垃圾进，垃圾出”在这里也适用——我们的结果只会和输入工具的密码和用户列表一样好，所以我建议探索更好地组织你的 OSINT 收集的方法。熟悉 Kali 中包含的各种工具中的字典，熟悉像 Crunch（https://sourceforge.net/projects/crunch-wordlist/）和 CeWL（https://digi.ninja/projects/cewl.php）这样的工具，以帮助生成字典。还值得调查基于哈希的攻击，这样我们就可以避免对密码进行加密哈希，并利用更多的单点登录（SSO）、开放认证（OAuth）和混合认证架构，这些架构通常在 Microsoft AD 环境中使用。这些基于哈希的方法（比如 Pass-the-hash：https://www.sans.org/reading-room/whitepapers/testing/pass-the-hash-attacks-tools-mitigation-33283）在全套渗透测试中更有意义，系统测试在范围内。

## 总结

* * *

认证是网络信任的基础。在这个领域的妥协可能不像应用程序的其他方面那样引人注目，但影响至关重要。认证或会话管理的破坏使所有其他安全措施都变得无效。教导客户理解这一点很重要，但我们需要倡导更广泛地采用临时 2FA，重复使用标准化和广为人知的框架，而不是自制门户，以及在软件开发生命周期的所有阶段持续进行渗透测试，以确保应用程序的成熟不会留下一个可信的、加固的认证未完成。

在本章中，我们看到了 Web 应用程序可以识别和验证用户并分配权限的许多方式。我们现在有了测试应用程序中会话管理的韧性以及直接获取凭证的工具。Burp Suite、Hydra、OWASP ZAP，当然还有你的浏览器和一些 OSINT，将对验证目标的加固非常有用。

在第十章，*启动客户端攻击*，我们将把客户端攻击提升到一个新的水平，并重新审视基于 DOM 的跨站脚本。您还将学习如何利用客户端发起攻击并提升我们的权限，代表您劫持通信，甚至了解神秘的跨站请求伪造。我们已经接近终点了，朋友们，我很高兴你们还和我在一起！让我们继续前进，攻击一些浏览器。
