# 第二章：准备和测试的指导方针

了解目标应用程序的构建方式，如第一章中所讨论的*常见 Web 应用程序和架构*，将有助于我们进行比肩式渗透测试。所有这些理解都可能是一把双刃剑。更复杂的应用程序可能会让技术上最熟练的测试人员感到不知所措。在测试时，我们需要确保覆盖所有需求范围。也许会有诱惑在现场进行测试，但如果您和我一样，我们需要有一个计划。拥有严格的流程和深入理解的规则将有助于我们向客户提供一致、有价值的信息。这种额外的正式对待也将确保我们完全覆盖了与客户达成一致的范围。

这些计划可以作为客户流程的一部分存在，也可以作为我们通过合同带来的东西 - 我们可能是内部员工和承包商，也可能是外部顾问。在第一种情况下，您可能被要求针对自己雇主的环境或产品进行测试。在这种情况下，您的命令可能会源自内部流程或项目要求。管理层下达的临时测试并不罕见，但请确保范围和流程经过正式协议以确保所有各方受到保护。在后一种情况下，您或您的雇主可能被客户聘请进行测试。在这些情况下，范围、**工作声明**（**SOW**）和合同作为一个整体，都需要由双方审核，以确保边界得到保护。

在整个过程中，牢记我们在那里的原因 - 我们在那里是为了帮助客户，而不是羞辱或展示他们的员工。无论您参与测试是受邀还是受命，道德黑客社区都应该赞扬那些接受测试的组织，因为有一天也许是我们个人的数据或财务状况岌岌可危。让我们尽力确保我们不会成为明天的受害者。

在本章中，我们将讨论以下内容：

+   我们可以借鉴和修改一些全面的测试框架，以供我们自己使用

+   可以指导我们行为的道德和法律原则

+   关于建立实验室和经过批准的目标，以练习我们将在本书中探索的测试技能的指导

## 选择你喜欢的测试框架

* * *

在建立渗透测试和特别是 Web 应用程序渗透测试领域的领导地位的竞争中，出现了一些组织、公司和委员会。其中一些组织提供了一个与产品无关的方法，而其他人则毫不掩饰地推动他们推荐的渗透测试方法或*框架*。这种测试框架的内容和格式将有很大的变化，因此我们需要筛选选项，看哪一个更合理。

政府支持的中心和机构，如**美国计算机紧急应对团队**（**US CERT**）、**国家标准与技术研究所**（**NIST**）的**计算机安全资源中心**（**CSRC**），以及新成立的**欧洲网络与信息安全局**（[`www.enisa.europa.eu`](https://www.enisa.europa.eu/)），往往专注于为防御者提供指南，提供了一些指导，可以转化为测试要求和重点领域。

因此，回到潜在的路径；选择一个框架通常取决于个人的舒适区和对程序或视角的熟悉程度。对于许多行业来说，合规性和法规也将驱动选择。没有*正确*的答案，但选择可能会对架构产生影响，并在最终结果中产生优势和劣势。许多时候，我们自己的培训预算、时间表、产品组合和背景将决定我们如何达到我们的过程。我们可能通过认证轨道、项目关联或通过雇主的有机方式来达到目标。让我们来看看一些最流行的方法。

### 通过产品框架

这是一本关于 Kali Linux 的书，但值得一提的是，有许多产品试图实现一体化的 Web 渗透测试。其中一些产品非常精心制作和维护，而其他产品近年来已经被忽视，但仍然有支持者，基于其独特的功能集或界面。

Kali Linux 本身有一些工具套件，它可以提供全面的测试生命周期覆盖。以下是一些更常见的选项列表：

+   **IronWASP** ([`ironwasp.org/index.html`](http://ironwasp.org/index.html))：这个免费的开源软件包可以在 Mac 和 Windows 上运行，或者在 Linux 上运行 WINE，并且具有大量出色的开箱即用功能。然而，它真正强大的地方在于，你可以编写自己的模块，或者借用别人用 VB.NET、C#、Ruby 或 Python 编写的模块，使工具成为你自己的！它的网站提供了精心制作的详细视频，向您展示工具的功能。

+   **Veracode** ([`www.veracode.com/products/dynamic-analysis-dast/web-application-security-testing`](http://www.veracode.com/products/dynamic-analysis-dast/web-application-security-testing))：一个新的进入领域的 SaaS 产品 Veracode，用于执行基于云的 Web 应用程序渗透测试。

+   **IBM Security AppScan** ([`www-03.ibm.com/software/products/en/appscan`](http://www-03.ibm.com/software/products/en/appscan))：这个全能的 Web 和移动应用程序测试套件可以自动报告合规性、漏洞和建议的修复措施。它是大型企业的受欢迎的本地选项，并为**软件开发生命周期**（**SDLC**）的所有阶段提供解决方案。最近，他们开始提供云托管变体。IBM 的解决方案也因其与类似安全和开发生态系统的集成而脱颖而出。他们通过其**系统事件和事件管理器**（**SEIM**）、QRadar 以及其面向 Web 的 IDS/IPS 产品和代码开发平台组合之间的协同作用提供差异化。

+   **Rapid7 appspider** ([`www.rapid7.com/products/appspider/`](https://www.rapid7.com/products/appspider/))：IBM 专注于自己的生态系统，而 Rapid7 具有类似的能力套件，但专注于与技术合作伙伴的集成。Appspider 能够做很多相同的事情，但它专注于与 DevOps 工具和全面的 SEIM、IDS/IPS 和 WAF 工具集成。它甚至可以自动化修补程序，重放攻击，并自动生成规则；在速度、覆盖范围和可用性方面是顶尖表现者。

+   **HP WebInspect** ([`www8.hp.com/us/en/software-solutions/webinspect-dynamic-analysis-dast/`](http://www8.hp.com/us/en/software-solutions/webinspect-dynamic-analysis-dast/))：与 IBM 的产品类似，WebInspect 非常专注于单一供应商方法，涵盖安全、开发、编码、渗透测试和补救措施。这种解决方案的成本和复杂性使其更适合内部分析，而不适合外部渗透测试人员。

+   **Acunetix**（[`www.acunetix.com`](http://www.acunetix.com)）：与 IBM、Rapid7 和 HP WebInspect 不同，Acunetix 网络漏洞扫描仪专注于渗透测试支持和报告，而不涉及自动化规则和修补。这并不是一件坏事；它所做的事情，它做得很好；通常在外部渗透测试人员工作时，这些功能是不被使用的。Acunetix 提供丰富的报告，并经常在效力、覆盖范围和功能方面名列前茅。

### 像你玩一样训练

认证是一个很好的手段，可以让你攀登学习曲线，开启你的网络渗透测试职业生涯。如果你正在阅读这本书，很可能你已经掌握了其中一个或多个专业认证。大多数认证蓝图都会引导道德黑客通过测试的流程，这与洛克希德·马丁的**网络攻击链**®（[`www.lockheedmartin.com/us/what-we-do/aerospace-defense/cyber/cyber-kill-chain.html`](http://www.lockheedmartin.com/us/what-we-do/aerospace-defense/cyber/cyber-kill-chain.html)）非常相似，如下图所示。虽然这些并非以名称命名的框架，但它们可以提供一种全面的方法论，可以被整合和适应到你自己的流程中。

![](img/B03918_02_01.png)

网络攻击链驱动了大部分攻击和测试方法，并成为大多数行业认证的基础。

### 注

洛克希德·马丁公司被认为是在一篇名为《情报驱动的计算机网络防御：通过对对手行动和入侵攻击链的分析获得启示》的论文中创建了网络攻击链（[`www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf`](http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf)）。

两个领先的国际组织，EC-Council 和 GIAC/SANS，已经成为专注于认证的组织，通过资格认证安全专业人员而赢得了认可，这反过来也为他们的项目说得很好。 Offensive Security（Kali Linux 的创建者/维护者）也提供了备受尊敬的以 Kali 为重点的认证，因其实践测试方法而备受推崇。

#### EC-Council 的方法

EC-Council 的 Hacking and Hardening Corporate Web App/Web Site CAST 613 课程（[`www.eccouncil.org/programs/web-application-security/`](https://www.eccouncil.org/programs/web-application-security/)）涉及了一系列最具影响力和令人恐惧的攻击。他们的课程涉及了一些重点，并侧重于帮助开发人员了解如何更好地保护和测试他们的应用程序。鉴于 EC-Council 没有专门针对纯粹的网络应用程序渗透测试的攻击性认证，这门课程和认证可以作为 EC-Council 的**认证的道德黑客**（**CEH**）认证中学到的更一般的渗透测试方法的补充。与许多 EC-Council 的认证一样，材料可以通过他们的培训课程或书店和在线第三方文本获得。

我们将参考 EC-Council 的一些道德准则，但考虑到这不像他们的 CEH 那样受欢迎，特别是要看更为成熟的网络渗透测试标准。

#### GIAC/SANS 的方法

GIAC 和 SANS 共同提供活动、培训路径和一个强大的社区，通常被认为是美国和北约政府网络安全专业人员的首选，并经常列入那里许多角色的要求。其中包括**GIAC Web 应用程序渗透测试员**（**GWAPT**）认证。GWAPT 是一个独立的认证，与网络攻击链紧密相似，他们的课程只在会议和在线课程中提供。

他们的培训成本高昂，但通常是值得的，但这往往限制了可以访问他们的方法和框架的受众范围。考虑将 GWAPT 作为更高级的认证，值得在您的网络渗透测试职业生涯中追求的下一步。

#### 攻击性安全方法

攻击性安全是为我们带来 Kali Linux 的组织，以及一些积极的博客和渗透测试和取证领域的思想领导。虽然他们在认证领域最为知名的是他们的攻击性安全认证专业（OSCP），他们还提供攻击性安全网络专家（OSWE）。这项严格的培训包括一个 24 小时的实践考试，这是他们认证策略的标志。虽然攻击性安全专注于实际方面，但事实上，他们确实教授了许多人将其作为基准的实践方法。他们的操作系统 Kali Linux 是重点，因此在本书的许多领域我们肯定会听取他们的指导。

### 开源方法和框架

开源倡导者为我们提供了一些非常全面的选择，我们可以选择作为起点。每个选项都提供了一个通常是免费或偏向特定供应商或工具集的结构。事实上，大多数由非营利组织开发的开源框架只能通过一系列工具来实现全面覆盖。来自世界互联网联盟（W3C）和 Web 应用程序安全委员会（WASC）等组织的额外指导可以帮助完善您的流程。

#### ISECOM 的 OSSTMM

安全和开放方法研究所（ISECOM）发布了最新的开源安全测试方法手册（OSSTMM）的付费版本，版本 4 是最新版本。银牌会员或更高级别会员可以访问该文档，但较早的版本可免费访问。

OSSTMM 在更高层次上描述了所有形式的渗透测试的过程，其中穿插着 Web 应用程序测试元素。我们将在进行过程中偶尔参考它，但可以将其视为本书的可选参考。

#### ISSAF

信息系统安全评估框架（ISSAF）实际上是一个被搁置的项目，但仍然提供了很好的信息。它可以帮助理解整个企业级评估过程，不仅包括渗透测试，还包括事件和变更控制程序、安全运营程序和环境的物理安全等。虽然 ISSAF 缺乏更多的当前应用测试指导，但它在提供样本 NDA、合同、问卷和其他有用的模板方面弥补了这一点，可以帮助制定适当的交付成果。

值得注意的是，ISSAF 涵盖了以下学科领域：

+   评估过程中的项目管理、指南和最佳实践

+   评估方法

+   技术控制评估

+   Unix/Linux、Windows、Novell 和数据库系统的安全评估

+   Web 应用程序安全评估

+   互联网用户安全和社会工程学

+   安全评估项目的法律方面

+   非披露协议（NDA）和安全评估合同的模板

+   请求提案（RFP）模板

+   渗透测试实验室设计的一些建议（本章后面介绍）

#### NIST 出版物

NIST 已经在近 30 年的时间里发布了特别出版物，为许多技术领域提供最佳实践和指导，**计算机安全资源中心**（CSRC）在提供许多关于网络安全防御领域的免费可访问出版物方面处于领先地位。NIST 还发布了有价值的指南，用于测试组织安全方法的有效性和覆盖范围。

NIST 在这一领域的首次尝试，他们的特别出版物《信息安全测试和评估技术指南》（NIST 800-115 ([`nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf`](http://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf))，现在已经过时，不再手动维护。参考 SP 800-115 是值得的，因为它仍然为各种渗透测试提供有用信息，包括 Web 应用。除了技术货币外，它的价值在于其对测试数据的系统处理，维护适当的控制，并将测试建立为有价值的报告。

感兴趣的最新 SP 是《评估联邦信息系统和组织中的安全和隐私控制》（SP 800-53A，可在[`nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53Ar4.pdf)`](http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53Ar4.pdf)上找到）。这个演示更少地关注行政流程，更多地提供了如何最好地制定自己的政策的指导方针。SP 800-53A 还提供了关于如何将它们合理地纳入 SDLC（如第一章，《常见 Web 应用和架构》中提到的）的指导。作为额外的奖励，SP 800-53A 包括几个附录，提供了一些评估和报告信息；附录 F 包括一套完整的测试，可以纳入到你自己的流程中。NIST 测试方案按覆盖范围和关键性进行排名，为公开已知的漏洞提供了一些急需的严谨性。

#### OWASP 的 OTG

Web 渗透测试中最广泛接受的参考是 OWASP 测试指南，也称为 OTG，第 4 版([`www.owasp.org/index.php/OWASP_Testing_Project`](https://www.owasp.org/index.php/OWASP_Testing_Project))。由于社区的积极参与和对趋势的卓越预测能力，OWASP 多年来一直引领着这一领域。OWASP 的影响是 SANS、Black Hat 和 DevCon 等会议上的主要推动因素，他们的前十大网络安全威胁对我们所有人来说都是必读的。

OTG 与 NIST 指南类似，提供了一些关于在适当阶段进行测试的提示和指针。OWASP 比之前讨论过的其他全面框架更经常地维护 OTG，每三到四年发布一次新版本的前十名和 OTG。然而，OTG 的大部分内容直接涉及特定于 Web 的测试，可以全面覆盖不仅是前十名威胁，还有一系列由 OWASP 团队积极跟踪的漏洞。

尽管 OTG 涵盖了很多内容，但它从一个入门开始，包括 OWASP 在 SDLC 中的最佳实践和适当的测试阶段。OTS 还超越了技术漏洞，展示了目标客户如何从*红队*（进行模拟安全入侵）以及 OWASP 团队特定于 Web 渗透测试的许多侦察和足迹方面受益。一旦讨论了这个基础，接下来的部分将 Web 应用程序渗透测试分解成逻辑组，重点关注可以由类似测试、工具和类似的开发或部署阶段覆盖的特定架构区域：

+   身份管理、认证和授权

+   会话管理

+   输入验证

+   错误处理

+   密码学

+   业务逻辑（根据输入或更新处理和操纵数据）

+   客户端（通常是受害者浏览器）

如果你现在还没猜到，OWASP 测试指南就是我们在本书中将要参考的基础。在实践中，其他框架可能对您更有效，但它们的文档的时效性、焦点、完整性和可访问性以及它们推荐的测试为我们提供了一个坚实的基础，使我们可以在测试目标应用程序时与 Kali Linux 一起使用它。

## 保持合法和道德

* * *

如果我们的测试流程能让我们远离监狱，并减少我们和客户的风险，那岂不是太好了？在大多数国家的国家、省、州和地方层面，法律体系呈指数级增长。我们所受到的众多新闻报道清楚地表明，世界各地的政府机构仍在努力确定如何在网络安全相关事件中找到隐私、保密和问责的正确平衡。事实证明，在绝大多数政府机构中，制定法律的人可能不适合理解复杂性并制定有效的法规。对我们来说，一个复杂因素是我们很少在单一司法管辖区内运营：跨州和国际纠葛是危险且动态的。我们如何才能在工作中摆脱持续的瘫痪和恐惧呢？

### 什么是合法的？

首先，我们测试的网站的位置和管理业务的法律管辖权将分别提出我们应该了解的不同法律和法规。在美国和欧盟，跨越州或成员国边界的行为属于其总体法规的主要管辖范围。为了避免违反这些法律，您可能会发现搜索您所在的管理机构的法律（对于欧盟，[`eur-lex.europa.eu/homepage.html`](http://eur-lex.europa.eu/homepage.html)）是一个很好的起点，而美国司法部提供类似的搜索功能，但在名为*Prosecuting Computer Crimes*的指南中总结了国家法典[`www.justice.gov/sites/default/files/criminal-ccips/legacy/2015/01/14/ccmanual.pdf)`](https://www.justice.gov/sites/default/files/criminal-ccips/legacy/2015/01/14/ccmanual.pdf))。美国的法律，例如类似于 1984 年的《计算机欺诈和滥用法案》、1996 年的《经济间谍法》、《联邦信息安全管理法》（**FISMA**）、2002 年的《网络安全增强法》和 2001 年的《为拦截和阻挠恐怖主义提供适当工具的美国统一和加强法》（**USA PATRIOT**）等，也影响了美国网络法律的法律先例和原则。像萨班斯-奥克斯利法案、《健康保险可携带性和责任法案》（**HIPAA**）和《支付卡行业数字安全标准》（**PCI-DSS**）等法规可能适用于我们将要与之互动的许多客户，取决于其功能和管理机构。

欧盟刚刚颁布了一项名为《通用数据保护条例》（GDPR）的新的具有深远影响的法规（[`www.eugdpr.org`](http://www.eugdpr.org)），它有助于定义公司的责任，肯定会影响我们参与涉及在欧盟开展业务的公司的项目的角色。印度政府最近制定了自己的全面《2013 年国家网络安全战略》，并通过其电子和信息技术部门网站提供所有这些信息（[`meity.gov.in/content/cyber-laws-security`](http://meity.gov.in/content/cyber-laws-security)）。许多其他亚洲和非洲国家也不断修订自己的法律。值得投资于涵盖不断发展的法律环境的参考书和法律期刊，这可以帮助您保持在法律的正确一边。

随着您的实践不断发展，值得考虑聘请一名专注于网络安全、数据、隐私和道德黑客法律的律师或律所，以帮助您制定合法的合同，并在您和您的公司可能卷入任何法律诉讼时提供代表。

### 什么是道德？

尽管没有法律约束力，道德准则可以成为法律和法规发展的风向标，至少比大多数政府实体设定了更高的标准。虽然它们缺乏法律语言，但通常以简单的术语弥补了这一点，这些术语通常会引导我们远离可能出现的任何法律问题领域。EC-Council 和 GIAC/SANS 都发布了《道德准则》（[`www.eccouncil.org/code-of-ethics/`](https://www.eccouncil.org/code-of-ethics/)和[`www.giac.org/about/ethics)`](https://www.giac.org/about/ethics)），许多其他行业机构和认证机构也有。一些商业工具供应商也对工具的正确使用有期望，并且不赞成使用其工具集进行不正当活动。通过注册为会员或持有他们的认证，您应该遵守他们的标准。

在渗透测试实践的自然演变中，很可能会遇到一些问题，这些问题可能在讨论或完成项目时出现，这可能在已建立的标准操作程序、道德准则或法律中是模棱两可的。在这些情况下，最好退一步，评估每个可用选项可能带来的短期和长期危害或利益。同意一套法律和道德边界可能是一种资产-有时最好的方法是完全避免道德或法律上的灰色地带，坚持那些得到充分证明的过程和行动。

## 实验室-练习我们所学到的东西

* * *

所以你可能会问，我们什么时候可以进行一些渗透测试的乐趣？让我们说*很快*。我们必须建立一个安全而又具有代表性的环境，可以为我们想要运行的各种测试提供成熟的目标。我们还希望在不影响一些真实生产应用程序或其基础系统或支持网络的性能的情况下推动极限。正如*变化是生活的调味品*一样，这也适用于渗透测试。通过接触和了解各种平台，您的测试效果将得到极大改善。如果您想深入了解更严格的通用渗透测试范围，可以参考一些很好的资源，比如 Packt 出版社的*Building Virtual Pentesting Labs for Advanced Penetration Testing - Second Edition* by *Kevin Cardwell*（[`www.packtpub.com/networking-and-servers/building-virtual-pentesting-labs-advanced-penetration-testing-second-edition`](https://www.packtpub.com/networking-and-servers/building-virtual-pentesting-labs-advanced-penetration-testing-second-edition)）。在本节中，我们将简要讨论本书中将用于演练我们的渗透测试方法的沙盒或实验室。

作为参考，我为本书准备的实验室看起来类似于以下图表：

![](img/B03918_02_02-1.png)

本书的渗透测试虚拟实验室提供了充足的空间来探索和演练新的攻击方法。

### 创建一个虚拟化环境

白帽黑客，就像任何 IT 专业人士一样，通常对特定平台和操作系统有狂热的忠诚。我完全预期本书的读者将使用运行某种 Microsoft Windows、Mac OS（X 或 Sierra）或 Linux/BSD（Ubuntu/Debian、Fedora/RedHat、SUSE、FreeBSD 等）的笔记本电脑。不要为小事烦恼-只要它是一个相当新的和配置良好的笔记本电脑或台式机（4 个 CPU 现代核心，以太网和无线，一些 USB（2 或 3 版本）插座，至少 16GB 的 RAM），它至少应该让您开始。

冒着再次引发狂热的辩论的风险，我们将选择一个虚拟化平台来运行在其之上（抱歉！）。虚拟化帮助我们平衡竞争，并通过使用虚拟化平台来建立虚拟网络段并安装和访问 Windows 和 Linux 桌面和服务器变体的虚拟机（VM）来实际提高我们实验室的多功能性。选择适合您预算和偏好的选项。像 Oracle 的 Virtual Box，VMWare 的 Workstation 或 Fusion，Citrix Xen，甚至 Parellels（在 Mac 上）都很受欢迎。在 Web 应用程序渗透测试中，性能并不像在其他一些形式中那样重要，因为我们在大多数工作中不会进行实时破解或哈希。

值得注意的是，您当然可以使用专用服务器或裸机（物理）主机和网络设备来构建实验室，但我们可以在我们的虚拟沙盒中完成本书中的所有工作。在实际实践中，更常见的是看到专业的渗透测试人员使用虚拟机来执行他们的测试，因为这有助于确保客户正在进行适当的消毒和隔离。测试人员可以简单地将虚拟机托管在可移动或网络驱动器上，并在项目完成时删除虚拟机。

### 我们的渗透测试主机

在撰写本书时，我们将使用最新的 Kali Linux 版本（2016.2），使用其存储库中的现成虚拟机（[`www.offensive-security.com/kali-linux-vmware-virtualbox-image-download/`](https://www.offensive-security.com/kali-linux-vmware-virtualbox-image-download/)）。我建议修改镜像以获得更大的分区（我使用了一个 1TB 的混合 USB 3.0 驱动器来存储所有镜像，并将 Kali 镜像设置为 100GB 的单个分区）。这个更大的占用空间将容纳大量的网站和数据收集档案。您也可以启用额外的虚拟网络接口卡（NIC），如果您愿意的话，但我使用 VMWare Fusion 的机器设置将单个 NIC 映射到每种所需的连接形式的适当接口。对于 MITM 攻击，我们将提供第二个 NIC。

### 创建一个目标丰富的环境

我们将遇到的大多数服务器目标将托管在 Linux 或 Windows 操作系统上，客户端将是 Linux、Windows、Mac OS 或移动设备（Android、iOS、Windows Phone 或 Blackberry）。让我们分别看待服务器和客户端。

#### 寻找易受骗的服务器

如果您有活跃的**Microsoft Developers Program**（**MSDP**）许可证，您可以使用这些镜像进行测试；但对于我们其他人来说，没有预算支持这一点，您可以从微软的评估中心网站（[`www.microsoft.com/en-us/evalcenter/`](https://www.microsoft.com/en-us/evalcenter/)）下载几乎任何操作系统或软件包的完整版本，评估期为 60 至 180 天。这两个选项都是合适的，但频繁需要重新开始和评估许可证的不存在成本使后者成为一个完全合适的选择。我建议至少具有 MS Server 2008、2012 和 2016 的镜像，并为 IIS 和其他重要的 Web 服务配置镜像。

Linux 客户端更容易。您可以找到几乎任何您需要的变体的选项；对于企业/商业变体，您可以找到一个免费的、社区支持的近似值，非常接近。大多数用于 Web 服务的 Linux 实现不仅包括 Linux 操作系统，还包括适当的 Apache Web 服务器、MySQL 数据库和 PHP 版本，它们共同形成了 LAMP Web 堆栈。拥有 Debian、Ubuntu、CentOS（用于 Red Hat 目标）、Fedora 或 SuSE Linux 的当前镜像可以确保您准备好应对任何潜在的情况。

对于有抱负的渗透测试人员来说，最好的事情是可黑客化的服务器 VM 的出现，其中有几个允许练习针对各种漏洞的尝试。Rapid7 发布并支持了 Metasploitable VM（[`information.rapid7.com/metasploitable-download.html`](https://information.rapid7.com/metasploitable-download.html)），虽然有点老了，但非常值得进行一般渗透测试的练习。然而，Web 渗透测试受益于预配置应用程序的适当镜像，这样我们就可以直接进行有趣的事情。感兴趣的镜像包括**Damn Vulnerable Web Application**（**DVWA**，[`www.dvwa.co.uk`](http://www.dvwa.co.uk)）、OWASP Broken Web App（[`sourceforge.net/projects/owaspbwa/files/`](https://sourceforge.net/projects/owaspbwa/files/)）和 Beebox VM（Buggy Web Application 或*bwAPP*模块的基于 VM 的版本，可在[`www.itsecgames.com`](http://www.itsecgames.com)找到）。可以在 VulnHub 找到其他练习用的 VM（[`www.vulnhub.com/`](https://www.vulnhub.com/)）。

#### 不知情的客户

如果您不愿意透露您的信息并创建一个帐户来下载适合的 MS 桌面操作系统，您也可以下载微软鼓励测试人员和开发人员使用的操作系统和浏览器组合镜像（[`developer.microsoft.com/en-us/microsoft-edge/tools/vms/`](https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/)）。您可能需要选择 Windows 7、8 和 10 主机，以便完整地进行测试；在本书的各个部分，尝试每个可用的浏览器（Internet Explorer/Edge、Firefox、Chrome 等）是有意义的。虽然 MSDN、Eval Center 和开发人员下载都可以使用，但为了更轻松地设置新环境，后一种方法对我大部分的准备工作都足够了。

移动设备操作系统可以在虚拟环境中以不同的成功率运行，iOS 是唯一的例外（祝你好运，试图在虚拟环境中运行 iOS！）我们大多数的技术都将仅利用浏览器，因此使用浏览器插件或开发人员工具配置可以解决问题。从 Firefox 或 Chrome 快速搜索*用户代理浏览器更改器*将会找到工具，允许桌面浏览器模拟许多其他基于移动和桌面的浏览器。我尽可能使用 Kali VM 的 Firefox 或 Iceweasel 浏览器，必要时回退到同一 VM 上的 Chrome 或 IE/Edge、Safari 或其他适当的 Windows VM 上的浏览器，或者我笔记本电脑上的浏览器。

## 摘要

* * *

Web 应用程序渗透测试可能是一个庞大的工程。没有计划就是在计划失败；我们必须确保我们有一个明确定义的流程或测试框架，这个流程不仅被我们的技术团队充分理解，而且也得到了客户管理层的认可，可以在他们的环境中使用。渗透测试不可避免地迫使我们了解工作的一些非技术方面。当我们针对我们不拥有的应用程序，跨第三方提供的基础设施进行攻击时，我们肯定必须遵守许多利益相关者的各种规则和道德规范。要实现这种理解有很多不同的角度，所以至少这应该是一个深思熟虑的过程。

在本章中，我们看了一些更为普遍的测试方法和框架，我们可以从中汲取经验，建立自己的流程和实践。我们还花了一些时间来了解如何确定我们的法律和道德责任范围。与黑客不同，我们在这里是为了帮助我们的客户抵御攻击，所以我们有规则要遵循。我们在定义我们的流程和了解我们的边界方面的所有作业都是根据我们组建的沙盒进行测试的，我们还涵盖了建立自己的沙盒或实验室的一些方面。你自己的环境可能看起来非常不同：因人而异！

在我们的下一章中，我们将最终开始深入探讨如何对我们的目标进行侦察和范围确定。我们将研究可用的工具，以进行非侵入式扫描并避开我们目标网站的雷达，同时我们将深入了解它们的结构，揭示访问的潜在向量，并记录可能有助于我们在测试的后期阶段的邻近关系和注意事项。让我们开始吧！
