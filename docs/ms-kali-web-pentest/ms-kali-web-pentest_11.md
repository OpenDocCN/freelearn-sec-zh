# 第十二章：教育客户和结束

如果你已经读到这里，谢谢！你已经学会了如何处理 Web 渗透测试，以及如何专注和细节来改善客户的安全状况。Web 渗透测试是一种野兽，值得专门化和精通。正如我们在本书中所看到的，存在着令人困惑的各种漏洞类型，而它们易于利用的事实使它们很容易被利用。企业在整个企业范围内都存在重大问题，但从某种意义上说，它们的 Web 应用程序必然是最脆弱的方面。他们如何最好地保护与他们无法控制的用户进行最多互动的工具？

许多 Web 应用程序开发人员及其雇主已购买工具，以提供安全和可靠的运营。良好的意图经常会遇到现实世界的压力和限制，而工具在适当的操作、维护和保养之前就已经被抛在一边。业务速度--业务适应和提供新能力的速度--给 IT 组织和应用团队带来了压力；而在安全实践不足的情况下，通常会出现一种错误的选择：安全还是高效。企业通常会选择后者，因为这是支付账单的方式。安全成为错误抉择的受害者。除非我们能说服团队将安全融入其中，而不是后期添加，否则我们将继续以惊人的速度阅读失败案例。

有些人愤世嫉俗地认为这就是让我们生意兴隆的原因。如果用户及其雇主从不点击可疑链接，始终修补和维护他们的系统，并且只与经过验证的合作伙伴、客户和供应商进行有效业务，我们将看到更少的行动。我们都知道这是一个白日梦。互联网是很多东西，但整洁、有序和安全不是其中之一。作为渗透测试人员，我们独特地适合帮助推动更全面的安全策略。我们既可以确定当前状态，又可以提供建议和指导，以实现更安全的结果。这并不容易，它迫使我们运用许多技能，我们都更愿意忘记，但沟通技能，口头和书面，是传达发现和建议的关键。

最终报告无疑是我们大多数人关注的重点，但向客户提供可预测和信息丰富的状态报告是成功与否的关键。我将尽力为您提供一些资源，帮助构建最佳实践并制定您的报告。我们将讨论如何使用状态报告和可交付成果来讲述正确的故事，并帮助我们的客户找到平静。我们还将涵盖其他一些方面，比如提供建议、传递坏消息，甚至何时重复这些评估或如何推动渗透测试计划以进行勤奋的持续改进。在本章中，我们将讨论以下主题：

+   权衡验证配置的方法，并在业务需求不断变化的情况下保持其相关性。

+   提供如何审计代码版本和配置健康的指导。

+   讨论分割、基于角色的访问控制和变更管理。

+   讨论任何良好的 Web 渗透测试的演示和后续步骤。我们还将讨论与 Kali Linux 相关的竞争格局和互补工具。

+   比较一些竞争产品与 Kali Linux，这些产品实际上可能有助于评估 Web 应用程序安全性。

## 结束

* * *

世界上最好的工作对客户来说意味着什么，除非它被转化为全面的、可操作的和有见地的指导。许多技术职业由于无法沟通工作而过早结束或受到限制。除了许可和意图，另一件事将我们与黑帽黑客区分开来，那就是我们与客户的沟通。我们必须成为老师和教练-对于我们的许多客户来说，这将是一个可怕和令人心烦的过程，但我们需要提供他们可以用来改进的指导。

### 注

清理呢？嗯，Web 应用程序渗透测试（在大多数情况下）不会对环境进行永久性更改。在我们使用的大多数利用中，简单地清除浏览器的缓存或清除 Web 前端的字段将使应用程序恢复到正常运行状态。

每个父母都会对他们的孩子说“重要的不是你说了什么，而是你怎么说的”至少每周说几次。孩子们需要调整他们的直觉以适应人群，而父母则是调音者。非常类似地，我们必须“了解我们的受众”。大部分内容和细节水平将不仅由**工作声明**（SOW）中概述的范围所决定，还将由客户自己团队的能力所决定。对他们的头脑说话会疏远和冒犯他们的员工，并使您进行后续测试或重复业务的机会渺茫。一些客户也可能非常防御或不可信任，我们必须记住他们自己的职业生涯可能取决于这些发现。因此，我们希望确保最终报告中没有任何意外。我们希望我们的客户和利益相关者对发现做好充分准备，并准备接受建设性的批评而不感到恐惧。我们可以通过几种不同的方式和整个过程来传递好坏消息。

渗透测试人员最好提供一个审慎和冷静的方法。有些人可能会试图在可能不存在问题的地方找到问题，以显示增加价值。其他人可能会试图增加紧急性，以在客户心中灌输恐惧，并使自己显得不可或缺。我鼓励您专注于真正的问题，表现出冷静和一贯的态度，并在向目标客户报告时努力追求质量发现而不是数量。最终，这种审慎和有意义的互动将帮助客户，增强信心并获得对您能力的信任。

### 避免意外的持续联系

我们应该计划并承诺与客户一起进行状态报告和标记会议的节奏。即使在黑盒测试中，我们通常也可以提供进展报告，以帮助他们了解我们的进展情况。这可以根据 SOW 中包括的里程碑来呈现，也可以根据目标环境的要求进行任何转变或调整。无论如何，报告都应包括重要的结果或印象，无论好坏。特别是在黑盒测试中，整个利益相关者社区（我们和他们）都应该为一些变化做好准备，因为测试的每个先前阶段通常会决定下一个阶段的范围。

一般来说，您应该考虑计划好的和未经计划的沟通，理想情况下，制定模板并建立传递每种沟通的渠道。就像医生的后续电话一样，我们希望客户知道您和您的团队将在设定的时间联系他们，并披露目标环境的任何重要和赞美的发现。一旦他们知道可以期待什么，这可以帮助他们理解这个过程，并鼓励他们的参与和审查。

组织内进行的白盒测试可能没有明确定义的合同文件，但这并不意味着沟通就应该中断。在整个软件开发生命周期（SDLC）中进行的内部测试可能会揭示关键的漏洞、活动攻击或违规行为。管理层提供一个可信且客观的流程，供内部测试人员提出这些问题至关重要。保持这种渠道的畅通可以维持开放的文化，并使应用程序更加安全和稳健。

#### 建立定期更新

定期更新对于我们建立与客户的关系和构建积极的、建设性的叙述至关重要。我们的重点应该是帮助他们保护他们的网络应用程序，等到流程结束可能会使客户的利益相关者处于防御状态。我们需要接受他们在最终报告中将看到的内容，寻求即时的指导和价值。如果领导层已经准备好定期报告，让他们了解主要发现，他们将有时间克服可能存在的防御本能，而是期待报告的下一步。这些报告不需要非常详细，而应该突出主要发现，与 SOW 的状态相对比，总结我们为关键发现生成的任何临时报告，并提供展望。这个流程的大致轮廓可能包括以下部分：

+   突出的发现

+   测试进展/进度更新

+   表扬（客户做得对的地方）

+   建议（让他们意识到问题）

+   进度和预算状态

+   前进/预期的方式

### 注意

您团队的模板可能会有所不同，甚至可能会根据客户的需求进行定制，但以易于理解的形式向他们呈现这些信息有助于他们看到测试的价值，开始规划修复计划，并有助于避免任何意外情况 - 最终审查和总结应该只是审查。

白盒测试报告通常会作为正式交付物的一部分，就像任何其他验证和验证测试成果一样。如果这些交付物不是已经建立的标准，那么应该创建一个标准，以确保一致应用测试原则。在所有形式的渗透测试和报告中保持一致性对于帮助培训资助组织及其开发人员如何对待和回应发现至关重要。

#### 何时按下大红按钮

即使向客户提供定期报告，仍会有时候发现或结果需要立即披露并停止工作，直到得到许可。可能会立即披露的关键缺陷包括可能导致数据外泄、发现活动攻击，甚至与人力资源相关的事件（发现间谍、内部威胁、不当内容等）。在制定约定规则的过程中，您或客户可能会根据目标环境的重要性或角色添加额外的条件，这也会触发立即通知。

保密协议要求您严格保守测试结果，但正是这些关键的、实时的通知需要您发挥最佳和最勤奋的作用。可能会触发披露和停止测试的问题通常足够严重，保密性是至关重要的。虽然计划的通讯可能通过电子邮件和安全文件共享提供，但根据客户的业务，可能需要与他们建立更安全的流程。我建议在最终获得批准之前建立这个流程，以帮助所有方面安全地传递这类消息，无论是通过面对面会议、加密电子邮件或消息传递，还是保密信使。

责任是我们接下来要考虑的。及时而完整地向赞助客户披露信息很重要，因为其影响往往对他们的业务、员工或客户构成威胁或损害。在紧急情况下，您的客户可能也在寻找理由来表达他们的恐惧或追究他人的责任。即时、完整和周到的披露确保我们在法律上不承担责任。他们可能会发火，但冷静和一贯的态度可以帮助化解这些情况。我们需要清楚地传达事实和陈述的观点之间的区别，在这些情况下，更多地关注已知的事实而不是我们自己的观点。一旦客户冷静下来或吸收了信息，他们可以促使我们提供我们的解释和专家意见。

### 将乐观情绪与行动计划结合起来

撰写关于您对 Web 应用程序的评估的顶级渗透测试报告是工作中最重要的阶段。您可能会想，“但是迈克，你刚告诉我们不应该有任何意外，还有什么可以留下的呢？”虽然您是正确的，没有重大影响的发现应该不是新闻；但在这份报告中，您团队的建议最终可以被记录下来。这些建议是您对风险和优先事项的评估，这不仅在这里受到欢迎，而且是预期的。您的专业知识是您被聘用的原因，理所当然地，这种见解将帮助他们进入更成熟、更严格的安全实践。

关于最终报告内容应该是什么样的良好指导可以通过查看一些公开可用的 Pen 测试报告存储库来获得。虽然在网站上列出的大多数报告（如[`github.com/juliocesarfort/public-pentesting-reports`](https://github.com/juliocesarfort/public-pentesting-reports)）并不是专门针对 Web 应用程序的，但这些部分和一般流程是有启发性的，并且可以帮助准备您自己团队的模板。一些特定于 Web 应用程序的报告是由**动态应用安全测试**（**DAST**）供应商**Veracode**（[www.veracode.com](http://www.veracode.com)）提供的自动测试报告，以及咨询公司如**CST**（[`www.cstl.com/CST/Penetration-Test/CST-Web-Application-Testing-Report.pdf`](http://www.cstl.com/CST/Penetration-Test/CST-Web-Application-Testing-Report.pdf)）。

![](img/B03918_12_01.png)

样本 Web 应用程序 Pen 测试报告

报告中的部分可能是来自扫描仪（如**Arachni**、**Burp Suite**或**OWASP ZAP**）的自动输出的捆绑；或者它们可能是来自多个测试人员及其合作的输出的混合。像 Apache OpenOffice 和 Microsoft Office 这样的工具仍然是汇集输入的标准。Â

典型的大纲可能如下所示：

+   封面

+   执行摘要

+   目录

+   介绍

+   测试背景

+   方法论

+   测试团队

+   亮点、评分和风险总结

+   风险登记

+   指导/行动计划

+   详细发现

+   附录

+   定义

+   漏洞参考

+   工具和资源

+   侦察、扫描和枚举数据

+   使用的代码

+   链接文件

#### 执行摘要

执行摘要应该很好地提供高层次的、可量化的评估（总体得分和主要指标），同时给管理层提供高层次的、有影响的摘要，以便向所有非技术人员传达测试结果和未来方向。

#### 介绍

测试方法的信息可以帮助客户框定发现，并强化您团队的测试是符合 SOW 和在合同阶段更明确捕捉的参与规则的。这是一个总结和概述范围的任何偏差或扩展的机会，有助于确保他们理解实际执行了什么。

### 注

这也是一个很好的地方来讨论团队（如果适用的话），确保客户知道谁参与了测试和报告，以及谁受到合同条款的约束。

#### 重点、评分和风险总结

我们讨论过的一些工具将会很好地评估漏洞的严重程度，与常见的测试框架或排名列表（例如 OWASP 前 10 名，它已经帮助我们指导工作）相比。一些这样的工件，比如下面截图中显示的样本 Arachni 报告输出，可以帮助提供漏洞的客观排名并指导进一步的测试。然而，这些排名无法提供目标环境的背景。例如，一些评分很高的风险可能在特定目标中影响有限，因为该技术的使用很少，或者它只在低权限功能或子门户中部署。虽然使用这些现成的工件可能很诱人，但应该做更多的工作来确保客户理解它们对他们情况的重要性。

![](img/B03918_12_02.png)

样本 Arachni 输出 - 良好的起点

##### 风险的更多信息

呈现风险和风险管理本身就是一个话题。我曾经在美国国防部的开发项目中帮助实施风险管理工作，并且我们遵循了国防采办项目的副助理部长办公室的风险、问题和机会管理指南（[`bbp.dau.mil/docs/RIO-Guide-Jun2015.pdf`](http://bbp.dau.mil/docs/RIO-Guide-Jun2015.pdf)）。这远非唯一可接受的方法论 - 存在许多方法，你最好研究一种风险管理方法，它类似于你典型客户的共识。美国国防部使用的一般流程如下截图所示，我们作为测试人员，无论是内部还是外部，都有机会影响循环的部分：

![](img/B03918_12_03.png)

美国国防部风险管理流程

如果有什么，我已经学到了风险管理是值得许多大学现在给予关注的。在管理风险（以及问题或机会），有一个明确定义的每个潜在影响和可能性等级是有益的。也就是说，大多数 IT 和应用程序中的风险方法主要关注两个主要标准：

+   **潜在影响**：一些组织将以损害、减轻成本、受影响成本的百分比或其他可量化的影响来衡量这一点。这是大多数没有风险管理经验的人关注的。这是事件发生时所涉及的痛苦，比如：*被闪电击中可能会非常有害，通常是致命的 - 疼！*

+   **发生概率**：许多人忽视了适当的关注和意识过程，实际上感受到痛苦的机会就是它发生的概率。这可以用百分比或频率（每次发生的机会）来衡量（每 *x* 连接、每个账户等）。

在客户眼中理解风险管理不仅是一种表现关心的好方式，而且是理解如何构建报告的关键。如果你能帮助以客户理解的语言和背景呈现调查结果，他们就更有可能接受建设性的批评，并将输入视为有帮助。

#### 指导 - 赚取你的报酬

专业的渗透测试可能在我们攻击目标并在特别具有挑战性的环境中进行转移时更有趣，但我们并不是为了乐趣而得到报酬。我们得到报酬是为了提供指导和可操作的情报。客户雇佣我们是因为他们或者有人强迫他们雇佣我们意识到，他们无法在没有独立验证的情况下保持安全。我们提供的指导应该有事实根据，并且最好以印象总结后的行动计划形式呈现。一些客户可能会规定应该如何呈现，但在没有规定的情况下，您需要考虑如何最好地呈现调查结果。

对于具有大量漏洞的新客户进行更全面的测试可能会受益于一个分阶段的行动计划，该计划建议按照最需要的顺序处理应用程序的各个领域。在这些情况下，有助于将他们指向补救选项和预期的努力水平。客户会有很大的差异，但一般来说，您应该避免推荐与人员相关的问题，除非它们可以被视为建设性的，或者将有助于更好地准备员工。然而，一些客户可能要求员工参与评估，因此您的情况可能会有所不同。

轻量或定期测试可能只是按照最高感知严重性到最低的顺序呈现结果，而不考虑它们之间的相互依存关系。在这种情况下，这可能更容易接受，因为这是对先前测试的后续，或者结果将被纳入另一个规划工作。白盒测试结果通常会直接匹配到更大的验证和验证方法或文档，因此在这种情况下，只有在针对渗透测试的总体规范需要修改或澄清时，才有可能提供指导。

#### 详细调查结果

根据报告的范围，这一部分可能存在，也可能不存在，但对于黑盒测试或红队测试几乎是必须的。您需要确保解释所选择的向量、获得的结果以及与给定评分的相关性。对于希望重复测试和验证补救措施的客户，可能需要屏幕截图和代码片段，因此您需要确保捕获大量日志、屏幕截图，并对任何脚本和配置进行编目。为此，有一些工具可以帮助您，并且已经内置到 Kali 的发行映像中，或者可以通过最小的努力获得。

类似 Evernote 或包含的 Keepnote 的良好笔记应用程序将大大帮助您记录其他工具遗漏的任何内容。我发现这些工具选择和它们支持的工作流程与部署它们的人一样多样化，因此我绝不会判断您是否决定选择其他工具。最重要的是报告最终可以以我们的客户可以消化的格式打印和电子交付。因此，大多数测试人员仍然会发现，Apache OpenOffice（https://www.openoffice.org/download/other.html）适用于 Kali，或者 Mac 或 Windows PC 上的 Microsoft Office 套件最适合组装最终报告，并且可以使用 Adobe 或用户喜爱的办公套件打印为 PDF。

### Dradis 框架

协作和文档工具，如基于 Ruby 的 Dradis 框架，如下图所示（https://dradisframework.com/ce/）。Dradis 可以帮助我们将测试中使用的所有工具集结在一起，并提供类似 Evernote 的文档界面。使用这样的工具可以使我们保持有条理，从而确保完整覆盖并帮助制作专业报告。

社区版是免费的，而且功能强大，但专业版（在撰写本文时的价格为每月 79 美元）包括一些出色的功能，可帮助管理多个项目，利用模板和自动化工具导入，并提供技术支持（可以在此处比较免费和高级版本之间的差异：[`dradisframework.com/pro/editions.html`](https://dradisframework.com/pro/editions.html)）。 Dradis 提供了 OSCP、OWASP、PTES 和 HIPAA 的模板、方法和示例报告，其中一些功能只能在专业版中使用：[`dradisframework.com/academy/industry/compliance/`](https://dradisframework.com/academy/industry/compliance/)。

！[](img/B03918_12_04.png)

Dradis Framework with OWASP Template

Dradis 是一个很棒的选择，但在 Kali 中还有其他可用的工具！

### MagicTree

与 Dradis 类似的是一个名为**MagicTree**（[`www.gremwell.com/magictreedoc`](http://www.gremwell.com/magictreedoc)）的 Java 应用程序，来自 Gremwell。MagicTree 实际上是一个很棒的工具，可以从一个中央数据收集应用程序中提供您在早期章节中学到的许多测试。作为一个工具，MagicTree 有很多出色的功能，但我发现它在传递通常在外部运行的命令时可能有点挑剔。它还需要导出才能看到产生的工件的样子，因此，除非您能直观地理解 X-Path 变量插入和原始数据收集将会是什么样子，否则您将需要使用试错来确定 MagicTree 中对您最有效的方法。与 Dradis 不同，MagicTree 不是开源的，但可以免费获得完整功能：

！[](img/B03918_12_05.png)

Gremwell 的 MagicTree

### 其他文档和组织工具

其他利基甚至手动的文档方法当然也存在，我鼓励您尝试使用其中的一些方法来完善您的报告和文档流程。例如，我一直喜欢使用**Maltego**，我发现它对于帮助组织和展示我在报告中提供的**开源情报**（**OSINT**）是不可或缺的。**Maltego Casefile**是呈现融合的 OSINT 和社会工程结果的绝妙方式，甚至提供了捕获可能密码和类似密码的字段。在下面的截图中，我们可以看到我正在突出显示公司内的一个人，并查看他们与其他实体（位置、主机、其他人等）的关联。就像犯罪电影中的线图表显示了黑手党士兵如何向老板汇报一样，这可以帮助我们的客户快速地可视化黑客如何轻松准确地绘制组织的地图。

！[](img/B03918_12_06.png)

Maltego Casefile 组织 SET 和 OSINT 输出。

### 报告的图形

您可能会将 Kali 用作虚拟机，但万一您安装了裸机系统，您可能需要查看截图工具，以帮助您收集渗透测试中征服的视觉证据。

Kali Linux 内置了有限的选项，包括**recordmydesktop**和**cutycapt**。我更喜欢使用**Screenshot**和**Shutter**等工具。Screenshot 或类似工具如**Scrot**相当基本，但 Shutter 提供了一些选项和更高级的管理界面。如果我需要处理图片，我会使用 GIMP（[`www.gimp.org)`](https://www.gimp.org)是一个功能齐全的编辑器，适用于大多数平台，包括 Kali。同样，这取决于您自己的背景和风格，因此请尽管制定自己的计划！

### 注意

请记住，这些技能也将在制作您的流氓蜜罐和水冷攻击时发挥作用，使您能够打造逼真而恶意的门户，以帮助您 compromise targeted users and further your testing - 谈论双重用途！

## 带来最佳实践

* * *

参与网络安全，尤其是攻击性的最好部分之一是，我们可以从我们的培训和过去的工作经验中带来经验和专业知识。所有的辛劳和泪水都不是白费的；这些伤疤实际上会派上用场。我们测试的赞助商处境艰难。在目标环境中工作，他们往往没有跨行业、架构类型和规模的环境视角。在许多情况下，他们的员工没有当前的应用安全培训，无法帮助他们跟上趋势和即将到来的威胁。

因此，现在，有趣的部分来了，我们需要保持我们的认证，不断更新我们的知识库，并找到方法从早期的参与中汲取经验教训。通过 SANS、ISSA、OWASP 等会议绝对值得参加——大多数提供培训和许多新工具和技术的曝光。在线保持更新应该是理所当然的：Twitter、LinkedIn 和大量的博客可以成为零日漏洞和最紧迫的新闻的情报来源，这些新闻会让我们的客户感到不安，并证明我们的存在是有必要的。

那么我们如何提供他们所寻求的帮助呢？我们在哪里介入我们被聘用的经验？让我们看看一些关于如何使我们的报告和简报对团队更有用的想法。

### 融入安全性

应用团队和 IT 组织一般面临着一个不可能的折衷：要么安全，要么高效。这在很大程度上源自过去，安全是在架构或应用程序开发和部署之后才被添加上去的。随着应用程序变得更加复杂，其重要性急剧上升，后期添加的安全方法已经不再适用。当应用程序对安全毫无意识，而安全解决方案只是简单地叠加在顶部时，这种脱节会妨碍可见性，并迫使某人在调整之前手动识别问题。如下截图所示（来源于[`blogs.msdn.microsoft.com/usisvde/2012/03/09/windows-azure-security-best-practices-part-3-identifying-your-security-frame/`](https://blogs.msdn.microsoft.com/usisvde/2012/03/09/windows-azure-security-best-practices-part-3-identifying-your-security-frame/)），即使是一个简单的 Web 应用程序也有太多的执行点，以至于应用程序的安全性必须融入到架构中。这个插图没有显示的是同时需要在每一步实际感知和相关事件，并将其与从架构中其他组件中获得的情报相结合，以确定何时发生攻击。

![](img/B03918_12_07-1.png)

根据微软，应用程序的执行点

不同的框架和托管范式将有不同的需求和优势，但客户应该了解需要在业务需求旁边开发的额外措施，以解决覆盖范围中的任何差距。根据您与客户的关系，可能需要引导他们达到这种理解，或者在他们的理解范围内工作，帮助他们客观地看待他们的应用程序。

#### 完善 SDLC

白盒测试可以并且应该在**软件开发生命周期**（**SDLC**）的各个阶段进行，早期发现的问题可以比在 SDLC 后期更便宜、更快速地得到纠正，在某些程序中，纠正成本可能增加 100 倍。与前面讨论的 RM 过程密切相关，OWASP 在下面的截图中提出并记录了安全 SDLC（[`www.owasp.org/index.php/Secure_SDLC_Cheat_Sheet`](https://www.owasp.org/index.php/Secure_SDLC_Cheat_Sheet)）[并应该成为标准做法：](https://www.owasp.org/index.php/Secure_SDLC_Cheat_Sheet)

![](img/B03918_12_08.png)

OWASP 的安全 SDLC

显然，这需要不仅仅是一份书面政策；它要求有专注于安全的开发人员，或者更好的是渗透测试人员，协助进行。安全 SDLC 可以阐明白盒测试覆盖的程度，并且应该包括任何外部灰盒或黑盒测试*门*，以确保安全性被驱动到应用程序中。

最成熟的流程甚至可以在更大的开发环境中集成连续测试和始终开启的仪表板。我们还应该记住，我们作为潜在的外部顾问使用的工具可能与他们的开发团队或内部渗透测试人员使用的工具不同，而且这几乎总是件好事。

一些公司，如 Veracode（[`www.veracode.com`](http://www.veracode.com)），提供了关于他们如何在其产品工作流程中进行最佳测试的详细信息。在下面的高级方法论截图中，你可以看到他们试图整合培训的各个方面--人员、开发阶段、角色、应用程序的组件等等。虽然这些模板在你的实践早期确实提供了一些价值，但它们绝不是穷尽和强制性的；你可以制定和修改自己的内部流程，而且很可能你的客户也已经这样做了，以保持我们的警惕。关键在于将我们的客户流程与他们部署的工具相匹配。他们会发现，当工具按照开发人员的意图运行时，它们的工具集会更加高效。

![](img/B03918_12_09.png)

Veracode 自己的测试生命周期

#### 角色扮演 - 启用团队

在测试和教育客户的过程中，你还有机会指导和分享见解。开发、维护和操作应用程序的员工通常没有接受承担这样负担所需的培训。角色可能也不清晰，我经常遇到一些客户，尽管在环境中运营多年，仍然没有明确的权力分离和责任。这最后一点远远是我遇到的系统效率低下和安全漏洞的最大指标。因此，重要的是你理解今天存在的层次结构，并帮助客户填补这些空白，同时识别需要他们关注的其他领域或学科。

他们对事件的自己的反应是有帮助的，理解这一点很重要。我在帮助客户理解事件或流程可能出现问题的地方时，从**RACI 矩阵**（**负责人**，**负有责任的**，**征询意见的**和**知情的** - [`racichart.org`](http://racichart.org)）中获得了很多收益。我们最关心的是对我们发现的问题进行纠正，但我们可以为任何 IT 流程部署这种技术，以帮助他们理解一般流程和角色。在下面的截图中，我们看到了一个事件响应流程，但业务连续性、灾难恢复、漏洞纠正等许多其他流程也可以使用这种快速而简单的练习来表达：

![](img/B03918_12_10.png)

IR 的样本 RACI 矩阵

还需要角色来确保环境内定义和执行适当的管理、审计和用户访问。你将揭示的许多发现可以通过谨慎的**基于角色的访问控制**（**RBAC**）和责任分割来减轻。如果客户的环境尚未实施 RBAC，这应该始终作为你的建议中的最佳实践提供。

#### 挑选一个赢家

我们的每个建议都需要让我们远离模棱两可，否则我们就不应该提供它。这些建议可以来自我们的经验，但我们应该尽可能地加强它们，包括软件组件的创建者、权威人士以及提供同行评审指导的安全分析师的建议。安全研究团队的数量可能令人困惑，但最受尊敬的团队具有全球范围和良好的知名度，有助于引导行业朝着更好的政策和架构发展。一些在遭受侵犯时监视和检查的最佳网站如下：

+   NIST: [`nvd.nist.gov`](https://nvd.nist.gov)

+   MITRE: [`cve.mitre.org`](https://cve.mitre.org)

+   US CERT: [`www.us-cert.gov/ncas`](https://www.us-cert.gov/ncas)

+   Google: [`research.google.com/pubs/SecurityPrivacyandAbusePrevention.html`](https://research.google.com/pubs/SecurityPrivacyandAbusePrevention.html)

+   Dark Reading: [`www.darkreading.com/vulnerabilities-threats.asp`](http://www.darkreading.com/vulnerabilities-threats.asp)

+   ThreatPost: [`threatpost.com/category/web-security/`](https://threatpost.com/category/web-security/)

在向客户提出解决方案时，我们应该尽量明确。特别是在架构变更方面，需要清晰简明的理由和行动计划。您可能会发现您的客户更希望得到更少的建议，而更多的是意识；您应该在一开始就澄清所需的响应。我还建议在适用的情况下，与您的团队一起对报告进行内部同行评审，因为越多的人看最终产品，最终结果就会更好。

### 计划和程序

我们的客户都会因为拥有一个所有人都理解的标准流程而受益匪浅，这个流程不仅可以帮助他们测试和检测漏洞，还可以让他们对漏洞进行优先级排序、解决和记录响应。较小的应用程序组将无法将资源专门用于这个特定的努力，因此，在许多方面，他们需要寻找方法将几个必要但需求资源的过程合并为一个单一的程序。OWASP 通过其名为**全面、轻量级应用安全流程**（**CLASP**，[`www.owasp.org/index.php/CLASP_Concepts`](https://www.owasp.org/index.php/CLASP_Concepts)）的程序来解决这个问题。OWASP 将其设想为*一组以活动驱动、基于角色的流程组件，其核心包含了将安全性规范化地纳入现有或新启动的软件开发生命周期的最佳实践*。

正如下面的截图所示，这个过程是围绕着对公司 SDLC 各个方面的深入视图构建的，并整合了风险管理、变更管理、资源规划和角色分配。

![](img/B03918_12_11.png)

OWASP 的漏洞管理 CLASP 框架

OWASP 最近更多地关注了通用指南的制定，而不是规范性的程序，指出更详细和严格的程序可能更难被采纳，并忽视了已经存在的安装程序。CISO 的**应用安全指南**（[`www.owasp.org/index.php/Application_Security_Guide_For_CISOs`](https://www.owasp.org/index.php/Application_Security_Guide_For_CISOs)）是这些努力的成果，它为更注重安全的企业提供了跨人员、流程和技术的指导。除了这些指南，**软件工程研究所的能力成熟度模型**（**SEI CMM**，[`cmmiinstitute.com`](https://www.sei.cmu.edu/cmmi/)）、**构建安全成熟度模型**（**BSIMM**，[`www.bsimm.com`](https://www.bsimm.com)）和**开放软件保障成熟度模型**（**SAMM**，[`www.opensamm.org`](http://www.opensamm.org)）都与新指南兼容，为 CISO 及其应用程序、网络和安全团队提供了自由，以实施这些最佳实践并根据需要吸收这些想法。

#### 更多关于变更管理

**变更管理**（**CM**）是 IT 中任何人都喜欢讨厌的那些流程之一，但它起着至关重要的作用。CM 提供了一个结构，所有对运营或生产环境的变更都必须在其中进行。有了这个流程，理论上所有利益相关者都能意识到变更并适当地权衡。我们都曾处于流程过于松散（导致遗漏）或过于严格（人们试图避开或进展停滞）的情况下。我认为我们都可以同意 CM 是必要的，漏洞修复和违规响应也不例外。也就是说，我们需要确保 CM 流程足够灵活，以便在安全的名义下采取果断行动，同时确保所有受影响的方都已经接受。

#### 自动化和适应

积极的安全策略是我们应该鼓励的，但还没有得到足够客户的认可。这是一个小客户群体的问题。投资于自动化工具集和漏洞修复的组织领先一步，许多商业供应商提供可以自动集成到应用环境中的解决方案集，并提供带有情报源的持续分析。

开源工具在这方面也有帮助，但实际上有几种自动化工具的部署方式：

+   **静态应用安全测试**（**SAST**）通常侧重于 SDLC 的早期阶段，并集中于代码和模块使用，更像是一个白盒测试工具。源代码分析是 SAST 方法中最普遍的，因为它与代码本身紧密相关，这些工具通常集成在开发环境中，有时由同一软件供应商提供。这些工具实际上检查已知漏洞和最佳实践的代码，标记出问题的代码片段。再次，像 IBM、HPE 和 Veracode 这样的重量级公司有助于更早地发现问题，从而使修复更便宜更快。可以在[`www.owasp.org/index.php/Source_Code_Analysis_Tools`](https://www.owasp.org/index.php/Source_Code_Analysis_Tools)找到一个很好的列表。

+   **动态应用程序安全测试**（**DAST**）侧重于 SDLC 的后期阶段，在这个阶段，一个接近代表性的应用程序已经建立起来，可以像我们用 Arachni 进行黑盒测试一样进行探测和评估。这些工具，就像我们基于 Kali 的套件的大部分工具一样，工作在应用程序的边缘，扫描、枚举和操纵请求和响应来诊断问题。因此，这些工具没有像 SAST 那样有捕捉的潜力，但它们更好地模拟了外部威胁。我们已经使用了一些这样的工具；Tenable 和 Rapid7 似乎是市场领导者，但在[`www.owasp.org/index.php/Category:Vulnerability_Scanning_Tools`](https://www.owasp.org/index.php/Category:Vulnerability_Scanning_Tools)上列出了一些其他选项。

+   **交互式应用程序安全测试**（**IAST**）是竞技场上的一个相对新手，它使用应用程序中的代理来帮助实时识别漏洞。工具的独特定位使其能够在一个套件中解决 SAST 和 DAST 所做的大部分事情。DAST 和 SAST 在使用时通常一起使用，以确保揭示两个方面的缺陷，而 IAST 已经在做到这一点。许多已经建立起来的 SAST/DAST 供应商正在进入这个市场，或者迅速迁移他们的解决方案以提供这种能力，同时试图最小化运行这些代理所隐含的性能影响。

+   **移动应用程序安全测试**（**MAST**）类似于移动设备的 IAST，代理分布在一些或所有移动客户端中，以帮助提供遥测。

+   **运行时应用程序安全保护**（**RASP**）也类似于 IAST，只是代理实际上充当实时分布式执行点，帮助实时修复或补丁被侵犯的系统。这项技术非常新颖，人们对它们是否总体上是一件好事还有疑虑，或者它们是否会造成一种虚假的安全感。像 HPE、Whitehat Security、Veracode 和 IBM 这样的老牌公司在这里提供服务，但新公司如 Immunio 和 Contrast 也在这一领域崭露头角。

我们的测试不应该对这些工具视而不见，而应该补充它们，并在正确实施两种工具集时验证它们的有效性。一些供应商甚至正在扩展到与环境中的其他元素自动化，像 Imperva 这样的公司现在宣称他们的**Web 应用程序过滤**（**WAF**）产品可以与漏洞扫描器实时工作，阻止威胁。

## 评估竞争

* * *

我们讨论过的许多 DAST 工具都可以挑战我们在 Kali 中使用的工具（如 Arachni、Nikto、Burp、ZAP 等），用于我们首选的渗透测试工具包。我假设每个阅读本书的人都习惯于根据自己最喜欢的工作方式做出自己的选择，因此除了所有的工具选项之外，我认为讨论一些备选操作系统和工具套件可能会有所帮助，这样你在回到 Kali 之前可能会想要评估一下。毕竟，看到我们拥有多么好的东西总是很好的。

### Backbox Linux

Backbox ([`backbox.org/linux`](https://backbox.org/linux)，如下图所示)是一个基于 Ubuntu 的渗透测试和安全发行版，来自一些意大利人，可能比 Kali 更容易使用，作为一个带有安全倾向的通用桌面。它包括许多相同的工具，因此真正的问题在于你是更喜欢 Kali 的 Debian/XFCE 外观和感觉，还是 Backbox 更加精致的 Ubuntu 布局。

![](img/B03918_12_12.png)

Backbox Linux 主屏幕

### 武士网页测试框架

武士 WFT，如所知（如下图所示，[`samurai.inguardians.com`](http://samurai.inguardians.com)）是基于 Ubuntu Linux 的 Live-CD 版本，专注于他们的四阶段方法（侦察，映射，发现和利用）对 Web 应用程序进行渗透测试。其他功能被搁置，他们将整个过程编织到他们内置的维基中，这在很大程度上就像他们的 Dradis 替身。

![](img/B03918_12_13.png)

武士 WTF 菜单

### Fedora Security Spin

在渗透测试领域，很多关注都集中在 Ubuntu/Debian 的 Linux 分支上，这可能是因为它们是最广泛使用的桌面 Linux 发行版。这并不意味着你不能使用一些经典的 Red Hat/Fedora 的东西！Fedora Security Lab 是 Fedora 的一个 Spin（定制分支），它融合了我们在 Kali 中喜爱和珍视的许多工具，但是在基于 RPM 的世界中重新编译和管理。如果 Red Hat、Centos 或 Fedora 是你的菜，你可以轻松地在 Fedora Security Spin 上运行起来（[`labs.fedoraproject.org/en/security/`](https://labs.fedoraproject.org/en/security/)，如下所示）。

![](img/B03918_12_14.png)

Fedora Security Spin/Lab

### 其他 Linux 渗透测试发行版

如果前面的选项不符合您的需求，还有许多其他选择。以下是一个小列表：

+   Knoppix-STD: [`s-t-d.org`](https://s-t-d.org)

+   Bugtraq: [`archiveos.org/bugtraq/`](https://archiveos.org/bugtraq/)

+   Weakerth4n: [`www.weaknetlabs.com`](http://www.weaknetlabs.com)

+   CAINE: [`www.caine-live.net`](http://www.caine-live.net)

### Windows 和 macOS 怎么样？

嗯，这本书主要讲的是使用 Kali 进行 Web 应用程序渗透测试，但是如果我不提到 Windows 和 macOS 平台都能够运行我们讨论过的许多工具，或者运行类似的工具，那就不够完整了。Burp Suite，Metasploit，Arachni 等等，都有适用于这两个平台的版本，标准工具如 Nmap 和 Nikto 也是如此。简而言之，如果你实在无法忍受运行 Linux，或者需要临时解决方案，这些操作系统也可以。不过，不要指望在 Defcon 或 Blackhat 会议上受到太多关注，因为他们往往是纯粹主义者。

## 总结

* * *

Web 应用程序渗透测试是深入、复杂且不断变化的。另一方面，它对于部署 Web 应用程序的所有企业（也就是所有企业）来说也是至关重要且具有很高的价值。正是因为这些原因，我们必须准备好帮助我们的客户解决其应用程序的安全性问题，避免成为头条新闻。记住，我们不仅要测试平台，而且我们经常是其他应用程序的客户，我希望我使用的 Web 应用程序经过了严格的测试，并且发现得到了适当的处理。

在本章中，我们从测试本身退后一步，讨论了如何呈现发现结果，使我们的客户更接近那个最高贵的目标，即*安全*。我们看到，不仅我们的报告和沟通可以帮助，而且建立一个明确定义*那么，现在发生了什么？*的安全程序和流程也可以帮助。通过做好我们的工作，我们可以帮助避免困扰当今社会的侵犯和妥协。世界上没有人能够逃脱潜在的危害，所以我们有责任产生影响，当涉及到保护时。

不用说，但是您在本书中学到的工具和技术以及您的持续练习有两种截然相反的用途。我们需要确保我们使用我们的技能和资源来改善我们客户的环境，而不是为了造成伤害或恶意攻击。权限和意图都应该清晰、明确并有记录。

我真的很享受与你们一起阅读这本书的过程——这是一次美妙的学习经历，我们从进行一般的渗透测试到深入研究 Web 应用程序学科。正如我们所看到的，这是一项值得的和高尚的事业，我希望这本书能帮助你们提高甚至掌握可以使用的技能。如果有什么，我希望你们都对学习和掌握更多知识充满好奇，并且积极行动，成为你们领域的倡导者。祝你们愉快地黑客，好运！
