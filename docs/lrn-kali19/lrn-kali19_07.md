# 第五章：被动信息收集

开始从事道德黑客和/或渗透测试工作可能会非常令人兴奋，大多数情况下，我们的思维会有些不知所措，导致我们只阅读这样一本书中有关利用系统的章节。然而，进行渗透测试就像在家里开始一个新项目。在你的后院建造游泳池之前，有一些事情你必须考虑，比如可用空间、材料成本、承包商费用和其他细节。信息收集是黑客生命周期和渗透测试的非常重要的阶段。

在本章中，我们将专注于被动信息收集技术和方法。我们将学习如何利用互联网通过在线资源和 Kali Linux 上的工具获取有关目标的信息和具体细节。

我们将涵盖以下主题：

+   侦察和足迹

+   了解被动信息收集

+   了解**开源情报**（**OSINT**）

+   使用顶级 OSINT 工具

+   识别目标技术和安全控制

+   在云资源中查找数据泄漏

+   了解 whois 和使用 HTTrack 复制网站

+   使用 Sublist3r 查找子域

亲爱的读者！请确保您在没有适当的**法律许可**的情况下**不要**对任何目标组织、网络或系统进行扫描。

# 技术要求

本章的技术要求如下：

+   **Kali Linux**: [`www.kali.org/`](https://www.kali.org/)

+   **Maltego**: [www.paterva.com](http://www.paterva.com)

+   **Recon-ng**: [`bitbucket.org/LaNMaSteR53/recon-ng`](https://bitbucket.org/LaNMaSteR53/recon-ng)

+   **theHarvester**: [`github.com/laramies/theHarvester`](https://github.com/laramies/theHarvester)

+   **OSRFramework**: [`github.com/i3visio/osrframework`](https://github.com/i3visio/osrframework)

+   **HTTrack**: [www.httrack.com](http://www.httrack.com)

+   **Sublist3r**: [`github.com/aboul3la/Sublist3r`](https://github.com/aboul3la/Sublist3r)

+   **S3Scanner**: [`github.com/sa7mon/S3Scanner`](https://github.com/sa7mon/S3Scanner)

# 侦察和足迹

黑客攻击的各个阶段包括侦察、扫描、获取访问权限、保持访问权限和清除痕迹。侦察阶段是渗透测试中最重要的阶段，因为这是道德黑客或渗透测试人员进行广泛研究，尽可能收集有关目标的信息的阶段。此外，足迹将有助于创建目标的概况，收集诸如运行服务、开放端口和操作系统等概况信息。

现在我们将更详细地了解侦察和足迹。

# 侦察

从军事角度来看，侦察是对敌方目标的观察和研究。在网络安全领域，作为渗透测试人员，我们使用各种工具和技术来收集有关目标组织及其基础架构的详细信息。

侦察在渗透测试领域至关重要。作为渗透测试人员，我们在尝试通过利用获取访问权限之前，绝对需要了解我们的目标及其漏洞和操作系统。在侦察阶段收集的信息将帮助我们选择正确的工具和技术成功地利用目标。

侦察可以分为两类：

+   **被动**: 使用间接方法，不与目标进行互动

+   **主动**: 直接与目标互动以收集具体细节

接下来，我们将深入了解足迹。

# 足迹

足迹定位是指尽可能收集与目标相关的信息的过程。在足迹定位中，目标是获取有关目标的特定细节，例如其操作系统和正在运行的应用程序的服务版本。收集到的信息可以以各种方式用于获取对目标系统、网络或组织的访问权限。足迹定位允许渗透测试人员了解目标基础设施的安全状况，快速识别目标系统和网络上的安全漏洞，创建组织的网络地图，并将焦点缩小到需要信息的特定 IP 地址、域名和设备类型。

足迹定位是侦察阶段的一部分；然而，由于足迹定位能够提供有关目标的更具体的细节，我们可以将足迹定位视为侦察阶段的一个子集。以下图表提供了侦察和足迹定位如何结合在一起的视觉概述：

![](img/83f455f3-b446-4a4f-81fc-897bbc93caf0.png)

以下是足迹定位的主要目标：

+   收集网络信息（域名，IP 寻址方案和网络协议）

+   收集系统信息（用户和组名称，路由表，系统名称和类型）

+   收集组织信息（员工详细信息，公司目录和位置详细信息）

要成功获取有关目标的信息，我建议使用以下足迹定位方法：

+   检查雅虎、必应和谷歌等搜索引擎

+   执行 Google 黑客技术（高级 Google 搜索）

+   通过 Facebook、LinkedIn、Instagram 和 Twitter 等社交媒体平台收集信息

+   对公司网站进行足迹定位

+   执行电子邮件足迹定位技术

+   使用`whois`命令

+   执行 DNS 足迹定位

+   网络足迹技术

+   社会工程学

您现在能够区分侦察和足迹定位。在渗透测试期间，侦察和足迹定位都是必需的，因为每个都提供有关目标的重要信息。在下一节中，我们将深入探讨被动信息收集。

# 了解被动信息收集

被动信息收集是指使用间接方法获取有关目标的信息。这种方法获取的信息来自许多公开来源，因此消除了与潜在目标的直接联系。被动信息收集通常是富有成效的，许多组织通常会为现有和潜在客户发布有关其组织的信息和细节作为营销策略。有时，当组织在招聘网站上发布职位空缺时，招聘人员会发布潜在候选人的技术要求。从渗透测试人员的角度来看，技术细节可以指示组织网络基础设施中正在运行的平台和应用程序类型。

我们已经介绍了被动信息收集的概念。现在，让我们在下一节中深入学习有关 OSINT 的知识。

# 了解 OSINT

如前所述，渗透测试的第一阶段是尽可能收集有关给定目标或组织的信息。在利用和获取对网络或系统的访问权限之前收集信息将有助于渗透测试人员缩小攻击范围，并设计适合目标攻击面的特定类型的攻击和有效载荷。我们将通过利用现有的最大计算机网络——互联网来开始我们的信息收集阶段。

以下图表提供了 OSINT 可以在目标上找到的不同领域的简要概述：

![](img/9d902dc8-5baa-422c-a783-f04f903ddc2a.png)

互联网上有许多平台，从论坛和消息板到社交媒体平台。许多公司创建在线存在，以帮助将其产品和服务营销给潜在客户。这样做，公司的网站、Facebook、Instagram、Twitter、LinkedIn 等的创建确保他们的潜在客户了解他们是谁，以及提供了哪些服务和产品。市场部门通常负责确保组织的在线存在，并且他们的数字投资组合始终是最新和吸引人的。

组织通常在各种互联网平台上发布有关自己的信息，例如博客和招聘网站。由于互联网如此易于获取和访问，某人很容易仅通过使用搜索引擎并确定其基础设施来收集有关目标组织的信息。这种技术被称为**OSINT**。

这是渗透测试人员或道德黑客使用各种工具和技术，利用互联网上公开的信息来创建目标的投资组合。 OSINT 是一种被动信息收集类型，渗透测试人员不直接与实际目标联系或连接，而是向合法可靠的来源询问有关目标的信息。

多年来，我注意到了许多求职网站，招聘人员在公司内发布 IT 职位的空缺，但招聘人员指定理想的候选人应具有特定技术的经验。这对公司和申请人可能是一件好事；然而，它也可能是坏事。以下是公司在招聘网站上发布其技术的利弊：

这些是利：

+   潜在的候选人将知道如果被聘用，可以期待什么样的环境。

+   潜在的候选人可以事先确定他们是否具有工作所需的技能。

这些是坏处：

+   公司部分向公众暴露他们的技术。

+   黑客可以确定基础设施，并更好地选择利用和工具来执行网络攻击。

让我们看一下来自招聘网站的以下截图。仔细观察，我们注意到招聘者指定他们正在使用思科和惠普的网络技术，公司使用 AVAYA PBX 系统作为他们的**互联网协议语音**（**VoIP**）系统，并且他们在网络中运行 Windows Server 2008 和/或 2012：

![](img/5ed102d6-24c7-4a91-b078-ed787f37f92b.png)

作为渗透测试人员，我们可以看到公司在其 IT 基础设施中使用特定类型的技术。从渗透测试人员的角度来看，如果这个组织是我们渗透测试的目标，我们现在可以将我们的攻击范围缩小到这些特定的技术。

既然我们已经完成了对 OSINT 更好理解的部分，让我们深入了解使用 OSINT 工具的实际操作。

# 使用顶级 OSINT 工具

在本节中，我将演示一些适用于 Kali Linux 的最流行的 OSINT 工具。每个工具都将帮助我们使用互联网上可以找到的各种信息来源创建有关目标的概况。

在接下来的几个子节中，我们将介绍以下 OSINT 工具：

+   Maltego

+   Recon-ng

+   theHarvester

+   Shodan

+   OSRFramework

现在，让我们深入了解这些令人惊奇的工具。

# Maltego

Maltego 是由**Paterva** ([www.paterva.com](https://www.paterva.com/web7/))创建的图形交互式数据挖掘应用程序，具有从互联网上的各种来源查询和收集信息并以易于阅读的图形呈现数据的能力。这些图表展示了每个实体与目标之间的关系。

要开始使用，您需要用户帐户来访问 Maltego 的功能和特性：

1.  转到[www.paterva.com](https://www.paterva.com/web7/)，然后点击**社区**。将会出现一个下拉菜单。点击**注册（免费）**以创建用户帐户：

![](img/8291a374-1276-4637-b75a-c13685dbdc2b.png)

1.  创建用户帐户后，请确保在登录之前验证您的电子邮件地址。完成此步骤后，返回到您的 Kali Linux 桌面。点击应用程序|收藏夹|maltego 打开**Maltego**工具，如下面的屏幕截图所示：

![](img/38ef8e4c-9b5c-46d9-889a-ecfc081d8120.png)

1.  应用程序打开后，点击 Maltego CE（免费）以配置和运行 Maltego 的社区版：

![](img/4341b8fe-99a6-42f9-b5dd-1fee609bbcc6.png)

1.  接下来，您将看到 Maltego 配置向导。确保使用您之前在 Paterva 网站上创建的相同用户帐户登录，然后点击下一步。阅读并遵循配置向导的接下来几个步骤中出现的说明。您可以将一切保持默认状态，然后点击下一步直到过程结束：

![](img/5dff9202-55d9-40ac-8e9e-758b8385297c.png)

1.  配置窗口关闭后，将显示一般的 Maltego 界面，如下面的屏幕截图所示。在起始页面上，有许多可以添加到 Maltego 的变换集。**变换**是 Maltego 可以查询信息的开源资源。添加变换是可选的：

![](img/02f823b7-33da-4d81-b1c9-c15a38e250e3.png)

1.  要开始收集有关目标组织的信息，我们必须首先打开一个新图。要做到这一点，点击左上角的 Maltego 图标，然后点击**新建**。创建新图后，您将在左侧看到各种类型的信息（实体），而在右侧，您将看到概述、详细视图和属性视图。

1.  添加公司的域名，点击并拖动域实体到图的中心。默认情况下，`paterva.com`将出现为目标域。让我们将域值更改为其他内容。在界面的左侧，点击**属性视图**。您将能够编辑**域名**字段中的值，如下面的屏幕截图所示：

![](img/87486934-78f0-423e-b527-5f1036e0934a.png)

1.  域名更改后，我们可以继续并解析域的网站 URL。右键单击域实体，点击所有变换，然后选择到网站[快速查找]。这个变换将简单地发现网站地址（参考左侧的屏幕截图），并显示关系（参考右侧的屏幕截图）：

![](img/fc656e7a-c856-4650-9094-d42626d49105.png)

1.  接下来，我们可以尝试获取网站地址的 IP 地址。右键单击网站地址（[www.google.com](http://www.google.com)）|所有变换|到 IP 地址（DNS）。右侧的屏幕截图显示了为[www.google.com](http://www.google.com)解析的 IP 地址。请注意，这是用于[www.google.com](http://www.google.com) URL 的众多 IP 地址之一：

![](img/b31fb2f1-6fa4-4847-99dc-cbae0c0db5be.png)

1.  我们甚至可以进一步进行这个阶段。试试发现作为[google.com](http://google.com)域的一部分的**顶级域**（**TLDs**）。要完成此任务，我们首先右键单击域实体（[google.com](http://google.com)），然后选择**到域[查找其他 TLDs]**，如左侧的屏幕截图所示。一旦变换完成，Maltego 将在图平面上以树状结构呈现信息，如右侧的屏幕截图所示：

![](img/b751d501-e76f-4046-b1c1-0c0fcd84f055.png)

1.  现在，让我们来收集注册到域的联系人的电子邮件地址。我们可以右键单击 IP 地址实体 | 所有变换 | 转换为电子邮件地址[来自 whois 信息]。如果有任何电子邮件地址，它们将显示出来，如右侧的屏幕截图所示。

![](img/162dd62d-c832-4d63-ab58-ceb550fa714c.png)

1.  此外，我们可以尝试获取该域的**名称服务器**（**NSes**）。右键单击域实体（`google.com`）| 所有变换 | 转换为 DNS 名称 - NS（名称服务器）。域的所有 NSes 将被呈现，如右侧的屏幕截图所示。

![](img/cc6bd0c1-5656-44b0-9a2f-6350bdd19ab7.png)

现在，您对 Maltego 的功能和如何浏览各种变换有了更好的了解。Maltego 的一个很好的功能是图上的关系映射，帮助您分析信息和实体。

完成了这一部分，您现在已经熟悉了使用 Maltego 收集信息。在下一部分中，我们将使用基于 Python 的工具来帮助我们进行被动信息收集。

# Recon-ng

Recon-ng 是一个用 Python 编写的 OSINT 侦察框架。该工具本身具有自己的模块、数据库、交互式帮助和菜单系统，类似于 Metasploit。Recon-ng 能够使用各种开源平台执行基于 Web 的信息收集技术。

Recon-ng 已经是 Kali Linux 工具库中的一部分。要访问 Recon-ng 的界面，只需单击左上角的**应用程序**以展开应用程序菜单，然后选择**01 - 信息收集**。您应该会看到**recon-ng**。单击它以打开该框架：

![](img/7efc385b-1655-4bfd-88a6-d7add7b3e8ed.png)

此外，您可以打开 Linux 终端窗口并输入`recon-ng`来运行该框架。

要下载并设置最新版本的 Recon-ng，请使用以下说明：

1.  在终端上执行以下配置以下载最新版本的 Recon-ng 并安装它：

```
git clone https://github.com/lanmaster53/recon-ng.git
cd recon-ng
pip install -r REQUIREMENTS
./recon-ng
```

完成后，您的屏幕应与以下屏幕截图类似：

![](img/6a746ce7-c296-4942-8a70-6f71732d1146.png)

1.  如果没有安装或启用任何模块，请使用以下命令将所有模块安装到 Recon-ng 上：

```
marketplace install all 
```

您还可以使用`modules reload`命令重新加载所有模块。

现在 Recon-ng 框架已经打开，让我们通过以下说明熟悉其界面：

1.  要查看**Recon-ng v5**中的所有模块，我们必须使用`modules search`命令查看所有可用模块的列表。所有模块将按其类别（`Discovery`、`Exploitation`、`Recon`、`Reporting`等）呈现，如下面的屏幕截图所示：

![](img/f9113e94-29fa-49f3-85eb-be244ada9d32.png)

作为渗透测试人员，您可能会在整个职业生涯中为多个组织使用相同的工具。我们可以在 Recon-ng 中创建工作空间，以帮助更有效地隔离我们的项目/数据。如果您仔细观察命令行界面，您会看到方括号之间的单词`default`。这意味着我们当前在 Recon-ng 的默认工作空间中。

1.  要创建一个工作空间，我们可以使用`workspaces create <worksplace-name>`命令。我们将创建一个名为`pentest`的新工作空间。在 Recon-ng 界面中使用`workspaces create pentest`命令。

1.  要查看所有现有工作空间并验证我们新工作空间的创建，我们可以使用`workspaces list`命令：

![](img/07d6a248-5114-4706-b12c-e671ea3d7d3d.png)

1.  要使用`pentest`工作空间，请使用`workspaces select pentest`命令。您的命令行界面上的工作空间应该会改变。

1.  现在我们已经将一个公司及其域添加到我们的数据库中，让我们搜索一个执行`whois`查找的模块。我们可以使用`modules search whois`命令，其中`whois`是关键字或搜索条件：

![](img/d9c4c77a-af5d-481c-94d6-c56fb335b714.png)

1.  我们将使用**point-of-contacts** (**POCS**)模块来获取与该域相关的人员的更多详细信息。要执行此操作，请执行`modules load recon/domains-contacts/whois_pocs`命令。使用`info`命令将为您提供模块的描述以及是否需要额外的参数：

![](img/5cff0e6b-9c0b-4b72-a179-0d7a588a47f0.png)

`default`值是由模块的开发者设置的；为 Recon-ng 中的每个模块设置自己的源。此外，您可以使用`info`命令查看有关模块的详细信息。`input`命令将列出模块`SOURCE`组件的输入值。`input`命令对于验证特定模块的`SOURCE`值非常有用。

1.  让我们将`SOURCE`值设置为`microsoft.com`；可以通过使用`options set SOURCE microsoft.com`命令来完成，如下面的屏幕截图所示：

![](img/8584d219-19ee-4128-99fa-999f69d09cae.png)

1.  一切设置正确后，使用`run`命令来执行该模块对该域的分析。模块完成分析后，我们可以使用`show contacts`命令来查看信息列表，如人的名字、姓氏、电子邮件地址、地区和国家。

正如您所看到的，Recon-ng 是一个非常强大的工具，能够很好地处理数据管理。组织通常为许多目的创建子域；有些可以用作登录门户，或者只是网站上的另一个目录。 

要获取目标的子域列表，请遵循以下步骤：

1.  让我们通过使用`modules search site`命令来搜索合适的模块。Recon-ng 将返回一些包含`site`作为名称一部分的模块。

1.  我们将使用`google_site_web`模块。只需执行`modules load recon/domains-hosts/google_site_web`命令：

![](img/0bec6f46-8f3a-42b5-8616-2680c53f9a19.png)

1.  接下来，让我们通过使用`options set SOURCE microsoft.com`命令来更改此模块的`SOURCE`值，如下面的屏幕截图所示：

![](img/a7f70d49-7946-4844-9303-d05ef6867558.png)

1.  使用`run`命令来执行此模块。

1.  一旦模块完成了查询，使用`show hosts`命令来查看为`microsoft.com`域找到的子域的列表：

![](img/8bcd2fed-abaf-4ed4-8f3c-75f6e90b3d43.png)

1.  现在，让我们来点更有趣的。如何获取子域的 IP 地址？为此，我们将运行`module load recon/domains-hosts/brute_hosts`命令，并将`SOURCE`值设置为`microsoft.com`：

![](img/9de944c7-a7a7-403a-98ac-c2b8d650faf9.png)

1.  一旦模块执行完成，再次使用`show host`命令。您应该看到与子域对应的 IP 地址：

![](img/7d4a1dc5-851c-48cf-b314-a8c09f2a8e32.png)

作为渗透测试人员，编写报告可能会非常压倒，因为报告是对执行的操作和获得的结果的总结，而您在执行各种任务并使用多种工具时获得了这些结果。Recon-ng 有一些报告模块，能够以多种格式生成报告。`dashboard`命令将提供使用 Recon-ng 执行的任务的摘要，如下所示：

![](img/5fc81f6a-63e3-4c34-aaf9-fe0292eb0d91.png)

要生成报告，可以使用`modules search report`命令。这将让您在 Recon-ng 界面中查看报告模块的列表。我们将创建一个 HTML 格式的报告。要创建报告，请执行以下步骤：

1.  执行`modules load reporting/html`命令。

1.  使用`options set CREATOR`命令来设置报告的创建者。

1.  使用`options set CUSTOMER`命令来设置客户。

1.  使用`options set FILENAME`命令来设置报告的输出位置和文件名。

1.  最后，使用`run`命令来执行该模块并生成报告。

以下屏幕截图上有标签，对应于使用`reporting/html module`生成和导出报告文件的上述步骤：

![](img/06ce3de3-141e-4cc1-8e8a-454030c4573c.png)

最后，导航到 Kali Linux 机器上的输出位置，并打开 HTML 文件。视图应该类似于以下内容：

![](img/793202d5-54a0-44ca-bba5-ce1268ac5d9d.png)

现在，信息已经被很好地分类和总结以供查看。

在下一节中，我们将看看如何使用**theHarvester**来收集与组织相关的人员的电子邮件地址。

# theHarvester

theHarvester 旨在收集给定公司的电子邮件地址、域和员工详细信息。theHarvester 使用互联网上的多个开放源，如搜索引擎，以可读的格式拼凑详细信息。

有关 theHarvester 的更多详细信息可以在其 GitHub 页面上找到：

[`github.com/laramies/theHarvester`](https://github.com/laramies/theHarvester)

要开始使用 theHarvester，执行以下步骤：

1.  打开一个终端窗口并执行`theharvester`。工具的描述和用法将显示在终端上，如下面的屏幕截图所示：

![](img/8bf9fc69-0596-4cfa-b1af-4eb1d062fc72.png)

1.  让我们尝试收集公司员工的电子邮件地址，这些电子邮件地址是公开发布的，比如在论坛、网站、博客和社交媒体平台上。我们可以使用`theharvester –d <domain> –b <data source>`命令来做到这一点。在我们的示例中，我们将使用 Google 作为数据源来搜索`checkpoint.com`域的电子邮件地址：

![](img/ff1abd62-a367-4107-861d-cbe2135c19d5.png)

结果为我们提供了一些公司员工的企业电子邮件帐户和一些子域的 IP 地址。我建议使用各种数据源收集尽可能多的信息。收集公司的电子邮件地址的一个目的是进行钓鱼攻击。

接下来，我们将使用 Shodan 搜索引擎，该引擎索引**物联网**（**IoT**）和其他在线设备，以检索有关潜在目标的信息。

# Shodan

Shodan ([www.shodan.io](http://www.shodan.io))是一个搜索引擎，它索引了连接到互联网的各种设备。这意味着什么？为了阐明这一点，让我们以发现某种漏洞级别的设备为一个现实生活的例子。2019 年 1 月，Hacker News ([`thehackernews.com`](https://thehackernews.com))发布了一篇文章，指出全球有超过 9,000 台 Cisco SMB RV320 和 RV325 路由器受到了新的漏洞利用的影响。这些漏洞是 CVE-2019-1652 和 CVE-2019-1653，它们允许恶意人士获取配置文件并控制设备。

本文可以在以下网址找到：

[`thehackernews.com/2019/01/hacking-cisco-routers.html`](https://thehackernews.com/2019/01/hacking-cisco-routers.html)

想象一下，你有兴趣在互联网上发现所有这类设备。使用 Shodan 作为常规搜索引擎，我们可以快速发现多个符合我们搜索条件的`cisco rv325`设备，如下面的屏幕截图所示。仔细看：我们可以看到在线 Cisco RV325 路由器的列表，它们的 IP 地址、主机名和位置：

![](img/487ec9c1-65a1-47e2-86b9-8f62df3f24e4.png)

结果提供了设备和 IP 地址的地理位置信息，以及固件版本等横幅信息。在左侧，我们可以看到一个全球地图，显示每个国家和组织的互联网连接设备数量。只需点击一个国家、一个组织，甚至一个 IP 地址，就可以为我们过滤这些信息。

点击 IP 地址将提供有关所选设备的更多信息，例如主机名、开放端口、运行服务、组织、**互联网服务提供商**（**ISP**）详细信息以及设备易受的漏洞，如下面的截图所示：

![](img/ec022136-d77e-4c33-949c-903eb01ce216.png)

从 Shodan 收集的信息可以帮助你在渗透测试期间建立目标组织的更好档案，因为它可以为你提供可能的操作系统版本和其他技术细节，这些细节可以帮助你成功地利用你的目标。简而言之，Shodan 可以帮助你识别目标组织和 IT 基础设施中的技术和控制系统。

在下一节中，我们将学习关于**OSRFramework**。

# OSRFramework

另一个令人敬畏的 OSINT 工具是 OSRFramework。这个工具集使用用户名、DNS 记录、深网搜索等进行查找，还有更多功能。

首先，我们可以在终端上执行`osrf`命令，以提供工具本身的用法描述。假设我们需要在社交媒体平台上获取目标公司的企业电子邮件地址列表。以下是我们可以利用 OSRFramework 的组件，从各种来源收集信息的组成部分：

+   `domainfy`：检查使用单词和昵称的域名是否可用

+   `entify`：使用正则表达式从提供的 URI 中提取实体

+   `mailfy`：获取有关电子邮件帐户的信息

+   `checkfy`：验证给定的电子邮件地址是否与模式匹配

+   `phonefy`：通过电话号码查找与垃圾邮件实践相关的信息

+   `searchfy`：在多个平台上执行查询

+   `usufy`：查找使用给定昵称注册的帐户

在我们的第一个例子中，我们可以尝试使用`whois`数据库获取有关目标域的信息。使用`domainfy.py --whois –n <target>`语法，框架将开始查询`whois`，并在几分钟后以表格格式提供结果。在我们的例子中，我使用了`domainfy.py --whois –n checkpoint`命令，专门检索包含名称`checkpoint`的任何域的信息。

以下是结果：

![](img/d8530353-f5e0-4651-9131-b3eb8613e254.png)

接下来，我们可以尝试获取给定搜索字符串的电子邮件地址。在这个第二个例子中，我们试图发现包含`checkpoint`字符串的电子邮件地址，该字符串已经在互联网上的各个网站上使用。我们可以通过使用`mailfy.py –n checkpoint`命令开始。我们将看到一个显示符合我们搜索条件的电子邮件地址、域和平台位置的表格，如下面的截图所示：

![](img/0f545892-c53b-4548-9225-22a423320b40.png)

在我们的第三个例子中，我们将使用一个字符串来搜索 OSRFramework 的所有服务。为了完成这个任务，在你的终端上使用`seachfy.py –q string`命令。完成后，结果将显示并告诉你找到的位置、任何别名和 URL，如下面的截图所示：

![](img/990baaae-5301-415e-ae26-0b5cc024de94.png)

此外，使用 OSRFramework 检查电话号码泄漏很简单。使用**`phonefy.py –n number`**命令，OSRFramework 将开始搜索。下面的截图显示了给定电话号码的 URL 位置和平台：

![](img/f56f96de-8dd7-4445-9320-7165be3f44db.png)

在我们的最后一个例子中，我们可以搜索用户名。使用`usufy.py –n string`命令将允许 OSRFramework 搜索各种在线资源。在这个例子中，我已经搜索了`p@55w0rd1`作为用户名，以下是结果：

![](img/39ff7d5a-fec3-4d8c-b22e-1438581b787c.png)

正如你所看到的，OSRFramework 是 Kali Linux 平台中另一个非常强大的工具。使用这样的工具可以在信息收集过程中节省大量时间。

完成了这一部分后，您现在具备使用多个 OSINT 工具来收集有关目标组织的具体和详细信息的技能。在接下来的部分中，我们将讨论云资源中的数据泄漏问题。

# 识别目标技术和安全控制

作为渗透测试人员，确定目标网络或组织在执行外部网络渗透测试之前使用的技术是非常重要的。在对目标网络或组织进行任何攻击之前，通常发现目标使用的技术非常有用。这使我们作为渗透测试人员能够更好地装备自己，以适当的工具高效地完成工作。想象一下，作为木工开始新工作，但在第一天到达时没有任何工具，你如何能成功呢？

此外，事先了解目标网络上使用的技术和安全控制将使我们能够更好地准备自己，通过研究和开发利用已知安全漏洞来利用目标系统和网络上的弱点。我们将在接下来的部分中更详细地讨论这个想法。

# 使用 Shodan 发现技术

我们首先将使用 Shodan 来帮助我们发现目标服务器上运行的技术。请记住，Shodan 是一个物联网设备的搜索引擎，提供了有关连接到互联网的设备的深入信息。

要开始，请遵循以下步骤：

1.  使用您的网络浏览器，访问[`www.shodan.io`](https://www.shodan.io).

1.  您可能需要注册并创建一个 Shodan 帐户以获得更好的结果。

1.  在搜索栏中，输入要搜索设备的组织。以下截图显示了 Shodan 上的搜索栏：

![](img/cbe602e6-a81e-4d31-a7e4-5ddd906190cc.png)

1.  一旦搜索完成，点击搜索结果中的目标，以访问 Shodan 找到的信息。

1.  在目标页面上，您将看到一个打开的网络端口列表，运行的服务及其版本，以及正在使用的任何技术：

![](img/83976b7e-bcb2-4e88-9e12-fa4eeeb579fc.png)

1.  向下滚动一点，如果在目标上发现了任何已知的漏洞，Shodan 将提供一个带有描述的列表：

![](img/1bbad89a-274d-4bc5-960e-91180660ecfc.png)

在下一节中，我们将介绍如何使用**Netcraft**来收集有关目标 Web 服务器底层技术的更详细信息。

# Netcraft 的强大

Netcraft 使我们能够收集有关目标域的信息，如网络块信息、注册信息、电子邮件联系人、托管服务器的操作系统和 Web 平台。

要开始，请使用以下说明：

1.  使用您的网络浏览器，访问[`www.netcraft.com/.`](https://www.netcraft.com/)

1.  在下面的截图中突出显示的搜索栏中，输入一个域名：

![](img/92a9735b-38c8-41b3-871c-6555b26dca6d.png)

如果搜索没有返回任何结果，请将`www`包括在网站地址中。

1.  结果页面将显示有关目标的与网络相关的信息。向下滚动一点，直到看到**Hosting History**。该部分提供了托管服务器的操作系统、Web 服务器平台和服务版本，如下所示：

![](img/bc6f95f3-f04f-4716-89a2-0cd9debd629c.png)

1.  再向下滚动一点，直到看到**Site Technology**。该部分将告诉您 Netcraft 能够在目标 Web 服务器上识别的技术：

![](img/db0880aa-bcc3-4167-8371-c28174cb59fc.png)

正如您所见，Netcraft 能够为我们提供非常有用的信息。我们现在可以利用找到的信息，进一步研究技术，找到已知的漏洞和利用方式来攻击目标。

# 使用 WhatWeb 识别技术

最后，我们可以看一下在 Kali Linux 中使用**WhatWeb**工具。WhatWeb 能够识别网站、电子邮件地址、Web 框架和数据库所使用的技术。

要开始使用 WhatWeb，请遵循以下步骤：

1.  打开一个新的终端并输入`whatsweb –h`命令以获取帮助菜单，显示语法。

1.  在我们的实验室中对目标（如 Metasploitable）运行 WhatWeb，使用`whatweb <target>`命令如下所示：

![](img/0a9d354b-3cf5-48c2-9610-31a662ba6f37.png)

WhatWeb 能够为我们提供在我们的 Metasploitable 虚拟机上的 Web 服务器平台上使用的技术。

1.  接下来，使用`whatweb –v <target>`命令，提供如下所示的详细输出：

![](img/4cbfc434-6c0c-425c-8c6e-c702f32bb5c9.png)

在这里显示的详细输出中，WhatWeb 为我们提供了关于所使用的插件描述和它们的结果的更多细节。

在本节中，我们已经完成了各种旨在帮助我们发现目标网络或系统上正在使用的技术的练习。在下一节中，我们将深入学习云资源。

# 发现云资源中的数据泄漏

在过去的几年里，云计算已成为 IT 行业增长最快的趋势之一。云计算允许公司在云提供商的数据中心迁移和利用计算资源。云计算提供商采用按使用量付费的模式，这意味着您只需为您使用的资源付费。一些云提供商允许按分钟付费，而其他人则采用按小时付费的结构。

有三个大型云提供商：

+   **Amazon Web Services**（**AWS**）：亚马逊的云服务

+   **Microsoft Azure**：微软的云服务

+   **Google Cloud Platform**（**GCP**）：谷歌的云服务

云提供商通常向客户提供存储设施。AWS 存储设施被称为**简单存储服务**（**S3**）。每当客户启用 S3 服务时，都会创建一个存储桶。存储桶是 AWS 平台内的存储单元，客户可以在其中添加或删除文件。在 Microsoft Azure 中，文件存储设施被称为**Azure Files**。此外，在 GCP 上，存储设施被称为**Google Cloud Storage**。

在信息安全领域，我们必须记住，当公司使用云平台时，云平台上的数据必须像在本地存储时一样受到保护。有时，管理员忘记启用安全配置或缺乏有关云解决方案安全性的知识。这可能导致攻击者发现目标组织的 AWS S3 存储桶。让我们现在看一个简单的例子。

[`flaws.cloud/`](http://flaws.cloud/)是一个网站，你可以用它来了解云安全漏洞。

在我们的练习中，我们将使用 S3Scanner 工具。按照以下步骤开始：

1.  这个工具在 Kali Linux 中没有预先安装，所以我们需要使用以下命令创建 GitHub 存储库的克隆：

```
git clone https://github.com/sa7mon/S3Scanner.git
```

1.  接下来，使用`cd S3Scanner`命令切换到`S3Scanner`文件夹。

1.  现在，您需要为此工具安装额外的依赖项。别担心-开发人员为我们简化了这一步。要完成此步骤，请使用`pip install -r requirements.txt`命令。

1.  完成后，我们现在可以在目标域上使用我们的工具。使用`python ./s3scanner.py domain`语法，工具扫描器将为 AWS S3 存储桶创建一个域，并确定其是否可访问。

1.  以下截图显示了使用 S3Scanner 来检查`flaws.cloud`域上的任何 AWS S3 存储桶：

![](img/6a1c6934-6bbf-4a0a-bfdc-7824171e4f35.png)

1.  在该域上找到了一个存储桶。此外，您可以创建一个包含多个域的文本文件，并一次查询整个文件。以下是查询存储在`sites.text`文件中的多个域的示例：

![](img/c2af70d8-b83e-4a54-bc4d-2dac187a471a.png)

1.  此外，我们可以使用`host`命令来解析域的 IP 地址。然后，通过使用带有`ptr`参数的`nslookup`实用程序，可以执行反向查找，这将导致我们获取 AWS S3 存储桶的实际名称，如下面的屏幕截图所示：

![](img/bce3316a-f986-4a2d-87eb-8fde6511d46d.png)

数据泄漏可能发生在任何平台和任何组织。作为一名即将成为渗透测试员和网络安全专业人员，您必须了解如何在实际黑客之前找到它们并利用它们。公司可以在云平台上存储敏感数据，甚至在云服务提供商网络上完全不受保护地留下其他数据。这可能导致成功检索数据和帐户。

# 了解谷歌黑客和搜索运算符

谷歌黑客的概念实际上并不是黑客进入谷歌的网络基础设施或系统，而是在谷歌搜索引擎中使用高级搜索参数。我们可以使用谷歌来帮助我们找到易受攻击的系统，隐藏的信息和互联网资源，只需在谷歌搜索栏中插入特殊的搜索运算符即可。

假设您想使用谷歌搜索引擎查找各种网站，但不想看到包含特定关键字或短语的结果。我们可以使用`<string of text here> -<keyword>`语法来实现这一点。关键字是您想要排除的短语或文本。

让我们看下面的例子：

![](img/1891de57-7da2-4d39-a1b3-e8c15148c225.png)

在我们的例子中，我们正在搜索渗透测试工具。同时，我们告诉谷歌搜索算法不显示包含单词`kali`的任何结果。此外，我们可以使用`<string of text here> "keyword"`语法来查看包含关键字的结果。

以下表格是谷歌搜索运算符的简要列表，也称为**谷歌 dorks**，可帮助您在互联网上找到敏感信息：

![](img/068c20d9-f51b-4a41-bf0c-64c363265dd1.png)

此外，Offensive Security 团队（[www.offensive-security.com](http://www.offensive-security.com)）维护着 Exploit Database（[www.exploit-db.com](https://www.exploit-db.com/)），其中有一个专门的部分称为**Google Hacking Database**（**GHD**）（[`www.exploit-db.com/google-hacking-database`](https://www.exploit-db.com/google-hacking-database)）。GHD 由社区成员不断更新，包含许多类别的搜索参数，如下面的屏幕截图所示：

![](img/a2e41e75-5a1e-4ce0-b05e-b18380327c1c.png)

每个搜索参数都可以复制并粘贴到谷歌搜索中，结果将相应显示。GHD 中的每个条目都包含对搜索运算符的简要描述。

以下是一个用于发现具有公开可用登录页面的 Cisco **Adaptive Security Appliance** (**ASA**)的搜索参数：

![](img/28805653-0bb3-427e-8ae0-e0b63ae3ac9d.png)

这些敏感信息和隐藏目录可能是黑客的游乐场；同样，对于渗透测试员来说，这是一个等待被利用的金矿。

我们已经完成了对谷歌黑客的讨论。在下一节中，我们将看一下如何使用 Kali Linux 本地复制网站。

# 利用 whois 和使用 HTTrack 复制网站

在本节中，我们将查看两个特定资源。我们将使用 whois 帮助我们从目标域的域名注册商那里收集联系信息，并使用**HTTrack**在本地复制网站。

让我们深入了解 whois 的功能以及它对我们有何益处。

# whois

whois 是一个保存所有注册域的注册信息记录的数据库。以下是通常存储为公共记录的一些信息类型的简要列表：

+   注册人联系信息

+   管理联系信息

+   技术联系信息

+   域名服务器

+   重要日期，如注册、更新和到期日期

+   注册域 ID

+   注册信息

访问 whois 数据库非常简单：您可以使用谷歌搜索引擎找到各种数据库。一些 whois 网站包括[www.whois.net](http://www.whois.net)，[whois.domaintools.com](http://whois.domaintools.com/)，[who.is](https://who.is/)和[www.whois.com](http://www.whois.com)。但是，Kali Linux 包含内置的 whois 工具。要在域上执行`whois`查找，请执行以下步骤：

1.  在终端上使用`whois <domain-name>`语法，如下图所示：

![](img/bfec0b6d-a4a6-45b7-8cb4-7c94a4834a96.png)

1.  域的信息将显示在终端上。获得的信息可以被渗透测试人员利用，用于对目标组织进行各种类型的攻击。

在下一节中，您将学习如何使用 HTTrack 将网站复制到本地。

# HTTrack

HTTrack ([www.httrack.com](http://www.httrack.com))允许我们离线查看整个网站。它通过在本地创建在线网站的克隆副本并将其存储在计算机上来实现这一点。要使用 HTTrack，只需打开一个新的终端窗口并执行以下步骤：

1.  执行`httrack`命令以调用交互式向导。

1.  为项目命名。

1.  设置目标网站的离线副本存储路径。按*Enter*将使用括号中的默认值。

1.  指定 URL。

1.  选择适当的操作。

1.  确认详细信息并启动 HTTrack 以镜像网站。

以下是一个屏幕截图，显示了我们刚刚概述的步骤：

![](img/e99fc8c6-fda2-45ff-880b-a20777046fd8.png)

克隆网站非常有用，因为您将能够发现和访问在线版本无法访问的隐藏资源和文件。作为渗透测试人员，您可以彻底探索每个离线目录；通常，网站管理员不会总是清理旧数据和文件，因此有很多可以探索的内容。

完成了本节，您已经掌握了将目标网站复制到 Kali Linux 机器上所需的知识。在下一节中，我们将尝试检索目标域的子域。

# 使用 Sublist3r 查找子域

作为互联网用户，您会意识到多个搜索引擎（如 MSN、谷歌、雅虎和必应）经常学习和索引新的和现有的网站，以改善它们的搜索结果。如果您搜索公司的网站，您很可能会发现主域名，如`company.com`。然而，许多组织出于各种原因创建子域。作为渗透测试人员，我们希望发现目标组织的所有可能子域，因为它们可能导致登录门户和敏感的企业目录，其中可能包含机密文件和资源。

我们可以利用搜索引擎的强大功能来使用**Sublist3r**工具。Sublist3r 是一个基于 Python 的工具，用于使用 OSINT（如搜索引擎和其他互联网索引平台）枚举（提取/获取）给定网站的子域。

Sublist3r 工具未在 Kali Linux 上原生安装，因此我们需要从其 GitHub 存储库下载它。

要开始，请执行以下步骤：

1.  在您的 Kali Linux 机器上打开终端并执行以下命令：

```
git clone https://github.com/aboul3la/Sublist3r.git
```

1.  克隆过程完成后，使用`cd Sublist3r`命令切换到`Sublist3r`文件夹。

1.  在这一点上，我们可以使用 Sublist3r 工具来搜索目标域（公司）的子域，使用`python sublist3r.py –d domain-name`命令。左侧的屏幕截图显示了工具的成功调用，而右侧的屏幕截图显示了结果在终端上的显示：

![](img/c2509826-50f2-492f-baf0-76dd1fc65de3.png)

使用这个工具可以节省我们本来要花在手动搜索互联网上的大量时间。

您现在已经学会了如何在 Kali Linux 上使用 Sublist3r 工具高效地发现目标网站的子域。

# 摘要

在本章中，我们讨论了在攻击目标之前进行侦察的重要性。在这个阶段收集的信息对渗透测试的后续阶段至关重要。信息收集有助于为渗透测试人员研究目标安全漏洞奠定基础，这对系统和网络利用是必需的。

我们概述了侦察和足迹之间的区别，并且我们还看了如何使用各种 OSINT 工具来获取有关各种目标的信息。

在下一章《主动信息收集》中，我们将进一步涵盖信息收集的主题。

# 问题

1.  足迹的目的是什么？

1.  可以使用哪些 OSINT 工具来收集信息？

1.  使用 Google 搜索，您如何查看特定域的结果？

1.  给出一个值得信赖的在线资源，用于研究漏洞利用。

1.  您有兴趣收集目标公司的域注册信息。您会使用哪些资源？

1.  您如何发现公司网站的子域？

# 进一步阅读

+   **Web 应用信息收集**：[`hub.packtpub.com/web-application-information-gathering/`](https://hub.packtpub.com/web-application-information-gathering/)

+   **开源情报**：[`hub.packtpub.com/open-source-intelligence/`](https://hub.packtpub.com/open-source-intelligence/)
