# 第二章：获取方法概述

随着各种移动设备的出现，存在多种获取方法。没有一种通用的获取方法适用于所有型号。某些获取方法依赖于手机的锁定和加密状态、操作系统版本、可用存储类型等。你需要在调查中逐步发现哪些获取方法适用于特定设备。

以下是对不同移动平台可用的获取方法的快速概述，从最简单到最先进（且劳动密集型）。有关每种获取方法的更多细节，请参考各个平台的章节。

本章讨论了现有的获取方法及其在主要移动平台上的适用性：

+   空中获取

+   从移动备份中获取证据

+   物理获取 - 可用性和适用性

+   高级获取方法 - JTAG、ISP 和芯片脱离

# 空中获取

许多移动设备具有将其内容备份到云端的功能。根据平台的不同，云备份可能包含设备的完整内容，包括通话历史记录和消息（Apple iOS 7.x 到 9.x、Windows RT、Windows 8/8.1/10）；也可能只有已安装应用程序的列表和一些随机设置（Android 4.4 和 Android 5.x）；或介于两者之间（Windows Phone 8 和 Android 6.0）。

对于某些设备，由于全盘加密和硬件锁，云取证可能是唯一可用的获取方法。例如，云取证是锁定的 64 位 iPhone（运行 iOS 8 以上）和一些 Windows Phone 8 以及 Windows 10 Mobile 设备的唯一可行方法。

与其他获取方法相比，云备份通常包含的信息量最少。

为了使云获取有效，专家必须拥有用户的认证凭据。虽然登录名和密码是最常用的凭据，但如果无法访问二次认证因素，二重身份验证可能会成为障碍。

云获取的好处如下：

+   不需要设备

+   独立于设备型号、操作系统版本和越狱状态

+   远程获取

+   可以在嫌疑人不知情的情况下进行

+   可以用来追踪嫌疑人（定位追踪）

+   最简单的获取方法之一

+   无需特殊专业知识

+   不需要拆解设备

+   非破坏性过程

云获取的主要缺点包括以下几点：

+   提取的信息量有限

+   iOS 密钥链提取可能不可用

+   必须知道用户 ID 和密码（或拥有二进制身份验证令牌）

+   大量数据下载可能非常缓慢

+   双重身份验证带来额外的挑战

+   二进制认证令牌可能会过期

+   无法提取未分配空间

## Apple iCloud

在 Apple iCloud 的情况下，用户计算机上的软件（通过 Apple iCloud for Windows 或其 macOS 版本）创建的二进制认证令牌可以替代登录名和密码。目前，使用二进制认证令牌可以绕过 Apple 的双重身份验证。然而，这些认证令牌可能有有限的使用期限（Apple 经常调整令牌过期时间），并且在实际获取时可能已经过期。我们将在第六章，*iOS 逻辑与云获取*中提供更多关于令牌及其过期的信息。

## Windows Phone 8、Windows 10 Mobile 和 Windows RT/8/8.1/10

Windows Phone 8 和 Windows 10 Mobile 拥有完善的云备份系统。如果知道用户的 Microsoft 帐户登录名和密码，可以通过取证工具下载云备份。Windows 8、8.1、10 和 Windows RT 会自动将用户数据、现代 UI 应用及其数据备份到用户的 Microsoft 帐户（OneDrive），但前提是用户使用 Microsoft 帐户凭据登录，而非使用本地 Windows 帐户。

## Google Android

从 Android 设备中可以备份到用户 Google 帐户的资料非常有限。然而，Google 会收集并存储大量关于其用户的信息。这些数据来自所有设备，无论是否为 Android，只要在该设备上使用了特定的 Google 服务。因此，可以从嫌疑人的 Google 帐户中获取大量极具价值的信息。

执法机构可以选择通过法院命令请求服务提供商（Apple、Microsoft 或 Google）提供嫌疑人云帐户的完整内容。由于云备份通常没有加密（或加密密钥与备份一起存储），因此获取数据并没有技术障碍。如果这些组织在不久的将来实施加密云备份，这种情况可能会发生变化。

有关通过无线方式获取 Google 帐户的更多信息，请参见第三章，*获取 - 接近 Android 设备*。

# 逻辑获取（备份分析）

许多设备（例如 Apple iOS、BlackBerry 和一些 Android 型号，如 Sony Xperia）能够通过安装在用户计算机上的软件生成离线备份。Apple iTunes、BlackBerry Link、Sony PC Companion 以及其他许多工具可以用于生成和恢复手机或平板电脑的备份。根据操作系统的不同，离线备份可能会或不会受到密码保护。根据保护状态，专家可能能够提取全部、部分或没有任何信息。

离线备份（如果某个平台支持）通常比云备份提供更多或同等的信息。

逻辑获取的好处包括以下几点：

+   最简单的获取方法之一

+   无需特殊专业知识

+   不需要拆解设备

+   非破坏性过程

逻辑获取的主要缺点如下：

+   提取的信息量有限

+   Android：制造商和应用程序开发者控制 ADB 备份中包含的内容和不包含的内容

+   Android：ADB 备份在加密设备上可能无法使用

+   不适用于 Windows Phone 8 和 Windows 10 Mobile

+   无法提取未分配空间

+   使用未知密码保护的备份：无成功保证和未知时间框架

## Apple iOS

带密码保护的 iTunes 备份（Apple iOS）是加密的；专家必须提供正确的密码才能解密备份。如果不知道密码，专家可以执行攻击（暴力破解、字典攻击或组合攻击）来恢复密码。在分析受密码保护的 Apple 备份时，专家可以访问 Apple 钥匙串中的项目。没有密码创建的离线备份大部分情况下是未加密的；然而，钥匙串会用硬件密钥加密，这意味着无法获取钥匙串数据。让（解锁的）iOS 设备生成离线备份是一个可行的获取方法。如果可能，尝试确保创建一个已知密码的备份（如果未设置备份密码，在创建备份之前设置一个密码将确保钥匙串项可以解密）。

如果启用了备份密码保护，备份密码更像是实际 iOS 设备的属性，而不是备份本身。如果启用备份密码保护，备份会在 iOS 设备上加密，在数据离开设备之前。一旦启用了备份加密，无论使用什么工具来创建备份，都不会有未加密的数据离开设备。换句话说，Apple iTunes 实际上并没有创建备份；而是工具接收加密的数据流并将其保存为文件。

## BlackBerry 10

由 BlackBerry Link（BB 10 操作系统）生成的备份没有密码。相反，它们会在设备上使用强加密密钥进行安全加密，该密钥存储在线。如果知道用户的 BlackBerry ID 和密码，或者有政府请求，便可以检索加密密钥。

类似于 Apple iOS，BlackBerry 10 设备会在内部加密其备份。没有未加密的数据离开设备。因此，当用户通过 BlackBerry Link 或其他工具（例如，Sachesi 或 Darcy 的 BlackBerry 工具）创建备份时，备份工具只是向 BlackBerry 设备发送一个命令。设备在内部处理加密，并将加密的数据流传输到 BlackBerry Link（或替代工具）。需要注意的是，无论使用什么工具，加密数据从不会离开设备。

### 注意

Windows Phone 8 和 Windows 10 Mobile 不提供离线备份。

## Android

原生安卓系统没有类似 iTunes 的工具来进行完整设备备份。然而，一些**原始设备制造商**（**OEM**）提供了制作和恢复离线备份的工具（例如，索尼为 Xperia 设备提供的 PC Companion 工具）。

该平台提供了通过命令行（`adb backup`）创建离线备份的有限功能。然而，与 iTunes 备份相比，ADB 备份可能包含的数据量有限。由于安卓系统的碎片化，不同的制造商对备份内容有不同的控制权。因此，一些设备可能会备份通话记录、联系人和短信，而其他一些设备则不会。例如，三星、索尼和 HTC 通常会省略通话记录、联系人和短信，但会允许 Google Chrome 数据（例如缓存的密码和浏览历史）备份。我们将在第四章中进一步讨论通过 ADB 备份进行的安卓逻辑获取，*安卓数据获取的实践步骤*，以及*无需 root 的实时镜像（通过 ADB 备份）*部分。

## Nandroid 备份

已 root 的安卓手机并安装了自定义恢复模式（CWM 和 TWRP）可以创建所谓的 Nandroid 备份，这些备份包含设备文件系统的完整映像。在获取数据时，这些设备可以启动到恢复模式，并指示设备生成完整的 Nandroid 备份。

一般来说，手机必须安装自定义恢复模式才能生成 Nandroid 备份。如果尚未安装自定义恢复模式，则需要解锁引导加载程序（或使用引导加载程序破解）和/或对设备进行 root。请注意，在大多数情况下，解锁锁定的引导加载程序将清除设备上的所有用户数据。这个安卓安全措施在某些情况下可以通过引导加载程序破解绕过。

请注意，云备份和离线备份都不包括未分配的空间。

# 物理获取

物理获取在提取速度、使用方便性和提取信息量之间提供了最佳平衡。这个过程不需要拆解手机或使用任何特殊硬件。只需一条微型 USB（或苹果 Lightning）数据线、一台 PC（或 Mac）以及用于物理获取的取证软件（参见以下部分）即可。对于 iPhone 4 之后的 iOS 设备，Elcomsoft iOS 取证工具包目前是唯一可用的物理获取解决方案。

物理获取从设备中提取最多的信息。对于未加密的设备，未分配的空间将与文件系统一起提取，允许专家对销毁的证据进行恢复。加密设备对未分配空间的处理方式不同。例如，Apple iOS 总是使用全盘加密，不会保存已释放数据块的加密密钥。因此，未分配区域可以访问，但即使设备已越狱且已知密码，Apple 设备中的未分配区域也无法解密。

物理获取的好处如下：

+   在提取数据量、速度和易用性之间达到了最佳平衡

+   保证的时间框架

+   在许多情况下，它可以提取未分配的空间（Apple 设备除外）

+   在较高层次上操作，并能够克服加密（提取的图像会实时解密）

+   可适用于某些 Windows Phone 型号

+   可适用于较旧的 iOS 设备

+   可适用于许多 Android 设备（有多种方法）

+   只需要一个 USB 或 Lightning 数据线以及获取软件

+   不需要拆解设备

+   大多数法医专家都可以使用，无需特殊技能

+   非破坏性和非侵入性过程

物理获取的主要缺点如下：

+   一般可用性有限，Apple iOS 设备的可用性极为有限

+   可能支持，也可能不支持关闭 USB 调试的锁定 Android 设备

+   没有统一的方法，获取工具和方法种类繁多

+   可能无法获取有未知 PIN/密码锁定的设备

## Apple iOS

就 Apple 设备而言，物理获取对 32 位硬件完全可用，对 64 位设备的支持有限（即使已知密码，获取 64 位设备时，钥匙串项目仍然保持加密）。32 位获取过程支持 iPhone 4、4S、5 和 5C，但不支持后续的 5S、6 或 6 Plus。原版 iPad mini 可以通过 32 位过程进行获取，但 iPad mini 2（Retina）已使用 64 位 **系统级芯片**（**SoC**），因此物理获取需要通过独立的（64 位）过程进行。

### 注意

SoC 是一种集成电路，将主 CPU、GPU、无线调制解调器以及专用运动和其他协处理器等电子组件集成在单个芯片上。SoC 不仅仅是一个 CPU，它将更多功能集成在同一硅芯片上。

请注意，iPhone 4S、5 和 5C 只能通过越狱进行获取，因此这些设备的物理获取前提条件包括一个已越狱的 iPhone 或已知密码，以及一个可以越狱的 iOS 版本。没有越狱的、被未知密码锁定的 iPhone 4S、5 或 5C 无法通过物理获取提取；然而，即使设备被未知密码锁定，仍然可以提取有限的数据。

64 位获取过程支持所有现有的苹果设备，如 iPhone 5S/6/6S/Plus、iPad mini 2-4、iPad Air/Air 2 和 iPad Pro。64 位过程向后兼容 32 位设备，在获取设备时出现错误时，可以代替完整的 32 位获取过程。然而，64 位过程高度侵入性，它会修改用户和系统分区的内容。与 DMG 镜像不同，64 位过程返回的是文件系统的 TAR 文件（仅包含文件和文件夹）。最后，密钥链项会被获取，但即使已知密码，也无法通过 64 位过程解密。

关于 iOS 物理获取的更多信息，参见第五章，*iOS - 简介与物理获取*。

## Android

物理获取可能是目前安卓设备上最佳的提取方法。物理获取操作的层次高于 JTAG 或芯片拆除。

### 注意

JTAG：这是**测试访问端口**（**TAP**）的通用名称，由**联合测试行动小组**（**JTAG**）协会标准化。这些端口可以用来访问连接设备中存储的原始数据，除此之外还可以用于其他功能。芯片拆除：这是一种高级且具有破坏性的获取技术，通过将单个存储芯片（例如**嵌入式多媒体卡**（**eMMC**））从设备中移除，并直接对其进行成像（通过将线接头连接到芯片触点）或通过市售适配器进行成像。

由于物理获取通过手机的控制器运行，在许多情况下，转储加密设备会产生解密的转储文件（而 JTAG 或芯片拆除不会如此）。在安卓中，转储过程需要超级用户权限来运行。设备必须已经 root。像 Oxygen Forensic Suite 这样的商业获取工具会自动尝试为专家 root 设备（通过有线 root）。某些设备通过引导加载程序黑客攻击（Cellebrite UFED）可采用不同的、更先进的获取策略，这种方法不需要 root 设备或以任何方式修改其内容。此方法仅适用于支持的设备，包括某些摩托罗拉安卓设备、选定的三星、Qualcomm 和 LG 设备。虽然这种方法主要适用于解锁 bootloader 的设备，但 Cellebrite 也有适用于某些锁定 bootloader 设备的引导加载程序黑客（例如，选定的诺基亚 Lumia 设备）。

最后，一些制造商通过特殊的固件更新模式实现了对手机存储的服务访问。这些制造商包括高通（Qualcomm HS-USB 9006 / Qualcomm MMC 存储；无论引导加载程序锁定状态如何都能使用，但并非所有设备都支持）；LG（无论芯片组如何，LAF 模式都能使用，且不受引导加载程序锁定状态影响）；以及联发科和展讯（仅在解锁引导加载程序时有效）。这些模式可以通过移动取证工具（如 Oxygen Forensic Suite）用于对某些设备的法医采集。

我们将在第五章中详细讨论 Android 物理采集，*iOS - 介绍与物理采集*。

## Windows Phone 8 和 Windows 10 Mobile

长时间以来，Windows Phone 操作系统对物理采集攻击保持安全。Cellebrite 为特定的 Windows Phone 设备开发了一个引导加载程序级别的漏洞。支持的 Windows Phone 8 设备可以通过 USB 电缆使用 Cellebrite UFED 进行数据提取（[`www.cellebrite.com/Pages/windows-phone-forensics-physical-extraction-and-decoding-from-windows-phone-devices`](http://www.cellebrite.com/Pages/windows-phone-forensics-physical-extraction-and-decoding-from-windows-phone-devices)）。

即使设备更新至 Windows 10 Mobile，bootloader 漏洞仍然有效。

## 限制与可用性

对于 BlackBerry 10、64 位硬件的 Apple iOS 设备以及许多没有已知漏洞的 Android 智能手机，无法进行物理提取。

## 物理采集工具

需要提到的是，以下法医工具可用于并推荐用于进行移动设备的物理采集：

+   **Cellebrite UFED** 提供了广泛的移动取证工具，涵盖了 *UFED* 系列下的多个工具。Cellebrite 还提供更多工具。

+   **Micro Systemation (XRY)** 提供一系列移动取证工具，用于从多种移动设备执行物理和逻辑提取，提取所有可用的原始数据（仅限物理提取）。

+   **AccessData (MPE+)** 提供了 **Mobile Phone Examiner Plus**（**MPE+**），这是一款支持广泛移动设备的全能采集和分析工具包。该公司声称支持超过 7,000 种设备型号。

+   **Elcomsoft iOS 法医工具包**是市场上唯一支持对所有 32 位和 64 位 iOS 设备进行物理采集的工具。

+   **Oxygen Forensic Suite**支持通过物理、逻辑和云采集技术，覆盖超过 12,000 种独特的设备型号。它还能够利用某些芯片组和 OEM 的独特属性，使调查人员能够在绕过引导加载程序锁和屏幕锁的情况下，提取设备的全部内容。

+   **Magnet ACQUIRE**可以执行逻辑采集以及多个 Android 和 iOS 设备的物理采集。提取过程采用无关工具的方式，这样任何分析工具都可以导入提取的数据进行分析。

+   **BlackBag Mobilyize**可以获取 Android 和 iOS 设备数据。iOS 仅限于逻辑/文件系统提取。对于 Android，它可以在设备类型和其他变量（如操作系统、运营商定制等）的支持下进行三种级别的提取。

# JTAG

JTAG 取证是一种先进的采集程序，使用 JTAG 协会标准的测试接入端口。这些端口可以用来访问连接设备中存储的原始数据。采集过程涉及使用设备电路板上现有的焊接点。通过使用专用设备和与之匹配的设备特定 JTAG 电缆，可以从兼容设备中提取闪存内容（排除 eMMC 过度配置区域，但包括可寻址的未分配空间）。值得注意的是，JTAG 采集通常可以用于锁定、损坏或其他无法访问的设备。JTAG 采集支持许多 Android 设备，以及一些功能手机和 Windows Phone 7 及 8 设备。JTAG 不支持近期的 BlackBerry 10 设备，也不支持任何苹果设备。

与物理采集相比，JTAG 在较低级别操作。这既有优点也有缺点。

以下是 JTAG 的优点：

+   它可以获取带有未知 PIN 码/密码的锁定设备

+   支持 USB 调试关闭的锁定 Android 设备

+   支持许多 Windows Phone 型号

+   支持运行专有操作系统的设备（例如，Ubuntu Touch、Firefox OS 等）

+   有很大机会提取锁定、损坏和破损设备的内容

+   从不受任何取证工具支持的设备中提取数据

+   非破坏性，但具有侵入性

JTAG 采集的主要缺点包括：

+   无法破解加密（专家可能能够，也可能无法解密提取的图像）

+   需要较高的技能水平和丰富的专业知识

+   侵入性过程，需拆解设备

+   劳动密集型

+   相对较慢的采集速度（与 Chip-off 或 ISP 相比）

+   仅支持具有 TAP 端口的有限设备

+   可能需要不同种类的 JTAG 盒子来全面支持所有制造商或型号，这会增加显著的成本

JTAG 取证是一个劳动密集且耗时的过程，需要专家使用设备齐全的实验室。因此，取证专家通常会在其他方法失败后尝试 JTAG 采集。

# Chip-off

芯片提取法是一种高度先进且破坏性的提取技术，要求将导线连接到 PCB 接触点或物理去除（脱焊）手机的闪存芯片。与 JTAG 相比，芯片提取法被认为更为困难；然而，通过芯片提取法获取的信息量与通过 JTAG 获取的数据量相似。由于大多数智能手机使用标准的 eMMC 闪存模块，因此该过程是标准化的，通常不会给检查员带来意外。

在对计算机硬盘进行成像时，通常会尽量尝试进行尽可能低级的访问。在移动取证的领域，最低级别的访问并不总是最佳选择。虽然直接读取芯片会生成内存芯片的完整原始数据，但调查员可能会遇到加密分区，而加密密钥并没有存储在任何地方。对于苹果设备、许多三星手机以及其他设备（例如 Android 5 的 Nexus 系列）来说，加密是默认启用的。在低级获取或攻击离线镜像时，即使你知道正确的密码，这种强制加密也无法绕过。芯片提取法在对未加密设备使用时能提供最佳效果。

芯片提取法的好处包括：

+   可以获取未知 PIN 码/密码的锁定设备

+   支持 USB 调试关闭的锁定安卓设备

+   适用于所有 Windows Phone 型号

+   适用于运行专有操作系统的设备（例如，Ubuntu Touch、Firefox OS 等）

+   在提取被锁定、损坏和破损设备内容方面具有极高的成功率

+   从没有任何取证工具支持的设备中提取数据

+   支持没有 JTAG 端口的设备

+   高速获取

芯片提取法的主要缺点包括：

+   无法破解加密（专家可能能够或无法解密提取的镜像）

+   需要拆解设备

+   需要极高的专业知识

+   极度劳动密集

+   破坏性过程

在苹果 iOS 设备上，芯片提取法（Chip-off）没有作用，因为这些设备默认启用加密。对于加密的 BlackBerry 10 设备也无效；然而，BlackBerry 10 设备并未强制启用加密，也没有默认开启加密功能，因此 BB10 智能手机的加密状态应根据具体情况进行确认。

# 系统内编程

**系统内编程**（**ISP**）取证是芯片拆卸获取的非破坏性变体。ISP 是一种高级获取过程，介于 JTAG 和芯片拆卸之间。在获取过程中，检查员可以尝试在不拆除芯片的情况下提取 eMMC 存储器的内容。ISP 获取仅适用于使用 eMMC 或 eMCP 风格的**球栅阵列**（**BGA**）芯片的设备。访问内存是通过 BGA 芯片周围的接入点进行的。该获取过程被视为非破坏性的，因为如果一切顺利，设备在提取后可以重新组装并启动。

eMMC ISP 用于创建设备的二进制镜像，可以使用诸如 UFED 或 Oxygen Forensic Suite 等市面上众多的取证工具进行获取和分析。

ISP 的优势包括以下几点：

+   适用于 eMMC BGA 芯片的标准化程序

+   被视为非破坏性（设备可以在提取后重新组装并启动）

+   可以提取带有未知 PIN 码/密码的锁定设备

+   支持 USB 调试关闭的锁定 Android 设备

+   适用于所有 Windows Phone 型号

+   可用于运行专有操作系统的设备（例如，Ubuntu Touch、Firefox OS 等）

+   极大提高了从锁定、损坏或破损设备中提取内容的机会

+   从任何取证工具不支持的设备中提取数据

+   支持没有 JTAG 端口的设备

+   高获取速度

ISP 获取的主要缺点包括以下几点：

+   无法突破加密（专家可能能够，也可能无法解密提取的镜像）

+   高度侵入性的过程，需要拆解设备

+   仍然需要高水平的专业技能

+   劳动密集型

ISP 获取过程的局限性与芯片拆卸类似。加密设备最好使用其他获取技术，这意味着不能通过 ISP 获取任何苹果智能手机或平板电脑。从技术上讲，该技术可以用于 Apple iOS 设备；然而，解密数据分区将是不可能的。

# 总结

在本章中，我们概述了现有的获取方法，从相对简单的逻辑和云端提取到专家级且劳动密集型的芯片拆卸。我们还回顾了适用于各种移动平台的获取方法，并了解了每种方法的优缺点。从下一章开始，我们将深入探讨每个移动平台。下一章将提供关于获取运行 Android 操作系统的移动设备的详细技术信息。
