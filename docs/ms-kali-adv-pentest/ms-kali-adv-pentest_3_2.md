# 第八章：利用无线通信

随着移动设备的主导地位和提供即时网络连接的需求，无线网络已成为通往互联网的无处不在的接入点。不幸的是，无线访问的便利性伴随着有效攻击的增加，导致访问和数据的窃取，以及网络资源的拒绝服务。Kali 提供了几个工具来配置和发动这些无线攻击，使组织能够提高安全性。

在本章中，我们将研究几个日常维护任务和无线攻击，包括：

+   配置 Kali 进行无线攻击

+   无线侦察

+   绕过 MAC 地址认证

+   破解 WEP 加密

+   攻击 WPA 和 WPA2

+   无线攻击和社会工程学-克隆接入点

+   拦截通信-中间人无线攻击

+   中间人无线攻击

+   **拒绝服务**（DoS）攻击无线通信

# 配置 Kali 进行无线攻击

Kali Linux 发布了几个工具，以便测试无线网络；然而，这些攻击需要进行广泛的配置才能发挥完整的效果。此外，测试人员在实施攻击或审计无线网络之前，应该具备扎实的无线网络背景。

无线安全测试中最重要的工具是无线适配器，它连接到无线接入点。它必须支持所使用的工具，特别是`aircrack-ng`套件工具；特别是，适配器的芯片组和驱动程序必须具有将无线数据包注入通信流的能力。这是对需要将特定数据包类型注入到目标和受害者之间的流量中的攻击的要求。注入的数据包可以导致拒绝服务，使攻击者能够捕获破解加密密钥或支持其他无线攻击所需的握手数据。

`aircrack-ng`网站（[www.aircrack-ng.org](http://www.aircrack-ng.org)）包含已知兼容的无线适配器列表。

可以与 Kali 一起使用的最可靠的适配器是 ALFA NETWORK 卡，特别是**AWUS036NH**适配器，它支持无线 802.11 b、g 和 n 协议。Alfa 卡在网上很容易获得，并将支持使用 Kali 进行的所有测试和攻击。

# 无线侦察

进行无线攻击的第一步是进行侦察——这将确定确切的目标接入点，并突出显示可能影响测试的其他无线网络。

如果您使用 USB 连接的无线网卡连接到 Kali 虚拟机，请确保 USB 连接已从主机操作系统断开，并通过单击 USB 连接图标将其连接到 VM，该图标在以下截图中由箭头表示：

![无线侦察](img/3121OS_08_01.jpg)

接下来，通过从命令行运行`iwconfig`来确定可用的无线接口，如下截图所示：

![无线侦察](img/3121OS_08_02.jpg)

对于某些攻击，您可能希望增加适配器的功率输出。如果您与合法的无线接入点共处，并且希望目标连接到您控制的虚假接入点而不是合法接入点，则这是非常有用的。这些虚假的，或**流氓**，接入点允许攻击者拦截数据并根据需要查看或更改数据以支持攻击。攻击者经常会复制或克隆一个合法的无线站点，然后增加其传输功率以吸引受害者。要增加功率，使用以下命令：

```
kali@linux:~# iwconfig wlan0 txpower 30

```

许多攻击将使用`aircrack-ng`及其相关工具进行。首先，我们需要能够拦截或监视无线传输；因此，我们需要使用`airmon-ng`命令将 Kali 通信接口设置为*监视模式*：

```
kali@linux:~# airmon-ng start wlan0

```

执行上一个命令的结果显示在以下截图中：

![无线侦察](img/3121OS_08_03.jpg)

请注意，返回的描述表明有一些进程*可能会引起麻烦*。处理这些进程的最有效方法是使用全面的 kill 命令，如下所示：

```
root@kali:~# airmon-ng check kill

```

要查看本地无线环境，请使用以下命令：

```
root@kali:~# airodump-ng mon0

```

上一个命令列出了可以在特定时间点内在无线适配器范围内找到的所有已识别的网络。它提供了网络上无线节点的 BSSID，由 MAC 地址标识，相对输出功率的指示，发送的数据包信息，包括使用的信道的带宽信息，以及数据，加密使用的信息，以及 ESSID，提供了无线网络的名称。此信息显示在以下截图中；非必要的 ESSID 已被模糊处理：

![无线侦察](img/3121OS_08_04.jpg)

`airodump`命令循环遍历可用的无线信道，并识别以下内容：

+   基本服务集标识符（BSSID），这是唯一的 MAC 地址，用于识别无线接入点或路由器。

+   每个网络的`PWR`或功率。虽然`airodump-ng`错误地显示功率为负，但这是一种报告工件。要获得正确的正值，请访问终端并运行`airdriver-ng unload 36`，然后运行`airdriver-ng load 35`。

+   `CH`显示正在使用的信道。

+   `ENC`显示正在使用的加密——如果没有使用加密，则为`OPN`或开放，如果使用了加密，则为`WEP`或`WPA`/`WPA2`。`CIPHER`和`AUTH`提供额外的加密信息。

+   扩展服务集标识符（ESSID）是由共享相同 SSID 或名称的接入点组成的无线网络的通用名称。

在终端窗口的下部，您将看到试图连接或已连接到无线网络的站点。

在我们可以与任何这些（潜在的）目标网络进行交互之前，我们必须确认我们的无线适配器是否能够进行数据包注入。为此，请从终端 shell 提示符运行以下命令：

```
root@kali:~# aireplay-ng -9 mon0

```

上一个命令的执行显示在以下截图中。这里的`-9`表示注入测试。

![无线侦察](img/3121OS_08_05.jpg)

## Kismet

无线侦察最重要的工具之一是 Kismet，这是一个 802.11 无线侦测器、嗅探器和入侵检测系统。

Kismet 可用于收集以下信息：

+   无线网络的名称，ESSID

+   无线网络的信道

+   接入点的 MAC 地址，BSSID

+   无线客户端的 MAC 地址

它还可以用于嗅探 802.11a、802.11b、802.11g 和 802.11n 无线流量的数据。Kismet 还支持插件，允许它嗅探其他无线协议。

要启动 Kismet，请在终端窗口的命令提示符中输入`kismet`。

启动 Kismet 时，您将面临一系列问题，这些问题将允许您在启动过程中对其进行配置。回答“是”以“您能看到颜色”，接受“Kismet 正在以 root 身份运行”，并选择“是”以“启动 Kismet 服务器”。在 Kismet 启动选项中，取消选中“显示控制台”，因为它会遮挡屏幕。允许 Kismet 启动。

您将被提示添加一个捕获接口；通常会选择`wlan0`。

Kismet 然后将开始嗅探数据包，并收集有关所有位于附近物理邻域的无线系统的信息。

![Kismet](img/3121OS_08_06.jpg)

通过双击选择一个网络，将带您进入一个网络视图，提供有关无线网络的其他信息。

您还可以深入了解连接到各种无线网络的特定客户端。

使用 Kismet 作为初始侦察工具来启动一些特定的攻击（如嗅探传输数据）或识别网络。因为它 passively 收集连接数据，所以它是一个用于识别隐藏网络的优秀工具，特别是当 SSID 没有公开传输时。

# 绕过隐藏的服务集标识符

ESSID 是唯一标识无线局域网的字符序列。隐藏 ESSID 是一种试图通过“安全性通过混淆”来实现安全性的不良方法；不幸的是，ESSID 可以通过以下方式获得：

+   嗅探无线环境并等待客户端关联到网络，然后捕获该关联

+   主动去认证客户端以强制客户端关联，然后捕获该关联

`aircrack`工具特别适合捕获解除隐藏 ESSID 所需的数据，如以下步骤所示：

1.  在命令提示符下，通过输入以下命令确认攻击系统上已启用无线功能：

```
root@kali:~# airmon-ng

```

1.  接下来，使用以下`ifconfig`命令来查看可用的接口，并确定您的无线系统使用的确切名称：

```
root@kali:~# ifconfig

```

1.  通过输入以下内容启用您的无线接口（您可能需要用前一步骤中识别的可用无线接口替换`wlan0`）：

```
root@kali:~# airmon-ng start wlan0

```

1.  如果您使用`ifconfig`重新确认，您将看到现在正在使用监视或`mon0`地址。现在，使用`airodump`确认可用的无线网络，如以下命令所示：

```
root@kali:~# airodump-ng mon0

```

![绕过隐藏的服务集标识](img/3121OS_08_07.jpg)

正如您所看到的，第一个网络的 ESSID 只被标识为`<length: 9>`。没有使用其他名称或标识。隐藏的 ESSID 的长度被确定为由九个字符组成；然而，这个值可能不正确，因为 ESSID 是隐藏的。真正的 ESSID 长度可能比九个字符短或长。

重要的是可能有客户端连接到这个特定的网络。如果有客户端存在，我们将去认证客户端，迫使他们在重新连接到接入点时发送 ESSID。

重新运行`airodump`，并过滤出除目标接入点以外的所有内容。在这种特殊情况下，我们将专注于使用以下命令从第六信道的隐藏网络收集数据：

```
root@kali:~# airodump-ng -c 6 mon0

```

执行该命令会删除来自多个无线源的输出，并允许攻击者专注于目标 ESSID，如以下屏幕截图所示：

![绕过隐藏的服务集标识](img/3121OS_08_08.jpg)

执行`airodump`命令时得到的数据表明，有一个站点（`00:0E:2E:CF:8C:7C`）连接到 BSSID（`00:18:39:D5:5D:61`），后者又与隐藏的 ESSID 相关联。

要捕获 ESSID 在传输时，我们必须创建一个条件，在这种条件下我们知道它将被发送——在客户端和接入点之间的连接的初始阶段。

因此，我们将向客户端和接入点发动去认证攻击，发送一系列数据包，打破它们之间的连接，迫使它们重新认证。

要发动攻击，打开一个新的命令窗口，并输入以下屏幕截图中显示的命令（`0`表示我们正在发动去认证攻击，`10`表示我们将发送 10 个去认证数据包，`-a`是目标接入点，`c`是客户端的 MAC 地址）：

![绕过隐藏的服务集标识](img/3121OS_08_09.jpg)

在发送所有去认证数据包后，返回到监视第六信道上的网络连接的原始窗口，如以下屏幕截图所示。您现在将清楚地看到 ESSID。

![绕过隐藏的服务集标识](img/3121OS_08_10.jpg)

知道 ESSID 有助于攻击者确认他们正在专注于正确的网络（因为大多数 ESSID 都基于公司身份）并促进登录过程。

# 绕过 MAC 地址认证

**媒体访问控制**（**MAC**）地址在网络中唯一标识每个节点。它采用六对十六进制数字（0 到 9 和字母 A 到 F）的形式，由冒号或破折号分隔，通常看起来像这样：`00:50:56:C0:00:01`。

MAC 地址通常与网络适配器或具有网络功能的设备相关联；因此，它经常被称为物理地址。

MAC 地址中的前三对数字称为**组织唯一标识符**，它们用于识别制造或销售设备的公司。最后三对数字是特定于设备的，并且可以被视为*序列号*。

因为 MAC 地址是唯一的，它可以用来将用户与特定网络关联起来，特别是无线网络。这有两个重要的含义——它可以用来识别黑客或试图访问网络的合法网络测试人员，并且可以用作认证个人并授予他们对网络的访问权限的手段。

在渗透测试期间，测试人员可能希望对网络保持匿名。支持匿名配置的一种方法是更改攻击系统的 MAC 地址。

这可以通过使用`ifconfig`命令手动完成。要确定现有的 MAC 地址，请从命令行运行以下命令：

```
root@kali:~# ifconfig wlan0 down
root@kali:~# ifconfig wlan0 | grep HW

```

手动更改 IP 地址，请使用以下命令：

```
root@kali:~# ifconfig wlan0 hw ether 38:33:15:xx:xx:xx
root@kali:~# ifconfig wlan0 up

```

用不同的十六进制对替换“xx”表达式。这个命令将允许我们将攻击系统的 MAC 地址更改为受害者网络接受的 MAC 地址之一。攻击者必须确保 MAC 地址在网络上尚未被使用，否则重复的 MAC 地址可能会在网络被监视时触发警报。

### 注意

在更改 MAC 地址之前，无线接口必须被关闭。

Kali 还允许使用自动化工具`macchanger`。要将攻击者的 MAC 地址更改为由同一供应商生产的产品的 MAC 地址，请在终端窗口中使用以下`macchanger`命令：

```
root@kali:~# macchanger wlan0 -e

```

要将现有的 MAC 地址更改为完全随机的 MAC 地址，请使用以下命令：

```
root@kali:~# macchanger wlan0 -r

```

![绕过 MAC 地址认证](img/3121OS_08_11_new.jpg)

一些攻击者使用自动化脚本在测试期间频繁更改 MAC 地址，以匿名化他们的活动。

许多组织，特别是大型学术团体，如学院和大学，使用 MAC 地址过滤来控制谁可以访问他们的无线网络资源。MAC 地址过滤使用网络卡上的唯一 MAC 地址来控制对网络资源的访问；在典型的配置中，组织维护一个 MAC 地址的**白名单**，允许访问网络的 MAC 地址。如果传入的 MAC 地址不在批准的访问列表上，它将被限制连接到网络。

不幸的是，MAC 地址信息是明文传输的。攻击者可以使用`airodump`收集一系列被接受的 MAC 地址，然后手动将他们的 MAC 地址更改为目标网络接受的地址之一。因此，这种类型的过滤几乎不提供对无线网络的真正保护。

使用加密提供了下一级别的无线网络保护。

# 破解 WEP 加密

**无线等效隐私**（**WEP**）始于 1999 年，旨在为 802.11 无线网络提供与有线网络相媲美的保密度。在其加密实现中很快发现了多个缺陷，到 2004 年被**WiFi 保护访问**（**WPA**）协议取代。

### 注意

WEP 至今仍在使用，特别是在无法支持新无线路由器资源需求的旧网络中。在最近对一个主要大都市中心的无线调查中，几乎 25%的加密无线网络继续使用 WEP。其中许多网络与金融公司相关。

WEP 的主要缺陷之一是在**初始化向量**（**IV**）的重用中首次被发现。WEP 依赖于 RC4 加密算法，这是一种流密码——相同的加密密钥不能重复使用。IV 被引入以防止密钥重用，通过在加密数据中引入一定程度的*随机性*。不幸的是，24 位 IV 太短，无法防止重复；此外，同一个 IV 在传输了仅 5000 个数据包后就有 50%的概率重复。

攻击者可以窃听或拦截 WEP 加密的流量。根据可用于检查的拦截数据包数量，密钥恢复可能会很快发生。实际上，大多数 WEP 密钥可以在三分钟内恢复或*破解*。

要使 WEP 破解起作用，您还需要了解有关目标的以下信息：

+   无线网络的名称或 ESSID

+   接入点的 MAC 地址，BSSID

+   使用的无线频道

+   无线客户端的 MAC 地址

对 WEP 的最常见攻击可以通过执行以下步骤来完成：

1.  首先，使用以下命令识别可用的无线网络接口：

```
root@kali:~# airmon-ng

```

1.  停止接口以更改 MAC 地址为已与目标网络关联的现有客户端正在使用的地址。您还可以在此步骤中使用`macchanger`。当 MAC 地址已更改时，重新启动`airmon-ng`。使用以下命令执行这些步骤：

```
root@kali:~# airmon-ng stop
root@kali:~# ifconfig wlan0 down
root@kali:~# ifconfig wlan0 hw ether (mac address)
root@kali:~# airmon-ng start wlan0

```

使用已知和接受的 MAC 地址简化了攻击。然而，情况并非总是如此。这种攻击假设您*不*知道 MAC 地址。相反，我们将与网络进行虚假关联。

1.  使用以下`airodump`命令来定位目标无线网络：

```
root@kali:~# airodump-ng wlan0

```

当`airodump`定位到目标时，按下*Ctrl* + *C*停止搜索。复制 BSSID 中的 MAC 地址，并记下频道。当`airodump`定位到目标时，按下*Ctrl* + *C*停止搜索。复制 BSSID 中的 MAC 地址，并记下频道；在下面截图中显示的示例中，目标网络`dd_wep`在速度为 11 MB 的第六频道上运行。

![破解 WEP 加密](img/3121OS_08_12.jpg)

1.  启动`airodump-ng`以嗅探无线流量并使用以下命令收集 IV 数据包，其中`--bssid`允许我们选择目标的 BSSID，`-c`表示频道，`-w`允许我们写入输出文件的名称（`wep_out`）：

```
root@kali:~# airodump-ng --bssid 00:06:25:9A:A9:C6 -c 6 -w
  wep_out wlan0 

```

1.  现在我们必须增加传输的 IV 数据包数量。打开第二个终端窗口（不要关闭第一个）并输入以下命令，对目标无线接入点进行虚假认证：

```
root@kali:~# aireplay-ng -1 0 -a 00:06:25:9A:A9:C6 -h 
  00:11:22:33:44:55 -e dd_wep wlan0 

```

这里，`-1`表示虚假认证，`0`是重新关联的时间（设置为`0`可能会引起防御者的警觉，因此攻击者可能将其设置为 30 甚至更高）。

1.  在进行虚假认证后，我们将生成似乎来自受信任 MAC 地址的流量，并将其路由到目标无线接入点。

```
root@kali:~# aireplay-ng -3  -b 00:06:25:9A:A9:C6 -h 
  00:11:22:33:44:55 wlan0 

```

这种攻击被称为 ARP 注入或 ARP 重放攻击。通常，目标接入点将重新广播 ARP 数据包并每次生成一个新的 IV；因此，这是一种快速培育必要 IV 的方法。

先前命令的执行结果如下截图所示：

![破解 WEP 加密](img/3121OS_08_13.jpg)

1.  让我们在 ARP 注入继续的同时生成一些额外的数据包。打开另一个终端窗口，并输入以下命令开始交互式数据包重放攻击：

```
root@kali:~# aireplay-ng -2 -p 0841 -c FF:FF:FF:FF:FF:FF 
  - b (mac address) -h (mac address) wlan0 

```

在这里，`-2`表示我们正在使用交互式重放攻击，`-p 0841`设置数据包的帧控制字段，使其看起来像是从无线客户端发送的，`-c FF:FF:FF:FF:FF:FF`设置目的地（在这种情况下，`FF`符号发送数据包到网络上的所有主机），`-b`是 BSSID 的 MAC 地址，`-h`是正在传输的数据包的 MAC 地址，应与测试者的 MAC 地址匹配。

先前命令的执行结果如下截图所示：

![破解 WEP 加密](img/3121OS_08_14_new.jpg)

1.  使网络看起来繁忙的另一种技术是在攻击系统上打开多个命令 shell，并输入以下命令，将（`IP 地址`）替换为目标的 IP 地址：

```
root@kali:~# ping -T -L 6500 (IP address)

```

1.  收集并保存足够的数据包后，可以使用以下`aircrack-ng`命令来破解 WEP 密钥，其中`-a 1`强制攻击模式为静态 WEP，`-b`是 BSSID，`dd_wep.cap`是包含捕获的 IV 的捕获文件。

```
root@kali:~# aircrack-ng -a 1 -b 00:06:25:9A:A9:C6 -n 64 
  dd_wep.cap 

```

如下面的截图所示，攻击成功，并且密钥已被识别。（尽管它看起来是一个十六进制数，您只需输入它即可登录到 WEP 网络。）

![破解 WEP 加密](img/3121OS_08_15.jpg)

尽管这个演示集中在 64 位密钥上，但一旦从访问点收集了 IVs，更长的密钥破解时间并不会显著增加。

`aircrack-ng`套件是“黄金标准”，提供了获得访问的最可靠和有效的方式。然而，Kali 还配备了其他几种工具，可以帮助您破解加密的无线网络。

其中一个是 Fern WiFi Cracker，它是一个集成了`aircrack-ng`的 Python GUI。它可以自动扫描无线网络并识别 WEP、WPA 和 WPA2 网络。一旦识别出网络，攻击者可以利用以下几个功能：

+   使用各种攻击来破解 WEP，包括分段、Chop Chop、Caffe Latte、Hirte、ARP 请求重放或 WPS 攻击

+   使用字典或基于 WPS 的攻击来破解 WPA 和 WPA2

+   成功破解后自动将密钥保存到数据库

+   内部中间人引擎支持会话劫持

+   对 HTTP、HTTPS、Telnet 和 FTP 进行暴力攻击

Fern 的界面非常干净，设置引导用户选择接口并扫描访问点。它将报告 WEP 和 WPA/WPA2 的访问点；从这一点开始，只需点击适当的按钮启动攻击。Fern 的初始启动界面如下截图所示：

![破解 WEP 加密](img/3121OS_08_16.jpg)

尽管 Fern 是一个很好的工具，但大多数测试人员并不完全依赖它——如果无法识别密钥或无法访问网络，失败的原因可能隐藏在 GUI 背后，使故障排除变得困难。

类似的应用程序是 Wifite 无线审计员，它提供了一个基于文本的界面来支持测试。在现场测试中已被证明非常有效，并利用了以下功能：

+   Wifite 通过在攻击之前将攻击者的 MAC 地址更改为随机 MAC 地址来支持匿名，并在所有攻击完成后将其改回来

+   按信号强度（以 dB 为单位）对目标进行排序，以首先破解最近的访问点

+   自动使隐藏网络的客户端脱机以显示 SSID

+   支持多种攻击类型

在下面的截图中显示的示例中，选择了一个名为`dd_wep`的单个目标进行攻击。不需要与应用程序进行任何其他交互；它完成了完全的破解并将破解的密钥保存到数据库中。

![破解 WEP 加密](img/3121OS_08_17.jpg)

尽管已经有一些基本工具可以在 Kali 上使用来证明已经废弃的 WEP 的漏洞，但更强大的 WPA 加密协议能经受住多大的攻击呢？

# 攻击 WPA 和 WPA2

**WiFi Protected Access**（**WPA**）和**WiFi Protected Access 2**（**WPA2**）是旨在解决 WEP 安全缺陷的无线安全协议。因为 WPA 协议为每个数据包动态生成新密钥，它们防止了导致 WEP 失败的统计分析。然而，它们对一些攻击技术是脆弱的。

WPA 和 WPA2 经常使用**预共享密钥**（**PSK**）来保护接入点和无线客户端之间的通信。PSK 应该是至少 13 个字符长的随机密码；如果不是，就有可能通过将 PSK 与已知字典进行比较来确定 PSK，使用暴力破解攻击。这是最常见的攻击方式。（请注意，如果配置为企业模式，提供使用 RADIUS 认证服务器进行认证，从我们的角度来看，WPA 是“无法破解”的！）

## 暴力破解攻击

与 WEP 不同，WPA 解密需要攻击者创建特定的数据包类型，以揭示细节，例如接入点和客户端之间的握手。

要攻击 WPA 传输，应执行以下步骤：

1.  启动无线适配器，并使用`ifconfig`命令确保创建了监视接口。

1.  使用`airodump-ng –wlan0`来识别目标网络。

1.  使用以下命令开始捕获目标接入点和客户端之间的流量：

```
root@kali:~# airodump-ng --bssid 28:10:7B:61:20:32 -c 11 
  --showack -w dd_wpa2 wlan0 

```

将`-c`设置为监视特定频道，`--showack`标志以确保客户端计算机确认您的请求将其从无线接入点去认证，并将`-w`用于将输出写入文件以供以后进行字典攻击。这种攻击的典型输出如下截图所示：

![Brute-force attacks](img/3121OS_08_18.jpg)

1.  保持这个终端窗口打开，并打开第二个终端窗口来发起去认证攻击；这将迫使用户重新对目标接入点进行认证并重新交换 WPA 密钥。去认证攻击命令如下所示：

```
root@kali:~# aireplay-ng -0 10 –a 28:10:7B:61:20:32 
  -c 00:1D:60:7D:55:5A wlan0 

```

上一个命令的执行结果如下截图所示：

![Brute-force attacks](img/3121OS_08_19.jpg)

成功的去认证攻击将显示`ACKs`，表明连接到目标接入点的客户端已确认刚刚发送的去认证命令。

1.  查看原始命令行，保持打开以监视无线传输，并确保捕获 4 次握手。成功的 WPA 握手将在控制台的右上角标识。在下面的示例中，数据表明 WPA 握手值为`28:10:7B:61:20:32`：![Brute-force attacks](img/3121OS_08_20.jpg)

1.  使用`aircrack`来破解 WPA 密钥，使用定义的单词列表。攻击者为收集握手数据定义的文件名将位于根目录中，并且将附加`-01.cap`扩展名。

在 Kali 中，单词列表位于`/usr/share/wordlists`目录中。虽然有几个单词列表可用，但建议您下载更有效地破解常见密码的列表。

在上面的示例中，密钥已经预先放置在密码列表中。对于长、复杂的密码进行字典攻击可能需要几个小时，具体取决于系统配置。以下命令使用`words`作为源单词列表。

```
root@kali:~# aircrack-ng wpa-01.cap /usr/share/wordlists

```

以下截图显示了成功破解 WPA 密钥的结果；经过 44 个密钥的测试，发现网络管理员的密钥是`princessmouse`。

![Brute-force attacks](img/3121OS_08_21.jpg)

如果你手头没有自定义密码列表或希望快速生成一个列表，你可以在 Kali 中使用 crunch 应用程序。以下命令指示 crunch 使用给定的字符集创建一个最小长度为 5 个字符、最大长度为 25 个字符的单词列表：

```
root@kali:~# crunch 0 25
  abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX
  YZ0123456789 | aircrack-ng --bssid (MAC address) 
  -w capture-01.cap 

```

您还可以使用基于 GPU 的密码破解工具（oclHashcat 用于 AMD/ATI 显卡，cudaHashcat 用于 NVIDIA 显卡）来提高暴力破解攻击的效果。

要执行此攻击，首先使用以下命令将 WPA 握手捕获文件`psk-01.cap`转换为 hashcat 文件：

```
root@kali:~# aircrack-ng psk-01.cap -J <output file>

```

转换完成后，使用以下命令对新的捕获文件运行 hashcat（选择与您的 CPU 架构和图形卡匹配的 hashcat 版本）：

```
root@kali:~# cudaHashcat-plus32.bin -m 2500 <filename>.hccap<wordlist>

```

## 使用 Reaver 攻击无线路由器

WPA 和 WPA2 也容易受到对接入点的 Wi-Fi 受保护设置（WPS）和 PIN 码的攻击。

大多数接入点支持**Wi-Fi 受保护设置**（**WPS**）协议，该协议于 2006 年成为标准，允许用户轻松设置和配置接入点，并将新设备添加到现有网络，而无需重新输入大而复杂的密码。

不幸的是，PIN 码是一个 8 位数字（100,000,000 种可能的猜测），但最后一个数字是一个校验和值。因为 WPS 认证协议将 PIN 码分成两半并分别验证每一半，这意味着第一半 PIN 码有 10⁴（10,000）个值，第二半有 10³（1,000）个可能的值——攻击者只需最多猜测 11,000 次就能破坏接入点！

Reaver 是一个旨在最大化猜测过程的工具（尽管 Wifite 也进行 WPS 猜测）。

要启动 Reaver 攻击，使用一个名为`wash`的伴侣工具来识别任何易受攻击的网络，如以下命令所示：

```
root@kali:~# wash -i wlan0 --ignore-fcs

```

如果有任何易受攻击的网络，使用以下命令对它们发动攻击：

```
root@kali:~# reaver -i wlan0 -b (BBSID) -vv

```

在 Kali 中测试这种攻击表明，攻击速度慢，容易失败；然而，它可以用作后台攻击或补充其他攻击路径来破坏 WPA 网络。

# 克隆接入点

对无线网络的一种更有趣的攻击依赖于克隆接入点，然后监视用户尝试连接时传输的信息。攻击者不仅可以获得认证凭据，还可以利用中间人攻击来拦截或重定向网络流量。

Kali 中包含的几个工具声称支持克隆或制造伪造接入点；然而，目前这些工具存在缺陷。例如，社会工程工具包和 Websploit 不与 Kali 预装的 DHCP 服务器集成。

大多数攻击者寻找外部工具，包括 Gerix 或 easy-creds 等脚本；然而，`aircrack-ng`套件也包括一个工具。`airbase-ng`，用于克隆接入点。

为了制作一个假的无线接入点，攻击者将：

1.  启动`wlan0`进入监视模式，这将创建一个用于监视的`mon0`接口，使用以下命令：

```
root@kali:~# airmon-ng start wlan0

```

1.  使用以下命令在`mon0`上设置接入点（AP）。社会工程学对 AP 的成功有重大影响，因此使用一个能吸引目标客户的名称。在这个例子中，我们将使用一个通用的开放式 Wi-Fi 网络名称。它将在 WiFi 频道六上建立：

```
root@kali:~# airbase-ng --essid Customer_Network 
  -c 6 mon0 

```

1.  使用以下命令安装桥接工具：

```
apt-get install bridge-utils

```

1.  在另一个终端窗口中，使用桥接工具创建一个桥接（`rogue`），并将`at0`（`at0`接口是由前一个命令创建的）链接到`eth0`（请注意，必须首先使用`apt-get install bridge-utils`安装桥接工具）。

```
root@kali:~# brctl addbr rogue
root@kali:~# brctl addif rogue at0
root@kali:~# brctl addif rogue eth0

```

因为这两个接口被集成到虚拟桥中，你可以使用以下命令释放它们的 IP 地址：

```
root@kali:~# ifconfig at0 down
root@kali:~# ifconfig at 0.0.0.0 up
root@kali:~# ifconfig eth0 down
root@kali:~# ifconfig eth0 0.0.0.0 up

```

1.  使用以下命令启用桥接上的 IP 转发：

```
root@kali:~# echo 1 > /proc/sys/net/ipv4/ip_forward

```

1.  使用以下命令配置桥接到连接到`eth0`的 LAN 的 IP 地址：

```
root@kali:~# ifconfig rogue 10.1.x.y netmask 255.255.255.0 broadcast 10.1.x.255 up
root@kali:~# route add default gw 10.1.x.1

```

1.  使用以下命令启动 AP 以嗅探认证握手：

```
airbase-ng -c 6 -e --ESSID /file_path/file.cap wlan0

```

# 拒绝服务攻击

我们将评估对无线网络的最终攻击是拒绝服务攻击，攻击者剥夺合法用户访问无线网络或通过使网络崩溃使其不可用。无线网络极易受到 DoS 攻击的影响，并且很难在分布式无线网络上定位攻击者。DoS 攻击的例子包括以下内容：

+   向无线网络注入制作的网络命令，如重新配置命令，可以导致路由器、交换机和其他网络设备的故障。

+   一些设备和应用程序可以识别正在发生的攻击，并将自动响应以禁用网络。一个恶意的攻击者可以发动一个明显的攻击，然后让目标自己创建 DoS！

+   用数据包的洪水攻击无线网络可以使其无法使用；例如，一个 HTTP 洪水攻击向 Web 服务器发出数千个页面请求，可以耗尽其处理能力。同样，用认证和关联数据包淹没网络会阻止用户连接到接入点。

+   攻击者可以制作特定的去认证和去关联命令，这些命令用于关闭无线网络上的授权连接，并淹没网络，阻止合法用户维持与无线接入点的连接。

为了证明这一点，我们将通过向网络发送去认证数据包来制造一个拒绝服务攻击。因为无线 802.11 协议是建立在接收到特定数据包时支持去认证的基础上的（这样用户可以在不再需要连接时断开连接），这可能是一个毁灭性的攻击——它符合标准，没有办法阻止它发生。

“撞”一个合法用户离开网络的最简单方法是用一连串的去认证数据包来攻击他们。可以使用`aircrack-ng`工具套件的以下命令来实现这一点：

```
root@kali:~# aireplay-ng -0 0 -a (bssid) -c wlan0

```

这个命令将攻击类型标识为`-0`，表示这是一个去认证攻击。第二个`0`（零）会发出一连串的去认证数据包，使网络对其用户不可用。

Websploit 框架是一个用于扫描和分析远程系统的开源工具。它包含了几个工具，包括专门用于无线攻击的工具。要启动它，打开命令行，然后简单地输入`websploit`。

Websploit 界面类似于`recon-ng`和 Metasploit Framework，并为用户提供了模块化界面。

启动后，使用`show modules`命令查看现有版本中存在的攻击模块。使用`use wifi/wifi_jammer`命令选择 WiFi 干扰器（一连串的去认证数据包）。如下截图所示，攻击者只需使用`set`命令设置各种选项，然后选择`run`来发动攻击。

![拒绝服务攻击](img/3121OS_08_22.jpg)

# 总结

在本章中，我们研究了对无线网络成功攻击所需的几个管理任务，包括选择无线适配器、配置无线调制解调器，并使用诸如 aircrack-ng Kismet 等工具进行侦察。我们专注于使用`aircrack-ng`工具套件来识别隐藏网络、绕过 MAC 认证以及破解 WEP 和 WPA/WPA2 加密。我们还看到了如何克隆或复制无线接入点，以及如何对无线网络进行拒绝服务攻击。

下一章将重点介绍攻击者如何针对网站及其服务。我们将研究用于侦察的工具，特别是客户端代理和漏洞扫描器。我们将看到攻击者如何利用这些漏洞与自动化工具，如利用框架和在线密码破解。更重要的是，我们将研究一些通常需要手动干预的离散攻击，例如注入攻击和跨站脚本。最后，我们将探讨在线服务的特殊性，以及它们为何以及如何容易受到 DoS 攻击的影响。

