# 第一章：从 Kali Linux 开始

Kali Linux（Kali）是 BackTrack 渗透测试平台的继任者，通常被认为是用于保护数据和语音网络的渗透测试的事实标准工具包。本章介绍了 Kali，并侧重于定制 Kali 以支持渗透测试的一些高级方面。通过本章的学习，您将学到：

+   Kali 概述

+   配置网络服务和安全通信

+   更新 Kali

+   定制 Kali

+   使用第三方应用程序扩展 Kali 的功能

+   有效管理渗透测试

# Kali Linux

**BackTrack**（BT）（[www.offensive-security.com](http://www.offensive-security.com)）发布，提供了广泛的渗透测试和防御工具，非常适合对网络进行评估和保护的审计员和网络管理员。授权和未经授权（黑客）渗透测试人员都使用相同的工具。

BackTrack 的最终版本 BT 5r3 于 2012 年 8 月发布。基于 Ubuntu Linux 平台，它被安全社区广泛采用和支持。不幸的是，它的文件架构使得难以管理各种工具及其相关依赖。

在 BackTrack 中，用于渗透测试的所有工具都放在/pentest 目录中。子文件夹如/web 或/database 有助于进一步定义工具的位置。在这种层次结构中查找和执行工具可能是不直观的。例如，用于识别 SQL 注入的 sqlninja 是 Web 漏洞评估工具、Web 利用工具还是数据库利用工具？

2013 年 3 月，BackTrack 被 Kali Linux 取代，后者使用基于 Debian GNU/Linux 操作系统的新平台架构。

Debian 遵循文件系统层次结构标准（FHS），这是与 BackTrack 相比的一个重要优势。不需要在/pentest 树中导航，因为应用程序包含在系统路径中，可以从系统的任何位置调用工具。

Kali 的其他特性包括：

+   支持多个桌面环境，如 Gnome、KDE、LXDE 和 XFCE，并提供多语言支持。

+   符合 Debian 的工具至少每天同步四次，这样更容易更新软件包并应用安全补丁。

+   支持 ISO 定制，允许用户构建自己的 Kali 版本。引导功能还可以执行企业范围的网络安装，可以使用预先配置文件进行自动化。

+   ARMEL 和 ARMHF 支持使得 Kali 可以安装在树莓派、ODROID-U2/-X2 和三星 Chromebook 等设备上。

+   包括 300 多个渗透测试数据取证和防御工具。它们提供了广泛的无线支持，通过内核补丁允许一些无线攻击所需的数据包注入。

+   Kali 仍然是一个免费的开源项目。最重要的是，它得到了活跃的在线社区的支持。

在本书中，我们将使用 64 位 Kali 的 VMware 虚拟机（参见附录，*安装 Kali Linux*中有有关安装 Kali 的说明）。

使用 VM 是因为它可以轻松地在其他操作系统中快速执行某些应用程序，比如 Microsoft Windows。此外，可以使用 VM 存档进行渗透测试的结果，以便审查存档，以确定特定漏洞是否会被用于测试的工具集检测到。

启动 Kali 时，用户将进入默认的桌面 GUI，顶部有一个菜单栏和一些简单的图标。通过选择菜单项**应用程序**，然后**Kali Linux**，用户将获得一个包含**前 10 个安全工具**以及一系列文件夹的菜单系统，这些文件夹按照渗透测试中的一般顺序进行组织，如下截图所示：

![Kali Linux](img/3121OS_01_01.jpg)

### 注意

该菜单对于 BT 5r3 的用户来说是熟悉的。然而，有一些变化，包括简化了对网络服务和通信的访问。

# 配置网络服务和安全通信

使用 Kali 的第一步是确保它能够连接到有线或无线网络，以支持更新和定制。

您可能需要通过**DHCP**（**动态主机配置协议**）获取 IP 地址，或者静态分配一个 IP 地址。首先，使用终端窗口中的`ifconfig`命令确认您的 IP 地址，如下截图所示：

![配置网络服务和安全通信](img/3121OS_01_02_New.jpg)

在这种特殊情况下，VM 被分配了 IP 地址`192.168.204.132`。如果没有获得 IP 地址，可以使用命令`dhclient eth0`（或其他可用接口，这将取决于所使用系统的具体配置）通过 DHCP 分配地址。

如果使用静态 IP 地址，可能需要额外的信息。例如，您可以分配静态 IP`192.168.204.128`如下：

```
 host IP address:    192.168.204.128
 subnet mask:  255.255.255.0
 default gateway:  192.168.204.1
 DNS server:    192.168.204.10

```

输入终端窗口并输入以下命令：

```
root@kali:~#  ifonconfig eth0 192.168.204.128/24
root@kali:~#  route add default gw 192.168.204.1
root@kali:~#  echo nameserver 192.168.204.10 > /etc/resolv.conf

```

对 IP 设置的更改是非持久的，在 Kali 重新启动时将丢失。要使更改永久生效，您需要编辑`/etc/network/interfaces`文件，如下截图所示：

![配置网络服务和安全通信](img/3121OS_01_03.jpg)

默认情况下，Kali 不会启用 DHCP 服务。这样做会在网络上宣布新的 IP 地址，这可能会提醒管理员有测试者的存在。对于某些测试案例，这可能不是一个问题，而且在启动时自动启动某些服务可能是有利的。可以通过输入以下命令来实现这一点：

```
root@kali~# update-rc.d networking defaults
root@kali~# /etc/init.d/networking restart

```

Kali 安装了可以根据需要启动或停止的网络服务，包括 DHCP、HTTP、SSH、TFTP 和 VNC 服务器。这些服务通常是从命令行调用的，但是有些可以从 Kali 菜单中访问。

## 调整网络代理设置

位于经过身份验证或未经身份验证的代理连接后的用户必须修改`bash.bashrc`和`apt.conf`。这两个文件位于`/root/etc`目录中。

1.  编辑`bash.bashrc`文件，如下截图所示，使用文本编辑器将以下行添加到`bash.bashrc`文件的底部：

```
export ftp_proxy="ftp://user:password@proxyIP:port"
export http_proxy="http://user:password@proxyIP:port"
export https_proxy="https://user:password@proxyIP:port"
export socks_proxy="https://user:password@proxyIP:port"

```

![调整网络代理设置](img/3121OS_01_05.jpg)

1.  用你的代理 IP 地址和端口号分别替换`proxyIP`和`port`，用你的认证用户名和密码替换用户名和密码。如果不需要进行身份验证，只需写`@`符号后面的部分。

1.  在同一目录中，创建`apt.conf`文件并输入以下命令行，如下截图所示：![调整网络代理设置](img/3121OS_01_06.jpg)

1.  保存并关闭文件。注销然后重新登录以激活新设置。

## 使用安全外壳保护通信

为了在测试期间最大程度地减少目标网络的检测，Kali 不会启用任何外部监听网络服务。一些服务，如**安全外壳**（**SSH**），已经安装。但是，在使用之前必须启用它们。

Kali 预先配置了默认的 SSH 密钥。在启动 SSH 服务之前，最好禁用默认密钥并生成用于使用的唯一密钥集。

将默认的 SSH 密钥移动到备份文件夹，然后使用以下命令生成新的 SSH 密钥集：

```
dpkg-reconfigure openssh-server

```

将原始密钥移动并生成新密钥集的过程如下截图所示。

![使用安全外壳保护通信](img/3121OS_01_07.jpg)

要验证新生成的密钥是否唯一，请计算它们的`md5sum`哈希值，并与原始密钥进行比较，如下截图所示。

![使用安全外壳保护通信](img/3121OS_01_08.jpg)

要使用菜单启动 SSH 服务，请选择**应用程序** | **Kali Linux** | **系统服务** | **SSHD** | **SSHD 启动**。

要从命令行启动 SSH，请使用以下截图中显示的命令行：

![使用安全外壳保护通信](img/3121OS_01_09.jpg)

要验证 SSH 是否正在运行，请执行`netstat`查询，如下截图所示：

![使用安全外壳保护通信](img/3121OS_01_10.jpg)

在上一个示例中，SSH 守护程序正在端口 22 上监听。要停止 SSH，请使用以下命令：

```
/etc/init.d/ssh stop

```

# 更新 Kali Linux

必须定期修补 Kali，以确保基本操作系统和应用程序是最新的，并且已应用安全补丁。

## Debian 软件包管理系统

Debian 的软件包管理系统依赖于称为**软件包**的离散捆绑应用程序。用户可以安装或删除软件包以定制环境，并支持诸如渗透测试之类的任务。它们还可以扩展 Kali 的功能，支持通信（Skype、即时通讯和安全电子邮件）或文档（在 Wine 下运行的 OpenOffice 和 Microsoft Office）等任务。

软件包存储在存储库中，并下载到系统用户以确保软件包的完整性。

### 软件包和存储库

默认情况下，Kali 仅使用官方 Kali 存储库。可能由于安装过程不完整而未将存储库添加到正确的`sources.list`文件中，或者您可能希望在添加新应用程序时扩展可用的存储库。

可以通过命令行（`echo deb http://http.kali.org/kiali kali main contrib non-free >> /etc/apt/sources.list`）或使用文本编辑器来更新`source.list`文件。

应该存在于`/etc/apt/sources.list`中的默认软件包存储库如下所示；如果不存在，请编辑 sources.list 文件以包括它们：

```
 ## Kali deb http://http.kali.org/kali kali main contrib non-free
 ## Kali-dev deb http://http.kali.org/kali kali-dev main contrib non-free
 ## Kali Security updates deb http://security.kali.org/kali-security kali/updates maincontrib non-free

```

并非所有 Kali 工具都目前在官方工具存储库中维护。如果选择手动更新工具，则可能会覆盖现有的打包文件并破坏依赖关系。因此，一些尚未正式移至 Debian 存储库的工具，如`aircrack-ng`、`dnsrecon`、`sqlmap`、`beef-xss`和社会工程工具包（se-toolkit），都在 Bleeding Edge 存储库中维护。可以使用以下命令将此存储库添加到`sources.list`中：

```
 ## Bleeding Edge repository deb http://repo.kali.org/kali kali kali-bleeding-edge main

```

### Dpkg

Dpkg 是 Debian 的软件包管理系统。这个命令行应用程序用于安装、删除和查询软件包。一般来说，`dpkg`对单个软件包执行操作。

### 提示

`dpkg`在 Kali 中编译已安装应用程序列表时特别有用，使用命令`dpkg -l > list.txt`。如果要知道特定工具是否已安装，请使用`dpkg -l | grep <tool name>`。

以下屏幕截图显示了调用 dpkg -l 时返回数据的摘录，提供了 Kali 发行版上安装的所有应用程序的列表；这在识别可能仅可以直接从命令行访问的应用程序方面特别有用。

![Dpkg](img/3121OS_01_11.jpg)

### 使用高级打包工具

**高级打包工具**（**APT**）通过搜索存储库并安装或升级软件包以及所有所需的依赖项，扩展了`dkpg`的功能。 APT 还可以用于升级完整的发行版。

最常见的`apt`命令如下：

+   `apt-get update`：用于将本地软件包索引文件与`/etc/apt/sources.list`中定义的源重新同步。在执行`upgrade`或`dist-upgrade`之前，应始终首先使用`update`命令。

+   `apt-get upgrade`：用于安装系统上已安装的所有软件包的最新版本，使用`/etc/apt/sources.list`。在 Kali 上安装了新版本的软件包将被升级。升级命令不会更改或删除未升级的软件包，并且不会安装尚未存在的软件包。

+   `apt-get dist-upgrade`：这将升级系统上当前安装的所有软件包及其依赖项。它还会从系统中删除过时的软件包。

`apt-get`命令还可用于显示软件包的完整描述并识别其依赖项（`apt-cache show <package name>`）或删除软件包（`apt-get remove <package name>`）。

### 注意

在启动时运行`apt-get update`命令和`upgrade`命令，以确保会话使用最新的工具。最简单的方法是创建一个包含以下命令行的`update.sh`脚本：

```
apt-get update && apt-get upgrade –y && apt-get dist-upgrade –y

```

某些应用程序不会被`apt-get`命令升级。例如，`exploit-db`存档的本地副本必须手动升级。创建一个名为`update.sh`的脚本，并将以下命令添加到其中，以自动化更新过程：

```
 cd /usr/share/exploitdb
 wget http://www.exploit-db.com/archive.tar.bz2
 tar –xvjf archive.tar.bz2
 rm archive.tar.bz2

```

# 配置和自定义 Kali Linux

Kali 是一个用于完成渗透测试的框架。但是，测试人员不应该感到受限于默认安装的工具，或者受限于 Kali 桌面的外观和感觉。通过自定义 BackTrack，测试人员可以增加正在收集的客户数据的安全性，并使渗透测试变得更加容易。

对 Kali 进行的常见自定义包括：

+   重置 root 密码

+   添加非 root 用户

+   加快 Kali 操作

+   与 MS Windows 共享文件夹

+   创建加密文件夹

## 重置 root 密码

要更改用户密码，请使用以下命令：

```
passwd root

```

然后将提示输入新密码，如下图所示：

![重置 root 密码](img/3121OS_01_12.jpg)

## 添加非 root 用户

Kali 中提供的许多应用程序必须以 root 级别权限运行才能正常工作。 root 级别权限确实存在一定的风险，例如，输入错误的命令或使用错误的命令可能会导致应用程序失败，甚至损坏正在测试的系统。在某些情况下，最好使用用户级别权限进行测试。实际上，有些应用程序强制使用较低权限的帐户。

要创建非 root 用户，只需从终端使用`adduser`命令并按照出现的说明进行操作，如下图所示：

![添加非 root 用户](img/3121OS_01_13.jpg)

## 加快 Kali 操作

有几种工具可用于优化和加快 Kali 操作：

+   在使用虚拟机时，安装 VM 的软件驱动程序包：Guest Additions（VirtualBox）或 VMware Tools（VMware）。

+   在创建虚拟机时，选择固定的磁盘大小，而不是动态分配的磁盘大小。向固定磁盘添加文件更快，文件碎片更少。

+   preload 应用程序（`apt-get install preload`）识别用户最常用的程序，并预加载二进制文件和依赖项到内存中，以提供更快的访问。安装后第一次重启后会自动运行。

+   BleachBit（`apt-get install bleachbit`）通过释放缓存，删除 cookie，清除互联网历史记录，销毁临时文件，删除日志和丢弃其他不必要的文件来释放磁盘空间并提高隐私。高级功能包括销毁文件以防止恢复和擦除空闲磁盘空间以隐藏未完全删除的文件的痕迹。

+   默认情况下，Kali 不显示启动菜单中存在的所有应用程序。在启动过程中安装的每个应用程序都会减慢系统数据，并可能影响内存使用和系统性能。安装**启动管理器**（**BUM**）以禁用在启动期间启用的不必要的服务和应用程序（`apt-get install bum`），如下图所示：![加速 Kali 操作](img/3121OS_01_15.jpg)

### 注意

虚拟机使用不同的菜单标题，但流程是一样的。

1.  在 Kali 桌面上打开文件浏览器。共享文件夹将显示在`mnt`文件夹中（可能放在子文件夹`hgfs`中）。

1.  将文件夹拖到 Kali 桌面上，以创建到真实文件夹的链接。

1.  放入文件夹的所有内容将在主机操作系统上同名的文件夹中可访问，反之亦然。

共享文件夹中将包含来自渗透测试的敏感数据，必须加密以保护客户的网络，并减少测试人员的责任，如果数据丢失或被盗。

## 使用 TrueCrypt 创建加密文件夹

在渗透测试期间，您将可以访问敏感的客户信息，包括可利用的漏洞和成功突破的数据副本。测试人员的法律和道德责任是确保他所掌握的这些信息始终得到保护。满足这一责任的最佳方式是确保所有客户信息在存储和传输过程中都进行加密。

要在 BackTrack 上安装 TrueCrypt，请完成以下步骤：

1.  在**应用程序**菜单中，选择**附件** | **TrueCrypt**。

1.  要创建加密文件夹，请打开应用程序。您将看到主菜单，如下截图所示：![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_16.jpg)

1.  在主菜单中，选择**创建** **卷**按钮。这将启动**TrueCrypt 卷** **创建向导**，如下截图所示：![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_17.jpg)

1.  选择**创建加密文件容器**，然后点击**下一步**。

1.  下一个屏幕将提示**卷类型**，选择**标准 TrueCrypt 卷**，然后点击**下一步**。

1.  在**卷** **位置**屏幕上，选择**选择文件**。您将被要求通过提供**名称**并指示它将保存在指定文件夹中来**指定新的 TrueCrypt 卷**，如下截图所示：![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_18.jpg)

1.  选择一个文件名。不要选择与正在测试的客户相关的文件名，或者表明目录中存在敏感材料的文件名。使用一个数字或代码词来代表客户，以及一个通用的标题来表示结果。将文件保存在桌面上，然后点击**下一步**。

1.  下一个屏幕将为您提供**加密选项**。从下拉菜单中选择**加密算法**。有几种选择，但对于常规目的，**AES**（默认的 256 位密钥）就足够了。您还将从下拉菜单中选择**哈希算法**（默认情况下，**RIPEMD-160**应该足够）。选择完成后，点击**下一步**按钮，如下截图所示：![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_19.jpg)

1.  现在将提示您输入**卷大小**。最小大小应该约为 500 MB，但这可能会根据测试方案而有所不同。点击**下一步**。

1.  应根据强密码的规则选择**卷密码**。选择并确认密码，然后点击**下一步**，如下截图所示：![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_20.jpg)

1.  下一个屏幕允许您选择**格式选项**。对于**文件系统选项**，从下拉菜单中选择**FAT**。点击**下一步**。

1.  下一个屏幕**卷** **格式**，为加密文件系统创建一个随机密钥。密钥基于鼠标移动，并且您将被提示在窗口上移动鼠标一段时间以确保加密密钥的随机性（密码学强度）。完成后，点击**格式化**以创建 TrueCrypt 卷。

1.  最终的卷已经创建。它将显示为桌面上的图标。该卷已加密，可以复制到外部存储设备或移动到主机系统并保持加密状态。

要使用加密卷，您必须首先选择主**TrueCrypt**菜单中管理加密文件夹的**插槽**。完成后，使用**选择文件**按钮选择加密文件的名称。在这种情况下，我们将使用桌面上以前创建的名为`pentest`的文件，如下截图所示：

![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_21.jpg)

点击**挂载**按钮。此时，将提示您输入密码，如下截图所示：

![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_22.jpg)

输入正确的密码后，您将看到**Slot 1**的详细信息会发生变化，以反映加密文件夹的属性，并且在桌面上会显示一个名为`truecrypt1`的新图标，如下面的屏幕截图所示：

![使用 TrueCrypt 创建加密文件夹](img/3121OS_01_23.jpg)

如果您双击**truecrypt1**图标，您将进入**文件浏览器**视图。

在这一点上，它将作为一个常规目录，您可以使用该文件夹来存储所有与测试相关的信息。当您使用文件夹的内容，并希望确保所有数据都是加密的时候，在主菜单上选择**卸载**。文件夹将恢复到加密状态。

# 管理第三方应用程序

尽管 Kali 预装了几百个应用程序，但您可能需要安装其他应用程序来有效地测试特定环境（如工业系统），添加新的尖端工具，或确保您安装了*最喜欢*的工具。Kali 使得定位、安装和管理这些工具变得容易。

## 安装第三方应用程序

安装第三方应用程序有多种方法：使用`apt-get`命令，访问 GitHub 存储库，直接安装应用程序。

所有工具都应该使用`apt-get install`命令从 Kali Linux 存储库安装。`install`命令可以在终端窗口的命令行中执行，或者用户可以选择一个图形化的软件包管理工具。

推荐的第三方应用程序包括：

+   `apt-file`：这是一个命令行工具，用于在 APT 包装系统的软件包中搜索。它允许您列出软件包的内容，而无需安装或获取它。

+   `gnome-tweak-tool`：这允许用户更改主题并快速配置桌面选项。

+   `instanbul`：这是一个桌面屏幕录制工具，允许您制作桌面活动的电影。

+   `openoffice`：这是一个开源的办公生产力套件，用于文档编制。

+   `scrub`：这是一个安全删除（反取证）工具，可以使用各种覆盖模式安全删除数据，以符合严格的政府标准。

+   `shutter`：这是一个截图工具，可以捕捉桌面、打开窗口或选择的图像。

+   `team viewer`：这支持远程访问和远程管理。它还允许测试人员将预先配置的计算机（一个 dropbox）放在目标网络上，并从远程位置控制测试。

+   `terminator`：这是 Linux 终端窗口的替代品，允许水平滚动 - 不再有换行文本！

不在 Debian 存储库中的工具，可以通过`apt-get install`访问，仍然可以安装在 Kali 上。但是，用户必须接受手动安装与存储库不协调，并且可能会破坏依赖关系，导致应用程序失败。

一些工具使用 GitHub 在线存储库进行软件开发项目。许多开发人员青睐这个开放存储库，因为 Git 修订系统的灵活性以及软件站点的社交媒体方面。我们将使用的一个工具是`recon-ng`，一个网络侦察框架。

要从 GitHub 存储库克隆当前版本的`recon-ng`，请使用以下命令行：

```
cd /opt; git clone https://LaNMaSteR53@bitbucket.org/LaNMaSteR53/recon-ng.git
cd opt/recon-ng
./recon-ng.py

```

最后，一些应用程序必须手动安装。例如，要恢复异步端口扫描程序 Unicornscan，可以返回到 Kali，您必须：

+   确保首先存在依赖项：`apt-get install flex`

+   下载 Unicornscan 的最新版本（[www.unicornscan.org](http://www.unicornscan.org) - 当前版本是 unicornscan-0.4.7-2）

+   将文件内容提取到一个新目录：`tar jxf unicornscan-0.4.7-2.tar.bz2`

+   切换到包含 Unicornscan 的目录：`cd unicornscan-0.4.7/`

+   编译源代码：`./configure CFLAGS=-D_GNU_SOURCE && make && make install`

确切的依赖关系和安装过程将因应用程序而异，因此您需要参考开发者的`README`文件，以确保正确安装和配置这些应用程序。

## 以非 root 权限运行第三方应用程序

Kali Linux 旨在支持渗透测试。大多数工具需要 root 级别访问权限，这就是为什么工具集和数据的访问受到密码和加密保护的原因。

然而，一些第三方工具并不意味着以 root 级别权限运行。诸如 web 浏览器之类的工具可能会受到损害，并且给攻击者访问 root 权限可能会产生重大的安全影响。

如果不需要 root 访问权限，工具应该遵循最小特权原则，并作为非 root 用户运行。

要运行通常作为非 root 用户运行的应用程序，请使用 root 帐户登录 Kali。Kali 应该配置为使用非 root 帐户。在本例中，我们将使用之前使用`adduser`命令创建的`noroot`帐户。

运行 web 浏览器 Iceweasel 作为非 root 用户执行以下步骤：

1.  创建一个非 root 用户帐户。在本例中，我们将使用`noroot`。

1.  我们将使用`sux`，这是一个包装应用程序，它将凭据从特权用户传输到目标非 root 用户。使用`apt-get install`命令下载和安装`sux`。

1.  启动 web 浏览器，然后将其最小化。

1.  输入命令行：`ps aux |grep iceweasel`。如您所见，Iceweasel 正在以 root 权限运行。

1.  关闭 Iceweasel，并使用命令`sux - noroot iceweasel`重新启动，如下面的屏幕截图所示：![以非 root 权限运行第三方应用程序](img/3121OS_01_24.jpg)

如果您检查 Iceweasel 标题栏，如下面的屏幕截图所示，您将看到它被调用为用户`noroot`，这是一个没有管理员特权的帐户。

![以非 root 权限运行第三方应用程序](img/3121OS_01_25.jpg)

您还可以通过检查打开的进程来确认 Iceweasel 是否在`noroot`帐户下运行，如下面的屏幕截图所示：

![以非 root 权限运行第三方应用程序](img/3121OS_01_26.jpg)

# 渗透测试的有效管理

渗透测试中最困难的部分之一是记住测试网络或系统目标的所有相关部分，或者在测试完成后尝试记住目标是否实际上已经被测试过。

BT 5r3 强调使用管理工具，如 Draedis 和 MagicTree。这些工具通过提供测试数据的中央存储库来促进组测试。此外，它们通常提供一些框架，以便测试人员知道他们在测试方法论中的位置，以及还有哪些测试尚未完成。这类工具在协调漏洞评估或渗透测试期间定义的组活动方面非常出色。

这些工具保留在**应用程序** | **Kali Linux** | **报告工具** | **证据管理**菜单中。

但是对于复杂的渗透测试，方法可能更加灵活，因为它适应网络目标呢？

一些测试人员在测试期间使用键盘记录器或 Wireshark 来记录测试期间生成的按键和数据包流量。如果测试导致网络或应用程序中断，这些数据可能特别有用，因为重放和分析发送的数据包可以确定哪些数据包工具影响了网络。

Kali Linux 包括几个工具，更适合快速记录笔记并作为快速添加剪切和粘贴数据的存储库，包括 KeepNote 和 Zim 桌面 wiki。

测试人员不仅需要执行测试和收集数据，还需要能够向客户提供他们的发现。这可能很困难，因为一些结果是瞬时的——测试在某个时间点显示了一个发现，然后目标系统上的某些内容发生了变化，未来的测试未能显示可利用的漏洞，尽管它可能会重新出现。

积极结果的另一个挑战是需要以客户能理解的方式展示给客户。

黄金法则是始终抓取任何积极或潜在发现的屏幕截图。使用 Shutter 等工具从桌面捕获图像。

默认情况下，Kali 配置了**CutyCapt**，这是一个跨平台命令行实用程序，可以捕获网页并创建各种图像类型，包括 PDF、PS、PNG、JPEG、TIFF、GIF 和 BMP。

例如，要从 Google 搜索页面创建特定大小的图像，请在命令行提示符中输入以下内容：

```
..cutycapt --url=http://www.google.com --out=google.png --min-width=300 --min-heightheight=250.

```

在执行时，将显示在上一个命令中指定大小的图像，如下面的屏幕截图所示：

![有效的渗透测试管理](img/3121OS_01_27.jpg)

CutyCapt 在演示基于 Web 的漏洞（如跨站脚本）存在时特别有用。

静态图像可能非常有用，但是一个利用漏洞的视频，显示攻击者在攻击目标网络并显示他们获取敏感数据的行为，是一个非常有说服力的工具。instanbul 屏幕录像机创建了一个“正在进行的利用”视频，允许对利用进行重放以进行培训，或向客户展示漏洞。

# 总结

在本章中，我们研究了 Kali，这是一个被合法的渗透测试人员和黑客广泛使用来评估数据系统和网络安全性的工具集。我们强调 Kali 是一个虚拟机，允许主机操作系统和 VM 客户端都支持测试。

Kali 是一个工具库，使用它的一个挑战是确保工具是最新的。我们审查了 Debian 数据包管理系统，以及如何从命令行和 GUI 应用程序启动更新。最重要的是，我们学会了如何定制 Kali 以增加我们工具和它们收集的数据的安全性。我们正在努力实现使工具支持我们的流程的目标，而不是相反！

在下一章中，我们将学习如何有效地使用**开源情报**（**OSINT**）来识别我们目标的易受攻击的表面，并创建定制的用户名:密码列表，以便进行社会工程攻击和其他利用。

