# 第二章：攻击访问控制

在本章中，我们将涵盖以下内容：

+   处理战争驾驶

+   映射接入点并提高准确性

+   创建伪装接入点

+   通过 MAC 欺骗规避 MAC 过滤

+   识别淫秽客户端

# 介绍

在处理无线网络时，可能使用的攻击类型之一是访问控制攻击。属于这一类别的攻击旨在通过规避访问控制措施来渗透和破坏无线网络。这些类型的访问控制措施包括 MAC 过滤、错误配置、伪装接入点以及本章中将讨论的其他项目。

在我们深入研究访问控制之前，让我们更详细地了解一下，以更清楚地理解我们在本章中攻击的是什么。

访问控制过程涉及辨识和授权。任何针对访问控制的攻击都会试图窃取凭据，或者冒充用户或系统，以获取访问权限并执行未经授权或明显恶意的活动。正因为访问控制是攻击的常见目标，组织必须实施强大和适当的控制。

在无线网络上，访问控制可以采用多种不同形式，每种形式可以独立使用，也可以一起部署以形成更强大的解决方案。无线网络中使用的访问控制机制的一些示例包括：

+   **MAC 过滤**：这是一个过程，其中 MAC 地址被输入到接入点中，目的是允许或禁止持有这些 MAC 地址的设备访问。

+   **隐藏 SSID**：这种技术是由网络管理员使用的，用于阻止网络标识符在公开环境中的广播。

+   **接入点位置**：网络所有者可以选择将他们的接入点放置在建筑物内的特定地理区域，以限制广播的范围。这限制了恶意方或攻击方获取访问权限的信号量。

这只是一个潜在的措施清单，可以用于访问控制，以限制无线网络仅授权用户的可访问性。

一旦访问控制被破坏或颠覆，攻击者可以继续深入到目标网络中。攻击者可能通过利用无线网络或连接到无线网络的设备中存在的缺陷或错误配置，或者甚至是被忽视或低估的选项来规避访问控制。

# 访问控制攻击类型

访问控制攻击有多种形式，其中并非所有形式都能在本书的页面中涵盖。但是，我们可以涵盖这种类型攻击中许多更常见的形式。在我们开始探索每一种攻击之前，让我们首先列出本章将涵盖的攻击：

+   战争驾驶

+   伪装接入点

+   MAC 欺骗

+   临时关联

+   AP 错误配置

+   客户端错误关联

+   未经授权的关联

+   淫秽客户端

请记住，这只是可以用来针对无线网络上的访问控制的攻击类型中的一些，它们不应被视为唯一的访问控制攻击类型。

# 处理战争驾驶

用于针对访问控制的最早和最常用的攻击形式之一是一种称为战争驾驶的技术。简而言之，这种技术是使用无线设备以及专门用于检测或探测到达无线设备范围内的无线网络的软件。

战车如此受欢迎和有效的原因在于，许多计算机用户，无论是个人还是企业，多年来一直在部署`802.11`无线接入点，却很少考虑安全性。允许用户漫游的无线网络的部署已经超过了采取措施来保护他们的接入点和设备免受潜在攻击的重要性。

对于部署了配置错误或不安全的无线网络，我们有一类攻击者参与这种被称为战车的做法。参与这种活动的人会建造定制的设备，由硬件和软件组合而成，目的是在公共场所巡游，寻找无线接入点和设备。这些人可能只是对定位和针对特定网络感兴趣，或者在某些情况下，他们甚至可能会将这些信息分享到在线数据库或网站，让任何访问者都可以搜索这些接入点。

在实践中，个人使用这种攻击方法是通过在探索目标区域之前启用他们的无线设备和软件。当攻击者选择探索目标区域时，他们可以使用自行车、汽车、摩托车、步行，甚至使用新的方法，如无线无人机。无论使用哪种方法，只要攻击方对探索目标区域采取合理的系统方法，他们就会发现许多无线设备和/或网络。一旦他们找到这些无线网络，他们就可以浏览他们收集到的信息，并确定要专注和渗透的无线目标。

在 Kali Linux 中，我们有许多工具可以轻松促进战车的实践。在发行版中，每一个对战车有用的工具都有其自己的一套功能，这些功能可能存在于其他工具中，也可能不存在。在本书中，我们将专注于使用一种更受欢迎的工具来进行战车，这种工具被称为 Kismet。

战车不仅有一种形式，还有其他属于这个术语的子类型。具体来说：

+   **战飞**：与战车相同，但使用小型飞机或超轻型飞机

+   **战气球**：与战飞相同，但使用气球

+   **战步行**：这涉及将检测设备放在背包或类似物品中，穿过建筑物和其他设施

# 准备工作

要开始操作，您需要准备以下物品：

+   一个能够进入监视模式的无线网卡

+   Kali Linux 安装了 Kismet（默认 Kali 安装的一部分）

这里列出的物品是基本要求，如果需要，您可以轻松地使用更多（或不同的）组件。例如，如果您想要增强范围，您可以使用一个带有外部天线连接的 USB 无线网卡，以获得更好的接收效果。您也可以使用不同的无线应用程序来完成这项任务；但是，由于 Kismet 非常受欢迎，我们将在本文中使用它。

# 如何做到这一点...

Kismet 是一个有效的工具，用于定位和提取无线接入点和设备的有用信息。

在命令行上启动 Kismet 之前，需要注意一点：如果您使用外部 Wi-Fi 适配器，您应该在发出命令之前安装和配置它。默认情况下，Kismet 应该配置为使用物理系统上存在的无线适配器；但是，如果您选择使用外部适配器，您可能需要执行额外的配置，以便让您的适配器被 Kismet 识别。

在本教程中，我们将通过从命令提示符启动 Kismet 来启动 Kismet，但也可以通过应用程序菜单中的*无线攻击*部分启动它。在任何一种情况下，启动 Kismet 都将导致在此处记录的相同步骤：

1.  打开终端窗口。

1.  在命令提示符处，输入命令`kismet`。

1.  现在，您将从半图形环境中配置 Kismet。您将使用* Tab *和* Enter *键进行导航。

1.  如果您看不到灰色字母行，请使用* Tab *键突出显示`否`。否则，保持`是`突出显示。

1.  按一次* Enter *键。

1.  按一次* Enter *键以确认 Kismet 正在以 root 身份运行。

1.  按一次* Enter *键自动启动 Kismet 服务器。

1.  按一次* Enter *键以验证您要启动 Kismet 服务器。

1.  按一次* Enter *键以验证您可以`添加`捕获源：

1.  根据使用`ifconfig`发现的无线接口的名称进行输入。如果您记不得，可以打开另一个控制台窗口，并再次运行`ifconfig`命令以确定正确的接口（通常以`wlan`开头的名称）。以下屏幕截图显示了接口输入屏幕：

![](img/54c728c8-b6f7-4881-98fb-29a28c861e2a.png)

Kismet 界面配置

以下是要遵循的 Kismet 界面配置步骤

1.  1.  按一次* Tab *键。

1.  在名称字段中输入无线接口的名称。

1.  按一次* Tab *键。

1.  再次按* Tab *键。

1.  按一次* Enter *键。

1.  如果您输入名称正确，Kismet 应该能够识别命名的无线接口。它还将生成不需要的虚拟接口的名称，例如`wlan0mon`、`wlan0monmon`和`wmaster0`。

1.  当在 shell（Kismet 窗口）的右下角显示`关闭控制台窗口`时，按一次键盘的* Tab *键以突出显示`关闭控制台窗口`。

1.  按一次* Enter *键。

1.  无线接入点的列表将显示在 shell（Kismet 窗口）的左上方。

1.  单击下拉菜单中的`查看`。

1.  单击监视活动。

一旦您到达这一点，您会注意到设备将开始填充窗口。您将看到与每个设备相关的名称、信道、无线标准和其他信息。如果您等待足够长的时间，您会注意到会出现其他设备，并且列出的其他项目可能会有更多的信息填充，这些信息以前可能不存在。

在查看 Kismet 窗口中显示的网络列表时，可能会看到一些看起来有些不同的条目。例如，请查看以下屏幕截图：

![](img/90d061fe-c76f-4517-ba5f-77b626df25ab.png)

主 Kismet 窗口显示检测到的无线客户端。

如果您查看窗口中的项目，您会注意到有一个`探测网络`的条目。您可以移动到列表中的此项目上，并使用* + *或* - *来打开或关闭选择。您会注意到，当您展开项目时，您会看到会显示一系列项目。此列表记录了来自附近系统的探测请求。这些探测是由无线启用的系统发送的，该系统试图连接到它过去连接过的网络。仔细分析出现在探测请求下的网络名称可以揭示系统连接到的不同接入点的名称，并让您了解系统可能是如何或在哪里使用的。请记住，只要设备未与无线网络关联，许多操作系统都会发送这些探测请求。

还有其他软件包可以用来执行 Kismet 正在执行的相同操作；但是，Kismet 具有高度可定制和被动的优势。被动意味着软件不会向周围的无线接入点发送任何信息，而是监听与接入点相关的连接和流量，以揭示其存在并确定其名称。此外，该软件包还具有检测隐藏接入点的能力，而其他类似的软件包可能无法做到这一点。

# 映射接入点并提高准确性

战车驾驶的下一步是增强您收集的数据，包括有关接入点或设备本身的位置或地理数据。在现代，通过使用全球定位系统（GPS）技术来收集这些数据已经变得非常容易。现代 GPS 设备可以连接到笔记本电脑或笔记本电脑等系统，使用蓝牙、USB 甚至在某些情况下使用串行连接。如果您打算使用平板电脑或智能手机等移动设备进行战车驾驶，那么您的设备很可能已经包含了内置的 GPS，可以用来映射接入点。

如果您要使用外部 GPS 设备，重要的是要注意并非所有这些设备都是平等的。一些设备能够在开机后很短的时间内获取卫星定位和位置，而其他设备可能需要长达两分钟甚至更长的时间才能在冷启动后获取卫星定位。影响 GPS 数据质量和准确性的另一个因素是 GPS 设备更新其位置的频率；一些设备可能更频繁地更新其坐标，而其他设备可能更新得不那么频繁，可能会影响坐标的准确性。

实际上，所有 GPS 设备都可以用于进行战车驾驶。唯一的要求是这些 GPS 设备能够向请求系统或软件提供当前和相当准确的 GPS 数据。

# 准备工作

要开始工作，您需要准备以下物品：

+   能够进入监视模式的无线网卡

+   已安装 Kismet 的 Kali Linux（默认 Kali 安装的一部分）

+   蓝牙或 USB GPS 设备

这里列出的项目是基本要求，如果需要，您可以轻松地使用更多（或不同）的组件。例如，如果您想要增强范围，可以使用一个带有外部天线连接的基于 USB 的无线网卡，这样可以获得更好的接收。您也可以使用不同的无线应用程序来完成此任务，而不是 Kismet；但是，由于 Kismet 非常受欢迎，我们将在本教程中使用它。

# 操作步骤...

为了让 Kismet 访问 GPS 数据，我们需要先进行一些设置。这是通过使用 GPSD 来完成的。GPSD 实用程序用于从 GPS 返回信息，然后我们将在 Kismet 中使用这些信息：

![](img/69cc3c81-d607-40ed-ad22-032e7a5ba254.jpg)

能够与 Kismet 一起使用的 USB GPS 设备

1.  首先，要使用`gpsd`，您很可能需要安装它，因为它通常不作为 Kali 的安装过程的一部分。为了安装这个服务，我们只需使用以下命令：

```
        apt-get install gpsd

```

1.  然后，我们需要安装第二个称为`gpsd-clients`的软件包，以帮助检索 GPS 数据的过程。我们通过发出以下命令来安装这个软件包：

```
        apt-get install gpsd-clients

```

1.  安装完成后，现在应该连接您的 GPS 硬件。我们可以通过发出以下命令来验证 GPS dongle 是否存在：

```
        lsusb

```

1.  然后，验证您的无线适配器是否存在，并获取接口名称：

```
    ifconfig

```

1.  接下来，确保您的 GPS 适配器显示在`/dev/`目录中。要做到这一点，使用以下命令：

```
        ls /dev/gps*

```

上述命令显示在以下屏幕截图中：

![](img/0f834315-3d02-403b-971b-7d43eb55a754.png)

列出 GPS 设备的结果

1.  这也应该帮助你识别名称。一旦你在`/dev/`中确定了路径，将其作为参数传递给`gpsd`：

```
    gpsd /dev/gps[x]

```

1.  一旦你确定了`gps`的名称并成功地将其传递给`gpsd`进程，现在是时候转到 Kismet，看看它是否检测到 GPS。为此，你将像之前一样启动 Kismet。

1.  进入 Kismet 后，使用反引号/重音符号按钮（`` ` ``）来访问顶部的 Kismet 菜单。向右滚动至Windows 菜单，然后选择 GPS Details：

![](img/cb99f363-0ff7-44f8-86f6-9d316895561a.png)

GPS 详细信息窗口

1.  假设您的 GPS 信号良好，您应该会看到一个窗口，显示类似于以下屏幕截图的内容：

![](img/4461db74-2491-44d8-98bf-114da2d43ea0.png)

在 Kismet 中接收到 GPS 信号。

请记住，如果您没有从多个卫星接收信号，则将无法获得可靠的位置信息。如果您无法从多个卫星接收到良好的信号，则应尝试移动到不同的位置，并等待几分钟，以查看是否可以重新获取信号。

1.  我们的下一步是将 Kismet 会话期间创建的 `.netxml` 文件转换为 `csv` 格式。为此，我们将使用一个名为 `giskismet` 的应用程序，该应用程序将允许我们将 `netxml` 转换为我们预期的 `csv` 格式。在我们做任何事情之前，我们需要安装 `giskismet`；为此，我们执行以下步骤：

1\. `apt-get update`。

2\. `apt-get install giskismet`。

3\. 按下 *Enter*。

```

giskismet ­-x Kismet-DATE.netxml ­-q "select *

from  wireless" ­-o wardrive.kml

```

一旦您将 Kismet 配置为使用 GPS 确定无线访问点和客户端的位置，您还可以使用它来检测不受您控制但连接到您的网络的流氓访问点。为此，您需要知道已批准连接到您网络的访问点，然后使用 Kismet 对该区域进行调查，并找到那些您不认识但可能连接到您网络的访问点。

通过从原始数据创建的 KML 文件，我们现在可以做真正酷的部分，并将这些数据导入到 Google Earth 中：

1.  使用浏览器打开 Google Earth。

1.  在左侧，点击我的地点。

1.  点击导入 KML 文件。

1.  选择要上传的文件的位置。

1.  选择并打开 KML 文件。Google Earth 中将打开列表的预览。

1.  要将这些地点保存在您的列表中，请点击保存。

1.  位置将保存到我的地点。

1.  以下屏幕截图显示了在 Google Earth 中显示的来自 KML 文件的信息。

![](img/dc045f01-062b-409f-afec-37b9ed6fbc9e.jpg)

将 KML 数据合并到 Google Earth 中。

# 创建流氓访问点

在无线网络上妥协或规避访问控制的另一种有效方法是创建所谓的流氓访问点。流氓访问点简单地说就是在网络上安装了一个无线访问点，而没有得到网络所有者或管理员的明确许可或授权。在实践中，一个流氓访问点可以由一个出于善意的员工，甚至是一个不满的员工或入侵者来放置。

访问点可以是软访问点或某种形式的硬访问点中的一种。

软件访问点是通过软件创建的访问点，例如我们在 Kali 中拥有的类型以及其他第三方应用程序。甚至可以说，智能手机上的软件通过 Wi-Fi 连接共享手机的互联网访问，从而将智能手机本身变成了软访问点。

硬件访问点更为直接，因为它采取的是可以在计算机店或大型零售商店购买的硬件设备形式。事实上，当人们想要设置自己的无线网络时，大多数人会想到的就是这种访问点类型。这些访问点来自许多不同的供应商，但它们通常提供类似的功能，并由每个单独供应商添加各种增强功能。

# 准备工作

要开始工作，你需要先准备好以下物品：

+   一个能够进入监听模式的无线网卡

+   安装了 Kismet 的 Kali Linux（默认 Kali 安装的一部分）

这里列出的项目是基本要求，如果需要，你可以很容易地使用更多（或不同）的组件。例如，如果你想要增强范围，可以使用带有外部天线连接的 USB 无线网卡，这样可以获得更好的接收效果。

# 如何做...

为了配置一个恶意访问点，我们需要执行几个步骤。所有这些步骤的目标是配置系统上的无线适配器模仿访问点，并使用第二个适配器（最好是有线的）连接到互联网。最终结果是适配器模仿访问点拦截的流量将指向有线适配器和互联网，并通过无线适配器将响应发送回请求客户端。

首先，让我们配置一个适配器连接到互联网：

1.  打开一个终端窗口，并运行`ifconfig`命令，如第一章*Kali Linux 和无线网络*中所述。

1.  确定你希望用来连接到互联网的有线或无线适配器以及你将用作访问点的适配器。

1.  注意适配器名称（通常`wlan`表示无线，`eth`表示有线）以备参考，并跟踪哪个适配器是哪个。你需要确定哪个适配器将连接到互联网，哪个将成为访问点。

1.  你可以使用 Kali GUI 将一个适配器连接到互联网（在这个例子中，我们将这个适配器命名为`eth0`）。

我们进程的下一部分是启动无线适配器并配置为访问点的网关。我们可以通过以下步骤完成这一点。在这个例子中，我们假设接口名称为`wlan0`：

1.  使用`ifconfig`命令配置`wlan0`的网关，执行以下命令（在这个例子中，我们将网关设置为`10.0.0.1/24`，但它可以设置为任何有效的网关，只要它不与现有地址范围或网关发生冲突）：

```

Ifconfig wlan0 10.0.0.1/24 up

```

1.  一旦我们将`wlan0`配置为我们的网关，我们现在想要配置 DHCP 和 DNS 来分配 IP 地址并为我们的客户端执行名称解析。通过配置我们的伪造接入点来为请求的客户端分配 IP 地址，现在可以为他们提供网关和 DNS 服务器的地址。当我们希望执行中间人和嗅探攻击时，DNS 部分变得非常重要，因为它允许我们拦截名称查询并根据我们的需要重定向它们。

1.  我们在这个过程中的步骤是配置和执行`dnsmasq`。这个实用程序将允许我们执行 DHCP 和 DNS 的两个角色。

1.  我们首先创建一个名为`dnsmasq.conf`的文件，它告诉`dnsmasq`应用程序如何工作。要做到这一点，您需要打开一个文本编辑器，如`gedit`或任何创建简单文本文件的工具。在这个文件中，您将输入如下信息：

```

interface=wlan0

dhcp-range=10.0.0.10,10.0.0.250,12h

dhcp-option=3,10.0.0.1

dhcp-option=6,10.0.0.1

server=8.8.8.8

```

1.  完成后，将此信息保存到名为`dnsmasq.conf`的文件中。

您刚刚创建的此文件的作用如下：

+   **Interface**：这指定要监听请求并分配地址的接口。

+   **Dhcp-range**：这提供了`dhcp`范围以及租赁 IP 地址的小时数。

+   **Dhcp-option**：这些是`dhcp`服务器。

+   **Server**：这是您将要转发查询的 DNS 服务器的地址。请记住，只要有此文件存在，我们正在配置的访问点将转发所有请求到`8.8.8.8`进行解析（在本例中，该地址指向谷歌的一个免费 DNS 服务器）。如果我们不做任何其他操作，这个系统将只像任何其他访问点一样工作，不会有任何特殊的行为。

如果我们希望拦截请求，我们需要创建一个额外的文件，称为`fakehosts.conf`，它允许我们告诉`dnsmasq`我们想要拦截哪些查询：

1.  我们首先创建一个名为`fakehosts.conf`的文件，它告诉`dnsmasq`应用程序哪些请求将被拦截。

1.  要做到这一点，您需要打开一个文本编辑器，如 gedit 或任何创建简单文本文件的工具，就像我们之前做的那样。在这个文件中，您将输入如下信息：

```

10.0.0.9 usatoday.com

10.0.0.9 zelda.com

将此文件保存为 fakehosts.conf

```

1.  这将导致`dnsmasq` DNS 服务器对这两个地址的任何请求都响应`10.0.0.9`。在实际的攻击场景中，我们将放入我们控制的服务器的 IP 地址，这样当受害者访问它时，他们将提供信息或被恶意软件感染，或者我们希望的其他内容。

1.  我们需要启动`dnsmasq`，如下所示：

```

dnsmasq -C dnsmasq.conf -H fakehosts.conf

```

1.  这告诉`dnsmasq`使用`dnsmasq.conf`（`-C`）进行配置，并在`fakehosts.conf`中引用关于伪造主机的信息。

1.  配置和成功启动`dnsmasq`（意味着没有返回错误）之后，我们现在可以启动接入点本身。这意味着我们将启动一个服务，使我们的无线适配器能够将自己宣传为一个愿意连接的任何人的接入点。为此，我们需要运行一个名为`hostapd`的程序。

1.  为了运行`hostapd`，我们首先需要安装它；这可以通过运行以下命令完成：

```

apt-get install hostapd

```

1.  接下来，与`dnsmasq`类似，我们需要创建一个`conf`文件，告诉`hostapd.conf`如何运行；我们通过执行以下步骤来完成这些操作：

    1.  打开文本编辑器。

    1.  在文件中输入以下内容：

```

interface=wlan0

driver=nl80211

ssid=freewifi

channel=1

```

1.  1.  将文件保存为`hostapd.conf`。

    1.  此文件为我们提供了重要的配置信息；以下是每行提供的含义：

        +   **接口**：这是要侦听的接口名称。

        +   **驱动程序**：这是要使用的驱动程序的名称。在这种情况下，我使用了`nl80211`，它适用于广泛范围的无线适配器，但如果这个驱动程序对您的设备不起作用，您可能需要研究适用于您设备的驱动程序。

        +   **Ssid**：这将是要广告的网络的名称。

        +   **频道**：这是用于广播无线信号的频道。此值可以设置为您无线环境中的任何值频道。

1.  接下来，我们需要启动接入点；我们通过执行以下命令来完成此操作：

```

hostapd ./hostapd.conf

```

1.  这将启动接入点。可能会看到关于更新失败的错误消息，但这是正常的，并且通常没有什么不良影响。

1.  接下来，我们需要进行一些路由，将来自`wlan0`到`eth0`的流量转发，基本上创建一个非常简单的 NAT 设置。为此，请发出以下命令：

```

sysctl -w net.ipv4.ip_forward=1

iptables -P FORWARD ACCEPT

iptables --table nat -A POSTROUTING -o

wlan0 -j MASQUERADE

```

此时，您现在应该可以连接到免费的 Wi-Fi，获取 IP 地址，并开始使用互联网。

一旦您运行了恶意接入点，您有很多选项可以利用它给那些连接到它的人带来烦恼。例如，在接入点上运行像 Wireshark 这样的数据包嗅探器，将允许您捕获通过接入点移动的流量。这意味着连接到接入点的受害者可能会暴露重要数据，例如登录凭据，如果它们没有受到其他保护。

# 通过 MAC 欺骗规避 MAC 过滤

在您的探索过程中，可能会采用一种技术对抗您，以阻止您的一种技术被称为 MAC 过滤。简而言之，MAC 过滤是一种反制措施，涉及列入白名单批准接入您网络的设备的 MAC 地址，或列入黑名单您不想在网络上使用的设备。虽然这种技术极为罕见，并且通常只出现在最小的网络中，但作为一种经常被推荐的安全机制，它仍经常出现。在这里，我们将探讨如何规避 MAC 过滤并无论如何访问网络。

在大多数消费者和商用级接入点中，很容易找到 MAC 过滤选项。通常，这个选项被称为 MAC 过滤，或者可能在访问控制的一组设置中，甚至可能在一些接入点中被标记为已批准或已阻止的设备。不管它叫什么名字，它的功能都是相同的，即无线网络的管理员将选择收集他们控制的无线设备的所有 MAC 地址，并手动输入到接入点中，从而将它们列入白名单。另一方面，管理员还可以选择使用黑名单，他们将检测到连接到无线网络的或正试图连接到无线网络的恶意设备，并手动输入它们的 MAC 地址进行阻止。在任何一种情况下，这个过程可能会相当乏味和耗时，随着网络规模的增加以及对无线网络进行的更多更改，情况将变得更加如此。

正如你从本节的名称中可能猜到的那样，有一种方法可以逃避 MAC 过滤，那就是通过一种非常简单而有效的技术，即 MAC 欺骗：

![](img/94bc6ac6-eb5e-416f-b3c2-c3fe13422aa4.jpg)

无线路由器上的 MAC 过滤选项

MAC 地址欺骗是一种改变网络适配器所报告的 MAC 地址的技术。作为简单回顾，您应该记得 MAC 地址，有时称为物理地址，是分配给每个网络适配器的十六进制值，该值在制造时被分配。部分原因是设计，部分原因是行业标准，这些地址被设计为唯一的，所以没有两个网络适配器应该具有相同的 MAC 地址。正是因为这个原因，MAC 过滤能够起到作用。然而，通过使用 MAC 地址欺骗，我们可以更改报告的地址，从而放入我们想要从网络适配器中报告的任何地址。在实践中，这意味着通过将我们的 MAC 地址更改为我们选择的地址，我们可以通过更改我们的 MAC 地址来逃避黑名单，或者我们可以使用一个已批准设备的 MAC 地址来规避白名单。

那么，让我们看看如何做到这一点。

# 准备工作

要开始操作，你需要准备以下物品：

+   一张能够进入监控模式的无线网卡

+   Kali Linux

+   `airmon-ng`

+   `airodump-ng`

+   MAC 地址更改器

列出的物品是基本要求，如果需要，您还可以轻松使用更多（或不同的）组件。例如，如果您想要增加信号范围，可以使用一个具有外部天线连接的基于 USB 的无线网卡，该无线网卡可以获得更好的接收。在本篇文章中，我们还将使用 aircrack-ng 套件的两个组件（我们将在本书中更多地了解到）来识别客户端及其 MAC 地址以进行攻击。

# 如何实现...

接下来是执行攻击的步骤：

1.  执行这种类型攻击的第一步是将您的 Wi-Fi 适配器切换到监视模式，以便我们可以检测到我们需要的流量和它们的关联 MAC 地址的信息。为此，我们运行以下命令：

```

airmon-ng start wlan0

```

1.  在这种情况下，命令序列告诉 Kali 在 `wlan0` 接口上启动 `airmon-ng` 进程。这个应用程序将启动监控模式的接口，这非常重要。基本上，Wi-Fi 中的监控模式允许网卡观察所有无线流量，而无需先关联到任何接入点。

1.  完成后，我们现在希望查看特定接入点的所有连接的客户端。为此，我们简单地使用以下命令序列：

```

airodump-ng -i wlan0mon

```

请注意，我们正在使用的接口的名称是 `**wlan0mon**` 而不是 `**wlan0**`。这是因为当我们执行 `**airmon-ng**` 时，它将网卡切换到监视模式，同时添加了一个新接口 `**wlan0mon**`。您可以通过简单运行 `**ifconfig**` 命令查看这些接口名称。

1.  `airodump-ng` 现在在终端底部显示了所有连接的客户端的列表。第二列列出了连接客户端的 MAC 地址，我们将伪造这些地址以在无线网络上进行身份验证。当然，我们对某些特定内容感兴趣。看一下 `airdump-ng` 运行中的以下图形：

![](img/822534c0-4601-4cef-b42a-f506b254ef40.png)

airodump-ng 正在运行。

1.  注意接口底部的最后三行。当我们仔细观察时，我们会看到这三行中的第一行显示的是一个未关联到任何接入点的客户端，而接下来的两个条目显示已关联的客户端。要确定一个站点关联的接入点，我们只需要查看条目的第一列，并将底部三行的一个接入点的 MAC 地址与顶部的一个接入点的 MAC 地址匹配。我们甚至可以通过查看与 MAC 对应的网络名称来确定该名称。并不太糟糕。

请注意，您可能会看到多个客户端连接到任何一个接入点，这是完全正常的。只需确保在选择连接到接入点的站点的 MAC 地址时，正确选择了接入点和站点的 MAC 地址，这样您就不必多次重新运行 `airodump`。

1.  一旦我们选择了一个网络，并注意到了与之关联的站点的 MAC 地址，我们现在想要在我们希望连接到目标的系统上伪装该地址。做到这一点相当简单。

1.  首先，我们关闭 `wlan0mon` 接口，以便在下一步中使用无线网卡。为此，我们运行以下命令：

```

Airmon-ng stop wlan0mon

```

1.  现在我们需要关闭我们希望更改 MAC 地址的无线接口。为此，我们运行以下命令：

```

ifconfig wlan0 down

```

1.  现在我们可以使用实用程序`macchanger`来修改 MAC 地址为之前注意到的那个。为此，请执行以下命令：

```

macchanger -m [New MAC Address] wlan0

```

1.  一旦命令成功完成，我们可以使用`ifconfig`将接口重新启动：

```

ifconfig wlan0 up

```

1.  现在我们已经将适配器的 MAC 地址更改为新的 MAC 地址，我们可以尝试与网络进行身份验证，看看我们是否能够连接。如果我们能够选择网络并成功连接，那么我们就做对了。如果没有，请再次检查你伪造的 MAC 地址与你从`airodump`中收集的 MAC 地址是否一致。另外，如果网络正在运行诸如 WEP 或 WPA 之类的保护措施，你将无法连接。不过，别担心；如果你遇到困难，我们将在本书的后面解决这个问题。

# 识别混杂客户端

在一个安全（或被认为是安全的）网络上放置了一个恶意接入点，现在就有可能发生大量的损害和其他恶作剧。混杂客户端是一个问题，因为这些客户端会发送探测请求，寻找它们可能过去连接过的无线网络。它们参与这个过程的事实使得它们可能会意外地连接到一个网络，并且对安全构成问题。

探测数据包是一种特殊类型的请求，用于连接先前关联的网络接入点。这些数据包由智能手机、笔记本电脑和其他当前未连接到 Wi-Fi 网络的设备发送，用于定位和连接先前关联的网络。当这个探测数据包被发送出去并且客户端先前关联的网络被识别出来时，它们将尝试重新关联，就像它们以前做过的那样。

除了其他配置和技术信息外，大多数设备每 40 到 60 秒发送一次这个请求，这使得使用这些请求来跟踪人员的移动特别有用。我应该指出的是，这些数据包中没有嵌入位置信息。我们只知道如果我们从某个设备接收到了探测请求，它就在监视芯片的一定距离内。

探测请求中嵌入的另一个有趣的信息是 SSID。一个未连接到任何网络的设备将向公众以及特定的接入点发送探测请求：已记住的设备。

例如，当你在家里时，假设你连接到了名为 HOME 的家庭 Wi-Fi 网络。当你没有连接到 HOME 时，一个带有 SSID HOME 的探测请求被广播出去。因此，我们不仅可以知道某个设备距离我们的 Wi-Fi 芯片有一定的距离，我们现在还知道它们设备上记住的网络。这是一个常被批评的漏洞。不过，在我们的情况下，这对于唯一识别某人特别有用。

# 准备工作

为了开始，你需要准备好以下物品：

+   一个能够进入监视模式的无线网卡

+   安装了 Kismet 的 Kali Linux（默认 Kali 安装的一部分）

这里列出的项目是基本要求，如果需要，你可以轻松地使用更多（或不同）的组件。例如，如果你想要增强范围，你可以使用一个带有外部天线连接的基于 USB 的无线网卡，这样可以获得更好的接收效果。你也可以使用其他无线应用程序来完成这个任务；然而，由于 Kismet 非常受欢迎，我们将在这个教程中使用它。

# 如何做…

Kismet 是一个有效的工具，用于定位和提取无线接入点和设备的有用信息。

只是一个小小的警告：在命令行中发出启动 kismet 的命令之前，您应该确保如果您使用外部 Wi-Fi 适配器，您已经在发出命令之前安装和配置好了它。默认情况下，kismet 应该配置为使用物理系统上存在的无线适配器；但是，如果您选择使用外部适配器，您可能需要执行额外的配置，以便让 kismet 自己识别和配置您的适配器。

在这个教程中，我们将通过命令提示符启动 kismet。但是，它也可以从应用程序菜单的无线攻击部分启动。无论哪种情况，启动 kismet 都会导致这里记录的相同步骤：

1.  打开一个终端窗口。

1.  在命令提示符下，输入命令`kismet`。

1.  现在，您将从半图形环境中配置 Kismet。您将使用*Tab*和*Enter*键进行导航。

1.  使用*Tab*键突出显示“否”如果你看不到灰色字母行。否则，保持“是”突出显示。

1.  再按一次*Enter*键。

1.  按一次*Enter*键以确认 Kismet 正在以 root 身份运行。

1.  再按一次*Enter*键以自动启动 Kismet 服务器。

1.  按一次*Enter*键以验证你要启动 Kismet 服务器。

1.  按一次*Enter*键以验证您可以“添加”一个捕获源。

1.  输入您使用`ifconfig`发现的无线接口的名称。如果您不记得，可以打开另一个控制台窗口，再次运行`ifconfig`命令以确定正确的接口（通常以`wlan`开头命名）。以下屏幕截图显示了接口输入屏幕：

![](img/3a8311ad-be9e-4be7-b4ec-f2b1ca0ba0ed.png)

Kismet 接口配置

以下是 Kismet 接口配置的步骤：

1.  再按一次*Tab*键。

1.  在“名称”字段中输入无线接口的名称。

1.  按一次*Tab*键。

1.  再按一次*Tab*键。

1.  再按一次*Enter*键。

1.  Kismet 应该能够识别已命名的无线接口，如果你输入的名字是正确的话。它还会生成不需要的虚拟接口的名称，比如`wlan0mon`，`wlan0monmon`和`wmaster0`。

1.  当在 shell（Kismet 窗口）的右下角显示“关闭控制台窗口”时，按一次键盘上的*Tab*键以突出显示“关闭控制台窗口”。

1.  再按一次*Enter*键。

1.  无线接入点的列表将显示在 shell（Kismet 窗口）的左上方。

1.  单击下拉菜单中的“查看”。

1.  单击“监视活动”。

与之前一样，如果等待足够长的时间，我们将看到更多的信息填充 Kismet 窗口，包括与探测网络相关的条目。与之前不同的是，我们想看看是否可以以某种方式使用这些信息，我们可以：

![](img/79a1a32d-0c20-4f1f-b995-714b39198175.png)

kismet 窗口显示检测到的无线客户端。

如果您在探测网络标题下识别出一个吸引您注意的网络，那么您可以使用我们其他食谱中的信息来诱使受害者遭受攻击。我们这样做的方式是创建一个恶意访问点，就像我们在之前的食谱中所做的那样。这一次的不同之处在于，我们将使用我们希望攻击的探测网络的名称来启动恶意访问点。如果一切顺利，客户端最终会连接到我们创建的访问点，然后我们可以开始嗅探流量或执行其他操作。
