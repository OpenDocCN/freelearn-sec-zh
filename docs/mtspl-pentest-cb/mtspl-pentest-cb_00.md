# 前言

渗透测试是当今网络安全的核心方面之一。它涉及通过实施现实生活中的安全测试对系统进行全面分析。它有助于识别系统主要组件中可能存在的潜在弱点，这些弱点可能出现在硬件或软件中。渗透测试成为安全的重要方面的原因是它有助于从黑客的角度识别威胁和弱点。可以实时利用漏洞来确定漏洞的影响，然后可以探索适当的补救措施或补丁，以保护系统免受外部攻击并减少风险因素。

决定渗透测试可行性的最大因素是对目标系统的了解。当对目标用户没有先验知识时，实施黑盒渗透测试。渗透测试人员将不得不从头开始收集有关目标系统的每一点信息，以实施攻击。在白盒测试中，了解目标的完整知识，并且测试人员将不得不识别可能存在的任何已知或未知的弱点。这两种渗透测试方法都同样困难，并且是特定于环境的。行业专业人员已经确定了几乎所有形式的渗透测试中必不可少的一些关键步骤。这些是：

+   **目标发现和枚举：**在不与目标进行任何物理连接的情况下识别目标并收集基本信息

+   **漏洞识别：**实施各种发现方法，如扫描、远程登录和网络服务，以确定目标系统上运行的不同服务和软件

+   **利用：**利用目标系统上运行的任何软件或服务中已知或未知的漏洞

+   攻击后的控制级别：这是攻击者在成功利用后可以在目标系统上获得的访问级别

+   **报告：**准备有关漏洞及其可能的对策的咨询

这些步骤可能看起来很少，但实际上对于运行着许多服务的高端系统的完整渗透测试可能需要数天甚至数月才能完成。使渗透测试成为耗时任务的原因是它基于“试错”技术。利用和漏洞在很大程度上取决于系统配置，因此我们无法确定特定的利用是否成功，除非我们尝试。考虑一下利用运行着 10 个不同服务的基于 Windows 的系统的例子。渗透测试人员将不得不确定这 10 个不同服务是否存在任何已知的漏洞。一旦它们被识别出来，利用的过程就开始了。这只是一个考虑了一个系统的小例子。如果我们有一个整个网络的这样的系统需要逐个渗透呢？

这就是渗透测试框架发挥作用的地方。它们自动化了测试的几个过程，如扫描网络、根据可用服务及其版本识别漏洞、自动利用等。它们通过为测试人员提供一个完整的控制面板来加速渗透测试过程，从而使其能够有效地管理所有活动并监视目标系统。渗透测试框架的另一个重要好处是报告生成。它们自动化了保存渗透测试结果并生成报告的过程，这些报告可以保存以供以后使用，也可以与远程工作的其他同事共享。

《Metasploit 渗透测试食谱》旨在帮助读者掌握当今场景中最广泛使用的渗透测试框架之一。Metasploit 框架是一个开源平台，可帮助创建真实的利用场景以及渗透测试的其他核心功能。本书将带您进入探索 Metasploit 世界的激动人心之旅，以及如何使用它执行有效的渗透测试。本书还将涵盖一些其他在框架上运行的扩展工具，并增强其功能，以提供更好的渗透测试体验。

# 本书内容

第一章，“安全专业人员的 Metasploit 快速技巧”，是进入 Metasploit 和渗透测试世界的第一步。本章介绍了框架的基本概念、架构和库。为了开始渗透测试，我们需要一个设置，因此本章将指导您通过使用虚拟机设置自己的虚拟渗透测试环境。随后，本章讨论了在不同操作系统上安装框架。本章以介绍 Metasploit 的第一次体验和其界面为结束。

第二章，“信息收集和扫描”，是渗透测试的第一步。它从最传统的信息收集方式开始，然后进一步使用 Nmap 进行扫描。本章还涵盖了一些额外的工具，如 Nessus 和 NeXpose，它们通过提供额外信息来弥补 Nmap 的局限性。最后，本章讨论了 Dradis 框架，这是渗透测试人员广泛使用的工具，用于与其他远程测试人员分享他们的测试结果和报告。

第三章，“基于操作系统的漏洞评估和利用”，讨论了在目标系统上运行的未打补丁的操作系统中发现漏洞。基于操作系统的漏洞具有很高的成功率，并且可以很容易地被利用。本章讨论了渗透几种流行的操作系统，如 Windows XP、Windows 7 和 Ubuntu。本章涵盖了这些操作系统的一些流行和已知的漏洞利用，以及它们如何在 Metasploit 中被用来入侵目标机器。

第四章，“客户端利用和防病毒绕过”，将我们的讨论推进到下一步，讨论了如何使用 Metasploit 执行客户端利用。本章涵盖了一些流行的客户端软件，如 Microsoft Office、Adobe Reader 和 Internet Explorer。随后，本章详细讨论了如何杀死客户端防病毒保护，以防止在目标系统中引起警报。

第五章，“使用 Meterpreter 探索受损目标”，讨论了利用后的下一步。Meterpreter 是一个后渗透工具，具有多种功能，可以帮助渗透受损目标并获取更多信息。本章涵盖了一些有用的渗透测试技术，如提权、访问文件系统和键盘记录。

第六章，“高级 Meterpreter 脚本”，通过涵盖一些高级主题，如构建我们自己的 meterpreter 脚本和使用 API mixins，将我们的 Metasploit 知识提升到了一个新的水平。本章将为读者提供灵活性，因为他们可以根据情景将自己的脚本实现到框架中。本章还涵盖了一些高级后利用概念，如枢轴、传递哈希和持久连接。

第七章，“渗透测试模块的使用”，将我们的焦点转移到 Metasploit 的另一个重要方面；它的模块。Metasploit 有一个相当不错的特定模块集合，可以在特定场景下使用。本章涵盖了一些重要的辅助模块，然后进一步讲解如何构建我们自己的 Metasploit 模块。本章需要一些基本的 Ruby 脚本知识。

第八章，“使用利用”，通过讨论如何将任何利用转换为 Metasploit 模块，为我们的武器库增添了最后一件武器。这是一个高级章节，将使读者能够构建自己的 Metasploit 利用模块并将其导入框架。由于并非所有利用都包含在框架中，因此本章在我们想要测试不在 Metasploit 存储库中的利用时非常有用。本章还讨论了一些模糊模块，这些模块对于构建任何漏洞的自己的概念验证非常有用。最后，本章以一个完整的示例结束，介绍了如何模糊应用程序以找到溢出条件，然后为其构建一个 Metasploit 模块。

第九章，“使用 Armitage”，是关于流行的 Metasploit 扩展 Armitage 的简要讨论。它为框架提供了图形界面，并通过提供点对点的利用选项来增强其功能。本章重点介绍了 Armitage 的重要方面，如快速查找漏洞、处理多个目标、在选项卡之间切换以及处理后利用。

第十章，“社会工程师工具包”，是本书的最后讨论部分，涵盖了框架的另一个重要扩展。社会工程师工具包（SET）用于生成依赖于人类疏忽以侵入目标的测试案例。本章涵盖了与 SET 相关的基本攻击向量，包括鱼叉式网络钓鱼、网站攻击向量、生成可感染的媒体，如 USB。

# 本书需要什么

要遵循和重现本书的配方，您将需要两个系统。一个可以是您的渗透测试系统，另一个可以是您的目标系统。或者，您也可以使用单个系统，并使用任何虚拟化软件设置渗透测试环境。

除此之外，您还需要一个预先安装了 Metasploit 和本书将讨论的其他工具的 BackTrack 5 的 ISO 镜像。或者，您可以从其官方网站单独为您喜欢的操作系统下载 Metasploit 框架。

# 本书适合谁

本书旨在面向专业的渗透测试人员，以及愿意掌握这一工具的新用户。书中内容适合各种读者。本书采用了易于阅读、理解和回忆的配方结构。书籍从渗透测试的基础知识开始，然后逐渐深入到专家级别。初学者到高级水平的过渡非常顺畅。因此，所有类别的读者都可以轻松阅读和理解本书。本书需要基本的扫描、利用和 Ruby 语言知识。

# 约定

在本书中，您会发现一些文本样式，用于区分不同类型的信息。以下是一些样式的示例，以及它们的含义解释。

文本中的代码单词显示如下："最后两个命令，`vulns`和`db_autopwn`是后期利用命令，我们将在后面的章节中讨论。"

代码块设置如下：

```
# Register command execution options
register_options(
[
OptString.new('USER', [ true, "The username to create", "metasploit" ]),
OptString.new('PASS', [ true, "The password for this user", "metasploit" ]),
], self.class)

```

任何命令行输入或输出都以以下形式编写：

```
$ chmod +x framework-4.*-linux-full.run
$ sudo ./framework-4.*-linux-full.run 

```

**新术语**和**重要单词**以粗体显示。例如，屏幕上显示的单词，菜单或对话框中的单词会以这种形式出现在文本中："您可以从**应用程序**菜单或命令行启动 Metasploit 框架"。

### 注意

警告或重要提示会以这种形式出现在一个框中。

### 提示

提示和技巧会以这种形式出现。
