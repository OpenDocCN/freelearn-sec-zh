# 第一章：使用 Go 进行安全性的简介

安全和隐私作为实际问题，尤其在科技行业中，持续获得越来越多的关注。网络安全市场正在蓬勃发展并持续增长。该行业发展迅速，创新和研究不断涌现。不仅安全的关注度和速度提升了，应用规模及其风险也以数量级的方式增长。行业需要一种简单易学、跨平台且在大规模应用中高效的编程语言。Go 是完美的选择，拥有强大的标准库、短暂的学习曲线和极快的速度。

本章将涵盖以下主题：

+   Go 的历史、语言设计、批评、社区和学习技巧

+   为什么使用 Go 进行安全性开发

+   设置开发环境并编写你的第一个程序

+   运行示例程序

# 关于 Go

Go 是一个开源编程语言，由 Google 创建，并在 BSD 风格许可证下发布。BSD 许可证允许任何人免费使用 Go，只要保留版权声明，并且不将 Google 的名字用于背书或推广。Go 深受 C 语言的影响，但语法更简单，内存安全性和垃圾回收机制更好。有时，Go 被描述为现代版的 C++。我认为这是对 Go 的过度简化，但 Go 无疑是一个简单而现代的语言。

# Go 语言设计

Go 的初衷是创建一种简单、可靠且高效的编程语言。如前所述，Go 深受 C 语言的影响。该语言本身非常简单，只有 25 个关键字。它被设计成能够很好地与 IDE 集成，但又不依赖于 IDE。根据我的经验，任何尝试过 Go 的人都会发现它非常易用，且学习曲线很短。

Go 的主要目标之一是解决 C++和 Java 代码的一些负面问题，同时保留性能。该语言需要简单且一致，以便管理非常庞大的开发团队。

变量是静态类型的，应用程序会快速编译成静态链接的二进制文件。拥有一个单一的静态链接二进制文件，使得创建轻量级容器变得非常容易。最终的应用程序也运行得非常快，接近 C++和 Java 的性能，并且比 Python 等解释型语言要快得多。Go 有指针，但不允许进行指针运算。Go 并不自诩为面向对象的编程语言，它在传统意义上也没有*类*；然而，它确实包含了许多与面向对象编程语言非常相似的机制。在下一章将对这一点进行更深入的讨论。接口被大量使用，组合是继承的等价物。

Go 有许多有趣的特性。一个突出的特点是内建的并发性。只需在任何函数调用前加上“go”关键字，它就会创建一个轻量级线程来执行该函数。另一个非常重要的特性是依赖管理，非常高效。依赖管理也是 Go 编译速度非常快的部分原因之一。它不会像 C++ 那样重复包含相同的头文件。Go 还具有内建的内存安全功能，由垃圾回收器处理未使用内存的清理。Go 的标准库也相当令人印象深刻。它现代化，并包含了网络、HTTP、TLS、XML、JSON、数据库、图像处理和加密等包。Go 还支持 Unicode，允许在源代码中使用各种字符。

Go 工具链是生态系统的核心。它提供了下载和安装远程依赖、运行单元测试和基准测试、生成代码以及根据 Go 格式标准格式化代码的工具。它还包括编译器、链接器和汇编器，这些工具编译速度非常快，并且通过简单地更改 `GOOS` 和 `GOARCH` 环境变量，可以轻松地进行交叉编译。

Go 语言中排除了一些特性。泛型、继承、断言、异常、指针运算和隐式类型转换都被 Go 排除了。许多特性是故意省略的，特别是泛型、断言和指针运算。作者排除了一些特性，因为他们希望保持性能、尽量简化语言规范，或者他们无法就最佳实现方式达成一致，或者某些特性过于争议。继承也故意被排除，取而代之的是接口和组合。其他一些特性，例如泛型，因其实现方式的争论过多而被排除，但可能会在 Go 2.0 中出现。作者认识到，向语言中添加特性要比删除特性容易得多。

# Go 的历史

Go 是一门相对年轻的语言，起源于 2007 年，并于 2009 年开源。它最初在 Google 作为一个 *20% 项目*启动，由 Robert Griesemer、Rob Pike 和 Ken Thompson 参与开发。20% 项目意味着开发者在项目中花费 20% 的时间将其作为一个实验性副项目。Go 1.0 于 2012 年 3 月正式发布。从一开始就计划成为一门开源语言。直到 Go 1.5 版本，编译器、链接器和汇编器是用 C 编写的。1.5 版本之后，所有内容都用 Go 编写。

Google 最初为 Linux 和 macOS 发布了 Go，社区推动了其他平台的支持，特别是 Windows、FreeBSD、OpenBSD、NetBSD 和 Solaris。它甚至已经移植到 IBM z 系列大型主机上。IBM 的 Bill O'Farrell 在 2016 年的 GopherCon 大会中做了题为 *将 Go 移植到 IBM z 架构* 的演讲 ([`www.youtube.com/watch?v=z0f4Wgi94eo`](https://www.youtube.com/watch?v=z0f4Wgi94eo))。

Google 以使用 Python、Java 和 C++ 而闻名。理解他们为何选择这些语言也并不困难。它们各自填补了特定的角色，且有各自的优缺点。Go 是一次尝试，旨在创建一种能够满足 Google 需求的新语言。他们需要能够在高负载下表现极佳、支持并发、且易于阅读和编写并能快速编译的软件。

启动 Go 项目的触发事件是处理一个庞大的 C++ 代码库，该代码库由于 C++ 处理依赖关系和重新包含头文件的方式，需要数小时才能编译完成 ([`www.youtube.com/watch?v=bj9T2c2Xk_s`](https://www.youtube.com/watch?v=bj9T2c2Xk_s) (37:15))。这也是 Go 主要目标之一——快速编译——的原因。Go 帮助将数小时的编译时间缩短为秒，因为它比 C++ 更高效地处理依赖关系。

Go 2.0 的讨论已经开始，但仍处于概念阶段。尚无发布日期，也没有急于发布新版本的计划。

# 采用与社区

Go 仍然是一门年轻的语言，但它的采用率持续增长，并且人气不断上升。Go 曾在 2009 年和 2016 年被评为 TIOBE 年度编程语言：

![](img/3d9b13c6-b329-4bdc-8ebe-4e563bf87d0d.png)

来源: https://www.tiobe.com/tiobe-index/go/

Go 团队曾表达过一个预期，即 Go 会吸引大量 C/C++ 和 Java 开发者，但他们惊讶地发现，许多用户来自于 Python 和 Ruby 等脚本语言。像我这样的其他人认为，Go 是 Python 的一个自然补充，Python 本身是一门很棒的语言。然而，当你需要更强大的功能时，应该选择什么语言呢？一些大公司已经证明，Go 适用于大规模的生产环境，包括 Google、Dropbox、Netflix、Uber 和 SoundCloud。

第一届 Go 大会，名为 GopherCon，于 2014 年举行。从那时起，GopherCon 每年都会举办。我有幸在 2016 年的 GopherCon 上做关于数据包捕获的演讲，经历了非常棒的体验 ([`www.youtube.com/watch?v=APDnbmTKjgM`](https://www.youtube.com/watch?v=APDnbmTKjgM))。

# Go 的常见批评

社区中经常出现一些批评意见。最臭名昭著、讨论最多的批评可能是缺乏泛型。这导致需要重复编写代码以处理不同的数据类型。接口可以在一定程度上缓解这个问题。我们可能会在未来的版本中看到泛型，因为作者们对泛型持开放态度，但他们并没有急于做出这一重要的设计决策。

另一个常见的批评是缺乏异常处理。开发者必须显式地处理或忽略每一个错误。就个人而言，我觉得这种方式是一种清新的变化。实际上这并不比其他方法多多少工作，而且你对代码流有完全的控制。有时候，使用异常时你无法确定它会在何处被捕获，因为它会向上传递。在 Go 中，你可以轻松地跟踪错误处理代码。

Go 有一个垃圾回收器来处理内存清理。垃圾回收器随着时间的推移不断升级，并且还在继续改进。虽然垃圾回收器会对性能产生轻微影响，但它为开发者节省了大量思考和担忧。Go 最初被描述为一种系统编程语言，但对内存的控制不足，限制了非常低级的应用。此后，他们不再称 Go 为系统编程语言。如果你需要对内存进行低级控制，那么你必须用 C 编写部分代码。

# Go 工具链

`go` 可执行文件是 Go 工具链的主要应用程序。你可以向 `go` 传递一个命令，它会采取适当的行动。工具链包括用于运行、编译、格式化源代码、下载依赖项等工具。让我们看看完整的命令列表，可以通过运行 `go help` 命令或直接运行 `go` 来获得：

+   `build`：此命令编译包和依赖项

+   `clean`：此命令删除对象文件

+   `doc`：此命令显示包或符号的文档

+   `env`：此命令打印 Go 环境信息

+   `generate`：这是代码生成器

+   `fix`：此命令在发布新版本时升级 Go 代码

+   `fmt`：此命令在包源代码上运行 `gofmt`

+   `get`：此命令下载并安装包和依赖项

+   `help`：此命令提供有关特定主题的更多帮助

+   `install`：此命令编译并安装包和依赖项

+   `list`：此命令列出包

+   `run`：此命令编译并运行 Go 程序

+   `test`：此命令运行单元测试和基准测试

+   `vet`：此命令检查源代码中的错误

+   `version`：此命令显示 Go 版本

有关这些命令的更多信息，请访问 [`golang.org/cmd/`](https://golang.org/cmd/)。

# Go 吉祥物

每个人都知道，最好的剑有名字，而最好的编程语言有吉祥物。Go 的吉祥物是**gopher**。gopher 没有名字。它有一个糖果豆形状的身体，微小的四肢，巨大的眼睛和两颗牙齿。它是由 Renee French 设计的，并且其版权属于*创意共享署名 3.0*许可证。这意味着你可以玩弄这些图像，但必须在使用时注明创作者 Renee French。

Renee French 在 2016 年丹佛的 GopherCon 大会上做了题为*Go Gopher：一个角色研究*的演讲，讲述了 gopher 是如何诞生的，它所采用的各种媒介和形式，以及如何在不同场景下绘制它的技巧([`www.youtube.com/watch?v=4rw_B4yY69k`](https://www.youtube.com/watch?v=4rw_B4yY69k))。

你可以在[`gopherize.me/`](https://gopherize.me/)生成一个自定义的 gopher 头像，并在[`blog.golang.org/gopher`](https://blog.golang.org/gopher)阅读更多关于 Go gopher 的信息。

![](img/13098b0b-f4f5-4d83-b780-4a505d29a41b.jpg)

# 学习 Go

如果你从未使用过 Go，不必担心。它有一个温和的学习曲线，足够简单，你可以在一两天内学会。最好的起点是[`tour.golang.org/`](https://tour.golang.org/)。这是 Go 编程语言的基本教程。如果你已经完成了这个教程，你应该已经有足够的基础，能顺利读完这本书。如果你正在阅读这本书而没有参加过这个教程，可能会遇到一些你不熟悉的概念，这些概念在这里没有解释。教程是一个很好的学习和实践的地方。

由于语言规范中只有 25 个保留关键字，足够简短，"凡人"也能理解。你可以在[`golang.org/ref/spec`](https://golang.org/ref/spec)上阅读更多关于规范的内容。

你应该已经熟悉大多数这些关键字。这些包括：`if`、`else`、`goto`、`for`、`import`、`return`、`var`、`continue`、`break`、`range`、`type`、`func`、`interface`、`package`、`const`、`map`、`struct`、`select`、`case`、`switch`、`go`、`defer`、`chan`、`fallthrough`和`default`。

这个教程将帮助你学习关键字、语法和数据结构的基础知识。教程中的游乐场让你在浏览器中练习编写和运行代码。

# 为什么使用 Go？

Go 有几个吸引我之处。并发性、速度和简洁性是最重要的。这个语言非常简单，容易学习。没有`try`、`catch`和异常处理流程。尽管有些人批评冗长的错误处理，但我觉得有一个简单的语言，不隐藏许多魔法，按它所说的做，反而让人耳目一新。`go fmt`工具标准化了格式，使得阅读他人代码变得容易，也消除了自己定义标准的负担。

Go 提供了一种可扩展性和可靠性的感觉，实际上使用起来非常愉快。在 Go 之前，快速编译的代码主要选项是 C++，而管理头文件和为不同平台构建代码并非易事。多年来，C++已经变得非常复杂，对大多数人来说，它远没有 Go 那么易于接近。

# 为什么在安全领域使用 Go？

我想我们都明白，并没有所谓“最佳编程语言”，但是针对不同的工作有不同的工具。Go 在性能和并发方面表现出色。它的其他优点包括能够编译为单一的可执行文件并轻松进行交叉编译。它还拥有适合网络应用的现代标准库。

交叉编译的简便性在安全领域创造了一些有趣的应用场景。以下是一些交叉编译在安全领域的应用案例：

+   渗透测试人员可以使用 Raspberry Pi 编译自定义的 Go 反向 Shell，用于 Windows、macOS 和 Linux，并尝试部署它们。

+   网络防御者可以拥有一个中央数据库，用来存储所有来自蜜罐服务器的蜜罐信息，然后交叉编译蜜罐服务器。这将使他们能够轻松地在所有平台上部署一致的应用程序，包括 Windows、mac 和 Linux。

+   网络防御者可以在他们的网络中部署极其轻量级的蜜罐，形式是一个带有单一静态链接二进制文件的 Docker 容器。容器的创建和销毁非常迅速，使用的带宽和服务器资源极少。

当你在考虑 Go 是否是一个好的语言选择时，可以将 Go 与其他一些热门编程语言进行对比，这可能会有所帮助。

# 为什么不使用 Python？

Python 是安全领域中的一种流行语言，这很可能是因为它的普及性、较短的学习曲线和大量的库。已经有几款用 Python 编写的有用安全工具，例如用于数据包捕获的 Scapy，网页抓取的 Scrapy，调试工具 Immunity，HTML 解析的 Beautiful Soup，和内存取证工具 Volatility。许多供应商和服务提供商也提供 Python 的 API 示例。

Python 容易学习，且有大量的资源可用。Go 也很容易编写，并且学习曲线较为平缓。在我看来，学习曲线和编程的简易性并不是 Go 和 Python 之间的主要区分因素。最大的区别，Python 的短板，则是性能。Python 在性能上无法与 Go 竞争。部分原因在于 Python 是解释型语言，但更大的因素是 **全局解释器锁**（**GIL**）。GIL 阻止解释器使用超过一个 CPU 核心的处理能力，即便有多个线程在执行。虽然有一些方法可以绕过这个问题，例如使用多进程，但这本身也有缺点和限制，因为它实际上是分叉了一个新进程。其他选择包括使用 Jython（Java 上的 Python）或 IronPython（.NET 上的 Python），它们没有 GIL。

# 为什么不使用 Java？

Java 的最大优势之一是 **一次编写，到处运行**（**WORA**）。如果你需要处理任何涉及 GUI、图形或音频的工作，这非常有价值。Go 确实无法在创建 GUI 方面超越 Java，但它是跨平台的，并且支持交叉编译。

Java 是一个成熟且广泛应用的语言，拥有丰富的资源。与 Go 的包相比，Java 库的选择更多。Java 是两种语言中更冗长的一个。Java 的生态系统更复杂，有多个构建工具和包管理器的选择。而 Go 则更简单且标准化。这些差异可能仅仅归因于两种语言的年龄差异，但仍然可能影响你的语言选择。

在某些情况下，**Java 虚拟机**（**JVM**）可能在内存或启动时间方面过于消耗资源。如果你需要将多个命令行 Java 应用连接起来，那么 JVM 的启动时间可能会对短时间运行的程序造成显著的性能损失。就内存而言，如果你需要运行多个相同应用的实例，那么每个 JVM 所需的内存将会累积。JVM 还可能有所限制，因为它创建了一个沙盒环境并限制了对主机的访问。Go 编译成本地机器代码，因此不需要虚拟机层。

Go 有很好的文档，社区持续发展并提供更多资源。对于有经验的程序员来说，这是一门容易学习的语言。并发处理比 Java 更简单，并且是语言内建的，而不是通过一个库包实现。

# 为什么不使用 C++？

C++ 确实提供了更多的控制，因为开发者需要负责内存管理，并且没有垃圾回收器。正因如此，C++ 的性能会稍微优于 Go。在某些情况下，Go 甚至能超过 C++ 的性能。

C++ 非常成熟，并且有大量的第三方库。虽然库不是完全跨平台的，且可能有复杂的 makefile，但 Go 的交叉编译要简单得多，可以通过 Go 工具链来实现。

Go 编译效率更高，因为它具有更好的依赖管理。C++ 可以多次重新包含相同的头文件，导致编译时间膨胀。Go 的包管理系统更加一致和标准化。线程和并发是 Go 的原生特性，而 C++ 需要依赖平台特定的库。

C++ 的成熟度也导致了该语言随着时间的发展而变得更加复杂。Go 是一种令人耳目一新的语言，它简单而现代。C++ 对初学者来说不如 Go 友好。

# 开发环境

本书中的所有示例都可以在主要平台——Windows、macOS 和 Linux 上运行。话虽如此，这些示例主要是在 Ubuntu Linux 上编写和开发的，因此推荐在以下示例中使用这个平台。

Ubuntu Linux 可免费获取，下载链接为 [`www.ubuntu.com/download/desktop`](https://www.ubuntu.com/download/desktop)。下载页面可能会要求捐款，但你可以选择免费下载。虽然 Ubuntu 不是必需的，但如果你拥有相同的环境，书中的内容会更容易跟随。其他 Linux 发行版应该也能很好地工作，但我强烈建议使用基于 Debian 的发行版。书中的大部分 Go 代码示例可以在 Windows、Linux 和 Mac 上无需任何修改地运行。某些示例可能是 Linux 和 Mac 特有的，比如文件权限，在 Windows 中的处理方式不同。任何特定于某个平台的示例都会特别提及。

你可以在虚拟机中免费安装 Ubuntu，或者将其作为主要操作系统使用。只要你的系统有足够的 CPU、内存和磁盘空间，我推荐使用 Oracle VirtualBox 来创建虚拟机，下载地址为 [`www.virtualbox.org/`](https://www.virtualbox.org/)。VMWare Player 是 VirtualBox 的替代品，下载地址为 [`www.vmware.com/products/player/playerpro-evaluation.html`](https://www.vmware.com/products/player/playerpro-evaluation.html)。

下载并安装 VirtualBox，然后下载 Ubuntu 桌面版 ISO 文件。创建一个虚拟机，让它启动 Ubuntu ISO 文件，并选择安装选项。安装好 Ubuntu 并以用户身份登录后，你可以安装 Go 编程语言。Ubuntu 通过提供一个软件包使得这个过程变得非常简单。只需打开一个终端窗口并运行以下命令：

```
sudo apt-get install golang-go
```

使用 `sudo` 提升你的权限以进行安装，并可能会要求你输入密码。如果一切顺利，你现在可以访问 `go` 可执行文件，它包含了整个工具链。你可以运行 `go help` 或直接运行 `go` 来查看使用说明。

如果你没有使用 Ubuntu 或者想要安装最新版本，可以从[`golang.org/dl`](https://golang.org/dl/)下载最新版本。Windows 和 Mac 的安装程序会自动更新你的 `PATH` 环境变量，但在 Linux 上，你需要手动将解压后的内容移动到期望的位置，比如 `/opt/go`，然后更新你的 `PATH` 环境变量以包含该位置。可以参考以下示例：

```
# Extract the downloaded Go tar.gz
tar xzf go1.9.linux-amd64.tar.gz
# Move the extracted directory to /opt
sudo mv go /opt
# Update PATH environment variable to include Go's binaries
echo "export PATH=$PATH:/opt/go/bin" >> ~/.bashrc
```

现在重新启动终端以使更改生效。如果你使用的是非 Bash 的 shell，你需要更新相应的 RC 文件。

# 在其他平台上安装 Go

如果你没有使用 Ubuntu，依然可以轻松安装 Go。Go 官方网站在[`golang.org/dl/`](https://golang.org/dl/)的下载页面提供了多种安装格式。

# 其他 Linux 发行版

第一个选项是使用 Linux 发行版的包管理器来安装 Go。大多数主流发行版都有 Go 的安装包。包的名称可能不同，所以可能需要通过网络搜索来找到准确的包名。如果没有可用的包，你可以直接下载预编译的 Linux tarball 并解压。一个好的解压位置是 `/opt/go`。然后，像前面所述那样，将 `/opt/go/bin` 添加到你的 `PATH` 环境变量中。

# Windows

提供了官方的 Windows 安装程序，使安装过程变得像运行安装程序一样简单。你可能需要修改环境变量并更新 `%PATH%` 变量。在 Windows 10 中，你可以通过控制面板 | 系统 | 高级系统设置 | 环境变量来找到它。

# Mac

Mac 也提供官方安装程序。运行安装程序后，Go 将自动添加到你的 `PATH` 环境变量中。

# 设置 Go

此时，你的环境应该已经安装了 Go，并且你应该能够在终端窗口中运行 `go` 可执行文件。`go` 程序是你访问 Go 工具链的方式。你可以通过运行以下命令来测试它：

```
go help
```

现在我们准备编写第一个 Hello World 程序，以确保我们的环境完全正常。我们开始编写代码之前，需要创建一个合适的工作空间。

# 创建你的工作空间

Go 有一个标准的工作空间文件夹结构。遵循这些标准对于 Go 工具链的正常工作至关重要。你可以在任何地方创建工作空间目录，并将其命名为你喜欢的名字。在实验环境中，我们将使用 `Home` 目录作为 Go 工作空间。这意味着源代码文件将位于 `~/src`，包将构建在 `~/pkg`，可执行文件将安装到 `~/bin`。

# 设置环境变量

为了使大多数 Go 工具链正常工作，必须设置`GOPATH`环境变量。`GOPATH`指定你将哪个目录作为工作空间。在构建包之前，必须先设置`GOPATH`环境变量。更多帮助和信息，可以通过在终端中运行以下命令来调用`go help`命令：

```
go help gopath
```

我们需要告诉 Go 将`home`目录视为工作空间。这是通过设置`GOPATH`环境变量来完成的。你可以通过三种方式设置`GOPATH`：

+   第一种方法是每次运行`go`命令时手动设置它。考虑这个示例：

```
 GOPATH=$HOME go build hello
```

+   你也可以设置`GOPATH`变量，这样它将在你关闭终端并丢失环境变量之前一直保持设置状态：

```
 export GOPATH=$HOME
```

+   第三个选项是永久设置`GOPATH`环境变量，如下所示：

1.  1.  将其添加到你的 Shell 启动脚本`.bashrc`中。这样每次启动终端时都会设置该变量。

    1.  运行此命令以确保每次打开终端/ shell 会话时都设置了`GOPATH`：

```
 echo "export GOPATH=$HOME" >> $HOME/.bashrc
```

1.  1.  重启终端以使更改生效。如果你使用的是 Zsh 或其他替代的 Shell，你需要更新相应的 RC 文件。

请注意，Go 版本 1.8 及更高版本不需要显式设置`GOPATH`环境变量。如果没有设置`GOPATH`，它将使用`$HOME/go`作为默认工作空间。

# 编辑器

我们即将编写我们在新`hello`目录中的第一个程序。你首先需要选择使用哪个编辑器。幸运的是，使用 Go 并不需要特殊的 IDE 或编辑器。Go 工具链可以轻松集成到许多编辑器和 IDE 中。你的选择从使用简单的文本编辑器（如 Notepad）到专门为 Go 设计的完整 IDE。

我建议你从一个简单的文本编辑器开始，比如 nano 或 gedit，因为这些编辑器在 Ubuntu 中已经预装，易于使用，且原生支持 Go 语法高亮。不过，你也可以选择其他编辑器或 IDE。

许多文本编辑器和 IDE 都提供 Go 支持的插件。例如，Visual Studio Code、Emacs、Sublime Text、JetBrains IntelliJ、Vim、Atom、NetBeans 和 Eclipse 都有 Go 插件。有几个 Go 专用的 IDE，即 JetBrains GoLand 和 LiteIDE，它们都是跨平台的。

从`nano`或`gedit`命令开始，当你熟悉 Go 后，再探索其他编辑器和 IDE。本书不会比较这些编辑器，也不涉及如何配置它们。

# 创建你的第一个包

在`~/src`目录内，任何你创建的目录都是一个包。你的目录名就是包或应用程序的名称。我们首先需要确保`src`目录存在。波浪号（`~`）是你家目录的快捷方式，类似于`$HOME`变量。参考以下代码块：

```
mkdir ~/src
```

让我们为我们的第一个应用程序创建一个名为`hello`的新包：

```
cd ~/src
mkdir hello
```

包其实就是一个目录。你可以在一个包中包含一个或多个源文件。任何子目录都被视为单独的包。一个包可以是一个包含`main()`函数的应用程序（`package main`），也可以是一个只能被其他包导入的库。这个包现在还没有文件，但我们稍后会写第一个文件。现在不要太担心包的结构。你可以在[`golang.org/doc/code.html#PackagePaths`](https://golang.org/doc/code.html#PackagePaths)上阅读更多关于包路径的信息。

# 编写你的第一个程序

你可以拥有的最简单的包是一个目录中的单个文件。创建一个新文件`~/src/hello/hello.go`，并将以下代码放入其中：

```
package main

import "fmt"

func main() {
   fmt.Println("Hello, world.")
}
```

# 运行可执行文件

执行程序的最简单方式是使用`go run`命令。以下命令将运行文件而不留下可执行文件：

```
go run ~/src/hello/hello.go
```

# 构建可执行文件

要编译并构建可执行文件，请使用`go build`命令。在运行`go build`时，你必须提供一个包的路径。你提供的包路径是相对于`$GOPATH/src`的。由于我们的包在`~/src/hello`，我们将如下运行该命令：

```
go build hello
```

只要我们设置了`$GOPATH`，其实可以从任何地方调用`go build`。创建的可执行文件将输出到当前工作目录。然后，你可以使用以下命令运行它：

```
./hello
```

# 安装可执行文件

`go build`工具适用于在当前工作目录中生成可执行文件，但也有方法可以构建并安装你的应用程序，使得所有可执行文件都收集在同一位置。

当你运行`go install`时，它会将输出文件放在默认位置`$GOPATH/bin`。在我们的例子中，我们将`$GOPATH`设置为`$HOME`。所以默认的`bin`目录就是`$HOME/bin`。

如果你希望安装到其他位置，可以通过设置`GOBIN`环境变量来覆盖该位置。为了安装我们的`hello`程序，我们将运行以下命令：

```
go install hello
```

这将构建并创建一个可执行文件，`~/bin/hello`。如果`bin`目录不存在，它将自动创建。如果你多次运行`install`命令，它将重新构建并覆盖`bin`目录中的可执行文件。然后可以使用以下命令运行该应用程序：

```
~/bin/hello
```

为了方便，你可以将`~/bin`添加到`PATH`环境变量中。这样做将允许你从任何工作目录运行应用程序。要将`bin`目录添加到`PATH`，请在终端中运行以下命令：

```
echo "export PATH=$PATH:$HOME/gospace/bin" >> ~/.bashrc
```

完成后，请务必重新启动终端以刷新环境变量。之后，你可以通过在终端中输入以下内容来运行`hello`应用程序：

```
hello
```

安装应用程序完全是可选的。你不必安装程序就能运行或构建它们。在开发过程中，你可以始终从当前工作目录构建和运行，但安装已完成的应用程序是方便的，尤其是当它们被多次使用时。

# 使用 go fmt 格式化

`go fmt`命令用于格式化源代码文件，使其符合 Go 的格式化标准。

这将确保缩进准确，并且不会有多余的空格，除此之外，还能进行其他检查。你可以格式化单个 Go 源代码文件或一次性格式化整个包。遵循 Go 编码规范并对文件运行`go fmt`是一个良好的习惯，这样可以确保你的代码遵循了相关的规范。关于格式化的更多信息，请阅读[`golang.org/doc/effective_go.html#formatting`](https://golang.org/doc/effective_go.html#formatting)。

# 运行 Go 示例

本书中提供的示例都是自包含的。每个示例都是完整的程序，并且可以运行。大多数示例较短，演示一个特定的主题。虽然这些示例可以作为独立的程序使用，但其中一些可能仅有有限的用途。它们的目的在于作为参考，并像烹饪书一样用于构建你自己的项目。因为每个示例都是自包含的主包，你可以使用`go build`命令来生成可执行文件，并使用`go run`来运行文件。以下是关于构建和运行程序的更多细节。

# 构建单个 Go 文件

如果你构建一个文件，它将生成一个以 Go 文件命名的可执行文件。运行以下命令：

```
go build example.go
```

这将生成一个名为 example 的可执行文件，可以像这样执行：

```
./example
```

# 运行单个 Go 文件

如果你只是想运行程序，而不是构建文件并生成可执行文件，那你不需要构建文件。`go run`选项允许你直接运行`.go`文件，而不留下可执行文件。你仍然可以像运行常规可执行文件那样传递参数，示例如下：

```
go run example.go arg1 arg2
```

# 构建多个 Go 文件

如果一个程序被拆分成多个文件，你可以将所有文件传递给`build`命令。例如，如果你有一个`main.go`文件和一个包含额外函数的`utility.go`文件，你可以通过运行以下命令来构建它们：

```
go build main.go utility.go
```

如果你尝试单独构建`main.go`，它将无法找到对`utility.go`中函数的引用。

# 构建文件夹（包）

如果一个包包含多个需要构建的 Go 文件，手动将每个文件传递给`build`命令会非常繁琐。如果你在文件夹中运行`go build`而不传递任何参数，它将尝试构建目录中的所有`.go`文件。如果其中某个文件在顶部包含`package main`语句，它将生成一个以目录名命名的可执行文件。如果你编写一个程序，也可以编写一个不包含主文件的包，该包仅作为库被其他项目引用。

# 安装程序以供使用

安装程序类似于构建程序，但不同的是，你运行的是`go install`而不是`go build`。你可以在一个目录内运行它，传递一个绝对目录路径，或者传递相对于`$GOPATH`环境变量的目录路径，甚至直接传递一个文件路径。一旦程序被安装，它就会进入你的`$GOBIN`目录，前提是你已经设置好该目录。你还应该将`$GOBIN`添加到你的`$PATH`中，这样无论你当前在哪个目录，都可以直接从命令行运行已安装的程序。安装是完全可选的，但对于某些程序来说，尤其是你想保存或频繁使用的程序，安装会更方便。

# 总结

阅读完本章后，你应该对 Go 编程语言及其一些关键特性有一个总体的了解。你还应该在你的机器上安装了 Go，并配置好了相关的环境变量。如果你需要更多关于安装和测试环境的说明，请参考 Go 文档：[`golang.org/doc/install`](https://golang.org/doc/install)。

在下一章，我们将更深入地了解 Go 编程语言，学习其设计、数据类型、关键字、特性、控制结构以及如何获取帮助和查找文档。如果你已经熟悉 Go，这将是一个很好的复习，帮助你巩固基础知识。如果你是 Go 新手，这将为你后续的学习做一个入门准备。
