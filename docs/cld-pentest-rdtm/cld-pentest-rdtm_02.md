

# 第二章：云网络是如何遭受网络攻击的？

当你开始成为一名云渗透测试员时，从基础知识开始是非常有帮助的。

你的工作是测试云网络，了解它们如何被网络攻击。你所工作的组织可以利用你的发现来提高其云网络的网络安全性。

因为亚马逊（AWS）、微软（Azure）和谷歌（GCP）拥有你将测试的基础设施，你将不被允许做任何网络攻击者在现实生活中可能尝试做的事情。但你需要了解云网络所面临的所有网络攻击类型，即使你无法模拟所有的攻击。

最好的渗透测试员能够像真实的网络攻击者一样思考。本章将帮助你更好地理解云网络如何遭受网络攻击，以帮助你进行更有效的渗透测试。

在本章中，我们将涵盖以下主要内容：

+   理解渗透测试

+   外部和内部攻击

+   对数据的机密性、完整性和可用性的攻击

+   理解云中的横向移动

+   零信任网络

让我们开始吧！

# 理解渗透测试

**渗透测试**（或简称**pentest**）是模拟的网络攻击，旨在发现计算机网络和应用程序中的漏洞。渗透测试与实际网络攻击的最大区别在于，前者是经过计算机或网络所有者完全同意的，而后者则不是。

作为渗透测试员或红队成员，你不仅需要获得目标所有者的同意，还必须签署一份法律协议，详细说明你被允许做什么、禁止做什么以及渗透测试的范围。这适用于你是被渗透测试组织的员工、该组织的第三方承包商、进行简单一次性渗透测试的人，还是作为红队成员进行渗透测试的情况。

无论组织是否设有红队，它都将在漏洞评估的历史之后开始进行渗透测试。漏洞评估是发现安全漏洞的第一步方法。它根据一组检查标准分析应用程序或网络的状态。这些标准通常基于一组安全标准，如**OWASP 应用安全验证标准** ([`owasp.org/www-project-application-security-verification-standard/`](https://owasp.org/www-project-application-security-verification-standard/)) 或 **PCI PTS POI 模块化安全要求** ([`www.pcisecuritystandards.org/wp-content/uploads/2023/01/PTS_POI_v6.2_Bulletin.pdf`](https://www.pcisecuritystandards.org/wp-content/uploads/2023/01/PTS_POI_v6.2_Bulletin.pdf))。有数百种不同的安全标准适用于您所在的组织。漏洞评估适用于所有企业和企业，无论其安全成熟度水平如何。安全成熟度是一个复杂的概念，但简言之，它关乎组织安全政策和控制的发展程度。

一旦组织进行了一些漏洞评估，根据这些发现加固了其网络，并组建了一个网络安全专业团队，那么它可能已经准备好进行渗透测试了。渗透测试旨在发现只能通过模拟网络攻击才能发现的安全漏洞。从法律和程序上讲，渗透测试与网络攻击大不相同，但您进行渗透测试的计算机和网络并不知道这种区别。您的渗透测试会破坏事物，即使其影响只是暂时性地使几台计算机在**拒绝服务**（**DoS**）攻击中下线一个小时。这就是为什么只有具备一定安全成熟度的组织才应进行渗透测试的原因，也是为什么在开始渗透测试之前总是需要明确的范围。例如，您的组织可能会将其生产从一个网络段移至另一个网络段，以便您可以在一个网络段内进行渗透测试而不干扰其日常运营。

红队是您组织内的一组专门人员，根据网络安全威胁景观中的模式进行频繁的渗透测试。例如，如果出现新的企业勒索软件威胁，您的红队可能被指定在您的网络内模拟该特定的新勒索软件，并观察其影响。

为了有效地进行渗透测试，你必须完全理解云网络是如何遭受网络攻击的。在本书中，你将学习到许多常用于在 AWS、Azure 和 GCP 环境中进行渗透测试的工具。正确地在合适的场景下使用这些工具，将帮助你有效进行渗透测试，找到你的组织必须解决的漏洞。但是，世界上最好的工具只有在你知道如何使用它们以及为什么使用它们时才有效。有时你也会在没有这些工具的情况下进行一些活动。在所有的场景中，作为一个有效的云渗透测试员，你必须理解云网络是如何遭受网络攻击的。这就是本章的全部内容！

# 外部和内部攻击

当你所在组织的防御安全团队准备应对网络攻击时，他们需要了解威胁行为者在试图恶意干扰你们数据时所采取的每一步。没有任何一次网络入侵是一步完成的。勒索软件可能需要一名员工不小心执行了一个电子邮件附件，才在配置不当的云实例之间传播开来。数据泄露可能需要贿赂一名员工，并交给他们一个含有定制间谍软件的 USB 闪存驱动器。

MITRE ATT&CK 数据库 ([`attack.mitre.org/`](https://attack.mitre.org/)) 是一个极好的资源，可以帮助各种网络安全专业人士了解网络威胁行为者在实施犯罪时所采取的各种步骤。我将在本章中频繁引用它。特别是如果你作为红队的一部分进行渗透测试，这些可能就是你在演练中模拟的网络攻击类型。

一些网络攻击链可能很简单，而另一些则相对复杂。但它们都有一个起点，可能是外部的，也可能是内部的，你作为云渗透测试员需要理解外部和内部网络攻击之间的区别。你很可能会在职业生涯中渗透测试这两种类型的场景。商业和企业云网络是许多最具破坏性的网络攻击的主要目标。

曾经有一段时间，也许是在 1990 年代和 2000 年代初，消费者经常成为网络犯罪分子的目标。普通人仍然应该小心他们手机、平板和 PC 的安全。它们有时会成为钓鱼诈骗、数字监控和恶意软件的目标。一个普通人可能在勒索软件攻击中被迫支付几百美元的加密货币给网络攻击者。即使是小型企业，年收入达到数百万美元，也可能被迫支付百万美元的加密货币赎金给网络攻击者。此外，其他类型的财务动机网络犯罪，如数据泄露，当目标是企业时，比针对一位老年人的网络攻击更具盈利性。

作为渗透测试员，你将为公司工作，无论是作为员工还是第三方承包商，这些公司都是网络犯罪的丰厚目标。这也是他们雇用你来模拟这些网络犯罪的原因，目的是为了了解如何提升防御能力。

你在新闻或最喜欢的虚构娱乐作品中常常听到的经典网络攻击，通常来源于外部。例如，一名戴着帽衫的网络犯罪分子在黑暗地下室的 PC 上破解了网络中的加密终端，然后下载了所有敏感文件！屏幕上闪现一个骷髅和交叉骨的图标……“你被黑了！”受害组织从未见过攻击者。它雇用了顶尖的网络调查团队，追踪攻击者的行踪，最终警方在另一个大陆的咖啡馆里识别出了这名网络犯罪分子。罪犯被戴上手铐，所有人鼓掌，字幕滚动。

现实世界中的网络犯罪同样具有破坏性，但它在实际发生时看起来可能更为温和。调查它并不像电影中那样快速和刺激，因为你将帮助你工作的公司为现实中的网络攻击做好准备，而这通常不符合典型的电影剧本。现在，让我们了解这些攻击的性质，并看看一些真实的例子。

## 外部网络攻击

外部网络攻击起源于目标组织之外。攻击者通常需要通过互联网开始对组织云服务器的网络攻击。

外部网络攻击者必须突破其攻击的组织网络。然后，他们很可能需要提升权限。

权限提升

这指的是攻击者从一个具有有限访问控制权限的用户账户开始，逐步提升权限，最终可能会获取到网络中完全具有管理权限的账户……这尤其危险！

现在，让我们来看看一些可能的外部网络攻击向量，特别是在云网络中的情况。

### 路过式妥协

首先是“*路过式妥协*”。根据 MITRE ATT&CK（[`attack.mitre.org/techniques/T1189/`](https://attack.mitre.org/techniques/T1189/)），路过式妥协发生在用户通过常规的网页浏览活动访问某个网站时。攻击者控制该网站，通过用户的网页浏览器发起攻击。有时，攻击者还会使用这种技术进行非漏洞利用的恶意行为，例如获取应用程序访问令牌。

很多对云网络的访问都是通过网页进行的，因此这是一个非常相关的攻击向量。

### 利用面向公众的应用程序

另一个与云网络密切相关的外部攻击向量是“利用面向公众的应用程序”。MITRE ATT&CK ([`attack.mitre.org/techniques/T1190/`](https://attack.mitre.org/techniques/T1190/)) 将其描述为攻击者通过利用互联网连接的计算机或应用程序的漏洞来进行攻击。常见的利用手段包括 SQL 数据库、标准互联网服务如 SSH 或 SMB、网络管理协议，以及具有互联网访问权限的开放插座（如 web 浏览器）。但其他连接互联网的技术也可能被用来进行这些攻击。

如果这些漏洞涉及到云基础设施或容器化应用程序（例如 Kubernetes 或 Docker），攻击者可能造成极其灾难性的破坏。他们可以拦截其他实例或容器，并且通常还能够获得它们的 API 访问权限。

### 外部远程服务

我将要讲解的下一个 MITRE ATT&CK 入口向量是“外部远程服务”。这是一种常见的外部网络攻击的起始方式。MITRE ATT&CK ([`attack.mitre.org/techniques/T1133/`](https://attack.mitre.org/techniques/T1133/)) 将其描述为攻击者针对外部服务进行攻击，以获取恶意访问权限或在网络中保持持久性。常见的目标远程服务包括 VPN、Citrix 或类似的远程访问技术。攻击者通常需要访问有效账户，才能使此类攻击发挥作用。通过已经被攻破的网络或像凭证农场（credential pharming）这样的方式，攻击者可以窃取凭证来获得有效账户的访问权限。当然，在外部网络攻击中，攻击者也可以通过钓鱼攻击员工来获取有效账户。钓鱼攻击有多种形式，但最常见的是使用假网站、假邮件、假短信或假社交媒体帖子来模仿可信的实体。

### 有效账户

这个下一个 MITRE ATT&CK 向量类别是大多数内部网络攻击的常见入口点，被称为“有效账户”。根据 MITRE ATT&CK ([`attack.mitre.org/techniques/T1078/`](https://attack.mitre.org/techniques/T1078/))，攻击者可以通过攻破具有权限的合法用户账户，获取对计算机系统的恶意访问。他们也可能攻破特权账户，以建立持久性、进行权限升级或规避防御。有时，不活跃的用户账户也会被利用。网络管理员应当监控系统中账户的行为，并尽快停用前员工和合同工的账户。

#### 云账户

我将在这里提到一个攻击向量的子类别，因为它与云渗透测试特别相关；它被称为“有效账户：云账户”（[`attack.mitre.org/techniques/T1078/004/`](https://attack.mitre.org/techniques/T1078/004/)）。请前往 MITRE ATT&CK 网站了解详细信息。云网络包含大量运作中的组件，可能有多个 SaaS 应用、容器、服务器内的服务器、虚拟机等等。它们可能非常复杂，因此攻击者可以利用更多的用户账户和机器身份进行攻击。

组织不仅要关注拥有活跃账户的内部网络攻击者，还需要关注不活跃账户，这也是一个常见的攻击向量。作为云渗透测试员时，你可能需要攻破一个组织忘记移除的不活跃账户。

## 内部网络攻击

内部网络攻击源自目标组织内部。攻击者可能是公司的员工、承包商、高层或供应链实体，或者外部网络攻击者通过贿赂或其他方式促使员工、承包商、高层或供应链实体帮助他们进行网络攻击。

内部网络攻击者已经进入了你的网络。如果他们是组织的员工，他们在你的网络和应用程序中至少拥有某些权限账户，即使这些权限很小。很可能他们还具有对公司计算机和本地网络的物理访问权限，这样可以更容易地对云网络发起攻击。供应链实体也已拥有对组织的特权访问，这是外部人员无法拥有的。你组织的供应链由向你组织提供产品和服务的其他公司组成，例如，向汽车制造商出售金属的公司。金属制造商是汽车制造商供应链的一部分。为学校定制开发网站应用程序的网络开发公司是学校供应链的一部分。

以下是 MITRE ATT&CK 的“初始访问”向量，这些向量可能与内部网络攻击相关。

### 硬件添加

第一个是“硬件添加”。MITRE ATT&CK（[`attack.mitre.org/techniques/T1200/`](https://attack.mitre.org/techniques/T1200/)）将其定义为敌对方使用计算机硬件（如网络设备）作为获取恶意访问的向量。这种技术通常使用“更强大的硬件设备”而非可移动媒体（如 USB 驱动器）来部署新的攻击功能和特性，而不仅仅是分发恶意有效载荷。

你组织的云网络可能会受到由网络犯罪分子物理连接到本地网络的硬件设备攻击。

### 供应链妥协

另一种可以在内部网络攻击中使用的技术是“供应链妥协”。MITRE ATT&CK ([`attack.mitre.org/techniques/T1195/`](https://attack.mitre.org/techniques/T1195/)) 将其描述为攻击者操控或拦截产品或产品交付机制，以便妥协连接的用户和网络，进而导致数据或系统的妥协。公司的供应链可能包括他们合作的其他企业、提供应用程序和网络服务的公司等。在这些攻击中，有时源代码库、开发工具、开源依赖项或软件更新机制会被操控。

对于本书的目的，供应链妥协尤为相关，因为 AWS、Azure 和 GCP 服务与应用程序可以被视为公司供应链的一部分。

供应链实体通常与组织的内部网络有连接，无论是在本地还是在云中。作为云渗透测试人员，你有时可能会模拟供应链攻击。有时，你也可能需要在进行渗透测试时与组织的供应链实体之一进行合作。

### 受信关系

下一个攻击向量适用于许多内部网络攻击，被称为“受信关系” ([`attack.mitre.org/techniques/T1199/`](https://attack.mitre.org/techniques/T1199/))。MITRE ATT&CK 定义为攻击者利用目标信任的个人或组织来进行网络攻击。这些人或实体可以包括托管服务提供商、IT 合同工或建筑维护工人等。

这是一个假设的场景。清洁工要求获取服务器机房的钥匙，因为他们需要在那里清理东西。不是其他人冒充清洁工，而是真正的清洁工，他已经在这里工作了几个月。一旦清洁工进入服务器机房，他们会将一个含有可执行恶意软件的 USB 驱动器插入到公司内部的一台主服务器上，从而感染所有通过该服务器管理的客户端计算机。

网络攻击者会寻找多种方式来利用云网络和应用程序。为了获取访问权限，他们可能会发现应用程序面向互联网的部分的漏洞，如 web 应用程序和开放端口。他们可能会劫持具有访问权限的账户，甚至可能会行贿公司内部人员，让他们将恶意设备物理地放置在目标网络中。作为渗透测试人员，你主要是模拟应用程序和网络中的漏洞远程进行攻击。但在进行红队演练时，即使这些手段难以模拟，仍然要牢记网络攻击者常用的其他技术。

# 对云数据的机密性、完整性和可用性的攻击

所以，我们已经看过了内部网络攻击和外部网络攻击之间的区别，以及它们可能使用的一些不同的入侵点攻击路径。作为渗透测试员，您还可以通过另一种方式来分类您将模拟的网络攻击。

我们必须看一下`CIA`（**保密性、完整性和可用性**）**三要素**在网络安全中的重要性。这是我们研究领域中最重要的概念之一。

所有的网络攻击都会影响 CIA 三要素中的一个、两个或全部三个组成部分：

+   **保密性**关乎确保只有被授权的实体能够读取您组织的数据。数据泄露就是影响保密性的一种网络攻击的例子。

+   **完整性**关乎确保只有授权的实体能够修改或更改您组织的数据。如果一个网络攻击者将您组织的云应用程序中的合法组件替换为恶意软件，那就是影响完整性的网络攻击的一个例子。

+   **可用性**关乎确保当授权实体需要时，您组织的数据、服务器和应用程序随时可用。如果一个网络攻击者对您组织的云端网页服务器发起**分布式拒绝服务**（**DDoS**）攻击，导致客户无法使用您的网页应用程序，这就是影响可用性的网络攻击的一个例子。

一些网络攻击会影响 CIA 三要素中的多个组成部分。例如，现如今的企业勒索软件不仅恶意加密您组织的数据，且没有支付赎金无法获取解密密钥，还经常泄露您组织的数据。所以，在一次恶意软件攻击中，既损害了可用性，也损害了保密性。如果勒索软件通过更改云服务器上的一些数据来建立持久性，那也会损害完整性！

## 保密性

让我们来看一个新闻中的网络攻击例子，它影响了云网络中数据的保密性。

DC Health Link 在 2023 年 3 月发推表示，其系统的敏感数据遭到数据泄露。DC Health Link 帮助许多为美国政府工作的人员提供健康保险。它的网络至少有一个大型组件是由云服务提供商托管的。该推文([`twitter.com/DCHealthLink/status/1634342617235312640`](https://twitter.com/DCHealthLink/status/1634342617235312640))写道：

“DC 健康福利交换管理局非常重视参保人信息的数据泄露事件。2023 年 3 月 6 日星期一，一旦发现此事件，我们立即展开调查，开始与执法部门合作，并聘请第三方取证公司 Mandiant。尽管我们的调查仍在进行中，但我们想就目前情况提供更新。共有 56,415 名客户受到影响。数据字段包括以下内容，尽管并非每个参保人都一定包含所有数据字段：姓名、社会安全号码、出生日期、性别、健康计划信息（例如计划名称、承保人名称、保费金额、雇主捐款和覆盖日期）、雇主信息、参保人信息（例如地址、电子邮件、电话号码、种族、种族和公民身份状态）。”

仅仅因为数据泄露是在 2023 年 3 月报告的，并不意味着它发生在 2023 年 3 月！数据泄露经常数月未被报告。要么组织早在之前就知道了泄露事件，只是在数月后才公布信息，要么组织花了数月时间才首次发现它。

我们知道有 56,415 名客户受到影响，可以合理假设网络中的大部分数据都在云上。我们不知道数据泄露是如何发生的，但我们可以做出合理猜测。“来自云存储的数据”是 MITRE ATT&CK 数据库中的一个公认的攻击向量（[`attack.mitre.org/techniques/T1530/`](https://attack.mitre.org/techniques/T1530/)）。它说：

“许多云服务提供商提供在线数据对象存储解决方案，例如 Amazon S3、Azure Storage 和 Google Cloud Storage。这些解决方案与其他存储解决方案（例如 SQL 或 Elasticsearch）不同之处在于没有统一的应用程序。可以直接使用云提供商的 API 检索这些解决方案中的数据。在其他情况下，诸如 Slack、Confluence 和 Salesforce 等 SaaS 应用程序提供商也提供云存储解决方案作为其平台的外围用例。这些云对象可以直接从其关联应用程序中提取。攻击者可能从这些云存储解决方案中收集敏感数据。提供商通常提供安全指南以帮助最终用户配置系统，尽管配置错误是一个常见问题。已经发生过许多云存储未经适当保护的事件，通常是通过无意中允许未经身份验证的用户公开访问、所有用户过度广泛访问，甚至是在没有基本用户权限的情况下允许任何匿名人员访问，而这些人员不受身份访问管理系统控制。”

本书后面，我将向您展示如何使用工具和技术进行涉及未经授权访问云存储的渗透测试。

## 完整性

让我们来看看针对云数据完整性的网络攻击。以下是*Ravie Lakshmanan*在*The Hacker News*上报道的一个故事（[`thehackernews.com/2023/03/large-scale-cyber-attack-hijacks-east.html`](https://thehackernews.com/2023/03/large-scale-cyber-attack-hijacks-east.html)），内容涉及针对成人娱乐网站的攻击：

“自 2022 年 9 月初以来，一场大规模的恶意网络行动劫持了数千个面向东亚观众的网站，将访问者重定向到成人内容。这场持续的攻击活动涉及将恶意 JavaScript 代码注入到被黑的网站中，通常通过合法的 FTP 凭据连接到目标网页服务器，而这些凭据是攻击者通过未知方式先前获得的。‘在许多情况下，这些是高度安全的自动生成的 FTP 凭据，攻击者不知怎的获取并利用它们进行网站劫持，’Wiz 在本月发布的一份报告中表示。云安全公司指出，尽管被攻陷的网站——包括小型公司和跨国公司所有的网站——使用了不同的技术栈和托管服务提供商，但很难追踪到一个共同的攻击途径。”

作为云渗透测试员，你可能需要进行一项渗透测试，涉及向在多云环境中运行的 Web 应用程序注入恶意代码。这是非常狡猾的攻击者可能会成功的攻击方式，并且需要非常熟练的云渗透测试员才能模拟。

完整性攻击可能包括恶意代码注入、中间人攻击或恶意获取用户和机器身份，如**传输层安全性**（**TLS**）证书。

TLS

TLS 证书用于授予用户和机器访问使用 TLS 加密的服务的权限，例如通过 HTTPS 协议部署的加密 Web 应用程序。

## 可用性

最后，还有针对云数据可用性的攻击。

2022 年 8 月，Google Cloud 官方博客报道了他们检测到的有史以来最大的一次 DDoS 攻击，目标是他们的一个 GCP 服务。

这位企业客户使用的是`Google Cloud Armor`。Google Cloud Armor 是一项网络安全服务，GCP 客户（如企业）可以使用它来保护托管在 GCP 上的应用程序和网络免受一些常见的安全漏洞攻击。Google Cloud Armor 旨在检测和防止的一些常见攻击包括 DDoS 攻击、**跨站脚本**（**XSS**）攻击和 SQL 注入攻击。

本书稍后会介绍 XSS 和 SQL 注入攻击，但这里我们先讨论 DDoS 攻击。

什么是 DDoS 攻击？

DDoS 攻击是指网络攻击者利用分布式计算机集合向网络目标发送超出其承载能力的数据，造成目标无法处理。通过向目标发送大量数据，攻击者可能使其崩溃或暂时下线。Web 服务器和云实例是 DDoS 攻击中最常见的目标之一。

大多数 DDoS 攻击都是通过僵尸网络进行的。僵尸网络是由网络攻击者通过指挥与控制服务器控制的计算机网络，用于执行网络攻击。计算机感染了僵尸恶意软件，使其可被攻击者控制，并成为僵尸网络的一部分。个人计算机、移动设备、服务器和网络设备（如路由器）通常会被僵尸恶意软件感染，并用于组成僵尸网络。一个普通人的手机也可能成为僵尸网络的一部分，而他们自己却毫不知情！

当攻击者能够利用他们的僵尸网络中大量设备的一点计算能力时，他们可以执行更具破坏性的网络攻击。在一个由僵尸网络驱动的 DDoS 攻击中，成千上万的设备可以被同步，向一个网络攻击目标发起大量数据包，压垮目标。

这次 DDoS 攻击并没有直接针对 Google Cloud Armor。相反，Google Cloud Armor 能够检测到这次 DDoS 攻击。该事件在官方的 Google Cloud 博客中有报道 ([`cloud.google.com/blog/products/identity-security/how-google-cloud-blocked-largest-layer-7-ddos-attack-at-46-million-rps`](https://cloud.google.com/blog/products/identity-security/how-google-cloud-blocked-largest-layer-7-ddos-attack-at-46-million-rps))，如下所示：

“2022 年 6 月 1 日，一位 Google Cloud Armor 的客户遭遇了一系列 HTTPS DDoS 攻击，峰值达到了每秒 4600 万个请求。这是迄今为止报告的最大 Layer 7 DDoS 攻击——比之前报告的记录大至少 76%。为了更好地理解攻击的规模，可以想象这相当于在 10 秒钟内接收到 Wikipedia（全球排名前十的流量网站）所有的日请求量。”

Cloud Armor 自适应保护能够在攻击生命周期的早期检测并分析流量。Cloud Armor 向客户发出了推荐的防护规则提示，并在攻击扩大到全规模之前部署了该规则。Cloud Armor 阻止了这次攻击，确保了客户的服务保持在线，并继续为终端用户提供服务。

很高兴看到 Google Cloud Armor 能够缓解如此大规模的 DDoS 攻击，保护了客户的 GCP 托管服务器。作为一名云渗透测试员，你可能会面临绕过 Google Cloud Armor 的挑战！

所有的网络攻击都会影响 CIA 三原则中的至少一个部分——机密性、完整性或可用性。机密性是指保护数据不被未授权访问。完整性是确保只有授权用户和实体才能更改数据。而可用性则是确保授权用户在需要时能够访问数据。有些攻击可能会影响 CIA 三原则中的多个部分，例如勒索软件（影响可用性）同时也可能侵犯公众数据（影响机密性）。

# 理解云中的横向移动

针对云应用程序的网络攻击可以是外部的，也可以是内部的。它们可能会影响数据的机密性、完整性和可用性。以下是一些需要了解的云网络攻击概念。

针对复杂企业系统（如云网络）的网络攻击很少是简单的。攻击不仅仅是突破、进入和离开。许多攻击会首先攻击复杂系统的一个部分，然后转向系统的其他部分。

一个云网络可以包含多个云平台（如 AWS、Azure 和 GCP），每个平台上都有多个不同的服务和应用程序。它们还可能通过像 Docker 和 Kubernetes 这样的编排平台包含多个容器化系统，在每个容器中集成众多服务和应用程序。云网络的所有组件可以通过共享凭据（如加密密钥和机器身份，诸如 TLS 证书）相互通信。

作为一名云渗透测试员，你可能会被要求模拟这些更复杂的横向利用技术。

MITRE ATT&CK 为横向移动利用定义了一个完整的类别。它主要是关于攻击者如何在计算机系统内部移动。攻击者可能在同一云平台的不同实体之间移动，也可能在不同的云平台之间移动，甚至如果你的组织拥有多云网络，攻击者可能会从一个云平台上的服务移动到另一个云平台。

这是 MITRE ATT&CK 的横向移动利用列表。

## 远程服务的利用

由于云网络通常包含多个地理位置的实体，这可能成为常见的云网络攻击技术。对于网络而言，“内部”和“外部”是指访问控制，而不是指物理位置本身。如果一个混合多云网络有一个本地位置，并且在世界不同地方的 AWS、Azure 和 GCP 数据中心拥有组件，只要配置了访问控制，禁止公众访问，它们都属于内部网络的一部分。

MITRE ATT&CK 将远程服务的利用定义为：[`attack.mitre.org/tactics/TA0008/`](https://attack.mitre.org/tactics/TA0008/)：

“对手可能会利用远程服务，在进入网络后获得对内部系统的未经授权的访问权限。软件漏洞的利用发生在对手利用程序、服务、操作系统软件或内核本身中的编程错误来执行对手控制的代码时。”

## 内部鱼叉式钓鱼

在钓鱼攻击中，对手通过复制其网站、电子邮件、短信或社交媒体通信，伪装成可信任的实体。钓鱼攻击可以是随机的。例如，我曾收到过一个攻击者伪装成一家我没有账户的加拿大大银行的钓鱼短信。攻击者只知道我在加拿大，而加拿大只有少数几家大银行，每家银行的客户超过五百万。我的信息并没有被特别针对；攻击者向大量加拿大人发送钓鱼短信，希望有些拥有该银行账户的人会上当。

鱼叉式钓鱼与此不同。鱼叉式钓鱼攻击针对特定的个人或实体。例如，可能会有一个特定的个人，攻击者试图突破该人的公司防线。他们可以在 LinkedIn 上查找该人的信息，然后伪装成该人 LinkedIn 上的一个联系人。

MITRE ATT&CK 将内部鱼叉式钓鱼攻击 ([`attack.mitre.org/tactics/TA0008/`](https://attack.mitre.org/tactics/TA0008/)) 定义如下：

“对手可能会利用内部鱼叉式钓鱼攻击，在已经获得该环境中的账户或系统访问权限后，获取更多信息或攻击同一组织中的其他用户。内部鱼叉式钓鱼是一种多阶段的攻击活动，其中电子邮件账户通过控制用户设备（先前安装的恶意软件）或通过破解用户账户凭证来被掌控。对手尝试利用受信任的内部账户，提高欺骗目标的可能性，以使其上当。”

## 横向工具传输

在云网络中，多个应用程序和服务可以互相连接。这些应用程序本身拥有相互之间的特权访问权限。攻击者可以利用这些连接和特权，在网络内进行横向移动。

MITRE ATT&CK 将横向工具传输 ([`attack.mitre.org/techniques/T1570/`](https://attack.mitre.org/techniques/T1570/)) 定义如下：

“对手可能会在被攻陷的环境中，在系统之间传输工具或其他文件。一旦将文件引入受害环境（即入口工具传输），这些文件就可以从一个系统复制到另一个系统，用于在操作过程中准备对手的工具或其他文件。对手可能会在受害者的内部系统之间复制文件，利用内建的文件共享协议（例如通过 SMB/Windows 管理共享到连接的网络共享，或通过远程桌面协议的身份验证连接）来支持横向移动。”

## 远程服务会话劫持

云网络和应用充满了旨在远程访问的服务。远程服务会话劫持可以帮助攻击者在容器化编排中的不同节点之间、在同一云服务中的不同会话之间、以及在共享凭证的不同云服务之间移动——即使它们使用的是不同的云平台！例如，可以劫持 GCP 中的 App Engine、Azure 中的 App Service 和 AWS 中的 Amazon EC2 之间的远程会话。当然，通过适当的安全配置，应用程序和平台之间可以防止这种漏洞。

MITRE ATT&CK 将远程服务会话劫持定义为如下：[`attack.mitre.org/tactics/TA0008/`](https://attack.mitre.org/tactics/TA0008/)

“对手可能会接管与远程服务的现有会话，以在环境中横向移动。用户可能使用有效的凭证登录到专门设计用于接受远程连接的服务，如 telnet、SSH 和 RDP。”

## 软件部署工具

这类似于远程服务会话劫持，但目标不是远程会话，而是受信任的第三方管理工具。作为云渗透测试人员，你可能需要模拟很多不同类型的劫持技术。

MITRE ATT&CK 将软件部署工具定义为如下：[`attack.mitre.org/techniques/T1195/001/`](https://attack.mitre.org/techniques/T1195/001/)

“对手可能会访问并使用企业网络中安装的第三方软件套件，如管理、监控和部署系统，横向移动通过网络。”

## 污染的共享内容

想想云应用中使用的共享存储量有多大！在保护云网络时，必须仔细监控和保护每一项数据资产。

MITRE ATT&CK 将污染的共享内容定义为如下：[`attack.mitre.org/tactics/TA0008/`](https://attack.mitre.org/tactics/TA0008/)

“对手可能通过向共享存储位置（如网络驱动器或内部代码库）添加内容，将有效负载传递给远程系统。存储在网络驱动器或其他共享位置的内容可能会因添加恶意程序、脚本或利用代码到本应有效的文件中而被污染。”

云应用和网络比传统应用和网络更为复杂。你的组织在一个云平台上，或者多个云平台上。每个云平台可能会实施多个不同的服务。可能还会有一个本地网络组件。一个容器化的应用可能有许多虚拟化的容器，每个容器可能在几天内生死循环。可能有成百上千个用户账户，更多的是机器身份。攻击者有很多不同的攻击向量。你可能需要在红队任务中模拟对这些复杂向量的攻击。

# 零信任网络

在云服务普及之前，企业的网络仅存在于自己场所内。在 1990 年代和 2000 年代初，网络安全范式完全是围绕周界展开的。

不同的网络段可能具有不同级别的安全性，但内部网络及其所有段落都被包含在一个严密防守的周界内。有时，外部流量会被允许进入内部网络，但必须通过身份验证和授权的向量。但是，一旦突破了这个周界，用户就可以在内部网络中自由活动，无需再次验证凭证。所有用户要么被信任，要么不被信任，存在于周界内部意味着自动信任。可以想象成一个有着严格边境的国家，但国内几乎没有警察存在。

旧有的周界网络安全模型已经过时多年了，原因有很多。

首先，周界安全模型并不是非常具有韧性或健壮性。网络攻击者有时会突破身份验证障碍。因此，如果他们突破了周界，通常不会再有其他的身份验证障碍需要突破。这就像银行抢劫犯挑衅银行：“你们的安全必须每次都成功，但我只需要成功一次！”

其次，周界安全模型完全无法与今天更为复杂的云网络兼容。即使有人愿意尝试，周界安全模型也无法应用于云网络。最简单的企业云网络包括几个本地的 PC 端点，并通过互联网连接到一个云平台上的云服务。而最复杂的混合多云网络则包括多个公司自有地点的本地网络和端点，远程员工和承包商在家中工作，多个云服务（如 AWS、Azure 和 GCP），以及每个云平台上多个 SaaS、PaaS 和 IaaS 服务和应用。无论哪种方式，用户都必须通过互联网连接到他们的内部企业网络。

零信任安全意味着没有任何用户或机器会自动被信任。周界安全网络会自动信任周界内部的用户。但是在云网络和互联网中，是没有周界的。因此，身份验证和授权的向量与检查会尽可能多地在网络的各个地方实现。不管你来自哪里，访问这个组件时，你必须出示你的身份！

攻击者需要攻破多个身份验证点才能在企业云网络中横行。拥有多个身份验证点可以显著减少成功发动网络攻击的可能性。然而，如果攻击者成功获取了凭证，进入云网络可能会变得毫不费力。掌握这些细节对任何参与云渗透测试的人来说都至关重要。

本书后续章节将深入探讨一些最流行的 AWS、Azure 和 GCP 应用程序与服务。我们还将介绍虚拟化和容器化在云网络中的实现方式。同时，我们将探索在云红队演习中将使用的各种工具、技术和策略。

# 总结

我们进行渗透测试的原因是通过模拟网络攻击来了解计算机系统中的安全漏洞。

云网络中可能有数百或数千种潜在的网络攻击路径，包括内部和外部的。用户、用户帐户、机器身份以及面向互联网的应用程序中的漏洞，都是其中的一部分可能性。

您可能无法模拟所有可能的漏洞攻击。例如，云服务提供商通常禁止模拟 DDoS 攻击，并且您也不能亲自访问云服务提供商的数据中心安装测试设备。但了解攻击者可能采取的所有不同方法，并在进行红队演习时牢记这一点，仍然是非常重要的。

攻击可以来源于组织内部或外部。网络安全的 CIA 三维模型是一个概念，用来解释网络攻击如何在机密性、完整性和可用性方面影响组织的数据。

随着云网络的普及和网络技术的进步，我们现在通过零信任安全来保护计算机网络。这意味着用户和应用程序会在网络的尽可能多的点进行身份验证，不论用户的来源是网络内部还是外部。

在下一章中，我们将探讨渗透测试云网络的关键概念。

# 进一步阅读

要了解本章涉及的更多内容，您可以访问以下链接：

+   *MITRE* *ATT&CK*: [`attack.mitre.org/`](https://attack.mitre.org/)

)

+   *DDoS* *僵尸网络*: [`www.cloudflare.com/learning/ddos/what-is-a-ddos-botnet/`](https://www.cloudflare.com/learning/ddos/what-is-a-ddos-botnet/)

)

+   *零信任安全与* *云计算*: [`www.paloaltonetworks.com/cyberpedia/what-is-a-zero-trust-for-the-cloud`](https://www.paloaltonetworks.com/cyberpedia/what-is-a-zero-trust-for-the-cloud)
