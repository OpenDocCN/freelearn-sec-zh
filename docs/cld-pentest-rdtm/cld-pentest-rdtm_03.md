

# 第三章：渗透测试当今云网络的关键概念

在进行第一次云渗透测试或红队任务之前，您需要学习一些概念。

云平台有针对渗透测试的政策，您和您的组织必须遵守。了解并通过基准检查验证网络性能也非常重要。服务枚举是攻击者了解您组织的公共云服务的一种方式，可以帮助他们发起网络攻击。

确保您的组织的公共云已进行漏洞评估，并在渗透测试前处理了常见的云配置错误。

MITRE 的**常见漏洞和暴露**（**CVE**）数据库、**国家标准与技术研究院**（**NIST**）的**国家漏洞数据库**（**NVD**）和**事件响应与安全团队论坛**（**FIRST**）的**漏洞预测评分系统**（**EPSS**）数据库提供的资源可以帮助渗透测试人员和红队成员定义并理解特定的已知漏洞。

您还必须了解如何有效地与组织的防御安全专家沟通与合作。

本章将介绍以下主要主题：

+   云平台政策、基准检查与服务枚举

+   暴露的服务、权限和集成

+   CVE、**常见漏洞评分系统**（**CVSS**）和漏洞

+   紫队合作与编写渗透测试报告

让我们开始吧！

# 云平台政策、基准检查与服务枚举

在公共云平台上进行云网络渗透测试与在您组织自有场地和基础设施上进行渗透测试有根本性的不同。

如果您的组织拥有场地和基础设施，那么它有权决定在渗透测试中允许和禁止您对其网络进行的所有操作。如果我购买了一栋房子，只要我所在的市政和国家的法律没有禁止，我可以允许建筑承包商更换墙壁、重做屋顶、安装新门等等。

如果我从房东那里租房子，我就不拥有房子。如果我想支付建筑承包商对房屋进行类似修改，我需要房东的许可。

在`Amazon Web Services`（**AWS**）、Azure 和`Google Cloud Platform`（**GCP**）上，您的组织是从“房东”——Amazon、Microsoft 或 Google 租用其“房子”。Amazon、Microsoft 和 Google 制定了渗透测试人员可以做的事情的规则。

如果您所在的组织要求您在其 AWS、Azure 和 GCP 托管的网络上做一些 Amazon、Microsoft 和 Google 在其政策中禁止的事情，您绝对不应该去做。定位云服务提供商的渗透测试政策，并在各自的网站上查看这些政策，向您的雇主分享这些信息，以明确进行渗透测试的任何限制或限制是非常重要的。我们在这里列出了它们：

+   *AWS 客户支持渗透测试* *政策*: [`aws.amazon.com/security/penetration-testing/`](https://aws.amazon.com/security/penetration-testing/)

)

+   *Amazon EC2 测试* *政策*: [`aws.amazon.com/ec2/testing/`](https://aws.amazon.com/ec2/testing/)

)

+   *AWS DDoS 模拟测试* *政策*: [`aws.amazon.com/security/ddos-simulation-testing/`](https://aws.amazon.com/security/ddos-simulation-testing/)

)

+   *Microsoft 在线订阅* *协议*: [`azure.microsoft.com/en-us/support/legal/subscription-agreement/`](https://azure.microsoft.com/en-us/support/legal/subscription-agreement/)

)

+   *Microsoft 云渗透测试参与规则* *指南*: [`www.microsoft.com/en-us/msrc/pentest-rules-of-engagement`](https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement)

)

+   *Google 云平台服务条款*: [`cloud.google.com/terms/`](https://cloud.google.com/terms/)

)

+   *Google 云平台可接受使用* *政策*: [`cloud.google.com/terms/aup`](https://cloud.google.com/terms/aup)

)

在组织提出公共云网络的渗透测试或红队参与之前，我建议仔细阅读云服务提供商的政策。然后，阅读你所在组织的提案和渗透测试范围，确保你被要求执行的任务符合 Amazon、Microsoft 或 Google 的政策。根据你组织要求的内容，你可能只需要对你的测试范围和模拟网络攻击进行一些小的调整，以符合政策要求。

我在*第一章*中提到过 AWS、Azure 和 GCP 的渗透测试政策。但为了你的参考，以下是官方政策链接以及每项政策的简要总结。这足以证明它们的重要性！

+   `AWS`: 大多数 AWS 服务允许进行一般渗透测试。禁止在 Route 53 上进行 DNS 区域遍历、DNS 劫持和 DNS 欺骗。大多数**拒绝服务**（**DoS**）和**分布式拒绝服务**（**DDoS**）模拟是禁止的。协议洪泛和请求洪泛也是禁止的。使用**命令与控制**（**C2**）服务器进行渗透测试需要获得 Amazon 的直接批准。你还需要向 Amazon 请求批准网络压力测试、使用 iPerf 工具、模拟钓鱼和在渗透测试中使用恶意软件的许可。详情请见 [`aws.amazon.com/security/penetration-testing/`](https://aws.amazon.com/security/penetration-testing/)。

+   **Azure 和微软云整体**：大多数未经授权的渗透测试是允许的。然而，扫描和测试其他客户的资产并访问其数据是被禁止的。生成过多流量的自动化测试是禁止的。所有的 DoS 和 DDoS 模拟都是禁止的。针对除您组织自有 Azure 虚拟机外的任何设备进行网络密集型模糊测试是禁止的。超越**概念验证**（**PoC**）执行基础设施问题的步骤是禁止的。尝试对微软员工进行社交工程攻击是禁止的。

+   `GCP`：对您的组织使用的 GCP 基础设施进行渗透测试必须遵循 Google 的可接受使用政策（[`cloud.google.com/terms/aup`](https://cloud.google.com/terms/aup) 和 [`cloud.google.com/terms/`](https://cloud.google.com/terms/)）。

现在，让我们进入基准检查的内容！

基准被定义为用来衡量性能的标准。您的组织可能对其公共云网络在日常或每小时的表现有一定的期望。在云环境中，基准通常基于应用程序和服务器的可用性，定义为正常运行时间、应用程序的响应性、以及修复网络功能问题可能需要的时间。

如果您的组织希望对其公共云网络进行基准测试，我建议将其基于 AWS、Azure 或 GCP 的**服务水平协议**（**SLA**）。这些是云服务提供商在您注册其服务时，保证您的组织所遵循的网络和基础设施性能标准。

对于 AWS 服务，亚马逊保证一定的每月正常运行时间。如果未达到这些基准，您的组织可能有权获得 10%、25%或 100%的服务信用。

对于 Azure 和微软在线服务，整体上它们的 SLA 与 AWS 在概念上类似。如果某些每月正常运行时间的基准未达到，您的组织可能有权获得 10%、25%或 100%的服务信用。微软的 SLA 每年至少更新几次。

对于 GCP 服务，其 SLA 也类似。但通常，如果未满足正常运行时间的基准，它们会提供 10%、25%或 50%的服务信用。

除了针对正常运行时间进行基准测试外，您的组织可能还希望对其公共云网络进行安全性基准测试。**互联网安全中心**（**CIS**）为 AWS、Azure 和 GCP 提供了一套网络安全基准，如下所示：

+   [`www.cisecurity.org/benchmark/amazon_web_services`](https://www.cisecurity.org/benchmark/amazon_web_services)

+   [`www.cisecurity.org/benchmark/azure`](https://www.cisecurity.org/benchmark/azure)

+   [`www.cisecurity.org/benchmark/google_cloud_computing_platform`](https://www.cisecurity.org/benchmark/google_cloud_computing_platform)

枚举云服务是一种外部人员确定你组织所使用的云服务、它们的使用方式、权限以及每个服务对应的访问令牌的方法。

MITRE ATT&CK 将云枚举定义如下（[`attack.mitre.org/techniques/T1526/`](https://attack.mitre.org/techniques/T1526/)）：

“在获得访问权限后，攻击者可能会尝试枚举系统中运行的云服务。这些方法可以从平台即服务（PaaS）到基础设施即服务（IaaS）或软件即服务（SaaS）有所不同。许多服务存在于不同的云提供商中，可能包括持续集成与持续交付（CI/CD）、Lambda 函数、Azure AD 等。

攻击者可能会尝试发现整个环境中启用的服务信息。Azure 工具和 API，如 Azure AD Graph API 和 Azure 资源管理器 API，可以枚举资源和服务，包括应用程序、管理组、资源、政策定义及其与身份的关系。”

现在，让我们来看看一些公共云服务中常见的安全问题。

# 曝露的服务、权限和集成

每个网络在进行渗透测试前都应该进行漏洞评估。确保你进行渗透测试的云网络所属的组织近期已经进行过漏洞评估。

漏洞评估（有时称为漏洞审计）是一个系统化的过程，使用检查清单来识别与某种计算机系统相关的常见安全弱点、配置错误和其他漏洞。漏洞评估是一个识别、分析和优先处理系统、网络或应用程序中漏洞的系统化过程。它涉及扫描系统以识别现有的弱点、缺陷或可能被攻击者利用的漏洞。传统的漏洞评估可能会让一位人工网络安全专家使用特定操作系统或应用程序中常见漏洞的手动列表，检查软件、硬件和网络设置与配置，确保其中没有任何项使得计算机系统更容易受到网络攻击。这项工作可能繁琐，但在 20 世纪的本地网络中是相对实用的，因为这些网络变化不大。

但 21 世纪的云网络变化非常频繁。尤其是在像 Kubernetes 和 Docker 等平台上，容器化的环境中，单个容器（虚拟化应用程序或操作系统）可能只存在几天。现代云网络还可能更加复杂，涉及更多种类的应用程序和服务。多云、混合云和混合多云环境尤其可能非常多样化和复杂。

因此，在云网络中进行传统的手动漏洞评估通常是不切实际的。几个人无法跟上云漏洞评估所需要做的所有工作。这就是为什么我们在云中使用自动化漏洞扫描器的原因。

你可以使用多种不同的云漏洞扫描器。

AWS 有自己的 Amazon Inspector ([`aws.amazon.com/inspector/`](https://aws.amazon.com/inspector/))。微软推荐用于 Azure 的 Microsoft Defender for Cloud ([`www.microsoft.com/en-ca/security/business/cloud-security/microsoft-defender-cloud`](https://www.microsoft.com/en-ca/security/business/cloud-security/microsoft-defender-cloud))（这是 Microsoft Defender for Servers 的一部分）。谷歌推荐使用快速漏洞检测（Rapid Vulnerability Detection）（[`cloud.google.com/security-command-center/docs/concepts-rapid-vulnerability-detection-overview`](https://cloud.google.com/security-command-center/docs/concepts-rapid-vulnerability-detection-overview)），对于 GCP，则取决于你的组织订阅了哪些服务层级以及使用了哪些 GCP 服务。

如果符合你的需求，您还可以使用一些第三方漏洞扫描器。最受欢迎的一些包括 Astra Pentest、Qualys Cloud Platform 和 Aqua Security。

信息

Astra Pentest 自动化漏洞扫描，并拥有一些工具来自动化部分渗透测试工作，但它不应取代你作为云渗透测试员的工作。

在开始你的第一次云渗透测试之前，确保你的组织最近使用了一些云漏洞扫描器。确保它已修复或解决了扫描器检测到的问题，并确保你能看到最近漏洞扫描的结果。这样做的原因是，如果你的组织的云网络中存在大量常见的漏洞，且这些漏洞可以被漏洞扫描器检测到，那么你的渗透测试可能会变得毫无意义。

本节内容涉及一些最常见的云安全问题——暴露的服务、权限问题（无效的**身份与访问管理**，或**IAM**）以及配置不当的云集成。在进行渗透测试之前，尽可能修复这些问题！

首先，让我们来检查暴露的服务。

## 暴露的服务

暴露的服务是指在你的云网络中，未受授权访问保护的服务。想想你可以在云端和互联网上找到的各种服务和协议——HTTPS 网络服务器、FTP 文件服务器、SSH 加密的远程访问服务器、RDP Windows 远程访问服务、SMB 服务（如 Samba）——这类服务不胜枚举。你的云网络中的所有这些潜在通道应该具有强大的认证保护，并且应该通过云网络的日志进行良好的监控。从你的云网络到公共互联网的这些连接通常是网络攻击者入侵的便捷途径。

云漏洞扫描器通常非常擅长发现你云网络中可能存在的暴露服务，因此你可以通过改善服务的加密和认证访问来修复这个问题，或者如果组织不使用该服务，干脆禁用它。

另一种发现暴露服务的方法是使用 Shodan。Shodan 提供月费服务计划，可以持续监控并扫描你的云网络 IP 地址，以查找暴露的服务。

安全研究人员研究了云网络中暴露服务带来的巨大问题。2021 年，Palo Alto Networks 的 Unit 42 进行了一个研究项目。它在云网络中部署了 320 个蜜罐。蜜罐是故意设计为不安全的计算机或服务器，目的是吸引网络威胁行为者进行攻击。使用蜜罐的目的通常是转移攻击者对组织必须保持安全的服务器的注意力，并监控网络攻击活动以更好地理解攻击行为。

Unit 42 部署的 320 个蜜罐使用了 SSH、Samba、Postgres 和 RDP 的组合。它为每个蜜罐设置了非常弱的凭据，例如“**用户名: admin**，**密码: admin**”，并监控蜜罐，看看它们会被攻击多少次。所有的蜜罐在不到两天的时间内都遭到了攻击。一些蜜罐在部署后的 30 秒内就被攻击！大多数蜜罐每天都会被攻击多次；攻击最频繁的蜜罐在一天内被攻破了 169 次。

这就是为什么你的组织必须非常小心，避免在云网络中暴露任何服务。暴露的服务可能会让你的云网络容易受到各种网络攻击，其中之一就是数据泄露。根据 IBM 2023 年《数据泄露成本报告》([`www.ibm.com/reports/data-breach`](https://www.ibm.com/reports/data-breach))，数据泄露每次事件平均会让一个组织损失 435 万美元！而这仅仅是暴露的服务可能遭遇的多种网络攻击中的一种。

现在让我们来探讨云中的权限和身份与访问管理（IAM）。

## 权限

在一个安全的计算机系统中，所有的数据资产只有授权的用户和实体才能访问。根据 Gartner 的定义（[`www.gartner.com/en/information-technology/glossary/identity-and-access-management-iam`](https://www.gartner.com/en/information-technology/glossary/identity-and-access-management-iam)），IAM 是“*一项安全和商业学科，包含多种技术和业务流程，帮助合适的人或机器在合适的时间以合适的理由访问合适的资产。*”每个至少获得一些计算机系统访问权限的实体都需要一个身份和身份验证方式，如密码、生物识别和访问令牌。

权限是用户在计算机系统中允许执行的操作。例如，在我个人的笔记本电脑上，我在我的 Windows 11 安装中拥有完全的管理员权限。我可以安装、卸载和配置所有应用程序。我可以创建任意数量的用户账户并给予他们任何权限。我可以更改 Windows 注册表。我可以更改所有 Windows 设置。我可以读取、写入并访问我数据存储中所有的文件系统内容。但是，当我登录到我雇主的云网络时，我的权限要有限得多。我只能访问我工作所需的应用程序。我不能创建新的用户账户。我只能访问在公司角色中所需的数据。这是因为我拥有我的笔记本电脑，但我不拥有我雇主的云网络。与许多具备良好网络安全的网络一样，我雇主的云网络使用了**基于角色的访问控制**（**RBAC**）系统。

在 RBAC 中，权限分配给文件系统中的用户组。这些组与用户在公司中的角色相关联。可能会有一个工资部门组，该组可以访问公司的工资服务器和应用程序；一个研发组，该组可以访问公司的研发数据；一个网站管理员组，该组可以对公司的网站服务器进行更改，等等。权限不是直接分配给用户的，而是分配给组的。这是一种更简化的访问控制系统，避免了逐个用户管理权限的繁琐。

**强制访问控制**（**MAC**）是最严格的访问控制模型。系统中的资源对象可以根据保密等级（如高、中、低）以及部门和特定项目的类别进行分配。然后，针对每个用户，这些对象的权限会被非常仔细地配置。维护这种访问控制模型可能是繁琐的，这也是为什么 MAC 通常用于处理高度机密数据的应用场景，例如政府机构。

在**自主访问控制**（**DAC**）中，用户为他们创建的数据对象分配权限。这是 Windows 操作系统以及其他用户自己拥有的计算机上的本地操作系统中的默认访问控制系统。

主要的云服务提供商都有自己的工具，供你的组织用来改善 IAM。

亚马逊推荐使用其自家的 AWS 身份与访问管理（IAM）来管理 AWS。你可以使用它来管理**基于属性的访问控制**（**ABAC**），这与 RBAC 类似。你还可以使用它来实施防护措施，以防止特权提升攻击和未经授权的用户账户访问。你还可以跨单一或多个 AWS 账户管理用户和机器身份。

微软推荐其自家的 Microsoft Entra ID（前身为 Azure Active Directory）用于 Azure，它类似于 Windows Server 中的 Active Directory。Azure Active Directory 的优势在于它还能够在多云和混合云环境中控制身份和访问管理（IAM）。举例来说，如果你的组织有一个混合云，且本地网络中有一些 Windows Server 机器，那么从本地到公有云的所有 IAM 都可以通过相同的 Active Directory 系统进行统一管理。

谷歌也有自己的 GCP IAM。它的一些关键功能包括自动化访问控制建议、灵活的角色和基于上下文的访问控制。

渗透测试可以用来确保组织云网络中的 IAM 配置正确。这包括只为每个用户分配必要的权限（**最小权限原则**，或**PoLP**），并确保用户拥有强密码和多重认证（如一次性密码、多因素认证应用程序、生物识别和访问令牌）。

现在，让我们来看看云集成。配置和部署云集成时，确保其安全性至关重要，因为不安全的集成是云安全中常见的问题。

## 云集成

云集成的核心就是将多个云网络连接在一起。在混合云网络中，集成还意味着将本地服务器与云网络连接起来。除非你的组织只有本地端点和一个公有云，否则云集成是不可避免的。

云集成中的安全问题通常发生在网络可见性差、安全解决方案在云平台间不兼容，或者云应用之间的 API 安全性差时。

你的组织无法保护它无法看到的东西。因此，网络可见性差意味着你的混合云或多云网络中的某些部分可能存在安全漏洞，而你的组织对此并不知情。为了解决这个问题，至关重要的是尽可能多地记录应用程序和服务，并确保安全监控解决方案在你的集成云环境中兼容且部署到位。

集成云应用程序和服务之间的 API 如果没有得到充分保护，特别容易受到代码注入（如 SQL 注入、命令注入）和查询注入攻击的影响，以及利用不当的访问控制和过时组件的恶意请求。正如消除暴露服务是明智的做法，消除暴露的 API 也是明智的做法。

漏洞扫描器可能无法检测到可见性问题，但一些漏洞扫描器擅长检测不安全的 API。

可见性问题可以通过使用数据映射解决方案来减轻，以保持全面的数据资产清单。对于你的多云或混合云环境，拥有强大的日志记录也是至关重要的，并且需要将这些日志输入到安全监控应用程序中。

现在，让我们来探讨一下作为云渗透测试员，你的工作应该发现什么——安全漏洞！

# CVE、CVSS 和漏洞

在网络安全中，我们有正式的系统来分类网络和应用程序中的安全漏洞。已知的漏洞记录在 MITRE 的公共漏洞和暴露（CVE）数据库中，简称 CVE（[`www.cve.org/`](https://www.cve.org/)）。CVE 记录根据 MITRE 的 CVSS（[`nvd.nist.gov/vuln-metrics/cvss`](https://nvd.nist.gov/vuln-metrics/cvss)）进行分类。此外，已知的漏洞利用会通过 EPSS（[`www.first.org/epss/`](https://www.first.org/epss/)）进行分类。MITRE ATT&CK 是一个用于分类已知计算机系统和网络漏洞利用的数据库（[`attack.mitre.org/`](https://attack.mitre.org/)）。

因此，MITRE 是一个帮助各种网络安全专业人士理解漏洞和漏洞利用的组织。MITRE 数据库中的知识每天都在不断增长。MITRE 的数据库通过网络公开，任何人都可以作为参考使用。作为一名云渗透测试员，你的工作是发现你测试的云网络中的漏洞和漏洞利用，以便你工作的组织可以更好地了解如何提高其网络和应用程序的安全性。让我们深入了解 MITRE 及其如何维护对渗透测试员和红队人员有用的知识。

## 漏洞

漏洞是计算机系统中的错误、缺陷或失误，网络攻击者可以利用它来危害组织的数据。例如，如果某个公众用户能够通过点击按钮访问你组织的云平台托管的电子商务应用程序中的客户信用卡号码，那绝对是一个重大的安全漏洞。这将是对敏感数据机密性的漏洞，符合网络安全中的 CIA 三原则。

如果网络安全社区没有人知道某个漏洞，而网络犯罪分子在网络攻击中利用了它，我们称之为零日漏洞。如果我们幸运的话，安全研究人员或漏洞奖励猎人在网络攻击者利用该漏洞之前发现了这个以前未知的漏洞，这也是零日漏洞。如果某个漏洞已记录在 MITRE 的 CVE 数据库中，那么它就不是零日漏洞，而是已知漏洞。

漏洞利用是一种用来进行网络攻击的方法或技术。例如，这里有一个 MITRE ATT&CK 数据库中关于 FTP 漏洞利用的描述（[`attack.mitre.org/techniques/T1071/002/`](https://attack.mitre.org/techniques/T1071/002/)）：

“*对手可能通过使用与传输文件相关的应用层协议进行通信，以避免检测/网络过滤，通过与现有流量融合来掩盖自己。远程系统的命令，通常也包括这些命令的结果，将嵌入客户端* *和服务器* 之间的协议流量中。*

*像 FTP、FTPS 和 TFTP 这样的文件传输协议在某些环境中可能非常常见。由这些协议生成的数据包可能包含许多字段和头部，其中数据可能被* *隐藏。*”

当你为你的组织进行云渗透测试时，你可能会在其云网络中发现许多存在于 MITRE CVE 数据库中的漏洞。你可能会发现一个零日漏洞，但这很少见！通常，零日漏洞是由漏洞奖励猎人发现的，或者是由防御性安全专家在网络攻击者利用该漏洞后发现的。如果你作为红队成员或渗透测试员从未发现过零日漏洞，不要太苛责自己。你的工作是发现组织计算机系统中的漏洞，这些漏洞大多数时候是网络安全社区已知的。

特别是作为红队成员，你可能会根据 MITRE ATT&CK 中的内容模拟网络攻击。

因此，查找 MITRE 数据库中的信息肯定是你工作的一部分，你会经常做这个。

让我们了解 MITRE 作为一个组织，以及它如何为公众维护网络安全信息。

## MITRE 数据库

MITRE 成立于 1958 年，是一个私立非营利组织，与美国空军合作。在云网络和互联网成为日常生活一部分的几十年前，MITRE 通过诸如**联邦航空管理局**（**FAA**）等部门与美国政府合作，开发空中交通管制系统，并在计算机编程和数据处理等领域进行研究和开发。在 1990 年代，MITRE 帮助美国政府准备“Y2K 问题”。 “Y2K 问题”是全球许多计算机系统面临的问题。许多数据库、应用程序和操作系统在计算机时间戳和时间保持中只有两个字符来表示年份。因此，当 2000 年到来时，这些系统可能会认为是 1900 年，从而引起严重的操作问题。许多组织，包括 MITRE 在内，努力修复了“Y2K 问题”。这就是为什么当 2000 年终于到来时，并没有出现太多问题。

MITRE 于 1999 年启动了其 CVE 数据库。当年仅记录了 321 个漏洞。然而，CVE 数据库不仅每年添加了更多的漏洞记录，而且漏洞记录的增长速度也在稳步增加。2003 年增加了 1,223 条记录。2008 年增加了 5,673 条记录。2017 年增加了 14,645 条记录。而在 2022 年，竟然增加了惊人的 25,059 条记录。也许现今的应用程序并不比以前更安全。也许应用程序变得更加复杂，网络安全社区用来发现漏洞的例行程序也有所改进。

2013 年，MITRE 推出了 ATT&CK，他们描述为“*基于实际观察的对手战术和技术的全球可访问知识库*”（[`attack.mitre.org/`](https://attack.mitre.org/)）。

让我们来看看 CVE 数据库。

## 漏洞是如何记录在 CVE 数据库中的呢？

MITRE 与大量的**CVE 编号机构**（**CNAs**）合作。截至 2023 年 4 月，共有 285 个 CVE 编号机构。绝大多数 CVE 编号机构是生产软件、硬件和基础设施可能存在安全漏洞的科技公司。例如，高通（半导体芯片生产商）、空中客车（飞机制造商）和 FreeBSD（操作系统开发者）都是一些 CVE 编号机构的例子。此外，许多人熟悉的大公司也是 CVE 编号机构，如微软、苹果和谷歌。

一些大型科技公司拥有漏洞悬赏计划。漏洞悬赏计划允许公众成员（不属于该科技公司的人）报告他们发现的安全漏洞。他们必须遵守公司的负责任披露政策，这通常意味着他们将漏洞发现报告给公司内部的某个个人或部门，而且不应将其发现公开。这为公司提供了在黑客发现漏洞并利用这些信息进行网络攻击之前修复漏洞的机会。

如果漏洞悬赏猎人遵守公司的漏洞悬赏计划规则，且公司认为该猎人发现的漏洞是合法且有用的，他们可能会支付漏洞悬赏猎人几百美元到超过$100,000 不等的奖励。奖励金额取决于公司为漏洞设定的奖励额度，以及他们认为漏洞的重要性。*HackerOne*维护着大多数漏洞悬赏计划的数据库 ([`hackerone.com/bug-bounty-programs`](https://hackerone.com/bug-bounty-programs))。

成为一名漏洞悬赏猎人与成为渗透测试员或红队成员非常不同。渗透测试员和红队成员通常会被分配特定的渗透测试任务，任务范围明确。漏洞悬赏猎人则是外部人员，他们可以发现任何自己感兴趣或擅长发现的漏洞，只要他们按照公司漏洞悬赏计划的规则行事，且不参与任何网络攻击。渗透测试和红队工作就像是在餐厅里做厨师；而漏洞悬赏猎人则像是在向食品银行捐赠食物。而且，只有漏洞悬赏猎人需要寻找零日漏洞，而渗透测试员和红队成员则需要在他们所工作的组织指定的范围内，通过模拟网络攻击来发现漏洞。

很多时候，漏洞记录会通过漏洞悬赏计划进入 CVE 数据库。例如，如果一名漏洞悬赏猎人在 Windows 11 中发现一个漏洞，这名漏洞悬赏猎人必须遵守微软的漏洞悬赏计划。然后，微软作为 CNA 将该漏洞记录到 CVE 数据库中。

有时，某些特定科技公司的员工和承包商（这些公司是 CNA）会发现零日漏洞。这些科技公司作为 CNA，将以与漏洞悬赏猎人相同的方式将漏洞记录到 CVE 中。

CNA 有责任确保他们在产品和服务中发现的漏洞，或者由他们报告的漏洞，能够被记录在 CVE 数据库中。CNA 通常不会记录那些与其自身产品和服务无关的漏洞。例如，记录 Mozilla Firefox 在 Android 版本中的漏洞并非苹果的责任，但记录 Firefox 在 iOS 版本中的漏洞可能是苹果的责任。也有可能是 Mozilla 的责任，或者是苹果和 Mozilla 共同的责任，这取决于哪个部分的产品受到了影响。

CVE 记录通常在 CNA 发现漏洞后并不会立即创建。CVE 记录是公开的，技术公司可能需要几个月甚至一年时间来私下解决漏洞。当漏洞可以公开披露时，通常会发布 CVE 记录。

作为一名渗透测试员，你很可能会发现你所在组织的网络存在一些已经存在几年的漏洞。例如，你可能会发现一个 2018 年的 CVE 记录。CNA 可能已经为这个漏洞提供了安全补丁，但你的组织尚未安装，或者这个漏洞虽然是公开的，但修复或缓解起来非常困难。作为渗透测试员，发现零日漏洞并不是你的工作，许多你发现的漏洞可能已经被技术厂商知晓多年！

下面是一个真实的 CVE 记录示例。

CVE-2022-3349 是索尼 PS4 和 PS5 视频游戏主机中的一个漏洞。每个 CVE 记录的标识格式都是这样的：CVE，接着是四位数的年份，再接着是该年份唯一的四位数编号。

该记录包含了漏洞的基本描述：

“在索尼 PS4 和 PS5 中发现了一个漏洞。该漏洞被分类为严重漏洞。它影响了组件`exFAT`处理器的`UVFAT_readupcasetable`功能。对参数`dataLength`的操控会导致堆栈溢出。可以在物理设备上发起攻击。建议升级受影响的组件。该漏洞的关联标识符为 VDB-209679。”

然后，展示了该漏洞的参考列表，通常是指向发布的报告的网页超链接，这些报告来自 CVE 数据库以外的地方。

接下来，列出了分配的 CNA。在此记录中，CNA 是 VulDB。VulDB 是一个第三方漏洞数据库。由于某些原因，索尼并不是 CNA。因此，第三方的索尼信任的机构承担着将索尼产品和服务中的漏洞添加到 CVE 数据库中的责任。

接下来，显示了记录创建的日期。在此记录中，日期是 20220928。这意味着 2022 年 9 月 28 日。这里有一个免责声明：“*记录创建日期可能反映了 CVE ID 的分配或保留时间，并不一定表示该漏洞被发现、与受影响供应商共享、公开披露或更新到 CVE 中的时间。*”正如我提到的，漏洞的发现与被添加到 CVE 数据库之间可能有几个月甚至一年的时间。这通常是为了给供应商（受漏洞影响的科技公司）一些时间来修复漏洞，以防止其被公开利用，防止网络攻击。

关于*CVE-2022-3349*（以及其他 CVE 记录）的更多信息，您需要访问 NIST 的 NVD。NVD 为大多数 CVE 记录提供网页。请见[`cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3349`](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3349)和[`nvd.nist.gov/vuln/detail/CVE-2022-3349`](https://nvd.nist.gov/vuln/detail/CVE-2022-3349)。

这是 NVD 关于 CVE-2022-3349 的相关信息（[`cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3349`](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3349)）。它有一个 CVSS 评分。CVSS 为漏洞评分，分值在 0.0 到 10.0 之间。较低的分数表示漏洞不那么严重，这意味着如果网络攻击者利用这些漏洞，其危害较小。较高的分数表示漏洞更加严重，若被攻击者利用，其危害较大！*CVE-2022-3349*在 CVSS 3.X 版本的评分中为 6.8（中等）。

然后，NVD 列出了“*建议、解决方案和工具的参考资料*”。这类似于 CVE 自身数据库中的网页超链接引用。事实上，CVE 和 NVD 经常交叉引用这些资料——它们可能在这两个记录版本中是相同的超链接。

最后，NVD 列出了“*弱点枚举*”。这些是指向 MITRE 的**通用弱点枚举**（**CWE**）数据库的链接，MITRE 称之为“*一个由社区开发的软件和硬件弱点类型列表*。”弱点是漏洞可能具有的缺陷类型。NVD 对于*CVE-2022-3349*的记录列出了以下 CWE：

+   CWE-787, 越界写入

+   CWE-122, 基于堆的缓冲区溢出

+   CWE-119, 内存缓冲区操作范围不当限制

让我们来看看两个常用的 CVSS 评分标准。

CVSS v2.0 是较旧的评分标准。漏洞得分 0.0 到 3.9 被归类为“低”，4.0 到 6.9 被归类为“中”，7.0 到 10.0 被归类为“高”。较新的 CVSS v3.0 有更多的分类。0.0 始终意味着漏洞不具任何危险性。我认为没有漏洞会有 CVSS v3.0 得分为 0.0；这个数字只是作为一个概念存在，用来帮助量化其他得分区间。得分为 0.1 到 3.9 的是“低”，4.0 到 6.9 的是“中”，7.0 到 8.9 的是“高”，9.0 到 10.0 的是“关键”。无论使用哪个 CVSS 版本，较高的得分表示漏洞更危险，较低的得分表示漏洞较不危险。作为渗透测试人员或红队成员，你需要帮助编写渗透测试报告。你应该在报告中提到 CVSS 得分，而这些得分将帮助你的组织确定哪些漏洞最需要优先处理。

最后是 EPSS。EPSS 由 FIRST 维护。根据 FIRST 的描述，FIRST“*旨在将全球各国的事件响应和安全团队聚集在一起，确保为所有人提供一个安全的互联网*”。

FIRST 使用 EPSS 来描述漏洞被网络攻击者利用的可能性或概率。FIRST 认识到，漏洞太多，无法立即修复，且漏洞常常在完全修复之前就被记录到 CVE 数据库中。有些漏洞非常难以完全修复。因此，FIRST 使用 EPSS 来确定已知漏洞是否可能被利用，以及被利用的可能性有多大。FIRST 表示，只有 2%到 7%的已知漏洞会“*在* *实际环境中被利用*”。

EPSS 得分是以百分比表示的，范围从 0%到 100%。0%表示该漏洞永远不会被利用，而 100%表示该漏洞肯定会被利用，并且可能已经被利用了很多次。根据 FIRST 的说法，绝大多数漏洞的得分低于 25%，其中许多低于 10%。

FIRST 建议渗透测试人员和防御性安全专家根据 CVSS 和 EPSS 对漏洞进行分类。因此，CVSS 得分为 9.8 且 EPSS 得分为 97%的漏洞应当立刻处理，尽可能迅速，并给予绝对的优先级。如果一个漏洞的 CVSS 得分为 9.9，但 EPSS 得分为 2%，你可能需要等待 EPSS 得分更高的漏洞先被处理，尽管利用该漏洞的风险非常高。

现在我们知道了如何在公共数据库中记录漏洞和利用情况的信息，我们准备好理解如何编写有效的渗透测试报告以及如何进行紫队合作。紫队合作是指红队与蓝队——防御性安全专家合作的过程。

# 紫队合作与编写渗透测试报告

作为一名云渗透测试员，无论你是作为外部承包商为所在组织工作，还是作为组织内部红队的一员，你将在一个项目中投入从几天到几个月的时间。你的目标是在组织合同定义的范围内，尽可能发现更多的安全漏洞，同时执行组织和云服务提供商（AWS、Azure、GCP）允许的模拟网络攻击。

因此，在这些天、周或月的过程中，你可能发现了多个漏洞。大多数漏洞是网络安全社区所熟知的，且在 CVE 数据库、NIST 的 NVD 以及与漏洞相关的厂商（向你的组织提供产品和服务的科技公司）的安全警报和补丁公告中都有广泛记录。也许你发现的一些漏洞只是常见的安全配置问题，例如在从未使用的情况下启用 Windows 的 RDP。这本应该在漏洞评估中发现。但至少你能捕捉到它！或者，也许你还发现了其他在企业中常见的网络安全问题。

太棒了！你在一段时间内付出了很多努力，你和你的团队发现了一堆只有通过有效和适当的渗透测试才能发现的严重网络安全问题。（嗯，除了那个不必要启用的 RDP。为什么你们的组织在漏洞评估中没发现这个？）

现在，你可以回家，玩会儿视频游戏，或者请你的浪漫伴侣吃顿美味的美食，来庆祝你在工作上的成就。

等等，所有这些渗透测试到底是为了什么？是为了炫耀你聪明的黑客技巧吗？那很好，你工作的公司也非常印象深刻。你模拟了他们认为只有 APT 才能完成的网络攻击。（`APT`代表**高级持续性威胁**，指的是可以长期攻击目标的网络犯罪集团。他们是最先进的网络攻击者，并且非常持久！）

但归根结底，组织雇佣渗透测试员和组建红队的真正原因是，他们需要发现漏洞评估可能遗漏的安全漏洞，以便他们能够*改善* *其网络*的安全态势。

为了使他们能够利用你发现的信息来改善网络的安全态势，你需要能够有效地传达你发现的信息。这意味着要参与紫队协作并编写一份渗透测试报告，使得你组织中的防御安全专家能够轻松理解。

很有可能，在你的一生中，你曾见过某个天才试图以别人无法理解的方式表达自己的创意。

为了让你的渗透测试对你所工作的组织有益，你的目标应该是避免成为那种无法有效沟通的聪明人。你需要帮助你所工作的组织理解你发现的安全问题，并可能甚至提出一些建议来解决这些问题。

多年来，我与许多其他渗透测试人员一起工作。有很多知识渊博、技能高超的专业黑客。但只有少数人能够有效地进行紫队合作并撰写高质量的渗透测试报告。据我所知，那些善于沟通的渗透测试人员已经成功地工作了几十年，而那些沟通效果不佳的渗透测试人员更有可能失去工作。

如果你能向你的组织展示你已经找到了关于他们网络安全漏洞的信息，这些信息可以帮助他们显著提升安全姿态，那么你将受到他们高度重视，并且很可能会有一个成功的职业生涯。

这本书涵盖了许多关于对 AWS、Azure 和 GCP 进行渗透测试的有效工具和技术的知识，熟悉这些工具和技术对于成为红队中成功的云渗透测试人员至关重要。但撰写良好的渗透测试报告和有效的紫队合作同样重要。

首先，让我们了解一下紫队合作以及为什么这是你的组织需要的一种实践。

## 紫队合作

紫队合作是网络安全领域相对较新的概念。

红队是一群*攻击性*安全专家。他们的工作是复制特定威胁行为者可能采取的特定工具和技术，这些工具和技术可能被用来攻击你的组织。他们的参与可能持续数月。他们从事攻击性网络安全，扮演模拟网络攻击者的角色，为你的组织带来好处。与普通的渗透测试不同，他们必须特别模仿特定的攻击者，比如一个公认的 APT 组织。

蓝队是一群*防御性*安全专家。他们的工作是寻找新的方法来提升组织的安全姿态，每天都在工作。**安全运营中心**（**SOC**）分析员、数字取证专家以及**事件响应**（**IR**）组等都在防御性网络安全领域工作。但一个合适的蓝队总是对最新的网络威胁和技术感兴趣，并根据所学到的内容设计其安全加固工作。

如果你曾经乐在混合颜料和色彩理论中，你会知道混合红色和蓝色颜料会得到紫色。因此，紫队是红队和蓝队所做的事情的结合。

我的朋友 Daniel Miessler 是紫队领域的顶尖思想领袖之一，也是这一概念的先驱。根据 Miessler 的观点，紫队是在红队和蓝队成员之间有效合作时形成的。有些组织可能会考虑创建一个专门的紫队，作为鼓励他们的红队和蓝队更好地沟通和合作的替代方案。但这可能不会非常有效。

Miessler 为什么认为专门的紫队是个坏主意的类比，基于一个专业的餐厅厨房。如果一家餐厅发现其服务员难以将食物从厨房送到顾客那里，解决方案不是雇佣一支新的“厨房到餐桌协调员”团队。解决方案是找到让服务员有效送餐的方法。如果一家餐厅有一位精英厨师认为他们的菜肴过于精致，顾客难以欣赏，那么再多的烹饪技巧也无法让餐厅受欢迎。厨师可能会把他们的菜肴留在厨房，而如果顾客没有得到食物，餐厅就会失败。所以，如果你是一个不重视与蓝队合作的红队成员，你的技能和才华将无人受益。

因此，紫队的技巧完全是关于有效的团队合作和沟通技巧。这些并不完全是技术技能；它们是人际交往技巧。作为红队成员，保持谦逊并愿意从蓝队中倾听和学习也至关重要。我见过很多行业中的巨大自负——不要成为其中之一！

GitLab 进行大量的紫队合作工作。它们的工作流程如下。

首先是攻击规划阶段，在这一阶段，红队和蓝队拥有平等的责任。它们会进行头脑风暴，提出并讨论可能的网络威胁，或许会使用**威胁情报**（**TI**）或新的威胁检测能力作为灵感。接下来，他们将讨论行动的后勤安排（责任、时间表等），并概括他们计划模拟的攻击者。攻击者可能使用什么样的 C2 服务器？他们可能使用哪些战术和技术？攻击者的目标是什么？然后，他们将进行桌面演练，这是防御性安全专家的一项流行活动。这有点像玩桌面角色扮演游戏，但他们将用它来回顾真实世界的威胁行为者**战术、技术和程序**（**TTPs**）。如果攻击者使用这些 TTP，蓝队在事件响应中会如何反应？这些 TTP 如何危害他们组织的网络和数据？

攻击仿真阶段是红队和蓝队分别专注于各自职责的阶段。红队将测试执行其 TTP（战术、技术和程序）所需的基础设施和工具。然后，红队将利用这些 TTP 模拟网络攻击，如定向渗透测试。在红队模拟攻击的同时，蓝队将验证这些（模拟的）攻击的预期结果。

最终阶段是操作的总结。红队准备并分享其渗透测试报告。然后，红队和蓝队聚集在一起讨论发生的细节。哪些方面有效？哪些方面可以做得更好？

进行紫队合作的方式有很多种。GitLab 的工作流程就是一种模式。SCYTHE 公开分享了它自己的模式——**紫队演练框架**（**PTEF**）。

SCYTHE 框架的工作流程是这样的。在演练协调员的指导下，红队和蓝队聚集在一起讨论特定的威胁行为者、该行为者的 TTP（战术、技术与程序）以及相关的技术细节。接下来，红队和蓝队在桌面演练或讨论中作为平等的合作伙伴，讨论这些 TTP 以及你们组织的安全控制措施。如果进攻方做了某些特定的事情，防守方会如何回应？然后，红队模拟攻击者的 TTP，而蓝队则仔细观察。蓝队可能应该做笔记。接下来，蓝队检测并响应红队的 TTP 模拟；它所做的一切应该对红队可见。检测工程步骤中，蓝队调整其安全控制并改善网络安全事件日志，以提高其对红队模拟攻击的可视性。最后，红队和蓝队再次聚集在一起，重复他们的流程，记录结果，然后进入下一个 TTP 模拟——一个新的紫队演练。

如果你只是以渗透测试员的身份为组织工作，那么紫队的工作流程对你来说可能不太相关。然而，你仍然需要注意尊重组织防御安全专家的需求，并与他们有效沟通。

如果你是一个正式红队的一员，组织中如何进行紫队合作的这些例子可以作为你工作的范例。如果你的公司还没有与蓝队达成一致的紫队合作流程，建议推动紫队合作流程的建立。如果你能向安全团队的领导解释与防御安全组有效协作的重要性，你的努力一定是值得的。你可能需要在上级面前充分阐述正确紫队合作的重要性，但你的主动性可能会得到奖励。

现在，让我们来学习你可能被期望做的事情——无论你是否是红队的一员，那就是编写有效的渗透测试报告！

## 编写渗透测试报告

如果你不擅长创意写作，你的渗透测试团队至少需要有一位擅长此项技能的同事。只要你的渗透测试团队中的每个人能够以其他方式有效地相互沟通，你就可以将编写渗透测试报告的任务简单地委托给团队中最擅长写作的人。当然，如果你是作为团队进行渗透测试，那么你的渗透测试报告是一个团队的努力。每个人的发现都应该包含在报告中。你的渗透测试报告的撰写者将需要你所有的发现，当撰写者询问时，你需要能够解释你做了什么以及发生了什么。你还应该妥善保管你在渗透测试期间使用的任何工具的日志，因为你将需要将它们作为报告的参考。

但如果你是独立的渗透测试人员，那么编写渗透测试报告的责任完全由你承担！这是渗透测试人员需要不仅具备技术技能，还需要具备创意和沟通技能的一个例子。

因此，让我们看看你的组织对你的渗透测试报告有什么期望。

所有优秀的渗透测试报告必须包括以下内容：

+   报告开头的执行摘要。

+   渗透测试范围的定义。这是你测试的“什么”。你的测试的主题究竟是什么？

+   对你的渗透测试方法论进行彻底和详细的解释。这是你测试的“如何”。

+   你的渗透测试发现的漏洞清单。这些漏洞可能需要按照最关键的漏洞在前，最不关键的漏洞在后进行分类。

+   对你发现的漏洞可能对组织造成的影响进行分析。这部分非常关键，因为如果你的组织不了解如果不解决漏洞可能会造成的危害，那么他们为什么要在意呢？

+   如何纠正你的渗透测试发现的具体漏洞的建议。逐个漏洞进行处理。

建议如何改进组织的安全策略。这超出了纠正特定漏洞的范围。你需要提出建议，说明组织如何全面提升其安全姿态。例如，如果你成功利用的大多数漏洞在 CVE 数据库中已经存在超过十年，你可以建议改进其补丁管理，并努力用更现代的硬件和软件替换传统技术。

执行摘要应该在报告的开头而不是结尾。执行摘要是给*高管*看的。他们通常是组织中具有很大权力和影响力的人，但并不特别擅长技术方面。

他们也是非常忙碌的人。在他们的优先事项清单中，阅读你的渗透测试报告可能排在当天的第 27 位。他们不会花几个小时阅读你的报告。如果你幸运的话，他们可能会给你 5 分钟的时间。因此，执行摘要需要放在报告的开头，并且必须简明扼要。执行摘要应该是一到两页，最多就是这样。如果按字数计算，目标是 300 到 600 字。高层管理人员不太可能读超过这个字数。

在你的执行摘要中，仅需解释你测试了哪些内容，发现了什么样的模式，或者你发现的最重要的问题是什么。下面是一个例子：

“*我们尝试通过代码注入漏洞来访问托管在 Amazon EC2 实例上的组织微服务，目标是电商网站的界面。结果成功了，我们通过这些 API 获得了未授权的访问权限，能够访问敏感数据。这些漏洞如果被利用，可能会对公司造成的损害就是这样。这是如果发生真实的网络攻击，可能会导致公司损失的金额。*”

将每个“*this*”替换为你实际的渗透测试发现。我坚信在报告中提到这些网络攻击可能对公司造成的估算财务损失。这正是你的高层管理人员最关心的——金钱。获得可信的财务风险数据比你想象的要容易。例如，如果漏洞利用可能导致数据泄露，你可以从 IBM 的《数据泄露成本报告》([`www.ibm.com/reports/data-breach`](https://www.ibm.com/reports/data-breach))中获得大致的损失金额。如果是勒索软件攻击，你可以引用以下报告：[`www.cybereason.com/ransomware-the-true-cost-to-business-2022`](https://www.cybereason.com/ransomware-the-true-cost-to-business-2022)。

你报告的其余部分是供你公司内部的网络安全专家阅读的。只要执行摘要简短，其余的报告可以根据需要写得长一点，以便包含所有重要的技术细节。报告的长度会根据你在渗透测试过程中所做的工作量而有所不同。但渗透测试报告很少超过 100 页，大多数报告的页数在 20 到 70 页之间。

解释你的渗透测试范围。“*我们测试了这个特定的 DevOps 网络。*” “*我们测试了这个特定的 Web 应用程序。*” “*我们测试了这个特定的网络段。*” 当然，你需要为测试范围提供更多的细节。列出网络地址、IP 地址或任何适用的标识符，以便安全团队知道你具体测试了什么内容。

方法论部分也应详细具体。你应该按时间顺序逐步解释你在测试中采取的确切行动。列出你使用的工具、模拟的漏洞利用以及尝试的技术。如果有疑问，宁可详细描述，也不要简略。你可能想引用 MITRE 的 ATT&CK 数据库（[`attack.mitre.org/`](https://attack.mitre.org/)）来命名具体的漏洞利用技术。这个资源在网上是免费的并且公开可用。

接下来，你需要展示你的渗透测试发现的漏洞。你发现的每一个漏洞都必须包括。无论何时适用，都要引用具体的 CVE 编号。我建议按照从最严重到最轻微的顺序展示漏洞。提到 CVSS 和 EPSS 分数。根据 CVSS 和 EPSS 的综合评分来权衡每个漏洞的严重性。例如，如果有几个漏洞的 CVSS 分数在 7.0 到 9.0 之间，那么 EPSS 为 30%的漏洞应排在前面，EPSS 为 10%的漏洞应排在后面。MITRE 的 CVE 数据库（[`cve.org`](https://cve.org)）、NIST 的 NVD 数据库（[`nvd.nist.gov/`](https://nvd.nist.gov/)）以及 FIRST 的 EPSS 数据库（[`www.first.org/epss/`](https://www.first.org/epss/)）都是免费的公开资源，你可以通过它们查找 CVE 编号、CVSS 分数和 EPSS 分数。

接下来，你需要提供修复建议。要具体明确。提到需要安装的补丁、需要更改的配置和设置等。这些内容会根据漏洞的性质有所不同。

你知道“看树不见森林”这句话吗？它意味着某人过于关注情况的细节，导致忽视了“全局视角”。但是在你的渗透测试报告中，你的组织必须同时看到森林*和*树木。修复建议部分是“树木”，而安全策略改进建议部分是“森林”。“*升级和更换过时的技术*。”“*雇佣安全运营中心团队*。”“*改善事件响应计划*。”这些都与安全策略相关，但要根据你特定的组织和渗透测试使用适当的细节。

我建议在第一次编写渗透测试报告之前，查看一些公开的真实世界渗透测试报告。可以查看 juliocesarfort 在 GitHub 上维护的真实渗透测试报告集（[`github.com/juliocesarfort/public-pentesting-reports`](https://github.com/juliocesarfort/public-pentesting-reports)）。在 pentestreports.com 网站上也有一个大型报告集（[`pentestreports.com/reports/`](https://pentestreports.com/reports/)）。如果你想进一步了解，我曾在*SANS Pen Test HackFest Summit 2021*上做过一场关于编写有效渗透测试报告的演讲，演讲题目是*Writing Reports: The Overlooked Pen Testing Skill*。你可以在 YouTube 上观看这场演讲（[`www.youtube.com/watch?v=r-6LBjlM14Y`](https://www.youtube.com/watch?v=r-6LBjlM14Y)）。

就是这样。这就是为什么要进行渗透测试的原因。你进行渗透测试是为了发现安全漏洞信息，推荐行动方案，并帮助防御安全团队提升你组织的安全态势。

# 总结

AWS、Azure 和 GCP 有渗透测试政策，你和你的组织必须遵守。基准检查验证你组织云服务的性能。云服务商的 SLA 是一个很好的通用基准来源。CIS 还为网络安全提供了具体的基准。云服务枚举是攻击者用来发现你组织如何使用云服务的一种方式。你可以执行一些脚本来测试你组织对漏洞的易受攻击性。

漏洞评估可以通过漏洞扫描应用程序进行。在渗透测试之前，重要的是要有漏洞评估的最新历史记录，并对这些评估发现的漏洞进行缓解。常见的安全配置错误必须首先解决，才能确保你的组织准备好进行渗透测试。

暴露的服务是你组织云网络中的互联网服务和端口，攻击者可以通过互联网利用这些服务进行网络攻击。确保你的公有云中所有这些点都采取了适当的访问控制措施，以防止服务暴露至关重要。权限是访问控制的组成部分——用户和机器在你组织的每个应用和服务中被允许执行什么操作？云集成是指你网络中不同的云平台（如 AWS、Azure、GCP）相互连接，或它们中的任何一个部分与本地网络连接。确保云集成的安全非常重要，因为它们可能特别容易受到网络攻击。

公共已知的安全漏洞记录在 MITRE 的 CVE 数据库中。NIST 将相同的 CVE 记录在其 NVD 数据库中，并为它们分配 CVSS 评分，确定它们的严重程度。FIRST 为这些 CVE 分配 EPSS 评级，指示攻击者利用这些漏洞的可能性。

作为一名渗透测试人员或红队成员，与你的防守安全团队或蓝队团队进行良好的沟通和合作至关重要。紫队协作是红队和蓝队共同执行的操作，旨在发现安全漏洞。每次渗透测试后都应编写渗透测试报告，报告应有效地解释你发现的漏洞、其影响以及为组织的高层和防守安全团队提供的修复建议。

在下一章中，我将介绍 AWS，亚马逊的云平台。你将了解各种 AWS 应用程序和服务，以及它们的使用原因。我们还将探索亚马逊自带的 AWS 安全工具，以及一些第三方工具。

AWS 是目前最受欢迎的云平台之一。你可能会对 AWS 能够支持的多种不同使用场景感到惊讶。AWS 还拥有许多对云渗透测试者至关重要的安全控制功能，值得深入理解。

# 延伸阅读

要了解更多本章内容，你可以访问以下链接：

+   *AWS 官方渗透测试* *政策*：[`aws.amazon.com/security/penetration-testing/`](https://aws.amazon.com/security/penetration-testing/)

+   *微软官方渗透测试参与规则*：[`www.microsoft.com/en-us/msrc/pentest-rules-of-engagement`](https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement)

+   *Google 官方渗透测试* *政策*：[`cloud.google.com/terms/aup`](https://cloud.google.com/terms/aup)

+   *MITRE 的* *CVE 数据库*：

    +   [`cve.mitre.org/cve/`](https://cve.mitre.org/cve/)

    +   [`www.cve.org/`](https://www.cve.org/)

+   *通过 HackerOne 的完整漏洞悬赏计划列表*：[`hackerone.com/bug-bounty-programs`](https://hackerone.com/bug-bounty-programs)

+   *NIST 的 CVSS* *系统*：[`nvd.nist.gov/vuln-metrics/cvss`](https://nvd.nist.gov/vuln-metrics/cvss)

+   *FIRST 的 EPSS* *系统*：[`www.first.org/epss/`](https://www.first.org/epss/)

# 第二部分：渗透测试 AWS

亚马逊的 AWS 是最受欢迎的云平台之一。在本部分中，我们将学习 AWS 的各种软件即服务（SaaS）、平台即服务（PaaS）和基础设施即服务（IaaS）应用程序。我们将部署自己的 AWS 实例，用于测试我们的渗透测试技能。我们将使用 AWS 安全中心检查我们 AWS 部署的安全状况。我们还将逐步尝试一些在 AWS 中的渗透测试工具。然后，我们将部署 Docker 和 Kubernetes 容器并进行测试。

本部分包含以下章节：

+   *第四章*，*AWS 中的安全功能*

+   *第五章*，*通过无服务器应用程序和工具进行 AWS 功能的渗透测试*

+   *第六章*，*在 AWS 中进行容器化应用程序的渗透测试*
