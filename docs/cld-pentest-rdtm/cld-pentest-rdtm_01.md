

# 第一章：企业如何利用和实施云网络？

欢迎阅读！无论你是已经有经验的渗透测试员，还是刚接触网络安全的新人，渗透测试云网络需要专门的知识。在渗透测试云网络和渗透测试本地网络及计算机系统之间的一个关键区别是，你所工作的组织并不拥有其计算环境中的所有内容。当你在云网络中进行红队演练时，你所工作的组织及其云服务提供商（无论是**亚马逊云服务**（**AWS**）、Azure，还是**谷歌云平台**（**GCP**））都有必须尊重的需求。好消息是，如果你掌握了渗透测试云网络的技能，你可能会迎来一份丰厚的职业生涯。如今，组织比以往任何时候都更依赖云服务，且对云服务的需求持续增长。

渗透测试员在得到网络所有者的许可后，模拟网络中的网络攻击，以发现攻击者可能发现的安全漏洞。雇佣你进行**渗透测试**（**pentest**）的公司可能已经对其网络进行了漏洞评估和审计。通过评估和审计，可以发现很多安全漏洞。渗透测试是一种动手操作的检查方法，用于发现可能被遗漏的额外安全漏洞。

红队是组织内部的一个团队，定期执行有针对性的渗透测试。你的公司网络安全团队可能通过**安全运营中心**（**SOC**）或更广泛的网络安全社区了解新的网络威胁和**高级持续性威胁**（**APT**）。红队会被告知某些新兴的威胁，并被要求模拟这些威胁。通过这样做，红队能够发现新兴攻击者可能利用的漏洞。这些发现会与防御安全团队共享，防御团队会根据这些信息加强其网络的安全性，以防止威胁攻击组织。例如，一个新的勒索软件团体可能成为新闻头条。红队的任务是研究这个新的勒索软件团体如何运作。然后，下一步是他们在下次红队演练中假装成这个新的勒索软件团体。红队，作为进攻性安全专家，通常会全年保持忙碌，因为每年、每月、每周甚至每天都会有新的网络攻击团体和网络威胁出现！

本章将涵盖以下主要内容：

+   今日的云网络

+   混合云、全云和多云网络

+   为什么一个组织会拥有多云网络

+   云迁移过程

+   云中的安全责任

+   **基础设施即服务**（**IaaS**）、**平台即服务**（**PaaS**）和**软件即服务**（**SaaS**）之间的区别

让我们开始吧！

# 今日的云网络

为了能够有效地测试你的渗透测试目标，你必须首先理解它。自从 AWS 在 2006 年以现有形态推出以来，云网络在企业市场中变得越来越受欢迎。微软 Azure 和 GCP 自 2008 年以来就已经存在。这三个云平台是全球各类企业和公司最常使用的平台。如今，大多数企业在其网络中至少使用一个云平台。一些企业甚至同时使用多个云平台。那么，云平台是什么，它们为何如此受欢迎？云平台如何改善公司在互联网上开展业务的方式？

在 1990 年代，企业必须在自己场所托管自己的数据中心。那个年代开始出现了网站托管服务提供商，但它们仅提供网站服务器和电子邮件服务器。这对组织的官方网站和电子邮件有好处，但对于其他任何需求则不适用。如果公司需要运行自己更复杂的应用程序和数字服务，它们就需要拥有自己的服务器机房和设备。

任何具有多年经验的网络管理员都明白，企业的计算机网络需求可能会迅速变化。带宽和数据存储的使用量可能在几个月内翻倍，然后在接下来的几个月内减半。如果它们的需求在短时间内迅速增长，那么就必须采购大量新的服务器和网络基础设施，并且需要更多的物理空间来安置它们。如果它们的需求大幅缩小，那么很多昂贵的服务器设备、网络基础设施和物理空间都会浪费掉。在公司部署大规模本地网络时，许多不便、低效和财务浪费是不可避免的。

到目前为止，21 世纪已经带来了计算机网络技术的有益进步。像**亚马逊**、**微软**和**谷歌**这样的科技巨头在全球各地拥有庞大的数据中心。它们开始通过将其庞大的计算机网络基础设施提供给第三方企业和其他实体来加以利用。AWS 于 2006 年推出，随后微软 Azure 和 GCP 在 2008 年跟进。它们让企业在*自有*基础设施上部署网络变得比以往任何时候都更简单、顺畅。

容器化是一种实现操作系统和硬件虚拟化，并通过负载均衡在网络中以可扩展和动态的方式部署应用程序的方式，能够更高效地使用服务器机器。当操作系统被虚拟化时，它像应用程序一样在另一个操作系统中运行，并具有模拟的硬件规格。负载均衡将网络流量分配到多个服务器机器上，防止服务器过载，提升应用程序的可用性和响应速度。每个容器都有操作系统组件，并且是应用程序的一部分。容器在容器编排平台和宿主操作系统或直接的虚拟机管理程序中运行。因为容器是自给自足的虚拟化实体，一个应用程序在任何时候可能会使用大量容器，而任何单个容器的生命周期可能只有几天。容器可以根据云应用程序的需求快速启动和终止，支持应用程序持续运行。

Docker 于 2013 年问世，Kubernetes 于 2015 年开始流行。虽然还有其他容器化编排平台，但 Docker 和 Kubernetes 是你在云网络中最常见的容器编排平台。这些平台是 AWS、Azure 和 GCP 最好支持的容器化编排平台。随着容器化的普及，它促进了更多企业将云平台融入其网络中。

DevOps 方法已经改变了组织推出应用程序的方式。这是一个主要用于开发面向云部署的应用程序的方法。通过将开发和运维（IT）团队结合在一起，DevOps 促进了持续的协作。团队以小规模并且非常频繁的方式修补应用程序并部署新功能。与其每年发布一次应用程序的 1.5 版本，下一年发布 1.6 版本，不如每个月更新多次应用程序。DevOps 补充了敏捷应用程序开发，因此应用程序的部署更加高效和响应迅速。虽然可以在没有云的情况下使用 DevOps 方法论，但云环境使得这一方法更加可行。作为云渗透测试员，你很可能至少会在某个时刻测试 DevOps 应用程序。而且，由于 DevOps 应用程序变化的频繁，这将使你一直忙碌。DevSecOps 是将安全性融入 DevOps 中，你很可能会成为这个过程中的安全部分。

自从 AWS、Azure 和 GCP 推出以来，它们不断增加新的服务和功能。如果每个云平台的服务列表是一份餐厅菜单，2009 年可能只有几道菜，而到 2023 年，菜单上则有多页的*主菜*。所有这些新的服务和功能使得组织能够用云平台做更多种类的事情。

亚马逊、微软和谷歌负责维护他们的基础设施和**应用程序编程接口**（**APIs**）以供其服务使用。他们负责运行他们的数据中心并管理他们在全球各地运营的大型设施。当企业使用云平台时，它们不再需要处理这么多负担。

如果一个组织突然需要将其数据存储容量和网络带宽翻倍，它只需向亚马逊、微软或谷歌提出要求，支付费用，几乎立即就能得到。如果一个组织的网络需求减少，减少其数据存储和带宽同样容易。这就是我们所说的可伸缩性。云服务根据组织在任何特定时间的计算需求动态地和响应地扩展。

将 AWS、Azure 和 GCP 的庞大基础设施与容器化相结合，云网络可以快速增长和演变，企业无需处理运行自己数据中心的麻烦。应用程序可以快速增长、缩小和快速变化。部署应用程序的组织拥有完全控制权，而云平台提供商处理所有物理琐事。

诸如 Netflix、Steam 和 Dropbox 等服务今天响应迅速且功能强大，因为它们利用了云的潜力。当然，许多各行各业的小组织也使用云平台。同一 AWS 数据中心可能同时拥有一家著名的视频流媒体服务和一家税务和会计小企业，甚至可能在一些相同的物理服务器上运行。

这就是为什么云平台如此受欢迎的原因。企业现在深深承诺使用云平台，因此作为红队的渗透测试人员，你将被期望非常了解它们。云平台是 21 世纪的一种必不可少的商业工具。不幸的是，由于云平台通过互联网运作，它们容易受到各种可怕的网络威胁。组织需要你的才能和技能来像网络攻击者一样思考。找出攻击者将利用的漏洞，以便你的蓝队（防御性安全专家）能够有效地加固你的云网络安全。

作为一名红队人员，网络威胁将始终让你保持警惕。你将总是很忙。请听取著名计算机科学家和网络安全专家布鲁斯·施奈尔的建议：

“安全是一个过程，而不是一个产品。产品提供一定的保护，但在一个不安全的世界中有效开展业务的唯一方法是建立一套认识到产品固有不安全性的流程。”

在接下来的部分中，我们将研究不同类型的云网络。根据组织的云网络类型，你对其进行渗透测试的方式将有所不同。

# 混合云、全云和多云网络

云网络可以采用几种不同形式。一些组织将其客户端机器（如个人电脑和移动设备）保留在自己的场所，然后将其后端服务器完全运行在一个特定的云平台上。这是一个在 AWS、Azure 或 GCP 等一个平台上的全云网络。

一些组织在自己的场所运行一些服务器机器，并在一个或多个云平台上运行其余网络。这就是混合云网络——部分在本地，部分在云上。

一些组织通过多个云平台部署其网络。例如，它们可能在 AWS 上运行一些网络部分，而在 Azure 上运行其他部分。这就是多云网络。

让我们来看看这些不同的云网络操作方式是如何运作的，以及为什么组织可能会选择一种方式而不是另一种方式。

## 全云网络

全云网络是指企业仅在其场所拥有客户端设备，其余网络全部在云服务上。称之为完全云、云优先、仅云，或其他名称。无论被称为完全基于云、云优先、仅云，或任何其他名称，远离本地后端系统的这种转变是一个新兴的行业趋势。为了明确起见，网络的后端功能是指必须作为服务器运行的一切。这包括数据库、Web 服务器、电子邮件服务器、认证系统服务器，以及任何通常在数据中心而不是在某人办公室内运行的计算机网络功能。这些需求理论上都可以从云服务中运行，而人们的手机、平板电脑和个人电脑（客户端设备）在连接到网络时充当前端设备。如果我必须亲自进入数据中心才能在手机上查看我的电子邮件，我会觉得非常不方便！

研究公司 Gartner 提到了一种云优先策略，企业优先使用云平台。云优先策略并不一定意味着企业拥有全云网络。拥有云优先策略的企业可能拥有许多传统技术，或者在 2000 年代中期云服务普及之前就存在的服务。然而，任何新功能或服务都会部署在云上，并且尽可能将旧服务和应用迁移到云上。

2021 年 11 月，Gartner 表示到 2025 年，85% 的组织将采用云优先原则。它还相信，95% 的新数字工作负载将部署在云原生平台上（[`www.gartner.com/en/newsroom/press-releases/2021-11-10-gartner-says-cloud-will-be-the-centerpiece-of-new-digital-experiences`](https://www.gartner.com/en/newsroom/press-releases/2021-11-10-gartner-says-cloud-will-be-the-centerpiece-of-new-digital-experiences)）。因此，如果你正在学习渗透测试云网络，你正在进入一个有利可图的行业！

## 混合云网络

混合云网络部分托管在云端，部分部署在本地。为了构成混合云网络，至少一些实际的后端服务器操作必须在企业的本地，并且与云网络连接。如果一个组织拥有一个本地网络和一个完全未连接的云网络，那么这个组织拥有的是两个独立的网络，而不是一个混合网络。

为什么组织会选择采用混合云网络？原因可能有很多。

他们可能有一个遗留的本地网络，但他们需要集成一些只在 AWS、Azure 或 GCP 上提供的 SaaS 或 PaaS 组件。也许他们需要 GCP 来进行 Looker 商业数据分析，Azure 用于 Azure DevOps 支持微软生态系统的 API，或者 AWS 用于 AWS Lambda 进行无忧的代码执行。三大云平台都拥有独特的服务，它们可能满足特定的业务需求。

其他一些组织认为，维持混合云网络是一种有效的冗余方式。网络运行时间（Uptime）是衡量任何类型网络运行最重要的指标。冗余是减少运营停机时间的有效方法。例如，如果一台服务器出现技术故障，导致无法继续提供服务，另一台相同的服务器可以确保其功能继续运行。企业可能认为拥有一些由自己物理控制的网络基础设施对冗余非常有益。当然，它无法物理控制云服务器；它只能控制其本地的服务器。网络基础设施也是如此。云服务提供商赋予组织对运行在云基础设施上的网络部分很大的控制权，但他们不允许组织的网络管理员走进他们的云数据中心，直接物理操作服务器的开关。组织可能选择维持混合网络的其他原因包括**灾难恢复**（**DR**）或合规性要求。可能是灾难恢复程序中的某些细节，或是它需要遵守的某些法规要求其对部分网络拥有物理访问权限。

一些组织可能与供应商签订了**服务水平协议**（**SLA**），这些协议是在他们使用云服务之前就已存在的。SLA 是供应商与客户之间的法律协议，明确了客户期望获得的服务、供应商同意提供的服务，以及用来衡量性能的指标。供应商可以是云平台（如 AWS），也可以是其他类型的 IT 服务（如 Slack 或 Cloudflare）。旧的 SLA 有时会使云迁移变得复杂。因此，一些企业可能会等到旧合同到期后再全面迁移到云端。与此同时，他们可能会找到一种折中的方案，在实现云服务的同时，继续维持一段时间的本地基础设施。

如果一个组织拥有混合云，它可能会将更敏感或关键的数据操作保留在本地。敏感数据和系统可能包括公钥基础设施（PKI）、关键数据库以及组织必须保留在本地以符合监管要求的高度敏感的财务或医疗数据。

## 多云网络

在多云网络中，一个企业的网络中实施了多个云提供商。例如，它可能同时拥有 AWS 和 GCP，或者 AWS 和 Azure 的组合，或者 AWS、Azure 和 GCP 的组合。如果企业还有本地组件，多云网络也可能是混合云网络。无论哪种方式，他们在不同云平台上的网络部分都必须以某种方式连接。否则，他们将拥有多个网络。当你为你的组织进行红队参与时，他们的云策略的原因很重要。这将帮助你了解它如何使用其云网络，从而帮助你了解网络威胁可能如何影响该组织。这些是你在渗透测试中应该模拟的网络威胁。因此，让我们来看看为什么许多组织选择拥有多云网络。

# 为什么一个组织会拥有多云网络

正如我所提到的，AWS、Azure 和 GCP 每个都有一些彼此独特的服务。一个企业可能会发现，最适合其运营需求的 PaaS 和 SaaS 应用程序组合都在不同的云平台上。一个企业可能在 Azure 上使用 OpenAI 服务进行自动客户服务，在 Amazon GameLift 上托管其在线视频游戏服务器，并在 GCP 上使用支付网关处理客户信用卡交易。

Gartner 的副总裁分析师 Michael Warrilow 说：

“大多数组织采用多云策略是出于避免供应商锁定或利用最佳解决方案的愿望。我们预计，大多数大型组织将继续自愿追求这种方法。”

根据 2019 年 Gartner 进行的一项调查，81%的受访者与两个或更多的提供商合作。那至少是几年前的情况。Gartner 预测，全球公共云服务的最终用户支出将从 2022 年的 4903 亿美元增长到 2023 年的 5918 亿美元。也许多云网络现在是一个更大的市场细分。这一点很重要，因为你可能正在对其中一些服务进行渗透测试。

你还应该了解公共云和私有云之间的区别。

直到目前为止，我提到的所有云都是指公共云。使用 AWS、Azure 和 GCP 通常指的是公共云使用。公共云是一个与其他用户、客户和客户共享物理服务器和其他基础设施的云网络。

许多消费类互联网服务都是由公有云驱动的。听 Spotify、看 YouTube、上传个人文件到 Dropbox、通过 Zoom 开会、在 Steam 上购买游戏以及参与多人游戏——这些都是消费者常用的公有云驱动应用方式。而且他们可能都不知道这一点！企业也经常以类似的方式使用公有云服务——通过 Google Docs 协作处理文档、在 Slack 上交流、以及通过 Microsoft Teams 举行会议。

大多数企业使用的 AWS、Azure 和 GCP 也是公有云。第三方基础设施上的私有云服务（如 AWS、Azure、GCP）通常更为昂贵。如果公司注册了如 AWS CodeArtifact 这样的包管理服务，或是 Azure 上的计算机视觉服务用于图像和视频分析，那些都是公有云服务。任何具有免费试用期的服务很可能都是公有云服务。

私有云服务有两种形式。它们可以部署在公司自有场所。一些企业已经在自己的基础设施上复制了云计算模型。或者，AWS、Azure 和 GCP 也提供一些私有云服务。例如，AWS 提供**Amazon 虚拟私有云**（**Amazon VPC**）。

公有云和私有云服务各有其优点和使用场景。

公有云服务通常是企业的优选，因为它们不需要资本支出；企业的会计师可以将其作为运营支出进行预算。从商业角度来看，企业不为产品买单，而是为服务付费。将服务视为运营支出而非资本支出可能会带来税务和法律上的好处。公有云服务通常更具可扩展性，因为不涉及专用的物理或虚拟服务器。只要企业愿意支付服务费用，它们可以根据需要在任何时候高效地使用任意大小的空间。公有云服务对于企业来说还具有较少的管理开销，因为基础设施的维护由第三方负责。

组织可能需要私有云服务的主要原因之一是网络安全。与其他类型的混合云网络中的任何本地组件类似，监管合规性可能要求使用私有云而非公共云。由于企业独占使用私有云，它可以保持更多控制权并实施更严格的安全措施。它可能需要遵守的法规通常适用于敏感的金融或医疗数据。例如，在某些情况下，为了符合**健康保险流通与责任法案**（`HIPAA`，美国的医疗数据法规）或萨班斯-奥克斯利法案（美国的金融数据法规），可能需要使用私有云而非公共云。此外，和非云本地网络使用一样，组织可能会选择在自己的基础设施上部署云计算模型以满足灾难恢复（DR）需求。

混合云网络可能包含非云本地组件、云本地组件，或者第三方基础设施上的私有云组件。如果私有云通过 AWS、Azure 或 GCP 部署在第三方基础设施上，它需要通过私有网络连接到企业本地的客户端机器——通常通过某种形式的**虚拟专用网络**（**VPN**）。

你所在的组织可能正在进行云迁移过程。组织如何迁移到云端将影响其安全态势！因此，我们需要更好地理解云迁移及其复杂性。

# 云迁移过程

云迁移是指一个组织将其数据和服务从本地基础设施迁移到云服务提供商的过程。随着过去 15 到 20 年云市场的快速增长，许多企业已经开始进行云迁移过程。但云迁移并不简单，且可能会执行不当或效果不佳。

所有企业都必须进行仔细规划，以便有效地迁移到云端。根据情况和需求，它们可能更倾向于分阶段迁移到云端，分几个月或几年进行，而不是一次性完成迁移。

在规划云迁移策略时，组织应该了解可能在云迁移过程中发生的问题，以便能够避免这些问题。

在云迁移过程中，企业的服务可能会出现停机现象。根据其迁移到云的方式，部分服务器可能需要完全下线一段时间。如果企业的服务中断，尤其是当客户花费大量资金时，可能会非常不满。在云迁移过程中，企业不仅需要考虑自己的客户群体，还要考虑供应链问题。企业可能需要为停机带来的后果做好计划和准备，或者仔细调整云迁移策略，以确保完全没有停机时间。

互操作性可能是一个问题。企业的应用程序运行在自己的基础设施上，可能与其云服务不完全兼容，需要进行一些调整或修改。如果迁移到的云服务是 IaaS，那么互操作性问题的可能性较小。但有些应用程序需要通过 PaaS 或 SaaS 来实现。在设计云迁移策略时，必须仔细考虑互操作性问题。

关键数据可能在云迁移过程中丢失，可能会面临数据泄露或无法访问的风险。特权访问管理和加密是可以在云迁移过程中使用的安全措施，以避免这一问题。同样，全面盘点迁移到云的所有数据、应用程序和工作负载也非常重要。你无法保护看不见的东西！

已习惯于在本地管理数据和工作负载的员工，可能不熟悉一旦迁移到云端，任务细节会发生怎样的变化。企业可能需要根据其云基础设施和实现细节为组织分配新的角色。员工还需要接受有关所有新技术的培训，这些技术是他们在云迁移过程中及迁移后将使用的。

这些就是云迁移过程中可能出现的一些常见问题。通过仔细的准备和规划，这些问题是可以避免的。企业进行云迁移有许多充分的理由。让我们来看看为什么。

云网络为企业提供了运营灵活性。它们使员工更容易在家工作或在旅行时继续工作。新冠疫情引发了持续的影响。来自世界各地多个实体的科学研究表明，由于新冠长期症状，全球有数百万人因早逝和长期残疾离开了劳动力市场。员工发现，在家工作比必须在现场工作更安全、更高效。聪明的雇主希望保持员工的健康和生产力，理解保护员工免受空气传播疾病的好处。通过云迁移促进在家工作是一项有效的策略。

主要的云平台具有安全控制措施，如果使用得当，可以使得远程访问企业网络在抵御网络攻击方面更加安全。云计算的采用和对远程工作的支持是 21 世纪的商业方式，而那些未能理解这一点的公司正在失去关键的人才。

云迁移可以帮助减少资本支出和相关负担。公司无需为提供额外的空间以运行自己的庞大数据中心支付更多的房地产费用。亚马逊、谷歌和微软在全球所有有人口的大陆上都拥有许多世界上最大的 数据中心。从印度到日本，从美国到印度尼西亚，从法国到南非，许多人和雇主的工作地点距离 AWS、GCP 或 Azure 的数据中心都在 1,000 公里以内。但即使一些雇主距离最近的云平台数据中心有 5,000 公里之遥，他们仍然能够享受快速的数据传输和极低的延迟。此外，这三大云提供商每年都会在全球更多地区增加新的数据中心。对于许多公司来说，用云计算的灵活性和敏捷性替代自己的本地数据中心是显而易见的选择。资本支出的减少也显著改善了他们的财务状况。

尽管一些公司希望将部分网络保留在其内部设施中以便于灾难恢复（因为他们可以对某些基础设施进行物理访问），但其他公司则以灾难恢复为理由迁移到云端。这展示了在现实世界中，运营企业网络的许多实际问题是多么复杂和微妙。AWS、Azure 和 GCP 都有灾难恢复工具，并且为公司提供如何有效使用它们的建议。由于其数据中心的庞大容量，云服务使得公司可以更轻松、更经济地维护 PB 级和 EB 级数据的备份。云平台还提供了有用的工具，帮助组织定期测试备份的可行性，同时存储不同类型的快照。如果一个组织将其所有后端完全移至云端，那么当其设施遭遇洪水、火灾或地震时，数据将更加安全。亚马逊、谷歌和微软还在自己的网络中构建了冗余性和弹性。如果他们的某个国际数据中心发生灾难，已有应急系统确保运营继续进行。此外，他们的物理安全措施已经强化，超出了大多数组织在自己设施中能够做到的程度。

那么，接下来我们来看看云迁移过程。由于每个组织的数据资产和业务操作各不相同，因此每个组织的云迁移过程略有不同。但通常都会有一些共同点。

IBM 为每个组织的云迁移检查清单推荐以下步骤：

1.  首先，组织应清点其工作负载。工作负载是指在其网络中运行的任何数据库、应用程序、容器化系统或服务。确定每个工作负载的大小、复杂性，以及它是否处于生产环境中。

1.  仔细研究每个平台及其应用和服务。AWS、Azure 和 GCP 各自提供数百种独特的服务。一个组织可能在不同的平台上需要不同的服务。应为每个工作负载选择最合适的服务，这可能导致需要使用多云网络。

1.  在选择了服务和云提供商后，下一步是进行成本评估。

1.  接下来，应该指定一个团队来执行迁移。团队中应有具备高级计算机网络和网络安全技能的人员。迁移目标应传达给团队。

1.  确定迁移中有多少工作将由内部团队处理，多少由云提供商处理。所有三大云提供商都提供云迁移服务，组织应验证这些服务的内容。

1.  优先确定应该首先迁移哪些工作负载。在迁移过程中，可能会有一段时间需要将工作负载镜像到本地网络，以使迁移过程尽量减少网络停机时间。

1.  应该制定一个计划，安排迁移过程并概述路线图。整个迁移过程可能需要几个月或几年，具体取决于每个公司的需求和实际情况。

1.  确定企业网络中是否已经存在云服务，以及是否应将其替换为其他云服务或扩展为更大的云工作负载。例如，为什么公司在其 Azure 服务已包含 Microsoft Teams 支持或其 GCP 服务已包含 Google Drive 集成的情况下，还要继续使用 Dropbox？

1.  公司相关方应了解云迁移过程中的预期和迁移后的情况。如果迁移对供应链有任何影响，应将整个供应链纳入考虑范围！

1.  应为云迁移过程设定**关键绩效指标**（**KPIs**），例如：“*50%的数据库流量应发生在我们的 Amazon* *EC2 实例上*。”

1.  应定期与云迁移团队核实和评估进展。最后，在整个过程中的各个阶段——进行测试、复查并根据需要进行调整。

作为一名云渗透测试员，云迁移过程完成后的几个月将是进行渗透测试的绝佳时机。业内的普遍经验是，网络进行重大变更时应进行渗透测试，因为变更可能会带来新的安全漏洞。虽然渗透测试和红队任务不只有在这个时机才需要进行，但这确实是进行渗透测试的一个关键时刻。

了解云中的安全责任将直接影响你作为云渗透测试员的日常工作！你必须了解自己可以做什么、不能做什么以及为什么。我们来看看安全责任和共享责任模型。

# 云中的安全责任

作为云渗透测试员，理解云中的共享责任模型非常重要。涉及的两个实体是使用云服务的组织和云服务提供商。当你进行红队演练时，组织是你报告的对象，无论你是雇员还是第三方承包商。

总体而言，组织和云服务提供商共同承担安全责任，这通常被称为共享责任模型。然而，云安全控制和责任在这两个实体之间是划分开的。

了解云服务提供商和你所在组织各自的安全责任非常重要。在每次渗透测试或红队演练开始时，你将签署一份合同，合同中将明确渗透测试的范围以及你被允许和不被允许做的事情。你必须严格遵守合同，并仅在指定范围内进行渗透测试。当你对云网络进行渗透测试时，你不仅仅是在模拟攻击你雇主的环境，还在模拟攻击 AWS、Azure 或 GCP 的基础设施。云服务提供商有自己的规则，规定了你能做和不能做的事情。如果你之前做过本地网络的渗透测试，你可能会发现，在云环境中进行渗透测试时，范围和权限要比本地网络更为有限。

你必须确保完全理解每个云服务提供商的渗透测试政策。你应该仔细阅读与你的雇主签署的合同，但你也应自行进行研究，核实每个云平台允许你做什么。你的雇主可能会要求你进行渗透测试，但这种测试可能会违反云服务提供商的政策。在这种情况下，遵守云服务提供商的政策是最重要的。你应该向雇主解释他们要求的渗透测试如何违反云服务提供商的政策。然后，你和你所在的组织可以修改渗透测试计划，使其符合云服务提供商的政策。

在所有三大平台——AWS、Azure 和 GCP——上，平台负责“*云的安全*”，而你的组织则负责“*云中的安全*”。

云平台始终对其物理基础设施和设施的安全负责。例如，如果恶意攻击者伪装成云服务提供商的员工进入数据中心，窃取大量数据存储设备，那么云服务提供商将对这一事件完全负责。您的组织如何可能对这次攻击负责呢？毕竟，贵组织的任何人员根本没有物理访问云服务提供商的数据中心。

贵组织始终对贵组织开发和维护的软件的安全负责。对于云服务提供商未提供的任何软件，贵组织也需负责其安全。例如，如果您使用的是一个云服务，AWS、Azure 或 GCP 为您提供了他们自己的**虚拟机**（**VMs**），那么这些虚拟机中操作系统的安全责任由云服务提供商承担。但如果贵组织在云服务提供商的基础设施中安装了自己的虚拟机，那么这些虚拟机的安全责任完全由贵组织负责。如果我没有对宿主机的 root 或管理员权限，我不能对虚拟机的更新负责，这应该由云服务提供商来处理。如果云服务提供商提供给我虚拟机并且赋予 root 或管理员权限，那么虚拟机的更新就由我负责。某些云平台专门部署的虚拟机会得到云服务提供商的完全支持进行更新，但这并非总是如此。如果贵组织使用云平台的 API，那么贵组织使用的应用程序是贵组织的责任，但 API 连接到的云平台的软件和服务则是云平台的责任。

通常来说，共享责任模型的划分与贵组织使用的服务类型（IaaS、PaaS 或 SaaS）相关。如果 AWS、Azure 或 GCP 为贵组织提供的是 SaaS，那么云服务提供商承担大部分责任，而作为渗透测试员，您可以执行的操作最为有限。如果 AWS、Azure 或 GCP 为贵组织提供的是 IaaS，那么贵组织承担大部分责任，并且在模拟网络攻击时，您作为渗透测试员能够做的事情要多得多。PaaS 则处于二者之间。

根据 AWS 的共享责任模型，贵组织负责客户数据的安全、贵组织自身的平台、应用程序和**身份与访问管理**（**IAM**）系统的安全、贵组织自身操作系统的安全、网络与防火墙配置的安全、客户端数据的安全、加密、数据完整性认证、服务器端加密以及网络流量保护。AWS 则负责其计算、存储、数据库和网络软件，以及所有硬件和全球基础设施的安全。

根据 Azure 的共享责任模型，你的组织始终负责其信息和数据、个人计算机和移动设备以及账户和身份。Azure 始终负责其物理主机、物理网络和物理数据中心。根据你的 Azure 服务是 SaaS、PaaS 还是 IaaS，身份和目录基础设施、应用程序、网络控制和操作系统的责任可能有所不同。

根据 GCP 的共享责任模型，你的组织始终对其内容和访问政策负责。这适用于 SaaS、PaaS 和 IaaS 服务。如果你的 GCP 服务是 PaaS，你的组织还需负责使用、部署和 Web 应用程序的安全。如果你的 GCP 服务是 IaaS，你的组织需要承担 SaaS 和 PaaS 的所有责任，并且还需负责身份、操作、访问和认证、网络安全、来宾操作系统、数据和内容。GCP 始终负责审计日志、自己的网络、存储和加密、加固内核和 IPC、引导过程以及其硬件。

让我们简要总结一下每个云服务提供商的渗透测试政策。相关链接将在*第十三章*的*进一步阅读*部分提供，*最佳实践与总结*中也会有相关信息。请务必直接从其网站验证其政策，以防其政策有所变动。

## AWS

只要你遵守 AWS 的政策，AWS 允许进行渗透测试。无论是你还是你工作的组织，都不需要联系 AWS 进行渗透测试。只要你遵守 AWS 的政策，你就可以根据需要进行渗透测试和红队演练。

这些是你可以进行渗透测试的 AWS 服务（前提是你遵守 AWS 的政策）([`aws.amazon.com/security/penetration-testing/`](https://aws.amazon.com/security/penetration-testing/)):

+   Amazon EC2 实例、WAF、NAT 网关和弹性负载均衡器

+   Amazon RDS

+   Amazon CloudFront

+   Amazon Aurora

+   Amazon API 网关

+   AWS AppSync

+   AWS Lambda 和 Lambda Edge 函数

+   Amazon Lightsail 资源

+   Amazon 弹性 Beanstalk 环境

+   Amazon 弹性容器服务

+   AWS Fargate

+   Amazon Elasticsearch

+   Amazon FSx

+   Amazon Transit Gateway

+   S3 托管的应用程序（但 S3 存储桶是严格禁止的）

以下是你和你的组织*禁止*进行的渗透测试活动：

+   通过 Amazon Route 53 托管区域进行 DNS 区域遍历

+   通过 Route 53 进行 DNS 劫持

+   通过 Route 53 进行 DNS 欺骗

+   **拒绝服务攻击**(**DoS**)、**分布式拒绝服务攻击**(**DDoS**)、模拟 DoS、模拟 DDoS（这些活动受限于*DDoS 模拟* *测试*政策）

+   端口洪水攻击

+   协议洪水攻击

+   请求洪水攻击（登录请求洪水、API 请求洪水）

如果你作为红队的一部分进行渗透测试，你是在进行对抗性安全模拟。如果你计划在 AWS 内进行对抗性安全模拟，你必须提交一个模拟事件表单，供 AWS 决定是否授予你和你的组织权限。模拟事件表单可以在你的 AWS 控制台中找到，请在那里进行搜索。

网络压力测试是通过发送大量合法流量进行的性能测试，目的是测试在这些条件下你的 AWS 服务的运行效果。Amazon EC2 针对这种情况有一个具体的网络压力测试政策。你可以在*第十三章*的 *进一步阅读* 部分找到相关链接，了解 *最佳实践* 和 *总结*。

DDoS 攻击是指网络威胁行为者故意和恶意地通过流量压垮目标网络，从而迫使其无法服务。DDoS 攻击模拟可能是你红队演练的一部分。AWS 有专门的 DDoS 攻击模拟政策 ([`aws.amazon.com/security/ddos-simulation-testing/`](https://aws.amazon.com/security/ddos-simulation-testing/))。

模拟钓鱼（通过社会工程攻击从人类用户处获取敏感信息）和恶意软件测试也可能是红队演练的一部分。在这种情况下，你必须提交模拟事件表单，供 AWS 决定是否授予你和你的组织权限。

## Azure

只要遵守其政策，Microsoft Cloud（包括但不限于 Azure）允许进行渗透测试。只要你遵守 Microsoft Cloud 的政策、进行渗透测试并在需要时进行红队演练，你和你所在的组织不需要联系 Microsoft。Microsoft Cloud 包括 Azure Active Directory（将更名为 Microsoft Entra ID）、Microsoft Intune、Microsoft Azure、Microsoft Dynamics 365、Microsoft Power Platform、Microsoft Account、Office 365 和 Azure DevOps。

Microsoft Cloud *禁止* 在渗透测试和红队演练中进行以下活动：

+   扫描或测试属于任何其他 Microsoft Cloud 客户的资产。

+   获取任何非完全属于你所在组织的数据。

+   所有的拒绝服务（DoS）测试（包括分布式拒绝服务攻击模拟）。

+   对任何资产进行网络密集型模糊测试，除了你所在组织的 Azure 虚拟机。

+   自动化测试会产生大量流量的服务。（“大量流量”在 Microsoft Cloud 的 *参与规则* 中并没有明确规定。请根据你的判断进行处理。）

+   故意访问其他客户的数据。客户是指使用 Microsoft Cloud 服务的其他组织。

+   超出**概念验证**（**PoC**）复制步骤的基础设施执行问题。

+   以任何方式违反其政策。

+   对 Microsoft 员工进行钓鱼或其他社会工程攻击。

Microsoft Cloud *鼓励*以下活动：

+   创建少量的测试账户或试用租户，以演示跨账户或跨租户的数据访问。但不要访问属于微软云其他客户的账户。

+   对贵组织自己的 Azure 虚拟机进行模糊测试、端口扫描，并使用漏洞评估工具。

+   通过生成预计在正常业务过程中看到的流量，包括高峰容量，来对贵组织的应用程序进行负载测试。

+   测试安全监控和检测（例如来自异常安全日志的检测）。

+   尝试突破共享服务容器（即 Azure 网站或 Azure Functions）。但是如果成功了，您必须立即向微软报告，并且不要进一步深入。绝不要访问其他微软云客户的数据。

+   在 Microsoft Intune 中应用条件访问或**移动应用管理**（**MAM**）策略，以相应地测试限制的执行。

## GCP

GCP 允许渗透测试，只要您遵守其政策。无论您还是您所在的组织，都无需联系 GCP 进行渗透测试。只要遵循 GCP 的政策，您可以根据需要进行渗透测试和红队演练。您必须参考的政策是*Google Cloud Platform 可接受使用政策*和*Google Cloud Platform 服务条款*。您可以在*第十三章*的*进一步阅读*部分找到这些链接，*最佳实践*和*总结*。

根据*可接受使用政策*，您和您的组织*禁止*做以下事情：

+   分发任何类型的恶意软件、损坏文件、恶作剧或其他具有破坏性或欺骗性质的项目。

+   获取未经授权的访问、破坏或损害任何 Google 服务或用于提供这些服务的设备，以及任何 GCP 的其他客户或经销商。

+   禁用、干扰或规避 Google 软件、服务或 Google 设备的任何方面。

每个云提供商提供广泛的产品和服务。无论某项服务是 IaaS、PaaS 还是 SaaS，这些分类都会影响贵组织如何使用它们，以及作为渗透测试人员可以做或不能做的事情。让我们来探讨不同类型的云服务。

# IaaS、PaaS 和 SaaS 之间的区别

AWS、Azure 和 GCP 提供的所有服务都是 SaaS、PaaS 或 IaaS。这些云服务的分类将直接影响您在进行渗透测试时可以做什么，正如我之前所解释的。因此，了解这些服务类型之间的区别至关重要！

SaaS 意味着云提供商为您的组织提供大量组件——一切运行所需的基础设施、其软件平台及相关 API，以及其软件的应用级功能。例如，当我们使用 Gmail 时，我们正在使用一个完全的 SaaS 应用程序。AWS 将 SaaS 定义为：

“SaaS 是一种业务和软件交付模式，允许组织以低摩擦、以服务为中心的方式提供其解决方案。”

您的组织将数据存入服务中，但并没有进行太多或任何软件应用开发。贵组织对 SaaS 的安全关注主要是如何配置服务以及将哪些数据放入该服务。作为渗透测试员，您的操作会受到限制。但是，通常情况下，模拟不渗透到云服务商自身平台的网络攻击是可以的，同时测试不同的 SaaS 配置也是允许的。

PaaS 本质上为您的组织提供了云服务商的基础设施和平台。您可以将云服务商的平台视为类似操作系统的东西，但并不完全相同。这是 AWS 对 PaaS 的定义：

“PaaS 消除了组织管理基础设施（通常是硬件和操作系统）的需求，并使您可以专注于应用程序的部署和管理。这有助于提高效率，因为您不需要担心资源采购、容量规划、软件维护、打补丁或任何其他运行应用程序时所涉及的重复性繁重工作*。*”

IaaS 为您的组织提供云服务商的基础设施，其中包括服务器、网络设备和物理网络。贵组织使用的大多数软件和数据归贵组织所有。正如 AWS 所解释的那样：

“IaaS，有时缩写为 IaaS，包含云 IT 的基本构建模块，通常提供网络功能、计算机（虚拟或专用硬件）和数据存储空间的访问。”

作为渗透测试员，您将在每个云服务商的 IaaS 服务中，获得更多模拟网络攻击的权限。

所以，您现在已经理解了混合云、多云、全云、IaaS、PaaS、SaaS、云迁移以及组织如何使用您将进行渗透测试的各种云网络。

# 总结

通过本章，您现在理解了测试目标的基本性质——云网络。在本书的后续章节中，我将解释作为红队员在 AWS、Azure 和 GCP 中特定的更多信息。但在下一章中，我们将探讨云网络通常是如何遭受网络攻击的。在一次云渗透测试中，云是“什么”，而您模拟的网络攻击则是“如何”。

# 进一步阅读

要了解本章所涉及的更多内容，您可以访问以下链接：

+   *什么是红队* *？*: [`www.synopsys.com/glossary/what-is-red-teaming.html`](https://www.synopsys.com/glossary/what-is-red-teaming.html)

)

+   *关于* *AWS*: [`aws.amazon.com/about-aws/`](https://aws.amazon.com/about-aws/)

)

+   *Google Cloud 平台的历史*：[`acloudguru.com/blog/engineering/history-google-cloud-platform`](https://acloudguru.com/blog/engineering/history-google-cloud-platform)

)

+   *微软 Azure 的历史*：[`techcommunity.microsoft.com/t5/educator-developer-blog/the-history-of-microsoft-azure/ba-p/3574204`](https://techcommunity.microsoft.com/t5/educator-developer-blog/the-history-of-microsoft-azure/ba-p/3574204)

)

+   *云计算的好处是什么？*（IBM）：[`www.ibm.com/topics/cloud-computing-benefits`](https://www.ibm.com/topics/cloud-computing-benefits)

)

+   *什么是云网络？*：[`www.cisco.com/c/en/us/solutions/cloud/what-is-cloud-networking.html`](https://www.cisco.com/c/en/us/solutions/cloud/what-is-cloud-networking.html)

)

+   *容器的简史*：[`d2iq.com/blog/brief-history-containers`](https://d2iq.com/blog/brief-history-containers)

)

+   *什么是 DevSecOps？来自* *PortSwigger* 的指南：[`portswigger.net/solutions/devsecops/guide-to-devsecops`](https://portswigger.net/solutions/devsecops/guide-to-devsecops)

)

+   *多云与混合云：10 个关键* *对比*：[`www.spiceworks.com/tech/cloud/articles/multi-cloud-vs-hybrid-cloud/`](https://www.spiceworks.com/tech/cloud/articles/multi-cloud-vs-hybrid-cloud/)

)

+   *Gartner 表示云将成为新数字体验的核心*：[`www.gartner.com/en/newsroom/press-releases/2021-11-10-gartner-says-cloud-will-be-the-centerpiece-of-new-digital-experiences`](https://www.gartner.com/en/newsroom/press-releases/2021-11-10-gartner-says-cloud-will-be-the-centerpiece-of-new-digital-experiences)

)

+   *什么是云迁移？*（IBM）：[`www.ibm.com/topics/cloud-migration`](https://www.ibm.com/topics/cloud-migration)
