# 第十章 无线局域网渗透测试方法论

|   | *“实践出真知。”* |   |
| --- | --- | --- |
|   | --*流行说法* |

*本章将概述将前几章中教授的技巧转化为完整无线渗透测试的步骤。*

# 无线渗透测试

为了执行无线渗透测试，重要的是要遵循定义好的方法论。简单地启动`airbase`或`airodump`命令并希望得到最好的结果，是无法满足测试目标的。作为渗透测试者，你必须确保遵循你所服务组织的标准，如果他们没有相关标准，那么你应该遵循最高标准。

广义上，我们可以将无线渗透测试活动分为以下几个阶段：

1.  规划阶段

1.  发现阶段

1.  攻击阶段

1.  报告阶段

现在我们将单独查看这些阶段。

# 规划

在此阶段，我们必须理解以下内容：

+   **评估范围**：渗透测试者应与客户合作，定义一个可实现的范围，并且能够提供最大程度的网络安全洞察。通常，收集以下信息：

    +   渗透测试的位置。

    +   场地的总覆盖范围。

    +   估算部署的接入点和无线客户端的数量。

    +   评估中包括哪些无线网络？

    +   是否在范围内进行利用？

    +   攻击用户是否在范围内？

    +   拒绝服务攻击是否在范围内？

+   **工作量估算**：根据已定义的范围，测试者需要估算所需时间。请记住，在此估算之后可能会重新定义范围，因为组织可能在时间和资金上都有限制。

+   **合法性**：在进行测试之前，客户必须给予同意。这应该说明所涵盖的测试内容，并明确界定赔偿、保险和范围的限制。如果你不确定，需与相关领域的专业人士沟通。大多数组织会有自己的版本，可能还会包含**保密协议**（**NDA**）。

一旦所有前置要求到位，我们就准备好了！

# 发现

在此阶段，目标是识别并应用无线设备和无线网络的特征。

所有执行这些操作的技巧已经在前几章中阐述，但简而言之，目标是：

+   列举区域内可见和隐藏的无线网络

+   列举区域内的设备，以及连接到目标网络的设备

+   映射网络的范围，了解它们的可达性以及是否存在恶意个人可以利用的地方来发起攻击，例如，一家咖啡馆。

所有这些信息都应被记录。如果测试仅限于侦查阶段，那么测试将到此为止，测试者将尝试根据这些信息得出结论。以下是一些对客户有用的陈述：

+   拥有与开放网络及公司网络相关联的设备数量

+   可以通过 WiGLE 等解决方案将设备与位置链接的网络数量

+   存在弱加密

+   网络限制过于严格，阻止了标准用户

# 攻击

一旦完成侦查，必须进行利用，以证明概念是否有效。如果该攻击是作为红队或更大范围评估的一部分进行的，那么利用应该尽可能悄悄地获得对网络的访问权限。

在我们的攻击阶段，我们将探索以下内容：

+   破解加密

+   攻击基础设施

+   妥协客户端

+   查找脆弱的客户端

+   查找未经授权的客户端

## 破解加密

第一步是获取任何已识别的脆弱网络的密钥。如果存在 WEP 网络，请执行第四章中解释的 WEP 破解方法，*WLAN 加密漏洞*。无论你是否能够破解它，WEP 的存在仍然被视为一种漏洞。如果存在 WPA2 保护的系统，你有两种选择。如果希望保持隐秘，可以选择在人员可能进行身份验证或重新验证的时间到达现场。此类时间通常为：

+   一天开始时

+   午餐时间

+   一天结束时

此时，设置你的 WPA 密钥获取配置，如第四章中所示，*WLAN 加密漏洞*。或者，执行去认证攻击，如第六章中所示，*攻击客户端*。

这在成熟的组织中更加嘈杂，更容易被发现。

如果已经部署了 WPA-Enterprise，请记住你需要利用侦查中收集的信息来瞄准正确的网络，并设置你的虚拟企业配置，如第九章中的*攻击 PEAP*部分所示，*攻击 WPA-Enterprise 和 RADIUS*。

你可以尝试破解所有密码短语，但请记住，某些密码是无法破解的。测试完成后，向无线管理员确认正在使用的密码短语。检查它是否为安全密码短语，确保你作为测试者没有遇到工具故障，或者仅仅是运气不好。

## 攻击基础设施

如果通过破解加密获得了网络访问权限，并且该测试被允许在范围内进行渗透测试，则应至少执行以下操作：

+   端口扫描

+   确定哪些服务正在运行

+   枚举任何开放的服务，如未认证的 FTP、SMB 或 HTTP

+   利用任何已识别的漏洞服务

## 攻击客户端

在枚举和测试所有无线系统后，有多种参与方式适合对客户端进行攻击。

如果需要，在确定哪些客户端容易受到 KARMA 攻击之后，创建一个蜜罐，迫使它们按照*攻击 PEAP*章节中第九章的内容进行连接，*攻击 WPA-Enterprise 和 RADIUS*。通过此方法可以收集到许多有用的信息，但请确保收集到的数据是有意义的，并以伦理和安全的方式进行存储、传输和使用。

# 报告

最后，在测试结束时，必须将你的发现报告给客户。确保报告的质量与测试的质量相匹配非常重要。因为客户只会看到报告，你必须像对待测试一样给予它足够的关注和用心。以下是报告布局的指南：

1.  管理总结

1.  技术总结

1.  发现：

    +   漏洞描述

    +   严重性

    +   受影响的设备

    +   漏洞类型—软件/硬件/配置

    +   修复

1.  附录

**管理总结**应面向高级非技术观众，重点讨论高层次的影响和所需的缓解措施。避免过于技术化的语言，确保涵盖根本原因。

**技术总结**应在管理总结和发现列表之间找到平衡。它应面向开发者或技术负责人，重点讨论如何修复问题和可以实施的广泛解决方案。

发现列表应以低层次描述每个漏洞，解释识别、复制漏洞的方法。

附录应包含任何在简短描述中无法涵盖的额外信息。在这里，任何屏幕截图、概念验证代码或被盗数据应予以展示。

# 总结

在本章中，我们讨论了一种执行各种无线测试的方法，并参考了每个步骤的相关章节。我们还列出了报告漏洞的方法和使技术数据易于展示的技巧。在下一章也是最后一章中，我们将介绍自本书首次出版以来开发的新技术，包括 WPS 和用于监控监视的探针。
