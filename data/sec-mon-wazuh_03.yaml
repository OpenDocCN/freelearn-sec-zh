- en: '3'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '3'
- en: Threat Intelligence and Analysis
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 威胁情报与分析
- en: According to a Ponemon Institute study ([https://webroot-cms-cdn.s3.amazonaws.com/9114/5445/5911/ponemon-importance-of-cyber-threat-intelligence.pdf](https://webroot-cms-cdn.s3.amazonaws.com/9114/5445/5911/ponemon-importance-of-cyber-threat-intelligence.pdf)),
    organizations with robust threat intelligence respond to cyberattacks 53% faster,
    highlighting its importance in threat analysis, incident response, and mitigation.
    Simply put, threat intelligence is data that is gathered, processed, and studied
    to figure out why a threat actor does what they do, who they attack, and how they
    do it. Threat intelligence data empowers security operations teams to proactively
    defend against potential security incidents, improving their ability to detect,
    analyze, and eradicate the threat effectively. When you integrate threat intelligence
    capabilities into the Wazuh platform, **security operations center** (**SOC**)
    analysts can get more context for each security alert. In this chapter, we aim
    to enhance Wazuh’s threat intelligence capabilities. To achieve this, we will
    leverage the **Malware Information Sharing Platform** (**MISP**), an open-source
    project designed for the collection and sharing of threat intelligence. Additionally,
    we will incorporate TheHive/Cortex, a comprehensive suite tailored for scalable
    threat analysis and incident response. By integrating these tools with Wazuh,
    we enable security teams to conduct thorough threat analyses and streamline incident
    response processes. This integration facilitates the automation of threat intelligence
    tasks, resulting in reduced response times and enhanced security for organizations.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 根据Ponemon研究所的一项研究（[https://webroot-cms-cdn.s3.amazonaws.com/9114/5445/5911/ponemon-importance-of-cyber-threat-intelligence.pdf](https://webroot-cms-cdn.s3.amazonaws.com/9114/5445/5911/ponemon-importance-of-cyber-threat-intelligence.pdf)），拥有强大威胁情报的组织对网络攻击的响应速度要快53%，突显了其在威胁分析、事件响应和缓解中的重要性。简单来说，威胁情报是收集、处理和研究的数据，旨在弄清楚威胁行为者为什么这样做、攻击谁以及如何做。威胁情报数据使安全运营团队能够主动防御潜在的安全事件，提高其检测、分析和有效消除威胁的能力。当你将威胁情报功能集成到Wazuh平台时，**安全运营中心**（**SOC**）分析师可以为每个安全警报获取更多的背景信息。在本章中，我们旨在增强Wazuh的威胁情报功能。为此，我们将利用**恶意软件信息共享平台**（**MISP**），一个旨在收集和共享威胁情报的开源项目。此外，我们还将整合TheHive/Cortex，这是一个专为可扩展的威胁分析和事件响应量身定制的综合工具套件。通过将这些工具与Wazuh集成，我们使安全团队能够进行彻底的威胁分析并简化事件响应过程。这种集成促进了威胁情报任务的自动化，减少了响应时间并增强了组织的安全性。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: What is threat intelligence?
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 什么是威胁情报？
- en: Automated threat intelligence
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动化威胁情报
- en: Setting up TheHive and Cortex
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置TheHive和Cortex
- en: Setting up an MISP project
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置MISP项目
- en: Integrating Wazuh and TheHive
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Wazuh与TheHive的集成
- en: Integrating TheHive and Cortex with MISP
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将TheHive和Cortex与MISP集成
- en: Use cases
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用案例
- en: What is threat intelligence?
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 什么是威胁情报？
- en: '**Threat intelligence**, or **cyber threat Intelligence**, is basically knowledge
    about threat actors (an individual or group of attackers that carry out hacking
    campaigns against companies or government bodies), their motives, and their capabilities.
    Threat intelligence is all about staying on top of the latest threats and risks
    lurking on the internet. Threat intelligence enables us to make faster, more informed,
    data-backed security decisions and change our behavior from reactive to proactive
    in the fight against attackers. Threat intelligence helps every domain of cybersecurity,
    including SOC analysts, intel analysts, **chief information security officers**
    (**CISOs**), etc. By collecting and analyzing threat intelligence information,
    organizations can be empowered through early detection and prevention, informed
    decision-making using context, improved incident response, a better understanding
    of attackers’ tactics, **techniques, and procedures** (**TTPs**), better security
    defense against growing threats, and more.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '**威胁情报**，或称**网络威胁情报**，基本上是关于威胁行为者（实施针对公司或政府机构的黑客攻击活动的个人或团体）、他们的动机和能力的知识。威胁情报的核心是保持对互联网中潜藏的最新威胁和风险的了解。威胁情报使我们能够做出更快、更有根据的安全决策，并将我们的行为从反应式转变为主动式，从而更有效地应对攻击者。威胁情报有助于网络安全的各个领域，包括SOC分析师、情报分析师、**首席信息安全官**（**CISOs**）等。通过收集和分析威胁情报信息，组织可以通过提前检测和预防、基于上下文的决策、改进的事件响应、更好地理解攻击者的战术、**技术和程序**（**TTPs**），以及对不断增长的威胁提供更好的安全防御等，来提升自身的防御能力。'
- en: 'In this section, we will talk about:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将讨论：
- en: Types of threat intelligence
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 威胁情报的类型
- en: How SOC analysts use threat intelligence
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SOC分析师如何使用威胁情报
- en: Types of threat intelligence
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 威胁情报的类型
- en: 'In the constantly changing world of cybersecurity, companies that want to strengthen
    their defenses must stay ahead of new risks and utilize threat intelligence. Threat
    intelligence is mainly offered in three types: *tactical intelligence*, *operational
    intelligence*, and *strategic intelligence*. By using these types of threat intelligence,
    businesses can not only learn about how threat actors’ strategies change over
    time but also plan their defenses to successfully deal with cyber threats that
    are always changing. Let’s understand all three types of threat intelligence in
    detail:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在网络安全日新月异的世界里，想要加强防御的公司必须走在新风险的前面，并利用威胁情报。威胁情报主要分为三种类型：*战术情报*、*操作情报*和*战略情报*。通过使用这些类型的威胁情报，企业不仅可以了解威胁行为者的策略随时间的变化，还可以规划他们的防御，以应对始终变化的网络威胁。让我们详细了解这三种类型的威胁情报：
- en: '**Tactical intelligence**: Tactical intelligence is concerned with the immediate
    future, is technical in nature, and identifies simple **indicators of compromise**
    (**IOC**). IOCs are technical information collected during investigations, threat-hunting
    activities, or malware analyses. IOCs are actual pieces of data, such as IP addresses,
    domains, file hashes, etc. They can even be collected via open source and free
    data feeds such as:'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**战术情报**：战术情报关注的是近期的未来，具有技术性质，能够识别简单的**妥协指标**（**IOC**）。IOC是指在调查、威胁狩猎活动或恶意软件分析过程中收集的技术信息。IOC是实际的数据片段，如IP地址、域名、文件哈希等。它们甚至可以通过开源和免费的数据源收集，例如：'
- en: AlienVault OTX ([https://otx.alienvault.com/](https://otx.alienvault.com/)
  id: totrans-19
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: AlienVault OTX ([https://otx.alienvault.com/](https://otx.alienvault.com/))
- en: Abuse.ch ([https://abuse.ch/](https://abuse.ch/))
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Abuse.ch ([https://abuse.ch/](https://abuse.ch/))
- en: Blocklist.de ([https://www.blocklist.de](https://www.blocklist.de)), and
  id: totrans-21
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Blocklist.de ([https://www.blocklist.de](https://www.blocklist.de))，以及
- en: Proofpoint Emerging Threats ([https://rules.emergingthreats.net](https://rules.emergingthreats.net)).
  id: totrans-22
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Proofpoint Emerging Threats ([https://rules.emergingthreats.net](https://rules.emergingthreats.net))。
- en: This tactical intelligence data is consumed by IT analysts and SOC analysts.
    It typically has a very short lifespan because IOCs such as malicious IP addresses
    or domain names can become obsolete in a matter of days or even hours.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这些战术情报数据由IT分析师和SOC分析师使用。由于IOC如恶意IP地址或域名可能在几天或几小时内过时，因此它们的生命周期通常非常短。
- en: '**Operational intelligence**: Every attack has a “*who*,” a “*why*,” and a
    “*how*.” The “*who*” is referred to as identification. The “*why*” is referred
    to as motivation or intent. The “*how*” is made up of the threat actor’s TTPs.
    This gives the blue team or security operations team insight into how adversaries
    plan, conduct, and sustain campaigns and major operations. This is called operational
    intelligence. Tactical intelligence plus human analysis gives this intelligence
    a longer useful lifespan.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**运营情报**：每一次攻击都有一个“*谁*”、一个“*为什么*”和一个“*如何*”。“*谁*”指的是身份识别；“*为什么*”指的是动机或意图；“*如何*”由威胁行为者的战术、技术和程序（TTPs）组成。这使得蓝队或安全运营团队可以洞察敌方如何规划、实施并维持攻击活动和重大操作。这被称为运营情报。战术情报加上人工分析，能使这类情报具备更长的有效生命周期。'
- en: '**Strategic intelligence**: Strategic intelligence assists decision-makers
    in understanding the threats that cyber threats pose to their organizations. With
    this knowledge, they can make cybersecurity investments that protect their organizations
    while also aligning with their strategic priorities. CISOs and management teams
    are the real consumers of this intelligence. Strategic intelligence requires human
    data collection and analysis, which requires a deep understanding of cybersecurity
    and geopolitics. Strategic intelligence is usually prepared in the form of reports.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**战略情报**：战略情报帮助决策者了解网络威胁对其组织构成的威胁。通过这些知识，他们可以做出相应的网络安全投资，不仅保护组织安全，还能与组织的战略优先事项相一致。CISO
    和管理团队是这种情报的主要受众。战略情报需要人工数据收集与分析，这要求具备深入的网络安全和地缘政治知识。战略情报通常以报告的形式呈现。'
- en: Combining these different types of threat data can help businesses create complete
    and flexible cyber defenses against a wide range of cyber threats.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些不同类型的威胁数据结合起来，有助于企业建立全面、灵活的网络防御，以应对各种网络威胁。
- en: Next, we will focus on how SOC analysts can consume threat intelligence data
    (especially tactical and operational intelligence) for better detection and analysis
    of threats.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将重点讨论 SOC 分析师如何使用威胁情报数据（尤其是战术情报和运营情报）来更好地检测和分析威胁。
- en: How SOC analysts use threat intelligence
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SOC 分析师如何使用威胁情报
- en: 'In the previous section, we learned how SOC teams utilize both tactical and
    operational intelligence information. Threat intelligence provides valuable information
    about the latest threats, attack methods, malicious actors, and vulnerabilities.
    Let’s talk about the practical steps SOC analysts take when using threat intelligence:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，我们了解了 SOC 团队如何利用战术和运营情报。威胁情报提供了关于最新威胁、攻击方法、恶意行为者和漏洞的宝贵信息。接下来，我们将讨论 SOC
    分析师在使用威胁情报时的实际步骤：
- en: '**Gather observables**: Observables are pieces of possible threat information.
    Examples include IP addresses, domain names, URLs, file hashes, email addresses,
    and more. Observables can be collected via SIEM tools, EDR, email security tools,
    open source and free threat intelligence feeds, etc.'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**收集观察项**：观察项是潜在的威胁信息片段。例子包括 IP 地址、域名、URL、文件哈希值、电子邮件地址等。观察项可以通过 SIEM 工具、EDR、电子邮件安全工具、开源和免费威胁情报数据源等进行收集。'
- en: '**Enrichment and context**: After identifying suspicious observables, gather
    context and enrich the information to better understand the threat. For example,
    you discovered an IP address (123.45.67.89) connecting to a newly registered domain
    ([malicious-website.com](http://malicious-website.com)). You begin by enriching
    this data by searching threat intelligence databases and historical data. This
    IP address has previously been linked to several phishing campaigns, and the domain
    is hosted in a high-risk region known for cybercriminal activity.'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**威胁信息丰富化与背景分析**：在识别出可疑的观察项后，收集背景信息并丰富数据，以便更好地理解威胁。例如，你发现一个 IP 地址（123.45.67.89）连接到一个新注册的域名（[malicious-website.com](http://malicious-website.com)）。你可以通过查询威胁情报数据库和历史数据来丰富这个数据。这个
    IP 地址之前曾与多个钓鱼攻击活动有关，而该域名位于一个以网络犯罪活动闻名的高风险区域。'
- en: '`123.45.67.89`'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`123.45.67.89`'
- en: 'Domain IOC: [malicious-website.com](http://malicious-website.com)'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 域名 IOC：[malicious-website.com](http://malicious-website.com)
- en: 'URL path IOC: [malicious-website.com/login](http://malicious-website.com/login)'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: URL 路径 IOC：[malicious-website.com/login](http://malicious-website.com/login)
- en: These IOCs are now added to the security tools in your organization, such as
    firewalls, intrusion detection systems, and SIEM solutions. If any of these IOCs
    are matched, it indicates malicious activity that warrants investigation.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 这些IOC现已被添加到贵组织的安全工具中，如防火墙、入侵检测系统和SIEM解决方案。如果匹配到这些IOC中的任何一项，表示存在恶意活动，需进一步调查。
- en: '**Detection and response**: With the enhanced IOCs in place, the security systems
    of your organization, such as SIEM, IDS, or XDR, actively monitor network traffic
    and logs for matches against these indicators. When a match is discovered, an
    alert is generated, and the SOC team is prompted to initiate incident response
    procedures. For example, an employee clicks a link that leads to the IOC-mentioned
    URL path ([malicious-website.com/login](http://malicious-website.com/login)).
    This triggers an alert in the intrusion detection system of your organization
    (e.g. Suricata). The SOC team investigates the incident after receiving the alert.
    They verify that the user’s computer has visited a malicious URL and may have
    been exposed to malware. The SOC team isolates the compromised system, initiates
    malware analysis, and initiates the containment and eradication processes to prevent
    further spread.'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**检测与响应**：通过实施增强的IOC，贵组织的安全系统（如SIEM、IDS或XDR）会积极监控网络流量和日志，检查是否与这些指标匹配。一旦发现匹配，就会生成警报，SOC团队将启动事件响应程序。例如，员工点击了一个指向IOC中提到的URL路径的链接（[malicious-website.com/login](http://malicious-website.com/login)）。这会触发贵组织入侵检测系统（例如Suricata）中的警报。SOC团队在接到警报后会调查事件。他们确认用户的计算机访问了恶意URL，并可能遭遇了恶意软件。SOC团队会隔离受感染的系统，进行恶意软件分析，并启动遏制和清除过程，以防止进一步传播。'
- en: '**Continuous improvement**: After the incident has been resolved, the SOC team
    conducts a post-incident analysis. This involves evaluating the efficacy of the
    threat detection process, refining the IOCs, and learning from past responses
    to improve future response strategies. During analysis, the SOC team determines
    that the phishing attempt originated from an email with a subject line referencing
    a fake job offer. They decide to add email subject patterns to their IOCs to detect
    similar phishing campaigns more effectively in the future.'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**持续改进**：事件解决后，SOC团队进行事后分析。这包括评估威胁检测过程的效果，完善IOC，并从过去的响应中学习，以改进未来的响应策略。在分析过程中，SOC团队确定钓鱼攻击源自一封主题为假冒工作offer的邮件。他们决定将邮件主题模式添加到IOC中，以便更有效地检测未来类似的钓鱼攻击活动。'
- en: Note
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 注
- en: IOCs are not just limited to domains, IP addresses, or URLs; they can also be
    file hashes, email addresses, email subjects and patterns, registry keys, network
    signatures (data payloads or packet headers), behavioral indicators (unusual file
    modification, new user accounts), custom YARA rules, user agents, HTTP headers,
    DNS records, SSL certificates, hosting information, etc.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: IOC不仅限于域名、IP地址或URL；它们还可以是文件哈希、电子邮件地址、电子邮件主题和模式、注册表键、网络签名（数据负载或数据包头）、行为指标（异常文件修改、新用户账户）、自定义YARA规则、用户代理、HTTP头、DNS记录、SSL证书、托管信息等。
- en: We learned about how SOC analysts utilize threat intelligence information; however,
    in order to make it more efficient, we need to automate the threat intelligence
    process, including collection, observable analysis, and updates.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们了解到SOC分析员如何利用威胁情报信息；然而，为了提高效率，我们需要自动化威胁情报过程，包括收集、观测数据分析和更新。
- en: Automated threat intelligence
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动化威胁情报
- en: 'As of now, you might have realized the importance of threat intelligence for
    SOC analysts or blue team. But imagine, if there are thousands of observables
    generated every day, it will be very difficult to manually copy/paste each observable
    and search them in the threat intelligence database or feeds. This brings a lot
    of challenges to SOC, such as delayed threat detection, missed alerts, a lack
    of consistency, and slow response times. In this section, we will design an automated
    threat intelligence system and integrate it with Wazuh. We will cover the following:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您可能已经意识到威胁情报对于SOC分析员或蓝队的重要性。但试想，如果每天生成成千上万的观测数据，手动复制/粘贴每个观测数据并在威胁情报数据库或信息流中搜索它们，将会非常困难。这给SOC带来了许多挑战，例如威胁检测延迟、漏报警报、一致性差和响应时间慢。在本节中，我们将设计一个自动化威胁情报系统，并将其与Wazuh集成。我们将覆盖以下内容：
- en: Designing automated threat intelligence
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设计自动化威胁情报
- en: Introduction to MISP
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MISP简介
- en: TheHive and Cortex
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TheHive和Cortex
- en: The workings of threat intelligence and analysis
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 威胁情报与分析的工作原理
- en: Designing automated threat intelligence
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设计自动化威胁情报
- en: 'Wazuh is a security platform that collects security events from all endpoints.
    To integrate threat intelligence capabilities, we will use an MISP project—an
    open-source threat intelligence sharing platform. The integration between Wazuh
    and MISP can be accomplished by using MISP API, as shown in the following figure:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: Wazuh是一个安全平台，收集来自所有端点的安全事件。为了集成威胁情报功能，我们将使用MISP项目——一个开源的威胁情报共享平台。Wazuh与MISP的集成可以通过使用MISP
    API来实现，如下图所示：
- en: '![Figure 3.1 – Proposed integration of Wazuh with MISP](img/B19549_3_01.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![图3.1 – Wazuh与MISP的提议集成](img/B19549_3_01.jpg)'
- en: Figure 3.1 – Proposed integration of Wazuh with MISP
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.1 – Wazuh与MISP的提议集成
- en: 'However, the design will not allow the security team to track every observable
    and security incident. We need to build a system wherein we can take the security
    events from Wazuh and analyze the observables of each event separately against
    threat intelligence feeds. In short, we have three tools in this design:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，该设计并不允许安全团队追踪每一个可观察项和安全事件。我们需要构建一个系统，在这个系统中，我们能够从Wazuh获取安全事件，并分别分析每个事件的可观察项，结合威胁情报数据源进行对比。简而言之，这个设计中有三个工具：
- en: Wazuh (security events collection)
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Wazuh（安全事件收集）
- en: A security incident management tool (for receiving alerts from Wazuh and performing
    a lookup with threat intelligence data)
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个安全事件管理工具（用于接收来自Wazuh的警报并与威胁情报数据进行查找）
- en: A threat intelligence tool (this tool is created to provide threat intelligence
    data to the security incident management tool)
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个威胁情报工具（此工具用于向安全事件管理工具提供威胁情报数据）
- en: Top of Form
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 顶部表单
- en: 'We will use the TheHive tool for security incident management and an MISP project
    for threat intelligence management. The following figure gives you an idea of
    the proposed integration of Wazuh with TheHive/Cortex and MISP:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用TheHive工具进行安全事件管理，并使用MISP项目进行威胁情报管理。以下图示展示了Wazuh与TheHive/Cortex及MISP集成的提议：
- en: '![Figure 3.2 – Proposed integration of Wazuh with TheHive/Cortex and MISP](img/B19549_3_02.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![图3.2 – Wazuh与TheHive/Cortex及MISP的提议集成](img/B19549_3_02.jpg)'
- en: Figure 3.2 – Proposed integration of Wazuh with TheHive/Cortex and MISP
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.2 – Wazuh与TheHive/Cortex及MISP的提议集成
- en: 'This integration of Wazuh, TheHive, and MISP has some major advantages:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: Wazuh、TheHive和MISP的集成具有一些主要优势：
- en: '**Centralized threat intelligence**: The integration lets threat intelligence
    from MISP be put together in TheHive, creating a central location for Wazuh to
    store and analyze security events and decide what to do about them. This integration
    lets security teams correlate events with known risks and IOCs, which makes responding
    to incidents more accurate and quicker.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**集中式威胁情报**：此集成使得来自MISP的威胁情报能够集中在TheHive中，从而为Wazuh提供一个存储和分析安全事件的中央位置，并决定如何应对这些事件。该集成使得安全团队能够将事件与已知的风险和IOC进行关联，从而使响应更加准确、迅速。'
- en: '**Scalable security operations**: The integration streamlines the handling
    of security events, enabling scalable security operations. Through the utilization
    of Wazuh’s detection capabilities, TheHive’s case management skills, and MISP’s
    threat intelligence capabilities, organizations can effectively handle and address
    an increasing volume of security incidents without requiring significantly more
    manual effort.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可扩展的安全运营**：集成简化了安全事件的处理，支持可扩展的安全运营。通过利用Wazuh的检测能力、TheHive的案例管理技能以及MISP的威胁情报能力，组织能够有效处理和应对日益增多的安全事件，而无需显著增加人工投入。'
- en: '**Automated incident response**: Although this chapter is about threat intelligence
    integration, by integrating TheHive, we can also accomplish automated incident
    response capabilities. By utilizing information from MISP, security analysts can
    generate response playbooks in TheHive, which enables them to provide more consistent
    and prompt responses to security incidents identified by Wazuh.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动化事件响应**：尽管本章讲解的是威胁情报集成，但通过集成TheHive，我们还可以实现自动化事件响应功能。通过利用MISP中的信息，安全分析师可以在TheHive中生成响应手册，从而为由Wazuh识别的安全事件提供更一致、更迅速的响应。'
- en: Let’s first quickly understand the capabilities of each of these tools. Then,
    we will set them up and integrate them with each other.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们首先快速了解这些工具的功能。然后，我们将配置它们并进行集成。
- en: Introduction to MISP
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: MISP简介
- en: '**MISP** is an open-source threat intelligence platform that enables organizations
    and security professionals to collect, share, and collaborate on structured threat
    information. MISP has seven core layers:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**MISP** 是一个开源威胁情报平台，帮助组织和安全专业人士收集、共享和协作结构化的威胁信息。MISP 有七个核心层：'
- en: '**Data layer**: This layer focuses on gathering detailed information about
    security incidents and threats from the actual threat intelligence data. The primary
    components of the data layer are as follows:'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据层**：该层专注于从实际的威胁情报数据中收集有关安全事件和威胁的详细信息。数据层的主要组件如下：'
- en: '**Events**: Security events or threat information.'
  id: totrans-67
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件**：安全事件或威胁信息。'
- en: '**Attributes**: Describes aspects of threats such as IP addresses, domains,
    hashes, email addresses, etc.'
  id: totrans-68
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**属性**：描述威胁的各个方面，如 IP 地址、域名、哈希值、电子邮件地址等。'
- en: '**Objects**: A template that specifies contextualized and organized information
    about threats.'
  id: totrans-69
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对象**：一种模板，指定关于威胁的上下文化和组织化信息。'
- en: '**Context layer**: This layer is concerned with creating links and correlations
    between various pieces of threat intelligence data.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**上下文层**：此层关注在各种威胁情报数据之间建立联系和关联。'
- en: '**Correlation layer**: This layer is responsible for identifying patterns and
    correlations between various events and properties.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关联层**：该层负责识别各种事件和属性之间的模式和关联。'
- en: '**Warning list layer**: Warning lists are collections of indicators that are
    considered to be malicious or suspicious.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**警告列表层**：警告列表是被认为是恶意或可疑的指示器的集合。'
- en: '**Taxonomies layer**: Taxonomies standardize threat intelligence data categorization
    and classification. They aid in the consistent and orderly organization and description
    of threats.'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分类层**：分类法标准化威胁情报数据的分类和归类，帮助一致且有序地组织和描述威胁。'
- en: '**Galaxies layer**: Galaxies are groups of connected information regarding
    various threats, such as threat actors, methods, malware families, and so on.
    They provide contextual information to help you understand dangers better.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**星系层**：星系是关于各种威胁的相关信息的集合，如威胁行为者、攻击方法、恶意软件家族等。它们提供上下文信息，帮助你更好地理解危险。'
- en: '**Feed layer**: Feeds entail incorporating external threat intelligence sources
    into MISP. This layer enables MISP to automatically retrieve and incorporate data
    from a variety of reliable sources, thereby enhancing the threat intelligence
    database.'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**馈送层**：馈送层涉及将外部威胁情报来源集成到 MISP 中。此层使 MISP 能够自动从各种可靠来源检索并整合数据，从而增强威胁情报数据库。'
- en: As we discussed earlier, we need TheHive as a broker that accepts the security
    alerts from Wazuh and allows us to analyze each observable against MISP threat
    intelligence data.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前讨论的，我们需要 TheHive 作为中介，接收来自 Wazuh 的安全警报，并允许我们将每个可观察项与 MISP 威胁情报数据进行分析。
- en: 'TheHive consists of two tools: TheHive for incident management and Cortex for
    integration with tons of threat intelligence platforms. TheHive and Cortex constitute
    a potent integration designed for SOC analysts. This integration bridges the gap
    between effective collaboration and advanced threat analysis, thereby enhancing
    the SOC’s ability to identify, mitigate, and respond to cybersecurity threats.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: TheHive 包含两个工具：TheHive 用于事件管理，Cortex 用于与大量威胁情报平台的集成。TheHive 和 Cortex 构成了一个强大的集成系统，专为
    SOC 分析师设计。此集成弥合了有效协作和高级威胁分析之间的差距，从而增强了 SOC 识别、减轻和应对网络安全威胁的能力。
- en: TheHive
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: TheHive
- en: '**TheHive** is an incident response platform designed to help SOC analysts
    analyze security alerts and incidents. It facilitates collaboration and information
    sharing among different team members during security investigations and incident
    responses. Some of the important capabilities of TheHive are as follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '**TheHive** 是一个事件响应平台，旨在帮助 SOC 分析师分析安全警报和事件。它促进了不同团队成员在安全调查和事件响应过程中的协作与信息共享。TheHive
    的一些重要功能如下：'
- en: '**Observable analysis**: TheHive can analyze the alerts received from Wazuh,
    and this enables SOC analysts to pre-qualify alerts before deciding whether to
    ignore them or convert them into cases.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可观察项分析**：TheHive 可以分析从 Wazuh 接收到的警报，这使得 SOC 分析师能够在决定是否忽略警报或将其转换为案件之前进行预筛选。'
- en: '![Figure 3.3 – Observable preview](img/B19549_3_03.jpg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.3 – 可观察项预览](img/B19549_3_03.jpg)'
- en: Figure 3.3 – Observable preview
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.3 – 可观察项预览
- en: '**Case timeline**: A case timeline illustrates the entirety of the case’s lifecycle,
    including initial alerts, ongoing and completed tasks, identified IOCs, and much
    more.'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**案件时间线**：案件时间线展示了整个案件生命周期，包括初始警报、进行中的任务、已完成的任务、识别的IOC以及更多内容。'
- en: '![Figure 3.4 – Case timeline in TheHive](img/B19549_3_04.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.4 – TheHive中的案件时间线](img/B19549_3_04.jpg)'
- en: Figure 3.4 – Case timeline in TheHive
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.4 – TheHive中的案件时间线
- en: '**Integration**: TheHive version 5 has strong and default integration capabilities
    with Cortex, Wazuh, and MISP. However, it can also be integrated with IBM QRadar,
    Splunk SIEM, Elasticsearch, VirusTotal, and many more.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**集成**：TheHive版本5具有强大且默认的集成功能，支持与Cortex、Wazuh和MISP的集成。然而，它也可以与IBM QRadar、Splunk
    SIEM、Elasticsearch、VirusTotal等进行集成。'
- en: '**Alert TTPs**: TheHive can contain a set of MITRE ATT&CK TTPs with ATT&CK
    mapping post-integration with MISP. MITRE ATT&CK (standing for **Adversarial Tactics,
    Techniques, and Common Knowledge**) is a framework that classifies cyber threat
    behaviors and techniques employed by attackers at various stages of an attack.
    We will learn more about the MITRE ATT&CK framework in [*Chapter 6*](B19549_06.xhtml#_idTextAnchor163),
    *Threat Hunting* *with Wazuh*.'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**警报TTPs**：TheHive可以包含一组MITRE ATT&CK TTPs，集成MISP后可与ATT&CK映射。MITRE ATT&CK（代表**对抗战术、技术和常识**）是一个框架，用于分类攻击者在攻击的各个阶段使用的网络威胁行为和技术。我们将在[*第6章*](B19549_06.xhtml#_idTextAnchor163)中深入了解MITRE
    ATT&CK框架，主题是 *使用Wazuh进行威胁狩猎*。'
- en: '![Figure 3.5 – Visualizing TTPs in the TheHive platform](img/B19549_3_05.jpg)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.5 – 在TheHive平台中可视化TTPs](img/B19549_3_05.jpg)'
- en: Figure 3.5 – Visualizing TTPs in the TheHive platform
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.5 – 在TheHive平台中可视化TTPs
- en: TheHive and Cortex are made to work together without any problems. TheHive can
    send observables from incidents to Cortex so that the preset analyzers can look
    at them. Some jobs can be automated with this integration, which cuts down on
    the amount of work that needs to be done by hand in the incident response process.
    Let’s explore the capabilities of Cortex.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: TheHive和Cortex是为了无缝协作而设计的。TheHive可以将事件中的观察项发送到Cortex，以便预设的分析器进行检查。通过这种集成，一些工作可以自动化，从而减少在事件响应过程中需要手动完成的工作量。接下来，让我们探索Cortex的功能。
- en: Cortex
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Cortex
- en: '**Cortex** is a part of the TheHive project. It automates threat intelligence
    and response, providing SOC analysts with the ability to detect and respond to
    threats quickly and effectively. One of the core features of Cortex is its ability
    to integrate several security tools, threat intelligence feeds, security services,
    and more. Cortex serves as a central repository for this intelligence, allowing
    analysts to manage and access the information they require with ease.'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '**Cortex**是TheHive项目的一部分。它自动化威胁情报和响应，赋予SOC分析员快速有效地检测和响应威胁的能力。Cortex的核心功能之一是能够集成多个安全工具、威胁情报信息流、安全服务等。Cortex充当这些情报的中央存储库，允许分析员轻松管理和访问他们需要的信息。'
- en: 'Cortex has two major components:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: Cortex有两个主要组件：
- en: '**Analyzers**: Analyzers gather and enrich data from various sources to help
    SOC analyst teams. There are many types of analyzers that connect to online security
    services, threat feeds, and databases. After transforming the data, the analyzer
    can enrich it by checking it against a list of known malicious indicators, querying
    online services for more information, or running custom scripts for more advanced
    analysis.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分析器**：分析器从各种来源收集并丰富数据，以帮助SOC分析团队。分析器有多种类型，它们可以连接到在线安全服务、威胁信息流和数据库。数据转化后，分析器可以通过将其与已知恶意指标列表进行比对、查询在线服务以获取更多信息，或运行自定义脚本进行更高级的分析来进一步丰富数据。'
- en: '**Responders**: Responders are used for acting in accordance with the enriched
    data supplied by the analyzers. Responders come in a variety of forms, each intended
    to carry out a particular task, such as blocking an IP address, isolating an infected
    device, or alerting a security analyst.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**响应器**：响应器用于根据分析器提供的丰富数据执行相应的操作。响应器有多种形式，每种形式都旨在执行特定的任务，例如阻止IP地址、隔离感染设备或警告安全分析员。'
- en: Understanding the workings of automated threat intelligence and analysis
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解自动化威胁情报和分析的工作原理
- en: 'The final design workflow involves all three components: Wazuh, TheHive/Cortex,
    and MISP. This recommended design helps enterprises build an effective and scalable
    incident response system. Some of the important steps involved in this automated
    threat intelligence and analysis design with Wazuh, TheHive/Cortex, and MISP are
    as follows:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 最终的设计工作流涉及所有三个组件：Wazuh、TheHive/Cortex 和 MISP。这个推荐的设计帮助企业构建一个高效且可扩展的事件响应系统。以下是与
    Wazuh、TheHive/Cortex 和 MISP 一起进行自动化威胁情报和分析设计中的一些重要步骤：
- en: '**Event transfer**: Post-integration, TheHive can receive the security events
    from Wazuh. We can also configure Wazuh to send only specific types of alerts,
    such as security alerts matching rule level three or higher.'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件传输**：集成后，TheHive 可以接收来自 Wazuh 的安全事件。我们还可以配置 Wazuh 仅发送特定类型的警报，例如符合规则等级三或更高级别的安全警报。'
- en: '**Alert triage**: Once the alert is received from Wazuh by TheHive, it can
    invoke Cortex to immediately look at the observables that are linked to it. This
    can include things such as running security scans, comparing observables to MISP
    threat intelligence feeds, or getting more information from the internet.'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**警报分类**：一旦 TheHive 收到来自 Wazuh 的警报，它可以调用 Cortex 立即查看与之相关的可观察对象。这可能包括运行安全扫描、将可观察对象与
    MISP 威胁情报源进行对比，或从互联网上获取更多信息。'
- en: '**Response action**: TheHive can initiate response actions based on Cortex
    analysis results, such as altering the status of an event, providing tasks for
    analysts, or generating reports. It helps in the automation of portions of the
    incident response workflow.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**响应操作**：TheHive 可以根据 Cortex 分析结果启动响应操作，例如更改事件状态、为分析师提供任务或生成报告。这有助于自动化事件响应工作流的部分环节。'
- en: '![Figure 3.6 – Workflow of threat intelligence and analysis with Wazuh, TheHive,
    and MISP](img/B19549_3_06.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.6 – 与 Wazuh、TheHive 和 MISP 一起进行威胁情报和分析的工作流](img/B19549_3_06.jpg)'
- en: Figure 3.6 – Workflow of threat intelligence and analysis with Wazuh, TheHive,
    and MISP
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.6 – 与 Wazuh、TheHive 和 MISP 一起进行威胁情报和分析的工作流
- en: Now that we have learned the entire flow of automated threat intelligence, incident
    management, and analysis, let’s begin to set up Wazuh, TheHive/Cortex, and MISP
    tools and integrate them to work seamlessly.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了自动化威胁情报、事件管理和分析的完整流程，接下来让我们开始设置 Wazuh、TheHive/Cortex 和 MISP 工具，并将它们集成以实现无缝协作。
- en: Setting up TheHive and Cortex
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 TheHive 和 Cortex
- en: 'The deployment design of TheHive provides companies with flexibility by allowing
    for both standalone server deployments (deployment on a single server) and clustered
    deployments (multiple servers work together to handle the TheHive application
    load). It is recommended to use cluster mode deployment for large production environments.
    Some of the software components of TheHive are as follows:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: TheHive 的部署设计为公司提供了灵活性，支持独立服务器部署（在单一服务器上部署）和集群部署（多个服务器共同处理 TheHive 应用负载）。对于大型生产环境，建议使用集群模式部署。TheHive
    的一些软件组件如下：
- en: '**Apache Cassandra**: TheHive utilizes the Apache Cassandra database to store
    its data. Cassandra is a distributed NoSQL database known for its scalability
    and capability to manage massive amounts of data across a cluster of numerous
    nodes. Cassandra is utilized within the framework of TheHive to store data pertaining
    to cases, incidents, and other pertinent information.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Apache Cassandra**：TheHive 使用 Apache Cassandra 数据库来存储其数据。Cassandra 是一个分布式
    NoSQL 数据库，因其可扩展性和能够在多个节点的集群中管理大量数据而闻名。Cassandra 在 TheHive 框架中用于存储与案件、事件和其他相关信息相关的数据。'
- en: '**Elasticsearch**: TheHive uses Elasticsearch for indexing. It is a powerful
    analytics and search engine that makes data indexing, querying, and searching
    more effective. It improves TheHive’s search performance and speed, which makes
    it simpler for users to find and evaluate data.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Elasticsearch**：TheHive 使用 Elasticsearch 进行索引。它是一个强大的分析和搜索引擎，使得数据的索引、查询和搜索更加高效。它提升了
    TheHive 的搜索性能和速度，简化了用户查找和评估数据的过程。'
- en: '**S3 MINIO**: When a clustered deployment is necessary or when organizations
    need scalable and distributed file storage, TheHive provides support for S3-compatible
    storage solutions such as **MINIO**. AWS provides a scalable object storage, called
    **S3** (**Simple Storage Service**). An open-source substitute called MINIO is
    compatible with the S3 API.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**S3 MINIO**：当需要集群部署或组织需要可扩展的分布式文件存储时，TheHive 支持 S3 兼容的存储解决方案，如 **MINIO**。AWS
    提供了一种可扩展的对象存储服务，称为 **S3**（**简单存储服务**）。一个名为 MINIO 的开源替代品与 S3 API 兼容。'
- en: The TheHive application, database, index engine, and file storage can be run
    separately so each layer can be a node or cluster. TheHive could be set up in
    a complex clustered architecture using virtual IP addresses and load balancers.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: TheHive 应用程序、数据库、索引引擎和文件存储可以分别运行，因此每一层都可以是一个节点或集群。TheHive 可以使用虚拟 IP 地址和负载均衡器设置为复杂的集群架构。
- en: 'We can set up TheHive and Cortex in different environments, such as Ubuntu
    servers, Docker, Kubernetes, etc. To simplify the installation process, we are
    going to use Docker Compose. We need to take the following steps:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在不同的环境中设置 TheHive 和 Cortex，如 Ubuntu 服务器、Docker、Kubernetes 等。为了简化安装过程，我们将使用
    Docker Compose。我们需要执行以下步骤：
- en: Install Docker Compose
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 Docker Compose
- en: Prepare the YML script for the TheHive module
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 准备 TheHive 模块的 YML 脚本
- en: Launch and test
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动并测试
- en: Create an organization and user on TheHive
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 TheHive 上创建一个组织和用户
- en: Create an organization and user on Cortex
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Cortex 上创建一个组织和用户
- en: Install Docker Compose
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 Docker Compose
- en: 'Let’s start with the Ubuntu Server. I’ll use Ubuntu 23.10 and take the following
    steps to install Docker Compose:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从 Ubuntu 服务器开始。我将使用 Ubuntu 23.10 并采取以下步骤来安装 Docker Compose：
- en: '`apt` commands to install Docker dependencies:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `apt` 命令安装 Docker 依赖项：
- en: '[PRE0]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**Set up the official Docker repository**: Although Docker packages are available
    in the default Ubuntu 20.04 repositories, it is recommended that you use the official
    Docker repository. Run the following commands to enable the Docker repository:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**设置官方 Docker 仓库**：虽然 Docker 包在默认的 Ubuntu 20.04 仓库中提供，但建议使用官方 Docker 仓库。运行以下命令启用
    Docker 仓库：'
- en: '[PRE1]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '**Install Docker with apt command**: We are now ready to install the most recent
    and stable version of Docker from its official repository. Run the following to
    install it:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**使用 apt 命令安装 Docker**：我们现在准备从官方仓库安装最新的稳定版本 Docker。运行以下命令进行安装：'
- en: '[PRE2]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'After installing the Docker package, run the following command to add your
    local user to the Docker group:'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 安装完 Docker 包后，运行以下命令将本地用户添加到 Docker 组中：
- en: '[PRE3]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Verify whether the Docker daemon service is running:'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 验证 Docker 守护进程服务是否正在运行：
- en: '[PRE4]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Install Docker Compose on Ubuntu 23.10\. To install Docker Compose on Ubuntu
    Linux, run the following commands sequentially:'
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Ubuntu 23.10 上安装 Docker Compose。要在 Ubuntu Linux 上安装 Docker Compose，请依次运行以下命令：
- en: '[PRE5]'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Check the Docker Compose version by running the following command:'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行以下命令检查 Docker Compose 版本：
- en: '[PRE6]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: If the Docker installation is good, you should see the output with the Docker
    compose version, OpenSSL version, CPython version, etc.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 Docker 安装正常，你应该会看到输出，其中包括 Docker Compose 版本、OpenSSL 版本、CPython 版本等。
- en: Prepare the YML script for the TheHive module
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备 TheHive 模块的 YML 脚本
- en: 'The primary distinction between `docker run` and `docker-compose` is that `docker
    run` is entirely command line-based, whereas `docker-compose` reads configuration
    data from a YAML file. So, the beauty of Docker Compose is that we can install
    all the modules of TheHive with a single YML script, and once this YML script
    is executed by Docker, all the modules will be turned up. Now, let’s prepare our
    TheHive YML script:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '`docker run` 和 `docker-compose` 的主要区别在于，`docker run` 完全基于命令行，而 `docker-compose`
    从 YAML 文件中读取配置数据。因此，Docker Compose 的优势在于我们可以通过一个 YML 脚本安装 TheHive 的所有模块，一旦此 YML
    脚本被 Docker 执行，所有模块都会启动。现在，让我们准备我们的 TheHive YML 脚本：'
- en: '`theHive` and change the directory:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`theHive` 并更改目录：'
- en: '[PRE7]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Launch and test
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动并测试
- en: 'To deploy the TheHive, run the following command from the TheHive directory:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 要部署 TheHive，请从 TheHive 目录运行以下命令：
- en: '[PRE8]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Next, wait for two or three minutes. Open your browser and access TheHive at
    http:://<Server_IP>:9000 and Cortex at `http:://<Server_IP>:9001`.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，等待两到三分钟。打开浏览器，访问 TheHive 的地址 http:://<Server_IP>:9000 和 Cortex 的地址 `http:://<Server_IP>:9001`。
- en: 'The default credentials of TheHive application are as follows:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: TheHive 应用程序的默认凭证如下：
- en: '`admin@thehive.local`'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`admin@thehive.local`'
- en: '`secret`'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`secret`'
- en: Next, Cortex doesn’t provide default credentials; you have to reset the database
    and set a new username and password. These will be our default admin credentials.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，Cortex 不提供默认凭证；你需要重置数据库并设置一个新的用户名和密码。这些将是我们的默认管理员凭证。
- en: Once you have admin credentials for both theHive and Cortex, we will create
    an organization and a user under it and generate an API key.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你获得了 TheHive 和 Cortex 的管理员凭证，我们将创建一个组织，并在其下创建一个用户，然后生成 API 密钥。
- en: Create an organization and user on TheHive
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 TheHive 上创建一个组织和用户
- en: 'Once you’re logged in, we need to do a few things. We need to first create
    an organization and then a user:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，我们需要做几件事。首先需要创建一个组织，然后创建一个用户：
- en: To create an organization, go to **Organization** and click **Add**. Enter a
    **Name** and **Description** and set the tasks sharing rule to **Manual**.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建一个组织，请进入**组织**并点击**添加**。输入**名称**和**描述**，并将任务共享规则设置为**手动**。
- en: Next, create two users for the haxcamp organization—a user and an API user.
    Go to `admin` and `haxcamp` organizations. Let us assign the user to the `haxamp`
    organizations.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，为haxcamp组织创建两个用户——一个用户和一个API用户。进入`admin`和`haxcamp`组织。我们将把用户分配到`haxcamp`组织。
- en: 'Now, let’s create API users. This user account will be used to integrate TheHive
    with the Wazuh manager. To create an API user, go to `API User` for the `api@haxcamp.local`
    for the login ID, set the account type to `org-admin user`. Once the API user
    is created, click on **Reveal**:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们创建API用户。此用户账户将用于将TheHive与Wazuh管理器集成。要创建API用户，请进入`API用户`，使用`api@haxcamp.local`作为登录ID，设置账户类型为`org-admin
    user`。创建API用户后，点击**显示**：
- en: '![Figure 3.7 – Retrieve TheHive API](img/B19549_3_07.jpg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![图3.7 – 获取TheHive API](img/B19549_3_07.jpg)'
- en: Figure 3.7 – Retrieve TheHive API
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.7 – 获取TheHive API
- en: Copy the API key and save it somewhere. We will require this API key when integrating
    TheHive with the Wazuh manager.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 复制API密钥并将其保存到某个地方。我们在将TheHive与Wazuh管理器集成时需要此API密钥。
- en: Create an organization and user on Cortex
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Cortex上创建组织和用户
- en: 'Once you’ve set your admin credentials on Cortex, you need to create an organization.
    Fill in **Name** and **Description**:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在Cortex上设置管理员凭据后，您需要创建一个组织。填写**名称**和**描述**：
- en: '![Figure 3.8 – Setting up organization details in Cortex](img/B19549_3_08.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![图3.8 – 在Cortex中设置组织详情](img/B19549_3_08.jpg)'
- en: Figure 3.8 – Setting up organization details in Cortex
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.8 – 在Cortex中设置组织详情
- en: 'Next, we need to create a user. To do that, go to **Users**, click on **Add
    user**, and fill in **Login**, **Full name**, **Organizations &** **Roles**:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要创建一个用户。为此，请进入**用户**，点击**添加用户**，并填写**登录名**、**全名**、**组织和角色**：
- en: '![Figure 3.9 – Creating and adding a user in Cortex](img/B19549_3_09.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![图3.9 – 在Cortex中创建并添加用户](img/B19549_3_09.jpg)'
- en: Figure 3.9 – Creating and adding a user in Cortex
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.9 – 在Cortex中创建并添加用户
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 您将注意到以下截图中的内容：
- en: '**Login**: This represents the login username or email address of the user.'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**登录**：这代表用户的登录用户名或电子邮件地址。'
- en: '**Organization**: This represents the organization the user belongs to.'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织**：这代表了用户所属的组织。'
- en: '**Roles**: This shows the role of the user.'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**角色**：这显示了用户的角色。'
- en: 'After creating the user, you can click on **Reveal** to reveal the API key
    and save that for future use when we integrate Cortex with MISP:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 创建用户后，您可以点击**显示**来显示API密钥，并将其保存以供将来在我们将Cortex与MISP集成时使用：
- en: '![Figure 3.10 – Retrieving the Cortex API](img/B19549_3_10.jpg)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![图3.10 – 获取Cortex API](img/B19549_3_10.jpg)'
- en: Figure 3.10 – Retrieving the Cortex API
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.10 – 获取Cortex API
- en: Alright, now one of the three tools is deployed and ready to use. Let’s work
    on deploying our MISP project before we finally get to Wazuh.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 好的，现在三个工具中的一个已经部署并准备就绪。让我们在最终进入Wazuh之前，先部署我们的MISP项目。
- en: Setting up MISP
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置MISP
- en: '**MISP** is an open source software and there are different ways we can install
    it to build our own threat intelligence and share it with the community. MISP
    can be installed on most Linux distributions, and the MISP community has created
    simple install scripts. MISP has many dependencies and combines various software
    to function properly. This is also known as the **LAMP** stack:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '**MISP**是一个开源软件，我们可以通过不同的方式安装它，以构建自己的威胁情报并与社区共享。MISP可以安装在大多数Linux发行版上，MISP社区已经创建了简单的安装脚本。MISP有很多依赖项，并结合了多种软件才能正常运行。这也被称为**LAMP**栈：'
- en: Linux operating system
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Linux操作系统
- en: Apache for web server
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于Web服务器的Apache
- en: MySQL relational database
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MySQL关系型数据库
- en: Miscellaneous—PHP, Perl, Python
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 杂项—PHP、Perl、Python
- en: 'We can deploy MISP in different environments ([https://www.misp-project.org/download/](https://www.misp-project.org/download/)),
    such as Docker, VirtualBox VM, and VMware VM. Deploying MISP and its dependencies
    via Docker is by far the simplest installation process I’ve found. VirtualBox
    VM and VMware VM are good for lab and testing environments. Take the following
    steps to set up MISP:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在不同的环境中部署MISP（[https://www.misp-project.org/download/](https://www.misp-project.org/download/)），如Docker、VirtualBox虚拟机和VMware虚拟机。通过Docker部署MISP及其依赖项是目前我发现最简单的安装过程。VirtualBox虚拟机和VMware虚拟机适用于实验室和测试环境。按照以下步骤设置MISP：
- en: Fulfill the requirements.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成要求。
- en: Install Docker and Docker Compose.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装Docker和Docker Compose。
- en: Set up and launch MISP.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置并启动 MISP。
- en: Add an organization and users.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加组织和用户。
- en: Add feeds.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加数据源。
- en: Fulfill the requirements
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 满足要求
- en: To set up MISP in the Docker environment, we require Ubuntu Server 22.04.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 Docker 环境中设置 MISP，我们需要 Ubuntu Server 22.04。
- en: Install Docker and Docker Compose
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 Docker 和 Docker Compose
- en: To set up Docker and Docker Compose, refer the *step 1* of *Setting* *up TheHive/Cortex*.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置 Docker 和 Docker Compose，请参考 *第 1 步* 的 *设置 TheHive/Cortex*。
- en: Set up and Launch MISP
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置并启动 MISP
- en: 'Now that we’ve installed Docker, we need to install the MISP Docker image and
    configure the environmental variable. This will have four sub-steps:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经安装了 Docker，我们需要安装 MISP Docker 镜像并配置环境变量。这将有四个子步骤：
- en: Clone the Git repository.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 克隆 Git 仓库。
- en: Modify the environmental variable file.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改环境变量文件。
- en: Start Docker Compose.
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 Docker Compose。
- en: Launch MISP.
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 MISP。
- en: 'We will initiate the installation of MISP using their official GitHub repository,
    as explained:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过他们的官方 GitHub 仓库来启动 MISP 的安装，如下所述：
- en: '**Clone the Git repository**: Let’s clone the get repository with the following
    command:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**克隆 Git 仓库**：让我们使用以下命令来克隆 Git 仓库：'
- en: '[PRE9]'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Next, open the file and edit it using the GNU nano editor:'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 接下来，打开文件并使用 GNU nano 编辑器进行编辑：
- en: '[PRE11]'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The final file should look like this:'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 最终文件应如下所示：
- en: '[PRE12]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '**Start Docker Compose**: To start the MISP Docker container, we need to build
    it using this command:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**启动 Docker Compose**：要启动 MISP Docker 容器，我们需要使用以下命令构建它：'
- en: '[PRE13]'
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Add an organization and users
  id: totrans-201
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加组织和用户
- en: We need to create a local organization and add a user to it. Go to **Administration**
    and enter the **Organization** identifier, Generate **UUID**, Upload the company
    logo (optional), and click on **Submit**.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要创建一个本地组织并向其中添加一个用户。进入 **管理**，输入 **组织** 标识符，生成 **UUID**，上传公司徽标（可选），然后点击 **提交**。
- en: '![Figure 3.11 – Setting up organization details in the MISP platform](img/B19549_3_11.jpg)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.11 – 在 MISP 平台中设置组织详情](img/B19549_3_11.jpg)'
- en: Figure 3.11 – Setting up organization details in the MISP platform
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.11 – 在 MISP 平台中设置组织详情
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 您会在上面的截图中注意到以下内容：
- en: '**Organization Identifier**: This represents a unique name for each organization.'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织标识符**：这是每个组织的唯一名称。'
- en: '**UUID**: This is a unique identifier that ensures that each piece of information
    has a global unique identifier. You can even generate UUID online from a website
    such as [www.uuidgenerator.net](http://www.uuidgenerator.net).'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**UUID**：这是一个唯一标识符，确保每条信息都有一个全球唯一的标识符。您甚至可以从像 [www.uuidgenerator.net](http://www.uuidgenerator.net)
    这样的站点在线生成 UUID。'
- en: Now, to add a user to your organization, go to **Administration** > **Add User**
    and enter your email, set the password, select your own organization, set the
    role to **Org Admin**, and click on **Create User**.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，要将用户添加到您的组织，请进入 **管理** > **添加用户**，输入您的电子邮件，设置密码，选择您的组织，设置角色为 **组织管理员**，然后点击
    **创建用户**。
- en: '![Figure 3.12 – Adding an admin user on MISP](img/B19549_3_12.jpg)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.12 – 在 MISP 中添加管理员用户](img/B19549_3_12.jpg)'
- en: Figure 3.12 – Adding an admin user on MISP
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.12 – 在 MISP 中添加管理员用户
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 您会在上面的截图中注意到以下内容：
- en: '**Email**: This represents the email address of the admin user.'
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**电子邮件**：这代表管理员用户的电子邮件地址。'
- en: '**Organization**: This represents the organization’s name.'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组织**：这代表组织的名称。'
- en: '**Role**: This represents the role of the user. In this case, you should set
    it to **admin**.'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**角色**：这代表用户的角色。在此情况下，您应将其设置为 **管理员**。'
- en: Add feeds
  id: totrans-215
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加数据源
- en: MISP uses feeds to download threat reports, IOCs, and other information. These
    feeds contain all of the data stored by MISP. Feeds are not enabled by default
    when configuring MISP. To use our feeds, we must import and enable them. Fortunately,
    MISP helps us with some good threat intelligence feeds. This feed information
    is fetched in JSON format and can be downloaded from their official GitHub repository
    at [https://github.com/MISP/MISP/blob/2.4/app/files/feed-metadata/defaults.json](https://github.com/MISP/MISP/blob/2.4/app/files/feed-metadata/defaults.json).
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: MISP 使用数据源来下载威胁报告、IOC（入侵指示器）以及其他信息。这些数据源包含了所有由 MISP 存储的数据。配置 MISP 时，数据源默认没有启用。要使用我们的数据源，我们必须导入并启用它们。幸运的是，MISP
    提供了一些不错的威胁情报数据源。这些数据源信息是以 JSON 格式获取的，可以从他们的官方 GitHub 仓库下载，地址为 [https://github.com/MISP/MISP/blob/2.4/app/files/feed-metadata/defaults.json](https://github.com/MISP/MISP/blob/2.4/app/files/feed-metadata/defaults.json)。
- en: 'Copy the raw data. Next, visit the MISP application, go to **Sync Actions**,
    click on **Import Feeds from JSON**, and paste the metadata there:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 复制原始数据。接下来，访问MISP应用程序，前往**同步操作**，点击**从JSON导入源**，并在那里粘贴元数据：
- en: '![Figure 3.13 – Adding feeds to MISP](img/B19549_3_13.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![图3.13 – 将源添加到MISP](img/B19549_3_13.jpg)'
- en: Figure 3.13 – Adding feeds to MISP
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.13 – 将源添加到MISP
- en: Here, **Server metadata** represents the JSON value of the threat intelligence
    feeds.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，**服务器元数据**表示威胁情报源的JSON值。
- en: 'Next, enable the feeds. To do that, go to **Sync Actions** and click on **List
    Feeds**. Select all the feeds and click on **Enable Selected**:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，启用源。为此，前往**同步操作**并点击**列表源**。选择所有源后点击**启用所选**：
- en: '![Figure 3.14 – Visualizing feeds in MISP](img/B19549_3_14.jpg)'
  id: totrans-222
  prefs: []
  type: TYPE_IMG
  zh: '![图3.14 – 在MISP中可视化源](img/B19549_3_14.jpg)'
- en: Figure 3.14 – Visualizing feeds in MISP
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.14 – 在MISP中可视化源
- en: Here **List Feeds** represents a list of all the threat intelligence feeds with
    their providers’ details.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，**列表源**表示包含其提供者详细信息的所有威胁情报源的列表。
- en: This completes our task of setting up MISP applications. Next, we will work
    on integrating Wazuh and MISP with TheHive.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 这完成了我们设置MISP应用程序的任务。接下来，我们将致力于将Wazuh和MISP与TheHive集成。
- en: Integrating Wazuh with TheHive
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将Wazuh与TheHive集成
- en: 'We will integrate Wazuh with TheHive to automatically send Wazuh alerts to
    TheHive. SOC analysts will then be able to investigate and respond to these alerts,
    as well as create cases if necessary. In this section, we will take the following
    steps:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将把Wazuh与TheHive集成，以便自动将Wazuh警报发送到TheHive。SOC分析师随后可以调查并响应这些警报，并在必要时创建案件。在这一部分，我们将采取以下步骤：
- en: Install the TheHive Python script on the Wazuh manager.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Wazuh管理器上安装TheHive Python脚本。
- en: Create an integration Python script on the Wazuh manager.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Wazuh管理器上创建一个集成Python脚本。
- en: Create a Bash script on the Wazuh manager.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Wazuh管理器上创建一个Bash脚本。
- en: Integrate TheHive server in Wazuh server configurations.
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Wazuh服务器配置中集成TheHive服务器。
- en: Restart the manager.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启管理器。
- en: Visualize the alerts on TheHive.
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在TheHive上可视化警报。
- en: Install TheHive Python script on the Wazuh manager
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Wazuh管理器上安装TheHive Python脚本。
- en: We will use a Python script that will enable custom integration of TheHive with
    the Wazuh manager. We’ll write in the following step which we will use as a reference.
    This module is operational as of the time of this writing after being tested with
    TheHive version 5.2.1.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个Python脚本，使TheHive与Wazuh管理器进行自定义集成。接下来的步骤中，我们将使用它作为参考。该模块在撰写本文时已在TheHive版本5.2.1上进行测试并可正常工作。
- en: 'Let’s first install the `thehive4py` module using the following command:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，使用以下命令安装`thehive4py`模块：
- en: '[PRE14]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Create an integration Python script on the Wazuh manager
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Wazuh管理器上创建一个集成Python脚本。
- en: It is necessary to build the script `custom-w2thive.py` in the `/var/ossec/integrations/`
    directory to allow for the integration of TheHive with Wazuh. You can find the
    full code from the GitHub repository at [https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_integration_Wazuh.py](https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_integration_Wazuh.py).
    Let me explain the import statement of this code to clarify how it is being built.
    I have broken down the first part (the import statement).
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 必须在`/var/ossec/integrations/`目录下构建`custom-w2thive.py`脚本，以便将TheHive与Wazuh集成。你可以在GitHub仓库中找到完整代码，地址是[https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_integration_Wazuh.py](https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_integration_Wazuh.py)。让我来解释这段代码的导入语句，以澄清它是如何构建的。我已经拆解了第一部分（导入语句）。
- en: Import statement
  id: totrans-240
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 导入语句
- en: This part of the python code defines the imported module or packages.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 这一部分的Python代码定义了导入的模块或包。
- en: '[PRE15]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Here, the lines import various Python modules, including `json`, `sys`, `os`,
    `re`, `logging`, `uuid`, and specific modules from the `thehive4py` package.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的行导入了多个Python模块，包括`json`、`sys`、`os`、`re`、`logging`、`uuid`和来自`thehive4py`包的特定模块。
- en: User configuration
  id: totrans-244
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 用户配置
- en: 'This section of the code defines the user-configurable parameters as global
    variables:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分代码定义了作为全局变量的用户可配置参数：
- en: '[PRE16]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Let us break down the code:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来逐步解析代码：
- en: '`lvl_threshold=0`: This indicates that TheHive will receive all the alerts
    generated by Wazuh. If you have a large network with thousands of monitored agents,
    keep it higher so that you get more relevant alerts.'
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`lvl_threshold=0`：这表示TheHive将接收Wazuh生成的所有警报。如果你有一个拥有成千上万监控代理的大型网络，建议将其设为更高的值，以便接收到更多相关的警报。'
- en: '`debug_enable = False`: This represents the debugging option. In this case,
    it is set to `False`.'
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`debug_enable = False`: 这是调试选项。在此情况下，设置为`False`。'
- en: '`info_enabled= True`: This is the information logging option. In this code,
    it is set to `True`.'
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`info_enabled= True`: 这是信息日志选项。在此代码中，设置为`True`。'
- en: 'Now, let’s set proper permissions and ownership using the `chmod` and `chown`
    commands:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们使用`chmod`和`chown`命令设置适当的权限和所有权：
- en: '[PRE17]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Create a Bash script on the Wazuh manager
  id: totrans-253
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Wazuh管理器上创建一个Bash脚本
- en: To successfully execute the `.py` script developed, we must construct a bash
    script called `custom-w2thive` and place it in `/var/ossec/integrations/custom-w2thive`.
    You can copy the entire code from the GitHub repository at [https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_bash_script_Wazuh..sh](https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_bash_script_Wazuh..sh).
    Let me break down this bash script to help you understand its functionality.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 为了成功执行开发的`.py`脚本，我们必须构建一个名为`custom-w2thive`的bash脚本，并将其放置在`/var/ossec/integrations/custom-w2thive`目录下。你可以从GitHub仓库中复制整个代码：[https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_bash_script_Wazuh..sh](https://github.com/PacktPublishing/Security-Monitoring-using-Wazuh/blob/main/Chapter%203/custom_thehive_bash_script_Wazuh..sh)。让我分解这个bash脚本，帮助你理解它的功能。
- en: Setting variables
  id: totrans-255
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置变量
- en: 'In this part of the bash script, some variables are defined as shown in the
    code:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个bash脚本的部分，定义了一些变量，如下所示：
- en: '[PRE18]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '`WPYTHON_BIN` is set to the path of the Python 3 interpreter'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`WPYTHON_BIN`被设置为Python 3解释器的路径'
- en: '`SCRIPT_PATH_NAME` is set to the full path of the script'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SCRIPT_PATH_NAME`被设置为脚本的完整路径'
- en: '`DIR_NAME` is set to the absolute path of the directory containing the script'
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DIR_NAME`被设置为包含脚本的目录的绝对路径'
- en: '`SCRIPT_NAME` is set to the base name of the script'
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SCRIPT_NAME`被设置为脚本的基础名称'
- en: Determining the Python script path
  id: totrans-262
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 确定Python脚本的路径
- en: 'This part of the script is used to get the location of the `custom-w2thive.py`
    file:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 这部分脚本用于获取`custom-w2thive.py`文件的位置：
- en: '[PRE19]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Let us break them down the preceding code:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们分解一下前面的代码：
- en: '`*/active-response/bin | */wodles*)`: This is a pattern that if matched, sets
    `WAZUH_PATH` and `PYTHON_SCRIPT` to `${DIR_NAME}/${SCRIPT_NAME}.py`.'
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`*/active-response/bin | */wodles*)`: 这是一个模式，如果匹配成功，将会把`WAZUH_PATH`和`PYTHON_SCRIPT`设置为`${DIR_NAME}/${SCRIPT_NAME}.py`。'
- en: '`(*/bin)`: This is another pattern that, if matched, sets `WAZUH_PATH` and
    `PYTHON_SCRIPT` to `${WAZUH_PATH}/framework/scripts/${SCRIPT_NAME}.py`.'
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`(*/bin)`: 这是另一个模式，如果匹配成功，将会把`WAZUH_PATH`和`PYTHON_SCRIPT`设置为`${WAZUH_PATH}/framework/scripts/${SCRIPT_NAME}.py`。'
- en: '`(*/integrations)`: This is the third pattern that, if matched, sets `WAZUH_PATH`
    and `PYTHON_SCRIPT` to `${DIR_NAME}/${SCRIPT_NAME}.py`.'
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`(*/integrations)`: 这是第三个模式，如果匹配成功，将会把`WAZUH_PATH`和`PYTHON_SCRIPT`设置为`${DIR_NAME}/${SCRIPT_NAME}.py`。'
- en: Setting the Python script path
  id: totrans-269
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置Python脚本的路径
- en: 'Once the Python script is set in `PYTHON_SCRIPT`, this script executes the
    Python script:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦Python脚本被设置为`PYTHON_SCRIPT`，这个脚本就会执行Python脚本：
- en: '[PRE20]'
  id: totrans-271
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Here, `(${WAZUH_PATH}/${WPYTHON_BIN})` with any command-line arguments is passed
    to the Bash script (`$@`).
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，`(${WAZUH_PATH}/${WPYTHON_BIN})`与任何命令行参数一起传递给Bash脚本（`$@`）。
- en: 'As we did earlier, let’s again set the required permissions and ownership using
    `chmod` and `chown`, respectively:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前所做的，让我们再次使用`chmod`和`chown`分别设置所需的权限和所有权：
- en: '[PRE21]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Integrate the TheHive server in the Wazuh server configurations
  id: totrans-275
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Wazuh服务器配置中集成TheHive服务器
- en: 'Now, you need to modify `/var/ossec/etc/ossec.conf` using your favorite text
    editor and insert the following code:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你需要使用你喜欢的文本编辑器修改`/var/ossec/etc/ossec.conf`文件，并插入以下代码：
- en: '[PRE22]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Let us break down the code:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们分解一下这段代码：
- en: '`<integration>`: This specifies the integration with the external applications
    or platforms.'
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<integration>`: 这指定了与外部应用程序或平台的集成。'
- en: '`<hootk_url>`: This defines the URL endpoint. In this case, it is the URL of
    the TheHive platform.'
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<hootk_url>`: 这是定义URL端点的地方。在这个例子中，它是TheHive平台的URL。'
- en: '`<api_key>`: This represents the API key associated with the integration. In
    this case, it is the API key of the TheHive platform.'
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`<api_key>`: 这是与集成相关的API密钥。在此案例中，它是TheHive平台的API密钥。'
- en: Restart and test
  id: totrans-282
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重启并测试
- en: 'Once complete, you need to restart the Wazuh manager:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，你需要重启Wazuh管理器：
- en: '[PRE23]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Visualizing the alerts on TheHive
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在TheHive中可视化警报
- en: 'If everything went according to plan, you should soon start seeing notifications
    generated under the **Alerts** tab in TheHive. As you can see in the screenshot,
    it worked:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切顺利，你应该很快会看到在TheHive中的**Alerts**标签下生成的通知。如截图所示，它已经成功了：
- en: '![Figure 3.15 – Visualizing alerts on TheHive](img/B19549_3_15.jpg)'
  id: totrans-287
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.15 – 在 TheHive 上可视化警报](img/B19549_3_15.jpg)'
- en: Figure 3.15 – Visualizing alerts on TheHive
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.15 – 在 TheHive 上可视化警报
- en: Next, we need to integrate TheHive/Cortex with MISP threat intel to perform
    observable analysis.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要将 TheHive/Cortex 与 MISP 威胁情报集成，以执行可观察性分析。
- en: Integrating TheHive and Cortex with MISP
  id: totrans-290
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将 TheHive 和 Cortex 与 MISP 集成
- en: 'TheHive and Cortex are powerful when they work together. TheHive is helpful
    in incident response, case management, collaboration, and threat analysis while
    Cortex is a powerful threat intel aggregator. Once we Integrate TheHive and Cortex
    with MISP, we can even run the observable analyzer directly from TheHive as a
    result; we don’t have to manually perform analysis by going to Cortex. In order
    to achieve this automation, we need to do three things:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 当 TheHive 和 Cortex 一起工作时，它们非常强大。TheHive 在事件响应、案件管理、协作和威胁分析方面非常有用，而 Cortex 是一个强大的威胁情报聚合器。一旦我们将
    TheHive 和 Cortex 与 MISP 集成，我们甚至可以直接从 TheHive 运行可观察性分析器；因此，我们不必通过进入 Cortex 手动执行分析。为了实现这种自动化，我们需要做三件事：
- en: Integrate TheHive with Cortex
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 TheHive 与 Cortex 集成
- en: Integrate Cortex with MISP
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 Cortex 与 MISP 集成
- en: Integrate TheHive with MISP
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 TheHive 与 MISP 集成
- en: Integrate TheHive with Cortex
  id: totrans-295
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将 TheHive 与 Cortex 集成
- en: 'To integrate TheHive and Cortex, you need to enter the Cortex API key in the
    TheHive settings. I hope you’ve copied the Cortex API key, as explained in the
    earlier section *Setting up TheHive and Cortex* | *Create an organization and
    user on Cortex*. Now, in order to complete the integration, log in with the admin
    account or switch to the admin profile and click on the **Platform Management**
    tab. Test the server connection, as shown in the screenshot:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 要将 TheHive 和 Cortex 集成，你需要在 TheHive 设置中输入 Cortex API 密钥。我希望你已经按照之前的部分*设置 TheHive
    和 Cortex* | *在 Cortex 上创建组织和用户*说明复制了 Cortex API 密钥。现在，为了完成集成，使用管理员帐户登录或切换到管理员配置文件，点击**平台管理**选项卡。测试服务器连接，如截图所示：
- en: '![Figure 3.16 – Testing the server connection between TheHive and Cortex](img/B19549_3_16.jpg)'
  id: totrans-297
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.16 – 测试 TheHive 和 Cortex 之间的服务器连接](img/B19549_3_16.jpg)'
- en: Figure 3.16 – Testing the server connection between TheHive and Cortex
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.16 – 测试 TheHive 和 Cortex 之间的服务器连接
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在上述截图中看到以下内容：
- en: '**API Key**: This represents the API key of the Cortex server'
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**API 密钥**：这表示 Cortex 服务器的 API 密钥。'
- en: '**Do not check Certificate Authority**: It is recommended to keep this disabled
    if you have not installed SSL on the server'
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不要检查证书颁发机构**：如果你没有在服务器上安装 SSL，建议保持此项禁用'
- en: Integrate Cortex with MISP
  id: totrans-302
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将 Cortex 与 MISP 集成
- en: 'Log in to Cortex with your newly created account and then go to `MISP_2_1 Analyzer`:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 使用你新创建的帐户登录 Cortex，然后转到`MISP_2_1 Analyzer`：
- en: '![Figure 3.17 – Searching for MISP analyzer under Cortex](img/B19549_3_17.jpg)'
  id: totrans-304
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.17 – 在 Cortex 下搜索 MISP 分析器](img/B19549_3_17.jpg)'
- en: Figure 3.17 – Searching for MISP analyzer under Cortex
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.17 – 在 Cortex 下搜索 MISP 分析器
- en: Here, **MISP_2_1** represents the MISP analyzers for performing observable analysis.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，**MISP_2_1**表示用于执行可观察性分析的MISP分析器。
- en: 'Next, click on **Edit** and a prompt will appear to configure the MISP integration.
    Enter a name, MISP base URL, and MISP API key, and set **cert_check** to **False**
    (if you haven’t configured the SSL):'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，点击**编辑**，会弹出一个提示框配置 MISP 集成。输入名称、MISP 基本 URL 和 MISP API 密钥，并将**cert_check**设置为**False**（如果你还没有配置
    SSL）：
- en: '![Figure 3.18 – Integrating MISP with Cortex](img/B19549_3_18.jpg)'
  id: totrans-308
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.18 – 将 MISP 集成到 Cortex 中](img/B19549_3_18.jpg)'
- en: Figure 3.18 – Integrating MISP with Cortex
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.18 – 将 MISP 集成到 Cortex 中
- en: 'You will need to enter the following:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要输入以下内容：
- en: '**Name**: This indicates the name of the MISP analyzer.'
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**名称**：这表示 MISP 分析器的名称。'
- en: '**URL**: This represents the URL of the MISP platform.'
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**URL**：这表示 MISP 平台的 URL。'
- en: '**Key**: This indicates the API key of the MISP server.'
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**密钥**：这表示 MISP 服务器的 API 密钥。'
- en: '**cert_check**: This will dictate whether the Cortex will perform an SSL check
    or not. In this case, we will keep it **False**.'
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**cert_check**：这将决定 Cortex 是否执行 SSL 检查。在这种情况下，我们将其保持为**False**。'
- en: 'Now, it’s time to verify the integration with a sample analyzer. In the top
    left, you have a **New Analysis** button. Now, set **TLP** to **AMBER**, **PAP**
    to **AMBER**, and **Data Type** to **domain**. Immediately, you get a new **Button
    MISP_2_1**, as shown:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，是时候通过一个示例分析器来验证集成了。在左上方，你会看到一个**新分析**按钮。现在，将**TLP**设置为**AMBER**，**PAP**设置为**AMBER**，**数据类型**设置为**域**。立即，你将看到一个新的**按钮
    MISP_2_1**，如图所示：
- en: '![Figure 3.19 – Running MISP analyzer on Cortex](img/B19549_3_19.jpg)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.19 – 在 Cortex 上运行 MISP 分析器](img/B19549_3_19.jpg)'
- en: Figure 3.19 – Running MISP analyzer on Cortex
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.19 – 在 Cortex 上运行 MISP 分析器
- en: Integrate TheHive with MISP
  id: totrans-318
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将 TheHive 与 MISP 集成
- en: 'The best part about TheHive suite is that MISP is already integrated with it.
    You only need to enter the API key of MISP in the TheHive platform. To complete
    the integration, log in with an admin account or switch to an admin profile and
    click on the **Platform Management** tab. You need to set up the MISP server name,
    server URL, and API key, and then you can test the connection, as shown in the
    screenshot:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: TheHive 套件的最佳部分是 MISP 已经与它集成。你只需要在 TheHive 平台中输入 MISP 的 API 密钥即可完成集成。要完成集成，使用管理员账户登录或切换到管理员配置文件，然后点击**平台管理**标签。你需要设置
    MISP 服务器名称、服务器 URL 和 API 密钥，然后可以测试连接，如下图所示：
- en: '![Figure 3.20 – Testing the connection between TheHive and MISP](img/B19549_3_20.jpg)'
  id: totrans-320
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.20 – 测试 TheHive 和 MISP 之间的连接](img/B19549_3_20.jpg)'
- en: Figure 3.20 – Testing the connection between TheHive and MISP
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.20 – 测试 TheHive 和 MISP 之间的连接
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在上面的截图中看到以下内容：
- en: '**Server name**: This is the name of the MISP server.'
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务器名称**：这是 MISP 服务器的名称。'
- en: '**Server url**: This represents the URL of the MISP server.'
  id: totrans-324
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务器 URL**：这表示 MISP 服务器的 URL。'
- en: '**API Key**: This indicates the API key of the MISP server.'
  id: totrans-325
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**API 密钥**：这表示 MISP 服务器的 API 密钥。'
- en: '**Purpose**: This shows how this API integration will be used. It can be **Export**,
    **Import**, or both. In this case, we will set it to **Export** to send queries.'
  id: totrans-326
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目的**：这显示了该 API 集成将如何使用。它可以是**导出**、**导入**或两者兼有。在这种情况下，我们将其设置为**导出**，以发送查询。'
- en: '**Do not check Certificate Authority**: It is recommended to keep this disabled
    if you have not installed SSL on the server.'
  id: totrans-327
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不要检查证书颁发机构**：如果你没有在服务器上安装 SSL，建议保持此选项禁用。'
- en: '**Test server connection**: This runs a connection check between TheHive and
    the MISP server.'
  id: totrans-328
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**测试服务器连接**：这是在 TheHive 和 MISP 服务器之间进行连接检查的操作。'
- en: Finally, the installation and integration of all three tools—Wazuh, TheHive/Cortex,
    and MISP—is complete. We will now focus on some important use cases of threat
    intelligence and analysis.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，所有三种工具——Wazuh、TheHive/Cortex 和 MISP 的安装与集成完成。现在我们将重点关注威胁情报与分析的一些重要用例。
- en: Use cases
  id: totrans-330
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用例
- en: 'Wazuh and TheHive integration offers a lot of benefits to SOC analysts and
    incident response teams. We will go through different use cases to explore several
    features of TheHive and MISP that work extremely well with Wazuh. We will go through
    some common use cases such as investigating suspicious file and network connections
    and tracking TTPs. In this section, we will cover the following topics:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: Wazuh 和 TheHive 的集成为 SOC 分析师和事件响应团队提供了许多好处。我们将通过不同的用例来探索 TheHive 和 MISP 的多个功能，这些功能与
    Wazuh 配合使用效果极佳。我们将介绍一些常见的用例，例如调查可疑文件和网络连接，以及追踪 TTPs。在本节中，我们将涵盖以下主题：
- en: Pre-requisites
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 前提条件
- en: Reviewing alerts
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审查警报
- en: Creating a case
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建案例
- en: Analyzing file observable
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析文件可观察对象
- en: Analyzing network observable
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析网络可观察对象
- en: Managing TTPs
  id: totrans-337
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理 TTPs
- en: Pre-requisites
  id: totrans-338
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 前提条件
- en: 'Before we get into some use cases of threat intelligence and analysis with
    Wazuh, TheHive, and MISP, we need to ensure these requirements are fulfilled:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们深入探讨 Wazuh、TheHive 和 MISP 的威胁情报与分析用例之前，我们需要确保满足以下要求：
- en: A Wazuh server
  id: totrans-340
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一台 Wazuh 服务器
- en: An Ubuntu server running TheHive and Cortex using Docker
  id: totrans-341
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行 TheHive 和 Cortex 的 Ubuntu 服务器，使用 Docker
- en: An Ubuntu server running an MISP server
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行 MISP 服务器的 Ubuntu 服务器
- en: Ubuntu Desktop or Ubuntu Server with the Wazuh agent installed
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装了 Wazuh 代理的 Ubuntu 桌面或 Ubuntu 服务器
- en: Reviewing alert
  id: totrans-344
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 审查警报
- en: 'Once you integrate Wazuh with TheHive, you will start getting security alerts.
    Before you start investigating alerts or analyzing any observable against the
    MISP server, you need to get a good understanding of TheHive alert attributes.
    You can review all the important attributes of an alert in the following screenshot:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦将 Wazuh 与 TheHive 集成，你将开始接收安全警报。在开始调查警报或分析任何可观察对象与 MISP 服务器的关系之前，你需要充分了解 TheHive
    警报的属性。你可以在以下截图中查看所有警报的主要属性：
- en: '![Figure 3.21 – Reviewing security alerts on TheHive](img/B19549_3_21.jpg)'
  id: totrans-346
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.21 – 在 TheHive 上审查安全警报](img/B19549_3_21.jpg)'
- en: Figure 3.21 – Reviewing security alerts on TheHive
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.21 – 在 TheHive 上审查安全警报
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在上面的截图中看到以下内容：
- en: '**General**: This is a tab that has **Tags**, **Description**, Wazuh **Rule**,
    and Wazuh **Agent** information'
  id: totrans-349
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**一般**：这是一个包含**标签**、**描述**、Wazuh **规则**和Wazuh **代理**信息的标签。'
- en: '**Observable**: This shows information such as IP addresses, domains, URLs,
    hashes, etc.'
  id: totrans-350
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可观察项**：这显示了诸如IP地址、域名、URL、哈希值等信息。'
- en: '**TTPs**: This shows MITRE attack tactics and techniques'
  id: totrans-351
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**TTPs**：这显示MITRE攻击战术和技术'
- en: '**Similar Cases**: This will show you existing related cases'
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**类似案件**：这将显示现有的相关案件'
- en: '**Similar Alerts**: This will show you similar alerts'
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**类似警报**：这将显示类似的警报'
- en: '**Responder**: This shows TheHive responder reports'
  id: totrans-354
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**响应者**：这显示了TheHive响应者报告'
- en: '**History**: This shows the history of alerts'
  id: totrans-355
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**历史**：这显示警报的历史记录'
- en: 'In the top left, you have action items, such as the following:'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 在左上角，您可以看到以下操作项：
- en: '**Create case from alert**: You can create a brand new case with this alert.
    I recommend you do this only when you’re certain that it is not a false positive.'
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**从警报创建案件**：您可以使用此警报创建一个全新的案件。我建议您仅在确定这不是误报的情况下执行此操作。'
- en: '**Merge selection into case**: You can merge alerts into a single case.'
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**将选定项合并为案件**：您可以将多个警报合并为一个案件。'
- en: '**Ignore new update**: Once selected, you will not get any update on this alert.'
  id: totrans-359
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**忽略新更新**：一旦选择，您将不会收到此警报的任何更新。'
- en: '**Start**: Once you click on this play button, you can take it ahead without
    creating a case. You can change the status of the alert to **Pending**, add some
    summary notes, and assign it to another analyst or Tier 2 analyst.'
  id: totrans-360
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开始**：一旦点击这个播放按钮，您可以继续进行，而无需创建案件。您可以将警报的状态更改为**待处理**，添加一些总结性备注，并将其分配给另一位分析员或二级分析员。'
- en: '**Close**: If you are certain that it’s a false positive or duplicate, you
    can close the alert.'
  id: totrans-361
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关闭**：如果您确定这是误报或重复项，您可以关闭此警报。'
- en: 'Based on your investigation, you can also change the status of the alert, as
    shown in this screenshot:'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您的调查，您还可以更改警报的状态，如该截图所示：
- en: '![Figure 3.22 – Changing the alert status](img/B19549_3_22.jpg)'
  id: totrans-363
  prefs: []
  type: TYPE_IMG
  zh: '![图3.22 – 更改警报状态](img/B19549_3_22.jpg)'
- en: Figure 3.22 – Changing the alert status
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.22 – 更改警报状态
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在前面的截图中注意到以下内容：
- en: '**Status**: This is the alert status, and it can be **New**, **In Progress**,
    **Pending**, **Imported**, **Duplicate**, **False Positive**, or **Ignored**.
    In this case, it is set to **Duplicate**.'
  id: totrans-366
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**状态**：这是警报的状态，可以是**新建**、**进行中**、**待处理**、**已导入**、**重复**、**误报**或**已忽略**。在这种情况下，设置为**重复**。'
- en: '**Assignee**: This states whom you want to assign this alert to. It can be
    your team member, SOC Level 2, the threat intelligence team, etc.'
  id: totrans-367
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**受指派人**：这表示您希望将此警报分配给谁。可以是您的团队成员、SOC二级分析员、威胁情报团队等。'
- en: Creating a case
  id: totrans-368
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建案件
- en: 'Once you are confident that you need to work on a certain alert, you can either
    create a fresh case or use a case template. Once you click on an empty case, you
    need to enter details such as the case title, severity, tasks, etc. You can create
    multiple tasks and assign them to different team members, as shown in screenshot:'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您确认需要处理某个警报，您可以创建一个全新的案件或使用案件模板。点击空白案件后，您需要输入案件标题、严重性、任务等详细信息。您可以创建多个任务并将它们分配给不同的团队成员，如截图所示：
- en: '![Figure 3.23 – Creating a new case in TheHive](img/B19549_3_23.jpg)'
  id: totrans-370
  prefs: []
  type: TYPE_IMG
  zh: '![图3.23 – 在TheHive中创建新案件](img/B19549_3_23.jpg)'
- en: Figure 3.23 – Creating a new case in TheHive
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.23 – 在TheHive中创建新案件
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在前面的截图中注意到以下内容：
- en: '`Suspicious` `File detected`.'
  id: totrans-373
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`检测到可疑` `文件`。'
- en: '**Severity**: This represents how critical the case is.'
  id: totrans-374
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**严重性**：这表示案件的紧急程度。'
- en: '**Add a task**: This allows you to add multiple tasks.'
  id: totrans-375
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**添加任务**：这允许您添加多个任务。'
- en: Analyzing file observables
  id: totrans-376
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析文件可观察项
- en: As we know, observables are initial information that needs to be analyzed before
    it is marked as an IOC. TheHive detects observables from Wazuh security events.
    Then, we can analyze the observables against multiple threat Intelligence feeds.
    The pre-defined observable types are IPs, email addresses, URLs, domain names,
    files, and hashes.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所知，可观察项是需要分析的初始信息，在将其标记为IOC之前。TheHive从Wazuh安全事件中检测到可观察项。然后，我们可以将可观察项与多个威胁情报源进行分析。预定义的可观察项类型包括IP、电子邮件地址、URL、域名、文件和哈希值。
- en: 'When you create a case from an alert, observables from alerts are also transferred
    to the theHive case. Even if you don’t have any observables, you can create an
    observable and analyze it against MISP threat intelligence feeds. You can click
    on **Add an Observable** and enter the details, as shown in the following screenshot:'
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 当你从警报创建案件时，警报中的可观察对象也会转移到 TheHive 案件中。即使你没有任何可观察对象，你也可以创建一个可观察对象并将其与 MISP 威胁情报源进行分析。你可以点击
    **添加一个可观察对象** 并输入详细信息，如下图所示：
- en: '![Figure 3.24 – Adding an observable in TheHive](img/B19549_3_24.jpg)'
  id: totrans-379
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.24 – 在 TheHive 中添加一个可观察对象](img/B19549_3_24.jpg)'
- en: Figure 3.24 – Adding an observable in TheHive
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.24 – 在 TheHive 中添加一个可观察对象
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的截图中，你会注意到以下几点：
- en: '`filename`.'
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`filename`。'
- en: '`svchost.exe` file.'
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svchost.exe` 文件。'
- en: '**Tags**: Write any relevant tags.'
  id: totrans-384
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Tags**：写下任何相关的标签。'
- en: '**Description**: Write a simple and relevant description.'
  id: totrans-385
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**描述**：写下一个简单且相关的描述。'
- en: 'Next, let’s click on hamburger menu on the left of the `filename` observable
    and select **Run analyzers**, as shown in the following screenshot:'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，点击 `filename` 可观察对象左侧的汉堡菜单，选择 **运行分析器**，如下图所示：
- en: '![Figure 3.25 – Information about the observable](img/B19549_3_25.jpg)'
  id: totrans-387
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.25 – 可观察对象的信息](img/B19549_3_25.jpg)'
- en: Figure 3.25 – Information about the observable
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.25 – 可观察对象的信息
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的截图中，你会注意到以下几点：
- en: '**Svchost[.]exe**: This is the sample file and is added as an observable.'
  id: totrans-390
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Svchost[.]exe**：这是示例文件，已作为可观察对象添加。'
- en: '`Svshost[.]exe` and run the analyzer against the MISP server for threat intelligence
    lookup. Once we select **Run analyzers**, you should see **MISP_2_1**. Select
    it and click on **Run Selected Analyzer**, as shown in this screenshot:'
  id: totrans-391
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Svshost[.]exe` 并针对 MISP 服务器运行分析器进行威胁情报查询。选择 **运行分析器** 后，你应该看到 **MISP_2_1**。选择它并点击
    **运行所选分析器**，如下图所示：'
- en: '![Figure 3.26 – Executing the MISP analyzer](img/B19549_3_26.jpg)'
  id: totrans-392
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.26 – 执行 MISP 分析器](img/B19549_3_26.jpg)'
- en: Figure 3.26 – Executing the MISP analyzer
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.26 – 执行 MISP 分析器
- en: 'Next, wait for 10 to 20 seconds and you should get a report under the same
    observable from the MISP Server. Bingo! As shown in the screenshot, you can find
    the result from the MISP server:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，等待 10 到 20 秒，你应该会收到来自 MISP 服务器的同一可观察对象下的报告。恭喜！如图所示，你可以从 MISP 服务器找到结果：
- en: '![Figure 3.27 – Receiving the threat intelligence result from the MISP server](img/B19549_3_27.jpg)'
  id: totrans-395
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.27 – 从 MISP 服务器接收威胁情报结果](img/B19549_3_27.jpg)'
- en: Figure 3.27 – Receiving the threat intelligence result from the MISP server
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.27 – 从 MISP 服务器接收威胁情报结果
- en: 'Once you click on it, you will see all eight matching events (threat intel
    feeds) in MISP, as shown:'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 点击它后，你将看到 MISP 中的所有八个匹配事件（威胁情报源），如下所示：
- en: '![Figure 3.28 – Visualizing the observable analysis report from the MISP Server](img/B19549_3_28.jpg)'
  id: totrans-398
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.28 – 可视化来自 MISP 服务器的可观察对象分析报告](img/B19549_3_28.jpg)'
- en: Figure 3.28 – Visualizing the observable analysis report from the MISP Server
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.28 – 可视化来自 MISP 服务器的可观察对象分析报告
- en: 'You can go to any of the MISP events and click on **EventID**. You will be
    redirected to the MISP server for a specific event, as shown in this screenshot:'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以进入任何 MISP 事件并点击 **EventID**。你将被重定向到 MISP 服务器中的特定事件，如下图所示：
- en: '![Figure 3.29 – Visualizing the threat intelligence event from the MISP server](img/B19549_3_29.jpg)'
  id: totrans-401
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.29 – 可视化来自 MISP 服务器的威胁情报事件](img/B19549_3_29.jpg)'
- en: Figure 3.29 – Visualizing the threat intelligence event from the MISP server
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.29 – 可视化来自 MISP 服务器的威胁情报事件
- en: 'You will notice the following in the preceding screenshot:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 在上面的截图中，你会注意到以下几点：
- en: '**EventID**: This represents the event ID from the MISP server. In this case,
    the event ID is **1125**.'
  id: totrans-404
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**EventID**：这表示来自 MISP 服务器的事件 ID。在这个例子中，事件 ID 是 **1125**。'
- en: '**From**: This represents the threat intelligence feed provider. In this case,
    it is **CIRCL**.'
  id: totrans-405
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**From**：这表示威胁情报源提供者。在这个例子中，提供者是 **CIRCL**。'
- en: 'To explore this specific event even further, we can log in to our MISP server
    and navigate to `1125` and find the result, as shown in this screenshot:'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进一步探索此特定事件，我们可以登录到我们的 MISP 服务器，导航到 `1125` 并查找结果，如下图所示：
- en: '![Figure 3.30 – Visualizing the event in the MISP server](img/B19549_3_30.jpg)'
  id: totrans-407
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.30 – 在 MISP 服务器中可视化事件](img/B19549_3_30.jpg)'
- en: Figure 3.30 – Visualizing the event in the MISP server
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.30 – 在 MISP 服务器中可视化事件
- en: 'Let us break down some of the entries:'
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来解析一些条目：
- en: '**Info**: This is a brief and descriptive summary of the event. In this case,
    it is **IECrypt sample analyzed with VMRay Analyzer Report for** **Sample #245141**.'
  id: totrans-410
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**信息**：这是事件的简要描述。在此案例中，它是**IECrypt 样本通过 VMRay 分析报告进行分析，样本编号 #245141**。'
- en: '**Date**: This is the date and time when the event was created.'
  id: totrans-411
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**日期**：这是事件创建的日期和时间。'
- en: '**Threat Level**: This represents the severity or criticality of the threat.
    It can be low, medium, or high.'
  id: totrans-412
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**威胁级别**：表示威胁的严重性或关键性。可以是低、中或高。'
- en: '**Analysis**: This indicates the current analysis state of the event, e.g.,
    initial, ongoing, or completed.'
  id: totrans-413
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分析**：表示事件的当前分析状态，例如初步分析、进行中或已完成。'
- en: '**Distribution**: This specifies the distribution level of the event, finding
    out who can access the information, such as only the organization, the sharing
    group, or the community. In this case, it is **All Communities**.'
  id: totrans-414
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分发**：这表示事件的分发级别，确定谁可以访问这些信息，例如仅限于组织、共享小组或社区。在此案例中，是**所有社区**。'
- en: '**Tags**: This is a list of tags associated with the event, delivering additional
    categorization or metadata.'
  id: totrans-415
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标签**：这是与事件相关的标签列表，提供额外的分类或元数据。'
- en: Analyzing network observables
  id: totrans-416
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析网络观测数据
- en: 'Now, let’s suppose you have some IP and domain observables. We can also test
    them in the same manner, or you can add related observables found during the investigation
    of other events. You can navigate to the **Observables** tab and, as you can see
    in the screenshot, we have some IP addresses as observables:'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，假设你有一些 IP 和域名观测数据。我们也可以以相同的方式测试它们，或者你可以添加在其他事件调查中找到的相关观测数据。你可以导航到**观测数据**标签，如截图所示，我们有一些
    IP 地址作为观测数据：
- en: '![Figure 3.31 – Visualizing IP address observables in TheHIve](img/B19549_3_31.jpg)'
  id: totrans-418
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.31 – 在 TheHive 中可视化 IP 地址观测数据](img/B19549_3_31.jpg)'
- en: Figure 3.31 – Visualizing IP address observables in TheHIve
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.31 – 在 TheHive 中可视化 IP 地址观测数据
- en: 'Let us break down the highlighted boxes in the screenshot:'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们分解一下截图中的高亮框：
- en: '**95[.]154[.]195[.]171**: This is a sample IP address observable that needs
    to be analyzed by the MISP server'
  id: totrans-421
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**95[.]154[.]195[.]171**：这是一个需要由 MISP 服务器分析的样本 IP 地址观测数据'
- en: '**drivgoogle[.]firewall-gateway[.]com**: This is a sample domain name in the
    observable list that needs to be analyzed by the security team'
  id: totrans-422
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**drivgoogle[.]firewall-gateway[.]com**：这是一个需要由安全团队分析的样本域名，出现在观测数据列表中。'
- en: 'Next, wait for 10 to 20 seconds and you should get a report under the same
    observable from the MISP Server. Awesome! As shown in the next screenshot, you
    can find the result from the MISP server:'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，等待 10 到 20 秒，你应该能从 MISP 服务器下获得同一观测数据的报告。太棒了！如下图所示，你可以从 MISP 服务器中找到结果：
- en: '![Figure 3.32 – Visualizing the observable analysis report from the MISP Server](img/B19549_3_32.jpg)'
  id: totrans-424
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.32 – 可视化来自 MISP 服务器的观测分析报告](img/B19549_3_32.jpg)'
- en: Figure 3.32 – Visualizing the observable analysis report from the MISP Server
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.32 – 可视化来自 MISP 服务器的观测分析报告
- en: Here, `1125`.
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是`1125`。
- en: Managing TTPs
  id: totrans-427
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 管理 TTPs
- en: 'TTP analysis can aid security teams in detecting and mitigating attacks by
    revealing how threat actors conduct their operations. TTPs are tactics, techniques,
    and procedures used by threat actors. The MITRE ATT&CK framework empowers SOC
    teams to identify and address TTPs they encounter. The MITRE ATT&CK framework
    consists of 14 tactics and hundreds of associated techniques and procedures. TheHive
    imports TTPs from Wazuh events and enhances our security investigation. You can
    also add a new TTP to any case by taking these steps:'
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: TTP 分析可以帮助安全团队检测并缓解攻击，通过揭示威胁行为者是如何执行其操作的。TTPs 是威胁行为者使用的战术、技术和程序。MITRE ATT&CK
    框架使 SOC 团队能够识别和处理他们遇到的 TTPs。MITRE ATT&CK 框架包含 14 个战术和数百个相关技术与程序。TheHive 从 Wazuh
    事件中导入 TTPs，增强了我们的安全调查。你也可以通过以下步骤将新的 TTP 添加到任何案例中：
- en: Go to a specific case.
  id: totrans-429
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到特定案例。
- en: Click on TTPs at the top.
  id: totrans-430
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击顶部的 TTPs。
- en: Click on Add.
  id: totrans-431
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击添加。
- en: Enter occur data.
  id: totrans-432
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入发生数据。
- en: Choose the tactic.
  id: totrans-433
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择战术。
- en: Choose a technique ID.
  id: totrans-434
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择技术 ID。
- en: 'You can add a new TTP and enter the relevant information, as shown in the following
    screenshot:'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以添加新的 TTP 并输入相关信息，如下图所示：
- en: '![Figure 3.33 – Adding TTPs in TheHive](img/B19549_3_33.jpg)'
  id: totrans-436
  prefs: []
  type: TYPE_IMG
  zh: '![图 3.33 – 在 TheHive 中添加 TTPs](img/B19549_3_33.jpg)'
- en: Figure 3.33 – Adding TTPs in TheHive
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.33 – 在 TheHive 中添加 TTPs
- en: 'You will notice the following:'
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 你会注意到以下几点：
- en: '**Catalogue**: This represents the category of attack. In this case, we selected
    **Enterprise Attack**.'
  id: totrans-439
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目录**：表示攻击的类别。在本案例中，我们选择了 **企业攻击**。'
- en: '**Occur date**: This indicates the date on which the attack happened.'
  id: totrans-440
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**发生日期**：表示攻击发生的日期。'
- en: '**Technique**: This represents the technique and its ID from the MITRE ATT&CK
    matrix.'
  id: totrans-441
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**技术**：这代表 MITRE ATT&CK 矩阵中的技术及其 ID。'
- en: '**Procedure**: This requires you to manually enter the step-by-step instructions
    or sequences of actions that threat actors follow to execute a specific technique.'
  id: totrans-442
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**步骤**：这要求你手动输入威胁行为者执行特定技术时所遵循的逐步指令或操作顺序。'
- en: 'This completes our overview of the use cases of threat intelligence and analysis
    using Wazuh, TheHive, Cortex, and the MISP server. To learn more about the administration,
    features, and integration, you can visit their official websites:'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 这完成了我们关于使用 Wazuh、TheHive、Cortex 和 MISP 服务器进行威胁情报与分析的使用案例概述。若想了解更多关于管理、功能及集成的信息，可以访问它们的官方网站：
- en: 'TheHive: [https://docs.strangebee.com/thehive/setup/](https://docs.strangebee.com/thehive/setup/)'
  id: totrans-444
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'TheHive: [https://docs.strangebee.com/thehive/setup/](https://docs.strangebee.com/thehive/setup/)'
- en: 'Cortex: [https://docs.strangebee.com/cortex/](https://docs.strangebee.com/cortex/)'
  id: totrans-445
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Cortex: [https://docs.strangebee.com/cortex/](https://docs.strangebee.com/cortex/)'
- en: 'MISP: [https://www.misp-project.org/documentation/](https://www.misp-project.org/documentation/)'
  id: totrans-446
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'MISP: [https://www.misp-project.org/documentation/](https://www.misp-project.org/documentation/)'
- en: Summary
  id: totrans-447
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter on threat intelligence and analysis using MISP provided a comprehensive
    guide to understanding and implementing a practical threat intelligence and analysis
    system. We learned the critical role of MISP—when integrated with Wazuh and TheHive—in
    helping security analysts perform observable analyses and add TTPs. We also covered
    some important use cases of TheHive and Cortex for performing analyses of files,
    IP addresses, domains, etc. against the MISP threat intelligence database.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 本章关于使用 MISP 进行威胁情报和分析的内容，提供了一个全面的指南，帮助理解和实施一个实用的威胁情报和分析系统。我们学习了 MISP 在与 Wazuh
    和 TheHive 集成时，如何帮助安全分析师进行可观察的分析，并添加 TTPs（技术、战术和程序）。我们还讨论了 TheHive 和 Cortex 在执行文件、IP
    地址、域名等分析时，与 MISP 威胁情报数据库的结合使用。
- en: In the next chapter, we will learn how to enhance Wazuh’s capabilities using
    security automation tools such as Shuffle. We will learn the importance of security
    automation and the integration of Shuffle with Wazuh, and we will also go through
    some use cases as well.
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将学习如何使用安全自动化工具（如 Shuffle）增强 Wazuh 的功能。我们将学习安全自动化的重要性以及 Shuffle 与 Wazuh
    的集成，还会讲解一些使用案例。
