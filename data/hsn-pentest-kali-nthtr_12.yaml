- en: Avoiding Detection
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 避免被检测
- en: Over the course of this book, we've discussed a lot of topics covering the phases
    of penetration testing, from information gathering for exploitation to cover our
    tracks. To execute a successful penetration test without the target’s security
    team being aware, you must be stealthy like a hacker.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的过程中，我们讨论了许多关于渗透测试阶段的主题，从获取利用信息到掩盖我们的踪迹。要执行成功的渗透测试而不被目标的安全团队察觉，您必须像黑客一样隐秘。
- en: Apart from detecting and exploiting vulnerabilities during a penetration test,
    organizations also use this type of service to test their existing security controls
    and detection rate.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 除了在渗透测试期间检测和利用漏洞外，组织还使用这种类型的服务来测试其现有的安全控制和检测率。
- en: 'As mentioned in [Chapter 2](209bef8c-2e18-43ca-921c-6e551196d0fe.xhtml), *Understanding
    the Phases of the Pentesting Process*, the blue team is responsible for the monitoring,
    detection, and mitigation of any security threats within a parent organization.
    If the blue team should fail to detect the activities of a penetration tester,
    this would mean two things: the penetration tester was extremely stealthy and the
    organization''s security controls need some tweaking.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 如 [第2章](209bef8c-2e18-43ca-921c-6e551196d0fe.xhtml) 中所述，蓝队负责监视、检测和缓解母公司内的任何安全威胁。如果蓝队未能检测到渗透测试人员的活动，这意味着两件事：渗透测试人员非常隐秘，且组织的安全控制需要一些调整。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Stealth scanning
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隐蔽扫描
- en: Using decoys
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用诱饵
- en: Fragmentation
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分段
- en: Idle scanning
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 空闲扫描
- en: Encryption
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 加密
- en: Let’s dive in!
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们深入研究！
- en: Scanning
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扫描
- en: The second phase of hacking is the scanning phase. As discussed in [Chapter
    2](https://cdp.packtpub.com/hands_on_penetration_testing_with_kali_nethunter/wp-admin/post.php?post=35&action=edit#post_27),* Understanding
    the Phases of the Pentesting Process*, the scanning phase helps a penetration
    tester to obtain a lot of details about the target system and/or the network.
    Some of the information that may be acquired includes operating systems and build
    number, open and closed service ports, running applications and their service
    versions, and whether a particular vulnerability exists on a system or group of
    devices.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 黑客的第二阶段是扫描阶段。如 [第2章](https://cdp.packtpub.com/hands_on_penetration_testing_with_kali_nethunter/wp-admin/post.php?post=35&action=edit#post_27) 中所讨论的，*了解渗透测试过程的阶段*，扫描阶段帮助渗透测试人员获取有关目标系统和/或网络的许多详细信息。可能获取的一些信息包括操作系统和构建编号、开放和关闭的服务端口、正在运行的应用程序及其服务版本，以及系统或设备组上是否存在特定的漏洞。
- en: However, the process of scanning would involve our machine directly interacting
    with the target system or network. As an aspiring penetration tester, it's a good
    practice to be very stealthy and avoid being detected by the target’s security
    system as much as possible.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，扫描的过程将涉及我们的机器直接与目标系统或网络进行交互。作为一名有抱负的渗透测试人员，很重要的是要非常隐秘，并尽可能避免被目标安全系统检测到。
- en: During a penetration test on a client’s network infrastructure, the client organization
    may have a blue team that is actively monitoring the security landscape. If you’re
    executing covert testing and you get detected during the early or later phases
    of penetration testing, it defeats of the purpose of simulating a real-world attack,
    as a black hat hacker would attempt to exfiltrate data and compromise systems.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在对客户的网络基础设施进行渗透测试时，客户组织可能有一个积极监视安全局势的蓝队。如果您在渗透测试的早期或后期阶段被检测到，这将破坏模拟真实世界攻击的目的，因为黑客会尝试窃取数据和破坏系统。
- en: 'Within the phase of scanning, there are many techniques used by a penetration
    tester to avoid being detected. Here are a few of these techniques:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在扫描阶段，渗透测试人员使用许多技术来避免被检测。以下是其中一些技术：
- en: Stealth scan
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隐蔽扫描
- en: Using decoys
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用诱饵
- en: Idle scan
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 空闲扫描
- en: Spoofing
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 欺骗
- en: Fragmentation
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分段
- en: Stealth scanning
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 隐蔽扫描
- en: If a penetration tester attempts to scan a target, there is a high chance that
    a TCP three-way handshake will be established prior to the actual scanning of
    the target. A **TCP three-way handshake** is established initially for all TCP-based
    communication on the network; once established, the regular flow of data happens.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 如果渗透测试人员尝试扫描目标，那么在实际扫描目标之前，TCP三次握手建立的机会很高。**TCP三次握手**最初是为网络上的所有基于TCP的通信建立的；一旦建立，数据的正常流动就会发生。
- en: 'The following is a diagram demonstrating the TCP three-way handshake between
    two devices. To further explain the TCP three-way handshake, let''s imagine there
    are two device on a network, A and B. Let''s say device A would like to communicate
    with device B; device A would send a TCP **SYN** packet to device B as a method
    of initiating a conversation. When device B receives a TCP **SYN** packet, it
    will respond with a **SYN/ACK** packet to device A. When device A having receive
    a **SYN/ACK** packet, it will then confirm by responding with an ACK packet. At
    this point, a TCP connection has been established by these two devices:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个演示两个设备之间TCP三次握手的图表。为了进一步解释TCP三次握手，让我们想象一下网络上有两个设备A和B。假设设备A想要与设备B进行通信；设备A将发送一个TCP
    **SYN**包给设备B，作为启动对话的方法。当设备B收到TCP **SYN**包时，它将用一个**SYN/ACK**包回应设备A。当设备A收到一个**SYN/ACK**包后，它将通过发送一个ACK包来确认。在这一点上，这两个设备之间建立了一个TCP连接。
- en: '![image](img/98a7facc-d5f9-4b3b-9397-cd270aa0305e.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/98a7facc-d5f9-4b3b-9397-cd270aa0305e.jpg)'
- en: During a TCP connection, for every packet received from either device, A or
    B, the receiver must confirm receipt by sending a TCP **ACK** packet back to the
    sender as an indication of a successful delivery. If we are to establish  a TCP
    session with a target device while performing a port scan, it would be obvious
    that we (the attacker) are attempting something intrusive in native. In other
    words, it's considered to be noisy.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在TCP连接期间，无论是A还是B设备收到的每个数据包，接收方都必须通过发送TCP **ACK**数据包来确认接收，作为成功交付的指示。如果我们在执行端口扫描的同时与目标设备建立TCP会话，那么我们（攻击者）试图进行的侵入性行为就会变得明显。换句话说，这被认为是有噪音的。
- en: To help us during the scanning phase in a penetration test, we have the Nmap
    (Network Mapper) tool. NMap is renowned as the king of network scanners as it’s
    not only one of those simple ping sweep scanners, but also can contain a lot of
    features that are very useful for both network and security professionals. One
    such feature is its ability to execute a *stealth scan* on a target system or
    network.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试的扫描阶段中，我们有Nmap（网络映射器）工具来帮助我们。NMap被誉为网络扫描器之王，因为它不仅是那些简单的ping扫描器之一，而且还可以包含许多对网络和安全专业人员非常有用的功能。其中一个功能是它能够在目标系统或网络上执行*隐形扫描*。
- en: '*How does stealth scanning work?*: As mentioned in [Chapter 4](60fc5468-a49f-4a6b-9c56-84fb5503568a.xhtml),
    *Scanning and Enumeration Tools*, the attacker machine would partially attempt
    to create a full TCP three-way handshake with the victim machine by sending a
    SYN packet; the victim would respond with a **SYN/ACK** packet, however, the attacker
    would not complete the handshake and send an **RST** packet instead.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 隐形扫描是如何工作的？：如[第4章](60fc5468-a49f-4a6b-9c56-84fb5503568a.xhtml)中所述，*扫描和枚举工具*，攻击者的机器会部分尝试与受害者的机器创建完整的TCP三次握手，发送一个SYN数据包；受害者会用一个**SYN/ACK**数据包回应，然而，攻击者不会完成握手，而是发送一个**RST**数据包。
- en: 'The victim, upon receiving an **RST** packet, will close the connection thinking
    the attacker machine no longer wants to communicate, but the attacker is actually
    provoking the victim into responding and providing a list of open ports. An open
    port is like a wide-open door in a house; by leaving a door open, a burglar can
    simply enter. This means that if a port is left open, the attacker can use this
    open port as their way into the system. The following diagram demonstrates how
    a stealth scan works:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者在收到**RST**数据包后，会关闭连接，认为攻击者的机器不再想要通信，但实际上攻击者是在挑衅受害者做出回应并提供一个开放端口的列表。一个开放的端口就像房子里敞开的门；留着一扇门开着，窃贼就可以轻易进入。这意味着如果一个端口被打开，攻击者可以利用这个开放的端口作为他们进入系统的途径。下面的图表展示了隐形扫描的工作原理：
- en: '![image](img/ef81d885-ed6f-42f7-9860-2df605e45ec2.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/ef81d885-ed6f-42f7-9860-2df605e45ec2.jpg)'
- en: 'Using Nmap, we can perform a stealth scan by typing the `nmap –sS <*victim
    IP address*>` command:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Nmap，我们可以通过输入命令`nmap –sS <*受害者IP地址*>`来执行隐形扫描：
- en: '![image](img/b9b53036-5369-4504-9628-64a4921db7ac.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/b9b53036-5369-4504-9628-64a4921db7ac.png)'
- en: The `–sS` parameter indicates we are performing a stealth scan. A stealth scan
    is sometimes referred to as a TCP **SYN** scan or a full open scan.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '`–sS`参数表示我们正在执行隐形扫描。隐形扫描有时被称为TCP **SYN**扫描或全开放扫描。'
- en: Decoys
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 欺骗
- en: As we have noticed, whenever a penetration tester performs a scan on a target
    device or network, the attacker’s IP address and MAC address would be recorded
    on the victim’s machine. This would make it quite easy to identify the attacker’s
    machine on the network. One of the techniques to camouflage yourself when scanning
    is using decoys, to throw off the victim when they are trying to identify the
    actual attacker machine.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们已经注意到的，每当渗透测试人员对目标设备或网络进行扫描时，攻击者的IP地址和MAC地址会被记录在受害者的机器上。这将使得在网络上识别攻击者的机器变得相当容易。在扫描时伪装自己的一种技术是使用欺骗，以使受害者在试图识别实际攻击者机器时产生困惑。
- en: Nmap, the king of network scanners, comes in to help us again. Nmap has the
    ability to insert multiple source IP addresses into the probes it sends to the
    target device. To elaborate further, let's imagine you are sending a bogus letter
    to someone, however, within the sender's address, you insert your address and
    a few others on the envelope. When the mail is delivered, the receiver won't be
    too sure of the actual sender as there are multiple source addresses. This makes
    it harder to actually determine to correct source of the probes. To use the decoy
    feature on Nmap, we can use the `nmap –D <decoy1, decoy2, decoy3…> <target IP
    address>` command.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap，网络扫描器之王，再次来帮助我们。Nmap有能力在发送给目标设备的探测中插入多个源IP地址。为了更详细地说明，让我们想象一下，你给某人寄了一封虚假的信，然而在寄件人地址中，你在信封上加上了你的地址和其他几个地址。当信件被送到时，收件人不会确定实际寄件人，因为有多个来源地址。这使得确定探测的正确来源变得更加困难。要使用Nmap的欺骗功能，我们可以使用命令`nmap
    –D <欺骗1, 欺骗2, 欺骗3…> <目标IP地址>`。
- en: '`-D` allows you to specify a number of source addresses as the decoys:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '`-D`允许您指定多个源地址作为欺骗：'
- en: '![image](img/b69bb98d-5960-42db-9947-0dad67f08555.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/b69bb98d-5960-42db-9947-0dad67f08555.jpg)'
- en: 'Let’s use Wireshark to see the actual transactions that occur between the attacker
    machine and the victim. The attacker machine is 10.10.10.11 and the victim machine
    is 10.10.10.100 on the network. We used a filter to see only traffic destined
    to our target on Wireshark:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用Wireshark来查看攻击者机器和受害者之间实际发生的交易。攻击者机器的IP地址是10.10.10.11，受害者机器是10.10.10.100。我们使用了一个过滤器，只看Wireshark上发送到我们目标的流量：
- en: '![image](img/74ccd9c9-7aec-4923-8fd6-14db6c591a66.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/74ccd9c9-7aec-4923-8fd6-14db6c591a66.jpg)'
- en: As we can see in the screenshot, there are multiple probes via the decoy addresses
    and the real IP addresses are sent to the target.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在截图中看到的，有多个通过欺骗地址发送的探测，真实的IP地址被发送到目标。
- en: Idle scans
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 空闲扫描
- en: An older but still usable method of scanning is using the idle scan technique.
    Within an idle scan, the attacker machines (device A) send a **SYN/ACK** packet
    to a zombie machine (device B) to obtain its fragmentation identification number.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 一种更老但仍然可用的扫描方法是使用空闲扫描技术。在空闲扫描中，攻击者机器（设备A）向僵尸机器（设备B）发送一个**SYN/ACK**数据包，以获取其分片标识号。
- en: '**IPID** is sometimes referred to as **IP fragmentation ID**. Within the TCP/IP
    stack, before a device sends a datagram (message) onto a network, it is broken
    up into smaller pieces and then each is sent on its way to the destination. An
    IPID is assigned to each of these smaller pieces of the message (bits) to indicate
    they are of the same datagram or message.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '**IPID**有时被称为**IP分片ID**。在TCP/IP堆栈中，在设备将数据报（消息）发送到网络之前，它会被分成较小的片段，然后每个片段被发送到目的地。IPID被分配给消息的这些较小片段（位），以指示它们属于同一个数据报或消息。'
- en: '![image](img/0974b11f-06e9-4214-9f6d-542c1950f027.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/0974b11f-06e9-4214-9f6d-542c1950f027.jpg)'
- en: 'Since the attacker machine did not initiate the connection using a **SYN**
    packet but rather a **SYN/ACK** packet, the zombie machine knows it has not received
    a formal initialization from a **SYN** packet and therefore sends an **RST** packet
    that contains the IPID of the zombie machine (device B):'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 由于攻击者机器没有使用**SYN**数据包而是使用**SYN/ACK**数据包发起连接，因此僵尸机器知道它没有收到来自**SYN**数据包的正式初始化，因此发送一个带有僵尸机器的IPID（设备B）的**RST**数据包：
- en: '![image](img/0ca6ab2d-8e1c-4d45-84ef-82592cb3b203.jpg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/0ca6ab2d-8e1c-4d45-84ef-82592cb3b203.jpg)'
- en: The IPID increases each time a device sends an IP packet.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 每次设备发送IP数据包时，**IPID**都会增加。
- en: 'At this point, the attacker machine got the IPID (1234) from the zombie machine
    on the network. Next, the attacker will send a **SYN** packet (checking for an
    open port) to the actual victim machine using the spoofed IP address of the zombie
    machine. The victim will respond with a **SYN/ACK** to the zombie. The zombie,
    knowing it had not previously received a SYN packet from the victim, will then
    respond with an **RST** packet to the IPID:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，攻击者机器从网络中的僵尸机器获得了IPID（1234）。接下来，攻击者将使用僵尸机器的欺骗IP地址向实际受害者机器发送**SYN**数据包（检查是否有开放端口）。受害者将以**SYN/ACK**响应僵尸。僵尸知道它之前没有从受害者那里收到**SYN**数据包，然后将带有IPID的**RST**数据包响应：
- en: '![image](img/ffaf1f38-f3f6-4aca-9004-710911e87f1c.jpg)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/ffaf1f38-f3f6-4aca-9004-710911e87f1c.jpg)'
- en: 'If the port on the victim is closed, the target will respond with an **RST**
    to the zombie instead of the **SYN/ACK** packet:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果受害者的端口关闭，目标将向僵尸发送**RST**而不是**SYN/ACK**数据包：
- en: '![image](img/99fce076-e35d-4edf-9c68-809c340e0ae0.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/99fce076-e35d-4edf-9c68-809c340e0ae0.jpg)'
- en: 'Finally, the attacker would probe the zombie once more to obtain the zombie’s
    IPID. The attacker will send a **SYN/ACK** packet. If the zombie responds with
    an IPID of 1236, the port on the victim is opened:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，攻击者将再次探测僵尸以获取僵尸的IPID。攻击者将发送**SYN/ACK**数据包。如果僵尸以1236的IPID响应，则受害者的端口已打开：
- en: '![image](img/036c64ce-4ac0-4eae-b11e-59dc7e19df59.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/036c64ce-4ac0-4eae-b11e-59dc7e19df59.jpg)'
- en: During the last phase, if the IPID of the zombie does not increment by 2 (1,234
    + 2 = 1,236), the port on the victim’s machine is closed. As packets are sent
    between the attacker, the zombie, and the victim's machine, the fragmentation
    ID will increase on the zombie and target as they are communicating. We can execute
    an Idle scan using Nmap, the syntax of the command is `nmap –Pn –sI <zombie IP
    addr> <target IP addr>`**.**
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后阶段，如果僵尸的IPID没有增加2（1,234 + 2 = 1,236），则受害者机器上的端口关闭。由于数据包在攻击者、僵尸和受害者机器之间发送，因此僵尸和目标的分片ID将增加，因为它们正在通信。我们可以使用Nmap执行空闲扫描，命令的语法是`nmap
    –Pn –sI <zombie IP addr> <target IP addr>`**。**
- en: The zombie machine is ideal within this type of scanning method, as the target
    would think the probing is being done by the zombie machine and not the actual
    attacker machine.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 僵尸机器在这种扫描方法中是理想的，因为目标会认为探测是由僵尸机器而不是实际的攻击者机器进行的。
- en: 'You will get the following screenshot by running the preceding command:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行上述命令，您将获得以下屏幕截图：
- en: '![image](img/fd84f8f9-0f88-4d67-9a89-bcac000885fe.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/fd84f8f9-0f88-4d67-9a89-bcac000885fe.jpg)'
- en: You can always view the manual page of Nmap using the `man nmap` command or
    simply typing `nmap` in the Terminal window and pressing *Enter*.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`man nmap`命令查看Nmap的手册页面，或者在终端窗口中键入`nmap`并按*Enter*。
- en: MAC spoofing
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: MAC地址欺骗
- en: As we have learned, spoofing is simply tricking the target into believing traffic
    or a request is originating from another device or a trusted source. Both IP and
    MAC addresses can be spoofed quite easily since the TCP/IP protocol suite was
    not designed for modern-day security threats.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所了解的，欺骗就是简单地让目标相信流量或请求是来自另一个设备或受信任的来源。由于TCP/IP协议套件并未设计用于现代安全威胁，因此IP和MAC地址都可以很容易地被欺骗。
- en: To prevent MAC address spoofing within a network, network security professionals
    can implement **Dynamic ARP Inspection (DAI)** on Cisco IOS Switches.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止网络中的MAC地址欺骗，网络安全专业人员可以在Cisco IOS交换机上实施**动态ARP检查（DAI）**。
- en: 'To generate and assign a random MAC address to an interface, we must do the
    following:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 要为接口生成和分配随机MAC地址，我们必须执行以下操作：
- en: 'Logically turn down the interface using the `ifconfig wlan0 down` command:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`ifconfig wlan0 down`命令逻辑地关闭接口：
- en: '![image](img/3ba571c3-3613-40cf-a441-8a445d6668a6.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/3ba571c3-3613-40cf-a441-8a445d6668a6.jpg)'
- en: 'Verify the current and permanent MAC addresses on the specified interface using
    the `macchanger –-show wlan0` command:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`macchanger --show wlan0`命令验证指定接口的当前和永久MAC地址：
- en: '![image](img/9638673e-c896-4965-96f5-c36cd12029c2.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/9638673e-c896-4965-96f5-c36cd12029c2.png)'
- en: 'Use the **`macchanger --random wlan0`** command to generate and assign the
    MAC to our `wlan0` interface:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**`macchanger --random wlan0`**命令为我们的`wlan0`接口生成和分配MAC地址：
- en: '![image](img/c97c8640-ba41-4d43-90d8-58f7d1dfe8c9.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/c97c8640-ba41-4d43-90d8-58f7d1dfe8c9.png)'
- en: 'Re-enable the interface using the `ifconfig wlan0 up` command:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`ifconfig wlan0 up`命令重新启用接口：
- en: '![image](img/a485d9a4-a450-4268-a369-3a6f27dd17f7.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/a485d9a4-a450-4268-a369-3a6f27dd17f7.png)'
- en: Additionally, you can use the **`macchanger –-help`** command to view all the
    options available.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您可以使用**`macchanger –-help`**命令查看所有可用选项。
- en: 'You will obtain the following screenshot by running **`macchanger –-help`**
    command:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行**`macchanger –-help`**命令，您将获得以下截图：
- en: '![image](img/96309cfe-c991-4aab-a921-fd0c705d81bc.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/96309cfe-c991-4aab-a921-fd0c705d81bc.jpg)'
- en: As you can see, the possibilities in terms of generating a random MAC address
    to cloak your identity is very easy.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，生成随机MAC地址以隐藏您的身份的可能性非常容易。
- en: Fragmentation
  id: totrans-75
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分段
- en: Another method hackers and penetration testers use to avoid detection is **fragmentation**.
    Fragmentation breaks up a message (packet) into tiny pieces. Fragments are put
    into a network since, these tiny pieces of the messages usually are able to bypass
    almost any network for security appliance and monitoring tools that are proactively
    observing network traffic and activities for security threats.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 黑客和渗透测试人员用来避免被检测的另一种方法是**分段**。分段将消息（数据包）分成小块。由于这些消息的小片段通常能够绕过几乎所有用于主动观察网络流量和安全威胁的安全设备和监控工具，因此这些片段被放入网络中。
- en: In a fragmentation attack, the attacker can modify the **Time to Live** (**TTL**)
    or the timeout values between each bit sent through the firewall or **intrusion-prevention
    system** (**IPS**). This would cause the security appliance to not easily detect
    a threat and confuse the device during a reassembly process.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在分段攻击中，攻击者可以修改防火墙或**入侵防范系统**（IPS）中每个比特发送的**生存时间**（TTL）或超时值。这将导致安全设备不容易检测到威胁，并在重新组装过程中混淆设备。
- en: The attack can send fragments of a payload to the victim machine and have it
    reassemble to a payload without being detected at all.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可以向受害者机器发送有效负载的片段，并使其重新组装成有效负载，而完全不被检测到。
- en: 'Nmap allows us to perform port scanning with packet fragmentation on a target
    device. We can use the `nmap –f <target IP address>` command:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap允许我们对目标设备进行分段的端口扫描。我们可以使用`nmap –f <目标IP地址>`命令：
- en: '![image](img/f8413471-feef-4770-a437-0107b90f3812.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/f8413471-feef-4770-a437-0107b90f3812.png)'
- en: 'Using Wireshark, we can see how each probe is broken up into smaller pieces
    as they are sent to the target:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Wireshark，我们可以看到每个探测被分成较小的片段，然后发送到目标。
- en: '![image](img/3e5df8af-4406-48e4-bec6-9adabd477673.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/3e5df8af-4406-48e4-bec6-9adabd477673.png)'
- en: This technique reduces chances of detection when a network has an IDS, IPS,
    or anti-virus software.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 这种技术可以降低网络中存在IDS、IPS或防病毒软件时被检测到的几率。
- en: Metasploit Payload Generator
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Metasploit有效负载生成器
- en: 'In this book, we have covered various topics and tools. Once particular tool
    within the Kali NetHunter platform is **Metasploit Payload Generator**. The name
    of this tools pretty much describes its function: to generate payloads using the
    Metasploit framework. Upon opening the app in Kali NetHunter, we are presented
    with the following:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们涵盖了各种主题和工具。Kali NetHunter平台中的一个特定工具是**Metasploit Payload Generator**。这个工具的名称基本上描述了它的功能：使用Metasploit框架生成有效负载。在Kali
    NetHunter中打开应用程序后，我们会看到以下内容：
- en: '![image](img/90757476-f1c2-4cd4-8e34-5bef47d595cd.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/90757476-f1c2-4cd4-8e34-5bef47d595cd.jpg)'
- en: 'As you can see, we can select the type of payload we would like to generate,
    the IP address and port number, and additional payload options. If we click on
    the drop-down menu for **Type**, we will be presented with the following options:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，我们可以选择要生成的有效负载类型、IP地址和端口号，以及其他有效负载选项。如果我们点击**类型**的下拉菜单，我们将看到以下选项：
- en: '![image](img/4c794b0f-60e7-448d-bde4-44fe0f01db66.jpg)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/4c794b0f-60e7-448d-bde4-44fe0f01db66.jpg)'
- en: There are many different types to choose from. An example of leveraging the
    benefits of this feature would be to select the Windows (.exe) type if you’re
    creating a payload for a Microsoft Windows system. This would convince the target/victim
    device – in this case a Windows operating system – that the `.exe` file can be
    trusted as it seems to be a native executable file.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多不同的类型可供选择。利用此功能的一个示例是，如果要为Microsoft Windows系统创建有效负载，则可以选择Windows (.exe)类型。这将使目标/受害设备（在本例中是Windows操作系统）相信`.exe`文件是可信的，因为它看起来像是本机可执行文件。
- en: Depending on the target operating system and objectives of a penetration test,
    penetration testers are provided with multiple options, are seen in the preceding
    screenshot.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 根据渗透测试的目标操作系统和目标，渗透测试人员可以在上述截图中看到多个选项。
- en: Encrypting traffic
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加密流量
- en: Most organizations would deploy an **IPS** to proactively monitor inbound and
    outbound traffic, paying particular attention to any malicious traffic in native
    or other types of security threats.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数组织会部署**IPS**来主动监视出站和入站流量，特别关注本地或其他类型的安全威胁中的任何恶意流量。
- en: One technique to evade IPS and anti malware systems is by using encryption.
    Most firewalls are unable to detect malware within an encrypted packet by default.
    However, the Next-Generations firewall, has a feature called Deep-packet Inspection
    (DPI), which usually unpackages the contents of each packet, and scans and analyzes
    it. If no threats are detected, it repackages and sends off the packet to its
    destination. If a threat is detected, the firewall will quarantine it and send
    an alert on its management console interface and any other logging system.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 一种规避IPS和反恶意软件系统的技术是使用加密。大多数防火墙默认情况下无法检测加密数据包中的恶意软件。然而，下一代防火墙具有一个称为深度数据包检查（DPI）的功能，通常会解开每个数据包的内容，并对其进行扫描和分析。如果没有检测到威胁，它会重新打包并将数据包发送到目的地。如果检测到威胁，防火墙将对其进行隔离，并在其管理控制台界面和任何其他日志记录系统上发送警报。
- en: 'Additionally, most IPSes do not have the capabilities to decrypt a message
    to view its contents. This would allow an attacker to encrypt the malicious payload
    and pass it through the IPS appliance without being detected. The following diagram
    shows the typical setup of a company''s network; if **DPI** is disabled on the
    firewall, it will allow the encrypted file (malicious payload) to pass through:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，大多数IPS没有解密消息以查看其内容的能力。这将允许攻击者加密恶意有效载荷并通过IPS设备而不被检测到。以下图表显示了公司网络的典型设置；如果防火墙上禁用了DPI，它将允许加密文件（恶意有效载荷）通过：
- en: '![image](img/a93f7ea6-e300-4ac0-896b-bb75f97967b0.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![image](img/a93f7ea6-e300-4ac0-896b-bb75f97967b0.jpg)'
- en: A penetration tester can use the **VirusTotal** website ([www.virustotal.com](http://www.virustotal.com))
    to test their encrypted payloads for the level of detection by various anti-malware
    engines. The goal as the penetration tester is to ensure your payload is undetectable
    by all or most anti-malware programs. By modifying the encoding on payload, we
    can also reduce detection levels.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员可以使用VirusTotal网站（www.virustotal.com）来测试其加密的有效载荷在各种反恶意软件引擎中的检测水平。作为渗透测试人员的目标是确保您的有效载荷在所有或大多数反恶意软件程序中都是不可检测的。通过修改有效载荷的编码，我们还可以降低检测水平。
- en: Summary
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we discussed some techniques that a penetration tester can
    use to avoid detection, such as spoofing MAC addresses and scanning targets while
    not revealing our true identity. However, a penetration tester should not limit
    themself to only using the techniques and methods mentioned in this chapter. The
    great thing about being a cybersecurity professional in the field of penetration
    testing is the limitless number of ways an attacker can attempt to be stealthy.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了一些渗透测试人员可以使用的避免检测的技术，例如欺骗MAC地址和扫描目标而不暴露我们的真实身份。然而，渗透测试人员不应该局限于仅使用本章提到的技术和方法。作为渗透测试领域的网络安全专业人员，攻击者可以尝试各种无限的方式来保持隐秘，这是一个很棒的地方。
- en: In the next chapter, we will cover hardening techniques and countermeasures.
    There, you will learn how to secure the Windows, Linux, and Mobile operating systems.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍加固技术和对策。在那里，您将学习如何保护Windows、Linux和移动操作系统。
