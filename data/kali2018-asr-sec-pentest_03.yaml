- en: Penetration Testing Methodology
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试方法论
- en: One of the most vital factors in conducting a successful pen test is the fundamental
    methodology. A lack of a formal methodology means no uniformity, and I am sure
    you don't want to be the one funding a pen test and watching the testers poking
    around cluelessly.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 进行成功的渗透测试的一个最关键因素是基本方法。缺乏正式的方法意味着缺乏统一性，我相信你不想成为资助渗透测试并看着测试人员毫无头绪地探索的人。
- en: A methodology defines a set of rules, practices, and procedures that are pursued
    and implemented during the course of any information-security audit program. A
    penetration testing methodology defines a roadmap with practical ideas and proven
    practices that can be followed to assess the true security posture of a network,
    application, system, or any combination thereof.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 方法论定义了在任何信息安全审计程序过程中追求和实施的一组规则、实践和程序。渗透测试方法论定义了一个具有实用想法和经过验证实践的路线图，可以用来评估网络、应用程序、系统或任何组合的真实安全状况。
- en: While a penetration tester's skills need to be specific for the job, the manner
    in which it is conducted shouldn't be. That being said, a proper methodology should
    provide a meticulous framework for conducting a complete and truthful penetration
    test, but need not be obstructive—it should allow the tester to fully explore
    their hunches.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然渗透测试人员的技能需要针对工作具体要求，但进行测试的方式不应该是固定的。也就是说，适当的方法应该为进行完整和真实的渗透测试提供一个细致的框架，但不应该是障碍性的——它应该允许测试人员充分探索他们的直觉。
- en: Technical requirements
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: You must have Kali Linux and Nmap installed in your system as we will use them
    in this chapter.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 你必须在系统中安装Kali Linux和Nmap，因为我们将在本章中使用它们。
- en: Penetration testing methodology
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试方法论
- en: 'During scoping the type of test, it is important to know the different type
    of tests and what they consist of; this can be broken down into three groups:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在确定测试类型时，了解不同类型的测试及其组成是很重要的；这可以分为三组：
- en: '**White-box penetration testing**: Here, the tester has complete access and
    in-depth knowledge of the system being tested. The testers work with the client
    and have access to insider information, servers, software running, network diagrams,
    and sometimes even credentials. This test type is normally used to test new applications
    before they are put into production and are routinely conducted as part of the
    **Systems Development Life Cycle** (**SDLC**); this helps to identify vulnerabilities
    and remedy them before rolling out to production.'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**白盒渗透测试**：在这种情况下，测试人员完全可以访问并深入了解正在测试的系统。测试人员与客户合作，并可以访问内部信息、服务器、正在运行的软件、网络图表，有时甚至可以获得凭据。这种测试类型通常用于在应用投入生产之前测试新应用程序，并作为**系统开发生命周期**（**SDLC**）的一部分进行常规测试；这有助于在投入生产之前识别漏洞并加以修复。'
- en: '**Black-box penetration testing**: In the black-box penetration testing approach,
    only high-level information is made available to the tester. The tester is totally
    unaware of the system/network, making this testing type as close to the real world
    as possible. The tester had to acquire all of their information using creative
    methods within the agreement of the client. While this approach mimics the real
    world, sometimes it might miss some areas while testing. If not scoped properly,
    it can be very costly to the client as well as time-consuming. The tester would
    explore all attack vectors and report their findings. The tester must be careful
    because things can break during this type of test.'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**黑盒渗透测试**：在黑盒渗透测试方法中，只向测试人员提供高层次的信息。测试人员对系统/网络完全不了解，使得这种测试类型尽可能接近真实世界。测试人员必须在客户的同意下使用创造性方法获取所有信息。虽然这种方法模仿了真实世界，但有时在测试时可能会错过一些领域。如果范围没有正确确定，这对客户来说可能会非常昂贵，也会耗费时间。测试人员将探索所有攻击向量并报告他们的发现。测试人员必须小心，因为在这种类型的测试中可能会出现问题。'
- en: '**Gray-box penetration testing**: In the middle of the two extremes lies the
    gray-box penetration testing; only limited information is available to the tester
    to attack the system externally. These tests are usually run within a limited
    scope and with the tester having some information about the system.'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**灰盒渗透测试**：在两个极端之间是灰盒渗透测试；测试人员只能获得有限的信息来从外部攻击系统。这些测试通常在有限的范围内进行，并且测试人员对系统有一些了解。'
- en: 'Regardless of which kind of test is chosen, it is important to also follow
    a standard or guidelines to ensure best practices. We will discuss some of the
    most popular standards in more detail:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 无论选择哪种测试，遵循标准或指南以确保最佳实践也是很重要的。我们将更详细地讨论一些最流行的标准。
- en: OWASP testing guide
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OWASP测试指南
- en: PCI penetration testing guide
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PCI渗透测试指南
- en: Penetration Testing Execution Standard
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 渗透测试执行标准
- en: NIST 800-115
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NIST 800-115
- en: '**Open Source Security Testing Methodology Manual** (**OSSTMM**)'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开放源安全测试方法手册**（**OSSTMM**）'
- en: OWASP testing guide
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: OWASP测试指南
- en: The **Open Web Application Security Project** (**OWASP**) is an open source
    community project that develops software tools and knowledge-based documentation
    that helps people secure web applications and web services. OWASP is an open source
    reference point for system architects, developers, vendors, consumers, and security
    professionals involved in designing, developing, deploying, and testing the security
    of web applications and web Services. In short, the OWASP aims to help everyone
    and anyone to build more secure web applications and web services. One of the
    best aspects of the OWASP testing guide is its comprehensive description of determining
    the business risk presented by findings. The OWASP testing guide rates risk based
    on the impact it could have to the business, and the chance it will occur. By
    those aspects described in the OWASP testing guide, the overall risk rating of
    a given finding can be found out, which gives the organization appropriate guidance
    based on the result of their findings.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**开放式Web应用程序安全项目**（**OWASP**）是一个开源社区项目，开发软件工具和基于知识的文档，帮助人们保护Web应用程序和Web服务的安全。OWASP是系统架构师、开发人员、供应商、消费者和参与设计、开发、部署和测试Web应用程序和Web服务安全的安全专业人员的开源参考点。简而言之，OWASP旨在帮助每个人构建更安全的Web应用程序和Web服务。OWASP测试指南最好的方面之一是对发现的业务风险进行全面描述。OWASP测试指南根据其对业务可能产生的影响和发生的机会对风险进行评级。通过OWASP测试指南描述的这些方面，可以找出给定发现的整体风险评级，从而根据其发现结果为组织提供适当的指导。'
- en: 'The OWASP testing guide primarily focuses on the following:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: OWASP测试指南主要关注以下内容：
- en: Techniques and tools in web-application testing
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web应用程序测试中的技术和工具
- en: Information-gathering
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 信息收集
- en: Authentication testing
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 身份验证测试
- en: Business logic testing
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 业务逻辑测试
- en: Data-validation testing
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据验证测试
- en: Denial-of-service attack testing
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拒绝服务攻击测试
- en: Session-management testing
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 会话管理测试
- en: Web services testing
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web服务测试
- en: AJAX testing
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AJAX测试
- en: Risk severity
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 风险严重性
- en: Likely hood of risk
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 风险可能性
- en: PCI penetration testing guide
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: PCI渗透测试指南
- en: Things just got real for companies that need to comply with PCI requirements.
    Not only is PCI v3.2 mandated, the PCI Standards Security Council has issued guidance
    on using penetration testing as part of vulnerability-management programs.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 对于需要遵守PCI要求的公司来说，情况变得更加现实。不仅要求使用PCI v3.2，PCI标准安全委员会还发布了关于将渗透测试作为漏洞管理计划的一部分的指导。
- en: In April 2016, the **Payment Card Industry Security Standards Council** (**PCI
    SSC**) released **PCI Data Security Standard** (**PCI DSS**) version 3.2\. With
    the updates came clarification to requirements, additional guidance, and seven additional new
    requirements.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 2016年4月，**支付卡行业安全标准委员会**（**PCI SSC**）发布了**PCI数据安全标准**（**PCI DSS**）版本3.2。更新内容包括对要求的澄清、额外指导和七个新要求。
- en: To address issues related to cardholder data breaches and protect against existing
    exploits, PCI DSS v.3.2 includes various changes, most of which are specific to
    service providers. This includes new penetration testing requirements that now
    require segmentation testing for Service Providers to now be performed at least
    every six months or after any significant changes to segmentation controls/methods.
    In addition, there are several requirements to ensure that service providers are
    continuously monitoring and maintaining critical security controls throughout
    the year.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决与持卡人数据泄露相关的问题并防止现有的利用，PCI DSS v.3.2包括各种变化，其中大部分是针对服务提供商的。这包括新的渗透测试要求，现在要求服务提供商至少每六个月或在分割控制/方法发生重大变化后进行分割测试。此外，还有几项要求，以确保服务提供商在整年内持续监控和维护关键的安全控制。
- en: Penetration Testing Execution Standard
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试执行标准
- en: The Penetration Testing Execution Standard consists of seven main sections.
    They cover everything concerning a penetration test – from the preliminary communication
    and effort behind a pen test; through the information-gathering and threat-modeling
    phases where testers are working behind the scenes to get a better understanding
    of the tested corporation; through vulnerability research, exploitation, and post-exploitation,
    where the practical security knowledge of the testers come to play and combine
    with the business intelligence; and finally to reporting, which outlines the entire
    procedure in a format that the customer can understand.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试执行标准包括七个主要部分。它们涵盖了渗透测试的一切内容 - 从渗透测试背后的初步沟通和努力；通过信息收集和威胁建模阶段，测试人员在幕后工作，以更好地了解被测试的公司；通过漏洞研究、利用和后利用，测试人员的实际安全知识发挥作用并与业务智能结合；最后是报告，它以客户能够理解的格式概述了整个过程。
- en: This version can be considered v1.0 as the core elements of the standard are
    solidified, and have been field-tested for over a year through the industry. v2.0
    is in the making, and will provide more granular work in terms of levels – as
    in the intensity levels at which each of the elements of a penetration test can
    be performed. As no pen test is like another, and testing will range from web
    application or network tests to a full-on red-team black-box engagement, said
    levels will enable an organization to outline how much complexity they expect
    their testers to unveil, and enable the tester to step up the intensity in the
    areas that the organization deems necessary. Some of the initial work on levels
    can be seen in the intelligence—gathering section.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 这个版本可以被视为v1.0，因为标准的核心元素已经巩固，并且已经通过行业进行了一年的现场测试。v2.0正在制作中，将在各个级别提供更细粒度的工作，即渗透测试的每个元素可以进行的强度级别。由于没有两次渗透测试是相同的，测试将从Web应用程序或网络测试到全面的红队黑盒参与，这些级别将使组织能够概述他们期望测试人员揭示的复杂程度，并使测试人员在组织认为必要的领域加强强度。级别的一些初始工作可以在情报收集部分中看到。
- en: 'The following are the main sections defined by the standard as the basis for
    executing penetration tests:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是标准定义的执行渗透测试的主要部分：
- en: Pre-engagement interactions
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预先交互
- en: Intelligence-gathering
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 情报收集
- en: Threat-modeling
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 威胁建模
- en: Vulnerability analysis
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞分析
- en: Exploitation
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用
- en: Post-exploitation
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 后期利用
- en: Reporting
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 报告
- en: NIST 800-115
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: NIST 800-115
- en: The **National Institute of Standards and Technology Special Publication** (**NIST-SP-800-115**)
    is the technical guide to information-security testing and assessment. The publication
    is produced by **Information Technology Laboratory** (**ITL**) at NIST.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '**国家标准与技术研究所特别出版物**（**NIST-SP-800-115**）是信息安全测试和评估的技术指南。该出版物由NIST的**信息技术实验室**（**ITL**）制作。'
- en: The guide defines a security assessment as the process of determining how effectively
    an entity being assessed meets specific security requirements. As you review the
    guide, you will see it contains a great amount of information for testing. While
    the document does not get updated as often as we would like, it is a viable resource
    for us as a reference when building our methodology for testing.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 该指南将安全评估定义为确定被评估实体如何满足特定安全要求的过程。当你审查该指南时，你会发现它包含了大量测试信息。虽然该文件的更新频率不如我们希望的那样频繁，但它是我们在构建测试方法论时的一个可行资源。
- en: They offer practical guidelines for designing, implementing, and maintaining
    technical information, security tests, and examination processes and procedures,
    by covering the key element or technical security-testing and examination.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 它们提供了设计、实施和维护技术信息、安全测试和审查过程和程序的实用指南，涵盖了技术安全测试和审查的关键元素。
- en: These can be used for several reasons, such as finding vulnerabilities in a
    system or network and verifying compliance with a policy or other requirements.
    The guide is not intended to present an all-inclusive information-security testing
    and examination program but rather an outline of key elements of technical security
    testing and examination, with a weight on specific technical techniques, the benefits
    and limitations of each, and recommendations for their use.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 这些可以用于多种原因，比如发现系统或网络中的漏洞，验证合规性或其他要求。该指南并不旨在提供全面的信息安全测试和审查程序，而是概述了技术安全测试和审查的关键要素，重点是特定的技术技巧，每种技巧的优缺点以及对其使用的建议。
- en: The NIST 800-115 standard provides a great map for pen testers that is an accepted
    industry standard. This model is a great way to ensure that your penetration testing
    program complies with best practices.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: NIST 800-115标准为渗透测试人员提供了一个被接受的行业标准的地图。这个模型是确保你的渗透测试程序符合最佳实践的好方法。
- en: Open Source Security Testing Methodology Manual
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开放源安全测试方法手册
- en: 'The OSSTMM isn''t the easiest or most fun document to read but it''s full of
    advanced security information that''s practical and relevant. It''s also the best-known
    operational security manual on the planet with about half a million downloads
    each month for one particular reason: those who figure it out have a distinct
    security advantage, as its instructions are about a decade ahead of the current
    buzz in the security industry.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: OSSTMM并不是最容易或最有趣的文件，但它充满了实用和相关的高级安全信息。它也是全球最知名的操作安全手册，每个月约有50万次下载，原因是：那些搞清楚它的人在安全方面具有明显的优势，因为它的指导比安全行业当前的热点大约领先了十年。
- en: The goal of the OSSTMM is to put forth a standard for internet security testing.
    It is intended to form a complete baseline for testing that, when followed, ensures
    a thorough and comprehensive penetration test has been undertaken. This should
    enable a client to be convinced of the level of technical assessment independent
    of other organization concerns, such as the corporate profile of the penetration
    testing provider.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: OSSTMM的目标是提出一个互联网安全测试的标准。它旨在形成一个完整的测试基线，遵循该基线可以确保进行了彻底和全面的渗透测试。这应该使客户相信技术评估的水平，而不受其他组织关注的影响，比如渗透测试提供商的企业概况。
- en: General penetration testing framework
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 一般渗透测试框架
- en: 'While some of these standards vary in their number of requirements, they can
    be loosely be broken down into the following phases:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这些标准在要求数量上有所不同，但它们可以大致分为以下阶段：
- en: Reconnaissance
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 侦察
- en: Scanning and enumeration
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描和枚举
- en: Gaining access
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取访问
- en: Escalation of privileges
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 权限升级
- en: Maintaining access
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保持访问
- en: Covering your tracks
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 掩盖你的踪迹
- en: Reporting
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 报告
- en: Let's look at each phase in more detail.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更详细地看看每个阶段。
- en: Reconnaissance
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 侦察
- en: A huge portion of your penetration testing time will be spent in this first
    critical part of the test. While some break down this phase into active and passive,
    I prefer to clump them together as the data acquired would speak for itself.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 你的渗透测试时间的大部分将花在测试的这个关键部分。虽然有些人将这个阶段分为主动和被动，但我更喜欢将它们合并在一起，因为获取的数据会说明一切。
- en: Reconnaissance is the systematic approach where you attempt to locate and gather
    as much information on your target, this is otherwise known as foot-printing.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察是一种系统化的方法，你试图定位并收集有关目标的尽可能多的信息，这也被称为足迹技术。
- en: 'The techniques involved in foot-printing include but are not limited to the
    following:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 足迹技术涉及的技术包括但不限于以下内容：
- en: Social engineering (this is great fun)
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 社会工程学（这很有趣）
- en: Internet research (Google, Bing, LinkedIn, and so on)
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网研究（谷歌、必应、LinkedIn等）
- en: Dumpster-diving (getting your hands dirty)
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 垃圾箱搜寻（弄脏你的手）
- en: Cold-calling
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 冷调
- en: It's basically any way you can acquire any information on your target, so be
    creative. So, what are we looking for?
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上任何你可以获取目标信息的方式，所以要有创造力。那么，我们在寻找什么呢？
- en: 'Well, every bit of info is useful, but it needs to be prioritized and keep
    in mind that something that you may not find useful at first just might come in
    handy somewhere else. But for starters the important things would be the following:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 每一点信息都是有用的，但需要优先考虑，并记住一开始可能认为无用的东西可能在其他地方派上用场。但首先重要的事情将是以下内容：
- en: Contact names within the organization
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 组织内的联系人姓名
- en: Other locations of the organization (if any)
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 组织的其他位置（如果有的话）
- en: Email addresses (which we could later used for phishing, whaling, or spear-phishing)
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电子邮件地址（以后可以用于钓鱼、鲸鱼或鱼叉式钓鱼）
- en: Phone numbers of important figures within the company (these can be used for
    phishing)
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司内重要人物的电话号码（这些可以用于钓鱼）
- en: Systems used within the company such as Windows or Linux
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司使用的系统，如Windows或Linux
- en: Job postings
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 招聘启事
- en: Employee CVs (past/present)
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 员工简历（过去/现在）
- en: While all of this might be self-explanatory, job postings seems a bit strange;
    however, let's say you come across one for a system admin, and based on the requirements
    that they are asking for the position it would provide, you with a lot of information
    about their internal systems. This can then be used to come up with attack vectors
    or to find exploits.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然所有这些可能都是不言自明的，但招聘启事似乎有点奇怪；然而，假设您遇到了一个系统管理员的招聘启事，并且根据他们要求的职位要求，这将为您提供有关他们内部系统的大量信息。然后可以用来制定攻击向量或找到漏洞。
- en: Employee CVs work in a similar manner; by knowing what their employees' skill
    sets are, you can determine what kind of systems they may or may not be running.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 员工简历以类似的方式工作；通过了解员工的技能，您可以确定他们可能正在运行的系统类型。
- en: While this might seem tedious, keep in mind that the more information you have,
    the more capable you would be when making decisions later. I personally find myself
    coming back to this phase throughout the engagement.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这可能看起来很繁琐，但请记住，拥有的信息越多，以后做决定时就会更有能力。我个人发现自己在整个过程中都会回到这个阶段。
- en: Scanning and enumeration
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扫描和枚举
- en: Without a doubt, almost every security professional wants to jump straight into
    exploiting boxes, but without understanding the basics, the exploits, and most
    importantly, the environment they are in. This can lead to mistakes or worse,
    such as breaking things in a live environment.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 毫无疑问，几乎每个安全专业人员都想立即开始利用漏洞，但没有理解基础知识、漏洞，最重要的是他们所处的环境。这可能会导致错误，或者更糟糕的是，在实时环境中出现问题。
- en: Scanning and enumeration allows a pen tester to understand their environment.
    The result one gets from these scans gives the red team a starting point to leverage
    vulnerabilities in different systems. Scanning is finding all available network
    services (TCP and UDP) running on the targeted hosts. This can help a red teamer
    discover whether SSH/Telnet is open to try a brute-force login and discover file
    shares to download data from, websites that may have vulnerabilities, or printers
    that may hold usernames and passwords. Enumeration is the discovery of services
    on the network to have a greater sense of information provided by the network
    services.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描和枚举允许渗透测试人员了解他们的环境。从这些扫描中得到的结果为红队提供了一个利用不同系统漏洞的起点。扫描是找到目标主机上运行的所有可用网络服务（TCP和UDP）。这可以帮助红队发现SSH/Telnet是否开放以尝试暴力登录，发现文件共享以下载数据，可能存在漏洞的网站，或者可能保存用户名和密码的打印机。枚举是发现网络上的服务，以获得网络服务提供的更多信息。
- en: Scanning
  id: totrans-88
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 扫描
- en: When there is a doubt that mitigating controls, such as firewalls, intrusion-detection
    systems, and file-integrity monitoring, a full penetration test is ideal. Scanning
    will locate individual vulnerabilities; however, penetration testing will attempt
    to verify that these vulnerabilities are exploitable within the target environment.
    Let's have a look into each of the types.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 当怀疑缓解控制措施，如防火墙、入侵检测系统和文件完整性监控时，进行全面渗透测试是理想的。扫描将找到单个漏洞；然而，渗透测试将尝试验证这些漏洞在目标环境中是否可利用。让我们来看看每种类型。
- en: ARP scanning
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ARP扫描
- en: By using ARP broadcast, we can take advantage of getting IP information. Each
    ARP broadcast frame requests who has which IP address—the IP address is increased
    by one each time. Once a host has that IP address, it will respond to the request
    with the requested IP address and its MAC address.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用ARP广播，我们可以利用获取IP信息。每个ARP广播帧都会请求谁拥有哪个IP地址——每次增加一个IP地址。一旦主机拥有该IP地址，它将以所请求的IP地址和其MAC地址回应请求。
- en: ARP scanning is an effectively fast method, and typically won't set off any
    alarms; the issue with this is that ARP is a layer 2 protocol so it can't go over
    network boundaries. Meaning if the red team is on network `192.100.0.0/24` and
    your target(s) is on network `10.16.X.0/24`, you can't send ARP requests to `10.16.X.0/24`.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: ARP扫描是一种有效快速的方法，通常不会引起任何警报；但问题在于ARP是一个第二层协议，所以它不能跨越网络边界。这意味着如果红队在网络`192.100.0.0/24`上，而您的目标在网络`10.16.X.0/24`上，您无法向`10.16.X.0/24`发送ARP请求。
- en: The network mapper (Nmap)
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络映射器（Nmap）
- en: 'Nmap is the top dog in port scanning and enumeration. Covering all options
    and modules of Nmap in this guide is outside the scope of this book; instead,
    we will cover the scans that I mostly use when testing. But first, here''s some
    info on port states:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap是端口扫描和枚举中的佼佼者。在本指南中涵盖Nmap的所有选项和模块超出了本书的范围；相反，我们将介绍我在测试时主要使用的扫描。但首先，这里有一些关于端口状态的信息：
- en: '**Open**: An application on the target machine is listening for connections/packets
    on that port'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开放**：目标机器上的应用正在监听该端口的连接/数据包'
- en: '**Closed**: Ports have no application listening on them, though they could
    open up at any time'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关闭**：端口上没有应用程序在监听，但随时可能打开'
- en: '**Filtered**: A firewall, filter, or other network obstacle is blocking the
    port so that Nmap cannot tell whether it is open or closed'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**过滤**：防火墙、过滤器或其他网络障碍正在阻止端口，因此Nmap无法确定它是开放还是关闭的'
- en: 'The following are the Nmap options available:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是Nmap可用的选项：
- en: '`O`: OS detection'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`O`：操作系统检测'
- en: '`p`: Port scan'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`p`：端口扫描'
- en: '`p-`: Scan all ports (`1-65535`)'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`p-`：扫描所有端口（`1-65535`）'
- en: '`p 80,443`: Scan port `80` and ``443``'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`p 80,443`：扫描端口`80`和`443`'
- en: '`p 22-1024`: Scan ports `22` through `1024`'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`p 22-1024`：扫描端口`22`到`1024`'
- en: '`top-ports X`: `X` is a number and it will scan `X` number of the top popular
    ports; I usually use 100 for a quick scan'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`top-ports X`：`X`是一个数字，它将扫描`X`个最受欢迎的端口；我通常用100进行快速扫描。'
- en: '`sV`: Service-detection'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sV`：服务检测'
- en: '`Tx`: Set scan speed'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Tx`：设置扫描速度'
- en: '`T1`: Really slow port scan'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`T1`：非常慢的端口扫描'
- en: '`T5`: Really fast port scan (really noisy)'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`T5`：非常快的端口扫描（非常吵闹）'
- en: '`sS`: Stealth scan'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sS`：隐秘扫描'
- en: '`sU`: UDP scan'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sU`：UDP扫描'
- en: '`A`: OS-detection, version-detection, script-scanning, and traceroute'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`A`：操作系统检测，版本检测，脚本扫描和路由跟踪'
- en: Nmap port scanner/TCP scan
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Nmap端口扫描器/TCP扫描
- en: 'This service will start by initiating (`SYN`) connection on each port on a
    target host. If the port is open, the host will respond with (`SYN`, `ACK`). The
    connection is closed with a reset (`RST`) sent by the initiator:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 这项服务将通过在目标主机的每个端口上发起（SYN）连接来开始。如果端口是开放的，主机将用（SYN`，`ACK`）回应。连接将由发起方发送的复位（`RST`）关闭：
- en: '![](img/e7b85063-c1d9-4dd4-b6c6-cd7bf039fe9b.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e7b85063-c1d9-4dd4-b6c6-cd7bf039fe9b.jpg)'
- en: Nmap half-open/stealth scan
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Nmap半开放/隐秘扫描
- en: This option will start by sending (`SYN`) a connection on each port on a target
    host. If the port is open, the host will reply to the request with (`SYN`, `ACK`).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 这个选项将通过在目标主机的每个端口上发送（`SYN`）连接来开始。如果端口是开放的，主机将用（`SYN`，`ACK`）回复请求。
- en: If the port is not open (that is, closed), the host will answer with a connection
    reset (`RST`).
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 如果端口没有打开（即关闭），主机将用连接复位（`RST`）回答。
- en: If no response is received, it is assumed that the port is filtered. The difference
    between a TCP scan and a stealth scan is that the connection initiator will not
    respond with an acknowledgement (`ACK`) packet. What makes this an effective scan
    is that since a full connection wasn't established it won't be logged.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有收到响应，就假定端口被过滤了。TCP扫描和隐秘扫描的区别在于连接发起方不会用确认（`ACK`）数据包来回应。这种扫描的有效之处在于，由于没有建立完整的连接，所以不会被记录日志。
- en: Nmap OS-detection
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Nmap操作系统检测
- en: 'This option will use various techniques to try to identify the operating system
    type and version. This is very useful for vulnerability-detection. Doing a quick
    search on the OS version will show known vulnerabilities and exploits for the
    operating system to give you a better lay of the land with the help of the following
    command:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这个选项将使用各种技术来尝试识别操作系统类型和版本。这对于漏洞检测非常有用。快速搜索操作系统版本将显示已知的漏洞和操作系统的利用，以便更好地了解网络情况，使用以下命令：
- en: '[PRE0]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Nmap service-detection
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Nmap服务检测
- en: 'Similar to OS-detection, this options tries to determine the service and version
    as shown in the following screenshot:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 与操作系统检测类似，这个选项试图确定服务和版本，如下图所示：
- en: '[PRE1]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](img/8793c2c4-5088-43c1-ae9e-c59c7214c887.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8793c2c4-5088-43c1-ae9e-c59c7214c887.png)'
- en: Nmap ping sweeps
  id: totrans-126
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Nmap ping扫描
- en: 'This option will send an ICMP request to every IP address in a given range.
    If the host is up and it is configured to respond to ping requests, it will reply
    with an ICMP reply, as shown in the following screenshot:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 这个选项将向给定范围内的每个IP地址发送一个ICMP请求。如果主机处于启动状态并且配置为响应ping请求，它将用ICMP回复回应，如下图所示：
- en: '[PRE2]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](img/8a7a6fc0-b8f7-4ced-97eb-0c6fa195f82d.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8a7a6fc0-b8f7-4ced-97eb-0c6fa195f82d.png)'
- en: Enumeration
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 枚举
- en: Enumeration serves as a base for all of the attacks and weaknesses found in
    the web applications. The development view merges these attacks and weaknesses
    into vulnerabilities and categorizes them according to their occurrence in the
    relative development phase. This could be a design, implementation, or deployment
    phase. There are several enumeration techniques; we will have a look at a few.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 枚举作为发现Web应用程序中的所有攻击和弱点的基础。开发视图将这些攻击和弱点合并为漏洞，并根据它们在相关开发阶段的发生进行分类。这可能是设计、实施或部署阶段。有几种枚举技术；我们将看一些。
- en: SMB shares
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SMB共享
- en: '**SMB** stands for **Server Message Block**. It''s a file-sharing protocol
    that was invented by IBM and has been around since the mid-1980s. The SMB protocol
    was designed to allow computers to read and write files to a remote host over
    a **Local Area Network** (**LAN**). The directories on the remote hosts made available
    via SMB are called shares.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '**SMB**代表**服务器消息块**。这是一种由IBM发明的文件共享协议，自20世纪80年代中期以来一直存在。SMB协议旨在允许计算机通过**局域网**（**LAN**）读取和写入远程主机上的文件。通过SMB提供的远程主机上的目录称为共享。'
- en: This technique has several benefits, which we will discuss.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 这种技术有几个好处，我们将讨论。
- en: DNS zone transfer
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DNS区域传输
- en: DNS is my favorite protocol because it's a treasure trove of information. If
    you can request a zone transfer, the tester can get all the DNS records for a
    particular zone. This will identify the hostname-to-IP-address relationship of
    all hosts in the network. If the attacker has any knowledge of the network scheme,
    this can be the fastest method to discover all hosts on a network. DNS can also
    give rise to services that are running on the network, such as mail servers.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: DNS是我最喜欢的协议，因为它是信息的宝库。如果可以请求区域传输，测试人员可以获得特定区域的所有DNS记录。这将确定网络中所有主机的主机名到IP地址的关系。如果攻击者对网络方案有任何了解，这可能是发现网络上所有主机的最快方法。DNS还可以显示运行在网络上的服务，如邮件服务器。
- en: DNSRecon
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DNSRecon
- en: 'DNSRecon is my go-to tool for DNS recon and enumeration. In this example, we
    will request a zone transfer from `domain.foo`. The DNS server running at `domain.foo`
    will return all of the records that it is aware of for `domain.foo` and any subdomains
    associated with it. This gives us the name of servers with their respective hostnames
    and IP addresses for the domain. It returned all DNS records, which were `TXT
    records (4)`, `PTR records (1)`, `MX records for mail servers (10)`, `IPv6 A records
    (2)`, and `IPv4 A records (12)`. The records provide some really juicy information
    about the network. One record shows the IP address of their DC office, another
    shows the IP address of their firewall appliance, another shows that they have
    a VPN and its IP address, and another record shows the IP address of the mail
    server login portal, as shown in the following screenshot:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: DNSRecon是我用于DNS侦察和枚举的首选工具。在这个例子中，我们将从`domain.foo`请求区域传输。运行在`domain.foo`上的DNS服务器将返回它所知道的所有`domain.foo`和与之相关的任何子域的记录。这为我们提供了服务器名称及其相应的主机名和IP地址。它返回了所有DNS记录，其中包括`TXT记录（4）`，`PTR记录（1）`，`邮件服务器的MX记录（10）`，`IPv6
    A记录（2）`和`IPv4 A记录（12）`。这些记录提供了关于网络的一些非常有价值的信息。其中一条记录显示了他们DC办公室的IP地址，另一条显示了他们防火墙设备的IP地址，另一条显示了他们有VPN及其IP地址，另一条记录显示了邮件服务器登录门户的IP地址，如下图所示：
- en: '[PRE3]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](img/ccd1dbba-cc78-45ea-8235-53a5ac4a116b.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ccd1dbba-cc78-45ea-8235-53a5ac4a116b.png)'
- en: SNMP devices
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SNMP设备
- en: '**Simple Network Management Protocol**, known as **SNMP** for short, is used
    to log and manage network devices and applications. SNMP can be used to configure
    devices and applications remotely, but if left unsecured, it can also be used
    to pull down information about said application and devices. This information
    can be used to get a better understanding of the network:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '**简单网络管理协议**，简称**SNMP**，用于记录和管理网络设备和应用程序。SNMP可用于远程配置设备和应用程序，但如果未经安全配置，也可以用于获取有关所述应用程序和设备的信息。这些信息可以用于更好地了解网络：'
- en: '[PRE4]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '`-c`: This is a community string to authenticate to a device.'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '`-c`：这是用于对设备进行身份验证的社区字符串。'
- en: Packet captures
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据包捕获
- en: Capturing packets between two hosts can be very helpful when diagnosing networking
    issues, credential-sniffing, or for fun if you like looking at traffic.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在诊断网络问题、嗅探凭据或者如果你喜欢查看流量的话，捕获两个主机之间的数据包可能非常有帮助。
- en: tcpdump
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: tcpdump
- en: 'This is a command-line utility used to sniff particular types of traffic and
    data off the wire:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个用于从网络上嗅探特定类型的流量和数据的命令行实用程序：
- en: '`-i eth0`: Select an interface to listen on'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-i eth0`：选择要监听的接口'
- en: '`port 80`: Select a port to listen on'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`端口80`：选择要监听的端口'
- en: '`host 172.16.1.1`: Only collect traffic going to/from host'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`host 172.16.1.1`：仅收集发送至/来自主机的流量。'
- en: '`src`: Data coming from'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`src`：数据来源'
- en: '`dst`: Data going to'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dst`：数据发送至'
- en: '`-w output.pcap`: Capture traffic to file on disk'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-w output.pcap`：将流量捕获到磁盘文件上'
- en: Wireshark
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Wireshark
- en: 'This is a GUI utility used to sniff traffic off the wire, as depicted in the
    following screenshot:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个用于从网络上嗅探流量的图形化实用程序，如下图所示：
- en: '`ip.addr/ip.dst/ip.src == 172.16.1.1`'
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ip.addr/ip.dst/ip.src == 172.16.1.1`'
- en: '`tcp.port/tcp.dstport/tcp.srcport == 80`'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`tcp.port/tcp.dstport/tcp.srcport == 80`'
- en: '`udp.port/udp.dstport/udp.srcport == 53`'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`udp.port/udp.dstport/udp.srcport == 53`'
- en: '![](img/04021e39-e0bc-475e-ab75-f0b2fdfad2ec.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](img/04021e39-e0bc-475e-ab75-f0b2fdfad2ec.png)'
- en: Gaining access
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取访问权限
- en: It is in this phase that pen testers try to get a foothold into the company's
    internal network. Nowadays, spear-phishing seems to a very common and effective
    way of accomplishing this. A well-crafted spear-phishing campaign can be launched
    against the company and create a convincing scenario based on the information
    gathered during the reconnaissance phase.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，渗透测试人员试图在公司的内部网络中立足。如今，针对特定目标的网络钓鱼似乎是一种非常常见和有效的方法。一个精心制作的网络钓鱼活动可以针对公司发起，并根据侦察阶段收集的信息创建一个令人信服的场景。
- en: Gaining access can also include using exploits/credentials on a remote service
    to log into a system and then execute a payload.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 获取访问权限也可以包括使用远程服务上的漏洞/凭据登录系统，然后执行有效负载。
- en: Metasploit and PowerShell Empire can aid in this as they both create payloads,
    also known as stagers. Once the stager is executed on the target, it runs in memory.
    This style leaves very little forensic evidence behind. The other case is pushing
    a binary to the remote system and executing the binary via the command line, which
    can be equally effective. This approach is faster and doesn't rely on an internet
    download to be successful.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit和PowerShell Empire可以帮助实现这一点，因为它们都创建有效负载，也称为分段器。一旦分段器在目标上执行，它就在内存中运行。这种方式几乎不留下任何取证证据。另一种情况是将二进制文件推送到远程系统并通过命令行执行该二进制文件，这种方法同样有效。这种方法更快，不依赖于互联网下载的成功。
- en: Exploits
  id: totrans-165
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 漏洞利用
- en: Sometimes the tester may come across services that can be exploited. An exploit
    may be the means of initial access; just be sure that the exploit is 100% reliable.
    Also, running an exploit multiple times may crash the system. This option for
    initial access is typically used with extreme care, unless you have tested it
    and know what you are doing.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 有时测试人员可能会遇到可以利用的服务。利用可能是初始访问的手段；只要确保利用是100%可靠的。此外，多次运行利用可能会导致系统崩溃。这种初始访问选项通常需要极度小心使用，除非你已经测试过并知道自己在做什么。
- en: It's always SSH! Maybe it's not always, but I have never seen/can remember another
    service being used, outside of telnet, which should not be used anyways. SSH goes
    with Linux like peanut butter goes with jelly.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 总是SSH！也许不总是，但我从来没有见过/记得其他服务被使用，除了telnet，而telnet本来就不应该被使用。SSH和Linux就像花生酱和果冻一样搭配。
- en: Exploits for Linux
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 针对Linux的漏洞利用
- en: 'Linux exploits are not typically targeted toward the operating system itself,
    but rather the services that are running. Here you will find a list of common
    exploits to run against Linux boxes. Keep in mind that exploits will vary across
    distros and service versions:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Linux漏洞通常不是针对操作系统本身，而是针对正在运行的服务。在这里，你会找到一些常见的针对Linux系统的漏洞利用。请记住，漏洞利用会因发行版和服务版本而异：
- en: CVE-2018-1111
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CVE-2018-1111
- en: Red Hat Linux DHCP Client Found Vulnerable to Command Injection Attacks
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现Red Hat Linux DHCP客户端易受命令注入攻击
- en: CVE-2017-7494
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CVE-2017-7494
- en: Exploits for Windows
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Windows的漏洞利用
- en: 'Windows exploits are typically targeted toward listening services of the operating
    system. Here is a list that targets the SMB service that runs on port `445` of
    Windows:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: Windows漏洞利用通常针对操作系统的监听服务。以下是针对运行在Windows端口`445`上的SMB服务的列表：
- en: Eternalblue – MS17-010
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Eternalblue – MS17-010
- en: MS08-67
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MS08-67
- en: MS03-026
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MS03-026
- en: 'The following are some tools often used by pen testers:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些渗透测试人员经常使用的工具：
- en: 'PsExec:'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PsExec：
- en: 'PsExec is a tool included in the Sysinternals toolkit; it is used for remote
    management and is a popular tool among pen testers, system admins, and hackers.
    The PsExec binary is usually copied to the `$admin` share on the machine, then
    it uses remote management to create a service on the remote machine. Keep in mind
    that PsExec requires admin privileges on the remote machine:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: PsExec是Sysinternals工具包中包含的工具；它用于远程管理，是渗透测试人员、系统管理员和黑客中的常用工具。 PsExec二进制文件通常被复制到机器上的`$admin`共享中，然后它使用远程管理在远程机器上创建服务。请记住，PsExec需要远程机器上的管理员权限：
- en: Download Sysinternals
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载Sysinternals
- en: Open the PowerShell prompt
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开PowerShell提示符
- en: Type `cd <Sysinternals directory>`
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`cd <Sysinternals directory>`
- en: Type `.\PSexec \\<IP addr of remote machine> -u <user> -p <password> <cmd>`
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`.\PSexec \\<IP addr of remote machine> -u <user> -p <password> <cmd>`
- en: 'The following screenshot depicts the output obtained:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了获得的输出：
- en: '![](img/dae8e366-79c3-4495-b2e7-d7480040a970.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dae8e366-79c3-4495-b2e7-d7480040a970.png)'
- en: '**Impacket**: A collection of Python classes for working with network protocols.'
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Impacket**：用于处理网络协议的Python类的集合。'
- en: 'The initial setup can be done as follows:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 初始设置如下：
- en: Open the Terminal
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开终端
- en: Type `cd /tmp`
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`cd /tmp`
- en: Type `git clone https://github.com/CoreSecurity/impacket.git`
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`git clone https://github.com/CoreSecurity/impacket.git`
- en: Type ``pip install ``
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入``pip install ``
- en: 'Use the following commands to enable PSexec, WMI, and SMBexec on Impacket:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令在Impacket上启用PSexec、WMI和SMBexec：
- en: '**PSexec**:'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PSexec**：'
- en: '[PRE5]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The output of the preceding command is shown in the following screenshot:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令的输出如下截图所示：
- en: '![](img/c003864d-8685-4e44-958b-99db69f08480.png)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c003864d-8685-4e44-958b-99db69f08480.png)'
- en: '**WMI**:'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**WMI**：'
- en: '[PRE6]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The output of the preceding command is shown in the following screenshot:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令的输出如下截图所示：
- en: '![](img/f2e5b4ed-0d69-47a3-a4b4-89a06785013c.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f2e5b4ed-0d69-47a3-a4b4-89a06785013c.png)'
- en: '**SMBexec**:'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMBexec**：'
- en: '[PRE7]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The output of the preceding command is shown in the following screenshot:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 上述命令的输出如下截图所示：
- en: '![](img/c8fb7f96-8772-48ee-8415-ee87b72b1662.png)'
  id: totrans-205
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c8fb7f96-8772-48ee-8415-ee87b72b1662.png)'
- en: '**PS-Remoting**:'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PS-Remoting**：'
- en: 'To enable PS-Remoting on a target machine, perform the following steps:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 要在目标机器上启用PS-Remoting，请执行以下步骤：
- en: Open PowerShell as administrator on the target machine
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在目标机器上以管理员身份打开PowerShell
- en: Type the following: ``powershell -NoProfile -ExecutionPolicy Bypass -Command
    "iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1'))"``
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下内容：``powershell -NoProfile -ExecutionPolicy Bypass -Command "iex ((new-object
    net.webclient).DownloadString('https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1'))"``
- en: Enable PS-Remoting
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用PS-Remoting
- en: Type `winrm set winrm/config/client/auth '@{Basic="true"}'`
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`winrm set winrm/config/client/auth '@{Basic="true"}'`
- en: Type `winrm set winrm/config/service/auth '@{Basic="true"}'`
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`winrm set winrm/config/service/auth '@{Basic="true"}'`
- en: Type `winrm set winrm/config/service '@{AllowUnencrypted="true"}'`
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`winrm set winrm/config/service '@{AllowUnencrypted="true"}'`
- en: 'To enable PS-Remoting into a target machine, perform the following steps:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 要在目标机器上启用PS-Remoting，请执行以下步骤：
- en: Open PowerShell.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开PowerShell。
- en: Type `$options=New-PSSessionOption -SkipCACheck -SkipCNCheck`
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`$options=New-PSSessionOption -SkipCACheck -SkipCNCheck`
- en: Type `$cred = Get-Credential`. This will prompt you for credentials.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`$cred = Get-Credential`。这将提示您输入凭据。
- en: Type `Enter-PSSession -ComputerName <hostname> -UseSSL -SessionOption $options
    -Credential $cred`.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`Enter-PSSession -ComputerName <hostname> -UseSSL -SessionOption $options
    -Credential $cred`。
- en: 'You will get to see the configuration details, as shown in the following screenshot:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 您将看到配置详细信息，如下截图所示：
- en: '![](img/75e0a572-9ac1-45f7-bfd7-b6f83bfc2ee6.png)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](img/75e0a572-9ac1-45f7-bfd7-b6f83bfc2ee6.png)'
- en: In a similar manner, we will also see how to enable WMI on remote target and
    use WMI to access a remote target
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，我们还将看到如何在远程目标上启用WMI并使用WMI访问远程目标
- en: '**WMI**: Enabling WMI on a remote target can be done by open PowerShell as
    Administrator and run the following command:'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**WMI**：在远程目标上启用WMI可以通过以管理员身份打开PowerShell并运行以下命令来完成：'
- en: '[PRE8]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'To use WMI to access a remote target can be done by open PowerShell, type the
    following command and observe the output as shown in the following screenshot:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用WMI访问远程目标，可以通过打开PowerShell，输入以下命令并观察输出，如下截图所示：
- en: '`wmic /node:<target IP addr> /user:<username> process call create "cmd.exe
    /c <command>"`'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: '`wmic /node:<target IP addr> /user:<username> process call create "cmd.exe
    /c <command>"`'
- en: '![](img/d06895ad-278a-4745-96eb-05fe23feaaa5.png)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d06895ad-278a-4745-96eb-05fe23feaaa5.png)'
- en: Escalating privileges
  id: totrans-227
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提升权限
- en: Once a machine is compromised, any access obtained is usually with low privileges.
    As the idea of any pen test is to simulate a real-world attack, this includes
    looking for sensitive information, which is normally kept on restricted servers;
    the tester would need to find ways to escalate their privileges. In a Windows
    **Active Directory** (**AD**) environment, this would mean getting access to a
    Domain Admin account.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦机器被入侵，通常获得的任何访问都是低权限的。由于任何渗透测试的想法都是模拟真实世界的攻击，这包括寻找通常保存在受限制服务器上的敏感信息；测试人员需要找到提升权限的方法。在Windows
    **Active Directory** (**AD**)环境中，这意味着获得对域管理员帐户的访问。
- en: Maintaining access
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保持访问
- en: Once a foothold is established (that is, remote access), it can be removed very
    quickly, as systems can be rebooted and users can log out. This is where persistent
    access comes in; it can be achieved in a number of ways. The best strategy for
    the maintenance of persistent access is to use multiple techniques simultaneously.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦建立了立足点（即远程访问），就可以很快地删除它，因为系统可以重新启动，用户可以注销。这就是持久访问的地方；可以通过多种方式实现。持久访问的最佳策略是同时使用多种技术。
- en: 'For example, one can plant a physical back door (Dropbox) into the network
    that can later be accessed within their wireless range. A more creative way is
    to set up a scheduled task on the compromised machine to run at boot and to execute
    periodically, for example once a day:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，可以在网络中种植一个物理后门（Dropbox），以后可以在其无线范围内访问。更有创意的方法是在受损的机器上设置一个定时任务，在启动时定期执行，例如每天一次：
- en: '![](img/0ae73856-6260-4e95-8b96-aea0dfb0caf3.png)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0ae73856-6260-4e95-8b96-aea0dfb0caf3.png)'
- en: Covering your tracks
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 掩盖你的踪迹
- en: All engagements should be authorized by the client, no matter what. This is
    not to say that after all of the scanning and exploiting is over one packs up
    and goes home; someone still has to present the findings to the client in a manner
    they can understand. But before this can happen, we must clean up the exploits
    or tools we left in the environment. Sometime this may or may not mean removing
    binaries or editing logs, I say editing because any sysadmin who sees no logs
    should get concerned very fast. As both Windows and Linux have their respective
    log mechanisms and they are very well-documented, there is no need to cover them
    here. I suggest you keep track of what you have changed on the system and be creative
    when you need to hide something; use system services names or usernames that would
    fit in to the accounts, for example, don't name the account `EliteHAK3R`.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 所有的参与都应该得到客户的授权，无论如何。这并不是说在所有的扫描和利用结束后就收拾包袱回家；仍然有人必须以客户能理解的方式向客户呈现发现的结果。但在此之前，我们必须清理环境中留下的漏洞或工具。有时这可能意味着删除二进制文件或编辑日志，我说编辑是因为任何看不到日志的系统管理员都应该非常快速地感到担忧。由于Windows和Linux都有各自的日志机制，并且它们都有很好的文档记录，所以这里不需要涵盖它们。我建议你跟踪你在系统上所做的更改，并在需要隐藏东西时要有创意；使用系统服务名称或用户名来适应账户，例如，不要将账户命名为`EliteHAK3R`。
- en: Reporting
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 报告
- en: This brings us to the final, and some would say most boring, part of the test;
    however, if you followed the previous phases, reporting shouldn't be tedious or
    difficult. I try to make notes as I go along, either on paper or using Dradis,
    a built-in Kali tool, which can be summoned with `service dradis start`. Keep
    in mind that it is a web service, so anyone on the LAN would be able to access
    it using the `https://IP of kali machine:3004` URL – at first run, it will prompt
    you to set a password.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 这将我们带到测试的最后一部分，有些人会说这是最无聊的部分；然而，如果你遵循了前面的阶段，报告不应该是乏味或困难的。我会在进行过程中做笔记，无论是在纸上还是使用Dradis，这是一个内置的Kali工具，可以通过`service
    dradis start`来召唤。请记住它是一个Web服务，所以局域网上的任何人都可以使用`https://kali机器的IP:3004`URL来访问它 -
    在第一次运行时，它会提示您设置密码。
- en: Dradis allows you to import files from Nmap, NESSUS, NEXPOSE, and a few others,
    this makes taking notes when working with teammates hassle-free; you can easily
    share info and keep updated with the most recent results from scans.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: Dradis允许您从Nmap、NESSUS、NEXPOSE等导入文件，这使得与队友一起工作时记笔记变得轻松；您可以轻松共享信息并随时了解最新的扫描结果。
- en: Summary
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter introduced you to  the various methodologies in penetration testing
    for the purpose of planning and scoping the penetration test. The next chapter
    will take you through discovering and gathering information and data about targets
    and environments using both passive and active techniques.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 本章向您介绍了渗透测试中的各种方法，目的是规划和范围渗透测试。下一章将带您了解使用被动和主动技术来发现和收集有关目标和环境的信息和数据。
