- en: Recovering Deleted Data from an Android Device
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从Android设备恢复已删除的数据
- en: In this chapter, we are going to learn about data recovery techniques that enable
    us to view data that has been deleted from a device. Deleted data could contain
    highly sensitive information and thus data recovery is a crucial aspect of mobile
    forensics.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将介绍数据恢复技术，使我们能够查看已从设备中删除的数据。已删除的数据可能包含高度敏感的信息，因此数据恢复是移动取证中的一个关键方面。
- en: 'This chapter will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Data recovery overview
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据恢复概述
- en: Recovering data deleted from an SD card
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从SD卡中恢复已删除的数据
- en: Recovering data from SQLite databases
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从SQLite数据库中恢复数据
- en: Recovering data deleted from a phone's internal storage
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从手机内部存储中恢复删除的数据
- en: Recovering deleted data using file carving
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用文件雕刻恢复已删除的数据
- en: Data recovery overview
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据恢复概述
- en: Data recovery is a powerful concept within digital forensics. It is the process
    of retrieving deleted data from a device or SD card when it cannot be accessed
    normally. Being able to recover data that has been deleted by a user could help
    solve civil or criminal cases. This is because many accused just delete data from
    their device hoping that the evidence will be destroyed. Thus, in most criminal
    cases, deleted data could be crucial because it may contain information the user
    wanted to erase from their Android device. For example, consider the scenario
    where a mobile phone has been seized from a terrorist. Wouldn't it be of the greatest
    importance to know which items were deleted by them? Access to any deleted SMS
    messages, pictures, dialed numbers, and so on could be of critical importance
    as they may reveal a lot of sensitive information.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 数据恢复是数字取证中的一个强大概念。它是从设备或SD卡中检索已删除数据的过程，当这些数据无法正常访问时，恢复数据至关重要。能够恢复用户已删除的数据有助于解决民事或刑事案件。这是因为许多被告只是删除设备上的数据，希望证据被销毁。因此，在大多数刑事案件中，已删除的数据可能至关重要，因为它可能包含用户希望从Android设备中擦除的信息。例如，考虑一下从恐怖分子那里查获的手机。如果知道他们删除了哪些项目，岂不是最为重要吗？获取任何已删除的短信、图片、拨打的号码等信息可能至关重要，因为它们可能揭示大量敏感信息。
- en: From a normal user's point of view, recovering data that has been deleted would
    usually mean referring to the operating system's built-in solutions, such as the
    Recycle Bin in Windows. While it's true that data can be recovered from these
    locations, due to an increase in user awareness, these options often don't work.
    For instance, on a desktop computer, people now use *Shift* + *Del* whenever they
    want to delete a file completely from their desktop. Similarly, in mobile environments,
    users are aware of the restore operations provided by apps and so on. In spite
    of these situations, data recovery techniques allow a forensic investigator to
    access the data that has been deleted from the device.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 从普通用户的角度来看，恢复已删除的数据通常意味着参考操作系统内置的解决方案，比如Windows中的回收站。虽然从这些位置恢复数据是可能的，但由于用户意识的提高，这些选项往往不再有效。例如，现在人们在桌面计算机上使用*Shift*
    + *Del*来完全删除文件。同样，在移动环境中，用户知道应用程序提供的恢复操作等。尽管存在这些情况，数据恢复技术仍然使法医调查员能够访问已从设备中删除的数据。
- en: 'With respect to Android, it is possible to recover most of the deleted data,
    including SMS, pictures, application data, and so on. But it is important to seize
    the device in a proper manner and follow certain procedures, otherwise data might
    be deleted permanently. To ensure that the deleted data is not lost forever, it
    is recommended to keep the following points in mind:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 就Android而言，可以恢复大部分已删除的数据，包括短信、图片、应用程序数据等。但重要的是要以正确的方式查封设备并遵循某些程序，否则数据可能会被永久删除。为确保已删除的数据不丢失，建议牢记以下几点：
- en: Do not use the phone for any activity after seizing it. The deleted text message
    exists on the device until the space is needed by some other incoming data, so
    the phone must not be used for any sort of activity to prevent the data from being
    overwritten.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查封手机后，切勿进行任何操作。已删除的短信仍存在于设备中，直到某些其他数据占用该空间，因此必须避免对手机进行任何操作，以防止数据被覆盖。
- en: Even when the phone is not used, without any intervention from our end, data
    can be overwritten. For instance, an incoming SMS would automatically occupy the
    space, which overwrites the deleted data. Also, remote wipe commands can wipe
    the content present on the device. To prevent such events, you can consider the
    option of placing the device in a Faraday bag, as explained in [Chapter 1](1e7a3a23-96c6-4085-9981-44b579bb2a7f.xhtml), *Introducing
    Android Forensics*. Thus, care should be taken to prevent delivery of any new
    messages or data through any means of communication.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 即使手机没有使用，且没有我们干预，数据仍然有可能被覆盖。例如，接收的短信会自动占用空间，从而覆盖已删除的数据。此外，远程清除命令也可以擦除设备上存在的内容。为了防止这种情况发生，可以考虑将设备放入法拉第袋中，正如[第1章](1e7a3a23-96c6-4085-9981-44b579bb2a7f.xhtml)《介绍Android取证》一文中所解释的那样。这样，应特别小心避免通过任何通讯方式传送新消息或数据。
- en: How can deleted files be recovered?
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何恢复已删除的文件？
- en: When a user deletes any data from a device, the data is not actually erased
    from the device and continues to exist on it. What gets deleted is the pointer
    to that data. All filesystems contain metadata, which maintains information about
    the hierarchy of files, filenames, and so on. Deletion will not really erase the
    data but instead removes the file system metadata. Thus, when text messages or
    any other files are deleted from a device, they are just made invisible to the
    user, but the files are still present on the device as long as they are not overwritten
    by some other data. Hence, there is the possibility of recovering them before
    new data is added and occupies the space. Deleting the pointer and marking the
    space as available is an extremely fast operation compared to actually erasing
    all the data from the device. Hence, to increase performance, operating systems
    just delete the metadata.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户从设备中删除任何数据时，数据并不会被实际擦除，而是继续存在于设备上。被删除的是指向该数据的指针。所有文件系统都包含元数据，它保存有关文件层次结构、文件名等的信息。删除操作并不会真正擦除数据，而是移除文件系统的元数据。因此，当文本消息或其他文件从设备中删除时，它们只是对用户不可见，但文件仍然存在于设备上，只要没有被其他数据覆盖。因此，在新数据添加并占用空间之前，仍有恢复它们的可能。删除指针并标记空间为可用的操作与实际擦除设备上的所有数据相比是一个极其快速的操作。因此，为了提高性能，操作系统仅删除元数据。
- en: 'Recovering deleted data on an Android device involves three scenarios:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 恢复Android设备上已删除数据涉及三种情况：
- en: Recovering data that is deleted from the SD card such as pictures, videos, and
    so on
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复从SD卡删除的数据，如照片、视频等
- en: Recovering data that is deleted from SQLite databases such as SMS, chats, web
    history, and so on
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复已删除的SQLite数据库数据，如短信、聊天记录、网页历史等。
- en: Recovering data that is deleted from the device's internal storage
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 恢复已删除的设备内部存储数据
- en: The following sections cover the techniques that can be used to recover deleted
    data from SD cards, SQLite databases and the internal storage of the Android device.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 以下章节将介绍可以用于从SD卡、SQLite数据库和Android设备内部存储中恢复已删除数据的技术。
- en: Recovering deleted data from SD cards
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从SD卡恢复已删除的数据
- en: 'Data present on an SD card can reveal lots of information that is useful during
    a forensic investigation. The fact that pictures, videos, voice recordings, and
    application data are stored on the SD card adds weight to this. As mentioned in
    the previous chapters, Android devices often use FAT32 or exFAT file systems on
    their SD card. The main reason for this is that these file systems are widely
    supported by most operating systems, including Windows, Linux, and macOS X. The
    maximum file size on a FAT32 formatted drive is around 4 GB. With increasingly
    high resolution formats now available, this limit is commonly reached, that''s
    why newer devices support exFAT: this file system doesn''t have such limitations.
    Recovering the data deleted from an external SD is pretty easy if it can be mounted
    as a drive.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 存储在SD卡上的数据能够揭示许多在法医调查中有用的信息。事实上，照片、视频、语音录音和应用数据都存储在SD卡上，这进一步证明了这一点。如前几章所述，Android设备通常在其SD卡上使用FAT32或exFAT文件系统。这样做的主要原因是这些文件系统被包括Windows、Linux和macOS
    X在内的大多数操作系统广泛支持。FAT32格式化驱动器上的最大文件大小约为4GB。随着现在越来越高的分辨率格式的出现，这一限制常常被突破，这就是为什么较新的设备支持exFAT：这种文件系统没有这样的限制。如果外部SD卡可以作为驱动器挂载，恢复已删除的数据相对容易。
- en: If the SD card is removable, it can be mounted as a drive by connecting it to
    a computer using a card reader. Any files can be transferred to the SD card while
    it's mounted. Some of the older devices that use USB mass storage also mount the
    device to a drive when connected through a USB cable. As explained earlier, in
    forensics, in order to make sure that the original evidence is not modified, a
    physical image of the disk is taken and all further experimentation is done on
    the image itself. Similarly, in the case of SD card analysis, an image of the
    SD card needs to be taken. The process of imaging is similar to the one explained
    in [Chapter 5](a910938e-1c0b-4f19-baae-509ccaa36c09.xhtml), *Extracting Data Physically
    from Android Devices*. Once the imaging is done, we have a raw image file. In
    our example, we will use FTK Imager by AccessData, which is an imaging utility.
    In addition to creating disk images, it can also be used to explore the contents
    of a disk image.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如果SD卡是可移动的，可以通过使用卡读器将其连接到计算机，从而将其作为驱动器挂载。在挂载时，可以向SD卡转移任何文件。某些使用USB大容量存储的旧设备也会在通过USB电缆连接时将设备挂载为驱动器。如前所述，在取证中，为确保原始证据不被修改，通常会对磁盘进行物理镜像，所有后续实验也都在镜像文件上进行。类似地，在SD卡分析中，也需要制作SD卡的镜像。镜像过程与[第5章](a910938e-1c0b-4f19-baae-509ccaa36c09.xhtml)中解释的*从Android设备中物理提取数据*相似。一旦镜像完成，我们将得到一个原始镜像文件。在我们的示例中，我们将使用AccessData的FTK
    Imager，这是一个镜像工具。除了创建磁盘镜像外，它还可以用来探索磁盘镜像的内容。
- en: 'The following are the steps that can be followed to recover the contents of
    an SD card using this tool:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是使用此工具恢复SD卡内容的步骤：
- en: 'Start FTK Imager and click on File and then Add Evidence Item... in the menu,
    as shown in the following screenshot:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动FTK Imager，点击菜单中的“文件”，然后选择“添加证据项...”，如以下截图所示：
- en: '![](img/dca4bc08-abf6-48a0-88a8-f0293272224e.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dca4bc08-abf6-48a0-88a8-f0293272224e.png)'
- en: Adding evidence source to FTK Imager
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 向FTK Imager添加证据来源
- en: Select Image File in the Select Source dialog and click on Next.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“选择源”对话框中选择“映像文件”，然后点击“下一步”。
- en: 'In the Select File dialog, browse to the location where you downloaded the
    `sdcard.dd` file, select it, and click on Finish, as shown in the following screenshot:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“选择文件”对话框中，浏览到下载`sdcard.dd`文件的位置，选择它，然后点击“完成”，如下面的截图所示：
- en: '![](img/1e797092-a99a-4a5d-9bca-c4ae82616e04.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1e797092-a99a-4a5d-9bca-c4ae82616e04.png)'
- en: Selecting the image file for analysis in FTK Imager
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在FTK Imager中选择用于分析的图像文件
- en: FTK Imager's default display will appear with the contents of the SD card visible
    in the View pane at the lower right. You can also click on the Properties tab
    below the lower left pane to view the properties for the disk image.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: FTK Imager的默认显示将展示SD卡内容，显示在右下角的查看窗格中。你还可以点击左下角的属性标签查看磁盘镜像的属性。
- en: Now, on the left pane, the drive has opened. You can open folders by clicking
    on the + sign. When highlighting the folder, contents are shown on the right pane.
    When a file is selected, its contents can be seen on the bottom pane.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在左侧窗格中，驱动器已打开。可以通过点击加号打开文件夹。当选中一个文件夹时，右侧窗格会显示其内容。选择一个文件后，其内容会显示在底部窗格。
- en: 'As shown in the following screenshot, the deleted files will have a red `X`
    over the icon derived from their file extension:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如下图所示，被删除的文件会在其文件扩展名图标上方显示一个红色的`X`：
- en: '![](img/8efa01be-4903-4b30-8e8d-f4a885aa7a75.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8efa01be-4903-4b30-8e8d-f4a885aa7a75.png)'
- en: Deleted files shown with red X over the icons
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 被删除的文件在图标上显示红色X
- en: 'As shown in the following screenshot, to export the file, right-click on the
    file that contains the picture and select Export Files...:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如下图所示，要导出文件，请右键点击包含图片的文件，然后选择“导出文件...”：
- en: '![](img/ea8ee09c-5c79-4b94-9443-74439cc697fe.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ea8ee09c-5c79-4b94-9443-74439cc697fe.png)'
- en: Sometimes, only a fragment of the file is recoverable, which cannot be read
    or viewed directly. In that case, we need to look through free or unallocated
    space for more data. Carving can be used to recover files from free and unallocated
    space. PhotoRec is one of the tools that can help you to do that. You will learn
    more about file carving with PhotoRec in the following sections.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，只能恢复文件的一部分，这部分无法直接读取或查看。在这种情况下，我们需要查看空闲或未分配空间中的更多数据。文件雕刻技术可以用来从空闲和未分配的空间中恢复文件。PhotoRec是可以帮助你完成此操作的工具之一。接下来的部分你将学习如何使用PhotoRec进行文件雕刻。
- en: Recovering deleted records from SQLite databases
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从SQLite数据库恢复已删除的记录
- en: 'Most of the application data in Android is stored in SQLite databases. Data
    related to text messages, emails, and most app data is stored in SQLite databases.
    Such databases can store deleted data within the database itself. Records marked
    for deletion by the user no longer appear in the active SQLite database files.
    Therefore, it is possible to recover the deleted data, such as text messages,
    contacts, and more, by analyzing these SQLite files. There are two areas within
    an SQLite page that can contain deleted data: unallocated blocks and free blocks.
    Most of the commercial forensic tools that recover deleted data scan the unallocated
    blocks and free blocks of the SQLite pages. Parsing the deleted data can be done
    using, for example, Belkasoft Evidence Center. The trial version of this commercial
    forensic tool can be downloaded here: [https://belkasoft.com/get](https://belkasoft.com/get).'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 安卓中大部分的应用数据都存储在SQLite数据库中。与短信、电子邮件以及大多数应用数据相关的数据都存储在SQLite数据库中。这些数据库可以在数据库内部存储已删除的数据。用户标记为删除的记录不再出现在活动的SQLite数据库文件中。因此，通过分析这些SQLite文件，可以恢复已删除的数据，例如短信、联系人等。SQLite页面中有两个区域可以包含已删除的数据：未分配块和空闲块。大多数商业取证工具通过扫描SQLite页面的未分配块和空闲块来恢复已删除的数据。解析已删除的数据可以使用例如Belkasoft
    Evidence Center等工具进行。该商业取证工具的试用版可以在这里下载：[https://belkasoft.com/get](https://belkasoft.com/get)。
- en: For our example, we will recover deleted SMS messages from an Android device.
    Recovering deleted SMS messages from an Android phone is quite often requested
    as part of forensic analysis on a device, mainly because it's the most popular
    form of communication. There are different ways to recover deleted text messages
    on an Android device. But, with respect to recovery through parsing SQLite files,
    we need to understand where the messages are being stored on the device. In [Chapter
    4](b5ab11df-1911-4deb-accd-f92c74650e6d.xhtml), *Extracting Data Logically from
    Android Devices*, we explained the important locations on the Android device where
    user data is stored.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的例子中，我们将从安卓设备中恢复已删除的短信。恢复已删除的短信是设备取证分析中常见的请求，主要因为它是最流行的通信方式。有不同的方法可以恢复安卓设备上的已删除短信。但是，就解析SQLite文件来进行恢复而言，我们需要了解短信存储在设备上的位置。在[第4章](b5ab11df-1911-4deb-accd-f92c74650e6d.xhtml)，*从安卓设备中逻辑地提取数据*，我们解释了安卓设备上存储用户数据的重要位置。
- en: Let's examine `bugle_db`, an SQLite database that contains SMS messages sent
    or received using the Android Messages application. This database is located under
    `/data/data/com.android.messaging/databases`. If you have a physical image of
    the device, you can extract the database using FTK Imager, just like you did with
    deleted files. If you want to extract it from the device itself, you can use the `adb
    pull` command, for example (the device must be rooted).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来查看`bugle_db`，这是一个包含通过Android消息应用程序发送或接收的短信的SQLite数据库。该数据库位于`/data/data/com.android.messaging/databases`目录下。如果你有设备的物理镜像，你可以使用FTK
    Imager提取数据库，就像提取已删除的文件一样。如果你想直接从设备中提取，可以使用`adb pull`命令（设备必须已经root）。
- en: The easiest way to find deleted records is to use commercial mobile forensic
    tools, such as Belkasoft Evidence Center, Cellebrite UFED Physical Analyzer, Oxygen
    Forensic Detective, and so on, but there are also some open source tools capable
    of recovering data from unallocated space and free lists. One such tool is the
    SQLite Deleted Records Parser by Mari DeGrazia. You can download this tool at
    her GitHub: [https://github.com/mdegrazia/SQLite-Deleted-Records-Parser](https://github.com/mdegrazia/SQLite-Deleted-Records-Parser).
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 找到已删除记录的最简单方法是使用商业移动取证工具，如Belkasoft Evidence Center、Cellebrite UFED Physical
    Analyzer、Oxygen Forensic Detective等，但也有一些开源工具能够从未分配空间和空闲列表中恢复数据。一个这样的工具是由Mari
    DeGrazia开发的SQLite Deleted Records Parser。你可以在她的GitHub上下载这个工具：[https://github.com/mdegrazia/SQLite-Deleted-Records-Parser](https://github.com/mdegrazia/SQLite-Deleted-Records-Parser)。
- en: 'There are three variants of the tool: a Python script, command-line version,
    and GUI version. For demonstration purposes, we will use the GUI version, as shown
    in the following example:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具有三种版本：Python脚本、命令行版本和GUI版本。为了演示，我们将使用GUI版本，如下所示的例子所示：
- en: '![](img/1064fc1a-b494-4dd8-9bd6-28193b3b9dc8.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1064fc1a-b494-4dd8-9bd6-28193b3b9dc8.png)'
- en: Using the tool is extremely easy, all you need is to choose the source database
    and the destination file, and click Process. As a result, you'll get a TSV file
    (if you've chosen Formatted Output) with recovered records, including their source
    (unallocated space or free block), offset, and length.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 使用该工具非常简单，您只需要选择源数据库和目标文件，然后点击处理。结果将得到一个TSV文件（如果选择了格式化输出），其中包含恢复的记录，包括其来源（未分配空间或空闲块）、偏移量和长度。
- en: SD card security
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SD卡安全
- en: In older versions of Android, simply plugging a phone into a computer would
    logically mount the SD card and allow an examiner access to its data. In one of
    the versions of Android (possibly 3.0), this changed, although the exact version
    could not be found in the various change logs we examined. Newer versions of Android
    will not automatically allow access to the SD card from a computer if a screen
    lock is in use, meaning that the screen lock will have to be bypassed in order
    to gain access to the SD card. The obvious exception to this is that a physical,
    external SD card can still be removed and analyzed with traditional computer forensic
    methods.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在旧版安卓系统中，简单地将手机插入计算机，通常会自动挂载SD卡并允许检查员访问其数据。在某个版本的安卓系统（可能是3.0版）中，这一行为发生了变化，尽管我们在多个变更日志中没有找到具体版本的描述。新版本的安卓系统如果启用了屏幕锁定，将不会自动允许从计算机访问SD卡，这意味着需要绕过屏幕锁定才能访问SD卡。唯一的例外是，物理外部SD卡仍然可以被取出，并使用传统的计算机取证方法进行分析。
- en: SD cards can also be encrypted, either through the device's full-disk encryption
    if it is an internal SD card, or through third-party applications if it is an
    external SD card. In some cases, activating the full-disk encryption will leave
    the SD card unencrypted, though this varies by device manufacturer.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: SD卡也可以被加密，如果是内置SD卡，则通过设备的全盘加密进行加密；如果是外部SD卡，则通过第三方应用程序进行加密。在某些情况下，启用全盘加密会使SD卡保持未加密状态，尽管这取决于设备制造商。
- en: The full-disk encryption introduced in Android Lollipop also encrypts the SD
    card.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在安卓Lollipop系统中引入的全盘加密也对SD卡进行了加密。
- en: Advanced forensic methods
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高级取证方法
- en: In addition to the methods discussed in the previous chapters, there are also
    more advanced, specialized methods available. The JTAG and chip-off methods are
    both highly useful tools in many common situations, but require advanced training
    (and a lot of practice before working on live evidence!). The final advanced method,
    a cold boot attack to recover encryption keys, is far more theoretical.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 除了前几章中讨论的方法，还有一些更先进的、专业化的方法可供使用。JTAG和芯片拆卸方法在许多常见情况下是非常有用的工具，但它们需要高级培训（并且在处理实际证据之前需要大量的实践！）。最后一种高级方法——冷启动攻击以恢复加密密钥，更加理论化。
- en: JTAG
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: JTAG
- en: JTAG, the **Joint Test Action Group** (**JTAG**) is a standard that was developed
    by the **Institute of Electrical and Electronics Engineers** (**IEEE**). During
    the device production process, it is used to communicate with the processor through
    a specialized interface for testing purposes. Luckily for forensic examiners,
    it also allows them to communicate directly with the processor and retrieve a
    full physical image of the flash memory.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: JTAG，**联合测试行动小组**（**JTAG**）是由**电气和电子工程师协会**（**IEEE**）制定的标准。在设备生产过程中，JTAG用于通过专用接口与处理器进行通信，进行测试。幸运的是，对于取证检查员来说，它还允许他们直接与处理器通信，并获取闪存的完整物理映像。
- en: To perform a JTAG extraction, the device must be taken apart, down to the circuit
    board. The circuit board will contain multiple taps (physical contacts on the
    device circuit board), though they are commonly unlabeled and there are usually
    far more taps than required for JTAG. To determine the correct taps, an examiner
    would have to either find a pin-out online (or included with their tool of choice),
    or use electronic test equipment to determine what each tap is.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行JTAG提取，设备必须拆开，直到电路板。电路板上将包含多个接点（设备电路板上的物理接触点），虽然它们通常没有标签，且接点数量通常远多于JTAG所需的数量。为了确定正确的接点，检查员必须查找引脚图（可以在网上找到，或随所选工具提供），或使用电子测试设备确定每个接点的功能。
- en: 'The examiner will then have to solder a wire to each tap, or use adapters (sometimes
    called jigs) that are commercially available, and connect to their JTAG box through
    a provided adapter:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 检查员接下来需要将一根线焊接到每个接点上，或者使用商业上可用的适配器（有时称为夹具），并通过提供的适配器将其连接到JTAG盒子：
- en: '![](img/cbe26e2a-79ef-4f73-ba41-b3fe5090160e.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cbe26e2a-79ef-4f73-ba41-b3fe5090160e.png)'
- en: HTC Evo before and after being hooked up for JTAG (courtesy of http://lowcostwin4n6.blogspot.com/)
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: HTC Evo 在连接 JTAG 前后的情况（感谢 http://lowcostwin4n6.blogspot.com/）
- en: 'JTAG may sound complicated (because it is), but it serves many useful purposes:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: JTAG 听起来可能很复杂（因为它确实很复杂），但它有许多有用的用途：
- en: 'It does not require the device to be powered on:'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它不需要设备开机：
- en: Can be successful even if the device is damaged
  id: totrans-62
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 即使设备损坏，也可能成功
- en: No RF-shielding concerns
  id: totrans-63
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无射频屏蔽问题
- en: 'It does not require root, ADB, or USB debugging:'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它不需要 root、ADB 或 USB 调试：
- en: Can be used to bypass device PINs/passwords
  id: totrans-65
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可用于绕过设备的 PIN 码/密码
- en: Can image the entire flash memory
  id: totrans-66
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以映像整个闪存
- en: Many manufacturers make JTAG tools, and many of the most common ones that are
    used for mobile forensics can be found at [http://teeltech.com/mobile-device-forensic-software/teel-tech-jtag-box-sets/](http://teeltech.com/mobile-device-forensic-software/teel-tech-jtag-box-sets/).
    The RIFF box listed on this site is probably the most frequently used for mobile
    forensics, as it comes with support (including pin-outs) for a wide variety of
    devices.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 许多制造商生产 JTAG 工具，许多用于移动取证的常见工具可以在 [http://teeltech.com/mobile-device-forensic-software/teel-tech-jtag-box-sets/](http://teeltech.com/mobile-device-forensic-software/teel-tech-jtag-box-sets/)
    找到。该网站上列出的 RIFF box 可能是最常用于移动取证的工具，因为它支持（包括针脚排布）多种设备。
- en: JTAG is not always successful, or even possible. Though the interface is almost
    always on the circuit board, the manufacturer can choose to disable it after the
    device has been manufactured.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: JTAG 并不总是成功，甚至有时无法实现。尽管接口几乎总是在电路板上，制造商可以选择在设备制造后禁用它。
- en: Chip-off
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 拆芯片
- en: 'Chip-off involves heating the device''s circuit board until the solder holding
    the components to the board melts, and then removing the flash memory chip. The
    memory chip can then be read using commercial tools, resulting in a full physical
    image. Chip-off techniques, like JTAG, stem from the commercial electronic production
    process. The process of melting the solder (commonly called reflow or rework)
    is used to place and remove components from a circuit board, and the readers used
    to acquire the memory are used to both read and write to memory chips, often in
    bulk quantities:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 拆芯片涉及加热设备的电路板，直到固定组件的焊接点融化，然后拆除闪存芯片。随后，可以使用商业工具读取内存芯片，从而获得完整的物理映像。拆芯片技术，像 JTAG
    一样，源自商业电子生产过程。熔化焊料的过程（通常称为回流或返工）用于将组件放置到电路板上或从电路板上移除，读取内存所使用的设备用于读取和写入内存芯片，通常以批量形式进行操作：
- en: '![](img/cbc2282e-7426-4a35-838c-583bf8d2b31c.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cbc2282e-7426-4a35-838c-583bf8d2b31c.png)'
- en: A memory chip being removed from a damaged phone (courtesy of www.binaryintel.com)
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 从损坏的手机中取出的内存芯片（感谢 www.binaryintel.com）
- en: 'Chip-off has the same benefits as JTAG: it does not require the device to be
    powered on, and can be used to bypass the PIN/password on a locked device. Chip-off
    is normally considered to be a destructive process. While the memory chip can
    be replaced on the device, it is a technically demanding process and requires
    further training. But, as a last resort, chip-off is an excellent alternative
    for devices that would otherwise be impossible to examine.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 拆芯片具有与 JTAG 相同的优点：它不需要设备开机，并且可以用来绕过锁定设备的 PIN 码/密码。拆芯片通常被视为一种破坏性过程。虽然内存芯片可以被替换，但这是一个技术要求较高的过程，需要进一步的培训。但是，作为最后的手段，拆芯片是对于那些否则无法检查的设备来说是一个极好的替代方案。
- en: 'Chip-off is significantly more expensive than JTAG, as a specialized rework
    station and commercial memory reader is required. There are dozens of rework stations
    available, and they all provide essentially the same functionality. There is also
    a wide range of memory readers, though we have had great success with this reasonably
    priced model: [http://www.dataman.com/programmers/universal/dataman-48pro2-super-fast-universal-isp-programmer.html](http://www.dataman.com/programmers/universal/dataman-48pro2-super-fast-universal-isp-programmer.html).
    A rework station and reader aren''t the only costs associated with chip-off; most
    readers will also require a specific adapter for each model of chip to be read.'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 拆芯片比 JTAG 显著更昂贵，因为需要专用的返工站和商业内存读卡器。有数十种返工站可供选择，它们提供的功能基本相同。也有多种内存读卡器，尽管我们在使用这个价格合理的型号时取得了很大成功：[http://www.dataman.com/programmers/universal/dataman-48pro2-super-fast-universal-isp-programmer.html](http://www.dataman.com/programmers/universal/dataman-48pro2-super-fast-universal-isp-programmer.html)。返工站和读卡器并不是拆芯片唯一的成本；大多数读卡器还需要为每个要读取的芯片型号配备特定的适配器。
- en: Summary
  id: totrans-75
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: 'In this chapter, we discussed several techniques that are used for physically
    imaging internal memory or SD cards, and some of the common problems associated
    with them:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中，我们讨论了几种用于物理成像内部存储或SD卡的技术，以及它们相关的一些常见问题：
- en: '| **Technique** | **Problems associated** |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| **技术** | **相关问题** |'
- en: '| `dd` |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| `dd` |'
- en: Usually preinstalled on device
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通常预安装在设备上
- en: May not work on MTD blocks
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可能无法在MTD块上使用
- en: Does not obtain the out-of-band area
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无法获取带外区域
- en: '|'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| `nanddump` |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| `nanddump` |'
- en: Not commonly found on the device, must be pushed to device
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设备上通常没有此功能，必须将其推送到设备上
- en: Works well with MTD blocks
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与MTD块配合良好
- en: May obtain the out-of-band area, based on options in the binary used
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以基于使用的二进制文件中的选项获取带外区域
- en: '|'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Additionally, each imaging technique can be used to either save the image on
    the device (typically on the SD card), or used with `netcat` to write the file
    to the examiner''s computer:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，每种成像技术可以用于将图像保存到设备上（通常是SD卡），或使用`netcat`将文件写入检查员的计算机：
- en: '| **Technique** | **Features** |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| **技术** | **特性** |'
- en: '| Writing to SD card |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| 写入SD卡 |'
- en: Easy, doesn't require additional binaries to be pushed to the device
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 简单，不需要将额外的二进制文件推送到设备上
- en: Familiar to most examiners
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对大多数检查员来说很熟悉
- en: Cannot be used if SD card is symbolically linked to the partition being imaged
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果SD卡与正在成像的分区存在符号链接，则无法使用
- en: Cannot be used if the entire memory is being imaged
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果正在成像整个内存，则无法使用
- en: '|'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| Using `netcat` |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| 使用`netcat` |'
- en: Usually requires yet another binary to be pushed to the device on older devices
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通常需要将另一个二进制文件推送到旧设备上
- en: Somewhat complicated, must follow steps exactly
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 稍显复杂，必须严格按照步骤操作
- en: Works no matter what is being imaged
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无论成像的是什么，都能正常工作
- en: May be more time-consuming than writing to the SD
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可能比写入SD卡更费时
- en: '|'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'Some tools that can be used for RAM imaging were also introduced:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 还介绍了一些可以用于RAM成像的工具：
- en: '| **Tool** | **Features** |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| **工具** | **特性** |'
- en: '| LiME |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| LiME |'
- en: Must be compiled for each device being examined
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 必须为每个被检查的设备编译
- en: Very complicated process
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 非常复杂的过程
- en: Known, well-documented procedures for analysis
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 具有已知且良好文档化的分析程序
- en: Output is a dump of all RAM
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出是所有RAM的转储
- en: '|'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: Finally, we briefly discussed chip-off and JTAG techniques at an introductory
    level.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们简要讨论了芯片拆卸和JTAG技术的入门级内容。
- en: In the next chapter, we will demonstrate the recovery of deleted data from physical
    images, like the ones created in this chapter.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将演示如何从物理镜像（如本章创建的镜像）中恢复已删除的数据。
- en: Recovering deleted data from internal memory
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 恢复内部存储已删除的数据
- en: Recovering files deleted from Android's internal memory, such as app data and
    so on, is not as easy as recovering such data from SD cards and SQLite databases,
    but, of course, it's not impossible. Many commercial forensic tools are capable
    of recovering deleted data from Android devices, of course, if physical acquisition
    is possible and the userdata partition isn't encrypted.  But this is not very
    common for modern devices, especially those running most recent versions of the
    operating system, such as Oreo and Pie.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 从Android的内部存储中恢复已删除的文件，如应用数据等，并不像从SD卡和SQLite数据库中恢复这些数据那样简单，但当然并非不可能。许多商业取证工具能够从Android设备中恢复已删除的数据，当然，前提是物理获取是可能的，并且userdata分区没有加密。但对于现代设备，尤其是运行最新操作系统版本（如Oreo和Pie）的设备，这并不常见。
- en: Most Android devices, especially modern smartphones and tablets, use the EXT4
    file system to organize data in their internal storage. This file system is very
    common for Linux-based devices. So, if we want to recover deleted data from the
    device's internal storage, we need a tool capable of recovering deleted files
    from the EXT4 file system. One such tool is extundelete. The tool is available
    for downloading here: [http://extundelete.sourceforge.net/](http://extundelete.sourceforge.net/).
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数安卓设备，尤其是现代智能手机和平板电脑，使用EXT4文件系统来组织其内部存储中的数据。该文件系统在基于Linux的设备中非常常见。因此，如果我们想从设备的内部存储中恢复已删除的数据，我们需要一款能够从EXT4文件系统中恢复已删除文件的工具。一个这样的工具是 extundelete。该工具可以在此下载：[http://extundelete.sourceforge.net/](http://extundelete.sourceforge.net/)。
- en: To recover the contents of an inode, extundelete searches a file system's journal
    for an old copy of that inode. Information contained in the inode helps the tool
    to locate the file within the file system. To recover not only the file's contents,
    but also its name, extundelete is able to search the deleted entries in a directory to
    match the inode number of a file to a file name.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 为了恢复一个inode的内容，extundelete会在文件系统的日志中查找该inode的旧副本。inode中包含的信息帮助工具定位文件在文件系统中的位置。为了恢复文件的内容及其名称，extundelete可以在目录中查找已删除的条目，将文件的inode编号与文件名匹配。
- en: 'To use this tool, you will need a Linux workstation. Most forensic Linux distributions
    have it already on board. For example, the following is a screenshot from **SIFT
    Workstation**—a popular digital forensics and incident response Linux distribution
    created by Rob Lee and his team from the SANS Institute ([https://digital-forensics.sans.org/community/downloads](https://digital-forensics.sans.org/community/downloads)):'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用这个工具，你需要一台Linux工作站。大多数法医Linux发行版已经自带该工具。例如，下面是来自**SIFT Workstation**的截图——这是一个由Rob
    Lee和他的SANS学院团队创建的流行数字取证和事件响应Linux发行版（[https://digital-forensics.sans.org/community/downloads](https://digital-forensics.sans.org/community/downloads)）：
- en: '![](img/4e0c1a39-e836-44f9-b5ff-84ae13cdb19b.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4e0c1a39-e836-44f9-b5ff-84ae13cdb19b.png)'
- en: extundelete command-line options
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: extundelete命令行选项
- en: Before you can start the recovery process, you will need to mount a previously
    imaged userdata partition. In this example, we are going to use an Android device
    imaged via the chip-off technique—you've already learned about this technique
    in [Chapter 5](a910938e-1c0b-4f19-baae-509ccaa36c09.xhtml),* Extracting Data Physically
    from Android Devices.*
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始恢复过程之前，你需要挂载一个之前已镜像的userdata分区。在这个示例中，我们将使用通过芯片脱离技术镜像的Android设备——你已经在[第5章](a910938e-1c0b-4f19-baae-509ccaa36c09.xhtml)中了解过这种技术，*物理提取Android设备数据*。
- en: 'First of all, we need to determine the location of the userdata partition within
    the image. To do this, we can use `mmls` from the **Sleuth Kit**, as shown in
    the following screenshot:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要确定userdata分区在镜像中的位置。为此，我们可以使用来自**Sleuth Kit**的`mmls`，如下所示的截图：
- en: '![](img/b9ce9116-91d1-499d-872e-dfe3158901fd.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b9ce9116-91d1-499d-872e-dfe3158901fd.png)'
- en: Android device partitions
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: Android设备分区
- en: 'As you can see in the screenshot, the userdata partition is the last one and
    starts in sector `9199616`. To make sure the userdata partition is EXT4 formatted,
    let''s use `fsstat`, as shown in the following example:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如截图所示，userdata分区是最后一个，起始扇区为`9199616`。为了确保userdata分区是EXT4格式的，我们可以使用`fsstat`，如下所示的示例：
- en: '![](img/17ad8b59-c03e-4c89-b535-8ea680fbada8.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](img/17ad8b59-c03e-4c89-b535-8ea680fbada8.png)'
- en: A part of fsstat output
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: fsstat 输出的部分内容
- en: 'All you need now is to mount the userdata partition and run extundelete against
    it, as shown in the following example:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你需要做的是挂载userdata分区并运行extundelete，如下所示的示例：
- en: '[PRE0]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: All recovered files will be saved to a subdirectory of the current directory
    named `RECOVERED_FILES`. If you are interested in recovering files before or after the specified
    date, you can use the `--before date` and `--after-date` options. It's important
    to note that these dates must be in UNIX Epoch format. There are quite a lot of
    both online and offline tools capable of converting timestamps, for example, you
    can use [https://www.epochconverter.com/](https://www.epochconverter.com/).
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 所有恢复的文件将被保存在当前目录的子目录`RECOVERED_FILES`中。如果你有兴趣恢复指定日期之前或之后的文件，可以使用`--before date`和`--after-date`选项。请注意，这些日期必须采用UNIX纪元格式。有很多在线和离线工具可以转换时间戳，例如，你可以使用[https://www.epochconverter.com/](https://www.epochconverter.com/)。
- en: 'As you can see, this method isn''t very easy and fast, but there is a better
    way: using Autopsy, an open source digital forensic tool already introduced in
    [Chapter 3](615ae74c-4301-46e6-92f2-387637bebd38.xhtml), *Understanding Data Storage
    on Android Devices. *'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，这种方法不太简单且速度较慢，但有一种更好的方法：使用Autopsy，这是一款开源数字取证工具，已在[第3章](615ae74c-4301-46e6-92f2-387637bebd38.xhtml)中介绍过，*理解Android设备上的数据存储*。
- en: 'In the following example, we used a built-in file extension filter to find
    all the images on the Android device, and found a lot of deleted artifacts:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的示例中，我们使用了内置的文件扩展名过滤器，找到了Android设备上的所有图片，并发现了大量已删除的文件：
- en: '![](img/d6b824c9-c88d-43a9-a3fa-2419e81f6628.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d6b824c9-c88d-43a9-a3fa-2419e81f6628.png)'
- en: Recovering deleted files from an EXT4 partition with Autopsy
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Autopsy从EXT4分区恢复已删除的文件
- en: It's not always possible to recover deleted files using the file system journal;
    this is where file carving comes in.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 使用文件系统日志恢复已删除的文件并不总是可能的，这正是文件雕刻派上用场的地方。
- en: Recovering deleted data using file carving
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用文件雕刻恢复已删除的数据
- en: File carving is an extremely useful method in forensics because it allows for
    data that has been deleted or hidden to be recovered for analysis. In simple terms,
    file carving is the process of reassembling files from fragments in the absence
    of file system metadata. In file carving, specified file types are searched for
    and extracted across the binary data to create a forensic image of a partition
    or an entire disk. File carving recovers files from the unallocated space in a
    drive based merely on file structure and content, without any matching file system
    metadata.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 文件雕刻是取证中一种非常有用的方法，因为它可以恢复已删除或隐藏的数据进行分析。简而言之，文件雕刻是从没有文件系统元数据的碎片中重新组装文件的过程。在文件雕刻中，会在二进制数据中搜索并提取指定的文件类型，从而创建分区或整个磁盘的取证镜像。文件雕刻仅基于文件结构和内容，从驱动器的未分配空间中恢复文件，而不依赖任何匹配的文件系统元数据。
- en: Unallocated space refers to the part of the drive that no longer holds any file
    information, as pointed by file system structures such as file tables.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 未分配空间是指驱动器中不再包含任何文件信息的部分，这些信息由文件系统结构如文件表指示。
- en: Files can be recovered or reconstructed by scanning the raw bytes of the disk
    and reassembling them. This can be done by examining the header (the first few
    bytes) and footer (the last few bytes) of a file.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 通过扫描磁盘的原始字节并重新组装它们，可以恢复或重建文件。这可以通过检查文件的头部（前几个字节）和尾部（最后几个字节）来完成。
- en: File-carving methods are categorized based on the underlying technique in use.
    The **header-footer carving method** relies on recovering the files based on the
    header and footer information. For instance, the JPEG files start with `0xffd8`
    and end with `0xffd9`. The locations of the header and footer are identified and
    everything between those two endpoints is carved. Similarly, the **file structure
    carving method** is based on the internal layout of a file to reconstruct the
    file. But the traditional file carving techniques, such as the ones we've already
    explained, may not work if the data is fragmented. To overcome this, new techniques
    such as **smart carving** use the fragmentation characteristics of several popular
    file systems to recover the data.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 文件雕刻方法是根据所使用的底层技术进行分类的。**头尾雕刻方法**依赖于根据文件的头部和尾部信息恢复文件。例如，JPEG 文件以 `0xffd8` 开头，以
    `0xffd9` 结尾。头部和尾部的位置被识别出来，介于这两个端点之间的内容会被雕刻出来。类似地，**文件结构雕刻方法**基于文件的内部布局来重建文件。但传统的文件雕刻技术，如我们已经解释过的那些，如果数据是碎片化的，可能无法奏效。为了克服这一问题，新的技术，如
    **智能雕刻**，利用多种流行文件系统的碎片特征来恢复数据。
- en: 'Once the phone is imaged, it can be analyzed using tools such as PhotoRec.
    PhotoRec is a powerful free utility to carve files. This tool analyzes the block
    database storage, identifies the deleted files, and recovers them. Scalpel is
    file system-independent and is known to work on various file systems including
    EXT4, exFAT, FAT32, and more. The following steps explain how to recover files
    using PhotoRec on a Windows workstation:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦手机映像完成，就可以使用如 PhotoRec 等工具进行分析。PhotoRec 是一个强大的免费工具，可以雕刻文件。该工具分析块数据库存储，识别已删除的文件并恢复它们。Scalpel
    是文件系统无关的，并且已知能够在多种文件系统上工作，包括 EXT4、exFAT、FAT32 等。以下步骤说明了如何在 Windows 工作站上使用 PhotoRec
    恢复文件：
- en: Download the tool from [https://www.cgsecurity.org/wiki/TestDisk_Download](https://www.cgsecurity.org/wiki/TestDisk_Download).
    Unpack the archive in the directory of choice.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 [https://www.cgsecurity.org/wiki/TestDisk_Download](https://www.cgsecurity.org/wiki/TestDisk_Download)
    下载工具。将压缩包解压到你选择的目录中。
- en: Open Command Prompt with Administrator privileges and run `photorec.exe` with
    the Android physical image as an argument.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用管理员权限打开命令提示符，并运行 `photorec.exe`，并将 Android 物理镜像作为参数。
- en: 'Choose the partition you want to carve data from, in our case it''s `USERDATA`.
    This is shown in the following screenshot:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择你想从中雕刻数据的分区，在我们的例子中是 `USERDATA`。如下截图所示：
- en: '![](img/1ba7d350-bf8c-4f66-b536-34f5a659b6ac.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1ba7d350-bf8c-4f66-b536-34f5a659b6ac.png)'
- en: Choosing partition in PhotoRec
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在 PhotoRec 中选择分区
- en: 'If you want only exact file types to be carved, go to `File Opt`. In our case,
    we were only interested in JPG images, so we chose only one file type, as shown
    in the following screenshot:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你只想雕刻特定的文件类型，可以前往 `File Opt`。在我们的例子中，我们只关心 JPG 图像，因此我们只选择了一种文件类型，如下图所示：
- en: '![](img/27f56000-4623-4476-801c-caeb2b66b6f9.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](img/27f56000-4623-4476-801c-caeb2b66b6f9.png)'
- en: Choosing file types in PhotoRec
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在 PhotoRec 中选择文件类型
- en: 'Choose the file system type, in our case it''s EXT4, as shown in the following
    example:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择文件系统类型，在我们的例子中是 EXT4，如以下示例所示：
- en: '![](img/93c60332-8d47-45be-8962-754f7eaa0e74.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](img/93c60332-8d47-45be-8962-754f7eaa0e74.png)'
- en: Choosing the file system type in PhotoRec
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在 PhotoRec 中选择文件系统类型
- en: 'Now, you should choose whether the tool should carve only free space or the
    whole partition. The second option will bring you more data, but it will be mixed
    with files those are not deleted. These choices can be seen in the following example:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你应该选择工具是只扫描空闲空间，还是扫描整个分区。第二个选项会给你带来更多的数据，但它将与那些未被删除的文件混合在一起。以下示例展示了这些选择：
- en: '![](img/6ecc2f53-a46d-4c1c-8296-b1ce3a9dce8c.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6ecc2f53-a46d-4c1c-8296-b1ce3a9dce8c.png)'
- en: Choosing if all space needs to be analyzed
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 选择是否需要分析所有空间
- en: 'Finally, choose the folder where the recovered files will be stored. You can
    use arrow keys to do this, and then press *C*, as shown in the following screenshot:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，选择恢复的文件将存储的文件夹。你可以使用箭头键来完成此操作，然后按 *C*，如以下截图所示：
- en: '![](img/47ecf76c-c920-45db-b29d-7aa3f6d29306.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![](img/47ecf76c-c920-45db-b29d-7aa3f6d29306.png)'
- en: Recovered files will be saved under the subdirectories of the chosen directory
    named `recup_dir`.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 恢复的文件将保存在所选目录下名为 `recup_dir` 的子目录中。
- en: Summary
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Data recovery is the process of retrieving deleted data from the device and
    thus is a very important concept in forensics. In this chapter, we have seen various
    techniques to recover deleted data from both the SD card and the internal memory.
    While recovering the data from a removable SD card is easy, recovering data from
    internal memory involves a few complications. SQLite file parsing and file carving
    techniques aid a forensic analyst in recovering the deleted items present in the
    internal memory of an Android device.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 数据恢复是从设备中恢复已删除数据的过程，因此它是取证中非常重要的概念。在本章中，我们介绍了从 SD 卡和内部存储中恢复已删除数据的各种技术。虽然从可移动
    SD 卡恢复数据相对容易，但从内部存储中恢复数据则涉及一些复杂性。SQLite 文件解析和文件雕刻技术有助于取证分析人员恢复 Android 设备内部存储中已删除的项目。
- en: In the next chapter, we will try to understand the forensic perspective and
    the analysis of Android apps.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将尝试理解取证视角以及对 Android 应用程序的分析。
