- en: Social Engineering
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 社会工程学
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Phishing attacks
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络钓鱼攻击
- en: Spear-phishing attacks
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 垃圾邮件钓鱼攻击
- en: Credential harvesting with SET
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SET进行凭证收集
- en: Web jacking
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网站劫持
- en: PowerShell attack vector
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PowerShell攻击向量
- en: QRCode attack vector
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 二维码攻击向量
- en: Infectious media generator
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 感染性媒体生成器
- en: Obfuscating and manipulating URLs
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 混淆和操控URLs
- en: DNS spoofing and ARP spoofing
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS欺骗和ARP欺骗
- en: DHCP spoofing
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP欺骗
- en: Introduction
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: Social Engineering is a unique aspect of penetration testing. Social Engineering
    can be employed through electronic means, as we will see in the upcoming recipes.
    However, Social Engineering is also used in physical penetration testing and even
    data gathering. It becomes an art about human nature and cultural norms. We bend
    well-known natural tendencies to help us accomplish or obtain what we want.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 社会工程学是渗透测试的一个独特方面。社会工程学可以通过电子手段来实施，正如我们在接下来的配方中将看到的那样。然而，社会工程学也可以应用于物理渗透测试甚至数据收集。它变成了一门关于人类本性和文化规范的艺术。我们利用人类已知的自然倾向来帮助我们实现或获得我们想要的东西。
- en: Phishing attacks
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络钓鱼攻击
- en: Phishing attacks are attacks that are loosely targeted at any individual or
    any entity. Their main value is one of mass distribution, hoping to get a small
    percentage of hits across a large distribution. These are sometimes used in penetration
    testing and targeting-specific domains owned by the client. These attacks are
    targeted specifically at emails. And due to their large distribution, the attacks
    are often caught quickly across many advanced email spam filtering companies.
    But it takes only one to get through and be clicked on.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 网络钓鱼攻击是针对任何个人或实体的松散攻击。它们的主要价值在于大规模分发，期望通过大范围的分发获得一小部分点击。这些攻击有时用于渗透测试，特别是针对客户所拥有的特定域。这些攻击专门针对电子邮件。由于它们的大规模分发，这些攻击常常会被许多先进的电子邮件垃圾邮件过滤公司快速捕捉到。但只要有一个能够通过并被点击，就足够了。
- en: In this recipe, we will create and launch a generic phishing attack.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将创建并发起一个通用的网络钓鱼攻击。
- en: Getting ready
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 做好准备
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，并且您已经以root用户登录
- en: You have some email accounts to use and/or preferably a lab SMTP server
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您需要一些电子邮件账户来使用和/或最好有一个实验室的SMTP服务器。
- en: How to do it...
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'We will use the **Social Engineering Tool** (**SET**) to create a phishing
    attack:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用**社会工程工具**（**SET**）来创建一个网络钓鱼攻击：
- en: 'From the Applications menu, select Social Engineering Tools | SET Social Engineering
    Toolkit. You will be presented with the following screen:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从应用程序菜单中选择社会工程工具 | SET 社会工程工具包。您将看到以下界面：
- en: '![](assets/ad02c14d-0333-4b82-84ba-8634c8499a43.png)Initial set toolkit screen'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/ad02c14d-0333-4b82-84ba-8634c8499a43.png)初始工具包设置界面'
- en: Select the top option: `1) Social-Engineering Attacks`.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择顶部选项：`1) 社会工程攻击`。
- en: Select `5) Mass Mailer Attack`.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`5) 大规模邮件发送攻击`。
- en: Select `2) E-Mail Attack Mass Mailer`.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`2) 电子邮件攻击大规模邮件发送器`。
- en: 'The system will now ask you to select a file that includes an email list in
    the format of one email address per line. Enter the path and filename to use.
    In my case, I have a list prepared at `/root/emaillist.txt`:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统现在会要求您选择一个包含每行一个电子邮件地址的电子邮件列表文件。请输入要使用的路径和文件名。在我的例子中，我已在`/root/emaillist.txt`准备了一个列表：
- en: '![](assets/cae1f525-274d-4418-98bf-e91bfbb3df66.png)SET mass mailer dialog
    screenBuilding a list of email addresses is important and this is where the work
    done in [Chapter 2](48d70dd4-e446-4efa-9f68-eae64fddd3ac.xhtml), *Reconnaissance
    and Scanning* plays an important role. If you did a good job there, you should
    have a list of email addresses already or at the very least, you will have a good
    idea of how they format their usernames for emails. Often you can use resources
    like LinkedIn to add to the list of email addresses as well.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/cae1f525-274d-4418-98bf-e91bfbb3df66.png)SET大规模邮件发送器对话框界面'
- en: Now, we will be asked how we want to use our email attack, either through a
    Gmail account or own server/relay. For our purposes, I am going to use a throw-away
    Gmail account; however, in practice, I would typically use an open relay. Select
    `1\. Use a gmail Account for your email attack`.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将被问到如何使用我们的电子邮件攻击，选择通过Gmail账户还是自己的服务器/中继。为了方便起见，我将使用一个临时的Gmail账户；然而，在实际操作中，我通常会使用一个开放中继服务器。选择
    `1\. 使用Gmail账户进行电子邮件攻击`。
- en: Never use a server or account that can be personally identifiable. The best
    way is to use an open-relay. There are plenty of them out there if you look for
    them.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 切勿使用任何可能泄露个人身份的服务器或账户。最好的方法是使用开放中继服务器。如果你仔细寻找，会发现有很多这样的服务器。
- en: 'Enter your throw-away Gmail account: `johndoe@example.com` and press *Enter*.'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入你的临时Gmail账户：`johndoe@example.com` 并按 *Enter*。
- en: Enter a name to use as the sender that the user will see: `John Doe`.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入一个作为发件人显示给用户的名称：`John Doe`。
- en: Enter the account password and press *Enter*.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入账户密码并按 *Enter*。
- en: Decide whether you want to send the message with high priority, and type `yes`
    or `no` then press *Enter*.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 决定是否要以高优先级发送邮件，并输入 `yes` 或 `no`，然后按 *Enter*。
- en: Decide whether you want to attach a file. In my case, I want to attach a file
    with a malicious payload. So, I will type `y`and press *Enter*.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 决定是否要附加一个文件。在我的例子中，我要附加一个含有恶意载荷的文件。所以，我将输入 `y` 然后按 *Enter*。
- en: I will attach my `/root/salary.pdf` malicious payload.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我将附加我的 `/root/salary.pdf` 恶意载荷文件。
- en: You need to either attach a malicious payload or a malicious link for the phishing
    attack to work. Figure out what makes most sense for your test and go forward
    with it.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要附加一个恶意载荷或一个恶意链接，才能使钓鱼攻击生效。根据你的测试需求选择合适的方式并继续操作。
- en: Enter an email subject. In my case, I am going to call it `Salary Info`.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入邮件主题。在我的例子中，我将主题设为 `Salary Info`。
- en: I have the option to send as HTML or plain text. I am going to choose the plain
    text for simplicity. Next, I will press *Enter*.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我可以选择以HTML格式或纯文本格式发送邮件。我为了简便起见将选择纯文本格式。接下来，我将按 *Enter*。
- en: If you plan on embedding a malicious link, you must choose HTML. Most users
    are accustomed to seeing HTML pages today that by sending as a plain text may
    actually increase there suspicion that the email may be farudulent. But for example
    purposes, it will work fine.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你计划嵌入恶意链接，你必须选择HTML格式。如今，大多数用户已经习惯看到HTML格式的页面，通过纯文本发送可能会增加他们怀疑邮件是欺诈的可能性。但出于示范目的，这样做也是可行的。
- en: 'Now, enter the body of the message. I plan on keeping this very short and simple:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，输入邮件正文。我打算让它简短而简单：
- en: '[PRE0]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: It will then output the email addresses that the message was sent to.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，它会输出邮件发送到的电子邮件地址。
- en: It's very important to put time and energy into properly crafting the email
    and the attachment or link, so you have more chances of it being successful. Therefore,
    double check for spelling and grammar issues.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 正确编写邮件内容和附件或链接非常重要，这样你才有更大的成功机会。因此，务必仔细检查拼写和语法问题。
- en: Spear-phishing attacks
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定向网络钓鱼攻击
- en: Spear-phishing attacks are specifically targeted at an individual or entity.
    Their main value is that they are targeted at a small group of users. These are
    quite often used in penetration testing, targeting specific email addresses of
    the client. You must spend more time in researching the client by gathering information,
    such as email signatures, logos, and understanding what the communications from
    the customer may look like. Often, you may register a look-a-like domain that
    may seem familiar when they see the `from` message.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 定向网络钓鱼攻击是专门针对个人或实体的。其主要价值在于它们针对的是一小群用户。这类攻击在渗透测试中被广泛使用，通常是针对客户的特定电子邮件地址。你必须花更多时间研究客户，收集信息，如邮件签名、标志，并了解客户的通信内容。通常，你可能会注册一个相似的域名，这样当他们看到“发件人”时，会觉得这个域名似曾相识。
- en: In this recipe, we will create and launch a targeted spear-phishing attack.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个步骤中，我们将创建并启动一个定向的网络钓鱼攻击。
- en: Getting ready
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下前提条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，并且你以root身份登录。
- en: You have some email accounts and/or preferably a lab SMTP server
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你需要一些电子邮件账户和/或一个实验室SMTP服务器。
- en: How to do it...
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now use set to create a spear-phishing attack:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将使用SET创建一个针对性网络钓鱼攻击：
- en: 'From the Applications menu, select Social Engineering Tools | SET Social Engineering
    Toolkit. You will be presented with the following screen:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从应用程序菜单中，选择社会工程工具 | SET社会工程工具包。你将看到以下界面：
- en: '![](assets/688c7523-a855-4cf4-81b0-18f3122f6f5d.png)Initial setookit screen'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/688c7523-a855-4cf4-81b0-18f3122f6f5d.png)初始setookit界面'
- en: Select the top option: `1) Social-Engineering Attacks`.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择顶部选项：`1) 社会工程攻击`。
- en: Select `1) Spear-Phishing Attack Vectors`.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`1) 矛刺钓鱼攻击向量`。
- en: Select `1) Perform a Mass Email Attack`.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`1) 执行大规模电子邮件攻击`。
- en: From here, we will have several optional attack vectors that we can use. Pick
    a suitable one based on the email you will be sending, and what you believe the
    customer has and uses for the software. For our testing purposes, we will use
    `13) Adobe PDF Embedded EXE Social Engineering`.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里开始，我们将有多个可选的攻击向量。根据你要发送的邮件以及你认为客户所拥有的软件来选择合适的攻击向量。为了测试目的，我们将使用`13) 嵌入式EXE的Adobe
    PDF社会工程`。
- en: So, this will embed the attack either in a provided PDF or a blank PDF. For
    our test purposes, we will simply use `2) Use built-in BLANK PDF for attack`.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这样，攻击将嵌入到提供的PDF或空白PDF中。为了测试，我们将直接使用`2) 使用内置的空白PDF进行攻击`。
- en: When penetration testing with spear-phishing, you may have some desired outcomes
    in mind. However, it's important to remember that one of those outcomes is to
    avoid raising suspicions. Because of this, the more the email seems appropriate
    in its entirety, the better off you are. Say, if you were doing this in a healthcare
    situation, you could download some HIPAA regulations in a PDF format, insert the
    malware, and send it to the appropriate people in the organization. When they
    open it, they will see what they expect, therefore helping you to mask the fact
    that they were just and not alerting them to an issue.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 当进行矛刺钓鱼渗透测试时，你可能有一些期望的结果。然而，重要的是要记住，这些结果之一是避免引起怀疑。因此，邮件越是看起来合适，你就越有利。例如，如果你在医疗行业中进行这类操作，可以下载一些HIPAA法规的PDF格式文件，插入恶意软件，并将其发送给组织中的相关人员。当他们打开它时，他们会看到他们预期的内容，从而帮助你掩盖攻击的事实，避免引起他们的警觉。
- en: Next, you have several options for the return callback to you. Reverse shell
    or reverse meterpreter are always good options. Select `1) Windows Reverse TCP
    shell`.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，你有几个选项来选择回调方式。反向shell或反向meterpreter总是不错的选择。选择`1) Windows反向TCP shell`。
- en: We will set the IP address of our Kali box. Use your appropriate IP address;
    in my case, I will use `192.168.56.10`.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将设置我们的Kali盒子IP地址。使用你适当的IP地址；在我的例子中，我将使用`192.168.56.10`。
- en: Set the port to connect back on. For test purposes, I will use `8123`.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置回连的端口。为了测试，我将使用`8123`。
- en: Select `2\. Rename the file, I want to be cool.` And rename the file to something
    appropriate for the context of use.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`2\. 重命名文件，我想要酷一点。`并将文件重命名为适合使用情境的名称。
- en: For this, we will just select `1\. E-Mail attack Single email address`.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于这个，我们将选择`1\. 电子邮件攻击单一电子邮件地址`。
- en: Select `1\. Pre-Defined Template`.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`1\. 预定义模板`。
- en: In most cases, you will want to create your own template for this, but, as we
    did that in the phishing attacks recipe, you can refer back for more information.
    Also, most spam engines know the format of these built-in templates, so the attacks
    will be thwarted with relative ease.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，你会希望创建自己的模板，但正如我们在钓鱼攻击章节中做的那样，你可以参考之前的内容。此外，大多数垃圾邮件引擎知道这些内置模板的格式，因此攻击将相对容易被防御。
- en: 'Pick an available template. `3: Have you seen this?` will be fine for our example.'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '选择一个可用的模板。`3: 你看过这个吗？`对于我们的示例来说就可以了。'
- en: Enter the address to send the email to `johndoe@example.com`.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入发送邮件的地址`johndoe@example.com`。
- en: In this case. let's see if we can find an open relay to bounce it off. Do some
    searching on Google, or you can try to use your ISP email server for this. Select
    `2\. Use your own server or open relay`.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这种情况下，让我们看看是否能找到一个开放的中继来转发邮件。可以在谷歌上搜索一下，或者尝试使用你的ISP邮件服务器。选择`2\. 使用你自己的服务器或开放中继`。
- en: If you cannot find one, you can revert to a Gmail account and use the steps
    as outlined in recipe 5.1.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果找不到中继服务器，你可以回退到一个Gmail账户，并使用第5.1节中列出的步骤。
- en: 'Enter appropriate sender address: `Janedoe@example.com`.'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入合适的发件人地址：`Janedoe@example.com`。
- en: 'Enter appropriate sender name: `Jane Doe`.'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入合适的发件人名称：`Jane Doe`。
- en: If you require a username for your relay server, you can enter the user information
    as appropriate. I will leave mine blank.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你的中继服务器需要用户名，你可以根据需要输入用户名信息。我会把我的留空。
- en: If you require a password for your relay server, you can enter the password
    information as appropriate. I will leave mine blank.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你的中继服务器需要密码，你可以根据需要输入密码信息。我会把我的留空。
- en: Enter the mail server address or **Fully Qualified Domain Name** (**FQDN**).
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入邮件服务器地址或**完全限定域名**（**FQDN**）。
- en: Enter the port number for the SMTP service of the relay. I will leave mine at
    `25`.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入中继的SMTP服务端口号。我将我的设置为`25`。
- en: I will select No to flag the message as high priority.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我将选择“否”来标记消息为低优先级。
- en: Lastly, does my server support TLS? For this, I will select No as well.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我的服务器支持TLS吗？为此，我也会选择“否”。
- en: From here, you will automatically be given the option to set up a listener,
    and it will autolaunch the `msfconsole` and set the appropriate listener for you.
    Since I like Armitage, I will open my listener through it.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，你将自动获得设置监听器的选项，并会自动启动`msfconsole`并为你设置相应的监听器。由于我喜欢使用Armitage，所以我会通过它来打开监听器。
- en: Refer back to recipe in [Chapter 4](9f678d15-2115-4e29-a75d-03dba65d3398.xhtml),
    *Finding Exploits in the Target* of* Basic exploit attacks with Armitage* and
    *Advanced attacks with Armitage* on how to open listeners in Armitage.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考[第4章](9f678d15-2115-4e29-a75d-03dba65d3398.xhtml)中的配方，*在目标中查找漏洞*，以及*使用Armitage进行的基础漏洞攻击*和*使用Armitage进行的高级攻击*，学习如何在Armitage中打开监听器。
- en: I open the PDF from the email, and I will see a blank PDF. But notice that in
    my Armitage console, it will now show a connection to the Windows XP machine.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我打开了邮件中的PDF，但会看到一个空白的PDF。但注意，在我的Armitage控制台中，现在会显示与Windows XP机器的连接。
- en: I downloaded and used an older version of Acrobat Reader on my Windows XP machine.![](assets/3f896208-a522-40c8-a724-629d51d7ba7d.png)Windows
    XP machine with hipaaregs.pdf opened![](assets/ed4b68c1-37a3-4fd3-8f31-d14d246acbc2.png)Kali
    Linux Armitage handler screen indication XP machine connectedAgain, many AV and
    SPAM engines are familiar with these attacks, and there will be a high rate of
    detection, unless you really spend some time in crafting the messages well and
    creating your own customized payload to get through the detection engines.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 我在我的Windows XP机器上下载并使用了旧版的Acrobat Reader。![](assets/3f896208-a522-40c8-a724-629d51d7ba7d.png)Windows
    XP机器，打开了hipaaregs.pdf![](assets/ed4b68c1-37a3-4fd3-8f31-d14d246acbc2.png)Kali
    Linux Armitage处理器屏幕，显示XP机器已连接。再次强调，许多防病毒和垃圾邮件引擎都熟悉这些攻击，除非你花时间精心设计信息并创建自定义负载，否则检测率会很高。
- en: Credential harvesting with SET
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用SET进行凭证收集
- en: Credential harvesting can be used with many different types of attacks, but
    the ultimate goal is to make the user believe he has reached the site that he
    was trying to get to, such as Facebook or Google, and steal their credentials
    when they attempt to log in.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 凭证收集可以与多种不同类型的攻击一起使用，但最终目标是让用户相信他们已经到达了他们想访问的网站，比如Facebook或Google，并在他们尝试登录时窃取他们的凭证。
- en: In this recipe, we will mimic a site and perform credential harvesting for accounts
    for that site.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将模拟一个网站并进行该网站的凭证收集。
- en: Getting ready
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下前提条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，你已经以root用户登录。
- en: Move the interface from one of your Windows test machines to the NAT network
    temporarily
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 临时将接口从你的某个Windows测试机移到NAT网络。
- en: How to do it...
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'We will now impersonate a real web site to gather credentials:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将伪装成一个真实的网站来收集凭证：
- en: 'From the Applications menu, select Social Engineering Tools | SET Social Engineering
    Toolkit. You will be presented with the following screen:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在应用菜单中，选择社会工程工具 | SET社会工程工具包。你将看到以下界面：
- en: '![](assets/fc217886-b767-4bb8-ac9e-c877f990c6b7.png)Initial setoolkit screen'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/fc217886-b767-4bb8-ac9e-c877f990c6b7.png)初始setoolkit界面'
- en: Select the top option, `1) Social-Engineering Attacks`.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择顶部选项，`1) 社会工程攻击`。
- en: Select `2) Website Attack Vectors`.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`2) 网站攻击向量`。
- en: Select `3) Credential Harvester Attack Method`.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`3) 凭证收集攻击方法`。
- en: Select `1) Templates`.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`1) 模板`。
- en: 'You will then be asked for the IP address of the post. Enter the IP address
    of Kali on the NAT network. You can open another terminal window and do `ifconfig`.
    I will enter `10.0.2.4`:'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后系统会要求你输入邮局的IP地址。请输入Kali在NAT网络上的IP地址。你可以打开另一个终端窗口并输入`ifconfig`。我将输入`10.0.2.4`：
- en: '![](assets/5d606367-8e35-435f-a47f-2ef602d917c8.png)ifconfig output of Kali
    machine'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/5d606367-8e35-435f-a47f-2ef602d917c8.png)Kali机器的ifconfig输出'
- en: We will be given a list of predefined templates, so let's use `2\. Google`.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将获得一个预定义模板列表，所以我们选择`2. Google`。
- en: The harvester will automatically launch and be displayed on your screen.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 收集器将自动启动并显示在你的屏幕上。
- en: 'From the Windows machine, log in and browse to the IP address of your Kali
    device as previously entered:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 Windows 机器上，登录并浏览到你之前输入的 Kali 设备的 IP 地址：
- en: '![](assets/30cb7e16-fdd0-4371-b8a4-7826eefb3a1a.png)Fake Google login page'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/30cb7e16-fdd0-4371-b8a4-7826eefb3a1a.png)假 Google 登录页面'
- en: You get a very familiar looking login screen; however; up at the top, it provides
    an IP address versus Google.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你会看到一个非常熟悉的登录界面；然而，顶部显示的是一个 IP 地址，而不是 Google。
- en: So, to make this more believable, you would want to hide the IP address. Do
    you have any thoughts? There are two options. Firstly, if you have previously
    compromised the device, you could modify the host file; alternatively, you could
    use DNS/DHCP spoofing.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让这个攻击更加可信，你需要隐藏 IP 地址。你有什么想法吗？有两种选择。首先，如果你之前已经攻破了设备，可以修改主机文件；另外，你可以使用 DNS/DHCP
    欺骗。
- en: 'Enter test credentials and click on Sign in:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入测试凭证并点击“登录”：
- en: '![](assets/950f03af-4d8f-46c8-8cbf-f9e92199a397.png)Fake login screen'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/950f03af-4d8f-46c8-8cbf-f9e92199a397.png)假登录界面'
- en: 'Notice that, on the Windows machine, you will be redirected to Google. However,
    look at `SET`, and notice we harvested the credentials:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意，在 Windows 机器上，你会被重定向到 Google。但是，看看 `SET`，你会发现我们已经收集到了凭证：
- en: '![](assets/0cb5053c-805c-4600-a8d9-2956b636af6f.png)Set output of credentials'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/0cb5053c-805c-4600-a8d9-2956b636af6f.png)凭证设置输出'
- en: Type `Control-C` and press *Enter*; this will return you to the `SET` console.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 `Control-C` 并按 *Enter*；这将让你返回到 `SET` 控制台。
- en: Web jacking
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网页劫持
- en: Web jacking is a method where the user will be presented with a website saying
    the site has moved, and when they are redirected, they have malware inserted in
    the browser/computer.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 网页劫持是一种方法，用户会看到一个提示说网站已迁移的页面，当他们被重定向时，恶意软件将被插入到浏览器/计算机中。
- en: In this recipe, we will web jack a site.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将进行网页劫持。
- en: Getting ready
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保满足以下前提条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 正在运行，你已作为 root 登录
- en: Move the interface of one of your Windows test machines to the NAT network temporarily
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 暂时将你的其中一台 Windows 测试机的网络接口切换到 NAT 网络
- en: How to do it...
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now perform web jacking by simulating a site redirect:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将通过模拟网站重定向来进行网页劫持：
- en: 'From the Applications menu, select Social Engineering Tools | SET Social Engineering
    Toolkit. You will be presented with the following screen:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从应用程序菜单中选择社会工程学工具 | SET 社会工程学工具包。你将看到以下界面：
- en: '![](assets/19762bac-145f-4a80-8920-041516476c4c.png)Initial setookit screen'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/19762bac-145f-4a80-8920-041516476c4c.png)初始设置工具界面'
- en: Select the top option, `1) Social-Engineering Attacks`.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择顶部选项，`1) 社会工程学攻击`。
- en: Select `2) Website Attack Vectors`.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 `2) 网站攻击向量`。
- en: Select `5) Web Jacking Attack Method`.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 `5) 网页劫持攻击方法`。
- en: We will select `2) Site Cloner`.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将选择 `2) 网站克隆器`。
- en: Enter the IP address of the post again. In this case, my IP of `10.0.2.4`.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次输入帖子的 IP 地址。在这种情况下，我的 IP 是 `10.0.2.4`。
- en: Enter the URL site you want to clone. A sample site you can use is [http://us-123hiking.simplesite.com/.](http://us-123hiking.simplesite.com/)
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入你想要克隆的网址。你可以使用一个示例网址：[http://us-123hiking.simplesite.com/.](http://us-123hiking.simplesite.com/)
- en: This system will automatically clone the site and start the `msfconsole`.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统将自动克隆该网站并启动 `msfconsole`。
- en: 'From here, open one of your Windows VM. I will use the Windows 7 machine and
    browse to `http://10.0.2.4`:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，打开你的一台 Windows 虚拟机。我将使用 Windows 7 机器并浏览到 `http://10.0.2.4`：
- en: '![](assets/6fe6b093-68c0-49ae-b2df-2da2e7a94f60.png)Fake website screen'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/6fe6b093-68c0-49ae-b2df-2da2e7a94f60.png)假网站界面'
- en: 'I see a link up at the top, so I click on it to open the dialog:'
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我看到顶部有一个链接，于是我点击它打开对话框：
- en: '![](assets/67f22e33-6dc8-4e2a-95b5-cfd6a9b2da42.png)Run dialog box'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/67f22e33-6dc8-4e2a-95b5-cfd6a9b2da42.png)运行对话框'
- en: Then, I click on Run from the machine.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我点击从机器上运行。
- en: 'From there, if I go back to Kali, I will see a new session has been opened:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，如果我回到 Kali，我会看到一个新的会话已经打开：
- en: '![](assets/596b5c20-0785-4e76-978d-b8f3436df6fa.png)MSF exploit session connected
    screen'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/596b5c20-0785-4e76-978d-b8f3436df6fa.png)MSF 利用会话连接屏幕'
- en: Type `sessions 1` and press *Enter* at the `msf >` prompt to attach you to the
    computer.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `msf >` 提示符下输入 `sessions 1` 并按 *Enter*，这将让你连接到计算机。
- en: Type `sysinfo` and press *Enter* to get access to the system.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 `sysinfo` 并按 *Enter* 获取系统信息。
- en: From here, you can try some other commands in the `msfconsole` to play around,
    but, at this point, you have access to the PC.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，你可以在 `msfconsole` 中尝试其他命令进行操作，但此时你已经可以访问这台 PC。
- en: PowerShell attack vector
  id: totrans-142
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: PowerShell 攻击向量
- en: In this recipe, we will use PowerShell to connect back to our Kali host. PowerShell
    has been included with Windows Vista and beyond and has become a very popular
    attack vector due to the capabilities of the shell. We will not focus on how to
    get the script there, as we have covered options in other recipes; this will just
    focus on creating the malicious payload.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将使用 PowerShell 来回连到我们的 Kali 主机。PowerShell 已被包括在 Windows Vista 及以后版本中，并且由于其外壳功能，它已成为一个非常流行的攻击向量。我们不会专注于如何将脚本传送到目标，因为在其他配方中已经涵盖了相关选项；这里只专注于创建恶意载荷。
- en: Getting ready
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 正在运行，你已以 root 身份登录。
- en: Move the interface of one of your Windows test machines to the NAT network temporarily
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 暂时将你的 Windows 测试机器的网络接口切换到 NAT 网络。
- en: How to do it...
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now use PowerShell to attack a host:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将使用 PowerShell 来攻击一个主机：
- en: 'From the Applications menu, select Social Engineering Tools | SET Social Engineering
    Toolkit. You will be presented with the following screen:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从应用程序菜单中选择社交工程工具 | SET 社交工程工具包。你将看到以下界面：
- en: '![](assets/c27340f7-c216-4b06-adf9-d17f153701f1.png)Initial setoolkit screen'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/c27340f7-c216-4b06-adf9-d17f153701f1.png)初始 setoolkit 界面'
- en: Select the top option, `1) Social-Engineering Attacks`.
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择顶部选项，`1) 社交工程攻击`。
- en: Select `9) Powershell Attack Vectors`.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`9) PowerShell 攻击向量`。
- en: Select `2) Powershell Reverse Shell`.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`2) PowerShell 反向 Shell`。
- en: Enter the IP address of your Kali host `192.168.56.10`.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入你的 Kali 主机的 IP 地址`192.168.56.10`。
- en: Enter the listener port `8123`.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入监听端口`8123`。
- en: Select No when asked to start a listener, as we will use Metasploit for that.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当询问是否启动监听器时，选择“否”，因为我们将使用 Metasploit 来完成这个操作。
- en: A file will be created in the following location `~/.set/reports/powershell/powershell.reverse.txt`.
    Move this file to the Windows machine, and change its extension from TXT to PS1.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个文件将被创建在以下位置`~/.set/reports/powershell/powershell.reverse.txt`。将这个文件移到 Windows
    机器，并将其扩展名从 TXT 改为 PS1。
- en: 'Since we will use the `msfconsole` for our listener, let''s get it prepared
    by entering the following commands in a terminal window. We will use our Kali
    Linux host-only, IP address of `192.168.56.10`, and our listener port of `8123`:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 由于我们将使用`msfconsole`作为监听器，让我们通过在终端窗口输入以下命令来准备它。我们将使用我们的 Kali Linux 主机的专用 IP 地址
    `192.168.56.10`，以及我们的监听端口`8123`：
- en: '[PRE1]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '![](assets/0e6eed83-a525-450a-8ce7-c4a5df6447ba.png)MSF initialization screen'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/0e6eed83-a525-450a-8ce7-c4a5df6447ba.png)MSF 初始化界面'
- en: 'From your Windows 7 machine, open a Command Prompt, and type the following:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的 Windows 7 机器上，打开命令提示符，并输入以下内容：
- en: '[PRE2]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '![](assets/8cb9f686-0223-47b2-bbf9-9b6104e4f658.png)PowerShell output'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/8cb9f686-0223-47b2-bbf9-9b6104e4f658.png)PowerShell 输出'
- en: 'You will notice that we now have a connection on session 1, so let''s open
    it by typing `sessions 1`. From here, we can enter a simple command like `dir`
    to get a directory listing:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你会注意到我们现在在会话 1 上有一个连接，因此让我们通过输入`sessions 1`来打开它。从这里，我们可以输入一个简单的命令，例如`dir`来获取目录列表：
- en: '![](assets/61801c51-9e7e-4f5d-bdbe-80b924e6c85f.png)Dir output from msf'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/61801c51-9e7e-4f5d-bdbe-80b924e6c85f.png)msf 输出的目录内容'
- en: QRCode attack vector
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: QRCode 攻击向量
- en: In this recipe, we will generate a QRCode for a site that we own, to harvest
    credentials. This can be sent through various means such as email, Facebook, twitter
    post, or even by using it as part of a flyer that you leave on target vehicles.
    We will send this QRCode to our target.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在本配方中，我们将为我们拥有的网站生成一个二维码，以收集凭据。这个二维码可以通过多种方式发送，比如电子邮件、Facebook、Twitter 帖子，甚至可以作为传单的一部分留在目标车辆上。我们将把这个二维码发送给我们的目标。
- en: Getting ready
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 正在运行，你已以 root 身份登录。
- en: How to do it...
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will create a QRCode which redirect to a website:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建一个二维码，指向一个网站：
- en: 'From the Applications menu, select Social Engineering Tools | SET Social Engineering
    Toolkit. You will be presented with the following screen:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从应用程序菜单中选择社交工程工具 | SET 社交工程工具包。你将看到以下界面：
- en: '![](assets/a478fff6-30ec-43c3-894f-4c2634481881.png)Initial set toolkit screen'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/a478fff6-30ec-43c3-894f-4c2634481881.png)初始 set 工具包界面'
- en: Select the top option `1) Social-Engineering Attacks`.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择顶部选项`1) 社交工程攻击`。
- en: Select `8) QRCode Generator Attack Vector`.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`8) QRCode 生成器攻击向量`。
- en: Enter the malicious URL; for our test purposes, we will simply enter `www.packtpub.com`.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入恶意 URL；为了测试，我们将输入`www.packtpub.com`。
- en: It will generate the image file and provide the location.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 它将生成图像文件并提供其位置。
- en: 'Open the image file on your Kali VM, like so:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的 Kali 虚拟机上打开图像文件，如下所示：
- en: '![](assets/6ff91a06-f21a-426c-862f-bd07e5ee3a3a.png)Generated QRCode'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/6ff91a06-f21a-426c-862f-bd07e5ee3a3a.png)生成的二维码'
- en: Most phones will scan this image and take you to the website indicated.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 大多数手机会扫描此图像并将你带到指定的网站。
- en: Apple iOS requires a third-party app - however, it is supposed to be included
    in iOS 11.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 苹果 iOS 需要一个第三方应用——不过，应该已经包含在 iOS 11 中。
- en: There's more...
  id: totrans-184
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Alone this attack may seem meagre, but it is a very effective attack. First,
    you can pretty much design any website you want and use it to capture credentials.
    Think about putting flyers in a company parking lot that says scan this QRCode
    and sign up to get a free 5.00 gift card to Starbucks. How many of those people
    do you think you can get significant information on?
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 单独来看，这个攻击可能显得微不足道，但它是一个非常有效的攻击。首先，你几乎可以设计任何你想要的网站，并利用它捕获凭证。试想一下，在公司停车场放置传单，写着扫描此二维码并注册以获得一张价值
    5.00 美元的 Starbucks 礼品卡。你认为这些人中有多少可以获取到重要信息？
- en: Infectious media generator
  id: totrans-186
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 感染介质生成器
- en: In this recipe, we will build an infectious file that can be put on USBs, CDs,
    or DVDs. We will generate a malicious payload that will autorun when entered into
    a victim PC. We will simulate the execution; however, if you have physical test
    machines, it is much easier to test.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，我们将构建一个可以放在 USB、CD 或 DVD 上的感染性文件。我们将生成一个恶意的 Payload，当插入受害者 PC 时，它将自动运行。我们将模拟执行过程；然而，如果你有实体测试机器，测试起来会更容易。
- en: Getting ready
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 正在运行，你已以 root 用户登录
- en: Windows VM is up and running
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 虚拟机已启动并运行
- en: How to do it...
  id: totrans-192
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will build our infections media:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将构建我们的感染介质：
- en: 'From the Applications menu, select Social Engineering Tools | SET Social Engineering
    Toolkit. You will be presented with the following screen:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从“应用程序”菜单中选择 社会工程工具 | SET 社会工程工具包。你将看到以下界面：
- en: '![](assets/6142027b-d0b6-4076-b784-9b96b15c649b.png)Initial setookit screen'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/6142027b-d0b6-4076-b784-9b96b15c649b.png)初始工具包界面'
- en: Select the top option `1) Social-Engineering Attacks`.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择顶部选项 `1) 社会工程攻击`。
- en: Select `3) Infectious media generator`.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 `3) 感染介质生成器`。
- en: Select `2) Standard Metasploit Executable`.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 `2) 标准 Metasploit 可执行文件`。
- en: Let's use `2) Windows Reverse_TCP Meterpreter`.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们选择 `2) Windows 反向_TCP Meterpreter`。
- en: For the `LHOST`, use the IP address of your Kali machine `192.168.56.10`.
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于 `LHOST`，使用你 Kali 机器的 IP 地址 `192.168.56.10`。
- en: Enter the port for callback `8123`.
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入回调端口 `8123`。
- en: 'It will then generate the payload. Go ahead and start a listener right now:'
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后它将生成 Payload。现在开始启动监听器：
- en: '![](assets/66e6f575-90c5-4572-a566-c3342899f359.png)Payload generation output'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/66e6f575-90c5-4572-a566-c3342899f359.png)Payload 生成输出'
- en: From here, we have an autorun option that we can burn to a DVD or CD or put
    on a USB. This is a bit difficult to simulate with our virtual machines, so we
    will simply copy the `program.exe` file from `~/.set/autrun/program.exe` and put
    it on our Windows 7 test machine to run it.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里开始，我们有一个自动运行选项，可以将其刻录到 DVD 或 CD 上，或放入 USB。用虚拟机模拟这一过程有些困难，因此我们将直接从 `~/.set/autrun/program.exe`
    复制 `program.exe` 文件，并将其放到我们的 Windows 7 测试机器上执行。
- en: 'From your Windows machine, open the `program.exe` file simulating an autorun
    execution. Notice that, upon running it, there are no visible signs of execution.
    This would be the same if it was autorun from a USB stick:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从你的 Windows 机器上，打开模拟自动运行执行的 `program.exe` 文件。注意，在运行时，没有可见的执行迹象。如果它是从 USB 驱动器自动运行的情况也是如此：
- en: '![](assets/8a35bc27-e182-4536-b333-543824d51ccc.png)Payload execution on Windows
    VM'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/8a35bc27-e182-4536-b333-543824d51ccc.png)在 Windows 虚拟机上执行 Payload'
- en: 'From our Kali machine, you will notice that we have a new session connected.
    Type `sessions` to see the connected devices:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从我们的 Kali 机器上，你会注意到我们有一个新的会话连接。输入 `sessions` 查看已连接的设备：
- en: '![](assets/926abe38-b7b5-4294-95da-ff5ea034340e.png)MSF session connected'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/926abe38-b7b5-4294-95da-ff5ea034340e.png)MSF 会话已连接'
- en: 'Enter `sessions 1`, and from here, we are now connected to our target machine
    in a meterpreter session; to validate our connection, we type `sysinfo`:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 `sessions 1`，从这里开始，我们已经在 meterpreter 会话中连接到目标机器；为了验证我们的连接，输入 `sysinfo`：
- en: '![](assets/09d1345e-1cdf-4da7-ad7b-993398427992.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/09d1345e-1cdf-4da7-ad7b-993398427992.png)'
- en: MSF sysinfo output
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: MSF sysinfo 输出
- en: There's more...
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: This is a great attack to use with USB sticks. If you are actively working with
    a company on a penetration testing engagement you can spread them around the company
    entrances and parking lots. There is a high likelihood that at least a few of
    them will be plugged in giving you access to the target network.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个非常适合USB闪存驱动器的攻击方法。如果您正在与公司合作进行渗透测试，可以将其散布在公司入口和停车场周围。很有可能至少会有几个USB驱动器被插入，从而让您访问目标网络。
- en: Obfuscating and manipulating URLs
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 混淆和操控URL
- en: Obfuscating and manipulating URLs has long been used to assist in tricking an
    end user into clicking on a malicious site. These could be through various techniques
    such as using URL shortening, hiding the URL, using the IP address, and other
    functions. This can be used in emails or other types of interactive documents.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 混淆和操控URL早已被用于欺骗最终用户点击恶意网站。这些技术可以通过各种方式实现，如使用URL缩短、隐藏URL、使用IP地址和其他功能。这些方法可以应用于电子邮件或其他互动文档。
- en: In this recipe, we will examine a couple of methods to obfuscate or manipulate
    URLs.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将探讨几种混淆或操控URL的方法。
- en: Getting ready
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备开始
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，您已以root身份登录
- en: How to do it...
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now review several methods of obfuscating URLS:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将回顾几种混淆URL的方法：
- en: URL shortener
  id: totrans-222
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: URL缩短器
- en: 'Let''s work with a URL shortener first:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先来使用URL缩短器：
- en: From you main Kali screen, open a Firefox browser. ![](assets/4c351d87-54b2-4e0f-bdbd-9d7fc866e44c.png)
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的主Kali屏幕上，打开Firefox浏览器。![](assets/4c351d87-54b2-4e0f-bdbd-9d7fc866e44c.png)
- en: 'Go to the [https://goo.gl](https://goo.gl) link. Enter a URL you want to shorten.
    The following is an example I''m using:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问[https://goo.gl](https://goo.gl)链接，输入您想缩短的URL。以下是我使用的示例：
- en: '[https://www.nytimes.com/2017/05/15/technology/personaltech/heres-how-to-protect-yourself-from-ransomware-attacks.html](https://www.nytimes.com/2017/05/15/technology/personaltech/heres-how-to-protect-yourself-from-ransomware-attacks.html)'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://www.nytimes.com/2017/05/15/technology/personaltech/heres-how-to-protect-yourself-from-ransomware-attacks.html](https://www.nytimes.com/2017/05/15/technology/personaltech/heres-how-to-protect-yourself-from-ransomware-attacks.html)'
- en: 'Select I''m not a Robot and click on SHORTEN URL:'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择“我不是机器人”并点击“缩短URL”：
- en: '![](assets/21ae5fbc-6e78-4031-a1a2-3e84f4e38d42.png)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/21ae5fbc-6e78-4031-a1a2-3e84f4e38d42.png)'
- en: You will get an output with a shortened URL; in my case, it is `goo.gl/0Dhuon`.
    When you enter that into your browser, you will be taken to the original link.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将获得一个缩短后的URL；在我的例子中，它是`goo.gl/0Dhuon`。当您将其输入浏览器时，您将被带到原始链接。
- en: URL manipulation
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: URL操控
- en: 'Know we will manipulate a URL:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将操作一个URL：
- en: From your main Kali screen, open a Firefox browser. ![](assets/e73a5f30-3efc-48a9-8930-de0e4bda5000.png)
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的主Kali屏幕上，打开Firefox浏览器。![](assets/e73a5f30-3efc-48a9-8930-de0e4bda5000.png)
- en: There is a method of using the @ sign in a URL to help fake the IP address.
    In your browser, try entering `http://www.gooogle.com@www.packtpub.com`. Depending
    on your browser, you may or may not get an error message. For instance, try this
    in Firefox and then in Chrome. Anything before @ is assumed to be login credentials
    for the website that follows the @ sign. If the site does not require authentication,
    you will be taken directly in.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 有一种方法是使用@符号在URL中帮助伪造IP地址。在浏览器中，尝试输入`http://www.gooogle.com@www.packtpub.com`。根据您的浏览器，您可能会或不会看到错误信息。例如，先在Firefox中尝试，然后在Chrome中试试看。在@符号前的部分被视为网站的登录凭证，如果该网站不需要身份验证，您将直接进入。
- en: At the time of the writing this book, you will get a confirmation in one, and
    automatically be redirected in the other.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 在写这本书时，您将在一个页面上获得确认，并会自动重定向到另一个页面。
- en: Simple URL link misdirections
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简单的URL链接误导
- en: 'We will use a URL link redirection attack:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用URL链接重定向攻击：
- en: From within Kali, open up a document editor. I will use Google Docs.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Kali中，打开一个文档编辑器。我将使用Google Docs。
- en: 'Type in a simple phrase such as `Please signup at facebook.com for the promotion`:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入一个简单的短语，例如`Please signup at facebook.com for the promotion`：
- en: '![](assets/c4c19a41-489b-4452-9dd2-f34f0aeeef17.png)'
  id: totrans-239
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/c4c19a41-489b-4452-9dd2-f34f0aeeef17.png)'
- en: 'Highlight facebook.com and right-click on it and select Link... :'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 高亮显示facebook.com，右键点击并选择链接...：
- en: '![](assets/044b3d18-3eed-446a-9e69-55e7c79a2a3e.png)'
  id: totrans-241
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/044b3d18-3eed-446a-9e69-55e7c79a2a3e.png)'
- en: 'Enter a different URL for the link address, and click on Apply:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入不同的URL地址，然后点击应用：
- en: '![](assets/c0d360b9-36a8-4a17-9bb5-eb8f53577bf6.png)'
  id: totrans-243
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/c0d360b9-36a8-4a17-9bb5-eb8f53577bf6.png)'
- en: 'Now, if the link is clicked, it will forward you to the target website, as
    opposed to the website displayed:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果点击链接，它会将你转发到目标网站，而不是显示的网站：
- en: '![](assets/3e59f31c-246f-4406-8d7e-3592200a9326.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/3e59f31c-246f-4406-8d7e-3592200a9326.png)'
- en: There's more...
  id: totrans-246
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: These methods of obfuscation combined with websites, emails, documents, and
    PDF documents can be extremely tricky for users. Often, they are so quick to click,
    they don't realize they are being taken to the wrong site. If you combine this
    with registering domain names that are close to the target domain, they are very
    often overlooked by the end user.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 这些与网站、电子邮件、文档和 PDF 文件结合的混淆方法可能会极其棘手。用户往往会太快点击链接，以至于没有意识到自己被带到了错误的网站。如果你结合注册与目标域名相近的域名，它们通常会被最终用户忽视。
- en: Take an example of `google.com` being redirected to one of the following--`g00gle.com`,
    `goog1e.com`, and `goog1e.com`. Often these will easily be overlooked by the casual
    user, and you can have lookalike sites.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 以 `google.com` 被重定向到以下之一为例——`g00gle.com`、`goog1e.com` 和 `goog1e.com`。这些常常会被普通用户轻易忽视，你可以拥有类似的网站。
- en: DNS spoofing and ARP spoofing
  id: totrans-249
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DNS 欺骗和 ARP 欺骗
- en: In this recipe, we will discuss how to perform DNS and ARP spoofing. In several
    of our past recipes, we have shown website attacks that utilize an IP address
    for the attack—the IP of the Kali machine. However, in real attacks, this may
    easily be spotted. The whole point of the attack is to make it appear as if they
    are going to the proper site and making it appear as real as possible. The first
    part of this process is to perform DNS spoofing.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个食谱中，我们将讨论如何进行 DNS 和 ARP 欺骗。在我们过去的几个食谱中，我们展示了利用 IP 地址进行的攻击——即 Kali 机器的 IP。然而，在实际攻击中，这种方式很容易被发现。攻击的关键是让它看起来像是用户访问的是正确的网站，并且尽可能真实。这个过程的第一步是进行
    DNS 欺骗。
- en: Getting ready
  id: totrans-251
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 正在准备中
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 正在运行，你已作为 root 用户登录。
- en: Move the interface from one of your Windows test machines to the NAT network
    temporarily
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 暂时将你的 Windows 测试机器的接口切换到 NAT 网络
- en: How to do it...
  id: totrans-255
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now use ARP spoofing to redirect a user to a fake website:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将使用 ARP 欺骗将用户重定向到一个假网站：
- en: Open up a new terminal window by clicking on the following icon. ![](assets/5b013ad1-5008-4955-a38b-c5ca4e566e34.png)
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击以下图标打开一个新的终端窗口。 ![](assets/5b013ad1-5008-4955-a38b-c5ca4e566e34.png)
- en: 'We need to ensure promiscuous mode is on for the interface we are using, and
    we all need to ensure that IP forwarding is turned on. We need to create a host
    file to spoof a particular site or set of sites. As we have used a hiking site
    in several of our testing examples, we will spoof `us-123hiking.simplesite.com`,
    and send it to `10.0.2.4`, which is the IP address of my Kali box on `eth0`. Enter
    the following commands:'
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要确保使用的接口启用了混杂模式，并且需要确保 IP 转发功能已经开启。我们需要创建一个主机文件来欺骗特定的网站或一组网站。因为我们在几个测试示例中使用了一个登山网站，所以我们将欺骗
    `us-123hiking.simplesite.com`，并将其指向 `10.0.2.4`，这是我的 Kali 机器在 `eth0` 上的 IP 地址。请输入以下命令：
- en: '[PRE3]'
  id: totrans-259
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, we have to basically become a man in the middle; we will do this by ARP
    spoofing the router IP address (default gateway) of `10.0.2.1` and ARP spoofing
    the victim IP of our Windows machine `10.0.2.5`. Then, start `dnsspoof` using
    the host file we just created:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们基本上要成为中间人；我们将通过 ARP 欺骗路由器的 IP 地址（默认网关）`10.0.2.1` 和 ARP 欺骗我们的 Windows 机器的受害者
    IP 地址 `10.0.2.5` 来实现。然后，使用我们刚刚创建的主机文件启动 `dnsspoof`：
- en: '[PRE4]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: It may take minutes for the ARP spoofing to take place, so be patient; it may
    help to not start your Windows machine until everything has been set up accordingly.
    Also, you may want to check that all of the interfaces from a VirtualBox perspective
    are in a promiscuous mode.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: ARP 欺骗可能需要几分钟的时间才能完成，所以请耐心等待；在一切准备好之前，最好不要启动你的 Windows 机器。另外，你可能需要检查所有虚拟机的网络接口是否处于混杂模式。
- en: 'Open your Windows test machine, and open a Command Prompt. Enter the following
    commands. You will note that the hiking site will be pointed to our Kali box:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开你的 Windows 测试机器，打开命令提示符。输入以下命令。你会注意到，登山网站将指向我们的 Kali 机器：
- en: '[PRE5]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](assets/f3bbca7c-bfe0-46e4-80a9-c0e97b09291d.png)Windows command ping outputTerminate
    your Kali terminal session, flush the DNS of your Windows machine, and retry the
    test. You should now be going to the real IP address of `us-123.hiking.simplesite.com`.'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/f3bbca7c-bfe0-46e4-80a9-c0e97b09291d.png)Windows 命令 ping 输出终止你的
    Kali 终端会话，清除你 Windows 机器的 DNS 缓存，然后重新测试。你现在应该能够访问到 `us-123.hiking.simplesite.com`
    的真实 IP 地址。'
- en: DHCP spoofing
  id: totrans-266
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP欺骗
- en: In this recipe, you will learn about DHCP spoofing.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个教程中，你将学习关于DHCP欺骗的知识。
- en: DHCP spoofing can be used to route all packets through your Kali box or can
    be used to push your DNS servers to the hosts on the network. This attack actually
    has a lot to do with timing. It's important to note that this attack will not
    always work, as there is the true DHCP server on the network and our DHCP spoofing
    server. The way DHCP works is that the first response received by the victim is
    the one it will use irregardless of how many responses it receives. So, the hope
    is that your response to their request will beat the official DHCP server.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP欺骗可以用来将所有数据包通过你的Kali盒子进行路由，或者可以将你的DNS服务器推送给网络上的主机。这个攻击实际上与时机非常相关。需要注意的是，这个攻击并不总是有效，因为网络上有真实的DHCP服务器和我们的DHCP欺骗服务器。DHCP工作的方式是，受害者收到的第一个响应将是它使用的响应，无论它收到多少个响应。因此，希望的是你的响应能比官方的DHCP服务器更快。
- en: Getting ready
  id: totrans-269
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running and you are logged in as root
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，你已经以root身份登录
- en: Windows system is shut down
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows系统已关闭
- en: How to do it...
  id: totrans-273
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now perform DHCP spoofing on the network:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将在网络上执行DHCP欺骗：
- en: Open up a new terminal window by clicking on the following icon. ![](assets/bb72ead6-52fc-46c7-9b57-1811a54bd079.png)
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击以下图标打开一个新的终端窗口。 ![](assets/bb72ead6-52fc-46c7-9b57-1811a54bd079.png)
- en: 'We need to ensure promiscuous mode is on for the interface we are using, and
    we all need to ensure that IP forwarding is turned on. Then we will start `ettercap`
    in the GUI Mode:'
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要确保我们使用的接口处于混杂模式，并且需要确保IP转发已启用。然后我们将以GUI模式启动`ettercap`：
- en: '[PRE6]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'From the `ettercap` main GUI screen, we want to start sniffing traffic. Click
    on Sniff | Unified sniffing. Then, select the interface we will use. For test
    purposes, we will use our host-only interface of `eth1` and click OK:'
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`ettercap`的主GUI界面中，我们想要开始嗅探流量。点击 Sniff | Unified sniffing。然后，选择我们将使用的接口。为了测试目的，我们将使用我们的主机专用接口`eth1`，并点击OK：
- en: '![](assets/c896a365-e75f-4d01-875d-e9b47c765806.png)ettercap main screen'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/c896a365-e75f-4d01-875d-e9b47c765806.png)ettercap主界面'
- en: From here, we will have a new option to select MITM| DHCP spoofing... .
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从这里，我们将有一个新的选项可以选择MITM | DHCP欺骗...
- en: 'Enter an IP pool. In this case, I will use a range on our host-only network
    of `192.168.56.100-192.168.56.110`, a subnet mask of `255.255.255.0`, and the
    DNS server address of `192.168.56.10`, which is the IP address of my Kali VM.
    Click on OK:'
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入一个IP池。在这种情况下，我将使用我们主机专用网络范围中的`192.168.56.100-192.168.56.110`，子网掩码为`255.255.255.0`，DNS服务器地址为`192.168.56.10`，这是我的Kali虚拟机的IP地址。点击OK：
- en: '![](assets/4780af25-ab4d-4d5e-b4e7-4a671a1c9dec.png)ettercap mitm dhcp spoofing
    dialog box'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/4780af25-ab4d-4d5e-b4e7-4a671a1c9dec.png)ettercap mitm dhcp欺骗对话框'
- en: 'Now, start your Windows system, open a Command Prompt, and enter the following.
    Notice the IP address provided is in the range we specified, and you can also
    see in `ettercap` that the response was provided from there:'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，启动你的Windows系统，打开命令提示符，并输入以下内容。注意，提供的IP地址在我们指定的范围内，你也可以在`ettercap`中看到响应是从那里提供的：
- en: '[PRE7]'
  id: totrans-284
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](assets/214201c3-a268-4121-a22d-a2f1d14e93a5.png)Windows ipconfig outputSo
    a couple of things to note. You will notice that the default gateway is not populated.
    This is because we do not have a default gateway on the host-only network. Also,
    since you have no default gateway, you will not forward the traffic off net.'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/214201c3-a268-4121-a22d-a2f1d14e93a5.png)Windows ipconfig输出因此，有几点需要注意。你会注意到默认网关没有被填充。这是因为我们在主机专用网络上没有默认网关。另外，由于没有默认网关，你将无法将流量转发到外部网络。'
- en: There's more...
  id: totrans-286
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: This scenario is much easier to test out using physical machines versus virtual
    machines based on our test environment. If you want to see a better example of
    this, try connecting your Kali machine on a segment with a physical host that
    can talk to the internet.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 基于我们的测试环境，这个场景在使用物理机器时比使用虚拟机更容易测试。如果你想看到更好的示例，可以尝试将你的Kali机器连接到一个可以访问互联网的物理主机所在的网络段。
