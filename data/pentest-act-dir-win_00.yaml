- en: Preface
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 前言
- en: Almost every day we hear about new breaches, data leaks, or ransomware attacks.
    Cybercrime nowadays is a big business that constantly strives for improvement.
    It is no longer a one-man show; cybercriminals have their own methodology, tooling,
    and qualified staff. The way to defend against them is to understand how they
    attack, their tactics, and their techniques.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 几乎每天我们都会听到新的数据泄露、数据外泄或勒索软件攻击的消息。如今，网络犯罪已成为一个庞大的产业，并且不断寻求进步。这不再是一个人的表演；网络犯罪分子有自己的方法论、工具和专业人员。防御的方式是理解他们是如何攻击的、他们的战术以及技术。
- en: We will apply this approach against various products of the most popular software
    vendor – Microsoft. This book is focused purely on Windows-based infrastructure
    because on-premises infrastructure is still a big thing for most companies. In
    this book, I will take you through an attack kill chain against**Active Directory**
    *(***AD***),* Active Directory Certificate Services, Microsoft Exchange Server,
    Microsoft SQL Server, and**System Center Configuration Manager** *(***SCCM***).*
    During the process, you will be introduced to known tactics and techniques with
    a lot of hands-on exercises.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将采用这种方法来对抗最受欢迎的软件供应商——微软的各种产品。本书专注于基于 Windows 的基础设施，因为对于大多数公司而言，企业内部基础设施仍然是一个重要领域。在本书中，我将带领你通过对**Active
    Directory**（*AD*）、Active Directory 证书服务、Microsoft Exchange 服务器、Microsoft SQL 服务器以及**系统中心配置管理器**（*SCCM*）的攻击杀链过程。在这个过程中，你将接触到已知的战术和技术，并进行大量的实践练习。
- en: By the end of the book, you will be able to perform a hands-on comprehensive
    security assessment of Windows-based infrastructure. In addition, you will receive
    recommendations on how to detect adversary activity and remediation suggestions.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 到本书结束时，你将能够对基于 Windows 的基础设施进行全面的实际安全评估。此外，你还将获得关于如何检测对手活动的建议和修复建议。
- en: Who this book is for
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 本书适用人群
- en: This book is truly intended to be an all-in-one guide for security professionals
    who work with Windows-based infrastructure, especially AD. Penetration testers
    and red team operators will find practical attack scenarios that they may encounter
    during real-life assessments. Security and IT engineers, as well as blue teamers
    and incident responders, will benefit from detection and remediation guidelines.
    To get the most out of this book, you should have basic knowledge of Windows services
    and AD.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本书确实是一本全方位的指南，专为从事 Windows 基础设施工作，特别是 AD 的安全专业人员编写。渗透测试人员和红队操作员将找到他们在实际评估中可能遇到的攻击场景。安全和
    IT 工程师、蓝队成员以及事件响应人员将从检测和修复指南中受益。为了最大限度地利用本书，你应该具备 Windows 服务和 AD 的基础知识。
- en: What this book covers
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 本书内容
- en: '[*Chapter 1*](B18964_01.xhtml#_idTextAnchor012), *Getting the Lab Ready and
    Attacking Exchange Server*, provides an overview of the attack kill chain, shows
    you how to deploy the lab environment, and focuses on Exchange Server attack surfaces
    with practical examples.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第1章*](B18964_01.xhtml#_idTextAnchor012)，*准备实验室和攻击 Exchange 服务器*，概述了攻击杀链，展示了如何部署实验室环境，并专注于通过实际示例演示
    Exchange 服务器的攻击面。'
- en: '[*Chapter 2*](B18964_02.xhtml#_idTextAnchor025), *Defense Evasion*, teaches
    you about evading **Antimalware Scan Interface** (**AMSI**) and AppLocker, PowerShell
    enhanced logging, Sysmon, and **Event Tracing for** **Windows** (**ETW**).'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第2章*](B18964_02.xhtml#_idTextAnchor025)，*防御规避*，教授你如何规避**恶意软件扫描接口**（**AMSI**）和
    AppLocker、PowerShell 增强日志记录、Sysmon 以及**Windows 事件跟踪**（**ETW**）。'
- en: '[*Chapter 3*](B18964_03.xhtml#_idTextAnchor040), *Domain Reconnaissance and
    Discovery*, is where you will learn how to perform reconnaissance in a domain,
    blend into environment traffic, and learn more about the internals of tools such
    as BloodHound and Microsoft **Advanced Threat** **Analytics** (**ATA**).'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第3章*](B18964_03.xhtml#_idTextAnchor040)，*域侦察与发现*，在这一章你将学习如何在域中执行侦察、如何融入环境流量，以及深入了解像
    BloodHound 和 Microsoft **高级威胁分析**（**ATA**）等工具的内部工作。'
- en: '[*Chapter 4*](B18964_04.xhtml#_idTextAnchor061), *Credential Access in a Domain*,
    covers ways to obtain credentials in the domain environment by capturing the hash,
    coercing authentication, “roasting” Kerberos, reading clear-text passwords if
    **Local Administrator Password Solution** (**LAPS**) is misconfigured, and collecting
    hashes of gMSA accounts or of a whole domain via DCSync.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第4章*](B18964_04.xhtml#_idTextAnchor061)，*域中的凭证访问*，介绍了通过捕获哈希值、强制认证、对 Kerberos
    进行“烘烤”、如果**本地管理员密码解决方案**（**LAPS**）配置错误时读取明文密码，以及通过 DCSync 收集 gMSA 账户或整个域的哈希值等方式获取域环境中的凭证。'
- en: '[*Chapter 5*](B18964_05.xhtml#_idTextAnchor093), *Lateral Movement in Domain
    and Across Forests*, shows how an adversary can maneuver across an environment
    by abusing different types of delegation, passing different types of credential
    materials, relaying captured hashes, as well as moving to other forests.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第 5 章*](B18964_05.xhtml#_idTextAnchor093)，*域内和跨森林的横向移动*，展示了对手如何通过滥用不同类型的委派、传递不同类型的凭证材料、转发捕获的哈希值以及向其他森林移动来在环境中横向移动。'
- en: '[*Chapter 6*](B18964_06.xhtml#_idTextAnchor119), *Domain Privilege Escalation*,
    is where we will focus on ways to elevate privileges in a domain by abusing misconfigured
    **Access Control Lists** (**ACL**), **Group Policy Objects** (**GPO**), and special
    built-in groups, as well as moving from a child domain to a parent domain.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第 6 章*](B18964_06.xhtml#_idTextAnchor119)，*域权限提升*，我们将重点讨论通过滥用配置错误的**访问控制列表**（**ACL**）、**组策略对象**（**GPO**）和特殊内建组来提升域中的权限，以及如何从子域转移到父域。'
- en: '[*Chapter 7*](B18964_07.xhtml#_idTextAnchor146), *Persistence on Domain Level*,
    shows techniques to establish persistence on the domain level by forging tickets
    and manipulating ACLs and objects, as well as on the domain controller itself
    by adding a Skeleton Key, malicious SSP, a registry backdoor, and so on.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第 7 章*](B18964_07.xhtml#_idTextAnchor146)，*域级持久化*，展示了通过伪造票证和操作 ACL 和对象，以及通过添加骨架密钥、恶意
    SSP、注册表后门等手段，在域控制器上实现持久化的技术。'
- en: '[*Chapter 8*](B18964_08.xhtml#_idTextAnchor163), *Abusing Active Directory
    Certificate Services*, covers the fundamentals of **Public Key Infrastructure**
    (**PKI**) implementation by Microsoft, along with ways to steal certificates,
    escalate privileges in the domain, and achieve persistence on account and domain
    levels.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第 8 章*](B18964_08.xhtml#_idTextAnchor163)，*滥用 Active Directory 证书服务*，涵盖了微软实施的**公钥基础设施**（**PKI**）的基础知识，以及盗取证书、在域中提升权限并实现域级持久化的方法。'
- en: '[*Chapter 9*](B18964_09.xhtml#_idTextAnchor191), *Compromising Microsoft SQL
    Server*, is where we will focus on how to attack SQL Server, including enumeration,
    privilege escalation, lateral movement, and persistence.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第 9 章*](B18964_09.xhtml#_idTextAnchor191)，*攻破 Microsoft SQL Server*，我们将重点讨论如何攻击
    SQL Server，包括枚举、权限提升、横向移动和持久化。'
- en: '[*Chapter 10*](B18964_10.xhtml#_idTextAnchor222), *Taking over WSUS and SCCM*,
    provides an overview of IT support management software and ways to abuse its functionality,
    leading to a complete takeover of the whole environment.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '[*第 10 章*](B18964_10.xhtml#_idTextAnchor222)，*接管 WSUS 和 SCCM*，提供了 IT 支持管理软件的概述，并介绍了滥用其功能的方法，最终实现对整个环境的完全接管。'
- en: To get the most out of this book
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为了充分利用本书
- en: '| **Software/hardware covered in** **the book** | **Operating** **system requirements**
    |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| **书中涵盖的** **软件/硬件** | **操作系统** **要求** |'
- en: '| Windows Active Directory | Linux host |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| Windows Active Directory | Linux 主机 |'
- en: '| Windows Services – WSUS and AD CS | Kali virtual machine |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| Windows 服务 – WSUS 和 AD CS | Kali 虚拟机 |'
- en: '| Exchange Server |  |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| Exchange 服务器 |  |'
- en: '| SQL Server |  |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| SQL Server |  |'
- en: '| SCCM |  |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| SCCM |  |'
- en: Conventions used
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用的约定
- en: There are a number of text conventions used throughout this book.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中使用了若干文本约定。
- en: '**Code in text**: Indicates code words in text, database table names, folder
    names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter
    handles. Here is an example: “**MailSniper** calculates the time difference between
    authentication attempt responses.”'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '**文本中的代码**：表示文本中的代码词、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名。以下是一个示例：“**MailSniper**
    计算身份验证尝试响应之间的时间差。”'
- en: 'Any command-line input or output is written as follows:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 任何命令行输入或输出如下所示：
- en: '[PRE0]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**Bold**: Indicates a new term, an important word, or words that you see on
    screen. For instance, words in menus or dialog boxes appear in **bold**. Here
    is an example: “We will cover attack detection and possible prevention measures,
    as well as offensive **Operational** **Security** (**OpSec**).”'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '**粗体**：表示新术语、重要词汇或您在屏幕上看到的词。例如，菜单或对话框中的词语通常以**粗体**显示。以下是一个示例：“我们将讨论攻击检测及可能的防范措施，并介绍进攻性**操作**
    **安全**（**OpSec**）。”'
- en: Tips or important notes
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 提示或重要注意事项
- en: Appear like this.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 显示如下。
- en: Get in touch
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 联系我们
- en: Feedback from our readers is always welcome.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们始终欢迎读者的反馈。
- en: '**General feedback**: If you have questions about any aspect of this book,
    email us at [customercare@packtpub.com](mailto:customercare@packtpub.com) and
    mention the book title in the subject of your message.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**一般反馈**：如果你对本书的任何部分有疑问，请通过邮件联系我们，邮箱地址是[customercare@packtpub.com](mailto:customercare@packtpub.com)，并在邮件主题中提到书名。'
- en: '**Errata**: Although we have taken every care to ensure the accuracy of our
    content, mistakes do happen. If you have found a mistake in this book, we would
    be grateful if you would report this to us. Please visit [www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)
    and fill in the form.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**勘误表**：尽管我们已尽最大努力确保内容的准确性，但难免会有错误。如果你在本书中发现任何错误，我们将非常感激你向我们报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表单。'
- en: '**Piracy**: If you come across any illegal copies of our works in any form
    on the internet, we would be grateful if you would provide us with the location
    address or website name. Please contact us at [copyright@packtpub.com](mailto:copyright@packtpub.com)
    with a link to the material.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '**盗版**：如果你在互联网上发现我们作品的任何非法副本，请提供其网址或网站名称。请通过[版权@packtpub.com](mailto:copyright@packtpub.com)与我们联系，附上该资料的链接。'
- en: '**If you are interested in becoming an author**: If there is a topic that you
    have expertise in and you are interested in either writing or contributing to
    a book, please visit [authors.packtpub.com](http://authors.packtpub.com).'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**如果你有兴趣成为作者**：如果你在某个领域有专长，并且有兴趣撰写或参与编写一本书，请访问[authors.packtpub.com](http://authors.packtpub.com)。'
- en: Share Your Thoughts
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分享你的想法
- en: Once you’ve read *Pentesting Active Directory and Windows-based Infrastructure*,
    we’d love to hear your thoughts! Please [click here to go straight to the Amazon
    review page](https://packt.link/r/1804611360) for this book and share your feedback.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你阅读了*《渗透测试：Active Directory和基于Windows的基础设施》*，我们非常希望听到你的反馈！请[点击这里直接进入Amazon的评论页面](https://packt.link/r/1804611360)，分享你的看法。
- en: Your review is important to us and the tech community and will help us make
    sure we’re delivering excellent quality content.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 你的评论对我们和技术社区来说都非常重要，将帮助我们确保提供卓越质量的内容。
- en: Download a free PDF copy of this book
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 下载本书的免费PDF副本
- en: Thanks for purchasing this book!
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 感谢购买本书！
- en: Do you like to read on the go but are unable to carry your print books everywhere?
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 你喜欢在旅途中阅读，但又不能随时携带纸质书籍吗？
- en: Is your eBook purchase not compatible with the device of your choice?
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 你的电子书购买是否与你选择的设备不兼容？
- en: Don’t worry, now with every Packt book you get a DRM-free PDF version of that
    book at no cost.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 不用担心，现在购买每本Packt书籍，你都会免费获得该书的无DRM PDF版本。
- en: Read anywhere, any place, on any device. Search, copy, and paste code from your
    favorite technical books directly into your application.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 随时随地、在任何设备上阅读。直接从你最喜欢的技术书籍中搜索、复制并粘贴代码到你的应用程序中。
- en: The perks don’t stop there, you can get exclusive access to discounts, newsletters,
    and great free content in your inbox daily
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 优惠活动不仅仅是这样，你还可以获得独家折扣、时事通讯以及每天送到邮箱的精彩免费内容
- en: 'Follow these simple steps to get the benefits:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下简单步骤，享受相关福利：
- en: Scan the QR code or visit the link below
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 扫描二维码或访问以下链接
- en: '![](image/B18964_QR_Free_PDF.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](image/B18964_QR_Free_PDF.jpg)'
- en: '[https://packt.link/free-ebook/9781804611364](https://packt.link/free-ebook/9781804611364)'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/free-ebook/9781804611364](https://packt.link/free-ebook/9781804611364)'
- en: Submit your proof of purchase
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提交你的购买证明
- en: That’s it! We’ll send your free PDF and other benefits to your email directly
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 就是这样！我们会直接将你的免费PDF和其他福利发送到你的邮箱。
