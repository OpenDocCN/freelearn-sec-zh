- en: '1'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '1'
- en: Setting Up AWS Accounts and Organization
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 AWS 账户和组织
- en: An application or platform’s security is often characterized by features such
    as confidentiality, integrity, availability, authentication, authorization, accounting,
    and non-repudiation. These features are grouped into the **Confidentiality, Integrity,
    and Availability** ( **CIA** ) triad and the **Authentication, Authorization,
    and Accounting** ( **AAA** ) triad. A solid grasp of these security features will
    facilitate better understanding and implementation of the AWS security concepts
    detailed in this book.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序或平台的安全性通常由保密性、完整性、可用性、身份验证、授权、审计和不可否认性等特性来定义。这些特性被分为 **保密性、完整性和可用性**（**CIA**）三元组和
    **身份验证、授权和审计**（**AAA**）三元组。对这些安全特性有深入的理解将有助于我们更好地理解和实施本书中详细介绍的 AWS 安全概念。
- en: In this chapter, we will first learn about setting up the **Identity and Access
    Management** ( **IAM** ) service for a new AWS account along with **account aliases**
    and **billing alerts** . Then, we will learn to set up the **AWS Organizations**
    service that allows us to create and manage multiple AWS accounts from within
    a single **management account** . We will also learn about user management and
    **Single Sign-On** ( **SSO** ) using **AWS IAM Identity Center** (formerly known
    as AWS SSO), which centralizes identity creation and access management across
    AWS accounts and apps and is recommended for organizations of all sizes and types.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将首先了解如何为新的 AWS 账户设置 **身份与访问管理**（**IAM**）服务，并设置 **账户别名** 和 **账单警报**。然后，我们将学习如何设置
    **AWS 组织** 服务，该服务允许我们通过一个 **管理账户** 创建和管理多个 AWS 账户。我们还将了解用户管理和使用 **AWS IAM 身份中心**（前身为
    AWS SSO）的 **单点登录**（**SSO**），该服务集中管理 AWS 账户和应用程序中的身份创建与访问管理，适用于各种规模和类型的组织。
- en: This chapter is slightly longer than the rest of the chapters in this book since
    it sets the stage for other chapters. We could skip the second and third recipes
    within this chapter regarding setting up AWS Organizations and IAM Identity Center
    and execute most of the recipes in other chapters on a standalone AWS account.
    However, if our goal is to work in an enterprise environment, it would be good
    to complete all the recipes within this chapter before proceeding with the rest
    of the book.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章内容略长于本书其他章节，因为它为后续章节奠定了基础。我们可以跳过本章中关于设置 AWS 组织和 IAM 身份中心的第二和第三个食谱，并在其他章节中独立执行大部分食谱。但如果我们的目标是在企业环境中工作，那么在继续阅读本书的其他部分之前，最好完成本章中的所有食谱。
- en: 'This chapter includes the following recipes:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包括以下食谱：
- en: Setting up IAM, account aliases, and billing alerts
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 IAM、账户别名和账单警报
- en: Multi-account management with AWS Organizations
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 AWS 组织进行多账户管理
- en: User management and SSO with IAM Identity Center
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户管理和使用 IAM 身份中心进行 SSO
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'Before diving into the recipes of this chapter, we need to ensure we have the
    following knowledge and requirements in place:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入本章的食谱之前，我们需要确保具备以下知识和要求：
- en: '**AWS account** : It is recommended to use a new AWS account for this chapter.
    We can sign up for a free tier account at [https://aws.amazon.com](https://aws.amazon.com)
    .'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS 账户**：建议为本章使用一个新的 AWS 账户。我们可以在 [https://aws.amazon.com](https://aws.amazon.com)
    上注册一个免费层账户。'
- en: '**Permissions** : We need to operate as the root user or possess administrative
    permissions to configure IAM, AWS Organizations, and IAM Identity Center.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**权限**：我们需要以根用户身份操作，或者拥有管理员权限，才能配置 IAM、AWS 组织和 IAM 身份中心。'
- en: '**Familiarity with AWS** : A working knowledge of the AWS Management Console
    and AWS services such as IAM and S3 will benefit us.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**熟悉 AWS**：对 AWS 管理控制台以及 IAM 和 S3 等 AWS 服务有一定了解将对我们有帮助。'
- en: '**Internet connection** : Due to AWS’s cloud-based nature, a stable internet
    connection is essential for accessing and managing AWS services.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**互联网连接**：由于 AWS 是基于云的，因此稳定的互联网连接对于访问和管理 AWS 服务至关重要。'
- en: '**AWS Command Line Interface** ( **CLI** ): To execute AWS CLI commands, we
    need AWS CLI V2. Two recommended methods for working with AWS CLI V2 are using
    the AWS IAM Identity Center to set it up on a local or virtual machine or using
    **AWS CloudShell** . We will learn how to set up AWS CLI V2 using IAM Identity
    Center in the *User management and SSO with IAM Identity* *Center* recipe.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS 命令行接口**（**CLI**）：要执行 AWS CLI 命令，我们需要 AWS CLI V2。两种推荐的使用 AWS CLI V2 的方法是通过
    AWS IAM 身份中心在本地或虚拟机上进行设置，或使用**AWS CloudShell**。我们将在*使用 IAM 身份中心进行用户管理和 SSO*教程中学习如何使用
    IAM 身份中心设置 AWS CLI V2。'
- en: Important note
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: We can also configure the AWS CLI using the traditional access keys. However,
    both IAM Identity Center and CloudShell utilize short-term credentials that are
    session-based, thus reducing the risks associated with the traditional long-lived
    access keys. AWS CloudShell offers the added convenience of a browser-based shell
    integrated directly into the AWS Management Console, facilitating on-the-fly operations
    without the need for local setup. However, CloudShell may not be available in
    all regions.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以使用传统的访问密钥来配置 AWS CLI。然而，IAM 身份中心和 CloudShell 都使用基于会话的短期凭证，从而减少了与传统长期访问密钥相关的风险。AWS
    CloudShell 提供了浏览器集成的 shell，直接嵌入 AWS 管理控制台，便于随时进行操作，无需本地设置。然而，CloudShell 可能并非在所有区域都可用。
- en: The code files for this book are available at [https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition](https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition)
    . The code files for this chapter are available at [https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter01](https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter01)
    .
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的代码文件可在 [https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition](https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition)
    获取。本章的代码文件可在 [https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter01](https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter01)
    获取。
- en: Setting up IAM, account aliases, and billing alerts
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 IAM、账户别名和计费警报
- en: IAM is the primary service in AWS that is used to manage access to AWS resources.
    After setting up an AWS account, it is recommended to perform some basic IAM configurations
    to enhance the security of our account such as securing the **root account** with
    **multi-factor authentication (MFA)** . MFA is a security mechanism that requires
    users to provide two or more verification factors to gain access to a resource,
    such as a username and password, and a code sent to a phone. IAM offers a checklist
    to guide these initial activities.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: IAM 是 AWS 中用于管理访问 AWS 资源的主要服务。设置 AWS 账户后，建议进行一些基本的 IAM 配置，以增强账户的安全性，例如使用**多重身份验证（MFA）**保护**根账户**。MFA
    是一种安全机制，要求用户提供两个或更多的验证因素才能访问资源，如用户名和密码，以及发送到手机的验证码。IAM 提供了一个检查清单来指导这些初步活动。
- en: While not part of the AWS checklist, it is also recommended to set up an account
    alias and create a billing alarm in a new account. An account alias is a unique
    identifier that we can create for our AWS account instead of the default 12-digit
    account ID in our account’s sign-in URL. Creating an account alias enhances the
    user experience by providing a personalized and memorable sign-in URL, increases
    security by obscuring the actual account number, and allows for branding consistency
    by incorporating our organization’s name into the AWS login process.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然不在 AWS 检查清单中，但建议在新账户中设置账户别名并创建计费警报。账户别名是我们可以为 AWS 账户创建的一个唯一标识符，用来代替账户登录 URL
    中默认的 12 位账户 ID。创建账户别名通过提供个性化和易记的登录 URL 来提升用户体验，增加安全性，因为它能够隐藏实际的账户号码，同时通过将我们组织的名称纳入
    AWS 登录流程中，增强品牌一致性。
- en: Setting up a billing alarm in a new AWS account offers the key advantage of
    monitoring and managing costs effectively. It alerts us when our account spending
    exceeds a predefined threshold, thus helping to prevent unexpected charges and
    maintain budget control.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在新 AWS 账户中设置计费警报的一个主要优势是能够有效监控和管理成本。当账户支出超过预设的阈值时，它会提醒我们，从而帮助防止意外费用并保持预算控制。
- en: Getting ready
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We need a newly created AWS account to complete all the steps in this recipe.
    If the account is not new, we can verify whether everything has been configured
    correctly by following this recipe and configuring anything that is missing.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要一个新创建的 AWS 账户来完成本教程中的所有步骤。如果账户不是新的，我们可以按照本教程进行验证，检查配置是否正确，并配置缺失的内容。
- en: To set up MFA using a virtual MFA device within this recipe, we need to install
    an authenticator app on our mobile, and **Google Authenticator** is a popular
    authenticator app that we can use. We can also use a **YubiKey Universal 2nd Factor**
    ( **U2F** ) **security key** , any **U2F-compliant device** , or a **hardware
    MFA device** . U2F is an authentication standard for securely accessing online
    services with only a security key and without any drivers or client software.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 要在此方案中使用虚拟 MFA 设备设置 MFA，我们需要在手机上安装认证器应用，**Google Authenticator** 是一个流行的认证器应用，我们可以使用。我们也可以使用**YubiKey
    Universal 2nd Factor** (**U2F**) **安全密钥**，任何**U2F兼容设备**，或**硬件 MFA 设备**。U2F 是一种认证标准，旨在仅通过安全密钥访问在线服务，无需任何驱动程序或客户端软件。
- en: How to do it...
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: First, we will set up IAM for a new AWS account. Then we will set up an account
    alias for a better user experience and a billing alarm to prevent unplanned usage
    and billing.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将为新的 AWS 账户设置 IAM。然后，我们将设置一个账户别名以改善用户体验，并设置账单警报以防止非计划的使用和账单。
- en: Setting up IAM for AWS accounts
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 为 AWS 账户设置 IAM
- en: 'We can set up IAM for a new AWS account as follows:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照以下步骤为新的 AWS 账户设置 IAM：
- en: 'Log in to the AWS account using the root user email credential and follow these
    steps from within the IAM dashboard. For a new AWS account, the IAM dashboard
    should look as follows:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用根用户邮箱凭证登录 AWS 账户，并从 IAM 仪表板内执行以下步骤。对于一个新的 AWS 账户，IAM 仪表板应该如下所示：
- en: '![Figure 1.1 – The IAM dashboard for a new account](image/B21384_01_1.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.1 – 新账户的 IAM 仪表板](image/B21384_01_1.jpg)'
- en: Figure 1.1 – The IAM dashboard for a new account
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.1 – 新账户的 IAM 仪表板
- en: Click on **Add MFA** under **Security recommendations** .
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加 MFA**，位于**安全建议**下。
- en: If you are not redirected to the **Assign MFA** tab, go to the **Assign MFA**
    tab manually.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果没有被重定向到**分配 MFA**标签，请手动转到**分配 MFA**标签。
- en: Enter a meaningful value for the MFA device name that can help us recognize
    the device, then select **Authenticator app** as shown in the following figure.
    If we set up a different option, as discussed in the *Getting ready* section,
    we can select it here instead of the **Authenticator** **app** option.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入一个有意义的 MFA 设备名称，帮助我们识别该设备，然后选择**认证器应用**，如以下图所示。如果我们设置了不同的选项，如*准备工作*部分所讨论的那样，我们可以在此处选择该选项，而不是**认证器应用**选项。
- en: '![Figure 1.2 – Selecting an MFA device](image/B21384_01_2.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.2 – 选择 MFA 设备](image/B21384_01_2.jpg)'
- en: Figure 1.2 – Selecting an MFA device
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.2 – 选择 MFA 设备
- en: Scroll down and click **Next** . AWS will now provide a QR code.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动并点击**下一步**。AWS 现在将提供一个二维码。
- en: Important note
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: We can save the QR code image in a secure place if we ever want to reconfigure
    the authenticator app without accessing the current authenticator app setup, for
    example, if our current mobile stops working. Alternatively, we can contact AWS
    support in case of such an event and they can help us reset the authenticator
    app configuration.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将二维码图像保存在安全的地方，以便在不访问当前认证器应用设置的情况下重新配置认证器应用，例如，如果当前的手机停止工作。或者，我们也可以在发生此类事件时联系
    AWS 支持，他们可以帮助我们重置认证器应用的配置。
- en: Scan the QR code using an authenticator app (e.g., Google Authenticator) installed
    on your mobile device and enter two successful token keys to activate it.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用安装在手机上的认证器应用（例如 Google Authenticator）扫描二维码，并输入两个成功的令牌密钥以激活它。
- en: After MFA has been activated, we will need to provide a token from this app,
    along with a username and password, to log in to the AWS console.
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 启用 MFA 后，我们需要提供来自此应用的令牌，以及用户名和密码，才能登录 AWS 控制台。
- en: Go back to the IAM dashboard and ensure that all the checkmarks within the security
    recommendations we saw in *Figure 1* *.1* are green now.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回 IAM 仪表板，确保我们在*图 1.1*中看到的安全建议中的所有勾选项现在都是绿色的。
- en: '![Figure 1.3 – Security recommendations on the IAM dashboard](image/B21384_01_3.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.3 – IAM 仪表板上的安全建议](image/B21384_01_3.jpg)'
- en: Figure 1.3 – Security recommendations on the IAM dashboard
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.3 – IAM 仪表板上的安全建议
- en: Once all security recommendations are green, indicating compliance, AWS may
    not display these recommendations again.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦所有安全建议都变为绿色，表示符合要求，AWS 可能不会再显示这些建议。
- en: Next, we will set up an account alias and billing alerts. It is recommended
    to do this on a new AWS account even if these things are not part of the security
    recommendations.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将设置账户别名和账单警报。即使这些内容不在安全建议中，也建议在新 AWS 账户上进行此操作。
- en: Setting up an account alias
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置账户别名
- en: 'We can configure an account alias within the IAM dashboard as follows:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在IAM仪表板中按如下方式配置账户别名：
- en: Within the IAM page, under **Account Alias** , click **Create** to open the
    **Create alias** pop-up page.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在IAM页面中，在**账户别名**下，点击**创建**以打开**创建别名**弹出页面。
- en: '![Figure 1.4 – The AWS account details](image/B21384_01_4.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![图1.4 – AWS账户详情](image/B21384_01_4.jpg)'
- en: Figure 1.4 – The AWS account details
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.4 – AWS账户详情
- en: In the **Create alias** pop-up page, type in a unique and meaningful alias for
    our account under **Preferred alias** and click on **Create alias** .
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**创建别名**弹出页面中，在**首选别名**下输入一个独特且有意义的别名，并点击**创建别名**。
- en: This will create an account alias for our account. The account alias will replace
    the account ID from the URL under **Sign-in URL for IAM users in this account**
    as shown in *Figure 1* *.4* and make it easier for our IAM users to remember the
    sign-in URL. Please note that IAM users will still be able to log in using the
    default sign-in URL with the account ID that we saw in *Figure 1* *.4* .
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将为我们的账户创建一个账户别名。账户别名将替换**此账户中IAM用户的登录URL**中的账户ID，如*图1.4*所示，并使我们的IAM用户更容易记住登录URL。请注意，IAM用户仍然可以使用默认登录URL和我们在*图1.4*中看到的账户ID进行登录。
- en: Now, let us also create a billing alarm.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们也来创建一个计费警报。
- en: Creating a billing alarm
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建计费警报
- en: 'In this section, we will set up a billing alarm to let us know when we exceed
    a set limit:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将设置一个计费警报，以便在超出设定的限制时通知我们：
- en: Log in to the AWS management console and from the drop-down menu next to the
    account name in the upper-right corner of the screen, click on **Billing and**
    **Cost Management** .
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到AWS管理控制台，点击屏幕右上角账户名称旁边的下拉菜单，选择**计费和成本管理**。
- en: '![Figure 1.5 – The account drop-down menu](image/B21384_01_5.jpg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![图1.5 – 账户下拉菜单](image/B21384_01_5.jpg)'
- en: Figure 1.5 – The account drop-down menu
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.5 – 账户下拉菜单
- en: On the page for **Billing and Cost Management home** , click on **Billing preferences**
    from the left sidebar.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**计费和成本管理主页**页面，点击左侧边栏中的**计费偏好设置**。
- en: Click on **Edit** within the **Alert** **preferences** pane.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**编辑**，在**警报偏好设置**窗格中。
- en: On the **Alert Preferences** page, select the **Receive CloudWatch billing alerts**
    checkbox. If you are using a free tier account, you can also select **Receive
    AWS Free Tier alerts** , and optionally give an additional email address to receive
    alerts in the **Additional email address to receive alerts – optional** textbox.
    Click **Update** to save your preferences.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**警报偏好设置**页面，勾选**接收CloudWatch计费警报**复选框。如果你正在使用免费的层级账户，你还可以勾选**接收AWS免费层警报**，并在**接收警报的附加电子邮件地址
    - 可选**文本框中提供一个附加的电子邮件地址来接收警报。点击**更新**以保存你的偏好设置。
- en: Go to the CloudWatch service dashboard, set the region to **US East (N. Virginia)**
    , expand **Alarms** on the left, and click on **All alarms** . At the time of
    writing this book, AWS only allows us to create a billing alarm if our region
    is set to **US East (N. Virginia)** . We will learn more about the CloudWatch
    service in a later chapter of this book.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入CloudWatch服务仪表板，将区域设置为**美国东部（北弗吉尼亚）**，在左侧展开**警报**，点击**所有警报**。在本书写作时，AWS仅允许我们在将区域设置为**美国东部（北弗吉尼亚）**时创建计费警报。我们将在本书后面的章节中进一步了解CloudWatch服务。
- en: Click on **Create alarm** , and on the **Create alarm** page, click on **Select
    metric** .
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建警报**，在**创建警报**页面，点击**选择指标**。
- en: In the **Browse** tab, click **Billing** , and then click **Total** **Estimated
    Charge** .
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**浏览**标签中，点击**计费**，然后点击**总估计费用**。
- en: Select the checkbox for the **EstimatedCharges** metric as shown in the following
    figure, and then click **Select metric** .
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**EstimatedCharges**指标的复选框，如下图所示，然后点击**选择指标**。
- en: '![Figure 1.6 – Configuring metrics](image/B21384_01_6.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![图1.6 – 配置指标](image/B21384_01_6.jpg)'
- en: Figure 1.6 – Configuring metrics
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.6 – 配置指标
- en: Leave the value for **Metric name** as **EstimatedCharges** and **Currency**
    as **USD** . For **Statistic** , choose **Maximum** , and for **Period** , choose
    **6 hours** .
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保持**指标名称**为**EstimatedCharges**，**货币**为**美元（USD）**。对于**统计**，选择**最大值**，对于**周期**，选择**6小时**。
- en: Under **Conditions** , for **Threshold type** , choose **Static** , for **Whenever
    EstimatedCharges is . . .** , choose **Greater** , and for **than...** , define
    the value for triggering the alarm. Also, expand **Additional configuration**
    . For **Datapoints to alarm** , specify **1** **out of** **1** , and for **Missing
    data treatment** , select **Treat missing data** **as missing** .
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**条件**下，选择**阈值类型**为**静态**，在**每当 EstimatedCharges 为...**中选择**大于**，并在**比...大**中定义触发报警的值。还可以展开**其他配置**。在**报警的数据点**中，指定**1**
    **中的** **1**，并在**缺失数据处理**中选择**将缺失数据** **视为缺失**。
- en: '![Figure 1.7 – Configuring the conditions for the metric - Conditions](image/B21384_01_7.jpg)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.7 – 配置指标的条件 - 条件](image/B21384_01_7.jpg)'
- en: Figure 1.7 – Configuring the conditions for the metric - Conditions
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.7 – 配置指标的条件 - 条件
- en: Click **Next** to go to the **Notification** page. In the **Notification** page,
    select **In alarm** , then select **Create new topic** , provide a name for the
    topic and an email to receive communications as shown in the following figure,
    and click **Create topic** .
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**进入**通知**页面。在**通知**页面中，选择**报警**，然后选择**创建新主题**，为主题提供一个名称和一个接收通知的电子邮件地址，如下图所示，然后点击**创建主题**。
- en: '![Figure 1.8 – Configuring notifications for the metric - Notification](image/B21384_01_8.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.8 – 配置指标的通知 - 通知](image/B21384_01_8.jpg)'
- en: Figure 1.8 – Configuring notifications for the metric - Notification
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.8 – 配置指标的通知 - 通知
- en: We created a new **Simple Notification Service** ( **SNS** ) topic to send emails.
    We may also select an existing SNS topic instead of creating a new one.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们创建了一个新的**简单通知服务**（**SNS**）主题来发送电子邮件。我们也可以选择一个现有的 SNS 主题，而不是创建一个新的。
- en: Click **Next** , and under **Name and description** , enter a name for the alarm.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**，在**名称和描述**下，输入报警的名称。
- en: Click **Next** to proceed to the **Preview and create** page. Click **Create
    alarm** . The alarm should now be created successfully.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**进入**预览和创建**页面。点击**创建报警**。报警应该已经成功创建。
- en: Please note that Amazon SNS doesn’t send messages to an endpoint until the subscription
    to the topic is confirmed.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，Amazon SNS 在订阅主题确认之前不会向端点发送消息。
- en: How it works...
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: 'IAM is the AWS service that helps us manage and verify the identity of users
    within AWS (authentication) and verify their permissions to AWS services (authorization).
    IAM is a global service and not tied to a region. IAM has four core concepts:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: IAM 是 AWS 服务，帮助我们管理和验证 AWS 内用户的身份（认证）并验证其对 AWS 服务的权限（授权）。IAM 是一个全球服务，与区域无关。IAM
    有四个核心概念：
- en: '**Users** : A user can be created in IAM and given the necessary permissions
    to access AWS resources.'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户**：可以在 IAM 中创建用户并赋予其访问 AWS 资源所需的权限。'
- en: '**Groups** : Users can be added to groups. Permission can then be given to
    groups instead of individual users. This is a recommended best practice.'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组**：用户可以被添加到组中，然后可以将权限授予组，而不是单独的用户。这是推荐的最佳实践。'
- en: '**Policies** : Policies are JSON documents that define the permissions for
    users or groups.'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**策略**：策略是 JSON 文档，用于定义用户或组的权限。'
- en: '**Roles** : Roles are generally used for giving users temporary permissions
    to access an AWS service. For example, we can attach a role with S3 permissions
    to an EC2 service. Roles are also used for switching roles, as we will see in
    [*Chapter 2*](B21384_02.xhtml#_idTextAnchor043) .'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**角色**：角色通常用于赋予用户临时权限访问 AWS 服务。例如，我们可以将具有 S3 权限的角色附加到 EC2 服务。角色也用于角色切换，正如我们在[*第
    2 章*](B21384_02.xhtml#_idTextAnchor043)中看到的那样。'
- en: The root user account is the account that we log in to using the primary email.
    It has access to everything in our account. The IAM dashboard provides a set of
    checklist items to keep our root account secure. The first item in the IAM checklist
    checks whether we have enabled MFA for our root account. MFA will enforce an additional
    level of authentication, apart from the username and password, using tokens from
    a virtual or hardware MFA device.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 根用户账户是我们使用主电子邮件登录的账户。它对我们账户中的所有内容都有访问权限。IAM 仪表板提供了一组检查项，以确保我们的根账户安全。IAM 检查表中的第一项检查我们是否为根账户启用了
    MFA。MFA 将强制执行额外的身份验证层，除了用户名和密码，还需要使用虚拟或硬件 MFA 设备的令牌。
- en: The second item in the checklist checks whether we have active access keys for
    our root account that can be used for programmatic access. It is good practice
    to use the root for creating other accounts and making necessary configurations,
    and then use those accounts for our day-to-day activities. As we will see in further
    recipes within this chapter, we can use the IAM Identity Center along with the
    AWS Organizations service to better manage user identities across AWS accounts
    in an organization.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 清单中的第二项检查我们是否有可用于程序访问的根账户活动访问密钥。最佳实践是使用根账户创建其他账户并进行必要的配置，然后使用这些账户进行日常活动。正如我们在本章的进一步食谱中将看到的，我们可以结合使用IAM身份中心和AWS
    Organizations服务，以便更好地管理组织中AWS账户的用户身份。
- en: We also set up an account alias and a billing alarm even though they were not
    part of the IAM security recommendations checklist. As we saw in the recipe introduction,
    creating an AWS account alias enhances the user experience, increases security,
    and allows for branding consistency. A billing alarm will trigger an alarm and
    let us know when we exceed the set limit. It is a good practice to always set
    a billing alarm to avoid accidental usage and unplanned expenses.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管账户别名和账单报警不在IAM安全推荐清单中，我们仍然设置了它们。正如在食谱介绍中所看到的，创建AWS账户别名可以提升用户体验、增加安全性，并确保品牌一致性。账单报警将在我们超过设定的限制时触发警报，并提醒我们。这是一个良好的做法，能够避免意外使用和未计划的开销。
- en: There’s more...
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'Let us also quickly go through some important concepts related to IAM and security:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速回顾一些与IAM和安全相关的重要概念：
- en: '**Authentication** is the process of verifying a user’s identity with a username
    and password, or credentials such as the access key and the secret access key.
    There are primarily two types of access credentials in AWS for authenticating
    users:'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**身份验证**是通过用户名和密码，或访问密钥与秘密访问密钥等凭证来验证用户身份的过程。AWS中用于身份验证的主要访问凭证有两种：'
- en: '**Access key ID and secret access key** : These are used for programmatic access,
    and are used with AWS APIs, CLI, SDK, and any development tools.'
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**访问密钥ID和秘密访问密钥**：这些用于程序化访问，并与AWS API、CLI、SDK及任何开发工具一起使用。'
- en: '**Username and password** : These are used for managing console access.'
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户名和密码**：这些用于管理控制台访问。'
- en: '**Authorization** is the process of checking whether a user has the right permissions
    to perform an action and is usually defined using policies. We will learn more
    about IAM policies in [*Chapter 2*](B21384_02.xhtml#_idTextAnchor043) .'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**授权**是检查用户是否具有执行某项操作的权限的过程，通常通过策略来定义。我们将在[*第2章*](B21384_02.xhtml#_idTextAnchor043)中详细了解IAM策略。'
- en: '**Confidentiality** is making sure that the data that’s sent from the source
    is not read by anyone else during transit. This can be made possible using cryptography.'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**机密性**确保从源发送的数据在传输过程中不被其他人读取。这可以通过加密技术来实现。'
- en: '**Data integrity** is making sure the data has come from the right person and
    has not been tampered in between. This is possible using cryptography.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据完整性**确保数据来自正确的人，并且在传输过程中未被篡改。这可以通过加密技术来实现。'
- en: '**Availability** makes sure that the service can be used when it is needed.'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可用性**确保在需要时服务可以正常使用。'
- en: '**Accounting** helps us identify the responsible parties in case of a security
    event.'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**会计**帮助我们在发生安全事件时识别责任方。'
- en: '**Non-repudiation** prevents a user from denying an activity. Cryptography
    comes to our aid here as well.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不可否认性**防止用户否认某项活动。加密技术在这里也能帮助我们。'
- en: The **AWS shared responsibility model** defines the responsibilities of AWS
    and its customers in securing our solutions in the AWS cloud. AWS is responsible
    for the security of the cloud, which involves safeguarding the infrastructure
    that powers all services provided in the AWS cloud. This includes the hardware,
    software, networking, and facilities that operate AWS cloud services. On the other
    hand, customers are accountable for security in the cloud. This responsibility
    encompasses the management of workloads deployed in the cloud, the guest operating
    systems used, and the configurations of network, host, IAM, and storage resources
    for data management and business communication. It also involves the regular updating
    and patching of software on cloud resources based on the cloud abstraction (e.g.,
    infrastructure as a service) used.
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS共享责任模型**定义了AWS和其客户在AWS云中保护解决方案的责任。AWS负责云的安全性，包括保护支撑所有AWS云服务的基础设施。这包括硬件、软件、网络和设施，确保AWS云服务的正常运行。另一方面，客户负责云中的安全性。这项责任包括管理在云中部署的工作负载、使用的客户操作系统，以及网络、主机、IAM和存储资源的配置，以便进行数据管理和业务沟通。还包括根据所使用的云抽象（例如基础设施即服务）定期更新和修补云资源上的软件。'
- en: Third-party auditors evaluate AWS IAM regularly for its compliance with a range
    of standards, including the **Service Organization Control** ( **SOC** ), **Payment
    Card Industry Data Security Standard** ( **PCI DSS** ), **Federal Risk and Authorization
    Management Program** ( **FedRAMP** ), and **International Organization for Standardization**
    ( **ISO** ), among other standards.
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第三方审计人员定期评估AWS IAM是否符合一系列标准，包括**服务组织控制**（**SOC**）、**支付卡行业数据安全标准**（**PCI DSS**）、**联邦风险与授权管理程序**（**FedRAMP**）和**国际标准化组织**（**ISO**）等标准。
- en: More about IAM users and groups
  id: totrans-103
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更多关于IAM用户和用户组的信息
- en: In this recipe, we did not create IAM users or user groups because it is now
    recommended to use IAM Identity Center users instead of IAM users. However, if
    needed, we can create users and user groups from the left sidebar of the IAM dashboard.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们没有创建IAM用户或用户组，因为现在推荐使用IAM身份中心用户，而不是IAM用户。但是，如果需要，我们可以从IAM仪表板的左侧边栏创建用户和用户组。
- en: 'The primary concern with IAM users is that they are associated with long-term
    credentials such as access keys, which can pose security risks if they are not
    managed properly. Here are some common use cases for AWS access keys as per AWS,
    along with recommendations for safer alternatives:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: IAM用户的主要问题在于它们与长期凭证（如访问密钥）关联，如果没有正确管理，这可能会带来安全风险。以下是根据AWS提供的常见AWS访问密钥使用场景，以及更安全的替代方案推荐：
- en: '| **Alternative** | **Use case** | **Recommendations** |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| **替代方案** | **使用案例** | **推荐** |'
- en: '| **CLI** | Accessing the AWS account via the AWS CLI. | In this case do the
    following:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '| **CLI** | 通过AWS CLI访问AWS账户。 | 在这种情况下，按照以下步骤操作：'
- en: Use **AWS CloudShell** , a browser-integrated CLI, for executing commands.
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**AWS CloudShell**，这是一种集成在浏览器中的命令行界面（CLI），用于执行命令。
- en: Opt for the AWS CLI V2 and set up authentication via a user in the **IAM Identity
    Center** ; we will delve into the IAM Identity Center later in this.
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择AWS CLI V2并通过**IAM身份中心**中的用户设置身份验证；我们将在后续详细探讨IAM身份中心。
- en: '|'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| **Local code** | Accessing the AWS account from local development environments.
    | Employ an **Integrated Development Environment** ( **IDE** ) equipped with the
    AWS Toolkit, which facilitates authentication through the IAM Identity Center.
    |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| **本地代码** | 从本地开发环境访问AWS账户。 | 使用配备AWS工具包的**集成开发环境**（**IDE**），它通过IAM身份中心促进身份验证。
    |'
- en: '| **Application running on an AWS compute** **service** | Managing application
    code on AWS compute services such as Amazon EC2, Amazon ECS, or AWS Lambda. |
    Assign an IAM role to compute resources such as EC2 instances or Lambda functions,
    ensuring the automatic provision of temporary credentials for access. |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| **在AWS计算** **服务** 上运行的应用 | 在AWS计算服务（如Amazon EC2、Amazon ECS或AWS Lambda）上管理应用代码。
    | 为计算资源（如EC2实例或Lambda函数）分配IAM角色，确保为访问自动提供临时凭证。 |'
- en: '| **Third-party** **Service** | This is used for enabling third-party applications
    or services that oversee or interact with AWS resources. | As a standard, opt
    for temporary security credentials through IAM roles, avoiding the creation of
    enduring credentials such as access keys. Refrain from generating AWS account
    root user access keys. |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| **第三方服务** | 用于启用管理或与AWS资源交互的第三方应用程序或服务。 | 作为标准，选择通过IAM角色使用临时安全凭证，避免创建长期凭证（如访问密钥）。避免生成AWS账户根用户的访问密钥。
    |'
- en: '| **Applications running** **outside AWS** | Managing application code on AWS
    compute services such as Amazon EC2, Amazon ECS, or AWS Lambda. | While it’s acceptable
    to employ an access key for this use case, ensure that you do the following:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '| **在AWS外运行的应用程序** | 管理AWS计算服务上的应用程序代码，如Amazon EC2、Amazon ECS或AWS Lambda。 |
    尽管在这种用例中使用访问密钥是可以接受的，但请确保执行以下操作：'
- en: Avoid storing access keys in plaintext, within code repositories, or directly
    in code.
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免将访问密钥以明文形式存储在代码库中或直接嵌入代码中。
- en: Deactivate or remove access keys that are redundant.
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 停用或删除冗余的访问密钥。
- en: Implement least-privilege permissions.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施最小权限原则。
- en: Regularly rotate access keys.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定期轮换访问密钥。
- en: '|'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: Table 1.1 – Use cases for AWS access keys as per AWS
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 表1.1 – AWS访问密钥的使用案例（按AWS分类）
- en: The preceding recommendations aim to reduce the potential for security breaches.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 上述建议旨在减少安全漏洞的潜在风险。
- en: See also
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: We can learn more about IAM and its security tools and features such as the
    IAM analyzer, IAM access advisor, and IAM credentials report at [https://www.cloudericks.com/blog/getting-started-with-aws-iam](https://www.cloudericks.com/blog/getting-started-with-aws-iam)
    .
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以在[https://www.cloudericks.com/blog/getting-started-with-aws-iam](https://www.cloudericks.com/blog/getting-started-with-aws-iam)了解更多关于IAM及其安全工具和功能的信息，例如IAM分析器、IAM访问顾问和IAM凭证报告。
- en: We learned about billing alarms in this recipe. We can learn about AWS Budgets
    and understand its differences from billing alarms at [https://www.cloudericks.com/blog/getting-started-with-aws-budgets](https://www.cloudericks.com/blog/getting-started-with-aws-budgets)
    .
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们在本配方中了解了账单警报。我们可以通过[https://www.cloudericks.com/blog/getting-started-with-aws-budgets](https://www.cloudericks.com/blog/getting-started-with-aws-budgets)了解AWS
    Budgets并理解它与账单警报的区别。
- en: We briefly touched on Amazon SNS within this recipe. To learn more about SNS,
    we can refer to [https://www.cloudericks.com/blog/getting-started-with-amazon-sns-service](https://www.cloudericks.com/blog/getting-started-with-amazon-sns-service)
    .
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们在本配方中简要介绍了Amazon SNS。要了解更多关于SNS的信息，可以参考[https://www.cloudericks.com/blog/getting-started-with-amazon-sns-service](https://www.cloudericks.com/blog/getting-started-with-amazon-sns-service)。
- en: This book does not cover AWS basics beyond the security domain. We can read
    about cloud computing and AWS basics at [https://www.cloudericks.com/blog/getting-started-with-aws-cloud](https://www.cloudericks.com/blog/getting-started-with-aws-cloud)
    .
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本书不涉及超出安全领域的AWS基础知识。我们可以在[https://www.cloudericks.com/blog/getting-started-with-aws-cloud](https://www.cloudericks.com/blog/getting-started-with-aws-cloud)了解云计算和AWS基础知识。
- en: Read more about the AWS shared responsibility model at [https://aws.amazon.com/compliance/shared-responsibility-model](https://aws.amazon.com/compliance/shared-responsibility-model)
    .
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[https://aws.amazon.com/compliance/shared-responsibility-model](https://aws.amazon.com/compliance/shared-responsibility-model)阅读更多关于AWS共享责任模型的信息。
- en: Read more about compliance validation for AWS IAM at [https://docs.aws.amazon.com/IAM/latest/UserGuide/iam-compliance-validation.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/iam-compliance-validation.html)
    .
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[https://docs.aws.amazon.com/IAM/latest/UserGuide/iam-compliance-validation.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/iam-compliance-validation.html)阅读更多关于AWS
    IAM的合规性验证。
- en: Multi-account management with AWS Organizations
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用AWS Organizations进行多账户管理
- en: Organizations generally have multiple AWS accounts categorized based on usages
    such as production, development, testing, and so on. The AWS Organizations service
    helps us centrally manage all our AWS accounts, and its **Organizational Units**
    ( **OUs** ) feature helps us maintain the AWS accounts in usage-based hierarchies.
    In this recipe, we will learn how to create AWS Organization and OUs, as well
    as add AWS accounts to OUs. We will create the AWS Organization from the AWS Management
    Console but will create OUs and add accounts both from the Management Console
    and the CLI.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 组织通常有多个基于使用情况（如生产、开发、测试等）分类的AWS账户。AWS Organizations服务帮助我们集中管理所有AWS账户，其**组织单元**（**OU**）功能帮助我们将AWS账户按使用情况分层管理。在本教程中，我们将学习如何创建AWS组织和OU，并将AWS账户添加到OU中。我们将在AWS管理控制台中创建AWS组织，但将从管理控制台和CLI中同时创建OU并添加账户。
- en: Getting ready
  id: totrans-131
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We will need a working AWS account that is not part of an AWS Organization to
    complete all the steps within this recipe.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要一个不属于任何AWS组织的有效AWS账户，才能完成本教程中的所有步骤。
- en: For parts of the recipe where we use CLI commands, we need AWS CLI V2 configured
    as discussed wi thin the *Technical* *requirements* section.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们使用CLI命令的部分，我们需要配置AWS CLI V2，具体方法可参考*技术* *要求*部分。
- en: How to do it...
  id: totrans-134
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: We will first create an AWS Organization and will then create OUs and AWS accounts
    within that AWS Organization.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先创建一个AWS组织，然后在该AWS组织中创建OU和AWS账户。
- en: Creating an AWS organization from the management console
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从管理控制台创建一个AWS组织
- en: 'Let us first create an AWS Organization as follows:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们按如下方式创建一个AWS组织：
- en: Log in to the AWS Management Console as a root user or a user with administrator
    permissions and go to the **AWS Organizations** service dashboard.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以根用户或具有管理员权限的用户身份登录AWS管理控制台，并转到**AWS Organizations**服务控制台。
- en: 'Click on **Create an organization** . It will create an organization and forward
    us to the **AWS accounts** page, which should look like the following:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建组织**。它将创建一个组织，并将我们引导到**AWS账户**页面，该页面应该如下所示：
- en: '![Figure 1.9 – Accounts in AWS Organizations](image/B21384_01_9.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.9 – AWS Organizations中的账户](image/B21384_01_9.jpg)'
- en: Figure 1.9 – Accounts in AWS Organizations
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.9 – AWS Organizations中的账户
- en: 'If we check the left sidebar on the same page, we can see **Organization ID**
    as shown in the following figure:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们检查同一页面上的左侧边栏，我们可以看到**组织ID**，如下图所示：
- en: '![Figure 1.10 – The AWS Organizations sidebar](image/B21384_01_10.jpg)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.10 – AWS Organizations侧边栏](image/B21384_01_10.jpg)'
- en: Figure 1.10 – The AWS Organizations sidebar
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.10 – AWS Organizations侧边栏
- en: Next, we will create an OU under the root OU.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将在根OU下创建一个OU。
- en: Creating an OU and account from the Management Console
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从管理控制台创建OU和账户
- en: 'To create an OU under the root OU, we can proceed with the following steps:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 要在根OU下创建一个OU，我们可以按照以下步骤进行：
- en: Go to the **AWS accounts** page on the **AWS Organizations** service dashboard.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**AWS Organizations**服务控制台页面，转到**AWS账户**页面。
- en: Select the **Root** OU, and from the **Actions** menu, select **Create new**
    under **Organizational unit** .
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**Root** OU，然后在**操作**菜单中，选择**创建新组织单元**。
- en: '![Figure 1.11 – Creating a new organizational unit](image/B21384_01_11.jpg)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.11 – 创建新的组织单元](image/B21384_01_11.jpg)'
- en: Figure 1.11 – Creating a new organizational unit
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.11 – 创建新的组织单元
- en: On the next screen, enter **Sandbox** under **Organizational unit name** and
    click on **Create** **organizational unit.**
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕上，输入**Sandbox**作为**组织单元名称**，然后点击**创建组织单元**。
- en: 'We can now create an AWS account and move it under the **Sandbox** OU as follows:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在可以创建一个AWS账户并将其移动到**Sandbox** OU，如下所示：
- en: Go to the **AWS accounts** page on the **AWS Organizations** service dashboard.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**AWS Organizations**服务控制台页面，转到**AWS账户**页面。
- en: Click on **Add an** **AWS account** .
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**添加AWS账户**。
- en: Select **Create an AWS Account** and provide the **awsseccb-sandbox-1** value
    for **AWS account name** . For **Email address of the account’s owner** , provide
    an email address you have access to. Enter the **OrganizationAccountAccessRole**
    value for **IAM** **role name** .
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**创建AWS账户**，并为**AWS账户名称**提供**awsseccb-sandbox-1**值。对于**账户所有者的电子邮件地址**，提供一个你可以访问的电子邮件地址。为**IAM角色名称**提供**OrganizationAccountAccessRole**值。
- en: '![Figure 1.12 – Adding an account to an organization](image/B21384_01_12.jpg)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.12 – 向组织中添加账户](image/B21384_01_12.jpg)'
- en: Figure 1.12 – Adding an account to an organization
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.12 – 向组织中添加账户
- en: Scroll down and click on **Create** **AWS account** .
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动并点击**创建** **AWS 账户**。
- en: We should immediately see a screen with a message that says **AWS is creating
    1 account** . It could take some time for the account to be created.
  id: totrans-160
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们应该立即看到一个显示**AWS 正在创建 1 个账户**的屏幕。账户创建可能需要一些时间。
- en: Once the account is created, from the **AWS Accounts** page within the Organization,
    select the newly created account. From the **Actions** drop-down menu, select
    **Move** .
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦账户创建完成，在组织中的**AWS 账户**页面中，选择新创建的账户。从**操作**下拉菜单中选择**移动**。
- en: '![Figure 1.13 – Selecting an account and moving between OUs](image/B21384_01_13.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.13 – 选择账户并在 OU 之间移动](image/B21384_01_13.jpg)'
- en: Figure 1.13 – Selecting an account and moving between OUs
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.13 – 选择账户并在 OU 之间移动
- en: Select the desired OU in the **Destination** section and click **Move** **AWS
    account** .
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**目标**部分选择所需的 OU，然后点击**移动** **AWS 账户**。
- en: '![Figure 1.14 – Selecting a destination OU for moving accounts](image/B21384_01_14.jpg)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.14 – 选择目标 OU 以移动账户](image/B21384_01_14.jpg)'
- en: Figure 1.14 – Selecting a destination OU for moving accounts
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.14 – 选择目标 OU 以移动账户
- en: The newly created account should be now part of the selected OU.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 新创建的账户现在应该属于所选的 OU。
- en: Creating an OU and account from the CLI
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从 CLI 创建 OU 和账户
- en: 'In this section, we will create an OU and account from the CLI. Please remember
    to replace my IDs with your own IDs from the relevant previous steps while executing
    the CLI commands. Commands are also provided with the code files. Also, if we
    are executing the commands from the AWS CloudShell, we do not have to specify
    the CLI profile. Let us get started:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将通过 CLI 创建一个 OU 和账户。请记住，在执行 CLI 命令时，要用相关步骤中的 ID 替换我的 ID。命令也会与代码文件一起提供。此外，如果我们从
    AWS CloudShell 执行命令，则无需指定 CLI 配置文件。让我们开始吧：
- en: 'Create an OU called **Workloads** under Root OU using the **create-organizational-unit**
    subcommand using the ID of our Root OU:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**create-organizational-unit**子命令，在根 OU 下创建名为**Workloads**的 OU，使用我们的根 OU 的
    ID：
- en: '[PRE0]'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This should give us a response similar to the following:'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这应该会给我们一个类似于以下内容的响应：
- en: '![Figure 1.15 – The response for the create-organizational-unit subcommand](image/B21384_01_15.jpg)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.15 – create-organizational-unit 子命令的响应](image/B21384_01_15.jpg)'
- en: Figure 1.15 – The response for the create-organizational-unit subcommand
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.15 – create-organizational-unit 子命令的响应
- en: 'We can create an AWS account using the **create-account** subcommand:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用**create-account**子命令创建一个 AWS 账户：
- en: '[PRE1]'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This should give us a response similar to the following:'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这应该会给我们一个类似于以下内容的响应：
- en: '![Figure 1.16 – The response for the create-account subcommand](image/B21384_01_16.jpg)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.16 – create-account 子命令的响应](image/B21384_01_16.jpg)'
- en: Figure 1.16 – The response for the create-account subcommand
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.16 – create-account 子命令的响应
- en: 'We can check the status of our request using the **describe-create-account-status**
    subcommand by providing the request ID we received in the previous step:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用**describe-create-account-status**子命令检查请求的状态，通过提供上一步收到的请求 ID：
- en: '[PRE2]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'If the request succeeds, we should get the following response:'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果请求成功，我们应该会得到以下响应：
- en: '![Figure 1.17 – The response for describe-create-account-status](image/B21384_01_17.jpg)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.17 – describe-create-account-status 的响应](image/B21384_01_17.jpg)'
- en: Figure 1.17 – The response for describe-create-account-status
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.17 – describe-create-account-status 的响应
- en: 'We can verify that the account was created under the root OU and get the root’s
    ID using the **list-parents** subcommand by providing the account ID we received
    in the previous step:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过提供在上一步中收到的账户 ID，使用**list-parents**子命令来验证账户是否在根 OU 下创建，并获取根 OU 的 ID：
- en: '[PRE3]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'This should give us a response similar to the following:'
  id: totrans-187
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这应该会给我们一个类似于以下内容的响应：
- en: '![Figure 1.18 – The response for the list-parents subcommand](image/B21384_01_18.jpg)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.18 – list-parents 子命令的响应](image/B21384_01_18.jpg)'
- en: Figure 1.18 – The response for the list-parents subcommand
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.18 – list-parents 子命令的响应
- en: 'Move our new account from the root OU into the new OU we created earlier from
    CLI by providing the account ID, root ID, and OU ID from the previous steps using
    the **move-account** subcommand:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**move-account**子命令，将我们的新账户从根 OU 移动到之前通过 CLI 创建的新的 OU，提供上一步的账户 ID、根 ID 和 OU
    ID：
- en: '[PRE4]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This command does not return anything.
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 该命令不会返回任何内容。
- en: 'Check the parent for our account using the **list-parents** subcommand, as
    we did in *S* *tep 4* . We should get a response with the new OU as the parent:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**list-parents**子命令检查我们账户的父级，如*S* *tep 4* 中所做的那样。我们应该会得到一个响应，其中新 OU 作为父级：
- en: '![Figure 1.19 – The response to the list-parents subcommand](image/B21384_01_19.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.19 – list-parents 子命令的响应](image/B21384_01_19.jpg)'
- en: Figure 1.19 – The response to the list-parents subcommand
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.19 – list-parents 子命令的响应
- en: 'We can list all the OUs under the root OU using the **list-children** subcommand
    with the child type set to **ORGANIZATIONAL_UNIT** :'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用 **list-children** 子命令列出根 OU 下的所有 OU，并将子类型设置为 **ORGANIZATIONAL_UNIT**：
- en: '[PRE5]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This should give us a response similar to the following if we have a total
    of two OUs, assuming that we created one in the previous recipe:'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果我们总共有两个 OU，假设我们在前面的示例中创建了一个，这应该会给我们类似以下的响应：
- en: '![Figure 1.20 – The response to the list-children subcommand](image/B21384_01_20.jpg)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.20 – list-children 子命令的响应](image/B21384_01_20.jpg)'
- en: Figure 1.20 – The response to the list-children subcommand
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.20 – list-children 子命令的响应
- en: To get the details of the OU, along with its name, we can use the **describe-organizational-unit**
    subcommand with a single parameter named **organizational-unit-id** by passing
    in the ID.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取 OU 的详细信息及其名称，我们可以使用 **describe-organizational-unit** 子命令，传入名为 **organizational-unit-id**
    的单一参数，并传入其 ID。
- en: How it works...
  id: totrans-202
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: From the Management Console, we created an AWS Organization, created OUs under
    it, and added accounts under the OUs. An OU called **Root** was created by default.
    The account used to create the Organization is called the management account (formerly
    known as the **master account** ) and is created under the root OU.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 从管理控制台中，我们创建了一个 AWS 组织，在其下创建了 OU，并将账户添加到这些 OU 下。默认情况下，会创建一个名为 **Root** 的 OU。用于创建组织的账户称为管理账户（以前称为
    **主账户**），并且是在根 OU 下创建的。
- en: We can only initiate the creation of a new organization from an AWS account
    that is not a member of any organization. We cannot make another AWS account into
    a management account later, and hence, the account from which we create an organization
    needs to be selected carefully. We can move an account to any OU, including the
    root OU. We can also create sub-OUs within an OU.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只能从一个未加入任何组织的 AWS 账户启动创建新组织的操作。我们不能将另一个 AWS 账户后期变更为管理账户，因此，创建组织的账户需要谨慎选择。我们可以将账户移动到任何
    OU，包括根 OU。我们也可以在一个 OU 内创建子 OU。
- en: AWS Organizations’ delegated administrator feature allows specific AWS services,
    such as AWS IAM Identity Center, to designate a member account within the organization
    as an administrator for managing that service across all accounts. This enables
    different teams to manage AWS services using separate accounts tailored to their
    roles and responsibilities. Services currently supporting this feature include
    AWS IAM Identity Center, AWS Config, AWS Firewall Manager, Amazon GuardDuty, AWS
    IAM Access Analyzer, Amazon Macie, AWS Security Hub, Amazon Detective, AWS Audit
    Manager, Amazon Inspector, and AWS Systems Manager.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: AWS Organizations 的委托管理员功能允许指定的 AWS 服务（如 AWS IAM 身份中心）将组织中的成员账户指定为管理员，以便在所有账户中管理该服务。这使得不同的团队可以使用单独的账户来管理
    AWS 服务，这些账户是根据他们的角色和责任量身定制的。目前支持此功能的服务包括 AWS IAM 身份中心、AWS Config、AWS 防火墙管理器、Amazon
    GuardDuty、AWS IAM 访问分析器、Amazon Macie、AWS Security Hub、Amazon Detective、AWS 审计管理器、Amazon
    Inspector 和 AWS 系统管理器。
- en: From the CLI, we created an AWS account using the **create-account** subcommand.
    This command returns immediately with a request ID and works asynchronously. We
    can check the status of our request using the **describe-create-account-status**
    subcommand by providing the request ID. To check whether an account was created,
    we can check the **AWS CloudTrail log** for the **CreateAccountResult** event.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 从 CLI 中，我们使用 **create-account** 子命令创建了一个 AWS 账户。此命令会立即返回请求 ID，并异步执行。我们可以使用 **describe-create-account-status**
    子命令，通过提供请求 ID 来检查请求的状态。要检查账户是否已创建，我们可以查看 **AWS CloudTrail 日志** 中的 **CreateAccountResult**
    事件。
- en: The **create-account** subcommand also accepts other parameters, namely **role-name**
    and **iam-user-access-to-billing** . The **role-name** parameter is used to specify
    the name of an IAM role that will be automatically pre-configured in the new member
    account. This role provides administrator permissions to the member account and
    trusts the management account. This means that users in the management account
    can assume the role, provided the management account administrator allows this.
    The default value is **OrganizationAccountAccessRole** . If we log in to the child
    account and check the **OrganizationAccountAccessRole** role, we will see that
    it has the **Administrator Access** policy attached to it. If we check the **Trust
    relationships** section, we will see that our management account has been added
    as a trusted entity. An administrator from the management account can now switch
    roles to the child account and have administrator access. For non-admin users
    to assume the **OrganizationAccountAccessRole** role in the child account and
    switch roles to log into the child account, the user should be given the **AssumeRole**
    permission for the role.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: '**create-account** 子命令还接受其他参数，即 **role-name** 和 **iam-user-access-to-billing**。**role-name**
    参数用于指定将在新成员账户中自动预配置的 IAM 角色名称。此角色为成员账户提供管理员权限，并信任管理账户。这意味着管理账户中的用户可以承担该角色，前提是管理账户的管理员允许这样做。默认值是
    **OrganizationAccountAccessRole**。如果我们登录到子账户并检查 **OrganizationAccountAccessRole**
    角色，我们会看到它附加了 **Administrator Access** 策略。如果我们检查 **Trust relationships** 部分，我们会看到我们的管理账户已被添加为受信任实体。现在，管理账户的管理员可以切换角色到子账户并获得管理员访问权限。对于非管理员用户来说，要承担子账户中的
    **OrganizationAccountAccessRole** 角色并切换角色登录到子账户，用户应该被授予该角色的 **AssumeRole** 权限。'
- en: The **iam-user-access-to-billing** parameter has to be set to **ALLOW** for
    IAM users to access account billing information. If it is set to **DENY** , only
    the root user can access account billing information. The default value is **ALLOW**
    . We also created an OU and moved our account under the OU. Within the examples,
    we used the **list-children** subcommand with the **ORGANIZATIONAL_UNIT** child
    type to list all the OUs under the root. We can set **child-type** to **ACCOUNT**
    to list all the accounts instead.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 必须将 **iam-user-access-to-billing** 参数设置为 **ALLOW**，以便 IAM 用户访问账户账单信息。如果设置为 **DENY**，只有根用户才能访问账户账单信息。默认值是
    **ALLOW**。我们还创建了一个 OU，并将账户移至该 OU。在示例中，我们使用了 **list-children** 子命令与 **ORGANIZATIONAL_UNIT**
    子类型来列出根下的所有 OU。我们还可以将 **child-type** 设置为 **ACCOUNT** 来列出所有账户。
- en: There’s more...
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: 'Let’s quickly go through some important details about the AWS Organizations
    service:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速浏览一下关于 AWS Organizations 服务的一些重要细节：
- en: The AWS Organizations service is supported in all regions; however, the endpoints
    are located in the US East (N. Virginia) for commercial organizations and AWS
    GovCloud (US-West) for AWS GovCloud ( US) organizations.
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS Organizations 服务在所有区域均支持；然而，终端节点位于美国东部（弗吉尼亚北部）用于商业组织，AWS GovCloud（美国西部）用于
    AWS GovCloud（美国）组织。
- en: The AWS Organizations service is a global service. We don’t have to select or
    specify any region to create organization entities.
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS Organizations 服务是一个全球性服务。我们不需要选择或指定任何区域来创建组织实体。
- en: There is no additional cost for using AWS Organizations.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 AWS Organizations 不会产生额外费用。
- en: The number of accounts we can manage within an AWS Organization varies. We can
    ask AWS support to increase this limit.
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以在一个 AWS Organization 中管理的账户数量是有变化的。我们可以请求 AWS 支持来增加这个限制。
- en: An account can only be part of one organization at a time and within an organization,
    an account can only be part of one OU at a time.
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个账户一次只能属于一个组织，而且在一个组织内，一个账户一次只能属于一个 OU。
- en: We can nest the OUs and accounts up to five levels (including the root).
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以将 OU 和账户嵌套最多五层（包括根）。
- en: We can use **Service Control Policies** ( **SCPs** ) to restrict AWS service
    actions to root accounts, IAM users, and IAM roles in the accounts of our organization.
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以使用**服务控制策略**（**SCPs**）来限制 AWS 服务操作，仅对根账户、IAM 用户和组织中账户的 IAM 角色有效。
- en: SCPs can only deny access; they cannot allow access.
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SCPs 只能拒绝访问；不能允许访问。
- en: When both the **permissions boundary** (an IAM feature) and SCP are present,
    the action is only allowed if the permission boundary, the SCP, and the identity-based
    policy all allow the action.
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当 **权限边界**（IAM 特性）和 SCP 同时存在时，只有在权限边界、SCP 和基于身份的策略都允许该操作时，操作才会被允许。
- en: The current list of supported services that can be integrated with AWS Organizations
    include AWS Account Management, AWS **Application Migration Service** ( **MGN**
    ), AWS Artifact, AWS Audit Manager, AWS Backup, AWS CloudFormation Stacksets,
    AWS CloudTrail, Amazon CloudWatch Events, AWS Compute Optimizer, AWS Config, AWS
    Control Tower, Amazon Detective, Amazon DevOps Guru, AWS Directory Service, AWS
    Firewall Manager, Amazon GuardDuty, AWS Health, AWS IAM, IAM Access Analyzer,
    Amazon Inspector, AWS License Manager, Amazon Macie, AWS Marketplace, AWS Network
    Manager, AWS Resource Access Manager, AWS Security Hub, Amazon S3 Storage Lens,
    Amazon Security Lake, AWS Service Catalog, Service Quotas, AWS IAM Identity Center
    (the successor to AWS SSO), AWS Systems Manager, tag policies, AWS Trusted Advisor,
    AWS Well-Architected Tool, **Amazon VPC IP Address Manager** ( **IPAM** ), and
    Amazon VPC Reachability Analyzer. We can enable integration from the supported
    service’s dashboard. For an updated list of services, refer to the *See also*
    section of this recipe.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当前可以与 AWS Organizations 集成的受支持服务包括 AWS 账户管理、AWS **应用迁移服务** (**MGN**)、AWS Artifact、AWS
    审计管理器、AWS Backup、AWS CloudFormation Stacksets、AWS CloudTrail、Amazon CloudWatch
    Events、AWS Compute Optimizer、AWS Config、AWS Control Tower、Amazon Detective、Amazon
    DevOps Guru、AWS Directory Service、AWS Firewall Manager、Amazon GuardDuty、AWS Health、AWS
    IAM、IAM 访问分析器、Amazon Inspector、AWS License Manager、Amazon Macie、AWS Marketplace、AWS
    Network Manager、AWS 资源访问管理器、AWS 安全中心、Amazon S3 Storage Lens、Amazon Security Lake、AWS
    Service Catalog、服务配额、AWS IAM 身份中心（AWS SSO 的继任者）、AWS Systems Manager、标签策略、AWS Trusted
    Advisor、AWS Well-Architected Tool、**Amazon VPC IP 地址管理器** (**IPAM**) 和 Amazon
    VPC 可达性分析器。我们可以从受支持服务的仪表板启用集成。有关更新的服务列表，请参阅本指南的 *另见* 部分。
- en: 'Let’s also go through some of the useful AWS CLI subcommands for AWS Organizations:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们了解一些有用的 AWS CLI 子命令，用于 AWS Organizations：
- en: '**create-gov-cloud-account** can be used to create accounts in the AWS GovCloud
    (US) region if we are authorized to do so.'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**create-gov-cloud-account** 可用于在 AWS GovCloud (US) 区域创建账户，前提是我们有相关权限。'
- en: '**invite-account-to-organization** sends an invitation to another account to
    join our organization.'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**invite-account-to-organization** 向另一个账户发送邀请，邀请其加入我们的组织。'
- en: '**remove-account-from-organization** removes an account from the organization.'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**remove-account-from-organization** 将账户从组织中移除。'
- en: '**create-organization** creates an AWS Organization, while **delete-organization**
    deletes an AWS Organization.'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**create-organization** 用于创建一个 AWS 组织，而 **delete-organization** 用于删除一个 AWS
    组织。'
- en: '**leave-organization** removes an account from its parent organization.'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**leave-organization** 将账户从其父组织中移除。'
- en: '**create-organizational-unit** creates an OU, while **delete-organizational-unit**
    deletes an OU. To delete an OU, we must remove all accounts and child OUs.'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**create-organizational-unit** 用于创建一个组织单元（OU），而 **delete-organizational-unit**
    用于删除一个组织单元（OU）。要删除一个OU，必须先移除所有账户和子OU。'
- en: '**update-organizational-unit** renames an OU.'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**update-organizational-unit** 用于重命名一个组织单元（OU）。'
- en: '**describe-account** retrieves information about that account and should be
    called from the master account. **describe-organization** retrieves information
    about the organization. **describe-organizational-unit** retrieves information
    about an OU.'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**describe-account** 用于检索该账户的信息，应该从主账户调用。**describe-organization** 用于检索组织的信息。**describe-organizational-unit**
    用于检索一个组织单元（OU）的信息。'
- en: '**list-accounts** lists all the accounts in the organization. **list-accounts-for-parent**
    lists the child accounts of the given target root or OU. **list-create-account-status**
    lists the account creation requests that match the given status. **list-roots**
    lists the roots that are defined in the current organization.'
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**list-accounts** 列出组织中的所有账户。**list-accounts-for-parent** 列出给定目标根或 OU 的子账户。**list-create-account-status**
    列出与给定状态匹配的账户创建请求。**list-roots** 列出当前组织中定义的根。'
- en: '**tag-resource** and **untag-resource** can be used for managing tags.'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**tag-resource** 和 **untag-resource** 可用于管理标签。'
- en: Different ways to interact with AWS
  id: totrans-232
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 与 AWS 交互的不同方式
- en: We can interact with AWS in a variety of ways, including, the AWS Management
    Console, AWS CLI, AWS **Software Development Kits** ( **SDKs** ), AWS CloudFormation,
    external tools such as Terraform by HashiCorp, direct AWS API calls, AWS Tools
    for PowerShell, AWS **Cloud Development Kit** ( **CDK** ), and the AWS **Serverless
    Application Model** ( **SAM** ). Each of these methods offers unique advantages
    depending on the specific task and the level of automation required.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过多种方式与 AWS 进行交互，包括 AWS 管理控制台、AWS CLI、AWS **软件开发工具包** (**SDKs**)、AWS CloudFormation、外部工具如
    HashiCorp 的 Terraform、直接的 AWS API 调用、AWS PowerShell 工具、AWS **云开发工具包** (**CDK**)
    和 AWS **无服务器应用模型** (**SAM**)。根据具体任务和所需的自动化水平，每种方法都有其独特的优势。
- en: For the scope of the recipes within this book, we will predominantly focus on
    the AWS Management Console and the CLI. The Management Console is typically utilized
    for one-time configurations and activities, providing an intuitive and visual
    means to manage AWS resources. On the other hand, the CLI is particularly suited
    for repetitive tasks, enabling automation and scriptability. Gaining proficiency
    in the CLI not only streamlines our AWS operations and lays a solid foundation
    but also aids in grasping the nuances of other interaction methods, such as AWS
    SDKs, CloudFormation, Terraform, and more.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本书中的食谱范围，我们将主要集中于AWS管理控制台和CLI。管理控制台通常用于一次性配置和操作，提供直观和可视化的方式来管理AWS资源。另一方面，CLI特别适合处理重复性任务，支持自动化和脚本化。掌握CLI不仅能简化我们的AWS操作并打下坚实的基础，还能帮助我们理解其他交互方式的细微差别，如AWS
    SDK、CloudFormation、Terraform等。
- en: See also
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: We can learn more about AWS Organizations including best practices and quotas
    at [https://www.cloudericks.com/blog/getting-started-with-aws-organizations](https://www.cloudericks.com/blog/getting-started-with-aws-organizations)
    .
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以通过访问[https://www.cloudericks.com/blog/getting-started-with-aws-organizations](https://www.cloudericks.com/blog/getting-started-with-aws-organizations)了解更多关于AWS
    Organizations的信息，包括最佳实践和配额。
- en: To learn about all the commands that we can use to work with the AWS CLI, refer
    to the AWS CLI documentation for organizations at [https://docs.aws.amazon.com/cli/latest/reference/organizations/index.htm](https://docs.aws.amazon.com/cli/latest/reference/organizations/index.htm)
    .
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要了解我们可以使用的所有AWS CLI命令，请参考AWS CLI文档中的Organizations部分，网址为[https://docs.aws.amazon.com/cli/latest/reference/organizations/index.htm](https://docs.aws.amazon.com/cli/latest/reference/organizations/index.htm)。
- en: The services that can be integrated with AWS Organizations can be found at [https://docs.aws.amazon.com/organizations/latest/userguide/orgs_integrate_services_list.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_integrate_services_list.html)
    .
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以与AWS Organizations集成的服务可以在[https://docs.aws.amazon.com/organizations/latest/userguide/orgs_integrate_services_list.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_integrate_services_list.html)找到。
- en: We use AWS CLI within this book. However, if you would like to learn more about
    CloudShell, you can do this at [https://www.cloudericks.com/blog/getting-started-with-aws-cloudshell](https://www.cloudericks.com/blog/getting-started-with-aws-cloudshell)
    .
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本书中我们使用了AWS CLI。然而，如果你想了解更多关于CloudShell的内容，可以访问[https://www.cloudericks.com/blog/getting-started-with-aws-cloudshell](https://www.cloudericks.com/blog/getting-started-with-aws-cloudshell)。
- en: We can learn about using AWS Control Tower, instead of using AWS Organizations
    directly, at [https://www.cloudericks.com/blog/getting-started-with-aws-control-tower](https://www.cloudericks.com/blog/getting-started-with-aws-control-tower)
    .
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以通过访问[https://www.cloudericks.com/blog/getting-started-with-aws-control-tower](https://www.cloudericks.com/blog/getting-started-with-aws-control-tower)了解如何使用AWS
    Control Tower，而不是直接使用AWS Organizations。
- en: User management and SSO with IAM Identity Center
  id: totrans-241
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用户管理和SSO与IAM身份中心
- en: In this recipe, we will first enable the IAM Identity Center service (previously
    AWS SSO) and learn to create users and groups within IAM Identity Center. We will
    then create a permission set and assign a group to an AWS account along with that
    permission set. Finally, we will see how to log in to the AWS Management Console
    and AWS CLI from the AWS access portal using SSO.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将首先启用IAM身份中心服务（之前称为AWS SSO），并学习如何在IAM身份中心中创建用户和组。接着，我们将创建权限集，并将一个组与该权限集一起分配给一个AWS账户。最后，我们将看到如何通过AWS访问门户使用SSO登录AWS管理控制台和AWS
    CLI。
- en: SSO is a user authentication process that allows a user to access multiple applications
    or systems with one set of login credentials. This means that after logging in
    once, the user can access other AWS accounts and apps without needing to log in
    again for each system. This simplifies the user experience and enhances security
    by reducing the number of passwords a user must remember and maintain.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: SSO是一种用户认证过程，允许用户使用一套登录凭证访问多个应用程序或系统。这意味着在登录一次后，用户可以访问其他AWS账户和应用，而无需为每个系统重新登录。这简化了用户体验，并通过减少用户需要记住和维护的密码数量，从而增强了安全性。
- en: Getting ready
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: We need an AWS account with AWS organizations enabled. To set up AWS Organizations,
    we can follow the *Multi-account management with AWS Organizations* recipe from
    this chapter.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要一个启用了AWS Organizations的AWS账户。要设置AWS Organizations，我们可以按照本章中的*多账户管理与AWS Organizations*食谱进行操作。
- en: For working with CLI and IAM Identity Center, w e need to install and configure
    AWS CLI V2 as discussed in the *Technical requirements* section in this chapter.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 CLI 和 IAM 身份中心，我们需要按照本章的*技术要求*部分安装并配置 AWS CLI V2。
- en: How to do it...
  id: totrans-247
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行...
- en: First, we will enable the IAM Identity Center. Then, we will create a group
    and a user and add that user to that group. After that, we will create a permission
    set and assign access for the group to an AWS account making use of the permission
    set.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将启用 IAM 身份中心。然后，我们将创建一个组和一个用户，并将该用户添加到该组。之后，我们将创建权限集，并使用该权限集为组分配 AWS 账户的访问权限。
- en: Enabling the IAM Identity Center and creating users and groups
  id: totrans-249
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启用 IAM 身份中心并创建用户和组
- en: 'To enable IAM Identity Center and create a group and user, we can proceed with
    the following steps:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用 IAM 身份中心并创建一个组和用户，我们可以按照以下步骤进行：
- en: Log in to AWS Management Console and go to **IAM** **Identity Center** .
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 AWS 管理控制台并转到**IAM 身份中心**。
- en: 'If we have not enabled IAM Identity Center, we should see a screen like the
    following:'
  id: totrans-252
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果我们还没有启用 IAM 身份中心，我们应该看到如下图所示的屏幕：
- en: '![Figure 1.21 – The IAM Identity Center dashboard](image/B21384_01_21.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.21 – IAM 身份中心仪表板](image/B21384_01_21.jpg)'
- en: Figure 1.21 – The IAM Identity Center dashboard
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.21 – IAM 身份中心仪表板
- en: Click on **Enable** from the IAM Identity Center Dashboard as shown in *Figure
    1* *.21* .
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如*图 1.21*所示，从 IAM 身份中心仪表板点击**启用**。
- en: We should now be taken to the **IAM Identity** **Center** dashboard.
  id: totrans-256
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们现在应该被带到**IAM 身份中心**仪表板。
- en: '![Figure 1.22 – The recommended setup steps for IAM Identity Center](image/B21384_01_22.jpg)'
  id: totrans-257
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.22 – IAM 身份中心的推荐设置步骤](image/B21384_01_22.jpg)'
- en: Figure 1.22 – The recommended setup steps for IAM Identity Center
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.22 – IAM 身份中心的推荐设置步骤
- en: Click on **Choose your identity source** under **Step 1** as shown in *Figure
    1* *.22* .
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如*图 1.22*所示，点击**选择您的身份来源**下的**步骤 1**。
- en: Leave the value for **Identity Source** as **Identity** **Center directory**
    .
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**身份源**的值保持为**身份中心目录**。
- en: For **Attributes for access control** , click **Enable** .
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**访问控制的属性**，点击**启用**。
- en: 'Click on **Groups** from the left sidebar and click on **Create group** as
    shown in the following figure:'
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击**组**，然后点击**创建组**，如下图所示：
- en: '![Figure 1.23 – The IAM Identity Center sidebar and Groups page](image/B21384_01_23.jpg)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.23 – IAM 身份中心侧边栏和组页面](image/B21384_01_23.jpg)'
- en: Figure 1.23 – The IAM Identity Center sidebar and Groups page
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.23 – IAM 身份中心侧边栏和组页面
- en: On the **Create group** page, within the **Group details** section, enter **awsseccbadmins**
    as the **Group name** and set **AWS Sec Cookbook Admins group** under **Description**
    .
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**创建组**页面的**组详情**部分，输入**awsseccbadmins**作为**组名称**，并在**描述**下设置**AWS 安全食谱管理员组**。
- en: Scroll down, leave the **Add users to group** section as-is without adding any
    users for now, and click on **Create group** .
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动，保持**添加用户到组**部分为空，不添加任何用户，点击**创建组**。
- en: Click on **Users** from the left sidebar of IAM Identity Center dashboard and
    click on **Add user** .
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 IAM 身份中心仪表板的左侧边栏点击**用户**，然后点击**添加用户**。
- en: In the **Primary information** section, specify **awsseccbadmin1** under **Username**
    and under **Password** , select **Send an email to this user with the password
    setup instructions** . We can also generate a one-time password and share that
    with the user instead.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**基本信息**部分，指定**awsseccbadmin1**作为**用户名**，在**密码**下选择**向该用户发送带有密码设置说明的电子邮件**。我们也可以生成一次性密码并与用户共享。
- en: '![Figure 1.24 – The Specify user details page in IAM Identity Center](image/B21384_01_24.jpg)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.24 – IAM 身份中心中的指定用户详情页面](image/B21384_01_24.jpg)'
- en: Figure 1.24 – The Specify user details page in IAM Identity Center
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.24 – IAM 身份中心中的指定用户详情页面
- en: Fill in the other fields within the **Primary Information** section, namely
    **Email address** , **Confirm email address** , **First name** , **Last name**
    , and **Display name** .
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写**基本信息**部分中的其他字段，即**电子邮件地址**、**确认电子邮件地址**、**名字**、**姓氏**和**显示名称**。
- en: Leave the other sections, namely **Contact methods** , **Job-related information**
    , **Address** , **Preferences** , and **Additional attributes** as-is. Click **Next**
    on the bottom-right side of the page.
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保持其他部分不变，即**联系方法**、**工作相关信息**、**地址**、**偏好设置**和**附加属性**，然后点击页面右下角的**下一步**。
- en: On the **Add user to group** page, select the **awsseccbadmins** group that
    we created earlier in this recipe and click **Next** .
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**将用户添加到组**页面中，选择我们在本节中创建的**awsseccbadmins**组，然后点击**下一步**。
- en: On the **Review and add user** page, review the details and click **Add user**
    . We should now see that the new user is added to the **Users** page.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**审查并添加用户**页面上，审查详细信息并点击**添加用户**。现在我们应该能看到新用户已添加到**用户**页面。
- en: The newly added user needs to check the email and follow the instructions to
    accept the invitation and complete the password setup.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 新添加的用户需要检查电子邮件，并按照指示接受邀请并完成密码设置。
- en: '![Figure 1.25 – The invitation email for the new user in IAM Identity Center](image/B21384_01_25.jpg)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.25 – IAM身份中心中新用户的邀请邮件](image/B21384_01_25.jpg)'
- en: Figure 1.25 – The invitation email for the new user in IAM Identity Center
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.25 – IAM身份中心中新用户的邀请邮件
- en: After completing the instructions, we should be logged in to the AWS access
    portal, where we can see the applications allocated to us. Currently, since we
    have not allocated any applications, we should see a **You do not have any** **applications**
    message.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 完成指令后，我们应该已经登录到AWS访问门户，在那里可以看到分配给我们的应用程序。目前，由于我们还没有分配任何应用程序，我们应该会看到**您没有任何**
    **应用程序**的消息。
- en: Next, we will create a permission set.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将创建一个权限集。
- en: Creating a permission set with an AWS managed policy
  id: totrans-280
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建具有AWS托管策略的权限集
- en: 'Follow the instructions to create a permission set that we can use while assigning
    access to AWS accounts in the next section:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 按照指示创建一个权限集，我们可以在下一节分配AWS账户访问权限时使用：
- en: Click on **Permission sets** from the left sidebar as shown in *Figure 1* *.23*
    , and on the **Permission sets** page, click on **Create** **permission set**
    .
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧边栏中的**权限集**，如*图 1* *23*所示，在**权限集**页面上点击**创建****权限集**。
- en: Select **Predefined permission set** as the **Permission set type** , and for
    **Select an AWS managed policy** , select **AdministratorAccess** .
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**预定义权限集**作为**权限集类型**，对于**选择AWS托管策略**，选择**AdministratorAccess**。
- en: '![Figure 1.26 – Permission set type selection in IAM Identity Center](image/B21384_01_26.jpg)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.26 – 在IAM身份中心中选择权限集类型](image/B21384_01_26.jpg)'
- en: Figure 1.26 – Permission set type selection in IAM Identity Center
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.26 – 在IAM身份中心中选择权限集类型
- en: Scroll down and click **Next** .
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动并点击**下一步**。
- en: On the **Specify permission set details** page, keep the value of **Permission
    set name** as **AdministratorAccess** and **Session duration** as **1 hour** ,
    add a meaningful description, leave values for other fields empty, and click **Next**
    .
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**指定权限集详细信息**页面上，将**权限集名称**的值保持为**AdministratorAccess**，**会话时长**保持为**1小时**，添加一个有意义的描述，其他字段保持空白，然后点击**下一步**。
- en: On the **Review and create** page, review everything and click on **Create**
    .
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**审查和创建**页面上，审查所有内容后点击**创建**。
- en: The new permission set should now appear on the **Permission** **sets** page.
  id: totrans-289
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 新的权限集现在应该出现在**权限集**页面上。
- en: Next, we will assign the **awsseccbadmins** group to an AWS account.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将为AWS账户分配**awsseccbadmins**小组。
- en: Providing access to AWS accounts
  id: totrans-291
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提供AWS账户的访问权限
- en: 'We can provide access for a group to one or more AWS accounts as follows:'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照以下步骤为小组提供一个或多个AWS账户的访问权限：
- en: Click on the **AWS Accounts** option from the left sidebar as shown in *Figure
    1* *.23* to go to the **AWS** **accounts** page.
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧边栏中的**AWS账户**选项，如*图 1* *23*所示，进入**AWS** **账户**页面。
- en: Select all the AWS accounts we want to give access to and click on **Assign
    users or groups** . I have selected the **aws-sec-cookbook-1** account.
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择我们希望授予访问权限的所有AWS账户，并点击**分配用户或组**。我已选择**aws-sec-cookbook-1**账户。
- en: '![Figure 1.27 – The AWS accounts page in IAM Identity Center](image/B21384_01_27.jpg)'
  id: totrans-295
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.27 – IAM身份中心中的AWS账户页面](image/B21384_01_27.jpg)'
- en: Figure 1.27 – The AWS accounts page in IAM Identity Center
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.27 – IAM身份中心中的AWS账户页面
- en: On the **Select users and groups** page, in the **Groups** tab, select the **awsseccbadmins**
    group that we created earlier in this recipe and click **Next** to go to the **Assign
    permission** **sets** page.
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择用户和组**页面的**组**标签页中，选择我们在本节中创建的**awsseccbadmins**组，然后点击**下一步**进入**分配权限**
    **集**页面。
- en: On the **Assign permission sets** page, select the permission set for our group
    to the selected AWS account. Click **Next** to go to the **Review and submit**
    **assignments** page.
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**分配权限集**页面上，为我们的小组选择要分配给所选AWS账户的权限集。点击**下一步**进入**审查和提交****分配**页面。
- en: '![Figure 1.28 – Permission set selection in IAM Identity Center](image/B21384_01_28.jpg)'
  id: totrans-299
  prefs: []
  type: TYPE_IMG
  zh: '![图1.28 – IAM Identity Center中的权限集选择](image/B21384_01_28.jpg)'
- en: Figure 1.28 – Permission set selection in IAM Identity Center
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.28 – IAM Identity Center中的权限集选择
- en: On the **Review and submit assignments** page, review everything and click on
    **Submit** .
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**审阅和提交任务**页面上，审阅所有内容并点击**提交**。
- en: Log in to the AWS access portal using the **AWS access portal URL** of AWS Identity
    Center. We can get the URL from our Identity Center dashboard. It is also present
    in the invitation email sent to the user’s email address when the user was created.
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用AWS Identity Center的**AWS访问门户URL**登录AWS访问门户。我们可以从我们的Identity Center仪表板中获取URL。当用户被创建时，邀请邮件中也会包含该URL。
- en: You need to click on **AWS Account (1)** to see the newly assigned AWS account
    and then click on the account to get the options to log in to **Management Console**
    or **Command line or programmatic access** , making use of short-term credentials.
  id: totrans-303
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您需要点击**AWS账户（1）**以查看新分配的AWS账户，然后点击账户以获取登录到**管理控制台**或**命令行或编程访问**的选项，利用临时凭证。
- en: '![Figure 1.29 – The AWS access portal](image/B21384_01_29.jpg)'
  id: totrans-304
  prefs: []
  type: TYPE_IMG
  zh: '![图1.29 – AWS访问门户](image/B21384_01_29.jpg)'
- en: Figure 1.29 – The AWS access portal
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.29 – AWS访问门户
- en: Click on **Management console** to log in to the AWS account assigned to us.
    Click on the drop-down menu next to our username to verify the account details.
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**管理控制台**以登录分配给我们的AWS账户。点击用户名旁边的下拉菜单以验证账户详情。
- en: We can follow the same steps to give access to one or more AWS accounts for
    users (instead of groups). However, it is a good practice to assign permissions
    to groups and add or remove users to those groups as needed.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照相同步骤为用户（而不是组）提供对一个或多个AWS账户的访问权限。然而，最好的做法是为组分配权限，并根据需要添加或删除用户到这些组中。
- en: Configuring SSO for AWS CLI with IAM Identity Center
  id: totrans-308
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用IAM Identity Center为AWS CLI配置SSO
- en: 'In the previous section, we saw how to log in to the AWS Management Console
    using IAM Identity Center from the AWS access portal. In this section, we will
    learn how to configure AWS CLI V2 with IAM Identity Center:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中，我们看到如何使用IAM Identity Center从AWS访问门户登录到AWS管理控制台。在本节中，我们将学习如何配置AWS CLI V2与IAM
    Identity Center：
- en: Log in to the AWS access portal as an IAM Identity Center user. We should see
    a screen like *Figure 1* *.29* .
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为IAM Identity Center用户登录到AWS访问门户。我们应该看到一个类似*图1* *.29*的屏幕。
- en: Click on **Command line or programmatic access** from the AWS access portal
    instead of the Management Console as we did in *Step 7* of the *Providing access
    to AWS* *accounts* sub-section.
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从AWS访问门户中点击**命令行或编程访问**，而不是像在*提供对AWS账户的访问*子节的*步骤7*中所做的那样进入管理控制台。
- en: We should see a popup that lists different options along with the required steps
    to work with a CLI.
  id: totrans-312
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们应该看到一个弹出窗口，列出了不同选项以及使用CLI的必要步骤。
- en: '![Figure 1.30 – The steps to work with AWS CLI when using IAM Identity Center](image/B21384_01_30.jpg)'
  id: totrans-313
  prefs: []
  type: TYPE_IMG
  zh: '![图1.30 – 使用IAM Identity Center时使用AWS CLI的工作步骤](image/B21384_01_30.jpg)'
- en: Figure 1.30 – The steps to work with AWS CLI when using IAM Identity Center
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.30 – 使用IAM Identity Center时使用AWS CLI的工作步骤
- en: 'Assuming that we have already installed AWS CLI V2, open the command prompt
    (or terminal), run the **aws configure sso** command, and follow the instructions
    shown in *Figure 1* *.30* . Provide **SSO start URL** and **SSO region** , and
    optionally a name for the SSO session, as shown in the following figure:'
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 假设我们已经安装了AWS CLI V2，打开命令提示符（或终端），运行**aws configure sso**命令，并按照*图1* *.30*中显示的说明进行操作。提供**SSO起始URL**和**SSO区域**，以及可选的SSO会话名称，如下图所示：
- en: '![Figure 1.31 – Configuring SSO with AWS CLI V2](image/B21384_01_31.jpg)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
  zh: '![图1.31 – 配置AWS CLI V2的SSO](image/B21384_01_31.jpg)'
- en: Figure 1.31 – Configuring SSO with AWS CLI V2
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.31 – 配置AWS CLI V2的SSO
- en: Once we have provided values for **SSO session name** , **SSO start URL** ,
    **SSO region** , and **SSO registration scopes** , a browser will open for authorization.
    Please note that I have provided the customized **SSO start URL** instead of the
    default one as shown in *Figure 1* *.30* ; both will work. The command prompt
    will resume once the authorization is complete.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们为**SSO会话名称**、**SSO起始URL**、**SSO区域**和**SSO注册范围**提供了值，浏览器将打开进行授权。请注意，我提供了自定义的**SSO起始URL**而不是默认的一个，如*图1*
    *.30*所示；两者都可以使用。授权完成后，命令提示符将恢复。
- en: Verify by running the **aws s3 ls** command along with the profile name, as
    shown in *Figure 1* *.31* .
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行**aws s3 ls**命令并附上配置文件名称进行验证，如*图1* *.31*所示。
- en: We only need to configure SSO once for a combination of AWS accounts and roles
    as explained in the *How it works…* section that follows. Once configured, we
    can make use of that profile to log in and log out using the **aws sso login**
    and **aws sso logout** commands respectively, as we will see next.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只需要为AWS账户和角色组合配置一次SSO，如下面的*工作原理...*部分所述。配置完成后，我们可以使用该配置文件通过**aws sso login**和**aws
    sso logout**命令登录和退出，如下所示。
- en: Logging in and out for SSO with IAM Identity Center in AWS CLI
  id: totrans-321
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在AWS CLI中使用IAM Identity Center进行SSO登录和退出
- en: 'We can log in to and out of the AWS account using a configured AWS CLI V2 profile
    as follows:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用配置的AWS CLI V2配置文件登录和退出AWS账户，方法如下：
- en: 'Log in using the **aws sso login** command, providing the CLI profile name
    we already configured (as we saw in *Figure 1* *.31* ). Execute the **aws s3 ls**
    command, providing the same profile name, as follows:'
  id: totrans-323
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**aws sso login**命令登录，提供我们已经配置的CLI配置文件名称（如我们在*图1* *.31*中看到的）。执行**aws s3 ls**命令，提供相同的配置文件名称，如下所示：
- en: '![Figure 1.32 – Logging into an AWS account from CLI using SSO](image/B21384_01_32.jpg)'
  id: totrans-324
  prefs: []
  type: TYPE_IMG
  zh: '![图1.32 – 使用SSO从CLI登录AWS账户](image/B21384_01_32.jpg)'
- en: Figure 1.32 – Logging into an AWS account from CLI using SSO
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.32 – 使用SSO从CLI登录AWS账户
- en: The **aws sso login** command will open a browser for authorization similar
    to the **aws configure sso** command. The command prompt will resume once the
    authorization is complete.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: '**aws sso login**命令将打开一个浏览器进行授权，类似于**aws configure sso**命令。授权完成后，命令提示符将恢复。'
- en: Important note
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'If we have multiple profiles or if we are not using the default profile, we
    will need to specify the profile when executing AWS CLI commands even after the
    SSO login. Also, if we try to use a profile for which we don’t have access, we
    will get an error that says that an error occurred ( **ForbiddenException** )
    when calling the **GetRoleCredentials** operation: **No access** .'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们有多个配置文件或者没有使用默认配置文件，即使在SSO登录后，执行AWS CLI命令时也需要指定配置文件。此外，如果我们尝试使用我们没有访问权限的配置文件，当调用**GetRoleCredentials**操作时，将会收到一个错误，指出发生了错误（**ForbiddenException**）：**无法访问**。
- en: Log out using the **aws sso logout** command and execute the **aws s3 ls** command,
    providing the same profile name as before.
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用**aws sso logout**命令退出登录，并执行**aws s3 ls**命令，提供与之前相同的配置文件名称。
- en: '![Figure 1.33 – Logging out from the AWS account from CLI using SSO](image/B21384_01_33.jpg)'
  id: totrans-330
  prefs: []
  type: TYPE_IMG
  zh: '![图1.33 – 使用SSO从CLI退出AWS账户](image/B21384_01_33.jpg)'
- en: Figure 1.33 – Logging out from the AWS account from CLI using SSO
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.33 – 使用SSO从CLI退出AWS账户
- en: How it works...
  id: totrans-332
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: AWS IAM Identity Center is the successor to AWS SSO and helps us securely manage
    access centrally across multiple AWS accounts and applications. The IAM Identity
    Center is the suggested method for handling authentication and authorization on
    AWS. It is suitable for organizations big and small.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: AWS IAM Identity Center是AWS SSO的后继者，帮助我们在多个AWS账户和应用程序之间安全地集中管理访问权限。IAM Identity
    Center是处理AWS上身份验证和授权的建议方法。适用于各种规模的组织。
- en: From the AWS IAM Identity Center dashboard, we can configure access to AWS accounts
    within an AWS Organization, numerous cloud applications such as Microsoft 365,
    salesforce, and so on, EC2 Windows instances, and even other **SAML 2.0-enabled
    applications** . Once configured, we only need to log in to the AWS access portal
    and then we can log in to all the configured AWS accounts and applications through
    SSO without providing any other additional credentials.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 从AWS IAM Identity Center仪表板，我们可以配置对AWS组织内的AWS账户、诸如Microsoft 365、salesforce等多个云应用程序、EC2
    Windows实例以及其他**启用SAML 2.0的应用程序**的访问权限。配置完成后，我们只需登录到AWS访问门户，然后通过SSO登录到所有配置的AWS账户和应用程序，无需提供任何其他额外凭据。
- en: An **Identity Provider** ( **IdP** ) is a service that stores and verifies user
    identity. We can make use of an IdP to log in to multiple applications without
    providing additional credentials using SSO. We used the built-in IdP of the IAM
    Identity Center within our recipe. However, instead of the built-in IdP, we can
    also use one of the many supported IdPs such as Microsoft Entra ID (previously
    Active Directory or Azure AD), Okta, Ping Identity, Jump Cloud, and Google Workspace.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: '**身份提供者（IdP）**是存储和验证用户身份的服务。我们可以利用IdP在不提供额外凭据的情况下登录多个应用程序使用SSO。我们在本文中使用了IAM
    Identity Center的内置IdP。但是，除了内置IdP，我们还可以使用许多支持的IdP，如Microsoft Entra ID（以前是Active
    Directory或Azure AD）、Okta、Ping Identity、Jump Cloud和Google Workspace。'
- en: Within this recipe, while enabling IAM Identity Center, we also enabled **attributes
    for access control** . We can assign users to workloads in AWS based on existing
    attributes in the user’s identity source to control access to resources, and thus
    implement **Attribute-Based Access Control** ( **ABAC** ). ABAC is a method of
    regulating access based on attributes (characteristics or properties) associated
    with users, resources, or the environment. Unlike **Role-Based Access Control**
    ( **RBAC** ), which grants access based on the roles of users within an organization,
    ABAC uses a wide range of attributes, such as user location, time of access, and
    even sensitivity of the accessed resource. This allows for more flexible, context-aware,
    and policy-driven access control, enabling more granular and dynamic permission
    management.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，在启用 IAM 身份中心时，我们还启用了 **访问控制的属性**。我们可以根据用户身份源中的现有属性将用户分配给 AWS 中的工作负载，从而控制对资源的访问，实现
    **基于属性的访问控制** (**ABAC**) 。ABAC 是一种基于与用户、资源或环境相关的属性（特征或属性）来调节访问的方法。与 **基于角色的访问控制**
    (**RBAC**) 不同，RBAC 根据用户在组织中的角色授予访问权限，而 ABAC 使用各种属性，如用户位置、访问时间，甚至访问资源的敏感性。这允许更灵活、情境感知和政策驱动的访问控制，从而实现更精细和动态的权限管理。
- en: We can assign varying permission levels to users or groups for different AWS
    accounts and applications using permission sets. For example, we can give developers
    complete access to developer accounts and read-only access to production accounts.
    We can select the predefined permission set option as we did in this recipe selecting
    one of the available AWS-managed policies or we can create a custom permission
    set.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用权限集为不同的 AWS 账户和应用程序分配不同的权限级别给用户或组。例如，我们可以为开发者账户授予完全访问权限，为生产账户授予只读访问权限。我们可以选择预定义权限集选项，像本食谱中一样选择可用的
    AWS 管理策略之一，或者我们可以创建自定义权限集。
- en: The following screenshot from the IAM Identity Center lists down policies available
    currently when we select the predefined permission set option.
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 以下来自 IAM 身份中心的截图列出了在选择预定义权限集选项时当前可用的策略。
- en: '![Figure 1.34 – Policies for the predefined permission set](image/B21384_01_34.jpg)'
  id: totrans-339
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.34 – 预定义权限集的策略](image/B21384_01_34.jpg)'
- en: Figure 1.34 – Policies for the predefined permission set
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.34 – 预定义权限集的策略
- en: With the custom permission set option, we can choose from an AWS-managed policy,
    a customer-managed policy, and an inline policy, and even optionally set a permissions
    boundary. We will see a custom permission set in the *Creating customer-managed
    policies in IAM Identity Center* recipe in [*Chapter 2*](B21384_02.xhtml#_idTextAnchor043)
    .
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 使用自定义权限集选项时，我们可以选择 AWS 管理的策略、客户管理的策略和内联策略，甚至可以选择设置权限边界。我们将在 [*第 2 章*](B21384_02.xhtml#_idTextAnchor043)
    的 *在 IAM 身份中心中创建客户管理策略* 食谱中看到自定义权限集。
- en: 'In the recipe, our user had one permission set assigned to one AWS account.
    If we have users with multiple permission sets and access to multiple AWS accounts,
    we can choose the AWS account and the permission set to log in from the AWS access
    portal, as shown in the following figure:'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们的用户为一个 AWS 账户分配了一个权限集。如果我们有多个权限集并且可以访问多个 AWS 账户，我们可以从 AWS 访问门户选择 AWS
    账户和权限集进行登录，如下图所示：
- en: '![Figure 1.35 – The AWS access portal with multiple AWS accounts and permissions](image/B21384_01_35.jpg)'
  id: totrans-343
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.35 – 带有多个 AWS 账户和权限的 AWS 访问门户](image/B21384_01_35.jpg)'
- en: Figure 1.35 – The AWS access portal with multiple AWS accounts and permissions
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.35 – 带有多个 AWS 账户和权限的 AWS 访问门户
- en: 'Even when configuring AWS SSO for CLI, we will be given options to select the
    AWS account and permission set. First, we will be asked to select the AWS account
    as follows:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 即使在为 CLI 配置 AWS SSO 时，我们也会被要求选择 AWS 账户和权限集。首先，我们将被要求选择 AWS 账户，如下所示：
- en: '![Figure 1.36 – AWS CLI account selection](image/B21384_01_36.jpg)'
  id: totrans-346
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.36 – AWS CLI 账户选择](image/B21384_01_36.jpg)'
- en: Figure 1.36 – AWS CLI account selection
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.36 – AWS CLI 账户选择
- en: After we select the account, we will be given the option to choose the role
    (which is based on the permission set) if we have multiple roles available to
    choose from in the selected AWS account.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择账户后，如果在选定的 AWS 账户中有多个角色可供选择，我们将被提供选择角色（基于权限集）的选项。
- en: '![Figure 1.37 – AWS CLI role selection](image/B21384_01_37.jpg)'
  id: totrans-349
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.37 – AWS CLI 角色选择](image/B21384_01_37.jpg)'
- en: Figure 1.37 – AWS CLI role selection
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.37 – AWS CLI 角色选择
- en: There’s more...
  id: totrans-351
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: 'We can administer IAM Identity Center from only the management account of the
    Organization or a member account registered as an IAM Identity Center delegated
    administrator. Otherwise, we will see an error message that looks like the following:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 我们只能通过组织的管理账户或注册为IAM身份中心委托管理员的成员账户来管理IAM身份中心。否则，我们将看到类似以下的错误消息：
- en: '![Figure 1.38 – An error message for a member account that is not a delegated
    administrator](image/B21384_01_38.jpg)'
  id: totrans-353
  prefs: []
  type: TYPE_IMG
  zh: '![图1.38 – 非委托管理员的成员账户错误消息](image/B21384_01_38.jpg)'
- en: Figure 1.38 – An error message for a member account that is not a delegated
    administrator
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.38 – 非委托管理员的成员账户错误消息
- en: 'We can make a member account as a delegated administrator as follows:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过以下步骤将成员账户设置为委托管理员：
- en: Log in to the AWS Management Console of the management account of our organization
    and go to the **IAM Identity** **Center** dashboard.
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到我们组织的管理账户的AWS管理控制台，并进入**IAM身份中心**仪表板。
- en: Click on **Settings** from the left sidebar of IAM Identity Center.
  id: totrans-357
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在IAM身份中心的左侧边栏点击**设置**。
- en: Go to the **Management** tab.
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**管理**标签页。
- en: Find the **Delegated administrator** section and click on **Register account**
    . This will show us the organizational structure of our AWS Organization.
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到**委托管理员**部分并点击**注册账户**。这将显示我们AWS组织的组织结构。
- en: Under the **Organizational structure** section, select the member account we
    want to make a delegated administrator and click on **Register account** .
  id: totrans-360
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**组织结构**部分，选择我们希望设置为委托管理员的成员账户，然后点击**注册账户**。
- en: We should see a message that the member account was registered successfully
    as an IAM Identity Center delegated administrator. It might take some time to
    grant administrative access to the member account.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到一条消息，提示成员账户已成功注册为IAM身份中心的委托管理员。授予成员账户管理员权限可能需要一些时间。
- en: We can customize the default AWS access portal URL (e.g., [https://d-90679fa661.awsapps.com/start/](https://d-90679fa661.awsapps.com/start/)
    ) to one that uses a custom subdomain (e.g., [https://awsseccb.awsapps.com/start](https://awsseccb.awsapps.com/start)
    ) to make it more memorable for our users. For customizing the URL, we can click
    on the **Customize** button from the **Settings summary** section on the right
    side of the IAM Identity Center dashboard, as shown in *Figure 1* *.22* , and
    configure a custom subdomain. Once it has been customized, we won’t be able to
    change it again.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以自定义默认的AWS访问门户URL（例如，[https://d-90679fa661.awsapps.com/start/](https://d-90679fa661.awsapps.com/start/)），使用自定义子域名（例如，[https://awsseccb.awsapps.com/start](https://awsseccb.awsapps.com/start)），以便让用户更容易记住。要自定义URL，我们可以在IAM身份中心仪表板右侧的**设置概述**部分点击**自定义**按钮，如*图1*
    *图22*所示，并配置自定义子域名。自定义完成后，我们将无法再次更改它。
- en: See also
  id: totrans-363
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: We can explore more about IAM Identity Center at [https://www.cloudericks.com/blog/demystifying-aws-iam-identity-center-formerly-aws-sso](https://www.cloudericks.com/blog/demystifying-aws-iam-identity-center-formerly-aws-sso)
    .
  id: totrans-364
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以在[https://www.cloudericks.com/blog/demystifying-aws-iam-identity-center-formerly-aws-sso](https://www.cloudericks.com/blog/demystifying-aws-iam-identity-center-formerly-aws-sso)了解更多关于IAM身份中心的信息。
- en: We can learn more about AWS CLI at [https://www.cloudericks.com/blog/getting-started-with-aws-cli](https://www.cloudericks.com/blog/getting-started-with-aws-cli)
    .
  id: totrans-365
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以在[https://www.cloudericks.com/blog/getting-started-with-aws-cli](https://www.cloudericks.com/blog/getting-started-with-aws-cli)了解更多关于AWS
    CLI的信息。
