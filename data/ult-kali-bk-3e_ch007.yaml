- en: 6 Active Reconnaissance
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 6 主动侦察
- en: Join our book community on Discord
  id: totrans-1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 加入我们的 Discord 书籍社区
- en: '[https://packt.link/SecNet](https://packt.link/SecNet)![Qr code Description
    automatically generated](../media/file211.png)The more information collected about
    a target helps ethical hackers and penetration testers to improve exploit development
    during the weaponization phase of the Cyber Kill Chain and identify the best method
    to deliver the malicious payload to the target. Active reconnaissance helps you
    to collect information that’s not public available, such as which services are
    running and how many ports exists on a targeted system. For instance, if you’re
    targeting a web server, it’s important to identify the web application and its
    version. In addition, it would be useful to also identify the operating system
    that’s hosting the web application.During this chapter, you will understand the
    need for active reconnaissance techniques during ethical hacking and penetration
    testing assessments on a target system, network and organization. You will explore
    active scanning techniques which are commonly used to identify live systems, their
    open port and running services. Furthermore, you will explore various techniques
    used by seasoned penetration testers to profile systems and identify their attack
    surface, which can help improve their plan of attack. Lastly, you will learn how
    to perform enumeration on common network services and identify whether an organization
    is leaking data on their cloud platform.In this chapter, we will cover the following
    topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/SecNet](https://packt.link/SecNet)![Qr code Description
    automatically generated](../media/file211.png) 收集更多关于目标的信息可以帮助道德黑客和渗透测试人员在网络攻击链的武器化阶段改进漏洞利用的开发，并确定将恶意载荷传递给目标的最佳方法。主动侦察帮助你收集那些非公开的信息，比如哪些服务正在运行、目标系统上有多少端口。例如，如果你正在针对一个
    web 服务器，识别该 web 应用程序及其版本是非常重要的。此外，识别托管该 web 应用程序的操作系统也会非常有用。在本章中，您将了解在道德黑客和渗透测试评估中，针对目标系统、网络和组织时，主动侦察技术的必要性。您将探索常用的主动扫描技术，这些技术通常用于识别活动系统、开放端口和正在运行的服务。此外，您还将探索经验丰富的渗透测试人员用来对系统进行分析并识别其攻击面的方法，这些方法有助于改善他们的攻击计划。最后，您将学习如何对常见的网络服务进行枚举，并识别一个组织是否在其云平台上泄露数据。在本章中，我们将涵盖以下内容：'
- en: Understanding active information
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解主动信息收集
- en: Profiling websites using EyeWitness
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 EyeWitness 对网站进行分析
- en: Exploring active scanning techniques
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索主动扫描技术
- en: Enumerating common network services
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 枚举常见的网络服务
- en: Discovering data leaks in the cloud
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发现云中的数据泄露
- en: Let’s dive in!
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们深入了解！
- en: Technical Requirements
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To follow along with the exercises in this chapter, please ensure that you
    have met the following hardware and software requirements:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了跟随本章的练习，请确保您已满足以下硬件和软件要求：
- en: Kali Linux - [https://www.kali.org/get-kali/](https://www.kali.org/get-kali/)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux - [https://www.kali.org/get-kali/](https://www.kali.org/get-kali/)
- en: EyeWitness - [https://github.com/RedSiege/EyeWitness](https://github.com/RedSiege/EyeWitness)
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: EyeWitness - [https://github.com/RedSiege/EyeWitness](https://github.com/RedSiege/EyeWitness)
- en: S3Scanner - [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: S3Scanner - [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
- en: Understanding active information
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 理解主动信息收集
- en: 'Using active reconnaissance techniques enables ethical hackers and penetration
    tester to use a more direct approach when engaging the target. For instance, many
    active reconnaissance techniques involves establishing a logical network connection
    between your attacker machine, such as Kali Linux and the targeted system(s) over
    the network. With active reconnaissance, you can send specially crafted probes
    to collect specific details such as the following:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 使用主动侦察技术使道德黑客和渗透测试人员能够采取更直接的方式与目标进行接触。例如，许多主动侦察技术涉及在攻击者机器（如 Kali Linux）和目标系统之间建立一个逻辑网络连接。通过主动侦察，您可以发送特制的探测包，收集如下一些特定细节：
- en: Determine how live hosts are on the network.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定网络中有多少活动主机。
- en: Determine whether the targeted system is online.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定目标系统是否在线。
- en: Identify open port numbers and running services.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别开放的端口号和正在运行的服务。
- en: Profile the operating system on the targeted machine.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对目标机器上的操作系统进行分析。
- en: Identify whether the targeted system has any network shares.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定目标系统是否有任何网络共享。
- en: Therefore, before launching any type of network-based attack, it's important
    to determine whether there are live systems on the network and the target is online.
    Imagine launching an attack towards a specific system, only to realize the target
    is offline and the attack has failed. Hence, it doesn't make sense to target an
    offline device as it would be unresponsive and increase the risk of detection
    by the organization’s security team.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在发起任何类型的基于网络的攻击之前，确定网络上是否有在线的系统和目标是否在线非常重要。试想，如果你对一个特定系统发起攻击，却发现目标离线，攻击就会失败。因此，针对离线设备发起攻击是没有意义的，因为它将无法响应，且可能增加被组织安全团队检测到的风险。
- en: Unlike passive reconnaissance which leverages **Open Source Intelligence** (**OSINT**)
    from public data sources, using active reconnaissance techniques does increase
    the risk of being detected by the target’s security systems and triggering alerts.
    Therefore, it’s important to consider the threat level for each type of attack
    during your planning phase.
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 与利用来自公共数据源的**开源情报**（**OSINT**）进行被动侦察不同，使用主动侦察技术确实增加了被目标安全系统检测到并触发警报的风险。因此，在规划阶段，考虑每种攻击类型的威胁等级非常重要。
- en: As compared to adversaries, ethical hackers and penetration testers uses similar
    techniques to simulate a real-world cyber-attack to identify how a real attacker
    would collect and leverage information to identify security vulnerabilities and
    compromise their targets.In the next section, you will learn how to automate the
    process of taking screenshots of targeted domains and systems on a network.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 与对抗者相比，伦理黑客和渗透测试人员使用类似的技术来模拟真实的网络攻击，识别真实攻击者如何收集和利用信息来发现安全漏洞并破坏其目标。在下一部分，你将学习如何自动化截取目标域和网络系统截图的过程。
- en: Profiling websites using EyeWitness
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 EyeWitness 对网站进行分析
- en: 'What do you do after discovering additional sub-domains of a targeted organization
    on the internet? A common and obvious practice would be to visit each sub-domain
    to determine whether it leads to a vulnerable web application or system which
    can be exploited to gain a foothold into the targeted organization’s network.
    However, manually visiting each sub-domain can be quite time consuming if you
    need to visit 100+ sub-domains for a targeted organization. As an aspiring ethical
    hacker and penetration tester, using a tool such as **EyeWitness** enables you
    to automate the process of checking and capturing a screenshot of each sub-domain.
    To get started using EyeWitness, please use the following instructions:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在互联网上发现目标组织的附加子域后，你应该怎么做？一种常见且显而易见的做法是访问每个子域，查看它是否指向一个容易被利用的脆弱网络应用或系统，从而获得进入目标组织网络的机会。然而，如果你需要访问一个目标组织的
    100 个以上子域，手动访问每个子域可能会非常耗时。作为一名有志的伦理黑客和渗透测试人员，使用像**EyeWitness**这样的工具可以帮助你自动化检查和截取每个子域的截图。开始使用
    EyeWitness，请按照以下说明操作：
- en: 'Power-on the **Kali Linux** virtual machine, open the **Terminal** and use
    the following commands to clone the EyeWitness repository:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 **Kali Linux** 虚拟机，打开 **Terminal**，然后使用以下命令克隆 EyeWitness 仓库：
- en: '[PRE0]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, execute the `setup.py` script to install EyeWitness by using the following
    commands:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，执行 `setup.py` 脚本来安装 EyeWitness，使用以下命令：
- en: '[PRE1]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Next, use the `cd ..` command to move up one directory , as shown below:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用 `cd ..` 命令向上移动一个目录，如下所示：
- en: '[PRE2]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Next, use the following commands to create a new text file within the `/home/kali/`
    directory, then write a targeted sub-domain into it:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令在 `/home/kali/` 目录中创建一个新文本文件，并在其中写入目标子域：
- en: '[PRE3]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `touch <filename>` command enables you to create a new file within Linux.
    The `echo` command allows you to write contents within a file.
  id: totrans-34
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`touch <filename>` 命令允许你在 Linux 中创建一个新文件。`echo` 命令允许你在文件中写入内容。'
- en: 'Next, use the following command to enable EyeWitness to capture screenshots
    of each sub-domain found within the `eyewitness_targets.txt` file:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令让 EyeWitness 捕捉 `eyewitness_targets.txt` 文件中找到的每个子域的截图：
- en: '[PRE4]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The following is a breakdown of each syntax used in the preceding command:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前述命令中使用的每种语法的详细说明：
- en: '`--web`: Specifies to take HTTP screenshots.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--web`：指定截取 HTTP 截图。'
- en: '`-f`: Specifies the source file with the list of targeted domains and sub-domains.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-f`：指定包含目标域和子域列表的源文件。'
- en: '`-d`: Specifies the output directory to save the results and report.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-d`：指定输出目录以保存结果和报告。'
- en: '`--prepend-https`: Specifies to prepend `http://` and `https://` to the list
    of domains and sub-domains.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--prepend-https`：指定在域名和子域名前添加`http://`和`https://`。'
- en: 'The following screenshot shows the process of capturing the screenshot(s):'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了捕获截图的过程：
- en: '![](../media/file212.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file212.png)'
- en: 'If you type `Y` and hit Enter, the EyeWitness report will automatically load
    and open within the web browser, as shown below:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你输入`Y`并按回车，EyeWitness 报告将自动加载并在网页浏览器中打开，如下所示：
- en: '![](../media/file213.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file213.png)'
- en: As you have seen, using a tool such as EyeWitness can save you a lot of time
    as compared to checking each sub-domain manually. You can quickly browse each
    image within the generated report to identify any login portals and sensitive
    directories on a targeted domain.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，使用像 EyeWitness 这样的工具，相比手动检查每个子域，可以节省大量时间。你可以快速浏览生成报告中的每张图片，以识别目标域名上的登录门户和敏感目录。
- en: 'To learn more about EyeWitness, please see: [https://github.com/RedSiege/EyeWitness](https://github.com/RedSiege/EyeWitness)
    and use the `./EyeWitness.py –h` command to view the help menu.'
  id: totrans-47
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 要了解更多关于 EyeWitness 的信息，请访问：[https://github.com/RedSiege/EyeWitness](https://github.com/RedSiege/EyeWitness)，并使用`./EyeWitness.py
    –h`命令查看帮助菜单。
- en: Having completed this section, you have learned how to automate the process
    of capturing screenshots of many websites using EyeWitness. In the next section,
    you will explore various scanning and fingerprinting techniques.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本节后，你已经学会了如何使用 EyeWitness 自动化捕获多个网站的截图。在下一节中，你将探索各种扫描和指纹识别技术。
- en: Exploring active scanning techniques
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 探索主动扫描技术
- en: 'As an aspiring ethical hacker and penetration tester, it’s essential to develop
    a solid foundation on understanding how to leverage scanning techniques to efficiently
    discover and profile targeted systems on an organization’s network. Many organizations
    focus on securing their perimeter network and sometimes do not apply equal focus
    on securing their internal network. Quite often, you will discover that over 90%
    of a cyberattack or threat usually originates from the inside network. Due to
    this, many organizations think the attacker will launch their attack from the
    internet, which will then be blocked by their network-based firewall.The following
    diagram shows a simplified overview of a typical deployment of a firewall:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一名有志的伦理黑客和渗透测试员，建立扎实的基础，理解如何利用扫描技术高效发现并概述目标系统在组织网络中的情况至关重要。许多组织专注于保护其外围网络，但有时没有给予内部网络足够的安全关注。你会发现，超过90%的网络攻击或威胁通常源自内部网络。因此，许多组织认为攻击者会从互联网发起攻击，然后被他们的基于网络的防火墙拦截。下图展示了防火墙典型部署的简化概览：
- en: '![](../media/file214.png)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file214.png)'
- en: As shown in the preceding diagram, the network-based firewall is implemented
    as the edge device between the organization’s internal network and the internet.
    One of its role is to filter traffic between networks and prevent malicious traffic
    from passing through to the other side, whether it’s malicious traffic originating
    from the internet with a destination to the internal systems on the organization’s
    network and vice versa. However, threat actors are continuously learning how organizations
    implement their infrastructure and security solutions, as well as the decisions
    that both the leadership team and IT professionals make when securing their assets.While
    many organizations are investing into their cyber defenses to ensure their assets
    and people are protected from adversaries and cyber-attacks, there are still so
    many organizations around the world without firewalls, misconfigured network devices
    and security appliances, and unpatched operating systems. Metaphorically speaking,
    it’s only a matter of time for an adversary to discover this gold mine and starts
    *living of the land*. During the reconnaissance phase of the Cyber Kill Chain
    and common penetration testing methodology, ethical hackers and penetration testers
    will eventually need to directly engage with the target to collect information
    that’s not available from **Open Source Intelligence** (**OSINT**) and use active
    reconnaissance techniques such as scanning and enumeration.Scanning is a technique
    that's used by threat actors to discover live systems on a network, identify the
    open service ports on a system, and discover vulnerabilities on host machines
    and even their operating system architecture. The information that's gathered
    from scanning helps the penetration tester gain a clearer view of their targets
    compared to passive information gathering.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 如前面的图示所示，基于网络的防火墙作为组织内部网络和互联网之间的边缘设备实现。它的角色之一是过滤网络之间的流量，防止恶意流量通过防火墙进入另一侧，无论是来自互联网并指向组织内部系统的恶意流量，还是反向流量。然而，威胁行为者一直在不断学习组织如何实现其基础设施和安全解决方案，以及领导团队和
    IT 专业人员在保护资产时所做的决策。尽管许多组织在投资网络防御以确保其资产和人员免受敌对行为者和网络攻击的侵害，但世界上仍有很多组织没有防火墙，网络设备和安全设备配置错误，操作系统没有打补丁。比喻来说，敌人发现这个“金矿”并开始*以地取利*只是时间问题。在网络杀伤链和常见渗透测试方法的侦察阶段，伦理黑客和渗透测试人员最终需要直接与目标接触，收集那些无法通过**开放源信息**（**OSINT**）获得的信息，并使用主动侦察技术，如扫描和枚举。扫描是一种威胁行为者用来发现网络中活跃系统、识别系统上的开放服务端口，并发现主机机器上的漏洞，甚至是它们的操作系统架构的技术。通过扫描收集到的信息帮助渗透测试人员比被动信息收集更清晰地了解他们的目标。
- en: Do not perform any type of scanning on systems and networks that you do not
    own or have legal permission to do so. Scanning is considered illegal in many
    countries.
  id: totrans-53
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 不要对你没有所有权或没有合法许可的系统和网络进行任何形式的扫描。扫描在许多国家被视为非法行为。
- en: Penetration testers always need to improve their critical thinking mindset to
    think like a real threat actor, especially if they want to perform a successful
    penetration test on a targeted organization. In this section, you will learn about
    various techniques and methodologies for performing scanning on a targeted network
    and how to profile systems.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员需要不断提升他们的批判性思维，以像真正的威胁行为者一样思考，特别是当他们想对一个目标组织进行成功的渗透测试时。在本节中，你将学习如何对目标网络执行扫描的各种技术和方法，以及如何对系统进行建模。
- en: Changing your MAC address
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更改你的 MAC 地址
- en: 'The **Network Interface Card** (**NIC**) is a network adapter which enables
    a system to communicate over a wired or wireless network. For instance, before
    your devices sends data on a network, the NIC converts the message into a signal
    that’s supported over the media for transmission, such as electrical signals for
    copper cables, light signals for fiber optics and radio frequency for wireless
    communication. In addition, the NIC on each device contains a globally unique
    **Media Access Control** (**MAC**) address, sometimes referred to as a *burned-in
    address* that’s theoretically not changeable. Before a device transmits data over
    a network, the sender device automatically inserts the source and destination
    MAC address onto the frame header of the message. The source MAC address helps
    the recipient identify the sender of the message, and the destination MAC address
    helps the network switches forward the message to the intended destination. The
    MAC address is a 48-bit address written in hexadecimal. The first 24-bits of the
    address is known as the **Organizational Unique Identifier** (**OUI**) which helps
    IT professionals to determine the vendor of a device. While the last 24-bits is
    uniquely assigned by the vendor. Therefore, when your NIC sends traffic out on
    a network, your real MAC address is also inserted within the frame header, and
    this information can be used to identify your machine on a network. As an aspiring
    penetration tester, you can change the MAC address on both your Ethernet and wireless
    network adapters by using a pre-installed tool known as **MAC Changer**.Changing
    your MAC address allows you to trick other devices on the network into thinking
    your system is a common device that belong within the organization’s network infrastructure,
    such as a network device, a printer, or a vendor-specific device. This technique
    is commonly used to protect the identity of your attacker machine, bypass MAC
    filtering rules on network devices and evade network restrictions while on your
    target’s network.To learn how to change your MAC address using **MAC Changer**,
    please use the following instructions:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**网络接口卡**（**NIC**）是一个网络适配器，使得系统能够通过有线或无线网络进行通信。例如，在设备通过网络发送数据之前，NIC将消息转换成可以通过介质传输的信号，比如铜缆的电信号、光纤的光信号和无线通信的射频信号。此外，设备上的每个NIC都包含一个全球唯一的**媒体访问控制**（**MAC**）地址，有时被称为*固化地址*，理论上是不可更改的。在设备通过网络传输数据之前，发送方设备会自动将源和目的MAC地址插入到消息的帧头中。源MAC地址帮助接收方识别消息的发送者，目的MAC地址帮助网络交换机将消息转发到目标地址。MAC地址是一个48位地址，采用十六进制表示。地址的前24位被称为**组织唯一标识符**（**OUI**），它帮助IT专业人员确定设备的供应商。而地址的后24位则由供应商唯一分配。因此，当你的NIC在网络上发送流量时，你的真实MAC地址也会被插入到帧头中，这些信息可以用来识别你在网络上的机器。作为一名有志的渗透测试者，你可以通过使用一个预装工具**MAC
    Changer**来改变你以太网和无线网络适配器的MAC地址。改变你的MAC地址可以让你欺骗网络中的其他设备，让它们认为你的系统是一个属于组织网络基础设施的常见设备，比如网络设备、打印机或供应商特定设备。这种技术通常用于保护攻击者机器的身份，绕过网络设备的MAC过滤规则，并在目标网络上避开网络限制。要学习如何使用**MAC
    Changer**更改你的MAC地址，请按照以下说明操作：'
- en: 'Power-on the **Kali Linux** virtual machine and use the `ifconfig` command
    to determine the original MAC address on your network adapters, as shown below:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动**Kali Linux**虚拟机，并使用`ifconfig`命令确定网络适配器的原始MAC地址，如下所示：
- en: '![](../media/file215.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file215.png)'
- en: As shown in the preceding screenshot, the `ifconfig` command was used to display
    all connected network adapters on the Kali Linux virtual machine. In addition,
    this command enables us to view the original MAC address on each network adapter,
    within the **ether** field.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如上图所示，`ifconfig`命令被用来显示Kali Linux虚拟机上所有连接的网络适配器。此外，这个命令还使我们能够查看每个网络适配器上的原始MAC地址，在**ether**字段中显示。
- en: 'Next, logically turn down the **eth0** interface with the following commands:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令逻辑性地关闭**eth0**接口：
- en: '[PRE5]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Next, use the `macchanger --help` command to view a list of available options,
    as shown below:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用`macchanger --help`命令查看可用选项列表，如下所示：
- en: '![](../media/file216.png)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file216.png)'
- en: 'Next, set a randomized MAC address on the **eth0** network adapter by using
    the following commands:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令在**eth0**网络适配器上设置一个随机的MAC地址：
- en: '[PRE6]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The following screenshot shows the current, permanent and the newly generated
    MAC address for the **eth0** network adapter:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了 **eth0** 网络适配器的当前、永久和新生成的 MAC 地址：
- en: '![](../media/file217.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file217.png)'
- en: 'Next, re-enable the **eth0** interface by using the following commands:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，通过使用以下命令重新启用 **eth0** 接口：
- en: '[PRE7]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Next, use the `ifconfig` command once more to verify the **eth0** has a spoofed
    MAC address, as shown below:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，再次使用 `ifconfig` 命令来验证 **eth0** 是否具有伪造的 MAC 地址，如下所示：
- en: '![](../media/file218.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file218.png)'
- en: 'Lastly, to further verify the vendor of the spoofed MAC address, go to [https://macvendors.com/](https://macvendors.com/)
    and enter the MAC address, as shown below:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，为了进一步验证伪造的 MAC 地址的供应商，请访问[https://macvendors.com/](https://macvendors.com/)，并输入
    MAC 地址，如下所示：
- en: '![](../media/file219.png)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file219.png)'
- en: Having completed this exercise, you have learnt how spoof your MAC address on
    Kali Linux. However, it’s important to consider using a MAC address that’s associated
    to a common vendor of networking devices or system to reduce the risk of detection
    by the organization’s security team. Next, you will learn how perform host discovery
    to identify live systems on an internal network.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此练习后，你已经学会了如何在 Kali Linux 上伪造 MAC 地址。然而，重要的是要考虑使用与常见网络设备或系统供应商相关的 MAC 地址，以减少被组织安全团队检测到的风险。接下来，你将学习如何执行主机发现，以识别内部网络上的活动系统。
- en: Performing host discovery
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 执行主机发现
- en: 'Discovering live hosts on a targeted network is an essential stage when performing
    a penetration test. Let''s imagine you''re an ethical hacker or a penetration
    tester; your targeted organization permits you to directly connect your attacker
    machine with Kali Linux on their network to perform security testing on their
    internal network. You''re eager to start discovering security vulnerabilities
    and hacking systems, but you''re not sure whether the targeted hosts are online.In
    this section, you will learn about the skills you will need to perform various
    types of active reconnaissance on an organization''s networks using various tools
    and techniques. However, to ensure you can perform these exercises in a safe space,
    please use the following guidelines:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在目标网络上发现活动主机是进行渗透测试时的一个重要阶段。假设你是一名道德黑客或渗透测试员，你的目标组织允许你将攻击者机器直接连接到他们的网络，并对其内部网络进行安全测试。你迫不及待地想开始发现安全漏洞并入侵系统，但你不确定目标主机是否在线。在本节中，你将学习使用各种工具和技术进行对组织网络的多种主动侦察所需的技能。为了确保你能在安全的空间中执行这些练习，请遵循以下指南：
- en: Ensure you do not scan systems that you do not own or have been granted legal
    permission.
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保你不会扫描你不拥有或没有获得合法许可的系统。
- en: Ensure the network adapter of Kali Linux is assigned to the **PentestNet** network
    within Oracle VM VirtualBox Manager.
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保 Kali Linux 的网络适配器已在 Oracle VM VirtualBox Manager 中分配给 **PentestNet** 网络。
- en: The PentestNet network will be our simulated organization network.
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PentestNet 网络将作为我们模拟的组织网络。
- en: 'To get started with this exercise, please use the following instructions:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始此练习，请使用以下说明：
- en: Power-on the **Kali Linux**, **Metasploitable 2** and **Metasploitable 3** (**Windows
    version**) virtual machines.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 **Kali Linux**、**Metasploitable 2** 和 **Metasploitable 3**（**Windows 版本**）虚拟机。
- en: 'On **Kali Linux**, open the **Terminal** the use the `ifconfig` or `ip address`
    command to determine if your attacker machine (Kali Linux) is connected to the
    targeted network (`172.30.1.0/24`), as shown below:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Kali Linux** 上，打开 **Terminal**，然后使用 `ifconfig` 或 `ip address` 命令来确定你的攻击者机器（Kali
    Linux）是否连接到目标网络（`172.30.1.0/24`），如下所示：
- en: '![](../media/file220.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file220.png)'
- en: As an aspiring ethical hacker and penetration tester, it’s important to verify
    whether your attacker machine has a valid IP address and subnet mask on the targeted
    network during the internal network penetration test. As shown in the preceding
    screenshot, `eth1` is connected to the *PentestNet* environment which is our targeted
    network.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一名有志的道德黑客和渗透测试员，在进行内部网络渗透测试时，验证你的攻击者机器是否在目标网络上拥有有效的 IP 地址和子网掩码是非常重要的。正如前面的截图所示，`eth1`
    已连接到 *PentestNet* 环境，这是我们目标网络。
- en: Keep in mind, wired network adapters are identified with **eth** and wireless
    adapters are identified with **wlan**.
  id: totrans-85
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 请记住，有线网络适配器标识为 **eth**，无线适配器标识为 **wlan**。
- en: Additionally, the **inet** field contains the IP address that’s assigned on
    the interface of the Kali Linux virtual machine. However, the IP address shown
    in the preceding screenshot may be different from the address shown on your machine,
    that's okay once it's on the `172.30.1.0/24` network. Furthermore, identifying
    the IP address on the network adapter will enable us to exclude scanning our own
    machine in the next steps.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，**inet**字段包含了分配给Kali Linux虚拟机接口的IP地址。然而，前面截图中显示的IP地址可能与你机器上的地址不同，只要它在`172.30.1.0/24`网络上即可。进一步说，识别网络适配器上的IP地址将帮助我们在接下来的步骤中排除对自己机器的扫描。
- en: 'Ethical hackers and penetration testers often needs to determine the Network
    ID and range of IP addresses within a network before performing host discovery
    on an internal network. While its recommended to build a solid foundation on networking
    prior to learning cybersecurity and penetration testing, the following website
    is an online subnet calculator that will help you determine the IP ranges and
    much more: [https://www.calculator.net/ip-subnet-calculator.html](https://www.calculator.net/ip-subnet-calculator.html).'
  id: totrans-87
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 道德黑客和渗透测试人员通常需要在对内部网络进行主机发现之前，确定网络的网络ID和IP地址范围。虽然建议在学习网络安全和渗透测试之前先打好网络基础，但以下网站是一个在线子网计算器，可以帮助你确定IP范围等更多内容：[https://www.calculator.net/ip-subnet-calculator.html](https://www.calculator.net/ip-subnet-calculator.html)。
- en: 'Next, let’s use **Netdiscover** to passively scan for live systems on the *PentestNet*
    environment (`172.30.1.0/24`), using the following commands:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们使用**Netdiscover**在*PentestNet*环境（`172.30.1.0/24`）中进行被动扫描，使用以下命令：
- en: '[PRE8]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The `-i` syntax is commonly used to specify the listening interface and using
    the `-p` syntax performs a passive scan by enabling Netdiscover the capture and
    analyze **Address Resolution Protocol** (**ARP**) messages on a network, by analyzing
    the source and destination IP and MAC addresses helps us to identify live hosts
    on a network, as shown below:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '`-i`语法通常用于指定监听接口，使用`-p`语法进行被动扫描，使Netdiscover能够捕获并分析网络上的**地址解析协议**（**ARP**）消息，通过分析源和目标的IP和MAC地址帮助我们识别网络上的在线主机，如下所示：'
- en: '![](../media/file221.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file221.png)'
- en: As shown in the preceding screenshot, Netdiscover provided the IP addresses,
    MAC addresses, vendors, and hostnames of the live systems on the targeted network.
    Where, `172.30.1.48` is assigned to Metasploitable 3 – Windows and `172.30.1.49`
    is assigned to the Metasploitable 2 virtual machines. Furthermore, leveraging
    the MAC vendor information helps us determine the type of devices are on the network
    and can be useful when researching security vulnerabilities for a specific system
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 如前面的截图所示，Netdiscover提供了目标网络中在线系统的IP地址、MAC地址、厂商和主机名。其中，`172.30.1.48`分配给了Metasploitable
    3 – Windows，而`172.30.1.49`则分配给了Metasploitable 2虚拟机。此外，利用MAC厂商信息有助于我们确定网络上设备的类型，并且在研究特定系统的安全漏洞时非常有用。
- en: 'Next, to perform an active host discovery scan using Netdiscover, use the following
    commands:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，要使用Netdiscover进行主动主机发现扫描，请使用以下命令：
- en: '[PRE9]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Since the active scan does not wait for ARP message, Netdiscover sends its
    own probes to all usable IP addresses within the `172.30.1.0/24` network. Only
    live systems will respond, enabling Netdiscover to analyze each response messages
    to identify the IP and MAC addresses of live hosts on the network, as shown below:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 由于主动扫描不等待ARP消息，Netdiscover会向`172.30.1.0/24`网络内所有可用的IP地址发送自己的探测请求。只有在线的系统才会响应，这使得Netdiscover能够分析每个响应消息，识别网络中在线主机的IP和MAC地址，如下所示：
- en: '![](../media/file222.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file222.png)'
- en: 'Next, let’s use **Network Mapper** (**Nmap**) to perform a *ping sweep* over
    the entire targeted network and exclude our attacker machine during the scanning
    process, use the following commands:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们使用**Network Mapper**（**Nmap**）对整个目标网络进行*ping扫描*，并在扫描过程中排除我们的攻击者机器，使用以下命令：
- en: '[PRE10]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'A **ping sweep** is a basic scanning technique that’s used by IT professionals
    to determine which systems are online within a network. It’s the automated process
    of pinging each usable IP address within a network and observing which devices
    are responding. However, the `ping` utility within an operating system sends **Internet
    Control Message Protocol** (**ICMP**) **ECHO Request** message to the destination
    and a live system will respond with an **ICMP ECHO Reply** message. It’s a common
    security practice for cybersecurity professionals to disable ICMP responses on
    critical systems within their organization, this reduces the likelihood that a
    novice hacker is to discover a live host. Therefore, if an attacker sends **ICMP
    ECHO Request** messages to a system that’s configured to not respond, the novice
    attacker will think the target is offline. On the other hand, seasoned threat
    actors and penetration testers who understands the security vulnerabilities that
    exists within the **Transmission Control Protocol/Internet Protocol** (**TCP/IP**)
    networking model can bypass this minor security mechanism and instead send **Transmission
    Control Protocol** (**TCP**) messages to specific ports on the targeted system.
    This technique leverages the design of TCP and tricks the targeted system to respond,
    indicating it’s live on the network.The following screenshot shows there are 2
    live hosts, `172.30.1.48` and `172.30.1.49` on the network:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**Ping扫描**是一种基本的扫描技术，IT专业人员用它来确定网络中哪些系统在线。它是通过自动化的过程对网络中的每个可用IP地址进行ping操作，并观察哪些设备做出响应。然而，操作系统中的`ping`工具会发送**互联网控制消息协议**（**ICMP**）**回显请求**消息到目标，存活的系统会以**ICMP回显应答**消息进行响应。网络安全专业人士通常会在关键系统上禁用ICMP响应，这是一个常见的安全做法，这样可以降低新手黑客发现在线主机的可能性。因此，如果攻击者发送**ICMP回显请求**消息到配置为不响应的系统，初学者攻击者可能会认为目标系统离线。另一方面，熟练的威胁行为者和渗透测试人员了解**传输控制协议/互联网协议**（**TCP/IP**）网络模型中的安全漏洞，可以绕过这一小型安全机制，转而向目标系统的特定端口发送**传输控制协议**（**TCP**）消息。这种技术利用了TCP的设计，欺骗目标系统做出响应，表明它在网络上是存活的。以下截图显示了网络中有两个存活的主机，`172.30.1.48`和`172.30.1.49`：'
- en: '![](../media/file223.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file223.png)'
- en: 'The `-sn` syntax on Nmap is used to specify a ping scan but Nmap does not send
    ICMP messages to the target. Instead, Nmap sends TCP messages to specific ports
    on the targeted system as shown in the Wireshark packet capture below:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap中的`-sn`语法用于指定ping扫描，但Nmap不会向目标发送ICMP消息。相反，Nmap会向目标系统的特定端口发送TCP消息，如下面Wireshark数据包捕获所示：
- en: '![](../media/file224.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file224.png)'
- en: Nmap sends specially crafted TCP **Synchronization** (**SYN**) packets to the
    targeted host, with the intention of triggering a TCP **Reset** (**RST**) or TCP
    **Acknowledgement** (**ACK**) as a response from a live/online host.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap发送特别构造的TCP **同步**（**SYN**）数据包到目标主机，目的是触发来自存活/在线主机的TCP **重置**（**RST**）或TCP
    **确认**（**ACK**）响应。
- en: 'To learn more on how TCP establishes a connection with a destination host using
    the TCP 3-way handshake, please see: [https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/](https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/).'
  id: totrans-104
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 要了解更多关于TCP如何通过TCP三次握手与目标主机建立连接的信息，请参见：[https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/](https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/)。
- en: Identifying live hosts on a network helps ethical hackers and penetration testers
    to create a network topology and identify whether their targets are online before
    proceeding to profile the targets. Next, you will learn how identify open ports,
    running services and determine the operating system of a target.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在网络中识别存活主机有助于道德黑客和渗透测试人员创建网络拓扑，并在进一步分析目标之前，确认目标是否在线。接下来，您将学习如何识别开放端口、正在运行的服务并确定目标的操作系统。
- en: Identifying open ports, services and operating systems
  id: totrans-106
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 识别开放端口、服务和操作系统
- en: 'After performing host discovery, the next step is to identify any open ports
    on the targeted system and determine which services are mapped to those open ports.
    There are various techniques that a penetration tester can use to identify the
    open ports on a targeted system. Some techniques are manual, while others can
    simply be automated using the Nmap tool.To gets started fingerprinting using Nmap,
    please use the following instructions:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行主机发现后，下一步是识别目标系统上的任何开放端口，并确定这些开放端口映射到哪些服务。渗透测试者可以使用各种技术来识别目标系统上的开放端口。有些技术是手动的，而其他技术可以简单地使用Nmap工具自动化。要开始使用Nmap进行指纹识别，请使用以下说明：
- en: Firstly, ensure the **Kali Linux**, **Metasploitable 2**, and **Metasloitable
    3** (**Windows version**) virtual machines are powered-on.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先确保**Kali Linux**、**Metasploitable 2**和**Metasploitable 3**（**Windows版本**）虚拟机已启动。
- en: 'On **Kali Linux**, open the **Terminal** and use the following commands to
    perform a basic Nmap scan to determine whether any of the top 1000 ports are open
    on the Metasploitable 3 (Windows version) virtual machine:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Kali Linux**上打开**终端**，并使用以下命令执行基本的Nmap扫描，以确定Metasploitable 3（Windows版本）虚拟机上是否有任何前1000个端口是打开的：
- en: '[PRE11]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'As shown in the following screenshot, Nmap indicates there are 20 TCP open
    ports and provided the name of their associated services:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 如下截图所示，Nmap指示有20个TCP开放端口，并提供其关联服务的名称：
- en: '![](../media/file225.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file225.png)'
- en: Using the information from this scan enables you to start fingerprinting your
    targeted systems. As a penetration tester, you can determine which ports are open
    and discover how they can be used as a point-of-entry into the target, and look
    for security vulnerabilities on the running services.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此扫描的信息使您能够开始指纹识别您的目标系统。作为渗透测试者，您可以确定哪些端口是打开的，并了解它们如何作为进入目标的入口点，并寻找运行服务的安全漏洞。
- en: As an aspiring ethical hacker and penetration, it’s okay if you don’t initially
    understand the role and function of service ports on a system. However, its recommended
    to perform research on anything you’re not familiar with to gain a better understanding
    of the technology or topic. For instance, there are many service ports and each
    if associated with a specific application-layer service, such as TCP port 443
    is associated to the **Hypertext Transfer Protocol Secure** (**HTTPS**) protocol
    that’s used for secure web communication.
  id: totrans-114
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 作为一名有抱负的道德黑客和渗透测试者，如果你一开始不理解系统上服务端口的角色和功能，那没关系。然而，建议对你不熟悉的内容进行研究，以更好地理解技术或主题。例如，有许多服务端口，每个端口都与特定的应用层服务相关联，如TCP端口443与**超文本传输安全协议**（**HTTPS**）协议相关联，用于安全的网络通信。
- en: 'Next, let’s perform an advanced scan to identify the targeted system’s operating
    system, service versions and retrieve **Server Message Block** (**SMB**) details,
    using the following the commands:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们执行高级扫描，以识别目标系统的操作系统、服务版本，并检索**服务器消息块**（**SMB**）的详细信息，使用以下命令：
- en: '[PRE12]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Let''s take a look at each syntax that were used in the preceding command:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看在前述命令中使用的每个语法：
- en: '`-A`: This enables Nmap to profile the target to identify its operating system,
    service versions, and script scanning, as well as perform a traceroute.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-A`：这使Nmap能够对目标进行分析，以识别其操作系统、服务版本和脚本扫描，同时执行跟踪路由。'
- en: '`-T`: This syntax specifies the timing options for the scan, which ranges from
    0 – 5, where 0 is very slow and 5 is the fastest. This command is useful for preventing
    too many probes from being sent to the targeted system too quickly which may trigger
    alerts.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-T`：此语法指定了扫描的时间选项，范围从0到5，其中0非常缓慢，5最快。此命令有助于防止向目标系统发送太多探测，从而可能触发警报。'
- en: '`-p`: Using the `-p` syntax allows you to specify targeted port(s) to identify
    as opened or closed on a system. You can specify `-p80` to scan for port 80 only
    on the target and `-p-` to scan for all 65,535 open ports.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-p`：使用`-p`语法允许您指定要在系统上标识为打开或关闭的目标端口。您可以指定`-p80`仅在目标上扫描端口80，并使用`-p-`扫描所有65,535个开放端口。'
- en: By default, Nmap scans TCP ports only. Therefore, if a target is running a service
    on a **User Datagram Protocol** (**UDP**) server port, there's a possibility you
    will miss it. To perform a UDP scan on a port or range of ports, use the `-p U:53`
    command, where 53 is the targeted port number.
  id: totrans-121
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 默认情况下，Nmap仅扫描TCP端口。因此，如果目标在**用户数据报协议**（**UDP**）服务器端口上运行服务，您可能会错过它。要在端口或端口范围上执行UDP扫描，请使用`-p
    U:53`命令，其中53是目标端口号。
- en: 'The following screenshots the upper-portion of the scan results:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了扫描结果的上半部分：
- en: '![](../media/file226.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file226.png)'
- en: 'As shown in the preceding screenshot, Nmap was able to retrieve a lot more
    in-depth information about our target, such as the service versions of each service
    that is associated with an open port. It was also able to perform banner grabbing
    and determine whether there''s an authentication system/login mechanism for each
    service. The following screenshot is the lower-portion of the same scan results:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如上图所示，Nmap 能够提取更多关于目标的详细信息，如与开放端口相关联的每个服务的版本号。它还能够执行 banner grabbing，并确定每个服务是否有认证系统/登录机制。以下截图显示了相同扫描结果的下半部分：
- en: '![](../media/file227.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file227.png)'
- en: 'As shown in the preceding screenshot, Nmap was able to identify the host operating
    system on the target as a Windows Server 2008 R2 machine with service pack 1\.
    In addition, Nmap was able to determine the hostname of the system and whether
    it’s connected to a domain or not based on the Workgroup name. Whenever a Windows-based
    system is not connected to a **Domain Controller** (**DC**), the default Workgroup
    is called `Workgroup`. Furthermore, the Nmap scan was able to perform a basic
    SMB scan to identify the operation system, this also indication the targeted system
    may have file and printer shares available.The following are additional syntax
    which can be used during the scanning process with Nmap:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如上图所示，Nmap 能够识别目标主机的操作系统为 Windows Server 2008 R2，且安装了 Service Pack 1。此外，Nmap
    还能够确定系统的主机名，并根据工作组名称判断该系统是否连接到域。如果一个基于 Windows 的系统没有连接到**域控制器**（**DC**），则默认的工作组名称为
    `Workgroup`。此外，Nmap 扫描还能够进行基础的 SMB 扫描来识别操作系统，这也表明目标系统可能存在文件和打印共享服务。以下是 Nmap 扫描过程中可以使用的其他语法：
- en: '`-Pn` – This syntax enables Nmap to perform a scan on the targeted system(s)
    without firstly performing host discovery, and simply considers the target to
    be online.'
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-Pn` – 此语法使 Nmap 在扫描目标系统时跳过主机发现阶段，直接认为目标系统是在线的。'
- en: '`-sU` – This syntax enables Nmap to perform UDP port scanning on the targeted
    system(s). This command will be useful with identifying whether there are any
    running services on UDP ports as compared to TCP port numbers.'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-sU` – 此语法允许 Nmap 对目标系统执行 UDP 端口扫描。此命令对于识别是否有服务在 UDP 端口上运行非常有用，相对于 TCP 端口号，它帮助识别
    UDP 服务。'
- en: '`-p` – This command allows you to specify either a range of targeted ports
    or specific ports are open on a system. Using `nmap -p 50-60`, `nmap -p 80,443`
    or `nmap -p 22` allows you to scan a range, a group or specific ports numbers.
    However, using `nmap -p-` specifies to scan all 65,535 port numbers, keep in mind
    Nmap scans TCP ports by default.'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-p` – 此命令允许你指定扫描的端口范围或某些特定端口是否在系统上开放。使用 `nmap -p 50-60`、`nmap -p 80,443` 或
    `nmap -p 22` 可以扫描端口范围、端口组或特定端口号。然而，使用 `nmap -p-` 表示扫描所有 65,535 个端口号，请注意，默认情况下
    Nmap 扫描的是 TCP 端口。'
- en: '`-sV` – This syntax enables you to perform service version identification of
    running services on a targeted system. For instance, an Nmap basic scan may indicate
    port 23 is open and it’s associated to the **Telnet**, as an ethical hacker is
    important to determine the service version of this running service. Therefore,
    using `nmap -sV <targeted system>` command will identify the service version which
    can be useful when researching security vulnerabilities on a target.'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-sV` – 此语法使你能够执行服务版本识别，了解目标系统上运行的服务版本。例如，Nmap 的基本扫描可能显示端口 23 是开放的，并与**Telnet**
    服务相关联。作为一名道德黑客，了解该服务的版本非常重要。因此，使用 `nmap -sV <targeted system>` 命令可以识别该服务的版本，这在研究目标的安全漏洞时非常有用。'
- en: '`-6` – Using this syntax enables Nmap to perform scans on a targeted IPv6 network
    or a host with an IPv6 address.'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-6` – 使用此语法可以让 Nmap 执行针对目标 IPv6 网络或拥有 IPv6 地址的主机的扫描。'
- en: 'Additionally, ethical hackers and penetration testers can use the **Ping**
    utility to profile the operating system of a target by analyzing the **Time To
    Live** (**TTL**) value found within the ICMP response messages from the target.
    For instance, Windows-based operating systems reply with a default TTL value of
    `128`, while Linux-based systems reply with a default TTL value of `64`.To better
    understand how ICMP helps us identify the operating system of a targeted machine,
    please use the following instuctions:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，伦理黑客和渗透测试人员可以利用**Ping**工具，通过分析目标ICMP响应消息中的**生存时间**（**TTL**）值来识别目标的操作系统。例如，基于Windows的操作系统回复的默认TTL值为`128`，而基于Linux的系统则回复的默认TTL值为`64`。为了更好地理解ICMP如何帮助我们识别目标机器的操作系统，请参考以下说明：
- en: 'On **Kali Linux**, use the following commands to send 4 ICMP ECHO Request messages
    to the Metasploitable 3 (Windows version) virtual machine:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Kali Linux**上，使用以下命令向Metasploitable 3（Windows版本）虚拟机发送4个ICMP ECHO请求消息：
- en: '[PRE13]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'As shown in the following screenshot, all ICMP responses contained a TTL of
    `128`, which indicates the targeted system is running a version of the Windows
    operating system:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，所有ICMP响应的TTL值为`128`，这表明目标系统正在运行某个版本的Windows操作系统：
- en: '![](../media/file228.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file228.png)'
- en: 'Next, use the following commands to send 4 ICMP ECHO Request messages to the
    Metasploitable 2 virtual machine:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令向Metasploitable 2虚拟机发送4个ICMP ECHO请求消息：
- en: '[PRE14]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'As shown in the following screenshot, the ICMP responses has a TTL value of
    `64`, which indicates the targeted system is running a version of Linux:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，ICMP响应的TTL值为`64`，这表明目标系统正在运行某个版本的Linux：
- en: '![](../media/file229.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file229.png)'
- en: As an aspiring ethical hacker and penetration tester, identifying the operating
    system, open ports and running services helps you to better profile the target
    and identify its security vulnerabilities. By identifying the security vulnerabilities,
    you can improve on your exploit development phase and plan of attack. Simply put,
    an exploit or payload for a Windows-based operating system will most likely not
    work on a Linux-based system or vice versa.Thus far, you have learned how to discover
    open ports, service versions, operating system, and SMB versions. Next, you will
    learn how to evade detection while performing active scanning on a network and
    systems using Nmap.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一名有抱负的伦理黑客和渗透测试人员，识别操作系统、开放端口和运行的服务有助于你更好地分析目标，并识别其安全漏洞。通过识别安全漏洞，你可以在开发利用工具阶段和攻击计划阶段做出改进。简单来说，针对Windows操作系统的漏洞利用或有效载荷很可能在Linux系统上无法运行，反之亦然。到目前为止，你已经学会了如何发现开放端口、服务版本、操作系统和SMB版本。接下来，你将学习如何在使用Nmap进行主动扫描时，避免被检测。
- en: Using scanning evasion techniques
  id: totrans-142
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用扫描规避技术
- en: Whenever a packet is sent from one device to another, the source IP address
    is included within the header of the packet. This is the default behavior of the
    TCP/IP networking model; all addressing information must be included within all
    packets before they are placed on the network. When performing a scan as an ethical
    hacker and a penetration tester, we try to remain undetected to determine whether
    the security team of the targeted organization has the capabilities of detecting
    the simulated cyber-attack.During a real cyber-attack, if an organization is unable
    to detect suspicious activities and security incidents on their network and systems,
    the threat actor can simply achieve their objectives without obstructions. However,
    if an organization can detect suspicious activities as soon as they occur, the
    security team can take action quickly to contain and stop the threat while safeguarding
    their organization’s assets. During a penetration test, it's important to simulate
    real-world cyber-attack to test the threat detection and mitigation systems within
    the targeted organization.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 每当数据包从一个设备发送到另一个设备时，源IP地址都会包含在数据包的头部。这是TCP/IP网络模型的默认行为；所有地址信息必须包含在所有数据包中，然后才能被放置到网络上。在作为伦理黑客和渗透测试人员进行扫描时，我们尽量避免被检测，以确定目标组织的安全团队是否具备检测模拟网络攻击的能力。在实际的网络攻击中，如果一个组织无法检测到其网络和系统上的可疑活动和安全事件，攻击者可以轻松达成其目标而不受阻碍。然而，如果一个组织能够在活动一发生时就检测到可疑行为，安全团队可以迅速采取行动，遏制并阻止威胁，同时保护组织的资产。在渗透测试中，模拟真实的网络攻击至关重要，以测试目标组织的威胁检测和缓解系统。
- en: Avoiding detection with decoys
  id: totrans-144
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 通过诱饵避免被检测
- en: 'Nmap is usually considered to be the king of network scanners within the cybersecurity
    industry due to its advanced scanning capabilities. Nmap enables penetration testers
    to use decoys when scanning a targeted system. This scanning technique tricks
    the targeted system into thinking the source of the scan is originating from multiple
    sources, rather than a single source IP address that belongs to the attacker machine.To
    get started with this exercise, please use the following instructions:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 由于其先进的扫描能力，Nmap通常被认为是网络扫描器领域的“王者”。Nmap使渗透测试人员在扫描目标系统时能够使用诱饵地址。这种扫描技术让目标系统误以为扫描源来自多个来源，而不是攻击者机器的单一IP地址。要开始此练习，请按照以下说明操作：
- en: 'Power-on **Kali Linux**, **Metasploitable 2** and **Metasploitable 3** (Windows
    version) virtual machines. Kali Linux will be the attacker machine, Metasploitable
    2 will be the targeted system and Metasploitable 3 – Windows virtual machine will
    be the decoy, as shown in the following diagram:'
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动**Kali Linux**、**Metasploitable 2**和**Metasploitable 3**（Windows版本）虚拟机。Kali
    Linux将作为攻击者机器，Metasploitable 2将作为目标系统，而Metasploitable 3 – Windows虚拟机将作为诱饵，如下图所示：
- en: '![](../media/file230.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file230.png)'
- en: Ensure you identify the IP addresses of each of these systems as they may be
    different from the preceding diagram. Using the scanning techniques from the previous
    section will help you identify the IP addresses easily.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 请确保识别这些系统的IP地址，因为它们可能与之前的图示不同。使用前一部分的扫描技术将帮助您轻松识别IP地址。
- en: 'Next, to perform an Nmap scan using decoys, use the following commands:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，要使用诱饵执行Nmap扫描，请使用以下命令：
- en: '[PRE15]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Using the `-D` syntax enables you to specify one or more decoys. Before Nmap
    uses the decoy addresses, it will first check whether each decoy system is a live
    host on the network, if an address is not reachable, it won’t include the offline
    address during the scan. The following screenshot shows the expected results of
    the scan:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`-D`语法可以让你指定一个或多个诱饵地址。在Nmap使用诱饵地址之前，它会首先检查每个诱饵系统是否为网络上的活动主机，如果某个地址不可达，它将在扫描中排除该离线地址。以下截图展示了扫描的预期结果：
- en: '![](../media/file231.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file231.png)'
- en: 'If the security team of the targeted organization is closely monitoring the
    packets over their internal network and identifies a port scan is in progress,
    there’s a chance they will determine the scan is originating from your IP address.
    However, the decoy feature will include the decoy addresses within various packets
    from your attacker machine, as shown below:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如果目标组织的安全团队正在密切监控其内部网络中的数据包，并且识别到端口扫描正在进行，他们有可能判断扫描源来自您的IP地址。然而，诱饵功能将会在来自攻击者机器的各个数据包中包含诱饵地址，如下所示：
- en: '![](../media/file232.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file232.png)'
- en: Therefore, using more decoy addresses during the Nmap scan will decrease the
    risk a security analyst may trace the source of the scan back to your IP address.
    However, security analysts are well-trained professionals and usually has the
    required tools and skilled to identify threats quickly on their network infrastructure.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在Nmap扫描期间使用更多的诱饵地址将降低安全分析员追溯扫描来源到您的IP地址的风险。然而，安全分析员是经过良好训练的专业人士，通常具备快速识别其网络基础设施中威胁所需的工具和技能。
- en: Using MAC and IP spoofing techniques
  id: totrans-156
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用MAC和IP伪装技术
- en: 'Nmap is like the Swiss army knife of scanners, filled with lots of scanning
    features to evade detection. Nmap allows a penetration tester to spoof both the
    MAC and IP addresses of their Kali Linux machine.The following are common MAC
    and IP spoofing techniques with Nmap:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: Nmap就像是扫描工具的瑞士军刀，拥有许多扫描功能，可以帮助规避检测。Nmap允许渗透测试人员伪装其Kali Linux机器的MAC和IP地址。以下是使用Nmap的常见MAC和IP伪装技术：
- en: 'To perform an Nmap scan using a randomized MAC address, use the `--spoof-mac
    0` command as shown below:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要使用随机化的MAC地址执行Nmap扫描，请使用以下`--spoof-mac 0`命令：
- en: '[PRE16]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The following screenshot shows Nmap generated a random MAC address before performing
    the scan on targeted system:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了Nmap在执行目标系统扫描之前生成了一个随机的MAC地址：
- en: '![](../media/file233.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file233.png)'
- en: 'In addition, the following screenshot shows the packets that were captured
    using Wireshark to further verify Nmap used a randomized address as the source
    MAC address:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，以下截图展示了使用Wireshark捕获的数据包，以进一步验证Nmap使用了随机化的地址作为源MAC地址：
- en: '![](../media/file234.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file234.png)'
- en: 'To perform an Nmap scan on a targeted system with a spoof MAC address of a
    specific vendor, it’s simply as including the vendor’s name, with the following
    commands:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要使用特定厂商的伪造MAC地址在目标系统上执行Nmap扫描，只需包含厂商名称，并使用以下命令：
- en: '[PRE17]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The following screenshot Nmap using an HP MAC address as the source address:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了Nmap使用HP MAC地址作为源地址的情况：
- en: '![](../media/file235.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file235.png)'
- en: To learn more about the various functionality of Nmap, use the `nmap -h` and
    `man nmap` commands to view the help menu and manual page.
  id: totrans-168
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 要了解Nmap的各种功能，请使用`nmap -h`和`man nmap`命令查看帮助菜单和手册页。
- en: Having completed this section, you have learned how to evade detection on a
    network while performing scanning using Nmap. Next, you will learn how to perform
    a stealth scan using Nmap.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本部分后，你已经学习了如何在网络上执行扫描并避开检测。接下来，你将学习如何使用Nmap执行隐蔽扫描。
- en: Stealth scanning techniques
  id: totrans-170
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 隐蔽扫描技术
- en: 'By default, Nmap establishes a TCP 3-way handshake on any open TCP ports found
    on the targeted systems. Once the handshake has been established between the attacker
    machine and the targeted system, data packets are exchanged between each host.
    The following diagram shows the TCP 3-way handshake, where Host A is initializing
    communication with Host B:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Nmap在目标系统的任何开放TCP端口上建立TCP三次握手。一旦攻击者机器与目标系统之间建立了握手，数据包将在每台主机之间交换。下图展示了TCP三次握手过程，其中主机A正在初始化与主机B的通信：
- en: '![](../media/file236.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file236.png)'
- en: 'During a penetration test, it''s important to be as stealthy as possible on
    the network. This creates the effect of a real adversary attempting to compromise
    the targeted systems on the network, without being caught by the organization''s
    security solutions. However, by establishing a TCP 3-way handshake with the targeted
    devices, we are making ourselves known to the target.By using Nmap, we can perform
    a stealth scan (half-open) between the target and our attacker system. A stealth
    scan does not setup a full TCP 3-way handshake but resets the connection before
    it’s fully established.The following diagram shows the exchange of TCP packets
    during an Nmap stealth scan:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试过程中，尽可能保持隐蔽非常重要。这会产生一种真实对手尝试入侵网络中目标系统的效果，而不被组织的安全解决方案捕捉到。然而，通过与目标设备建立TCP三次握手，我们实际上是在暴露自己给目标。通过使用Nmap，我们可以在目标和我们的攻击者系统之间执行隐蔽扫描（半开放）。隐蔽扫描不会完成整个TCP三次握手，而是在连接完全建立之前重置连接。下图展示了Nmap隐蔽扫描过程中TCP数据包的交换：
- en: '![](../media/file237.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file237.png)'
- en: 'As shown in the preceding diagram:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 如上图所示：
- en: The attacker machine tricks the target by sending a **TCP SYN** packet to a
    specific port on the targeted system to determine if the port is open.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 攻击者通过向目标系统的特定端口发送**TCP SYN**数据包来欺骗目标，判断该端口是否开放。
- en: Then, the target system will respond with a **TCP SYN/ACK** packet if the port
    is open.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，如果端口开放，目标系统将以**TCP SYN/ACK**数据包进行响应。
- en: Lastly, the attacker will send a **TCP RST** packet to the target to reset and
    terminate the connection.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，攻击者将向目标发送**TCP RST**数据包，以重置并终止连接。
- en: 'To get started with learning stealth scanning techniques, please use the following
    instuctions:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始学习隐蔽扫描技术，请使用以下指令：
- en: Power-on the **Kali Linux** and **Metasploitable 2** virtual machines.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开**Kali Linux**和**Metasploitable 2**虚拟机。
- en: 'On **Kali Linux**, open the **Terminal** and use the following commands to
    perform a stealth scan on the Metasploitable 2 to identify whether port 80 is
    open:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Kali Linux**上，打开**终端**并使用以下命令对Metasploitable 2进行隐蔽扫描，以确定端口80是否开放：
- en: '[PRE18]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Using the `-sS` syntax to indicate a stealth scan, and the `-p` operator allow
    us to specify a targeted port.The following screenshot shows the Nmap identified
    port 80 as opened on the targeted system:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`-sS`语法表示隐蔽扫描，`-p`操作符允许我们指定目标端口。下图展示了Nmap识别到目标系统的端口80已开放：
- en: '![](../media/file238.png)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file238.png)'
- en: 'The following screenshot shows the exchange of packets between the Kali Linux
    (`172.30.1.50`) and the targeted system (`172.30.1.48`) during the stealth scan:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了Kali Linux（`172.30.1.50`）与目标系统（`172.30.1.48`）在隐蔽扫描过程中的数据包交换：
- en: '![](../media/file239.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file239.png)'
- en: As shown in the preceding snippet, Nmap sent a **TCP SYN** packet with a destination
    port 80 to identify whether there are any running services on port 80 of the targeted
    system. The target responded with a **TCP SYN/ACK** packet as expected, however,
    the attacker machine sent a **TCP RST** packet to reset and terminate the connection.
    Therefore, no network connections were made between the attacker machine (Kali
    Linux) and the targeted system during the stealth scan.However, keep in mind that
    seasoned cybersecurity professionals who are actively monitoring their network
    traffic for any security incidents can easily identify whether a threat actor
    is performing a stealth scan on their network.Having completed this section, you
    have learnt how to perform various types of scanning techniques to identify live
    hosts on a network, profile their running services and operating systems. In the
    next section, you will learn how to enumerate common services and network shares
    from vulnerable systems.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所示，Nmap 发送了一个带目标端口 80 的**TCP SYN**数据包，以识别目标系统的端口 80 上是否有运行的服务。目标系统按预期响应了一个**TCP
    SYN/ACK**数据包，但攻击者机器发送了一个**TCP RST**数据包，以重置并终止连接。因此，在隐身扫描期间，攻击者机器（Kali Linux）与目标系统之间没有建立网络连接。然而，值得注意的是，那些积极监控网络流量以防范安全事件的资深网络安全专业人员，可以轻易识别出是否有攻击者正在对其网络进行隐身扫描。完成本节后，你已经学会了如何执行各种类型的扫描技术，以识别网络上的存活主机、分析其运行的服务和操作系统。在下一节中，你将学习如何从易受攻击的系统中枚举常见服务和网络共享。
- en: Enumerating network services
  id: totrans-188
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 枚举网络服务
- en: While scanning, you will notice there are common network services running on
    the targeted systems. Collecting more information on these network services can
    help you further identify shared network resources such shared directories, printers,
    and file shares on system. Sometimes, these network services are misconfigured
    and enables a threat actor to gain unauthorized access to sensitive data stored
    on servers and other systems within an organization.Over the next few sub-section,
    you will learn how to enumerate common network services such as **Server Message
    Block** (**SMB**), **Simple Mail Transfer Protocol** (**SMTP**) and **Simple Network
    Management Protocol** (**SNMP**).
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在扫描过程中，你会注意到目标系统上运行着一些常见的网络服务。收集这些网络服务的更多信息可以帮助你进一步识别共享网络资源，如共享目录、打印机和文件共享。有时，这些网络服务配置不当，可能导致攻击者获得对存储在服务器和其他系统中的敏感数据的未授权访问。接下来的几个子章节中，你将学习如何枚举常见的网络服务，如**服务器消息块**（**SMB**）、**简单邮件传输协议**（**SMTP**）和**简单网络管理协议**（**SNMP**）。
- en: Enumerating SMB services
  id: totrans-190
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 枚举 SMB 服务
- en: '**Server Message Block** (**SMB**) is a common network service that allows
    hosts to share resources such as files to other devices on a network. As an aspiring
    ethical hacker and penetration tester, it''s always recommended to enumerate file
    shares once it''s within your scope for the penetration test.To get started enumerating
    SMB services on a targeted system, please use the following instructions:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器消息块**（**SMB**）是一种常见的网络服务，允许主机将资源（如文件）共享给网络中的其他设备。作为一名有抱负的道德黑客和渗透测试员，建议在渗透测试的范围内一旦可行，就开始枚举文件共享服务。要开始枚举目标系统上的
    SMB 服务，请按照以下说明操作：'
- en: Power-on both the **Kali Linux** and **Metasploitable 2** virtual machines.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动**Kali Linux**和**Metasploitable 2**虚拟机。
- en: 'On **Kali Linux**, open the **Terminal** and use the following command to launch
    the Metasploit Framework:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Kali Linux**上，打开**终端**并使用以下命令启动 Metasploit 框架：
- en: '[PRE19]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'After the Metasploit framework loads, use the `search` command along with the
    `smb_version` search term to quickly locate modules:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Metasploit 框架加载后，使用`search`命令结合`smb_version`搜索词快速定位模块：
- en: '[PRE20]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'As shown in the following screenshot, the search result shows only one module
    available which can be used to identify whether SMB is running on the targeted
    system and its version:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 如下截图所示，搜索结果仅显示一个可用模块，可以用来识别目标系统是否正在运行 SMB 以及其版本：
- en: '![](../media/file240.png)'
  id: totrans-198
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file240.png)'
- en: 'Next, use the following commands to load the module and display its options:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令加载模块并显示其选项：
- en: '[PRE21]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Using the `options` or `show options` command displays the current settings
    within the loaded module and helps you determine whether there are additional
    configurations needed before executing the module, as shown below:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`options`或`show options`命令可以显示加载模块中的当前设置，并帮助你确定是否需要在执行模块之前进行额外配置，如下所示：
- en: '![](../media/file241.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file241.png)'
- en: As shown in the preceding screenshot, there are two required settings. One is
    `RHOSTS` or the target settings, while the other is the number of threads to apply
    to the process. Notice that the `RHOSTS` setting is blank.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 如前面截图所示，有两个必需的设置。一是`RHOSTS`或目标设置，另一个是应用于进程的线程数。请注意，`RHOSTS`设置为空。
- en: 'Next, use the following commands to set the targeted system (Metasploitable
    2) as the `RHOSTS` and execute the module:'
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令将目标系统（Metasploitable 2）设置为`RHOSTS`并执行模块：
- en: '[PRE22]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The `run` command is commonly used to execute auxiliary modules within the Metasploit
    framework, while the `exploit` command is used to execute exploit modules.
  id: totrans-206
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`run`命令通常用于执行Metasploit框架中的辅助模块，而`exploit`命令用于执行漏洞利用模块。'
- en: 'The following screenshot shows Metasploit was able to detect SMB is running
    and it’s version from the targeted system:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示Metasploit能够检测到目标系统正在运行SMB及其版本：
- en: '![](../media/file242.png)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file242.png)'
- en: Use the `exit` command to quit Metasploit framework and return to the BASH shell
    on the Terminal.
  id: totrans-209
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 使用`exit`命令退出Metasploit框架并返回到终端中的BASH shell。
- en: 'Using more than one tool to enumerate running services on your target is always
    recommended because there''s the possibility one tool may not identify something
    important. Sometimes, penetration testers may prefer to work with Metasploit as
    it contains a lot of *auxiliary* modules to scan and enumerate services, while
    others prefer Nmap. However, I recommend that you become familiar with both tools
    as they are excellent and will be very handy in various situations.Since SMB has
    been discovered on the targeted system, we can use **SMBmap** to enumerate the
    files and shared drives within the target. To get started using SMBMap, please
    use the following instructions:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 始终建议使用多个工具来枚举目标系统上正在运行的服务，因为可能有一个工具无法识别某些重要内容。有时候，渗透测试人员可能偏向使用Metasploit，因为它包含许多*辅助*模块来扫描和枚举服务，而其他人则偏好Nmap。然而，我建议你熟悉这两款工具，它们都非常优秀，并且在各种情况下都很有用。既然目标系统上已经发现了SMB，我们可以使用**SMBmap**来枚举目标中的文件和共享驱动器。要开始使用SMBMap，请按照以下说明操作：
- en: Ensure **Kali Linux** and **Metasploitable 2** virtual machines are power-on.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保**Kali Linux**和**Metasploitable 2**虚拟机已开启。
- en: 'On **Kali Linux**, use the following commands on the **Terminal** to identify
    whether the targeted system (Metasploitable 2) is running the SMB service:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Kali Linux**中，使用以下命令在**终端**中识别目标系统（Metasploitable 2）是否正在运行SMB服务：
- en: '[PRE23]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'The following screenshot shows Nmap was able to identify ports 139 and 445
    is open on the targeted system:'
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下截图显示Nmap能够识别目标系统的端口139和445是开放的：
- en: '![](../media/file243.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file243.png)'
- en: 'Next, use SMBmap to identify whether the targeted system has any network shares:'
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用SMBmap来识别目标系统是否有任何网络共享：
- en: '[PRE24]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'As shown in the following screenshot, the targeted system (Metasploitable 2)
    has a few shared drive, most are not accessible over the network except for the
    **tmp** resource:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，目标系统（Metasploitable 2）有一些共享驱动器，其中大多数无法通过网络访问，只有**tmp**资源可用：
- en: '![](../media/file244.png)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file244.png)'
- en: As shown in the preceding screenshot, the SMBmap tool was able to provide the
    permissions and comments for each network share on a targeted system. This information
    is useful in helping ethical hackers and penetration testers to identify sensitive
    directories and collect data found within unsecure network shares.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 如前面截图所示，SMBmap工具能够提供每个网络共享的权限和评论。这些信息对于帮助道德黑客和渗透测试人员识别敏感目录并收集不安全网络共享中的数据非常有用。
- en: 'Next, use the following commands to display the contents of the **tmp** directory
    on the targeted system:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令显示目标系统中**tmp**目录的内容：
- en: '[PRE25]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'As shown in the following screenshot, SMBmap was able to access the **tmp**
    directory because there were no authentication mechanism that’s configured to
    restrict unauthenticated access:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，SMBmap能够访问**tmp**目录，因为没有配置身份验证机制来限制未认证的访问：
- en: '![](../media/file245.png)'
  id: totrans-224
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file245.png)'
- en: 'Next, to download all the contents of the **tmp** directory onto your Kali
    Linux machine, use the following commands to create a new directory (folder) within
    Kali Linux and download the files:'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令将**tmp**目录的所有内容下载到Kali Linux机器中，首先在Kali Linux中创建一个新目录（文件夹）并下载文件：
- en: '[PRE26]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令的执行：
- en: '![](../media/file246.png)'
  id: totrans-228
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file246.png)'
- en: Having completed this section, you have learned how to perform SMB enumeration
    using both Metasploit and SMBMap. In the next section, you will learn how to perform
    SMTP enumeration.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这一部分后，你已经学会了如何使用Metasploit和SMBMap进行SMB枚举。在下一部分中，你将学习如何进行SMTP枚举。
- en: Enumerating SMTP services
  id: totrans-230
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 枚举SMTP服务
- en: 'Enumerating SMTP services enables ethical hackers and penetration testers to
    collect information about the email services and identify any valid user accounts
    on the targeted system. To get started with this exercise, please use the following
    instructions:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 枚举SMTP服务可以帮助道德黑客和渗透测试人员收集关于电子邮件服务的信息，并识别目标系统中的有效用户账户。要开始这个练习，请按照以下指示操作：
- en: Power-on both **Kali Linux** and **Metasploitable 2** virtual machines.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动**Kali Linux**和**Metasploitable 2**虚拟机。
- en: 'On **Kali Linux**, open the **Terminal** and use **Netcat** to check whether
    port 25 is open on the targeted system (Metasploitable 2) and identify the running
    service:'
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Kali Linux**中，打开**终端**并使用**Netcat**检查目标系统（Metasploitable 2）上的端口25是否开放，并识别正在运行的服务：
- en: '[PRE27]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Next, use the `VRFY root` command to determine whether `root` is a valid user.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用`VRFY root`命令检查`root`是否为有效用户。
- en: 'Next use the `VRFY toor` to check whether the user `toor` is a valid user,
    as shown below:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用`VRFY toor`命令检查`toor`是否为有效用户，如下所示：
- en: '![](../media/file247.png)'
  id: totrans-237
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file247.png)'
- en: As shown in the preceding screenshot, Netcat was able to successfully establish
    a connection to the targeted system on port 25 which further identified SMTP is
    running. When the `VRFY root` command was executed, the email service responses
    indicate the user exist. However, the email service provided an error message
    when a non-valid user is checked.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 如上图所示，Netcat成功地在端口25与目标系统建立了连接，进一步确认了SMTP正在运行。当执行`VRFY root`命令时，电子邮件服务的响应表明该用户存在。然而，当检查无效用户时，电子邮件服务返回了错误信息。
- en: 'Manually checking each possible username on a targeted system can be very time-consuming.
    To help automate the process of SMTP enumeration, we can create a simply BASH
    script which intakes a pre-defined list of possible usernames and query it on
    the target system. Use the following commands to create a new script using Nano:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 手动检查目标系统中的每个可能用户名可能会非常耗时。为了帮助自动化SMTP枚举过程，我们可以创建一个简单的BASH脚本，输入预定义的用户名列表并在目标系统上进行查询。使用以下命令创建一个新的脚本：
- en: '[PRE28]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Once the Nano command-line text editor opens, enter the following code exactly
    as is:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦Nano命令行文本编辑器打开，输入以下代码，确保完全一致：
- en: '[PRE29]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Once you’ve finished entering the preceding code, save the script by pressing
    `CTRL + X`, then `Y` and `Enter` on your keyboard.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 完成前面的代码输入后，通过按下`CTRL + X`，然后按`Y`和`Enter`键保存脚本。
- en: 'Next, use the following commands to make the newly saved script executable
    on Kali Linux:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令在Kali Linux上使新保存的脚本可执行：
- en: '[PRE30]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'To use the script, the `./smtp_user_enum.sh <target> <wordlist>` syntax enables
    you to start the SMTP enumeration on a targeted system, as with the following
    commands:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用脚本时，`./smtp_user_enum.sh <target> <wordlist>`语法可以让你在目标系统上启动SMTP枚举，命令示例如下：
- en: '[PRE31]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The following screenshot shows valid user names were identified while the script
    is running:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了在脚本运行过程中识别到的有效用户名：
- en: '![](../media/file248.png)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file248.png)'
- en: Identifying and leveraging valid usernames and accounts helps penetration testers
    in gaining unauthorized access on targeted systems. Having completed this exercise,
    you have gained the hands-on skills on SMTP enumeration. Next, you will learn
    how to enumerate SNMP services on a targeted host.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 识别并利用有效的用户名和账户可以帮助渗透测试人员在目标系统上获得未授权的访问权限。完成本练习后，你已经掌握了SMTP枚举的实际操作技能。接下来，你将学习如何在目标主机上枚举SNMP服务。
- en: Enumerating SNMP services
  id: totrans-251
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 枚举SNMP服务
- en: 'SNMP is a common network protocol which enables network professionals to monitor,
    manage and troubleshoot common networking devices. In addition, IT professionals
    uses SNMP to retrieve sensitive information from their devices such as the following:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: SNMP是一种常见的网络协议，使网络专业人员能够监控、管理和故障排除常见的网络设备。此外，IT专业人员还使用SNMP从其设备中获取敏感信息，如下所示：
- en: System uptime
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统运行时间
- en: Device hostname
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设备主机名
- en: CPU and memory utilization
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CPU和内存利用率
- en: Interface status and statistics
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 接口状态和统计信息
- en: Operating system
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作系统
- en: Open ports and running services
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 打开的端口和正在运行的服务
- en: SNMP leverages the Management Information Base (MIB) which is a common database
    that contains specific information about an SNMP managed device. The MIB is like
    a tree-structure that’s divided into multiple branches and each branch is used
    to manage a specific area of the device. On each branch of the MIB tree, there
    are leaves which represent specific values that enables a network professional
    to access the leaves to retrieve specific information about the device on the
    network.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: SNMP 利用管理信息库（MIB），这是一个包含关于 SNMP 管理设备的特定信息的公共数据库。MIB 就像一棵树状结构，分为多个分支，每个分支用于管理设备的特定领域。在
    MIB 树的每个分支上，都有代表特定值的叶子，这些叶子使网络专业人员能够访问这些叶子并检索有关网络中设备的特定信息。
- en: 'To learn more about SNMP, please see: [https://www.techtarget.com/searchnetworking/definition/SNMP](https://www.techtarget.com/searchnetworking/definition/SNMP).'
  id: totrans-260
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 要了解更多关于 SNMP 的信息，请查看：[https://www.techtarget.com/searchnetworking/definition/SNMP](https://www.techtarget.com/searchnetworking/definition/SNMP)。
- en: 'To get started with SNMP enumeration, please use the following instructions:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始进行 SNMP 枚举，请按照以下说明操作：
- en: Power-on the **Kali Linux** and **Metasploitable 3** (Windows version) virtual
    machines.
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动**Kali Linux**和**Metasploitable 3**（Windows 版本）虚拟机。
- en: 'On **Kali Linux**, open the **Terminal** and use the followings to determine
    whether SNMP is running the targeted system (Metasploitable 2):'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Kali Linux**上，打开**终端**并使用以下命令来确定目标系统（Metasploitable 2）是否正在运行 SNMP：
- en: '[PRE32]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'The following screenshot shows SNMP is running on the targeted system on UDP
    port 161:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了 SNMP 正在目标系统的 UDP 端口 161 上运行：
- en: '![](../media/file249.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file249.png)'
- en: 'Next, perform SNMP enumeration using the **SNMP-Check** tool, use the following
    commands:'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用**SNMP-Check**工具执行 SNMP 枚举，使用以下命令：
- en: '[PRE33]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'The following is a description for each syntax used in the preceding commands:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前述命令中使用的每个语法的描述：
- en: '`-p`: Allows you to specify the targeted port, by default its set to port 161.'
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-p`：允许您指定目标端口，默认设置为端口 161。'
- en: '`-c`: Allows you to specify the community string to login to the targeted system,
    the default community string is `public`.'
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-c`：允许您指定用于登录目标系统的社区字符串，默认社区字符串为`public`。'
- en: '`-v`: Allows you to specify the SNMP version to use, by default its set to
    version 1.'
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-v`：允许您指定要使用的 SNMP 版本，默认设置为版本 1。'
- en: 'As shown in the following screenshot, we are able to identify a lot of sensitive
    information which can be used to improve future cyber-attacks on the target:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，我们能够识别出大量敏感信息，这些信息可以用于提升未来对目标的网络攻击：
- en: '![](../media/file250.png)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file250.png)'
- en: 'The SNMP-Check tool was able to enumerate the following information from the
    target:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: SNMP-Check 工具能够从目标中枚举出以下信息：
- en: System information
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统信息
- en: User accounts
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户账户
- en: Network information
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络信息
- en: Routing information
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 路由信息
- en: Network services
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络服务
- en: Running processes
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行中的进程
- en: Software components
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 软件组件
- en: To learn more about SNMP-Check, use the `snmp-check -h` command to display its
    menu and additional options.
  id: totrans-283
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 要了解更多关于 SNMP-Check 的信息，请使用`snmp-check -h`命令查看其菜单和其他选项。
- en: As you have learnt, enumerating systems helps ethical hackers and penetration
    testers to improve their profile on targeted system and determine what’s running
    on them. Such information helps penetration testers to identify vulnerabilities
    which can be exploited to compromise the target.In the next section, you will
    learn how to discover data leaks in cloud storage.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您所学到的，枚举系统帮助道德黑客和渗透测试人员提高他们在目标系统上的资料，并确定其上运行的内容。这些信息有助于渗透测试人员识别漏洞，进而利用这些漏洞来危及目标系统。在下一部分，您将学习如何在云存储中发现数据泄露。
- en: Discovering data leaks in the cloud
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 发现云中的数据泄露
- en: 'Over the past decade, cloud computing has become one of the fastest-growing
    trends in the IT industry. Cloud computing allows companies to migrate and utilize
    computing resources within a cloud provider''s data center. Cloud computing providers
    have a pay-as-you-go model, which means that you only pay for the resources you
    use. Some cloud providers allow pay-per-minute models, while others use a pay-per-hour
    structure.The following are popular cloud computing service providers:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去十年里，云计算已经成为 IT 行业增长最快的趋势之一。云计算允许公司在云服务提供商的数据中心内迁移并利用计算资源。云计算提供商采用按需付费模式，这意味着您只需为使用的资源付费。一些云服务提供商允许按分钟计费，而其他服务则按小时计费。以下是一些流行的云计算服务提供商：
- en: Amazon Web Services (AWS)
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 亚马逊网络服务（AWS）
- en: Microsoft Azure
  id: totrans-288
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 微软 Azure
- en: Google Cloud Platform
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Google Cloud Platform
- en: 'Many cloud service providers offer their customers a storage service. The AWS
    storage facility is known as **Simple Storage Service** (**S3**). Whenever a customer
    enables the S3 service, a bucket is created. A bucket is a storage unit within
    the AWS platform where the customer can add or remove files. In Microsoft Azure,
    the file storage facility is known as Azure Files. Additionally, on Google Cloud,
    the storage facility is known as Google Cloud Storage.In the field of cybersecurity,
    we need to remember when a company is using a cloud platform, the data on the
    cloud platform must be secured, just like it should be when stored on-premises
    (that is, when stored locally). Sometimes, administrators forget to enable security
    configurations or lack knowledge regarding the security of a cloud solution. This
    could lead to, say, an attacker discovering a target organization''s AWS S3 buckets
    and downloading their content.For this exercise, we are going to use some free
    online learning resources from http://flaws.cloud. This is a learning environment
    that''s been created by an AWS security professional who is helping the community
    learn about security vulnerabilities that can exist within AWS S3 misconfigurations.To
    get started with identifying data leakage with AWS S3 Buckets, please use the
    following instructions:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 许多云服务提供商为他们的客户提供存储服务。AWS 的存储设施被称为 **简单存储服务** (**S3**) 。每当客户启用 S3 服务时，都会创建一个桶。桶是
    AWS 平台中的存储单元，客户可以在其中添加或删除文件。在 Microsoft Azure 中，文件存储设施被称为 Azure Files。此外，在 Google
    Cloud 中，存储设施被称为 Google Cloud Storage。在网络安全领域，我们需要记住，当公司使用云平台时，云平台上的数据必须得到保护，就像它应该在本地存储时一样（也就是存储在本地）。有时，管理员忘记启用安全配置或缺乏对云解决方案安全性的了解。这可能导致攻击者发现目标组织的
    AWS S3 桶并下载其内容。为了进行此练习，我们将使用来自 http://flaws.cloud 的一些免费的在线学习资源。这是一个由一位 AWS 安全专家创建的学习环境，旨在帮助社区了解
    AWS S3 配置错误中可能存在的安全漏洞。要开始识别 AWS S3 桶的数据泄漏，请使用以下说明：
- en: 'Power-on the **Kali Linux** virtual machine, open the **Terminal** and use
    the following commands to install the **S3Scanner** tool:'
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 开启 **Kali Linux** 虚拟机，打开 **Terminal**，并使用以下命令安装 **S3Scanner** 工具：
- en: '[PRE34]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Next, install the AWS command-line package using the following commands:'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令安装 AWS 命令行工具包：
- en: '[PRE35]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Next, configure the AWS command-line features on Kali Linux by using the following
    commands:'
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令在 Kali Linux 上配置 AWS 命令行功能：
- en: '[PRE36]'
  id: totrans-296
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Simply hit Enter to use the default options as shown in the following screenshot:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 只需按 Enter 使用默认选项，如下截图所示：
- en: '![](../media/file251.png)'
  id: totrans-298
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file251.png)'
- en: 'Next, to view all the supported features and options of the S3Scanner tool,
    use the `s3scanner –h` command as shown in the following screenshot:'
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，为了查看 S3Scanner 工具的所有支持功能和选项，请使用 `s3scanner –h` 命令，如下截图所示：
- en: '![](../media/file252.png)'
  id: totrans-300
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file252.png)'
- en: 'Next, let’s use the **NSlookup** within Kali Linux to retrieve the IP address
    of the targeted server:'
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们在 **Kali Linux** 中使用 **NSlookup** 来检索目标服务器的 IP 地址：
- en: '[PRE37]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The following screenshot shows NSlookup was able to retrieve multiple public
    IP addresses for the hosting server:'
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下截图显示 NSlookup 能够检索到托管服务器的多个公共 IP 地址：
- en: '![](../media/file253.png)'
  id: totrans-304
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file253.png)'
- en: 'Next, let’s use NSlookup again to retrieve the hostname of the AWS S3 Bucket
    server:'
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们再次使用 NSlookup 来检索 AWS S3 桶服务器的主机名：
- en: '[PRE38]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'The following screenshot the hostname of the server, including the name of
    the AWS S3 Bucket:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了服务器的主机名，包括 AWS S3 桶的名称：
- en: '![](../media/file254.png)'
  id: totrans-308
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file254.png)'
- en: 'An AWS S3 bucket''s URL format is usually in the form of `https://<bucketname>
    <region>.amazonaws.com`. Therefore, by using the information from the URL, the
    following can be determined:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 AWS S3 桶的 URL 格式通常为 `https://<bucketname> <region>.amazonaws.com`。因此，通过使用
    URL 中的信息，可以确定以下内容：
- en: 'S3 Bucket name: s3-website'
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: S3 桶名称：s3-website
- en: 'Hosting region: us-west-2'
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 托管区域：us-west-2
- en: 'AWS S3 buckets are not only used to store data such as files. They are also
    used to host websites. Therefore, we can use `flaws.cloud` as a prefix to the
    AWS S3 bucket URL to get the following URL:[http://flaws.cloud.s3-website-us-west-2.amazonaws.com](http://flaws.cloud.s3-website-us-west-2.amazonaws.com)
    The following screenshots the contents of the preceding URL:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: AWS S3 桶不仅用于存储数据文件，还用于托管网站。因此，我们可以使用 `flaws.cloud` 作为 AWS S3 桶 URL 的前缀，得到以下
    URL：[http://flaws.cloud.s3-website-us-west-2.amazonaws.com](http://flaws.cloud.s3-website-us-west-2.amazonaws.com)
    以下截图展示了前述 URL 的内容：
- en: '![](../media/file255.png)'
  id: totrans-313
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file255.png)'
- en: 'Next, let''s use S3Scanner to verify that a bucket exists and the available
    permissions:'
  id: totrans-314
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们使用 S3Scanner 来验证一个存储桶是否存在以及可用的权限：
- en: '[PRE39]'
  id: totrans-315
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'As shown in the following screenshot, an AWS S3 Bucket exist:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 如下截图所示，存在一个 AWS S3 存储桶：
- en: '![](../media/file256.png)'
  id: totrans-317
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file256.png)'
- en: 'Next, let’s attempt to view the contents of the AWS S3 bucket, use the following
    commands:'
  id: totrans-318
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们尝试查看 AWS S3 存储桶的内容，使用以下命令：
- en: '[PRE40]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: As shown in the following screenshot, there are some files within the S3 bucket;
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 如下截图所示，S3 存储桶中有一些文件；
- en: '![](../media/file257.png)'
  id: totrans-321
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file257.png)'
- en: 'Next, let''s attempt to download the files onto our Kali Linux machine. Use
    the following commands to create a folder and download the files into the newly
    created folder:'
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们尝试将文件下载到我们的 Kali Linux 机器上。使用以下命令创建一个文件夹，并将文件下载到新创建的文件夹中：
- en: '[PRE41]'
  id: totrans-323
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: The `cp` syntax specifies the file to download, `--region` allows us to specify
    the location of the AWS S3 Bucket and `--no-sign-request` specifies to do not
    use any user credentials.
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: '`cp` 语法指定了要下载的文件，`--region` 允许我们指定 AWS S3 Bucket 的位置，`--no-sign-request` 指定不使用任何用户凭证。'
- en: 'Lastly, you can use the `cat` or `open` command to view the contents of the
    downloaded file, as shown below:'
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，您可以使用 `cat` 或 `open` 命令查看下载文件的内容，如下所示：
- en: '[PRE42]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: You can continue this exercise on [http://flaws.cloud/](http://flaws.cloud/)
    to learn more about various security vulnerabilities and discover the impact of
    misconfigurations on cloud services such as AWS S3 buckets. However, do not perform
    such actions on systems, networks, and organizations that you do not have legal
    permission to do so.As you have seen, data leaks can happen on any platform and
    to any organization. As an aspiring ethical hacker and penetration tester, you
    must know how to find them before a real adversary do and exploits them. Companies
    can store sensitive data on cloud platforms, or even leave data completely unprotected
    on a cloud service provider network. This can lead to data and accounts being
    retrieved. In this section, you learned how to perform enumeration of AWS S3 buckets
    using various tools and techniques.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以继续在 [http://flaws.cloud/](http://flaws.cloud/) 上进行此练习，进一步了解各种安全漏洞，并发现错误配置对云服务（如
    AWS S3 存储桶）的影响。但是，请勿在没有合法授权的系统、网络和组织上执行此类操作。如您所见，数据泄露可以发生在任何平台和任何组织上。作为一名有抱负的伦理黑客和渗透测试员，您必须学会如何在真正的对手发现并利用它们之前先找到这些漏洞。公司可能会将敏感数据存储在云平台上，甚至完全不加保护地将数据存放在云服务提供商的网络中。这可能会导致数据和账户被盗取。在本节中，您学习了如何使用各种工具和技术枚举
    AWS S3 存储桶。
- en: Summary
  id: totrans-328
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 总结
- en: During this chapter, you have gained the hands-on skills as an aspiring ethical
    hacker and penetration tester to perform active scanning techniques to identify
    open ports, running services and operating system on targeted systems. In addition,
    you have learnt how to use common evasion techniques during scanning to reduce
    your threat level. Furthermore, you have discovered how to enumerate common network
    services and leverage the information on improve a cyber-attack.I trust that the
    knowledge presented in this chapter has provided you with valuable insights, supporting
    your path towards becoming an ethical hacker and penetration tester in the dynamic
    field of cybersecurity. May this newfound understanding empower you in your journey,
    allowing you to navigate the industry with confidence and make a significant impact.
    In the next chapter, *Performing Vulnerability Assessments*, you will learn how
    to setup and work with popular vulnerability management tools.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，作为一名有抱负的伦理黑客和渗透测试员，您已经获得了实践技能，能够执行主动扫描技术来识别目标系统上的开放端口、运行的服务和操作系统。此外，您还学会了在扫描过程中使用常见的规避技术，以降低您的威胁级别。更进一步，您已经学会了如何枚举常见的网络服务，并利用这些信息改进网络攻击。我相信，本章所呈现的知识为您提供了宝贵的见解，支持您成为伦理黑客和渗透测试员的道路，帮助您在充满活力的网络安全领域迈出坚实的一步。愿这一新获得的理解赋予您前行的力量，让您在行业中自信地航行，产生显著影响。在下一章《执行漏洞评估》中，您将学习如何设置并使用流行的漏洞管理工具。
- en: Further Reading
  id: totrans-330
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: Nmap reference guide - [https://nmap.org/book/man.html](https://nmap.org/book/man.html)
  id: totrans-331
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nmap 参考指南 - [https://nmap.org/book/man.html](https://nmap.org/book/man.html)
- en: Information gathering using Metasploit - [https://www.offensive-security.com/metasploit-unleashed/information-gathering/](https://www.offensive-security.com/metasploit-unleashed/information-gathering/)
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Metasploit 进行信息收集 - [https://www.offensive-security.com/metasploit-unleashed/information-gathering/](https://www.offensive-security.com/metasploit-unleashed/information-gathering/)
