- en: Setting Up a Kali PentestBox on the Cloud
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在云上设置Kali PentestBox
- en: There is a readily available **Amazon Machine Image** (**AMI**) that runs Kali
    Linux on the Amazon Marketplace. This means that a penetration tester can quickly
    set up a Kali Linux instance on the Amazon Cloud and access it at any time for
    any kind of penetration test. This chapter focuses on creating an Amazon EC2 instance,
    setting it up with a Kali Linux AMI, and configuring remote access to this host
    in a variety of ways. Once set up, a penetration tester can remotely access a
    **Virtual Private Cloud** (**VPC**) belonging to an AWS account and perform pentests
    within that VPC and on any remote hosts using Kali.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个现成的**Amazon Machine Image**（**AMI**）在亚马逊市场上运行Kali Linux。这意味着渗透测试人员可以快速在亚马逊云上设置Kali
    Linux实例，并随时访问它进行任何类型的渗透测试。本章重点介绍在Amazon EC2实例上创建一个实例，使用Kali Linux AMI进行设置，并以各种方式配置对此主机的远程访问。一旦设置好，渗透测试人员可以远程访问属于AWS帐户的**虚拟私有云**（**VPC**），并在该VPC内和任何远程主机上使用Kali进行渗透测试。
- en: 'In this chapter, we will learn about the following:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习以下内容：
- en: How to run Kali Linux on the Amazon Cloud
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何在亚马逊云上运行Kali Linux
- en: Accessing Kali remotely over SSH
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过SSH远程访问Kali
- en: Accessing Kali remotely through clientless RDP
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过无客户端RDP远程访问Kali
- en: Technical requirements
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'In this chapter, we are going to use the following tools:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用以下工具：
- en: AWS EC2 instance
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS EC2实例
- en: Kali Linux AMI
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux AMI
- en: Apache Guacamole ([https://guacamole.apache.org](https://guacamole.apache.org))
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Apache Guacamole ([https://guacamole.apache.org](https://guacamole.apache.org))
- en: SSH client and a browser
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH客户端和浏览器
- en: Setting up Kali Linux on AWS EC2
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在AWS EC2上设置Kali Linux
- en: In this section, we will go through the very first steps of setting up a virtual
    penetration testing machine on the cloud, as well as setting up remote access
    to it to perform penetration testing on the go. The penetration testing machine will
    go hand-in-hand with the penetration testing lab that was set up in the [Chapter
    1](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml), *Setting Up a Pentesting Lab on
    AWS*, that allows you to perform penetration testing and exploitation on those
    hosts.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍在云上设置虚拟渗透测试机器的最初步骤，以及设置远程访问以便随时进行渗透测试。渗透测试机器将与[第1章](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml)中设置的渗透测试实验室*在AWS上设置渗透测试实验室*相辅相成，该实验室允许您对这些主机进行渗透测试和利用。
- en: The Kali Linux AMI
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Kali Linux AMI
- en: AWS provides a fascinating feature that allows for the rapid deployment of **Virtual
    Machines** (**VMs**) on the Amazon Cloud—**Amazon Machine Images** (**AMIs**).
    These act as templates and allow one to quickly set up a new VM on AWS without
    going through the unnecessary hassle of manually configuring hardware and software
    like on traditional VMs. However, the most useful feature here is that AMIs allow
    you to bypass the OS installation process entirely. As a result, the total amount
    of time needed to decide what OS is required and to get a fully functioning VM
    on the cloud is reduced to a few minutes—and a few clicks.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: AWS提供了一个令人着迷的功能，允许在亚马逊云上快速部署**虚拟机**（**VMs**）—**Amazon Machine Images**（**AMIs**）。这些作为模板，允许用户在AWS上快速设置新的VM，而无需像传统VM那样手动配置硬件和软件。然而，这里最有用的功能是AMIs允许您完全绕过操作系统安装过程。因此，决定需要什么操作系统并在云上获得一个完全功能的VM所需的时间总量减少到几分钟——和几次点击。
- en: 'The Kali Linux AMI was added to the AWS store pretty recently, and we shall
    leverage it to quickly set up our Kali VM on the Amazon Cloud. Setting up a Kali
    instance using the ready-made AMI is pretty simple—we start by accessing the Kali
    Linux AMI from the AWS Marketplace:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux AMI是最近才添加到AWS商店的，我们将利用它来快速在亚马逊云上设置我们的Kali VM。使用现成的AMI设置Kali实例非常简单——我们首先访问AWS
    Marketplace中的Kali Linux AMI：
- en: '![](img/d31c2806-f832-4792-be31-3f5905d33b6c.png)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d31c2806-f832-4792-be31-3f5905d33b6c.png)'
- en: 'The previous screenshot shows the following information:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的截图显示了以下信息：
- en: The version of the AMI that we are using (2018.1)
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们正在使用的AMI版本（2018.1）
- en: The Typical Total Price for running this in a default instance
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在默认实例中运行这个的典型总价格
- en: Overview and details of the AMI
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AMI的概述和详细信息
- en: 'It is useful to note that the default recommended instance size for Kali Linux
    is t2.medium, as we can see under pricing information:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是，Kali Linux的默认推荐实例大小是t2.medium，如我们在定价信息下所见：
- en: '![](img/f43d09cd-a3c9-4b4d-b6e0-42ec917f718b.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f43d09cd-a3c9-4b4d-b6e0-42ec917f718b.png)'
- en: 'Further down the page, we can see that the size of the t2.medium instance consists
    of two CPU virtual cores and 4GiB RAM, which is more than enough for our setup:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在页面的下方，我们可以看到t2.medium实例的大小包括两个CPU虚拟核心和4GiB的RAM，这对于我们的设置来说已经足够了：
- en: '![](img/d9273c83-00cd-475e-a404-701eacc60f0a.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d9273c83-00cd-475e-a404-701eacc60f0a.png)'
- en: Once we have confirmed that we're setting up the image according to our requirements,
    we can go ahead and click on the Continue to Subscribe option to proceed with
    our instance.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦确认我们根据要求设置了镜像，我们可以继续点击“继续订阅”选项来进行实例设置。
- en: Configuring the Kali Linux instance
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置Kali Linux实例
- en: In the previous section, we confirmed the AMI we are going to use along with
    the specifications of the machine we will be using to launch our Kali machine.
    Once that has been selected it is time to launch our machine.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中，我们确认了要使用的AMI以及我们将使用的机器的规格，以启动我们的Kali机器。一旦选择了这些，就是启动我们的机器的时候了。
- en: 'This brings us to the Launch on EC2 page. This contains some options that need
    to be set:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 这将带我们到EC2页面。这里包含一些需要设置的选项：
- en: '**The version of the AMI that we will ****use**: It is usually recommended
    to use the latest version of the AMI that is available in the marketplace. Often,
    this isn''t the one that is selected by default for Kali Linux. At the time of
    writing, the latest version is 2018.1, and the build date is February 2018, as
    can be seen here:'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**我们将使用的AMI版本**：通常建议使用市场上可用的最新版本的AMI。通常情况下，这不是默认选择的Kali Linux版本。在撰写本文时，最新版本是2018.1，构建日期是2018年2月，如下所示：'
- en: '![](img/7bd1533f-db26-48b1-8492-fd3dc3bb0438.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7bd1533f-db26-48b1-8492-fd3dc3bb0438.png)'
- en: Since 2019.1 is released now you need to download the latest version of Kali
    linux
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 自2019.1版本发布后，您需要下载最新版本的Kali Linux。
- en: '**The region where we will be deploying the instance**: As discussed in the
    [Chapter 1](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml), Setting Up a Pentesting
    Lab on AWS, we need to set the region to the data center that is geographically
    closest to the current location.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**我们将部署实例的区域**：如在[第1章](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml)中所讨论的，在AWS上设置渗透测试实验室，我们需要将区域设置为地理位置最接近当前位置的数据中心。'
- en: '**The EC2 instance size**:This was already verified in the previous step. We
    will be looking at various instance types and sizes in greater depth in later
    sections of this book.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**EC2实例大小**：这已经在上一步中验证过了。我们将在本书的后面部分更深入地研究各种实例类型和大小。'
- en: '**VPC Settings**:The VPC and subnet settings need to be set to use the same
    VPC that we used to set up the penetration testing lab in [Chapter 1](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml),
    *Setting Up a Pentesting Lab on AWS*. This will put our hacking box on the same
    network as the vulnerable machines that we set up earlier. The setting should
    match whatever was configured in the previous chapter:'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VPC设置**：VPC和子网设置需要设置为使用我们在[第1章](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml)中设置渗透测试实验室时使用的相同VPC。这将使我们的黑客工具箱与我们之前设置的易受攻击的机器处于同一网络中。设置应该与上一章中配置的相匹配：'
- en: '![](img/09ab7eb9-b05a-456c-8106-4fa2501c2188.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![](img/09ab7eb9-b05a-456c-8106-4fa2501c2188.png)'
- en: '**Security group**: Previously, we set up the Security Group in such a way
    that unauthorized outsiders would not have access to the instances. However, in
    this case, we need to allow remote access to our Kali instance. Hence, we need
    to forward the SSH and the Guacamole remote access port to a new Security Group:'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全组**：之前，我们设置了安全组，以便未经授权的外部人员无法访问实例。然而，在这种情况下，我们需要允许远程访问我们的Kali实例。因此，我们需要将SSH和Guacamole远程访问端口转发到一个新的安全组：'
- en: '![](img/a09c1fe1-c7e5-40ec-915f-52b15784e0fb.png)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a09c1fe1-c7e5-40ec-915f-52b15784e0fb.png)'
- en: '**Key pair**:We can use the same key pair that was created during the setup
    of the lab environment in the [Chapter 1](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml), *Setting
    Up a Pentesting Lab on AWS*.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密钥对：我们可以使用在[第1章](9c51c4e0-951d-4b49-95ed-c9220a9d3210.xhtml)中设置实验室环境时创建的相同密钥对，*在AWS上设置渗透测试实验室*。
- en: 'With these settings in place, we are good to go and can spin up the instance
    by clicking on Launch with 1-click:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 有了这些设置，我们就可以点击“一键启动”来启动实例了：
- en: '![](img/4f338529-165a-4eb0-8bc7-c20ad551be69.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4f338529-165a-4eb0-8bc7-c20ad551be69.png)'
- en: AWS will then launch the Kali machine and assign it a public IP. However, we
    need to be able to access this machine. In the next section, we will see how we
    can use OpenSSH for accessing a Kali Machine.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 然后AWS将启动Kali机器并分配一个公共IP。然而，我们需要能够访问这台机器。在下一节中，我们将看到如何使用OpenSSH来访问Kali机器。
- en: Configuring OpenSSH for remote SSH access
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置OpenSSH进行远程SSH访问
- en: AWS already sets a default form of SSH access for their Kali AMI with an `ec2-user`
    account using a public key. However, this isn't convenient for access via a mobile
    device. For users who want to conveniently SSH into their Kali instances from
    mobile applications directly with root privileges, the following section walks
    through the process. It should be noted, however, that using a limited user account
    with PKI authentication is the most secure way to connect over SSH, and using
    a root account with a password is not recommended if securing the instance is
    a priority.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: AWS已经为他们的Kali AMI设置了默认的SSH访问形式，使用公钥的`ec2-user`帐户。然而，这对于通过移动设备访问并不方便。对于希望通过移动应用程序直接以root权限方便地SSH到他们的Kali实例的用户，以下部分将介绍该过程。然而，需要注意的是，使用具有PKI身份验证的有限用户帐户是通过SSH连接的最安全方式，如果保护实例是优先考虑的话，不建议使用具有密码的root帐户。
- en: Setting root and user passwords
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置root和用户密码
- en: The very first step of configuring root SSH on a Kali Linux instance is to set
    the root password. The root account usually doesn't have a password set for `ec2`
    instances that are using an `ec2-user` account that has `sudo` privileges. However,
    since we are setting up SSH access from mobile SSH applications, this needs to
    be set. It should be noted, however, that this comes with a reduction in the security
    stance of the Kali instance.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在Kali Linux实例上配置root SSH的第一步是设置root密码。通常情况下，使用具有`sudo`权限的`ec2-user`帐户的`ec2`实例不会为root帐户设置密码。然而，由于我们正在设置来自移动SSH应用程序的SSH访问，这需要设置。然而，需要注意的是，这会降低Kali实例的安全性。
- en: 'Changing the root password is as simple as running `sudo passwd` on the SSH
    terminal:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 更改root密码就像在SSH终端上运行`sudo passwd`一样简单：
- en: '![](img/de40240e-d823-46a2-80e3-ac0e2383dc1a.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/de40240e-d823-46a2-80e3-ac0e2383dc1a.png)'
- en: 'Similarly, the password of the current user can also be changed by running
    `sudo passwd ec2-user` over SSH:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，当前用户的密码也可以通过在SSH上运行`sudo passwd ec2-user`来更改：
- en: '![](img/5d806ab5-0848-4e40-819b-51612abc565e.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5d806ab5-0848-4e40-819b-51612abc565e.png)'
- en: This will be helpful in SSH-ing as `ec2-user` from an SSH client application
    that doesn't support authentication keys. However, another step remains before
    we can SSH into the Kali instance as root.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 这将有助于在不支持身份验证密钥的SSH客户端应用程序中作为`ec2-user`进行SSH。然而，在我们能够以root身份SSH到Kali实例之前，还有另一步需要完成。
- en: Enabling root and password authentication on SSH
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在SSH上启用root和密码身份验证
- en: 'As an enhanced security measure, OpenSSH server comes with root login disabled
    by default. Enabling this is a straightforward process and involves editing a
    configuration file, `/etc/ssh/sshd_config`:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 作为增强的安全措施，OpenSSH服务器默认情况下禁用了root登录。启用这一点是一个简单的过程，涉及编辑一个配置文件，`/etc/ssh/sshd_config`：
- en: '![](img/869ede0f-4bfe-48c6-99c1-0628a7037da2.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/869ede0f-4bfe-48c6-99c1-0628a7037da2.png)'
- en: 'The critical parts of this are the two entries:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 其中关键的部分是两个条目：
- en: 'PermitRootLogin: This can be set to `yes` if you want to log in as root'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PermitRootLogin：如果要以root身份登录，可以将其设置为`yes`
- en: 'PasswordAuthentication: This needs to be set to `yes` instead of the default
    `no` to log in using passwords.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PasswordAuthentication：需要将其设置为`yes`，而不是默认的`no`，以便使用密码登录。
- en: 'Once you are done performing the changes, you will need to restart the ssh
    service:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 完成更改后，您需要重新启动ssh服务：
- en: '[PRE0]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: With that, our Kali Machine on the cloud is up and running and can be accessed
    over SSH using a password. However, SSH only gives you a command line interface.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 有了这个，我们在云上的Kali机器已经启动并运行，并且可以通过密码进行SSH访问。但是，SSH只能为您提供命令行界面。
- en: In the next section, we will take a look at how we can set up a remote desktop
    service to get GUI access to our Kali Machine.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将看看如何设置远程桌面服务以获得对Kali机器的GUI访问。
- en: Setting up Guacamole for remote access
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置Guacamole进行远程访问
- en: Apache Guacamole is a clientless remote access solution that will allow you
    to access the Kali Linux instance remotely using a browser. This will allow you
    to access the PentestBox on the go even from a mobile device, without having to
    worry about other complications surrounding remote access. The traditional way
    of accessing such servers is over SSH, but this will not be able to provide a
    GUI when accessed from a mobile device.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: Apache Guacamole是一种无客户端的远程访问解决方案，它将允许您使用浏览器远程访问Kali Linux实例。这将使您能够即使在移动设备上也可以访问PentestBox，而无需担心远程访问周围的其他复杂性。访问此类服务器的传统方式是通过SSH，但是当从移动设备访问时，这将无法提供GUI。
- en: Hardening and installing prerequisites
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加固和安装先决条件
- en: 'Setting up remote access to a VM can be a risky affair, hence it''s recommended
    that we install and set up a firewall and IP blacklisting services to protect
    against brute-forcing attacks and similar attacks on the internet. The services
    we will install are `ufw` and `fail2ban`. They are pretty easy to set up:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 设置远程访问虚拟机可能是一件危险的事情，因此建议安装和设置防火墙和IP黑名单服务，以防范针对互联网的暴力破解和类似攻击。我们将安装的服务是`ufw`和`fail2ban`。它们非常容易设置：
- en: 'All you need to do is run the following command:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您只需要运行以下命令：
- en: '[PRE1]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Once we have installed the `ufw` firewall, we need to allow the two ports that
    we will be using for remote access: `22` for SSH and `55555` for Guacamole. So
    we need to run the following commands:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装了`ufw`防火墙后，我们需要允许用于远程访问的两个端口：`22`用于SSH和`55555`用于Guacamole。因此，我们需要运行以下命令：
- en: '[PRE2]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Once that''s done, we need to restart the `ufw` service:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，我们需要重新启动`ufw`服务：
- en: '![](img/f01117ce-17cc-48f4-9bbe-5f19ba7a9d01.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f01117ce-17cc-48f4-9bbe-5f19ba7a9d01.png)'
- en: 'Next, we need to install the prerequisites for Apache Guacamole. You can do
    this by executing the following command:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要安装Apache Guacamole的先决条件。您可以通过执行以下命令来实现：
- en: '[PRE3]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Post-installation, we need to modify the configuration of Apache Tomcat to
    listen on port `55555` (as set in our Security Group) rather than the default
    `8080`. To do this, we need to run the following command:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装后，我们需要修改Apache Tomcat的配置，使其监听端口`55555`（与我们的安全组设置相匹配），而不是默认的`8080`。为此，我们需要运行以下命令：
- en: '[PRE4]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Within this file, the `Connector port` needs to be changed from `8080` to `55555`,
    as shown in the following screenshot:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这个文件中，`Connector port`需要从`8080`更改为`55555`，如下面的截图所示：
- en: '![](img/45c6d56c-5128-40c3-89a9-a381e9a5cc27.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](img/45c6d56c-5128-40c3-89a9-a381e9a5cc27.png)'
- en: 'Next, we need to set up the RDP Service on the Kali instance. This is easily
    achieved by installing `xrdp` using the following command:'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要在Kali实例上设置RDP服务。通过以下命令安装`xrdp`可以轻松实现这一点：
- en: '[PRE5]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Next, we need to allow all users to access the RDP Service (the X Session).
    This requires the editing of a file:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要允许所有用户访问RDP服务（X会话）。这需要编辑一个文件：
- en: '[PRE6]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Within this file, edit the value of `allowed_users` to `anybody`:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这个文件中，将`allowed_users`的值编辑为`anybody`：
- en: '[PRE7]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Finally, we need to set the `xrdp` services to start automatically and `enable`
    the services:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们需要设置`xrdp`服务自动启动并`enable`服务：
- en: '[PRE8]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Once this step has been completed, we have to download the source code for Apache
    Guacamole server from [https://guacamole.apche.org/releases/](https://guacamole.apache.org/releases/).
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成这一步后，我们需要从[https://guacamole.apche.org/releases/](https://guacamole.apache.org/releases/)下载Apache
    Guacamole服务器的源代码。
- en: 'Keep in mind that you need to download the latest `guacamole-server.tar.gz` and `guacamole.war`
    files. At the time of writing, the latest version is `0.9.14`, which we can download
    using the following command:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，您需要下载最新的`guacamole-server.tar.gz`和`guacamole.war`文件。在撰写本文时，最新版本是`0.9.14`，我们可以使用以下命令下载：
- en: '[PRE9]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Once these have been downloaded, we need to extract the source by executing
    the following code:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦这些文件被下载，我们需要通过执行以下代码来提取源代码：
- en: '[PRE10]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'After entering the extracted directory, we have to build and install the package.
    This can be achieved by executing the following code:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入提取的目录后，我们需要构建和安装软件包。可以通过执行以下代码实现：
- en: '[PRE11]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Once this has been successfully run, Guacamole has been installed. However,
    further configuration needs to be undertaken in order to fully set up remote access.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦成功运行，Guacamole就安装完成了。但是，为了完全设置远程访问，还需要进行进一步的配置。
- en: Configuring Guacamole for SSH and RDP access
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为SSH和RDP访问配置Guacamole
- en: Guacamole's default configuration directory is `/etc/guacamole`. It requires
    a file called `guacamole.properties` to be properly created to function. There
    are some other directories that we might want to place within the configuration
    directory, but they won't be needed for the current setup.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Guacamole的默认配置目录是`/etc/guacamole`。它需要一个名为`guacamole.properties`的文件才能正常运行。还有一些其他目录，我们可能想要放在配置目录中，但对于当前的设置来说，它们是不需要的。
- en: 'The Guacamole properties file should contain information about the address
    of the `guacamole proxy`:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Guacamole属性文件应包含有关`guacamole代理`地址的信息：
- en: '[PRE12]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'In addition to this, we also need another file called `user-mapping.xml` in
    the same directory, containing a list of usernames and passwords that Guacamole
    will authenticate with:'
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除此之外，我们还需要在同一目录中添加一个名为`user-mapping.xml`的文件，其中包含Guacamole将进行身份验证的用户名和密码列表：
- en: '[PRE13]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Once completed, it is time to deploy the war file that we downloaded earlier.
    We need to move it into the `tomcat8/webapps` folder so that it gets auto-deployed:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，是时候部署我们之前下载的war文件了。我们需要将它移动到`tomcat8/webapps`文件夹中，以便自动部署：
- en: '[PRE14]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Now, we just have to restart both the `guacd` and `tomcat8` services to get
    Apache Guacamole up and running! To do that, use the following command:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们只需重新启动`guacd`和`tomcat8`服务，就可以让Apache Guacamole正常运行了！要做到这一点，使用以下命令：
- en: '[PRE15]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'There''s one last configuration step that is required—copying the authentication
    information into the Guacamole client directory. This is done by executing the
    following code:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 还有最后一个配置步骤是必需的——将认证信息复制到Guacamole客户端目录中。执行以下代码即可完成：
- en: '[PRE16]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now, if we point our browser to `ipaddr:55555/guacamole`, we will be able to
    access Guacamole! We are greeted with the following screen:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果我们将浏览器指向`ipaddr:55555/guacamole`，我们就能访问Guacamole了！我们会看到以下屏幕：
- en: '![](img/f16e884d-1970-4e84-a276-f94cf37d8c7f.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f16e884d-1970-4e84-a276-f94cf37d8c7f.png)'
- en: We have to log in with the same credentials that we set up in the `user-mapping.xml`
    file.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们必须使用在`user-mapping.xml`文件中设置的相同凭据登录。
- en: 'Once we have successfully logged in, it''s a simple matter of selecting the
    technique through which we want to access the server:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦我们成功登录，只需简单地选择我们想要访问服务器的技术：
- en: '![](img/e6040e16-2a6c-44bc-a265-c2bd1f40c3f2.png)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e6040e16-2a6c-44bc-a265-c2bd1f40c3f2.png)'
- en: Congratulations, you have successfully set up your Kali PentestBox on the cloud
    and can access it remotely from anywhere using your browser!
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜，您已成功在云上设置了Kali PentestBox，并可以在任何地方使用浏览器远程访问！
- en: Summary
  id: totrans-112
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: After going through this chapter, you will be able to successfully set up a
    Kali Linux PentestBox on the Amazon Cloud, which will aid you in the exercises
    in the upcoming chapters. We learned how to set up remote access to the cloud
    instance via SSH, RDP, and Apache Guacamole. This chapter also focused on certain
    information about the hardening of a cloud instance that will help you to better
    understand several advanced security concepts related to the EC2 service further
    in the book.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 通过阅读本章，您将能够成功在亚马逊云上设置Kali Linux PentestBox，这将有助于您在接下来的章节中进行练习。我们学会了如何通过SSH、RDP和Apache
    Guacamole设置远程访问云实例。本章还着重介绍了有关云实例加固的某些信息，这将帮助您更好地理解本书后续有关EC2服务的一些高级安全概念。
- en: In the next chapter, we will be going through the steps to perform automated
    and manual pentests of our pentesting lab (which we set up in the first chapter)
    using the PentestBox that we set up in this chapter.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将介绍如何使用我们在第一章中设置的PentestBox对我们的渗透测试实验室进行自动化和手动渗透测试的步骤。
- en: Questions
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: What is the advantage of using Guacamole for remote access rather than a service
    such as `tightvnc`?
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与使用`tightvnc`等服务相比，使用Guacamole进行远程访问的优势是什么？
- en: With the current setup, anyone who knows the IP address can easily access the
    Guacamole interface. Is there any way to protect the server from such access?
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用当前设置，任何知道IP地址的人都可以轻松访问Guacamole界面。有没有办法保护服务器免受这种访问？
- en: What is the purpose of the `-Wno-error` flag that was added during the compilation
    process of Guacamole?
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Guacamole编译过程中添加的`-Wno-error`标志的目的是什么？
- en: Why does the default `sshd_config` set the PermitRootLogin value to `no`?
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么默认的`sshd_config`将PermitRootLogin值设置为`no`？
- en: Why does AWS disable password-based login?
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么AWS禁用基于密码的登录？
- en: Can we use SSH-tunneling to improve the security of this setup?
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以使用SSH隧道来提高此设置的安全性吗？
- en: Further reading
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: SSH Tunneling: [https://www.ssh.com/ssh/tunneling/](https://www.ssh.com/ssh/tunneling/)
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH隧道：[https://www.ssh.com/ssh/tunneling/](https://www.ssh.com/ssh/tunneling/)
- en: PKI in SSH: [https://www.ssh.com/pki/](https://www.ssh.com/pki/)
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH中的PKI：[https://www.ssh.com/pki/](https://www.ssh.com/pki/)
- en: Proxying Guacamole: [https://guacamole.apache.org/doc/gug/proxying-guacamole.html ](https://guacamole.apache.org/doc/gug/proxying-guacamole.html)
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代理Guacamole：[https://guacamole.apache.org/doc/gug/proxying-guacamole.html ](https://guacamole.apache.org/doc/gug/proxying-guacamole.html)
