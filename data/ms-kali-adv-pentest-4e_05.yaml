- en: '5'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '5'
- en: Advanced Social Engineering and Physical Security
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高级社会工程学和物理安全
- en: 'Social engineering is a method of manipulating humans to extract information
    or perform malicious activity by interacting with them. It is the most effective
    attack that has made many great organizations succumb to security incidents. Attackers
    may choose single or multiple ways to target individuals by exploiting human psychology,
    which can effectively trick a human into providing physical access to a system.
    It is the single most successful attack vector used during red teaming exercises,
    penetration testing, or in an actual attack. The success of a social engineering
    attack relies on two key factors:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 社会工程学是一种通过与人类互动来操纵他们，从而获取信息或执行恶意活动的方法。它是最有效的攻击手段，已经使许多大型组织陷入安全事件之中。攻击者可以通过利用人类心理来选择单一或多种方式针对个人，这样可以有效地欺骗人类，让他们为攻击者提供对系统的物理访问权限。它是红队演练、渗透测试或实际攻击中使用的最成功的攻击途径。社会工程学攻击的成功依赖于两个关键因素：
- en: The knowledge that is gained during the reconnaissance phase. The attacker must
    know the names and usernames associated with the target; more importantly, the
    attacker must understand the concerns of the users on the network.
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在侦察阶段获得的知识。攻击者必须知道与目标相关的名称和用户名；更重要的是，攻击者必须了解网络中用户的关注点。
- en: 'Understanding how to apply this knowledge to convince potential targets to
    activate the attack by impersonating an authority, talking to them over the phone,
    inquiring about them, encouraging them to click links, or executing a program.
    In recent years, the following two tactics have been the most successful:'
  id: totrans-4
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 了解如何运用这些知识来说服潜在目标启动攻击，通过冒充权威与他们通话，询问他们的信息，鼓励他们点击链接或执行程序。近年来，以下两种战术最为成功：
- en: If the targeted company has recently finished their yearend appraisal, every
    employee in the company would be very much focused on receiving their updated
    salary package from the Human Resources department. Therefore, emails or documents
    with titles associated with that subject will likely be opened by the targeted
    individuals.
  id: totrans-5
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果目标公司最近刚刚完成年终评估，那么公司中的每个员工都会非常关注从人力资源部门收到更新后的薪资包。因此，与该主题相关的电子邮件或文档很可能会被目标个人打开。
- en: If the targeted company had acquired or merged with another, the type of social
    engineering attack would be whaling, targeting C-level managers and other high-profile
    individuals in both companies. The main principle behind this type of attack is
    that more privileges the user has, the more access the attackers can gain.
  id: totrans-6
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果目标公司收购或合并了另一家公司，则社交工程学攻击的类型将是鲸吞攻击，目标是C级管理人员以及两家公司中的其他高管。此类攻击的主要原理是，用户拥有的特权越多，攻击者可以获得的访问权限也就越多。
- en: Kali Linux provides several tools and frameworks that have an increased chance
    of success if social engineering is used as a pretext to influence victims to
    open files or execute certain operations. The examples include file-based executables,
    created by the Metasploit framework, and using file-less techniques, such as PowerShell
    scripts using Empire 3.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux提供了多个工具和框架，如果将社会工程学作为前提来影响受害者打开文件或执行特定操作，这些工具和框架的成功几率会大大提高。例如，Metasploit框架创建的基于文件的可执行文件，以及使用无文件技术的PowerShell脚本（如Empire
    3）。
- en: In this chapter, we will explore some **Tactics, Techniques, and Procedures**
    (**TTPs**) and take a deep dive into utilizing the **Social Engineering Toolkit**
    (also known as **SET** and **SEToolkit**) and **Gophish**. The techniques used
    in employing these tools will serve as the model for using social engineering
    to deploy attacks from other tools.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨一些**战术、技术和流程**（**TTPs**），并深入了解如何利用**社会工程学工具包**（也称为**SET**和**SEToolkit**）以及**Gophish**。使用这些工具的技术将作为运用社会工程学从其他工具中部署攻击的模型。
- en: 'By the end of this chapter, you will have learned the following concepts and
    methods:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，您将学习以下概念和方法：
- en: The different social engineering attack methods that can be engaged by attackers
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击者可能采取的不同社会工程学攻击方法
- en: How to perform physical attacks at the console
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何在控制台执行物理攻击
- en: Creating rogue physical devices using microcontrollers and USBs
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用微控制器和USB创建伪造物理设备
- en: Harvesting or collecting usernames and passwords using the credential harvester
    attack
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过凭证收割者攻击收集用户名和密码
- en: Launching the Tabnabbing and Web Jacking attack
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动Tabnabbing和Web Jacking攻击
- en: Employing the Multi-Attack web method
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用多重攻击Web方法
- en: Using PowerShell’s alphanumeric shellcode injection attack
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用PowerShell的字母数字Shellcode注入攻击
- en: How to set up Gophish on Kali Linux
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何在Kali Linux上设置Gophish
- en: Launching an email phishing campaign
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发起电子邮件钓鱼活动
- en: 'To support SET’s social engineering attacks, the following general implementation
    practices will also be described:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 为支持SET的社会工程学攻击，以下一般实施实践也将被描述：
- en: Hiding malicious executables and obfuscating the attacker’s URL
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隐藏恶意可执行文件并混淆攻击者的URL
- en: Escalating an attack using DNS redirection
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过DNS重定向升级攻击
- en: Gaining access to the system and network through a USB
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过USB获取系统和网络的访问权限
- en: Command methodology and TTPs
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 命令方法学和TTPs
- en: As an attack route supporting the cyber kill chain methodology, social engineering
    focuses on the different aspects of an attack that take advantage of a person’s
    trust and innate helpfulness, to deceive and manipulate them into compromising
    a network and its resources.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 作为支持网络杀伤链方法论的攻击路径，社会工程学专注于利用人的信任和天生的帮助意识来欺骗和操纵他们，从而破坏网络及其资源。
- en: '*Figure 5.1* depicts the different types of attack methods that attackers can
    engage in to harvest information and/or gain access.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.1*展示了攻击者可以采取的不同攻击方法，以收集信息和/或获取访问权限。'
- en: '![](../Images/B17765_05_01.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_01.png)'
- en: 'Figure 5.1: Different types of social engineering tactics'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1：不同类型的社会工程学策略
- en: 'From the previous editions of this book, we have now reclassified social engineering
    tactics into two main categories: one that involves technology, and another that
    includes people-specific techniques. The following sections will provide a briefing
    on the two categories; later on, we will explore computer-based attacks, especially
    physical attacks and email phishing using Kali Linux.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 从本书的前几版中，我们现在已将社会工程学策略重新分类为两大类：一类涉及技术，另一类包括针对人的特定技术。以下章节将简要介绍这两类；之后我们将探讨基于计算机的攻击，特别是使用Kali
    Linux进行的物理攻击和电子邮件钓鱼攻击。
- en: Technology
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术
- en: As technology has evolved from traditional PCs to laptops and mobile phones,
    so have social engineering techniques. In this section, we will discuss the computer-
    and mobile-based attacks that can be performed using Kali Linux.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 随着技术从传统PC到笔记本电脑和手机的演变，社会工程学技术也在不断发展。本节将讨论可以使用Kali Linux进行的基于计算机和移动设备的攻击。
- en: Computer-based
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 基于计算机的
- en: 'Attacks that utilize computers to perform social engineering are subdivided
    into the following types. All of these are best utilized only when all passive
    and active reconnaissance information is utilized to the maximum:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 利用计算机进行社会工程学攻击可以细分为以下几种类型。所有这些攻击都最好在最大化利用所有被动和主动侦察信息的基础上进行：
- en: '**Email phishing**: Attacks that utilize the email medium to harvest information
    or exploit a known software vulnerability in the victim’s system are referred
    to as email phishing.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**电子邮件钓鱼**：利用电子邮件媒介收集信息或利用受害者系统中已知软件漏洞的攻击称为电子邮件钓鱼。'
- en: '**Baiting/Quid Pro Quo**: This is a technique that is used to embed a known
    vulnerability and create a backdoor, achieved by utilizing USB sticks and CDs.
    Baiting has more of a focus on exploiting the human curiosity factor through the
    use of physical media. Attackers can create a Trojan that will provide backdoor
    access to the system, either by utilizing the autorun feature, or when a user
    clicks to open the files inside the drive. Quid Pro Quo is similar to Baiting,
    but in this case, the victim gets something in exchange for the Trojan.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**诱饵/交换条件**：这是一种通过利用USB闪存盘和光盘来嵌入已知漏洞并创建后门的技术。诱饵更侧重于通过使用物理媒介来利用人类的好奇心。攻击者可以创建一个特洛伊木马，借助自动运行功能或用户点击打开驱动器内的文件时，提供对系统的后门访问。交换条件与诱饵类似，但在这种情况下，受害者会为特洛伊木马提供某些东西作为交换。'
- en: '**Wi-Fi phishing**: Penetration testers can utilize this technique to harvest
    usernames and passwords by setting up a fake Wi-Fi network, similar to the targeted
    company. For example, the attackers could target a company by setting the SSID
    in their Wi-Fi to the exact same (or something similar) to a company’s, allowing
    users to connect without any password to the fake wireless router. We will explore
    more about these attacks in *Chapter 6*, *Wireless and Bluetooth Attacks*.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Wi-Fi 钓鱼**：渗透测试人员可以利用此技术通过设置一个与目标公司相似的虚假Wi-Fi网络来收集用户名和密码。例如，攻击者可以通过将其Wi-Fi的SSID设置为与公司相同（或相似）来瞄准目标公司，从而允许用户无需密码即可连接到虚假的无线路由器。我们将在*第六章*，*无线和蓝牙攻击*中深入探讨这些攻击。'
- en: Mobile-based
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 基于移动设备
- en: 'Mobile-based attacks have become an easy way to capture confidential information
    or try to collect other important details that might serve for the goal of penetration
    testing or a **Red Team Exercise** (**RTE**). We will discuss the two most commonly
    used mobile-based attacks that are deployed by attackers:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 基于移动设备的攻击已成为一种轻松获取机密信息或尝试收集其他重要细节的方法，这些细节可能有助于渗透测试或**红队演练**（**RTE**）的目标。我们将讨论攻击者常用的两种基于移动设备的攻击：
- en: '**SMSishing**: Attackers perform phishing using **Short Message Service** (**SMS**)
    by sending links or drafting a message that allows the user to click on a link
    or reply to the text. Penetration testers can also utilize publicly offered services,
    such as [https://www.spoofmytextmessage.com/free](https://www.spoofmytextmessage.com/free).'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**短信钓鱼**：攻击者通过**短消息服务**（**SMS**）执行钓鱼攻击，发送包含链接的短信或草拟一条允许用户点击链接或回复文本的消息。渗透测试人员还可以利用公开提供的服务，例如[https://www.spoofmytextmessage.com/free](https://www.spoofmytextmessage.com/free)。'
- en: '**Quick Response Code** (**QR code**)**:** During a red team exercise, QR codes
    are also the most effective way to deliver a payload to an isolated area. Similar
    to spamming, QR codes with a message of winning bounty or with the latest news
    (like free Covid-19 vaccine registration) can be printed and posted in places
    where most people visit, for example, cafeterias, smoking zones, toilets, and
    other rush areas.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**快速响应码**（**QR 码**）**：** 在红队演练中，二维码也是将有效负载传递到隔离区域的最有效方式。类似于垃圾邮件，包含中奖奖励信息或最新消息（如免费新冠疫苗注册）的二维码可以打印出来，并张贴在人们常去的地方，例如餐厅、吸烟区、厕所和其他繁忙区域。'
- en: People-based
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 基于人群
- en: People-based attacks are the most effective type of attack during a red team
    exercise or penetration test. These attacks are focused on the behavior of people
    in a given situation. The following sections explain the different types of attack
    that can be performed by focusing on people’s weaknesses and the different tactics
    used to exploit them.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 基于人群的攻击是红队演练或渗透测试中最有效的攻击类型。这些攻击集中在特定情况下人们的行为。以下部分解释了通过专注于人们的弱点以及利用这些弱点的不同策略来执行的不同类型的攻击。
- en: Physical attacks
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 物理攻击
- en: 'Physical attacks typically involve the physical existence of an attacker, who
    then performs a social engineering attack. The following are the two types of
    physical attacks that are engaged during an **RTE** or penetration test:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 物理攻击通常涉及攻击者的实际存在，攻击者随后执行社交工程攻击。以下是进行**红队演练**或渗透测试时常见的两种物理攻击类型：
- en: '**Impersonation or pretexting**: This involves the testers creating a script
    and impersonating an important person to harvest information from a targeted set
    of staff. We recently performed a social engineering attack with the goal of identifying
    the username and password of a domain user through a physical social engineering
    exercise. The scenario involves an attacker talking to the victim and impersonating
    the internal IT helpdesk, *“Dear Mr. X, I am Mr. Y from the internal IT department.
    It has been noted that your system has been disconnected from the network for
    a period of 20 days. It is recommended to install the latest system updates due
    to the latest ransomware attack. Do you mind providing the laptop along with your
    username and password?”* That resulted in the user providing the login details
    and, as a bonus, passing on the laptop to the attacker. The attacker’s next move
    is to plant a backdoor into the system to maintain persistent access.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**冒充或伪装**：这包括测试者编写脚本并冒充重要人物，以从目标员工群体中获取信息。我们最近进行了一次社会工程攻击，目的是通过一次物理社会工程演练，识别域用户的用户名和密码。场景设定为攻击者与受害者对话，并冒充内部IT帮助台，“亲爱的X先生，我是来自内部IT部门的Y先生。我们注意到您的系统已经与网络断开连接20天。由于最近发生的勒索病毒攻击，建议您安装最新的系统更新。您能提供您的笔记本电脑以及用户名和密码吗？”这导致用户提供了登录详情，并且作为奖励，将笔记本电脑交给了攻击者。攻击者的下一步是将后门程序植入系统，以保持持续访问。'
- en: '**Attacks at the console**: These involve all attacks that involve physical
    access to the system, such as changing the password of an administrator user,
    planting a keylogger, extracting stored browser passwords, or the installation
    of backdoor.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**控制台攻击**：这些攻击包括所有涉及物理访问系统的攻击，例如更改管理员用户的密码、植入键盘记录器、提取存储的浏览器密码或安装后门程序。'
- en: Voice-based
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 基于语音的
- en: Any attack that involves a voice message and tricks the user into performing
    an action on a computer or leaking sensitive information is referred to as voice-based
    social engineering.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 任何通过语音信息欺骗用户在计算机上执行操作或泄露敏感信息的攻击，都被称为基于语音的社会工程攻击。
- en: '**Vishing** is the art of utilizing a recorded voice message or an individual
    calling the victim to extract information from a targeted victim or group of victims.
    Typically, vishing involves a trustable script, for example, if *Company X* announces
    a new joint venture with *Company Y*, the staff will be curious about the future
    of both companies. This allows the attackers to call the victim directly with
    a pre-defined script, as follows:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '**电话欺诈**（vishing）是利用录音语音信息或个人直接拨打电话给受害人，以从目标受害人或受害人群体中提取信息的艺术。通常，电话欺诈会涉及可信的脚本，例如，如果*公司X*宣布与*公司Y*建立新的合资企业，员工会对两家公司未来的发展感到好奇。这使得攻击者可以直接拨打电话，使用预先定义的脚本，如下所示：'
- en: “Hello, I am Mr. X calling from Company Y. We have now been announced as partaking
    in a joint venture, so technically we are all on the same team. Can you please
    let me know where your data centers are located, and provide me with list of mission-critical
    servers? If you are not the right person, can you point me to the right one? Many
    thanks, Mr. X”.
  id: totrans-49
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “您好，我是来自公司Y的X先生。我们现在已经宣布参与了一个合资企业，因此从技术上讲，我们都在同一个团队中。您能告诉我您的数据中心在哪里吗，并提供一份关键任务服务器的清单吗？如果您不是合适的人选，能否指引我找对人？非常感谢，X先生。”
- en: Very well-done vishing can lead attackers not only to gain access to confidential
    information but also remain stealthy and avoid unwanted attention. Let us discuss
    the next important attack, gaining access to physical devices.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 精心设计的电话欺诈（vishing）可以使攻击者不仅获得机密信息，还能保持隐蔽，避免引起不必要的注意。接下来我们讨论一个重要的攻击方法——获取物理设备的访问权限。
- en: Physical attacks at the console
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 控制台的物理攻击
- en: In this section, we will explore different types of attack that are typically
    performed on a system where physical access is possible.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨在可以进行物理访问的系统上通常执行的不同类型攻击。
- en: samdump2 and chntpw
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: samdump2 和 chntpw
- en: 'One of the most popular ways to dump password hashes is to utilize `samdump2`.
    This can be done by turning on the power of the acquired system and then booting
    it through our Kali USB stick by making the required changes in the BIOS (say,
    in Lenovo, one can press *F12* to bring up the boot menu and select the USB):'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 最常用的密码哈希转储方法之一是利用`samdump2`。这可以通过打开已获取系统的电源，然后通过我们的Kali USB启动它，方法是在BIOS中进行必要的更改（比如在联想电脑上，可以按*F12*键进入启动菜单并选择USB）来完成：
- en: Once the system is booted through Kali, by default the local hard drive must
    be mounted as a media drive (assuming the media drive is not encrypted with BitLocker
    or something similar), as shown in *Figure 5.2*:![](../Images/B17765_05_02.png)
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦通过 Kali 启动系统，默认情况下本地硬盘必须作为媒体驱动器挂载（假设媒体驱动器没有被 BitLocker 或类似的加密保护），如 *图 5.2*
    所示：![](../Images/B17765_05_02.png)
- en: 'Figure 5.2: All mounted disks on Kali Linux'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.2：Kali Linux 上的所有挂载磁盘
- en: 'If the drive is not mounted by default, the attackers can manually mount the
    drive by running the following commands:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果默认没有挂载驱动器，攻击者可以通过运行以下命令手动挂载驱动器：
- en: '[PRE0]'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Once the system is mounted, navigate to the mounted folder (in our case, it
    is `/media/root/<ID>/Windows/System32/Config`), and run `samdump2 SYSTEM SAM`,
    as shown in *Figure 5.3*. The `SYSTEM` and `SAM` files should display all the
    users on the system drive, along with their password hashes, which will then be
    used to crack the password offline using the `John` (John the Ripper) or `hashcat`
    tools.![](../Images/B17765_05_03.png)
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统挂载后，导航到挂载的文件夹（在我们的例子中为 `/media/root/<ID>/Windows/System32/Config`），并运行 `samdump2
    SYSTEM SAM`，如 *图 5.3* 所示。`SYSTEM` 和 `SAM` 文件应显示系统驱动器上的所有用户及其密码哈希，随后可使用 `John`（John
    the Ripper）或 `hashcat` 工具离线破解密码。![](../Images/B17765_05_03.png)
- en: 'Figure 5.3: Output of samdump2 with the password hashes'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.3：使用 samdump2 输出的密码哈希
- en: Using the same access, attackers can also remove the password of a user from
    the system. `chntpw` is a Kali Linux tool that can be used to edit the Windows
    registry, reset a user’s password, and promote a user to as an administrator,
    as well as several other useful options. Using `chntpw` is a great way to reset
    a Windows password, or otherwise gain access to a Windows machine when the password
    is unknown.
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用相同的访问权限，攻击者还可以从系统中删除用户密码。`chntpw` 是一个 Kali Linux 工具，可用于编辑 Windows 注册表、重置用户密码、将用户提升为管理员，并提供其他一些有用的选项。使用
    `chntpw` 是重置 Windows 密码或在密码未知的情况下访问 Windows 计算机的好方法。
- en: '`chntpw` is a utility to view information and change user passwords in Windows
    NT/2000, XP, Vista, 7, 8.1, 10, and other Windows servers with the ability to
    boot the device with an external drive.'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`chntpw` 是一个工具，用于查看信息并更改 Windows NT/2000、XP、Vista、7、8.1、10 以及其他 Windows 服务器的用户密码，支持通过外部驱动器启动设备。'
- en: The SAM user database file is usually located at `\WINDOWS\system32\config\SAM`
    on the Windows filesystem. Navigate to folder, as shown in *Figure 5.4*:![](../Images/B17765_05_04.png)
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: SAM 用户数据库文件通常位于 Windows 文件系统的 `\WINDOWS\system32\config\SAM`。导航到文件夹，如 *图 5.4*
    所示：![](../Images/B17765_05_04.png)
- en: 'Figure 5.4: All the files from Windows system32 config folder'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.4：来自 Windows system32 config 文件夹的所有文件
- en: Run `chntpw SAM`; the password is stored in the `SAM` file in Windows. **Security
    Accounts Manager** (**SAM**) is a database file in Windows XP, Windows Vista,
    and Windows 7 that stores users’ passwords.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 `chntpw SAM`；密码存储在 Windows 中的 `SAM` 文件中。**安全账户管理器** (**SAM**) 是 Windows XP、Windows
    Vista 和 Windows 7 中的一个数据库文件，存储用户的密码。
- en: 'The SAM file can be used to authenticate local and remote users. Usually, the
    `SAM` file is located in `C/Windows/system32/config/SAM`:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: SAM 文件可以用于验证本地和远程用户。通常，`SAM` 文件位于 `C/Windows/system32/config/SAM`：
- en: Enter `chntpw -i SAM` in the Kali Linux terminal from `/media/root/<ID>/Windows/System32/Config`
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Kali Linux 终端中输入 `chntpw -i SAM`，路径为 `/media/root/<ID>/Windows/System32/Config`
- en: Select `1 – edit user data and passwords`
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 `1 – 编辑用户数据和密码`
- en: Enter the `RID` of the user, in this case `03ef`, as shown in *Figure 5.5*:![](../Images/B17765_05_05.png)
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入用户的 `RID`，在此例中为 `03ef`，如 *图 5.5* 所示：![](../Images/B17765_05_05.png)
- en: 'Figure 5.5: Interactive terminal using chntpw to edit SAM file'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.5：使用 chntpw 编辑 SAM 文件的交互式终端
- en: 'Select `1 – clear (blank) user password`, and then enter `q` to complete the
    task. Enter `y` for `write hive` `files`. Finally, you should be able to get a
    confirmation like this: `<SAM> - OK`. *Figure 5.6* shows the edited SAM file contents:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 `1 – 清除（空白）用户密码`，然后输入 `q` 完成任务。输入 `y` 进行 `写入 hive` `文件`。最后，你应该能够得到类似于 `<SAM>
    - OK` 的确认信息。*图 5.6* 显示了编辑后的 SAM 文件内容：
- en: '![](../Images/B17765_05_06.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_06.png)'
- en: 'Figure 5.6: Final SAM file edit confirmation that our password was set to blank'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.6：最终的 SAM 文件编辑确认，表明我们的密码已设置为空
- en: In Windows 10, a reboot of the system will contain `hyberfile.sys`, which will
    not allow the attackers to mount the system drive. To mount the system drive and
    gain access to the drive, use `mount -t ntfs-3g -ro remove_hiberfile /dev/sda2
    /mnt/folder`. Note that some systems with endpoint encryption tools such as BitLocker
    or any other vendor may not be able to boot after this file is deleted.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows 10 中，系统重启后会包含 `hyberfile.sys` 文件，这会阻止攻击者挂载系统驱动器。要挂载系统驱动器并访问该驱动器，可以使用
    `mount -t ntfs-3g -ro remove_hiberfile /dev/sda2 /mnt/folder`。请注意，某些具有端点加密工具（如
    BitLocker 或任何其他供应商工具）的系统，在删除此文件后可能无法启动。
- en: Other bypassing tools include Kon-boot, which is another forensics utility that
    utilizes a similar feature to `chntpw`. Kon-boot only affects the administrator
    account and doesn’t remove the administrator’s password; it just lets you log
    in without a password, and on the next normal system reboot, the original administrator’s
    password is in place, intact.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 其他绕过工具包括 Kon-boot，它是另一种取证工具，利用类似于 `chntpw` 的功能。Kon-boot 仅影响管理员账户，不会移除管理员的密码；它只让你在不输入密码的情况下登录，在下次正常系统重启时，原始的管理员密码仍然
    intact。
- en: 'This tool can be downloaded from this website: [https://www.piotrbania.com/all/kon-boot/](https://www.piotrbania.com/all/kon-boot/).'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具可以从此网站下载：[https://www.piotrbania.com/all/kon-boot/](https://www.piotrbania.com/all/kon-boot/)。
- en: Sticky Keys
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Sticky Keys
- en: In this section, we will explore how to utilize physical access to the console
    of a Windows computer that is unlocked or without a password. Attackers can exploit
    the feature of Microsoft Windows Sticky Keys to plant a backdoor in a fraction
    of a second; however, the caveat is that you will need to have administrator privileges
    to place the executable. But when the system is booted through Kali Linux, the
    attackers can place the files without any restrictions.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨如何利用物理访问 Windows 计算机的控制台（该计算机解锁或没有密码）。攻击者可以利用微软 Windows Sticky Keys
    特性在几秒钟内植入后门；然而，前提是你需要管理员权限才能放置可执行文件。但当系统通过 Kali Linux 启动时，攻击者可以不受任何限制地放置文件。
- en: 'The following is a list of Windows utilities that can be utilized by attackers
    to replace utility executables with `cmd.exe` or `powershell.exe`:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是攻击者可以利用的 Windows 工具列表，这些工具可以将实用程序可执行文件替换为 `cmd.exe` 或 `powershell.exe`：
- en: '`sethc.exe`'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sethc.exe`'
- en: '`utilman.exe`'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`utilman.exe`'
- en: '`osk.exe`'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`osk.exe`'
- en: '`narrator.exe`'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`narrator.exe`'
- en: '`magnify.exe`'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`magnify.exe`'
- en: '`displayswitch.exe`'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`displayswitch.exe`'
- en: 'The following steps are involved in replacing `sethc.exe` with `cmd.exe`:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是将 `sethc.exe` 替换为 `cmd.exe` 的步骤：
- en: '[PRE1]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '*Figure 5.7* shows the backdoor of `cmd.exe`, when we hit the *Shift* key five
    times to invoke `sethc.exe`. However, Command Prompt will appear as we replaced
    the `cmd.exe` with `sethc.exe`.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5.7* 显示了 `cmd.exe` 的后门，当我们按下 *Shift* 键五次以调用 `sethc.exe` 时，命令提示符会出现，因为我们将
    `cmd.exe` 替换为 `sethc.exe`。'
- en: '![A picture containing text, electronics, computer, computer  Description automatically
    generated](../Images/B17765_05_07.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![A picture containing text, electronics, computer, computer Description automatically
    generated](../Images/B17765_05_07.png)'
- en: 'Figure 5.7: Backdoor display of Sticky Keys (sethc.exe) running Command Prompt
    (cmd.exe)'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.7：显示 `Sticky Keys`（sethc.exe）后门运行命令提示符（cmd.exe）
- en: We have explored how to clear a Windows 10 local user’s password and also set
    a backdoor through legitimate Windows programs.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经探讨了如何清除 Windows 10 本地用户的密码，并通过合法的 Windows 程序设置后门。
- en: Creating a rogue physical device
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个伪造的物理设备
- en: Kali also facilitates attacks where the intruder has direct physical access
    to systems and the network. This can be a risky attack, as the intruder may be
    spotted by an observant human or caught on a surveillance device. However, the
    rewards can be significant because the intruder can compromise specific systems
    that have valuable data.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: Kali 还可以帮助进行入侵者直接物理访问系统和网络的攻击。这种攻击可能具有风险，因为入侵者可能会被细心的人发现或被监控设备拍到。然而，回报可能非常可观，因为入侵者可以入侵包含重要数据的特定系统。
- en: 'Physical access is usually a direct result of social engineering, especially
    when impersonation is used. Common impersonations include the following:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 物理访问通常是社会工程学的直接结果，尤其是在使用冒充时。常见的冒充包括以下几种：
- en: A person who claims to be from the help desk or IT support and just needs to
    quickly interrupt the victim by installing a system upgrade.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个自称是帮助台或 IT 支持人员的人，声称只是需要快速通过安装系统升级来中断受害者。
- en: A vendor who drops by to talk to a client, and then excuses himself to talk
    to someone else or visit a restroom.
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一名供应商拜访客户，然后借口与别人交谈或去卫生间。
- en: A delivery person dropping off a package. Attackers can buy a delivery uniform
    online; however, since most people assume that anyone who is dressed all in brown
    and pushing a handcart filled with boxes is a UPS delivery person, uniforms are
    rarely a necessity for social engineering!
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 送货员送包裹。攻击者可以在网上购买送货制服；然而，由于大多数人认为穿着全身棕色制服并推着装满箱子的手推车的人是UPS的送货员，因此制服在社会工程中往往不是必需的！
- en: Trade persons wearing work clothes, carrying a work order that they have printed
    out, are usually allowed access to wiring closets and other areas, especially
    when they claim to be present at the request of the building manager.
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 穿着工装、手里拿着打印出来的工作单的工人通常会被允许进入配线间和其他区域，特别是当他们声称是根据楼宇经理的要求前来时。
- en: Dress in an expensive suit, carry a clipboard, and walk fast; employees will
    assume that you’re an unknown manager. When conducting this type of penetration,
    we usually inform people that we are auditors, and our inspections are rarely
    questioned.
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 穿上昂贵的西装，拿着文件夹，走路迅速；员工们会认为你是个不为人知的经理。在进行这种渗透测试时，我们通常会告诉别人我们是审计员，而且我们的检查很少受到质疑。
- en: The goal of hostile physical access is to rapidly compromise selected systems;
    this is usually accomplished by installing a backdoor or similar device on the
    target. One of the classic attacks is to place a USB key (in the form of keyboard/mouse)
    in a system and let the system install it using the AutoPlay option; however,
    many organizations disable AutoPlay across the network.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 敌对物理访问的目标是迅速破坏选定的系统；这通常是通过在目标上安装后门或类似设备来实现的。一种经典的攻击方式是将一个USB键（形式为键盘/鼠标）插入系统，并让系统通过自动播放选项安装它；然而，许多组织会在整个网络中禁用自动播放功能。
- en: 'Attackers can also create poisoned bait traps: mobile devices that contain
    files with names that invite a person to click on the file and examine its contents.
    Some examples include the following:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者还可以设置诱饵陷阱：携带含有文件的移动设备，文件名吸引人点击并查看内容。以下是一些例子：
- en: USB keys with labels such as “Employee Salaries”, “Medical Insurance Updates”,
    or “Covid-19 exit strategy”.
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带有“员工薪资”、“医疗保险更新”或“Covid-19退出策略”等标签的USB驱动器。
- en: Metasploit allows an attacker to bind a payload, such as a reverse shell, to
    an executable, such as a screensaver. The attacker can create a screensaver using
    publicly available corporate images, and mail USBs to employees with the new endorsed
    screensaver. When the user installs the program, the backdoor is also installed
    and it connects to the attacker.
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Metasploit允许攻击者将有效载荷（如反向Shell）绑定到可执行文件（如屏幕保护程序）上。攻击者可以使用公开可用的公司图片创建屏幕保护程序，并将带有新屏幕保护程序的USB寄给员工。当用户安装该程序时，后门也被安装，并连接到攻击者的服务器。
- en: If you know that employees have attended a recent conference, attackers can
    impersonate a vendor who was present and send the target a letter insinuating
    that it is a follow-up from the vendor show. A typical message will be, *“If you
    missed our product demonstration and one-year free trial, please review the slideshow
    on the attached USB key by clicking on start.exe.”*
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你知道员工最近参加了某个会议，攻击者可以冒充出席的供应商，并向目标发送一封信，暗示这是供应商展会的后续。典型的消息内容是，*“如果你错过了我们的产品演示和一年的免费试用，请通过点击start.exe查看附带的USB中的幻灯片。”*
- en: Microcomputer or USB-based attack agents
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 微型计算机或基于USB的攻击代理
- en: We have noticed a significant increase in using microcomputers and USB-based
    devices in RTE/penetration testing. These are mainly used due to their compactness;
    they can be hidden anywhere on the network and also can run almost anything that
    a full-fledged laptop can. In this section, we will explore the most commonly
    used devices, the Raspberry Pi and MalDuino USB.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们注意到在RTE/渗透测试中使用微型计算机和基于USB的设备的显著增加。这些设备由于其紧凑性而被广泛使用；它们可以隐藏在网络的任何地方，并且几乎能运行任何一台完整的笔记本电脑能运行的程序。在本节中，我们将探讨最常用的设备——树莓派和MalDuino
    USB。
- en: The Raspberry Pi
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 树莓派
- en: The Raspberry Pi is a microcomputer; it measures approximately 8.5 cm by 5.5
    cm but manages to pack 2-8 GB RAM, two USB 2.0 or two USB 3.0 ports, and an Ethernet
    port supported by a Broadcom chip, using a 64-bit quad-core CPU, running at 1.5GHz,
    with the support of Wi-Fi and Bluetooth. It doesn’t include a hard drive but uses
    an SD card for data storage. As shown in *Figure 5.8*, the Raspberry Pi is approximately
    pocket sized; it is easy to hide on a network (behind workstations or servers,
    placed inside server cabinets, or hidden beneath floor panels in a data center).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 树莓派是一款微型计算机，尺寸约为8.5厘米×5.5厘米，但它却集成了2-8GB的RAM、两个USB 2.0或两个USB 3.0端口以及一个由Broadcom芯片支持的以太网端口，采用1.5GHz的64位四核CPU，并支持Wi-Fi和蓝牙。它没有硬盘，而是使用SD卡进行数据存储。如*图5.8*所示，树莓派几乎是口袋大小；它很容易隐藏在网络中（例如放置在工作站或服务器后面，置于服务器机柜内，或者隐藏在数据中心的地板板下）。
- en: '![](../Images/B17765_05_08.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_08.png)'
- en: 'Figure 5.8: Photo of assembled Raspberry Pi 4'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.8：组装好的树莓派4照片
- en: 'To configure a Raspberry Pi as an attack vector, the following items are required:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要将树莓派配置为攻击向量，需要以下物品：
- en: A Raspberry Pi Model B, or newer versions
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一块树莓派Model B，或更新版本
- en: An HDMI cable
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一根HDMI线
- en: A micro-USB cable and charging block
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一根micro-USB线和充电器
- en: An Ethernet cable or mini-wireless adapter
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一根以太网线或迷你无线适配器
- en: An SD card, Class 10, at least 16 GB in size
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一张SD卡，Class 10，至少16GB的容量
- en: 'Together, all these supplies are typically available online for a total of
    less than $100\. The following are the steps to configure the Raspberry Pi with
    latest version of Kali Linux:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，所有这些设备通常都可以在网上购买，总花费不到100美元。以下是将树莓派配置为最新版本的Kali Linux的步骤：
- en: To configure the Raspberry Pi, download the latest version of the Kali Linux
    ARM edition from [https://www.kali.org/get-kali/#kali-arm](https://www.kali.org/get-kali/#kali-arm).
    Extract it from the source archive. If you are configuring from a Windows-based
    desktop, then we would utilize the same Rufus utility as utilized in *Chapter
    1*, *Goal-Based Penetration Testing*, to make a bootable Kali USB stick.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要配置树莓派，请从[https://www.kali.org/get-kali/#kali-arm](https://www.kali.org/get-kali/#kali-arm)下载最新版本的Kali
    Linux ARM版。从源压缩包中提取它。如果您正在从基于Windows的桌面配置，则可以使用*第1章*中介绍的相同Rufus工具来制作启动的Kali USB磁盘。
- en: 'Using a card reader, connect the SD card to the Windows-based computer and
    open the Rufus utility. Select the ARM version of Kali, `kali-custom-rpi.img`,
    which was downloaded and extracted previously, and write it to the SD card. Separate
    instructions for flashing the SD card from Mac or Linux systems are available
    on the Kali website: [https://www.kali.org/docs/usb/live-usb-install-with-mac/](https://www.kali.org/docs/usb/live-usb-install-with-mac/).'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用卡读器，将SD卡连接到基于Windows的计算机，并打开Rufus工具。选择之前下载并解压的Kali ARM版本，`kali-custom-rpi.img`，并将其写入SD卡。从Mac或Linux系统烧录SD卡的详细说明可以在Kali官网找到：[https://www.kali.org/docs/usb/live-usb-install-with-mac/](https://www.kali.org/docs/usb/live-usb-install-with-mac/)。
- en: Insert the newly flashed SD card into the Raspberry Pi and connect the Ethernet
    cable or wireless adapter to the Windows workstation, the HDMI cable to a monitor,
    and the micro-USB power cable to a power supply, a keyboard, and a mouse. Once
    supplied with power, it will boot directly into Kali Linux. The Raspberry Pi relies
    on external power, and there is no separate on/off switch; however, Kali can still
    be shut down from the command line by running `halt` in the terminal. Once Kali
    is installed, ensure that it is up to date using the `apt update` command.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将新烧录的SD卡插入树莓派，并将以太网线或无线适配器连接到Windows工作站，将HDMI线连接到显示器，将micro-USB电源线连接到电源，键盘和鼠标也连接好。连接电源后，树莓派将直接启动进入Kali
    Linux。树莓派依赖外部电源，并且没有独立的开关；但是，Kali Linux仍然可以通过在终端中运行`halt`命令来关闭。Kali安装完成后，确保使用`apt
    update`命令进行更新。
- en: 'Make sure the SSH host keys are changed as soon as possible, as all Raspberry
    Pi images have the same keys. Use the following commands in the Kali Linux terminal:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请确保尽快更改SSH主机密钥，因为所有树莓派映像都使用相同的密钥。在Kali Linux终端中使用以下命令：
- en: '[PRE2]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: At the same time, make sure the default username and password are changed by
    running `sudo passwd kali` in the terminal.
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 同时，确保通过在终端中运行`sudo passwd kali`更改默认的用户名和密码。
- en: Configure the Raspberry Pi to connect back to the attacker’s computer (using
    a static IP address or using DynDNS) at regular intervals using a `cron` job.
    An attacker must then physically access the target’s premises and connect the
    Raspberry Pi to the network. Most networks automatically assign devices a DHCP
    address and have limited defences against this type of attack.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置树莓派定期通过 `cron` 任务连接回攻击者的计算机（使用静态 IP 地址或 DynDNS）。然后，攻击者必须物理访问目标的场所，并将树莓派连接到网络。大多数网络会自动为设备分配
    DHCP 地址，并且对这种攻击类型的防御有限。
- en: Once the Raspberry Pi connects back to the attacker’s IP address, the attacker
    can run reconnaissance and exploit applications against the victim’s internal
    network from a remote location, using SSH to issue commands.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦树莓派连接回攻击者的 IP 地址，攻击者可以远程使用 SSH 发出命令，对受害者的内部网络进行侦察和利用。
- en: If a wireless adapter is connected, such as EW-7811Un V2, the 150 Mbps wireless
    802.11b/g/n Nano USB adapter, the attacker can connect wirelessly or use the Pi
    to launch wireless attacks.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如果连接了无线适配器，如 EW-7811Un V2，即 150 Mbps 无线 802.11b/g/n Nano USB 适配器，攻击者可以通过无线连接或使用树莓派发起无线攻击。
- en: 'MalDuino: the BadUSB'
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: MalDuino：坏 USB
- en: MalDuino is an Arduino-powered USB that can be used by attackers during an RTE/penetration
    testing activity. This device has a keyboard injection capability and runs the
    commands within a fraction of a second. These devices are extremely useful during
    physical security with access to the organization’s building. Often, people inside
    the organization rarely lock their computer, assuming the physical access restrictions
    are safeguards and no one would do anything. Even if attackers gain access physically
    to the system, staff can arguably say “we have no USB policy;” well, it’s a good
    point. But disabling a USB does not disable USB-based keyboards—when attackers
    plug in MalDuino, it acts as a keyboard, typing commands exactly how a human being
    would run a specified payload and execute it.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: MalDuino 是一个由 Arduino 驱动的 USB 设备，攻击者可以在 RTE/渗透测试活动中使用该设备。该设备具有键盘注入功能，能够在几分之一秒内运行命令。这些设备在拥有组织建筑物物理访问权限的情况下，尤其有用。通常，组织内部的人很少锁定他们的计算机，认为物理访问限制就是安全措施，不会有人动手。即使攻击者物理访问了系统，工作人员也可以辩称“我们没有
    USB 政策”；嗯，这是个好理由。但禁用 USB 并不等于禁用基于 USB 的键盘——当攻击者插入 MalDuino 时，它会充当键盘，模拟人类输入命令，并精确执行指定的有效载荷。
- en: 'There are two flavors of MalDuino: Elite and Lite. The difference is that Elite
    provides an SD card option for you to dump around 16 different payloads with the
    hardware switches on the device, so that you don’t need to reconfigure the entire
    device. With MalDuino Lite, you have to configure the device every time you change
    the payload.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: MalDuino 有两个版本：Elite 和 Lite。区别在于，Elite 提供了一个 SD 卡选项，可以在设备上的硬件开关下加载大约 16 个不同的有效载荷，这样你就不需要重新配置整个设备。使用
    MalDuino Lite，每次更改有效载荷时都需要重新配置设备。
- en: 'The board supports the Ducky Script templates, making it easy to build custom
    scripts. *Figure 5.9* depicts the MalDuino Elite hardware:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 该板支持 Ducky Script 模板，使得创建自定义脚本变得容易。*图 5.9* 展示了 MalDuino Elite 硬件：
- en: '![](../Images/B17765_05_09.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_09.png)'
- en: 'Figure 5.9: MalDuino as USB'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.9：MalDuino 作为 USB 设备
- en: Instructions on how to set up the board can be found at [https://malduino.com/wiki/doku.php?id=setup:elite](https://malduino.com/wiki/doku.php?id=setup:elite).
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 设置板子的说明可以在 [https://malduino.com/wiki/doku.php?id=setup:elite](https://malduino.com/wiki/doku.php?id=setup:elite)
    找到。
- en: 'We will focus on setting up an Empire PowerShell script for the board by following
    these steps:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将专注于通过以下步骤为板子设置 Empire PowerShell 脚本：
- en: Generate the PowerShell payload in Empire (refer to *Chapter 10*, *Exploitation*).
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Empire 中生成 PowerShell 有效载荷（参见*第 10 章*，*利用*）。
- en: Ensure the listeners are up and listening for any connections.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保监听器已经启动并在监听任何连接。
- en: Convert the PowerShell launcher into strings; since MalDuino has a buffer size
    of 256 bytes, the payloads must be fragmented. This can be achieved by visiting
    [https://malduino.com/converter/](https://malduino.com/converter/).
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 PowerShell 启动器转换成字符串；由于 MalDuino 的缓冲区大小为 256 字节，因此有效载荷必须被分割。这可以通过访问 [https://malduino.com/converter/](https://malduino.com/converter/)
    来实现。
- en: Once the strings are converted, it should look something like that shown in
    *Figure 5.10*:![](../Images/B17765_05_10.png)
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦字符串转换完成，它应该像*图 5.10*中所示那样：![](../Images/B17765_05_10.png)
- en: 'Figure 5.10: Organizing the strings to match the limit of 254 characters per
    line'
  id: totrans-139
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.10：组织字符串以匹配每行 254 字符的限制
- en: The next step is to build the payload into a script, as shown in *Figure 5.11*:![](../Images/B17765_05_11.png)
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是将有效载荷构建成脚本，如*图 5.11*所示：![](../Images/B17765_05_11.png)
- en: 'Figure 5.11: Loading the payload into MalDuino'
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.11：将有效载荷加载到 MalDuino 中
- en: The final action is to plug the device into the victim machine; you should now
    be able to see an agent reporting back, as shown in *Figure 5.12*:![](../Images/B17765_05_12.png)
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后的操作是将设备插入受害者的机器；此时，你应该能够看到代理回报，如*图 5.12*所示：![](../Images/B17765_05_12.png)
- en: 'Figure 5.12: Successful connection from MalDuino to our Empire listener'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.12：MalDuino成功连接到我们的Empire监听器
- en: We have learned how to utilize the purpose-built MalDuino USB to launch a reverse
    shell to the attackers. One other scenario that attackers can utilize is dropping
    these devices in target locations, such as a cafeteria, or even courier these
    to the company CEO’s personal assistant with a high-alert message from a court
    or regulatory authority; the curiosity or the fear of the victim gets the job
    done for the attackers.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经学会如何利用专为MalDuino USB设计的设备来启动反向Shell连接到攻击者。攻击者还可以利用另一种场景，即将这些设备投放到目标地点，例如自助餐厅，甚至将其快递给公司CEO的私人助理，并附上一封来自法院或监管机构的高警报信息；受害者的好奇心或恐惧心理完成了攻击者的任务。
- en: The Social Engineering Toolkit (SET)
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 社会工程工具包 (SET)
- en: SET was created and written by David Kennedy (`@ReL1K`), founder of trustedsec,
    and it is maintained by an active group of collaborators (`www.social-engineer.org`).
    It is an open-source Python-driven framework that is specifically designed to
    facilitate social engineering attacks.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: SET由David Kennedy（`@ReL1K`）创建和编写，他是trustedsec的创始人，并由一个活跃的协作小组维护（`www.social-engineer.org`）。它是一个开源的、基于Python的框架，专门设计用于便于社会工程攻击。
- en: The tool was designed with the objective of achieving security by training.
    A significant advantage of SET is its interconnectivity with the Metasploit framework,
    which provides the payloads needed for exploitation, the encryption to bypass
    antivirus software, and the listener module, which connects to the compromised
    system when it sends a shell back to the attacker.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具的设计目标是通过培训实现安全性。SET的一个重要优势是它与Metasploit框架的互联性，Metasploit提供了所需的有效载荷、绕过杀毒软件的加密技术以及连接到受损系统的监听模块，当它发送Shell回到攻击者时。
- en: 'To open SET in a Kali distribution, go to `Applications | Social Engineering
    Tools | social engineering toolkit`, or enter `sudo setoolkit` at a shell prompt.
    You will be presented with the main menu, as shown in *Figure 5.13*:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在Kali发行版中打开SET，进入`Applications | Social Engineering Tools | social engineering
    toolkit`，或在Shell提示符下输入`sudo setoolkit`。你将看到如*图 5.13*所示的主菜单：
- en: '![](../Images/B17765_05_13.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_13.png)'
- en: 'Figure 5.13: Startup screen on SET'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.13：SET启动屏幕
- en: 'If you select `1) Social-Engineering Attacks`, you will be presented with the
    following submenu, shown in *Figure 5.14*:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 如果选择`1) 社会工程攻击`，将会出现如下子菜单，如*图 5.14*所示：
- en: '![](../Images/B17765_05_14.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_14.png)'
- en: 'Figure 5.14: Social engineering attack main menu'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.14：社会工程攻击主菜单
- en: 'The attacking menu options are as follows:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击菜单选项如下：
- en: '**Spear-Phishing Attack Vectors**: This module allows an attacker to create
    email messages and templates and send them to targeted victims with attached exploits.'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**鱼叉式钓鱼攻击向量**：此模块允许攻击者创建电子邮件消息和模板，并将其与附加的漏洞一起发送到目标受害者。'
- en: '**Website Attack Vectors**: One of the comprehensive modes that allow attackers
    to utilize multiple sub-modules to perform a variety of web attacks—we will explore
    some modules in the coming sections.'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**网站攻击向量**：这是一个综合模式，允许攻击者利用多个子模块进行各种网站攻击——我们将在接下来的章节中探索一些模块。'
- en: '**Infectious Media Generator**: This creates an `autorun.inf` file and Metasploit
    payload. Once burned or copied to a USB device or physical media (CD or DVD),
    and inserted into the target system, it will trigger autorun (if autorun is enabled)
    and compromise the system.'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**感染性媒体生成器**：该选项会创建一个`autorun.inf`文件和Metasploit有效载荷。一旦烧录或复制到USB设备或物理媒体（如CD或DVD），并插入目标系统，它将触发自动运行（如果启用了自动运行）并破坏系统。'
- en: '**Create a Payload and Listener**: This module is a rapid menu-driven method
    of creating a Metasploit payload. The attacker must use a separate social engineering
    attack to convince the target to launch it.'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**创建有效载荷和监听器**：此模块是一个快速的菜单驱动方式来创建Metasploit有效载荷。攻击者必须使用另一个社会工程攻击说服目标启动它。'
- en: '**Mass Mailer Attack**: To be able to send mass emails using `Sendmail` and
    spoof the sender’s identity.'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**群发邮件攻击**：能够使用 `Sendmail` 发送群发邮件并伪造发件人身份。'
- en: '**Arduino-Based Attack Vector**: This programs Arduino-based devices, such
    as the Teensy ([https://www.pjrc.com/teensy/](https://www.pjrc.com/teensy/)).
    Because these devices register as a USB keyboard when connected to a physical
    Windows system, they can bypass security based on disabling autorun or other endpoint
    protection.'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**基于 Arduino 的攻击向量**：这通过编程 Arduino 设备，如 Teensy（[https://www.pjrc.com/teensy/](https://www.pjrc.com/teensy/)）。因为这些设备在连接到物理
    Windows 系统时会注册为 USB 键盘，所以它们能够绕过基于禁用自动运行或其他终端保护的安全措施。'
- en: '**Wireless Access Point Attack Vector**: This will create a fake wireless access
    point and DHCP server on the attacker’s system, and redirect all DNS queries to
    the attacker. The attacker can then launch various attacks, such as the Java applet
    or a credential harvester attack.'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**无线接入点攻击向量**：这将在攻击者的系统上创建一个伪造的无线接入点和 DHCP 服务器，并将所有 DNS 查询重定向到攻击者。攻击者随后可以发起各种攻击，例如
    Java 小程序或凭证收集器攻击。'
- en: '**QRCode Generator Attack Vector**: This creates a QR code with a defined URL
    associated with an attack.'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**二维码生成器攻击向量**：这会创建一个与攻击相关联的二维码，二维码中包含一个指定的 URL。'
- en: '**PowerShell Attack Vectors**: This allows the attacker to create attacks that
    rely on PowerShell, a command-line shell and scripting language available on versions
    of Windows from Vista onwards.'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**PowerShell 攻击向量**：这允许攻击者创建依赖于 PowerShell 的攻击，PowerShell 是一种命令行外壳和脚本语言，在 Vista
    及以后版本的 Windows 中可用。'
- en: '**Third Party Modules**: This allows the attacker to use the **Remote Administration
    Tool Tommy Edition** (**RATTE**) and Google analytics attack by Zonksec. RATTE
    is a part of the Java applet attack; it is a text menu-driven remote access tool
    and can work as an isolated payload.'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**第三方模块**：这允许攻击者使用 **远程管理工具 Tommy 版** (**RATTE**) 和 Zonksec 提供的 Google Analytics
    攻击。RATTE 是 Java 小程序攻击的一部分，它是一个基于文本菜单的远程访问工具，可以作为独立的载荷使用。'
- en: SET also provides a menu item for **fast-track penetration testing**, which
    gives rapid access to some specialized tools that support brute-force identification
    and password cracking of SQL databases, as well as some customized exploits that
    are based on Python, SCCM attack vectors, Dell computer DRAC/chassis exploitation,
    user enumeration, and PsExec PowerShell injection.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: SET 还提供了 **快速渗透测试** 的菜单项，快速访问一些支持 SQL 数据库暴力破解和密码破解的专用工具，以及基于 Python 的一些自定义漏洞利用工具，SCCM
    攻击向量，Dell 计算机 DRAC/机箱利用，用户枚举和 PsExec PowerShell 注入。
- en: The menu also gives options for updating the SET and updating the configuration.
    However, these additional options should be avoided, as they are not fully supported
    by Kali, and may cause conflicts with dependencies.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 菜单还提供了更新 SET 和更新配置的选项。然而，这些额外的选项应避免使用，因为 Kali 不完全支持它们，可能会与依赖关系产生冲突。
- en: Social-engineering attacks
  id: totrans-167
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 社会工程攻击
- en: The latest version of the social engineering toolkit has removed the Spoof SMS
    and Full-screen attack modules. The following is a brief explanation of the social
    engineering attacks.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 社会工程工具包的最新版本已移除了伪造短信和全屏攻击模块。以下是社会工程攻击的简要说明。
- en: '`The Spear-Phishing Attack Vector` allows an attacker to create email messages
    and send them to targeted victims with attached exploits. `Website Attack Vectors`
    utilize multiple web-based attacks, including the following:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '`鱼叉式钓鱼攻击向量` 允许攻击者创建邮件并将其发送给目标受害者，附带漏洞利用代码。`网站攻击向量` 利用多种基于网络的攻击方式，包括以下几种：'
- en: '**Java applet attack method**: This spoofs a Java certificate and delivers
    a Metasploit-based payload. This is one of the most successful attacks, and it
    is effective against Windows, Linux, and macOS targets.'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Java 小程序攻击方法**：这会伪造 Java 证书并传递基于 Metasploit 的载荷。这是最成功的攻击之一，能有效攻击 Windows、Linux
    和 macOS 目标。'
- en: '**Metasploit browser exploit method**: This delivers a Metasploit payload using
    an iFrame attack.'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Metasploit 浏览器漏洞攻击方法**：这通过 iFrame 攻击传递 Metasploit 载荷。'
- en: '**Credential harvester attack method**: This clones a website and automatically
    rewrites the `POST` parameters to allow an attacker to intercept and harvest user
    credentials; it then redirects the victim back to the original site when harvesting
    is completed.'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**凭证收集器攻击方法**：这会克隆一个网站，并自动重写 `POST` 参数，允许攻击者拦截并收集用户凭证；收集完成后，它会将受害者重定向回原始网站。'
- en: '**Tabnabbing attack method**: This replaces information on an inactive browser
    tab with a cloned page that links back to the attacker. When the victim logs in,
    the credentials are sent to the attacker.'
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Tabnabbing 攻击方法**：这会将一个不活动的浏览器标签页上的信息替换为一个克隆页面，该页面链接回攻击者。当受害者登录时，凭证会被发送给攻击者。'
- en: '**Web jacking attack method**: This utilizes iFrame replacements to make the
    highlighted URL link appear legitimate; however, when it is clicked, a window
    pops up and the legitimate link is then replaced with a malicious link.'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Web 劫持攻击方法**：该方法利用 iFrame 替换，使突出显示的 URL 链接看起来是合法的；然而，当点击该链接时，会弹出一个窗口，并且合法的链接会被恶意链接替换。'
- en: '**Multi-attack web method**: This allows an attacker to select some or all
    of the several attacks that can be launched at once, including the following:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**多重攻击网络方法**：这允许攻击者选择一次发起的多个攻击中的一部分或全部，包括以下内容：'
- en: Java applet attack method
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Java 小应用攻击方法
- en: Metasploit browser exploit method
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Metasploit 浏览器漏洞利用方法
- en: Credential harvester attack method
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 凭证收集攻击方法
- en: Tabnabbing attack method
  id: totrans-179
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tabnabbing 攻击方法
- en: Web Jacking attack method
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web 劫持攻击方法
- en: '**HTA attack method**: This is when an attacker presents a fake website that
    will automatically download HTML applications in `.HTA` format.'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**HTA 攻击方法**：这是一种攻击者展示一个伪造网站，自动下载 `.HTA` 格式的 HTML 应用程序。'
- en: 'As an initial example of SET’s strengths, we will see how it can be used to
    gain a remote shell: a connection made from the compromised system back to the
    attacker’s system.'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 作为 SET 强大功能的初步示例，我们将看到它如何被用来获得远程 Shell：即从被攻击系统到攻击者系统的连接。
- en: 'Testers performing a Tabnabbing attack might encounter the following error
    message: `[!] Something went wrong, printing the error: module ''urllib'' has
    no attribute ''urlopen''`. This is a known issue with the current version. However,
    an alternative method is to select the multi-attack web attack method and then
    perform the Tabnabbing attack.'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 执行 Tabnabbing 攻击的测试人员可能会遇到以下错误信息：`[!] 出现问题，打印错误：模块 'urllib' 没有属性 'urlopen'`。这是当前版本的已知问题。然而，可以选择多重攻击网络方法，然后执行
    Tabnabbing 攻击。
- en: Credential harvester web attack method
  id: totrans-184
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 凭证收集器 Web 攻击方法
- en: Credentials, generally the username and password, give a person access to networks,
    computing systems, and data more generally. An attacker can use this information
    indirectly (by logging on to the victim’s Gmail account and sending emails to
    facilitate an attack against the victim’s trusted connections, say), or directly
    against the user’s account. This attack is particularly relevant given the extensive
    reuse of credentials; users typically reuse passwords in multiple places.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 凭证（通常是用户名和密码）使得一个人可以访问网络、计算系统以及更广泛的数据。攻击者可以通过间接方式使用这些信息（例如，登录受害者的Gmail账户并发送电子邮件来推动攻击，针对受害者的信任关系），或直接攻击用户账户。由于凭证广泛重用，这种攻击尤其具有相关性；用户通常会在多个地方重复使用相同的密码。
- en: Particularly prized are the credentials of a person with privileged access,
    such as a system or database administrator, which can give an attacker access
    to multiple accounts and data repositories.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 特别重要的是拥有特权访问权限的人的凭证，例如系统管理员或数据库管理员的凭证，这可以让攻击者访问多个账户和数据存储库。
- en: The SET’s credential harvesting attack uses a cloned site to collect credentials.
    To launch this attack, select `2) Website Attack Vectors` from the main menu,
    then `3) Credential Harvester Attack Method`, and then select `2) Site Cloner`.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: SET 的凭证收集攻击使用克隆站点来收集凭证。要启动此攻击，从主菜单选择 `2) 网站攻击向量`，然后选择 `3) 凭证收集攻击方法`，再选择 `2)
    网站克隆`。
- en: 'For this example, we will follow the menu selections to clone a website, such
    as Facebook, as shown in *Figure 5.15*:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们将按照菜单选择克隆一个网站，如 Facebook，如 *图 5.15* 所示：
- en: '![](../Images/B17765_05_15.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_15.png)'
- en: 'Figure 5.15: Cloning Facebook to our Kali Linux using the credential harvester'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.15：使用凭证收集器克隆 Facebook 到我们的 Kali Linux 系统
- en: 'Again, the attacker’s IP address must be sent to the intended target. When
    the target clicks on the link or enters the IP address, they will be presented
    with a cloned page that resembles the regular login page for Facebook, as shown
    in *Figure 5.16*, and they will be prompted to enter their username and password:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 再次提醒，攻击者的 IP 地址必须发送到目标。当目标点击链接或输入 IP 地址时，他们将看到一个克隆页面，类似于 Facebook 的常规登录页面，如
    *图 5.16* 所示，并会被提示输入用户名和密码：
- en: '![](../Images/B17765_05_16.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_16.png)'
- en: 'Figure 5.16: Hosting facebook.com on our local Kali Linux'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.16：在我们的本地 Kali Linux 上托管 facebook.com
- en: 'Once this is done, the users will be redirected to the regular Facebook site,
    where they will be logged in to their account. In the background, their access
    credentials will be collected and forwarded to the attacker. The attacker will
    see the following entry, shown in *Figure 5.17*:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，用户将被重定向到常规的Facebook站点，在那里他们将登录自己的账户。在后台，他们的访问凭证将被收集并转发给攻击者。攻击者将看到如下记录，如*图5.17*所示：
- en: '![](../Images/B17765_05_17.png)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_17.png)'
- en: 'Figure 5.17: Successful capture of the username and password field from our
    hosted local facebook.com'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.17：成功捕获我们托管的本地facebook.com的用户名和密码字段
- en: When the attacker has finished collecting credentials, entering *Ctrl* + *C*
    will generate two reports in the `/SET/reports` directory in XML and HTML formats.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 当攻击者完成凭证收集后，按下*Ctrl* + *C*会在`/SET/reports`目录下生成两个报告，格式分别为XML和HTML。
- en: Note that the address in the URL bar is not the valid address for Facebook;
    most users will recognize that something is wrong if they can see the address.
    A successful exploit requires the attacker to prepare the victim with a suitable
    pretext, or story, to make the victim accept the unusual URL. For example, send
    an email to a targeted group of non-technical managers to announce that a local
    Facebook site is now being hosted by IT to reduce delays in the email system.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，URL栏中的地址并不是有效的Facebook地址；大多数用户如果看到该地址会意识到有问题。成功的攻击需要攻击者为受害者准备一个合适的借口或故事，让受害者接受这个不寻常的URL。例如，向一个非技术性的管理层目标群体发送电子邮件，通知他们现在由IT托管的本地Facebook站点可以减少邮件系统的延迟。
- en: The credential harvesting attack is an excellent tool for assessing the security
    of a corporate network. To be effective, the organization must first train all
    the employees on how to recognize and respond to a phishing attack. Approximately
    two weeks later, send a corporate-wide email that contains some obvious mistakes
    (incorrect name of the corporate CEO or an address block that contains the wrong
    address) and a link to a program that harvests credentials. Calculate the percentage
    of recipients who responded with their credentials, and then tailor the training
    program to reduce this percentage.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 凭证收集攻击是评估公司网络安全的一个优秀工具。为了有效实施，该组织首先需要培训所有员工，教他们如何识别并应对钓鱼攻击。大约两周后，发送一封包含一些明显错误（如错误的公司CEO名字或包含错误地址的地址块）和一个能够收集凭证的程序链接的公司内部邮件。计算响应凭证的收件人百分比，并根据结果调整培训计划，以减少这个百分比。
- en: Multi-attack web attack method
  id: totrans-200
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 多重攻击网络攻击方法
- en: 'The Hail Mary attack for website attack vectors is a multi-attack web method
    that allows the attacker to implement several different attacks at one time, should
    they choose to. By default, all attacks are disabled, and the attacker chooses
    the ones to run against the victim. To launch this attack, select `2) Website
    Attack Vectors` from the main menu, then select `6) Multi-Attack Web Method`,
    and then select `2) Site Cloner`, as shown in *Figure 5.18*:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 网站攻击向量的Hail Mary攻击是一种多重攻击网络方法，允许攻击者同时实施几种不同的攻击，前提是他们选择这样做。默认情况下，所有攻击都是禁用的，攻击者可以选择对目标执行哪些攻击。要启动此攻击，请从主菜单选择`2)
    网站攻击向量`，然后选择`6) 多重攻击网络方法`，接着选择`2) 网站克隆`，如*图5.18*所示：
- en: '![](../Images/B17765_05_18.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_18.png)'
- en: 'Figure 5.18: Multi-attack web attack vectors menu'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.18：多重攻击网络攻击向量菜单
- en: You can either select `6\. Use them all – A.K.A 'Tactical Nuke'` or enter the
    attack you want to perform by entering the right number; for `Web Jacking Attack
    Method`, for example, enter `5`.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以选择`6\. 使用所有攻击 – 即“战术核弹”`，或者输入你想要执行的攻击类型的数字；例如，对于`Web Jacking攻击方法`，请输入`5`。
- en: This is an effective option if you are unsure as to which attacks will be effective
    against a target organization; select one employee, determine the successful attack(s),
    and then reuse them against the other employees.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不确定哪些攻击对目标组织有效，这是一种有效的选项；选择一名员工，确定成功的攻击类型，然后将其重复用于其他员工。
- en: HTA web attack method
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: HTA网络攻击方法
- en: This type of attack is a simple HTML application that can provide full access
    to the remote attacker. The usual file extension of an HTA is `.hta`. An HTA is
    treated like any executable file with the extension `.exe`. When executed via
    `mshta.exe` (or when the file icon is double-clicked), it runs immediately. When
    executed remotely via the browser, the user is asked once, before the HTA is downloaded,
    whether or not to save and run the application; if saved, it can simply be run
    on demand after that.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 这种类型的攻击是一个简单的 HTML 应用程序，可以为远程攻击者提供完全访问权限。HTA 文件的常见扩展名是 `.hta`。HTA 被视为与 `.exe`
    扩展名的可执行文件一样。当通过 `mshta.exe` 执行时（或双击文件图标时），它会立即运行。当通过浏览器远程执行时，用户会在 HTA 下载之前被询问是否保存并运行该应用程序；如果保存，之后可以按需运行该程序。
- en: 'An attacker can create a malicious application for Windows using web technologies.
    To launch an HTA attack using social engineering toolkit, select `1) Social-Engineering
    Attacks` from the main menu. Then, select `2) Website Attack Vectors` from the
    next menu, and select `7) HTA Attack Method`, followed by `2) Site Cloner,` to
    clone any website. In this case, we will clone `facebook.com`, as shown in *Figure
    5.19*:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可以使用 Web 技术为 Windows 创建恶意应用程序。要使用社会工程工具包发起 HTA 攻击，从主菜单选择 `1) 社会工程攻击`。然后，从下一个菜单选择
    `2) 网站攻击向量`，再选择 `7) HTA 攻击方法`，最后选择 `2) 网站克隆器` 来克隆任意网站。在本例中，我们将克隆 `facebook.com`，如*图
    5.19*所示：
- en: '![](../Images/B17765_05_19.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_19.png)'
- en: 'Figure 5.19: Successful setup of an HTA attack web attack by cloning facebook.com'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.19：通过克隆 facebook.com 成功设置 HTA 网络攻击
- en: 'Attackers will now send the server with the fake `facebook.com` site to the
    victim users to phish for information; *Figure 5.20* depicts what a victim would
    see:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者现在将向受害者用户发送伪造的 `facebook.com` 网站，以进行信息钓鱼；*图 5.20* 展示了受害者将看到的内容：
- en: '![](../Images/B17765_05_20.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_20.png)'
- en: 'Figure 5.20: Victim’s screen, which pops up with the delivery of HTA payload
    to the endpoint'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.20：受害者的屏幕，在 HTA 负载传送到终端时弹出
- en: 'If the victim user runs the HTA file locally on the system, an additional pop-up
    from Internet Explorer security will open up the reverse connection to the attackers,
    as shown in *Figure 5.21*. SET should automatically set up with a listener from
    Metasploit:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 如果受害者用户在系统上本地运行 HTA 文件，Internet Explorer 安全性将弹出一个额外的对话框，建立与攻击者的反向连接，如*图 5.21*所示。SET
    应该会自动设置 Metasploit 的监听器：
- en: '![](../Images/B17765_05_21.png)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_21.png)'
- en: 'Figure 5.21: Successful payload execution leading to Metasploit reverse shell
    of the victim'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.21：成功执行负载，导致 Metasploit 反向 Shell 连接受害者
- en: Using the PowerShell alphanumeric shellcode injection attack
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 PowerShell 字母数字 Shellcode 注入攻击
- en: SET also incorporates more effective attacks based on PowerShell, which is available
    on all Microsoft operating systems after the release of Microsoft Windows Vista.
    Because PowerShell shellcode can easily be injected into the target’s physical
    memory, attacks using this vector do not trigger antivirus alarms.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: SET 还结合了基于 PowerShell 的更有效攻击方法，这些方法在 Microsoft Windows Vista 发布后，适用于所有 Microsoft
    操作系统。由于 PowerShell shellcode 可以轻松地注入目标的物理内存，通过这种方式发起的攻击不会触发杀毒软件警报。
- en: To launch a PowerShell injection attack using SET, select `1) Social-Engineering
    Attacks` from the main menu. Then select `9) PowerShell Attack Vectors` from the
    next menu. This will give the attacker four options for attack types; for this
    example, select `1` to invoke the PowerShell alphanumeric shellcode injector.
    This will set the attack parameters and prompt the attacker to enter the IP address
    for the payload listener, which will usually be the IP address of the attacker.
    When this has been entered, the program will create the exploit code and start
    a local listener.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 SET 发起 PowerShell 注入攻击，从主菜单选择 `1) 社会工程攻击`。然后从下一个菜单选择 `9) PowerShell 攻击向量`。这将给攻击者提供四种攻击类型的选择；对于本示例，选择
    `1` 来调用 PowerShell 字母数字 shellcode 注入器。这将设置攻击参数，并提示攻击者输入负载监听器的 IP 地址，这通常是攻击者的 IP
    地址。输入完成后，程序将创建利用代码并启动本地监听器。
- en: 'The PowerShell shellcode that launches the attack is stored at `/root/.set/reports/
    powershell/x86_powershell_injection.txt`. The social engineering aspect of the
    attack occurs when the attacker convinces the intended victim to copy the contents
    of `x86_powershell_injection.txt` into a PowerShell prompt, as shown in *Figure
    5.22*, and execute the code:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 启动攻击的 PowerShell Shellcode 存储在 `/root/.set/reports/ powershell/x86_powershell_injection.txt`
    中。攻击的社会工程学部分发生在攻击者说服目标受害者将 `x86_powershell_injection.txt` 的内容复制到 PowerShell 提示符中，如*图
    5.22*所示，并执行代码：
- en: '![](../Images/B17765_05_22.png)Figure 5.22: PowerShell payload in the /root/.set/reports/powershell
    folder'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '![](../Images/B17765_05_22.png)图 5.22：/root/.set/reports/powershell 文件夹中的 PowerShell
    载荷'
- en: 'As shown in *Figure 5.23*, execution of the shellcode did not trigger an antivirus
    alarm on the target system. Instead, when the code was executed, it opened a Meterpreter
    session on the attacking system and allowed the attacker to gain an interactive
    shell with the remote system:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 如*图 5.23*所示，Shellcode 的执行没有触发目标系统的杀毒警报。相反，当代码被执行时，它在攻击系统上打开了一个 Meterpreter 会话，并允许攻击者与远程系统建立交互式
    Shell：
- en: '![](../Images/B17765_05_23.png)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_23.png)'
- en: 'Figure 5.23: Confirmation of Metasploit reverse shell from the victim to our
    listener on SET'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.23：确认 Metasploit 反向 Shell 从受害者到我们的 SET 监听器
- en: Once the remote system access is gained, the attackers should create a backdoor,
    which we will explore in *Chapter 13*, *Command and Control*. We have now explored
    the important techniques that can be used by attackers during a social engineering
    exercise using SET.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦获得远程系统的访问权限，攻击者应创建一个后门，关于这一点，我们将在*第 13 章*《命令与控制》中深入探讨。我们现在已经探索了攻击者在使用 SET
    进行社会工程学攻击时可以使用的重要技术。
- en: Hiding executables and obfuscating the attacker’s URL
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 隐藏可执行文件并混淆攻击者的 URL
- en: 'As shown in the previous examples, there are two keys to successfully launching
    a social engineering attack. The first is to obtain the information needed to
    make it work: usernames, business information, and supporting details about networks,
    systems, and applications. The majority of the effort, however, is focused on
    the second aspect: crafting the attack to entice the target into opening an executable
    or clicking on a link.'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 如前面示例所示，成功发起社会工程学攻击有两个关键。第一个是获取使其有效所需的信息：用户名、业务信息以及有关网络、系统和应用程序的支持细节。然而，大部分的精力集中在第二个方面：精心设计攻击以诱使目标打开可执行文件或点击链接。
- en: 'Several attacks produce modules that require the victim to execute them in
    order for the attack to succeed. Unfortunately, users are increasingly wary about
    executing unknown software. There are, however, some ways to increase the possibility
    of successful attack execution, including the following:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 一些攻击生成的模块需要受害者执行它们才能使攻击成功。不幸的是，用户对执行未知软件的警觉性越来越高。然而，有一些方法可以增加攻击执行成功的可能性，包括以下几种：
- en: 'Launch an attack from a system that is known and trusted by the intended victim
    or spoof the source of the attack. If the attack appears to originate from the
    help desk or IT support and claims to be an urgent software update, it will likely
    be executed:'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从受害者已知并信任的系统发起攻击，或伪造攻击的来源。如果攻击看起来来自帮助台或 IT 支持，并声称是紧急软件更新，那么它很可能会被执行：
- en: Rename the executable to something that resembles the trusted software, such
    as `Java Update`.
  id: totrans-230
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将可执行文件重命名为类似于受信任软件的名称，例如 `Java Update`。
- en: Embed the malicious payload into a benign file, such as a PDF file, using an
    attack, such as Metasploit’s `adobe_pdf_embedded_exe_nojs` attack.
  id: totrans-231
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将恶意载荷嵌入到一个无害的文件中，例如 PDF 文件，通过一种攻击方式，如 Metasploit 的 `adobe_pdf_embedded_exe_nojs`
    攻击。
- en: Executables can also be bound to Microsoft Office files, MSI install files,
    or BAT files configured to run silently on the desktop.
  id: totrans-232
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可执行文件也可以与 Microsoft Office 文件、MSI 安装文件或配置为在桌面上静默运行的 BAT 文件捆绑在一起。
- en: Have the user click on a link that downloads the malicious executable.
  id: totrans-233
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 让用户点击下载恶意可执行文件的链接。
- en: 'Since the SET uses the attacker’s URL as the destination for its attacks, a
    key success factor is to ensure that the attacker’s URL is believable to the victim.
    There are several techniques used to accomplish this, including the following:'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于 SET 使用攻击者的 URL 作为攻击的目标，成功的关键因素之一是确保攻击者的 URL 对受害者来说是可信的。为此，攻击者使用了几种技术，包括以下几种：
- en: Shorten the URL using a service, such as [https://goo.gl/](https://goo.gl/)or
    [tinyurl.com](http://tinyurl.com). These shortened URLs are common among social
    media platforms, such as Twitter, and victims rarely use precautions when clicking
    on such links.
  id: totrans-235
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用像[https://goo.gl/](https://goo.gl/)或[tinyurl.com](http://tinyurl.com)这样的服务来缩短网址。这些缩短的URL在社交媒体平台上很常见，例如Twitter，受害者在点击这些链接时通常不会采取任何预防措施。
- en: Enter the link on a social media site, such as Facebook or LinkedIn; the site
    will create its own link to replace yours, with an image of the destination page.
    Then, remove the link that you entered, leaving behind the new social media link.
  id: totrans-236
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在社交媒体网站上输入链接，例如Facebook或LinkedIn；该网站会生成一个自己的链接来替代你的链接，并显示目标页面的图片。然后，删除你输入的链接，留下新的社交媒体链接。
- en: Create a fake web page on LinkedIn or Facebook; as the attacker, you control
    the content, and can create a compelling story to drive members to click on links
    or download executables. A well-executed page will not only target employees,
    but also vendors, partners, and their clients, maximizing the success of a social
    engineering attack.
  id: totrans-237
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在LinkedIn或Facebook上创建一个虚假网页；作为攻击者，你控制内容，可以创造一个引人入胜的故事，促使成员点击链接或下载可执行文件。一个执行得当的页面不仅会针对员工，还会瞄准供应商、合作伙伴及其客户，从而最大化社会工程学攻击的成功率。
- en: Escalating an attack using DNS redirection
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用DNS重定向升级攻击
- en: If an attacker or penetration tester has compromised a host on the internal
    network, they can escalate the attack using DNS redirection. This is generally
    considered to be a horizontal attack (it compromises persons of roughly the same
    access privileges); however, it can also escalate vertically if the credentials
    from privileged persons are captured. In this example, we will use bettercap (to
    be explored in more detail in *Chapter 11*, *Action on the Objective and Lateral
    Movement*) as a sniffer, interceptor, and logger for switched LANs. It facilitates
    man-in-the-middle attacks, but we will use it to launch a DNS-redirection attack
    to divert users to sites used for our social engineering attacks.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击者或渗透测试员已经入侵了内部网络中的某个主机，他们可以通过DNS重定向来升级攻击。这通常被认为是一种水平攻击（它妥协的是大致相同访问权限的人）；然而，如果捕获了特权人员的凭证，它也可能向上升级。
    在本例中，我们将使用bettercap（将在*第11章*中更详细地探讨，*行动目标与横向移动*）作为嗅探器、拦截器和交换式LAN的日志记录工具。它便于实施中间人攻击，但我们将利用它发起DNS重定向攻击，将用户引导至用于社会工程学攻击的网站。
- en: To start the attack, we need to install bettercap, which is not installed by
    default in the latest version of Kali. This can be achieved by running `sudo apt
    install bettercap`. We should be able to activate any module that is required;
    for example, we will now try the DNS spoof attack module on the target by creating
    a file called `dns.conf` with the IP and domain details, as shown in *Figure 5.24*.
    This will enable any request made to `microsoft.com` on the network to be forwarded
    to the attacker’s IP, in this example `192.168.0.103`.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动攻击，我们需要安装bettercap，而最新版本的Kali中默认未安装此工具。可以通过运行`sudo apt install bettercap`来完成安装。安装完成后，我们应该能够激活所需的任何模块；例如，我们现在通过创建一个名为`dns.conf`的文件，其中包含IP和域名详细信息，来尝试在目标上使用DNS欺骗攻击模块，如*图5.24*所示。这样，网络上所有发送到`microsoft.com`的请求将被转发到攻击者的IP地址，在此示例中为`192.168.0.103`。
- en: 'Let’s run the default Apache server on our Kali Linux by activating the service
    by running `sudo systemctl start apache2.service,` run bettercap by entering `sudo
    bettercap` in the terminal, load our DNS configuration with `set dns.spoof.hosts
    dns.conf`, and then turn on DNS spoofing by running `dns.spoof on` in the bettercap
    terminal:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过在Kali Linux上启动默认的Apache服务器来运行该攻击，首先通过运行`sudo systemctl start apache2.service`来启动服务，接着通过在终端输入`sudo
    bettercap`来运行bettercap，加载我们的DNS配置文件`set dns.spoof.hosts dns.conf`，然后通过运行`dns.spoof
    on`来开启DNS欺骗：
- en: '![](../Images/B17765_05_24.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_24.png)'
- en: 'Figure 5.24: Configuring bettercap to sniff the network'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.24：配置bettercap以嗅探网络
- en: 'To ensure that all the targets on the network are poised first, testers need
    to enable network sniffing and ARP spoofing modules by typing `net.sniff on` and
    `arp.spoof on` in the bettercap terminal. Successful DNS redirection will be captured
    in the bettercap terminal, as shown in *Figure 5.25*:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 为确保网络上的所有目标首先准备就绪，测试人员需要通过在bettercap终端输入`net.sniff on`和`arp.spoof on`来启用网络嗅探和ARP欺骗模块。成功的DNS重定向将在bettercap终端中被捕获，如*图5.25*所示：
- en: '![](../Images/B17765_05_25.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_25.png)'
- en: 'Figure 5.25: Successful redirection of DNS Microsoft.com to the attacker’s
    IP'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.25：成功将DNS重定向Microsoft.com到攻击者的IP
- en: When the victims on the network visit `microsoft.com`, they will be sent to
    the Apache service that is hosted on the attacker’s IP. Attackers can choose to
    clone the `microsoft.com` and host it on their Apache server. This attack is more
    successful in an internal infrastructure where there is no additional DNS security
    protection. Most companies have DNS protection on their external infrastructure,
    such as Cloudflare, AWS Shield, and Akamai.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 当网络上的受害者访问`microsoft.com`时，他们将被重定向到托管在攻击者IP上的Apache服务。攻击者可以选择克隆`microsoft.com`并将其托管在他们的Apache服务器上。在内部基础设施中，这种攻击更为成功，因为没有额外的DNS安全保护。大多数公司在其外部基础设施上有DNS保护，例如Cloudflare、AWS
    Shield和Akamai。
- en: Spear phishing attack
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络钓鱼攻击
- en: Phishing is an email fraud attack carried out against a large number of victims,
    such as a list of known American internet users. The targets are generally not
    connected, and the email does not attempt to appeal to any specific individual.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 网络钓鱼是一种针对大量受害者的电子邮件欺诈攻击，例如一个已知的美国互联网用户列表。目标通常没有关联，电子邮件也不会试图吸引任何特定个人。
- en: Instead, it contains an item of general interest (for example, *Click here to
    get COVID-19 vaccination*) and a malicious link or attachment. The attacker plays
    the odds that at least some people will click on the attachment to initiate the
    attack.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，邮件内容包含一些普遍感兴趣的项目（例如，*点击这里接种COVID-19疫苗*）和一个恶意链接或附件。攻击者打算通过概率，至少有一部分人会点击附件，从而发起攻击。
- en: On the other hand, spear phishing is a highly specific form of phishing attack;
    by crafting the email message in a particular way, the attacker hopes to attract
    the attention of a specific audience. For example, if the attacker knows that
    the sales department uses a particular application to manage its customer relationships,
    they may spoof an email pretending that it is from the application’s vendor with
    a subject line of `Emergency fix for <application> - Click link to download.`
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，网络钓鱼是一种高度特定的钓鱼攻击形式；通过以特定方式编写电子邮件消息，攻击者希望吸引特定受众的注意。例如，如果攻击者知道销售部门使用某个特定应用程序来管理客户关系，他们可能会伪造一封电子邮件，假装来自该应用程序的供应商，邮件主题为`紧急修复<应用程序>
    - 点击链接下载`。
- en: 'The following steps are involved in successfully launching a spear phishing
    attack:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 成功发起网络钓鱼攻击的步骤如下：
- en: Before launching the attack, ensure that `sendmail` is installed on Kali (`sudo
    apt-get install sendmail`) and change from `SENDMAIL=OFF` to `SENDMAIL=ON` inside
    the `set.config` file located in `/etc/setoolkit/`.
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在发起攻击之前，确保在Kali上安装了`sendmail`（`sudo apt-get install sendmail`），并将`set.config`文件中的`SENDMAIL=OFF`更改为`SENDMAIL=ON`，该文件位于`/etc/setoolkit/`。
- en: If testers receive any error messages related to `broken package exim*`, you
    should run `sudo apt-get purge exim4-base exim4-config` and then run `sudo apt-get
    install sendmail`.
  id: totrans-254
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果测试人员收到任何与`broken package exim*`相关的错误信息，应运行`sudo apt-get purge exim4-base exim4-config`，然后运行`sudo
    apt-get install sendmail`。
- en: To perform the attack, launch SET and then select `Social Engineering Attacks`
    from the main menu, and then select `Spear-Phishing Attack Vectors` from the submenu.
    This will launch the start options for the attack, as shown in *Figure 5.26*:![](../Images/B17765_05_26.png)
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要执行攻击，启动SET，然后从主菜单中选择`Social Engineering Attacks`，再从子菜单中选择`Spear-Phishing Attack
    Vectors`。这将启动攻击的开始选项，如*图5.26*所示：![](../Images/B17765_05_26.png)
- en: 'Figure 5.26: Spear phishing main menu'
  id: totrans-256
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.26：网络钓鱼主菜单
- en: Select `1` to perform a mass email attack; you will then be presented with a
    list of attack payloads, as shown in *Figure 5.27*:![](../Images/B17765_05_27.png)
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择`1`进行大规模电子邮件攻击；然后会展示一系列攻击有效载荷，如*图5.27*所示：![](../Images/B17765_05_27.png)
- en: 'Figure 5.27: List of available exploits within the spear phishing module'
  id: totrans-258
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.27：网络钓鱼模块中可用的漏洞列表
- en: The attacker can select any available payload, according to the attacker’s knowledge
    of available targets gained during the reconnaissance phase. In this example,
    we will take the `7) Adobe Flash Player "Button" Remote Code Execution` option.
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 攻击者可以根据在侦察阶段获得的目标信息选择任何可用的有效载荷。在这个示例中，我们将选择`7) Adobe Flash Player "Button" Remote
    Code Execution`选项。
- en: 'When you select `7`, you will be prompted to select the payloads, as shown
    in *Figure 5.28*. We have utilized Windows Meterpreter reverse shell HTTPS for
    this example:'
  id: totrans-260
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当你选择`7`时，将提示你选择有效载荷，如*图5.28*所示。我们在这个示例中使用了Windows Meterpreter反向Shell HTTPS：
- en: '![](../Images/B17765_05_28.png)'
  id: totrans-261
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_28.png)'
- en: 'Figure 5.28: Supported payloads within the framework'
  id: totrans-262
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图5.28：框架中支持的有效载荷
- en: 'Once the payload and exploit are ready from the SET console, attackers will
    get the confirmation shown in *Figure 5.29*:'
  id: totrans-263
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一旦从 SET 控制台准备好有效载荷和漏洞利用，攻击者将看到*图 5.29* 中显示的确认信息：
- en: '![](../Images/B17765_05_29.png)'
  id: totrans-264
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_29.png)'
- en: 'Figure 5.29: Creating a PDF file with the Adobe exploit'
  id: totrans-265
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.29：使用 Adobe 漏洞创建 PDF 文件
- en: Now, you will be able to rename the file by selecting option `2\. Rename the
    file, I want to be cool`.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，您可以通过选择选项 `2\. 重命名文件，我想让它看起来很酷` 来重命名文件。
- en: Once you rename the file, you will be provided with two options to select, either
    `E-mail Attack Single Email Address` or `E-mail Attack Mass Mailer`.
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦重命名文件，您将有两个选项可以选择：`E-mail Attack Single Email Address` 或 `E-mail Attack Mass
    Mailer`。
- en: Attackers can choose the mass mailer or individually target a weaker victim,
    depending on their preference. If we use a single email address, SET provides
    further templates that can be utilized by the attackers, as shown in *Figure 5.30*:![](../Images/B17765_05_30.png)
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 攻击者可以选择使用群发邮件或单独针对较弱的受害者，取决于其偏好。如果使用单个电子邮件地址，SET 会提供进一步的模板供攻击者使用，如*图 5.30*所示：![](../Images/B17765_05_30.png)
- en: 'Figure 5.30: Available pre-defined templates for a single email address as
    the target'
  id: totrans-269
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.30：为单个电子邮件地址作为目标提供的预定义模板
- en: After you select the phishing template, you will be offered the option of using
    your own Gmail account to launch the attack (`1`) or using your own server or
    open relay (`2`). If you use a Gmail account, it is likely that the attack will
    fail; Gmail inspects outgoing emails for malicious files and is very effective
    at identifying payloads produced by SET and the Metasploit framework. If you have
    to send a payload using Gmail, use Veil 3.1 to encode it first.
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在选择钓鱼模板后，您将有两个选项可用：使用自己的 Gmail 账户发起攻击（`1`）或使用自己的服务器或开放中继（`2`）。如果使用 Gmail 账户，攻击可能会失败；Gmail
    会检查外发邮件中的恶意文件，并且非常有效地识别 SET 和 Metasploit 框架生成的有效载荷。如果必须通过 Gmail 发送有效载荷，可以先使用 Veil
    3.1 对其进行编码。
- en: 'It is recommended that you use the `sendmail` option to send executable files;
    it allows you to spoof the source of the email to make it appear as though it
    originated from a trusted source. To ensure that an email is effective, the attacker
    should take note of the following points:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 建议使用`sendmail`选项发送可执行文件；它允许伪装邮件来源，使其看起来像是来自可信来源。为了确保邮件的有效性，攻击者应注意以下几点：
- en: The content should provide an inducement (the new server will be faster, have
    improved antivirus) and a stick (changes you will have to make before you can
    access your email). Most people respond to immediate calls for action, particularly
    when it affects them.
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内容应提供诱因（新服务器将更快，具有更好的防病毒功能）和威胁（您需要进行的更改，才能访问您的电子邮件）。大多数人都会回应直接的行动呼吁，尤其是当它直接影响到他们时。
- en: In the sample given previously, the attached document is titled `template.pdf`.
    In a real-world scenario, this would be changed to `instructions.pdf`.
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在前面的示例中，附加文档的标题为`template.pdf`。在实际场景中，这个标题应改为`instructions.pdf`。
- en: Ensure that your spelling and grammar are correct, and the tone of the message
    matches the content.
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保拼写和语法正确，邮件的语气应与内容相符。
- en: The title of the individual sending the email should match the content.
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送电子邮件的个人职称应与内容相符。
- en: If the target organization is small, you may have to spoof the name of a real
    individual and send the email to a small group that would not normally interact
    with that person.
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果目标组织较小，可能需要伪装成真实个人的名字，并将邮件发送给一个通常不会与该人互动的小群体。
- en: Include a phone number; it makes the email look more official, and there are
    various ways to use commercial voice over IP solutions to obtain a short-term
    phone number with a local area code.
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含一个电话号码；这会使邮件看起来更正式，而且可以通过各种方式使用商业语音IP解决方案获取带有本地区号的短期电话号码。
- en: Once the attack email is sent to the target, successful activation (the recipient
    launches the executable) will create a reverse Meterpreter tunnel to the attacker’s
    system. The attacker will then be able to control the compromised system.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦攻击邮件发送到目标，成功激活（收件人启动可执行文件）将创建一个反向 Meterpreter 隧道，连接到攻击者的系统。攻击者将能够控制被攻陷的系统。
- en: Email phishing using Gophish
  id: totrans-279
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Gophish 进行电子邮件钓鱼攻击
- en: 'Gophish is a fully integrated open-source phishing framework and also has commercial
    support. The framework makes it easy for any type of user to quickly create a
    phishing campaign and deploy a sophisticated phishing simulation or perform a
    real attack within a few minutes. Unlike SET, Gophish is not preinstalled on Kali
    Linux. In this section, we will explore how to set up the environment:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: Gophish是一个完全集成的开源钓鱼框架，同时也提供商业支持。该框架使任何类型的用户都可以快速创建钓鱼活动并在几分钟内部署一个复杂的钓鱼模拟或执行真实攻击。与SET不同，Gophish并未预装在Kali
    Linux中。在本节中，我们将探讨如何设置环境：
- en: Download the right release, according to your system configuration, by visiting
    [https://github.com/gophish/gophish/releases](https://github.com/gophish/gophish/releases).
    In this book, we will utilize the gophish-v0.11.1 64-bit Linux version.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过访问[https://github.com/gophish/gophish/releases](https://github.com/gophish/gophish/releases)，根据系统配置下载合适的版本。在本书中，我们将使用gophish-v0.11.1
    64位Linux版本。
- en: Once the app is download to Kali Linux, we will unzip the folder and configure
    the `config.json` file with the right information; attackers can choose to utilize
    any custom database, such as MySQL, MSSQL, and so on. We will use `sqlite3`; an
    explicit IP address must be declared in `listen_url` if testers prefer to share
    the same resource over the LAN, as shown in *Figure 5.31*. It is set to `0.0.0.0`
    to listen on all Ethernet adapters.
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦应用程序下载到Kali Linux，我们将解压缩文件夹并用正确的信息配置`config.json`文件；攻击者可以选择使用任何自定义数据库，如MySQL、MSSQL等。我们将使用`sqlite3`；如果测试者希望通过局域网共享相同资源，则必须在`listen_url`中声明明确的IP地址，如*图
    5.31*所示。它设置为`0.0.0.0`以监听所有以太网适配器。
- en: 'By default, it will be exposed only to the localhost:'
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 默认情况下，它只会暴露给本地主机：
- en: '![](../Images/B17765_05_31.png)'
  id: totrans-284
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_31.png)'
- en: 'Figure 5.31: Changing the Gophish configuration files and setting the listen
    URL to 0.0.0.0:3333'
  id: totrans-285
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.31：更改Gophish配置文件，并将监听URL设置为0.0.0.0:3333
- en: The next step is to change the file permission to execute by running `chmod
    +x gophish` in the Kali Linux terminal. Finally, run the application by typing
    `sudo ./gophish` from the same folder, which should bring up the Gophish web application
    portal on port `3333` by default, with a self-signed SSL certificate. To avoid
    the default credentials for the application, the latest version of Gophish generates
    a temporary password for the `admin` user during the initial startup script, as
    shown in *Figure 5.32*:![](../Images/B17765_05_32.png)
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步是通过在Kali Linux终端运行`chmod +x gophish`来更改文件权限以执行。最后，从同一文件夹中输入`sudo ./gophish`运行应用程序，这应该会在默认的`3333`端口上启动Gophish
    Web应用程序门户，并带有自签名的SSL证书。为了避免应用程序使用默认凭证，Gophish的最新版本会在初始启动脚本中为`admin`用户生成一个临时密码，如*图
    5.32*所示：![](../Images/B17765_05_32.png)
- en: 'Figure 5.32: Auto generated admin user password when Gophish is launched'
  id: totrans-287
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.32：Gophish启动时自动生成的admin用户密码
- en: You should now be able to access the application by visiting `https://yourIP:3333`;
    you should now be able to log in with the user `admin` and the password captured
    from the previous step. This should force the testers to reset their initial password,
    as shown in *Figure 5.33*:![](../Images/B17765_05_33.png)
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你应该能够通过访问`https://yourIP:3333`来访问应用程序；你应该能够使用用户`admin`和从上一步获取的密码进行登录。这将迫使测试者重置他们的初始密码，如*图
    5.33*所示：![](../Images/B17765_05_33.png)
- en: 'Figure 5.33: Forced password reset screen of Gophish after successful login
    for user admin'
  id: totrans-289
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.33：成功登录后，Gophish强制重置密码的界面，用户为admin
- en: Testers will receive a certificate error in the browser when it is hosted internally
    with the Gophish self-signed certificates.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用Gophish自签名证书在内部托管时，测试者在浏览器中将收到证书错误。
- en: Launching a phishing attack using Gophish
  id: totrans-291
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Gophish发起钓鱼攻击
- en: 'There are prerequisites that need to be set up in Gophish before launching
    a phishing campaign. They can be broadly divided into several important steps
    to do before launching a successful campaign:'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动钓鱼活动之前，需要在Gophish中设置一些先决条件。它们可以大致分为几个重要步骤，以确保成功启动活动：
- en: '**Templates**: Templates are a very crucial part of phishing; you must be able
    to create your own templates based on your game plan. The most commonly used templates
    are Office365, Webmail, and internal Facebook and Gmail logins. Some of the templates
    can be found at [https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E/tree/main/Chapter%2005](https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E/tree/main/Chapter%2005).'
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**模板**：模板是网络钓鱼中非常关键的部分；你必须能够根据你的游戏计划创建自己的模板。最常用的模板包括 Office365、Webmail 以及内部
    Facebook 和 Gmail 登录页面。一些模板可以在[https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E/tree/main/Chapter%2005](https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E/tree/main/Chapter%2005)找到。'
- en: 'The following simple steps are involved in creating the templates: while in
    the Templates section, click on **New Template**, enter details in the **Name**
    and **Subject** fields, click on HTML, copy the raw HTML contents from the templates,
    paste them in the editor, and click on **Save Template**.'
  id: totrans-294
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 创建模板的简单步骤如下：在模板部分，点击**新建模板**，在**名称**和**主题**字段中输入详细信息，点击 HTML，复制模板中的原始 HTML 内容，粘贴到编辑器中，然后点击**保存模板**。
- en: '**Landing Pages**: The effectiveness of the phishing campaign will always relate
    to how you redirect the victims to a legitimate website using the landing pages.'
  id: totrans-295
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**登录页面**：网络钓鱼活动的效果总是与如何通过登录页面将受害者重定向到一个合法网站有关。'
- en: Similar to the steps under Templates, navigate to Landing Page on the left menu,
    click on **New page,** enter the **Name**, and copy and paste the template—you
    may also directly import a site. Finally, click on **Save Page**.
  id: totrans-296
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 与模板步骤类似，从左侧菜单中导航到登录页面，点击**新建页面**，输入**名称**，然后复制并粘贴模板——你也可以直接导入一个站点。最后，点击**保存页面**。
- en: '**Sending Profiles**: A profile is the place where you will have all the SMTP
    details and sender details; Gophish allows attackers to have multiple profiles
    defined, along with custom email headers.'
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**发送配置**：配置文件是你存储所有 SMTP 和发件人详细信息的地方；Gophish 允许攻击者定义多个配置文件，并可以使用自定义电子邮件头信息。'
- en: 'To create a profile, click on **Send Profile**, **New Profile**, and enter
    the **Name** and **Interface type**; by default, it should be **SMTP**. Enter
    the **From** section with an Email ID of your choosing. **Host** is the SMTP server—attackers
    can choose their own or use an existing service, such as AWS. In our case, we
    will use `smtp.gmail.com:465` and enter the **username** and **password**. Most
    anti-phishing solutions block emails based on the header information. Therefore,
    try using the **Email headers** `Microsoft Office Outlook XX` or `Outlook Express
    for Macintosh`. If all the settings are working, you can click on **Send Test
    Email**. A successful test email should look similar to the one shown in *Figure
    5.34*. Finally, click on **Save Profile**:'
  id: totrans-298
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 创建配置文件，点击**发送配置**，**新建配置**，并输入**名称**和**接口类型**；默认情况下应该选择**SMTP**。在**发件人**部分输入你选择的电子邮件
    ID。**主机**是 SMTP 服务器——攻击者可以选择自己的服务器或使用现有服务，如 AWS。在我们的例子中，我们将使用 `smtp.gmail.com:465`
    并输入**用户名**和**密码**。大多数反钓鱼解决方案会基于邮件头信息阻止邮件发送。因此，尝试使用**电子邮件头** `Microsoft Office
    Outlook XX` 或 `Outlook Express for Macintosh`。如果所有设置正常，可以点击**发送测试邮件**。成功的测试邮件应与*图
    5.34*中的示例相似。最后，点击**保存配置**：
- en: '![](../Images/B17765_05_34.png)'
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_34.png)'
- en: 'Figure 5.34: Default email from Gophish'
  id: totrans-300
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 5.34：Gophish 默认电子邮件
- en: Testers using the Gmail services must ensure that **Less secure App access**
    is turned on to allow the third-party application to use the services. This can
    be achieved by visiting [https://myaccount.google.com/lesssecureapps?pli=1](https://myaccount.google.com/lesssecureapps?pli=1)
    and turning on **Allow less secure apps**.
  id: totrans-301
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用 Gmail 服务的测试人员必须确保开启**低安全性应用访问**，以允许第三方应用使用该服务。这可以通过访问[https://myaccount.google.com/lesssecureapps?pli=1](https://myaccount.google.com/lesssecureapps?pli=1)并开启**允许低安全性应用**来实现。
- en: '**Users and groups**: Upload single or multiple targeted victims’ email IDs
    with their first and last names. Gophish allows testers to create groups and import
    them in CSV format.'
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**用户与组**：上传单个或多个目标受害者的电子邮件 ID 和其名字、姓氏。Gophish 允许测试人员创建组并以 CSV 格式导入。'
- en: Navigate to **Users & Groups** from the menu, click on **New Group**, and either
    import a CSV-formatted file or manually enter the first name, last name, email
    ID, and position. Click on **Add** and then click on **Save Changes**.
  id: totrans-303
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从菜单中导航到**用户与组**，点击**新建组**，然后导入一个 CSV 格式的文件，或者手动输入名字、姓氏、电子邮件 ID 和职位。点击**添加**，然后点击**保存更改**。
- en: '**Account Management**: A single instance can spin multiple phishing campaigns;
    hence individual users can have their own account to the portal.'
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**账户管理**：单个实例可以启动多个钓鱼活动；因此，个别用户可以拥有自己的门户账户。'
- en: '**Webhook**: A webhook is simply a web callback or HTTP push **Application
    Programming Interface** (**API**). This option allows the testers to implement
    a webhook, which can help push the results directly to any third-party API.'
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**Webhook**：Webhook只是一个Web回调或HTTP推送**应用程序编程接口**（**API**）。此选项允许测试人员实现Webhook，可以将结果直接推送到任何第三方API。'
- en: 'Once we have all the templates, landing pages, users, and sending profiles
    set, we are now set to launch the campaign by clicking on the **Campaigns** from
    the menu. Then click on **New Campaign** and enter the **Name** of the campaign.
    Select the **Email template**, **Landing Page**, and provide the **URL** of the
    host/IP that will serve the phishing pages; typically, this would be the same
    Kali Linux IP address as where Gophish is running. Select **Launch date** or schedule
    the date and time, select the **Sending profile** that was created, select the
    **Groups**, as shown in *Figure 5.35*, and finally click **Launch Campaign**.
    We can select the date and time when the phishing will start and the group of
    target victims. Gophish also provides an option to test an email to see whether
    it was blocked or delivered straight to the target’s inbox, depending on the templates
    selected:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们设置好了所有的模板、着陆页面、用户和发送配置文件，我们就可以通过点击菜单中的**Campaigns**来启动活动。然后点击**New Campaign**并输入活动的**名称**。选择**电子邮件模板**、**着陆页面**，并提供将承载钓鱼页面的主机/IP的**URL**；通常，这将是运行Gophish的Kali
    Linux IP地址。选择**启动日期**或安排日期和时间，选择已创建的**发送配置文件**，选择**组**，如*图5.35*所示，最后点击**Launch
    Campaign**。我们可以选择钓鱼活动开始的日期和时间以及目标受害者的组。Gophish还提供了一个选项来测试电子邮件，查看它是被阻止了，还是直接进入目标的收件箱，具体取决于所选模板：
- en: '![](../Images/B17765_05_35.png)'
  id: totrans-307
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_35.png)'
- en: 'Figure 5.35: Launching an email campaign on specific targets'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.35：在特定目标上启动电子邮件活动
- en: 'Once the campaign is successfully launched, the victim should receive an email
    based on the templates that were chosen during the campaign selection. An email
    with the `Microsoft Teams Unread messages` template would look similar to that
    shown in *Figure 5.36*:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦活动成功启动，受害者应该会收到基于在活动选择过程中所选模板的电子邮件。使用`Microsoft Teams Unread messages`模板的电子邮件将类似于*图5.36*中所示：
- en: '![](../Images/B17765_05_36.png)'
  id: totrans-310
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_36.png)'
- en: 'Figure 5.36: Sample phishing email that uses the Microsoft Teams Unread template'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.36：使用Microsoft Teams Unread模板的钓鱼电子邮件示例
- en: 'When the target user clicks on any link in the email, they will be taken to
    the Landing Page along with the Unique RID number that is generated by Gophish
    to the target user. A sample Office 365 landing page should be seen, as shown
    in *Figure 5.37*:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 当目标用户点击电子邮件中的任何链接时，他们将被带到着陆页面，并且会带上由Gophish为目标用户生成的唯一RID号码。应显示一个示例的Office 365着陆页面，如*图5.37*所示：
- en: '![](../Images/B17765_05_37.png)'
  id: totrans-313
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_37.png)'
- en: 'Figure 5.37: Sample Office 365 landing page when the victim clicks on the link'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.37：当受害者点击链接时，Office 365着陆页面的示例
- en: The same landing page can also be hooked with a BeEF framework to hijack browsers
    to take advantage of the users’ current browser sessions; however, we will explore
    the details of BeEF in *Chapter 7*, *Exploiting Web-Based Applications*.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 同一个着陆页面也可以与BeEF框架挂钩，以劫持浏览器并利用用户当前的浏览器会话；然而，我们将在*第7章*，*利用基于Web的应用程序*中探讨BeEF的详细内容。
- en: 'Finally, the testers can track all the emails sent, opened, clicked, and submitted
    per campaign launched, as shown in *Figure 5.38*:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，测试人员可以追踪每个活动启动后发送、打开、点击和提交的所有电子邮件，如*图5.38*所示：
- en: '![](../Images/B17765_05_38.png)'
  id: totrans-317
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_38.png)'
- en: 'Figure 5.38: Gophish dashboard'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.38：Gophish仪表板
- en: The **Email Reported** option includes the users who spotted the phishing emails
    and reported them as suspicious. Typically, an internal IT security team member
    can use this output to evaluate their users’ cyber-security awareness.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: '**Email Reported**选项包括那些发现并报告钓鱼邮件为可疑的用户。通常，内部IT安全团队成员可以利用这个输出评估用户的网络安全意识。'
- en: We now have explored how to download, install, and run Gophish, along with launching
    an email phishing campaign.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经探讨了如何下载、安装和运行Gophish，并启动电子邮件钓鱼活动。
- en: Using bulk transfer as phishing to deliver payloads
  id: totrans-321
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用批量传输作为钓鱼手段来传递负载
- en: 'Attackers can also utilize bulk file transfer software, such as Smash, Hightail,
    Terashare, WeTransfer, SendSpace, and DropSend. Let’s take a simple scenario:
    assume we have targeted two people, a finance administrator and a CEO. Attackers
    can simply send files between these two victims, visiting one of the bulk transfer
    websites, such as `sendspace.com`, and upload a malicious file, while setting
    the sender as `Financeadmin@targetcompany.com`, and `ceo@targetcompany.com` as
    the receiver. Once the file is uploaded, both parties will receive the emails
    with the file link; in this case, `ceo@targetcompany.com` will receive an email
    stating that the file was sent successfully, and `Financeadmin@cyberhia.com` will
    receive something similar, as shown in *Figure 5.39*:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者还可以利用大容量文件传输软件，如 Smash、Hightail、Terashare、WeTransfer、SendSpace 和 DropSend。假设我们针对了两个人，一个是财务管理员，另一个是
    CEO。攻击者可以简单地在这两名受害者之间发送文件，访问其中一个大容量传输网站，如 `sendspace.com`，上传一个恶意文件，同时将发送者设置为 `Financeadmin@targetcompany.com`，将接收者设置为
    `ceo@targetcompany.com`。文件上传后，双方将收到包含文件链接的电子邮件；在这种情况下，`ceo@targetcompany.com`
    将收到一封邮件，通知文件已成功发送，`Financeadmin@cyberhia.com` 将收到类似的邮件，如*图 5.39*所示：
- en: '![](../Images/B17765_05_39.png)'
  id: totrans-323
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_05_39.png)'
- en: 'Figure 5.39: Sendspace bulk transfer emails'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.39：Sendspace 大容量传输邮件
- en: Most of the time, these bulk transfers are not on the blocked list in a corporate
    environment (if one is blocked, attackers can switch to another), so they provide
    direct access to internal staff and create an effective message, and an undetectable
    payload will provide a better success rate, without revealing the identity of
    the attackers.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，这些大容量传输并不在企业环境的阻止列表中（如果一个被阻止，攻击者可以切换到另一个），因此它们能直接访问内部员工并传递有效信息，且不可检测的有效载荷将提供更高的成功率，而不会暴露攻击者的身份。
- en: Summary
  id: totrans-326
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 概述
- en: Social engineering is a method of hacking humans, taking advantage of a person’s
    inherent trust and helpfulness to attack a network and its devices. In this chapter,
    we examined how social engineering can be used to facilitate attacks designed
    to capture credentials, activate malicious software, or assist in launching further
    attacks. Most of the attacks rely on SET and Gophish; however, Kali has several
    other applications that can be improved using a social engineering methodology.
    We explored how new bulk transfer companies can potentially be utilized to spread
    the payload without having to use any email services to perform phishing. We also
    examined how physical access, usually in conjunction with social engineering,
    can be used to place hostile devices on a target network.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 社会工程学是一种攻击人类的方法，利用人们固有的信任和乐于助人的特点来攻击网络及其设备。在本章中，我们探讨了社会工程学如何被用来促进旨在捕获凭证、激活恶意软件或协助发起进一步攻击的攻击。大多数攻击依赖于
    SET 和 Gophish；然而，Kali 还拥有多个其他应用程序，可以通过社会工程学方法加以改进。我们还探讨了如何利用新的大容量传输公司来传播有效载荷，而不必使用任何电子邮件服务来执行钓鱼攻击。我们还研究了如何通过物理访问，通常与社会工程学结合使用，来将恶意设备放置在目标网络中。
- en: In the next chapter, we will examine how to conduct reconnaissance against wireless
    networks and attack open networks, as well as networks that are protected with
    encryption schemes based on WPA2\. We will also examine general weaknesses in
    wireless and Bluetooth protocols that render them vulnerable to denial-of-service
    attacks, along with impersonation attacks.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将研究如何对无线网络进行侦察，并攻击开放网络以及基于 WPA2 加密方案保护的网络。我们还将研究无线和蓝牙协议中的一般弱点，这些弱点使它们容易受到拒绝服务攻击和冒充攻击。
