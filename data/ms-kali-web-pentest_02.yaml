- en: Chapter 3. Stalking Prey Through Target Recon
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第3章。通过目标侦察追踪猎物
- en: The American President Abraham Lincoln, quotable as he may have been, is often
    (incorrectly) heldÂ to have once said,
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 美国总统亚伯拉罕·林肯，尽管他可能曾经被引用，但通常（错误地）被认为曾经说过，
- en: '*"Give me six hours to chop down a tree and I will spend the first four sharpening
    the axe."*'
  id: totrans-2
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “给我六个小时砍倒一棵树，我将花前四个小时磨削斧头。”
- en: Regardless of where the quote truly came from, weÂ can certainly relate this
    withÂ hacking. Much success in web penetration testing is determined by what we
    uncover here, how we sift through the information, and how we couple it with tools
    covered later in this book. A thorough and methodical approach here will save
    time, focus efforts, and aid in planning our attacks. The methodologies from the
    various frameworks and organizations we discussed in [Chapter 2](000.html#), *Guidelines
    for Preparation and Testing*, all include some aspects of information gathering,
    and the tools available in Kali Linux should be familiar to you.Â
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 无论这句话真正来自何处，我们肯定可以将其与黑客联系起来。在网站渗透测试中的许多成功取决于我们在这里发现了什么，我们如何筛选信息，以及我们如何将其与本书后面介绍的工具相结合。在这里进行彻底和系统的方法将节省时间，集中精力，并有助于规划我们的攻击。我们在[第2章](000.html#)中讨论的各种框架和组织的方法都包括一些信息收集方面，Kali
    Linux中可用的工具应该对您来说是熟悉的。
- en: Note
  id: totrans-4
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'In this book, we''ll be following along with the Pen Test Kill Chain discussed
    in *Penetration Testing with the Raspberry Pi â�� Second Edition* (by *Jason Beltrame*
    and *Mike McPhee*, available atÂ [https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition](https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition))
    shown in the following figure:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们将跟随*Penetration Testing with the Raspberry Pi â�� Second Edition*（由*Jason
    Beltrame*和*Mike McPhee*讨论的Pen Test Kill Chain）的讨论，该书可在[https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition](https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition)上找到，如下图所示：
- en: '![](img/B03918_03_01-1.png)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_01-1.png)'
- en: The Pen Test Kill Chain helps to understand what tools are involved when. Build
    your own version to help visualize the workflow.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Pen Test Kill Chain有助于了解涉及何种工具。构建您自己的版本以帮助可视化工作流程。
- en: This information gathering takes many forms, but as a practicing hacker, you
    have probably developed your own preferences and routines. A healthy mix of open
    source information gathering, passive reconnaissance of the target itself, and
    subtle, focused scanning and *spidering* can go a long way toward laying out the
    rest of your project's game plan. The challenge is to expose as much as possible
    without triggering defensive awareness (also known as **paranoia**) in our target's
    operators. My hope is that I can help provide some tweaks to your processes that
    can help you get further into your discovery without getting caught.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 这种信息收集有多种形式，但作为一名实践黑客，您可能已经形成了自己的偏好和惯例。开源信息收集、对目标本身进行被动侦察以及微妙、专注的扫描和*蜘蛛*的健康混合可以在很大程度上帮助制定项目的游戏计划的其余部分。挑战在于尽可能暴露更多信息，而不引起目标操作者的防御意识（也称为**偏执狂**）。我希望我能帮助提供一些调整您的流程的建议，这样您就可以在不被发现的情况下更深入地进行发现。
- en: The universal vulnerability of all systems is the user, and web applications
    present their developers with an outlet to express themselves and show what they
    are made of. Effective social engineering can often short-circuit a tremendous
    amount of technical engineering to obtain credentials and other key elements of
    the web application's architecture. We'll look at how to exploit trust and pride
    to encourage the target's users and developers to squeeze as much out of this
    approach as possible.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 所有系统的普遍漏洞是用户，而Web应用程序为其开发人员提供了一个表达自己并展示他们的机会。有效的社会工程学往往可以绕过大量的技术工程，以获取Web应用程序架构的凭据和其他关键元素。我们将看看如何利用信任和自豪感来鼓励目标用户和开发人员，尽可能多地利用这种方法。
- en: 'Let''s not forget that artifacts themselves can help the customer understand
    their information exposure. Keenly aware cyber security initiatives will not only
    drawÂ attention to what is publicly available with respect to their organizations,
    but they may even engage in misinformation. In your discovery, catalog your findings:
    customers should be commended for reducing their public exposure.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们不要忘记，文物本身可以帮助客户了解他们的信息曝光。敏锐的网络安全举措不仅会引起对其组织公开可用信息的关注，甚至可能会进行误导。在您的发现中，编目您的发现：客户应该因减少其公开曝光而受到赞扬。
- en: 'In this chapter, we''ll discuss the following:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论以下内容：
- en: Gathering and using offline archives of websites
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 收集和使用网站的离线存档
- en: Reconnaisance of yourÂ target using public resources and a fancy old browser
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用公共资源和一个时髦的旧浏览器对您的目标进行侦察
- en: Using social engineering to hack the users
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用社会工程学来黑客用户
- en: Automating open source information gathering to map and characterize the target
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动化开源信息收集以绘制和描述目标
- en: Identifying key aspects of our target and focusing later efforts through active
    scanning
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过主动扫描识别目标的关键方面，并通过后续努力进行聚焦
- en: The imitation game
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模拟游戏
- en: '* * *'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: If one challenge in the recon phase of the attack gets your blood pumping, it'll
    be trying to find out every last detail about a site without getting caught looking
    too curious. Casual, normal users crawl websites randomly with a focus on certain
    high-traffic transactions, and anything more methodical than this may arouse suspicion.
    Inefficient workflows may also raise flags, so being able to surf the site and
    game plan attacks is an incredibly useful trick to learn. In this section, we'll
    look at how to create a mirror of a site (without waking the defenders) for a
    risk-free simulation. They do say that imitation is the best form of flattery.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击的侦察阶段中的一个挑战让你的血液沸腾，那就是试图在不被发现的情况下找出关于一个网站的每一个细节。普通用户随机浏览网站，重点关注某些高流量交易，任何比这更有条理的行为可能引起怀疑。低效的工作流也可能引起警觉，因此能够浏览网站并制定攻击计划是一个非常有用的技巧。在这一部分，我们将看看如何创建一个网站的镜像（而不会惊动防御者），进行无风险的模拟。他们说模仿是最好的恭维方式。
- en: We'll also find that there are limitations to the site's mirror. Back-end data,
    higher-level scripting, and intelligence all fail to replicate without the same
    infrastructures at the application and data tiers. The business logic that we
    may be counting on to actually exploit the application doesn't replicate over,
    and the vast array of data that is our end goal cannot be pulled in this fashion.
    We'll need to better understand how to surf safely. We'll discuss some better
    poking and prodding techniques for the actual site with stealth in this section
    as well.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还会发现网站镜像存在一些限制。后端数据、高级脚本和智能都无法在应用程序和数据层没有相同基础设施的情况下复制。我们可能依赖的业务逻辑无法复制，我们的最终目标——大量数据也无法以这种方式获取。我们需要更好地了解如何安全地浏览。在本节中，我们还将讨论一些更好的探测技术，以便在实际网站上进行隐蔽操作。
- en: Making (then smashing) a mirror with HTTrack
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用HTTrack创建（然后破坏）镜像
- en: Military operations, sports teams, and business proposal teams operating at
    their best will rehearse or perfect their tactics and overall strategyÂ against
    a mock opponent or in an environment that is an authentic copy of what they will
    be up against. The benefits of this are many, but chief among them is that these
    rehearsal environmentsÂ provide a safe environment to build confidence and competenceÂ without
    the risk of losing the actual battle, game, or project. In the movieÂ *Ocean's
    Eleven*, they actually mocked up a complete copy of the vault they were breaching
    to rehearse their plan (and more, but I won't spoil the fun if you haven't seen
    it yet â��go rent or stream it if you can). The point is that the more accurate
    and realistic the simulation, the greater theÂ chance of success when the real
    deal is happening.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 军事行动、体育队伍和商业提案团队在最佳状态下将对他们的战术和整体战略进行排练或完善，对抗一个模拟对手或在一个真实复制的环境中进行。这样做的好处很多，但其中最重要的是，这些排练环境提供了一个安全的环境，可以在不失去实际战斗、比赛或项目的风险的情况下建立信心和能力。在电影《奥斯汀大冒险》中，他们实际上模拟了他们要攻破的金库的完整副本来排练他们的计划。这一点是，模拟的越准确和真实，当真正的情况发生时成功的机会就越大。
- en: Now that my movie reference is over, think about our role as pen testers. If
    you can pull down a copy of the HTML, JavaScript, CGI, and CSS code for a full
    website and a hierarchy intact, then wouldn't that be a great way to explore the
    site without tripping alarms at the real target? All of the brainstorming you
    and your team engage in can now be used on a replica, and because there is no
    target organization monitoring the dashboard, we can test a bunch of vectors rather
    than fretting over just one.Â  In training along with the pen test, this is also
    a useful method of creating local, travel-ready copies of sites that can be used
    without fear of retribution or dependence on actual network connectivity.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我的电影参考结束了，想想我们作为渗透测试人员的角色。如果你可以下载一个完整网站的HTML、JavaScript、CGI和CSS代码以及层次结构，那么这不是一个探索网站的好方法吗？你和你的团队进行的所有头脑风暴现在可以用在一个复制品上，因为没有目标组织监控仪表板，我们可以测试一堆向量，而不是只担心一个。在渗透测试中，这也是一个创建本地、便于旅行的网站副本的有用方法，可以在不依赖实际网络连接的情况下使用。
- en: These archives can also form the basis of a spoof attack, allowing us to take
    the actual web pages and modify them before hosting them in a rogue honeypot using
    **Browser Exploitation Framework** (**BeEF**) or a credential skimmer using **Social
    Engineering Toolkit** (**SET**).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 这些存档也可以成为欺骗攻击的基础，让我们可以在使用**浏览器利用框架**（**BeEF**）或**社会工程工具包**（**SET**）的流氓蜜罐中托管实际的网页并进行修改。
- en: Several site mirroring utilities such as`wget` and `w3af` can do archives, but
    **HTTrack** is the most fully-featured tool in Kali that can create a mirror.
    You may already use it for base archives, but with a few tweaks, it can do so
    much more. Let's take a look at some of the most useful CLI options for recon
    and their equivalent **Graphical User Interface** (**GUI**) versions wherever
    applicable.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 诸如`wget`和`w3af`之类的多个网站镜像工具可以进行存档，但**HTTrack**是Kali中最全面的工具，可以创建一个镜像。你可能已经用它来创建基本存档，但通过一些调整，它可以做得更多。让我们来看看一些最有用的侦察CLI选项及其相应的**图形用户界面**（**GUI**）版本。
- en: Making a stealthy initial archive
  id: totrans-26
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建一个隐秘的初始存档。
- en: 'Â As a refresher, you can create an archive of a website by doing the following:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个提醒，你可以通过以下步骤创建一个网站的存档：
- en: '[PRE0]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `â��O` points to the output location (some locally accessible drive where
    you plan to access the mirror from). Â While help may prove useful (Â `hattrack
    --help`Â orÂ `man help`), you'll get more out of the manual volunteered by Fred
    Cohen on the HTTrack website ([https://www.httrack.com/html/fcguide.html](https://www.httrack.com/html/fcguide.html)).
    As *Mr. Cohen* reveals, there are a ton of switches in the CLI, and understanding
    the defaults for many of those is useful in crafting your own go-to mirror operation.
    More sophisticated sites will take measures to prevent mirroring from utilities
    such asÂ HTTrack, including recursive links and directory structures, domain splitting,
    and obfuscating links using scripts to impair your ability to mirror them. Drastic
    measures such as IP blacklisting or throttling may also be employed, so it is
    best to only employ these tools with care, tuning, and respect for the website's
    owners.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '`â��O`指向输出位置（一些本地可访问的驱动器，您计划从中访问镜像）。虽然帮助可能会很有用（`hattrack --help`或`man help`），但您可以从HTTrack网站上Fred
    Cohen提供的手册中获得更多信息（[https://www.httrack.com/html/fcguide.html](https://www.httrack.com/html/fcguide.html)）。正如*Mr.
    Cohen*所透露的，CLI中有大量开关，了解其中许多的默认值对于制定自己的镜像操作非常有用。更复杂的网站将采取措施防止从诸如HTTrack的实用程序进行镜像，包括递归链接和目录结构，域拆分以及使用脚本混淆链接以损害您镜像它们的能力。还可能采取极端措施，如IP黑名单或限速，因此最好谨慎使用这些工具，并尊重网站所有者。'
- en: Tuning stealthier archives
  id: totrans-30
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 调整更隐秘的存档
- en: Conducting a stealthier mirror is certainly worth learning about, but we have
    some trade-offs to consider. Throttling and threadÂ limits help keep us off their
    radar, but that means a mirror operation will take that much longer. We can limit
    what we are looking for through filters and directory restrictions, which is something
    that social engineering and our own experience can assist with. Are there efficiencies
    to be gained elsewhere?
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 进行更隐秘的镜像操作当然值得学习，但我们需要考虑一些权衡。限制带宽和线程数量有助于使我们不被发现，但这意味着镜像操作将需要更长时间。我们可以通过过滤器和目录限制来限制我们的搜索范围，这是社会工程和我们自己的经验可以帮助解决的问题。还有其他地方可以提高效率吗？
- en: 'There is considerable overhead as HTTrack processes queries, and a big factor
    in the time and compute power consumed is the parsing ofÂ **Multipurpose Internet
    Mail Extensions** (**MIME**) types on sites. There are many customizable features
    of HTTrack that can be leveraged through modification to the `.httrackrc` file,
    but the most useful one I picked up was the addition of the followingÂ line, which
    drastically cut my mirror time from hours to minutes. This line speeds up transfers
    by telling HTTrack to assume that HTML, PHP, CGI, DAT, and MPG files correspond
    to a standard MIME type and can be resolved to their usual end-state, avoiding
    all of the churn. Simply add this in its entirety (after modifying it to your
    liking) to the `.httrackrc` file using your favorite editor and save the file:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: HTTrack处理查询时存在相当大的开销，时间和计算资源的消耗的一个重要因素是在网站上解析**多用途互联网邮件扩展**（**MIME**）类型。HTTrack有许多可定制的功能，可以通过修改`.httrackrc`文件来利用，但我学到的最有用的一个是添加以下行，这大大缩短了我的镜像时间，从几小时缩短到几分钟。通过使用您喜欢的编辑器将这一行完整地添加到`.httrackrc`文件中，并保存文件：
- en: '[PRE1]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Once I've made this modification to my defaults, the stealthier command string
    that I find useful will do a bunch of non-default things. Â Keep in mind, once
    you've honed your own switches, you can save them in the `.httrackrc` file as
    well. Here is the command I used:Â
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我对默认设置进行了修改，我发现有用的隐秘命令字符串将执行一系列非默认操作。请记住，一旦你磨练出自己的开关，你也可以将它们保存在`.httrackrc`文件中。这是我使用的命令：
- en: '[PRE2]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Here is aÂ brief description of the options I used. *N*Â denotes a variable:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是我使用的选项的简要描述。*N*表示一个变量：
- en: '`-cN`: This limits the number of simultaneous downloads or file handles to
    avoid overwhelming our target'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-cN`：这限制了同时下载的数量或文件句柄，以避免过度压倒我们的目标'
- en: '`-AN`: This throttles the bandwidth to stay under the radar'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-AN`：这限制了带宽以保持低调'
- en: '`-mN` and `â��mN''`: These limit total downloads for the non-HTML and HTML
    file sizes respectively to ensure we do not overrun our disk'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-mN`和`â��mN''`：这些分别限制了非HTML和HTML文件大小的总下载量，以确保我们不会超出磁盘空间'
- en: '`-M`: This sets the overall mirror size limit â�� again keeping the disk size
    manageable'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-M`：这设置了整体镜像大小限制，再次保持磁盘大小可管理'
- en: '`-rN`: This puts a safety on recursion depth so we don''t get into a loop'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: -rN：这会对递归深度进行安全设置，以免陷入循环
- en: '`-H2`: This stops the download if slow traffic is detected'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: -H2：如果检测到慢速流量，将停止下载
- en: '`-<path>/*`: This skips a path (in this case, I didn''t want to pull down their
    extensive forums or user profiles)'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-<path>/*`：这跳过了一个路径（在这种情况下，我不想下载他们庞大的论坛或用户资料）'
- en: 'You can also use the GUI version, **WebHTTrack**, which is handy for learning
    how to tweak your favorite filters and options:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以使用GUI版本的**WebHTTrack**，这对学习如何调整您喜欢的过滤器和选项非常方便：
- en: '![](img/B03918_03_02-1.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_02-1.png)'
- en: WebHTTrack offers an intuitive way to master filters and tunings, and also enables
    the saving scan settings for repeat use.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: WebHTTrack提供了一个直观的方式来掌握过滤器和调整，并且还可以保存扫描设置以供重复使用。
- en: 'This command against the [https://www.hackthissite.org/](https://www.hackthissite.org/)Â website
    took a little over an hour to pull down 200 MB of information. I omitted the forums
    and users in this example, but I could just as easily have omitted other directories
    to focus on a specific area of the site or to avoid violating the boundaries established
    by my customer. If you press *Enter* while the command line is running, you''ll
    get a rundown of how long it has run, the number of links found, and the total
    download size to that point in time:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令对[https://www.hackthissite.org/](https://www.hackthissite.org/)网站的攻击花了一小时多一点的时间，下载了200MB的信息。在这个例子中，我省略了论坛和用户，但我也可以省略其他目录，以便专注于网站的特定区域，或者避免违反客户设定的界限。如果在命令行运行时按下*Enter*，你将得到一个关于运行时间、找到的链接数量以及到目前为止的总下载大小的摘要：
- en: '![](img/B03918_03_03-1.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_03-1.png)'
- en: The status screen is an easy way to see your progress. Pressing Ctrl + C will
    quit the mirror should you decide to end it early.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 状态屏幕是一个简单的方式来查看你的进展。如果你决定提前结束，按下Ctrl + C将退出镜像。
- en: '![](img/B03918_03_04-1.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_04-1.png)'
- en: WebHTTrack's other advantage is that you can interact to skip files live in
    the archival process.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: WebHTTrack的另一个优势是，你可以与存档过程中的文件进行交互以跳过文件。
- en: 'When the archive is complete, you can surf it as if it was the live web by
    visiting the local path in your browser: `file:///tmp/hackthissite/www.hackthissite.org/index.html`.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 当存档完成时，你可以通过在浏览器中访问本地路径来像访问实时网络一样浏览它：`file:///tmp/hackthissite/www.hackthissite.org/index.html`。
- en: 'You''ll see in the following screenshot that we''ve successfully captured the
    dynamic advertising banner content([http://infosecaddicts.com/](_wp_link_placeholder)),
    which may be worth filtering as well:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在下面的截图中看到，我们成功捕获了动态广告横幅内容([http://infosecaddicts.com/](_wp_link_placeholder))，这也值得过滤：
- en: '![](img/B03918_03_05.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_05.png)'
- en: Use theÂ local mirror created by HTTrack to interact with and surf the website,
    which is critical in identifying potential vectors.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 使用HTTrack创建的本地镜像与网站进行交互和浏览，这对于识别潜在的向量至关重要。
- en: Is the mirror complete and up-to-date?
  id: totrans-56
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 镜像是否完整并且是最新的？
- en: There is a plethora of switches out there that I would encourage you to explore,
    but one in particular that I find useful helps to mirror even those places on
    the site that the developer tells Google, Yahoo, and other crawlers to omit.Â 
    `robots.txt` files or meta tags are used to tell browsers to skip archival or
    search scans. They usually do this to avoid allowing something to be searchable,
    which is certainly of interest in a pen test. Appending the `â��s0` option ensures
    we won't miss anything in our scans.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多开关可以让你去探索，但有一个特别有用的开关可以帮助我们镜像网站上开发者告诉Google、Yahoo和其他爬虫忽略的地方。`robots.txt`文件或元标记用于告诉浏览器跳过存档或搜索扫描。他们通常这样做是为了避免允许某些东西被搜索，这在渗透测试中肯定是有趣的。添加`â��s0`选项可以确保我们在扫描中不会漏掉任何东西。
- en: Updating our mirror is a pretty simple process.Â  Assuming you are storing it
    in a non-volatile location (`/tmp` goes away on reboots), you can manually gather
    or even assign a **cron** job to automatically update your mirror's content and
    links. A prompt will ensure that you mean to update the cache; and assuming this
    is the case, it will remove the lock file and perform an update. I would recommend
    exploring archival switches that can allow you to keep older files or perform
    incremental updates to make better use of your time. Some older copies may hold
    content that was removed to cover an inadvertent disclosure, so it is well worth
    hoarding some historical files until they have been scanned.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 更新我们的镜像是一个非常简单的过程。假设你将它存储在一个非易失性位置（`/tmp`在重新启动时会消失），你可以手动收集，甚至分配一个**cron**任务来自动更新你的镜像内容和链接。一个提示将确保你的意思是更新缓存；假设是这样，它将删除锁定文件并执行更新。我建议探索存档开关，可以让你保留旧文件或执行增量更新，以更好地利用你的时间。一些旧的副本可能包含被删除以掩盖无意中披露的内容，因此值得保存一些历史文件，直到它们被扫描。
- en: Note
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Before we leave the HTTrack discussion, it is worth mentioning that tailoring
    your options and settings while practicing on known sites can make your mirroring
    process more efficient and useful. Be sure to take notes and documentÂ your favorite
    alternatives!
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在离开HTTrack讨论之前，值得一提的是，在练习已知网站时，调整你的选项和设置可以使你的镜像过程更加高效和有用。一定要做笔记和记录你喜欢的替代方案！
- en: '![](img/B03918_03_06.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_06.png)'
- en: HTTrack provides intelligent updates, and this saves bandwidth and time. CLI
    options forÂ multiple copies and versions if needed.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: HTTrack提供智能更新，这可以节省带宽和时间。如果需要，还可以使用CLI选项进行多个副本和版本。
- en: Touring the target environment
  id: totrans-63
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 参观目标环境
- en: Local copies allow us to scope out the site in a safe manner, but where do we
    start? Manual hands-on scanning will help us understand the flow and give us some
    hints as to the next steps. I would first recommend getting a feel for the site's
    hierarchy and where various dynamic content portals may reside. Where can users
    log into the applications hosted there, query for information, or provide or view
    feedback? We should also be making note of entity information that we can use
    later to enumerate names, e-mail addresses, and organization information, and
    better understand inter-entity relationships. If we are repurposing this mirror
    for MITM or honeypot duties, we'll want to be able to replicate not only the look
    and feel, but also the workflow.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 本地副本允许我们以安全的方式审查网站，但我们从哪里开始呢？手动的实际扫描将帮助我们了解流程，并给我们一些关于下一步的提示。我首先建议了解网站的层次结构以及各种动态内容门户可能存在的位置。用户可以在哪里登录托管的应用程序，查询信息，或提供/查看反馈？我们还应该记录我们可以在以后用来枚举名称、电子邮件地址和组织信息，并更好地理解实体关系的实体信息。如果我们要重新利用这个镜像进行MITM或蜜罐任务，我们希望能够复制不仅外观和感觉，还有工作流程。
- en: Several tools exist that can assist with these walk-throughs, such as those
    that reveal the underlying HTML and JavaScript elements.Â Viewing the page source
    through the **Developer Tools** in **Firefox**, using a plugin from the **OWASP
    Mantra** add-on bundle, **HackBar**, or another HTML viewer. To save time, I would
    recommend that anything more than initial familiarization with the application
    or website be done with the use of a full proxy toolset such asÂ **Burp** or **Firebug**.
    Using a web application testing suite (covered in the next couple of chapters)
    helps you to efficiently pivot from the Recon stage to activities in the **weaponize**,
    **exploit**, or **install** stages.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 存在一些工具可以帮助进行这些漫游，比如那些揭示底层HTML和JavaScript元素的工具。通过Firefox的开发者工具查看页面源代码，使用OWASP
    Mantra附加包中的插件HackBar或其他HTML查看器。为了节省时间，我建议除了最初熟悉应用程序或网站之外的任何事情都要使用完整的代理工具集，比如Burp或Firebug。使用Web应用程序测试套件（在接下来的几章中介绍）可以帮助您有效地从侦察阶段转移到武器化、利用或安装阶段的活动。
- en: Open source awesomeness
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 开源的强大
- en: '* * *'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: The first thing I do before accepting a task or job is to figure out what I
    am up against. It wasn't always this way. As a young engineer working on communications
    systems, I was once asked to lead the development of a specification for a subsystem
    that sounded cool. Woo hoo â�� a time to shine! I committed based on the sales
    pitch that the team lead provided. Reality hit me sometime around the second week
    in the task, as it was only then that I could look up from my keyboard to envision
    the remaining path ahead of me. Had I done that research ahead of my commitment,
    I could have avoided the trouble that was ahead of me. Needless to say, the job
    got done, but I always look back and wonder how much better it could have been
    and how much happier and better rested I would have been had I researched the
    process, constraints, and expectations before accepting the task.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在接受任务或工作之前，我做的第一件事是弄清楚我要面对什么。以前并不总是这样。作为一名年轻的通信系统工程师，我曾被要求领导一个听起来很酷的子系统规范的开发。哇哦，这是一个闪耀的时刻！我基于团队负责人提供的销售说辞做出了承诺。现实在我接受任务的第二周左右击中了我，因为只有在那时我才能从键盘上抬起头来设想我前方的道路。如果我在承诺之前做了那项研究，我本可以避免前方的麻烦。不用说，工作完成了，但我总是回想起来，想知道它本可以做得更好，如果我在接受任务之前研究了过程、约束和期望，我会更快乐、更休息。
- en: Penetration testing is no different. While some testers (and black hats, for
    that matter) may accept a job before researching the target, the most experienced
    professionals take a different approach and do their homework. We're all Google
    search experts, but there are ways we can all improve these queries and leverage
    additional tools to complete the picture of what our target looks like. We need
    to take advantage of the many links between search engines, social media, forums
    and boards, and other public domain information. The followingÂ figure shows usÂ how
    raw **Open Source Intelligence** (**OSINT**) comes from many sources, and it can
    be accessed through search engines and Kali's own toolsets alike. An efficient
    use of OSINT helps to better understand *the ask* of a project and can help us
    develop the strategies, uncover vulnerabilities, harvest user information, and
    gain details that can help us map out the infrastructure. We'll take a look at
    a couple of tools that are likely familiar, but we will see if we can unlock some
    more of their potential.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试也不例外。虽然一些测试人员（事实上，黑客也是如此）可能在研究目标之前接受工作，但经验丰富的专业人士采取了不同的方法，并做好了功课。我们都是谷歌搜索专家，但我们可以改进这些查询的方式，并利用其他工具来完善我们对目标的了解。我们需要利用搜索引擎、社交媒体、论坛和其他公共领域信息之间的许多链接。下图向我们展示了原始的开源情报（OSINT）来自许多来源，可以通过搜索引擎和Kali的工具集来访问。有效利用OSINT有助于更好地理解项目的要求，并可以帮助我们制定策略，发现漏洞，收集用户信息，并获取有助于我们绘制基础设施的详细信息。我们将看一些可能熟悉的工具，但我们将看看是否可以发掘它们更多的潜力。
- en: '![](img/B03918_03_07-2.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_07-2.png)'
- en: Browsers and Kali's toolsets can help access the massive amount of OSINT available.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览器和Kali的工具集可以帮助访问大量的OSINT。
- en: Open source Intel with Google and the Google hacking database
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 开源情报与谷歌和谷歌黑客数据库
- en: Search engines are now so integral to our hyper-connected global society that
    it is easy to overlook each engine's strengths and capabilities. Google, Bing,
    and to a lesser degree, Yahoo have dominated the market in the United States,
    but given that our role as a pen tester may cross borders, it is useful to work
    with engines and their localizations to ensure we are getting the most up-to-date
    information.Â  The **Search Engine Colossus** ([https://www.searchenginecolossus.com](https://www.searchenginecolossus.com))
    provides the leading options in each of the countries, including those that are
    embargoed. General information searches, especially those in non-technical realms,
    should include search engines local to the target or their partner organizations.
    Google's search engine, however, provides excellent coverage and extensive syntax
    all its own that can take those general engine findings and use them with great
    efficacy to unearth architectural details, sensitive files, and potential ways
    into our target's servers.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 搜索引擎现在已经成为我们超连接的全球社会的重要组成部分，以至于很容易忽视每个引擎的优势和功能。在美国，Google、Bing，以及在较小程度上的Yahoo主导了市场，但考虑到我们作为渗透测试人员的角色可能跨越国界，与引擎及其本地化合作以确保我们获得最新的信息是很有用的。Search
    Engine Colossus（https://www.searchenginecolossus.com）提供了每个国家的领先选项，包括那些受到禁运的国家。特别是那些非技术领域的一般信息搜索，应该包括目标地区或其合作组织的本地搜索引擎。然而，谷歌的搜索引擎提供了出色的覆盖范围和自己的广泛语法，可以将这些一般引擎的发现与极大的效力一起使用，以发现架构细节、敏感文件和潜在的进入目标服务器的途径。
- en: Tuning your Google search skills
  id: totrans-74
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 调整你的谷歌搜索技能
- en: 'There are books written specifically on advancing Google search skills, but
    for web penetration testing, we can focus on some tips and practices that can
    better leverage the engine and eliminate useless search hits, commonly referred
    to as noise. We can use some operators to filter or focus our results, while others
    will perform logical combinations or modify the engine''s behavior. Let''s take
    a look at the most effective modifiers and options, filtering or focusing first,
    followed by logical operators:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些专门讲解提高谷歌搜索技能的书籍，但对于网络渗透测试，我们可以专注于一些可以更好地利用引擎并消除无用搜索结果的技巧和实践，通常称为噪音。我们可以使用一些操作符来过滤或聚焦我们的结果，而其他操作符将执行逻辑组合或修改引擎的行为。让我们先看看最有效的修饰符和选项，首先是过滤或聚焦，然后是逻辑操作符：
- en: '**The site: operator**: Using the site: operator tells Google''s engine to
    only accept files hosted on a particular domain. When we''re looking for legitimate
    contact information, exposed files, and content, we''ll want to use this operator
    to allow us to focus purely on that domain''s results, rather than on a full dump
    of links in page-hit order that may spamÂ many other sites. Take, for instance,
    a search on Cisco ASA documentation, both before (left) the site: operator and
    after (right):'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**站点：操作符**：使用站点：操作符告诉谷歌的引擎只接受托管在特定域上的文件。当我们正在寻找合法的联系信息、暴露的文件和内容时，我们将使用此操作符，以便让我们纯粹地专注于该域的结果，而不是在页面点击顺序中的链接的完整转储，这可能会垃圾邮件许多其他网站。例如，在Cisco
    ASA文档的搜索之前（左）和站点：操作符之后（右）：'
- en: '![](img/B03918_03_08-1.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_08-1.png)'
- en: 'The Site: Operator is a great first filter to ensure results focused on your
    target.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 站点：操作符是一个很好的第一个过滤器，可以确保结果集专注于您的目标。
- en: '**TheÂ credentials operators**: Using keywords such as `username`, `password`,
    `userid`, `pwd`, `passcode`, credentials, or any other variant can help us locate
    password or username recovery details. A quick targeted search on these terms
    can not only point you to portal entries you will likely target, but may, in fact,
    provide the keys to unlock them. We''ll discuss using default credentials against
    the results of these queries later in this book:'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**凭证操作符**：使用关键词如`username`、`password`、`userid`、`pwd`、`passcode`、credentials或任何其他变体可以帮助我们找到密码或用户名恢复详情。对这些术语进行快速有针对性的搜索不仅可以指向您可能要定位的门户入口，而且实际上可能提供解锁它们的钥匙。我们将在本书的后面讨论使用默认凭证对这些查询结果的影响：'
- en: '[PRE3]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![](img/B03918_03_09.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_09.png)'
- en: Credential search may not yield credentials itself, but may point to the next
    best thing â�� recovery!
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 凭证搜索可能不会产生凭证本身，但可能指向下一个最好的东西——恢复！
- en: '**The inurl: operator**: An early recon of a target, including lessons learned
    from social engineering, may provide us with clues as to the platform used, developers
    involved, or points of interest in a web application. We can combine the inurl:
    operator with the site: operator to probe those specific points of interest:'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网址：操作符**：对目标进行早期侦察，包括从社会工程学中学到的经验教训，可能会为我们提供有关所使用的平台、涉及的开发人员或网页应用程序中的兴趣点的线索。我们可以将网址：操作符与站点：操作符结合使用，以探索这些特定的兴趣点：'
- en: '[PRE4]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](img/B03918_03_10.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_10.png)'
- en: 'Inurl: can help eliminate thousands of potential locations and focus.'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 'Inurl: 可以帮助消除成千上万个潜在位置并聚焦。'
- en: '**The file handle (ext:) operator**: Using standard file handles allows us
    to call out and include (or exclude) file extensions of interest. Using typical
    file extensions, you can invoke each of them using the ext: operator. For instance,
    we''d search for all PHP files in [www.hackthissite.org](http://www.hackthissite.org)
    with the word index in the URL using the following string:'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件句柄（ext：）操作符**：使用标准文件句柄允许我们调用和包括（或排除）感兴趣的文件扩展名。使用典型的文件扩展名，您可以使用ext：操作符调用每个文件。例如，我们可以使用以下字符串在[www.hackthissite.org](http://www.hackthissite.org)中搜索所有带有URL中包含单词index的PHP文件：'
- en: '[PRE5]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '**The filetype: operator:** If we''re looking for a file type that may not
    be displayed but linked to or archived on a site, we''d instead use the filetype:
    operator. Invoking `filetype:xls` in your search, for instance, would scour your
    search area for Excel spreadsheets:'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件类型：操作符**：如果我们正在寻找可能不会显示但链接到或存档在网站上的文件类型，我们可以使用文件类型：操作符。例如，在您的搜索中调用`filetype:xls`，将搜索您的搜索区域以查找Excel电子表格：'
- en: '[PRE6]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '**The intitle: operator**: When we want a specific file, we can use the intitle:
    operator. This is very useful to locate platform-specific configuration files,
    or it can help to expose the `robots.txt` file. As you may recall from our HTTrack
    use, the utility''s default behavior is to avoid spidering the sections of the
    website identified in the `robots.txt` file. This was envisioned to allow web
    developers to preventÂ certain necessary but sensitive locations from being searchable
    by reputable browsers. If other precautions aren''t followed, `robots.txt` can
    provide a hacker with a list of files and folders they may want to see. Well,
    forÂ hackers, there is a good chance that there are some juicy details in there
    that would be very helpful.Â  To see what is in the `robots.txt` files, you can
    simply enter this:'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**标题：操作符**：当我们想要一个特定的文件时，我们可以使用标题：操作符。这对于定位特定平台配置文件非常有用，或者可以帮助暴露`robots.txt`文件。正如您可能还记得我们使用HTTrack时，该实用程序的默认行为是避免爬行网站中`robots.txt`文件中标识的部分。这是为了让网站开发人员防止可信浏览器搜索到某些必要但敏感的位置。如果没有采取其他预防措施，`robots.txt`可以为黑客提供他们可能想要查看的文件和文件夹列表。对于黑客来说，有很大的机会在其中找到一些非常有用的细节。要查看`robots.txt`文件中的内容，您可以简单地输入：'
- en: '[PRE7]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Each of the preceding operators can help narrow searches alone or in combination,
    but learning more about the processing engine of Google''s search can also help
    us eliminate extraneous information and understand the results. Here are some
    quick tip highlights:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 前述每个操作符都可以单独或组合使用来帮助缩小搜索范围，但了解更多关于谷歌搜索引擎的处理方式也可以帮助我们消除多余的信息并理解结果。以下是一些快速提示的亮点：
- en: Using the logical operator **OR**Â is helpful (**AND**Â is assumed). If written
    out, OR must always be all caps to be considered the logical OR, lest it is considered
    part of the search phrase itself. You can also use the **|**Â operator, commonly
    referred to as the **pipe**Â operator.
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用逻辑运算符**OR**是有帮助的（**AND**是默认的）。如果写出来，OR必须始终大写才能被视为逻辑OR，否则它将被视为搜索短语的一部分。您还可以使用**|**运算符，通常称为**管道**运算符。
- en: Google search will focus on the first 10 non-trivial words of a search phrase.
    UsingÂ *****Â in the place of optional or throw-away words in a search phrase
    won't count against the ten-word limit but effectively extends the phrase for
    more complex searches.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Google搜索将专注于搜索短语的前10个非平凡单词。在搜索短语中使用*****来代替可选或丢弃的单词不会计入十个单词的限制，但可以有效地扩展搜索短语，以进行更复杂的搜索。
- en: 'You can use **-**Â before an operator or filter to exclude (negate) the effect
    of that filter or operation. An example might be where we want to determine what,
    other than web servers, a particular domain may be presenting:'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以在操作符或过滤器之前使用**-**来排除（否定）该过滤器或操作的效果。例如，我们想要确定除了Web服务器之外，特定域名可能呈现的其他内容：
- en: '[PRE8]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](img/B03918_03_11.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_11.png)'
- en: Using the "-" modifier excludes a filter from the result set.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 使用“-”修饰符可以从结果集中排除一个过滤器。
- en: 'This is not the same as the keyword **NOT**, which is actually only useful
    to exclude a word from the search but has no effect on the special operators.
    If we were to run the following, it would yield plenty of **www** results, unlike
    the search with **-** used as a modifier:'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这与关键词**NOT**不同，后者实际上只能用于从搜索中排除一个词，对特殊操作符没有影响。如果我们运行以下命令，将会产生大量**www**的结果，与使用**-**作为修饰符的搜索不同：
- en: '[PRE9]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](img/B03918_03_12.png)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_12.png)'
- en: Using the NOT only excludes that string â�� not useful if you don't anticipate
    it.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 仅使用NOT排除该字符串 - 如果您不预期它，这是没有用的。
- en: Work smarter with the Google hacking DB and Netcraft
  id: totrans-104
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 与Google Hacking DB和Netcraft一起更智能地工作
- en: Google search skills will always be useful, but a lot of the most useful strings
    for hackers are captured in the **Google hacking database** (also known as **The
    Exploit DB**), a project hosted by the Offensive Security folks ([https://www.exploit-db.com/google-hacking-database/](https://www.exploit-db.com/google-hacking-database/)).
    While it is fun to browse, the best use of it is to seed your search queries,
    combining the strings they have catalogued with your own modifiers from the previous
    section.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: Google搜索技巧将始终有用，但对于黑客来说，最有用的字符串大部分都被收录在**Google Hacking数据库**（也称为**Exploit DB**）中，这是由Offensive
    Security团队托管的项目（[https://www.exploit-db.com/google-hacking-database/](https://www.exploit-db.com/google-hacking-database/)）。虽然浏览很有趣，但最好的用法是用它来启发您的搜索查询，将它们的字符串与前一节中的修饰符结合起来。
- en: 'The bulk of their categories are useful for web penetration testing, but I
    would start with the **Web Server Detection** queries:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 它们的大部分类别对于Web渗透测试很有用，但我会从**Web服务器检测**查询开始：
- en: '![](img/B03918_03_13.png)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_13.png)'
- en: The Google Hacking DB is ripe with awesome search queries you can repurpose.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: Google Hacking DB中有很多可以重新利用的出色搜索查询。
- en: These queries and others from categories such asÂ **vulnerable servers**, **sensitive
    directories**, and so on, coupled with the `inurl:` and `site:` modifiers can
    prove quite useful in getting a high-level look at the exposure in an environment.
    If you get lucky and unearth credentials or vulnerabilities, this information
    should be disclosed immediately to your sponsoring customer. These searches are
    in use continuously on both sides of the hacking landscape, and this sort of information
    should not wait until the debrief.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 这些查询以及其他类别，如**易受攻击的服务器**、**敏感目录**等，结合`inurl:`和`site:`修饰符，可以帮助我们高层次地了解环境中的暴露情况。如果你幸运地发现了凭证或漏洞，这些信息应立即披露给您的客户。这些搜索在黑客领域的两边都在持续使用，这类信息不应该等到总结之后才披露。
- en: '**Netcraft**, a company based in Bath, England, offers many services, but their
    free web scan tool ([https://searchdns.netcraft.com](https://searchdns.netcraft.com))
    is a great quick-and-dirty scanner that can help focus more detailed efforts.
    You can search on a domain name and burrow down into a report of all of the technologies
    and versions that can be publicly analyzed based on responses to harmless queries.
    A quick search of [https://www.packtpub.com/](https://www.packtpub.com/)Â on their
    site reveals that they have two mail IP addresses currently hosting a Packt platform
    on FreeBSD.Â  What else does the report tell us?'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 总部位于英格兰巴斯的公司**Netcraft**提供了许多服务，但他们的免费网络扫描工具（[https://searchdns.netcraft.com](https://searchdns.netcraft.com)）是一个非常方便的扫描器，可以帮助更加详细地聚焦。您可以搜索域名并深入到所有可以基于对无害查询的响应进行公开分析的技术和版本的报告中。在他们的网站上快速搜索[https://www.packtpub.com/](https://www.packtpub.com/)，我们发现他们目前有两个邮件IP地址，正在FreeBSD上托管Packt平台。报告还告诉我们什么？
- en: '![](img/B03918_03_14.png)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_14.png)'
- en: Netcraft's online web scanner gives us a great peek at what we have in store
    for future phases.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: Netcraft的在线网络扫描工具让我们对未来阶段有了很好的了解。
- en: We can see that there are two trackers in place (Google and Amazon). XML and
    SSL are in use server-side while JavaScript is in use on the clients, Drupal is
    used both as the **Content Management System** (**CMS**) and PHP scripting engine,
    and HTML5 and CSS sheets are in also use. All of these are useful in refining
    our pen testing approaches.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到有两个跟踪器（Google和Amazon）。服务器端使用XML和SSL，客户端使用JavaScript，Drupal既用作**内容管理系统**（**CMS**）又用作PHP脚本引擎，同时还使用HTML5和CSS样式表。所有这些都有助于优化我们的渗透测试方法。
- en: Mastering your own domain
  id: totrans-114
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 精通您自己的领域
- en: Search engines are easy and accessible, but we also need to understand what
    a network's domain structure, addressing plan, and supporting services are, as
    that perspective is vital to our efforts in probing the application. Domains hosting
    applications can have intricate domain structures that can be exploited. The hosts,
    network IP addresses and blocks, nameservers, and related elements can help identify
    target entities, pivots to adjacent hosts, underlying services and daemons, and
    open ports and protocols that are in use as well. We'll look at some tools that
    incorporate some of these into a larger solution, but mastering **dig**, **fierce**,
    **dnsenum**, **dnsmap**, **WHOIS**, and **DNSRecon** will go a long way toward
    improving accuracy and efficacy.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 搜索引擎易于访问，但我们还需要了解网络的域结构、寻址计划和支持服务，因为这种视角对我们探测应用程序至关重要。托管应用程序的域可能具有复杂的域结构，可以被利用。主机、网络IP地址和块、名称服务器以及相关元素可以帮助识别目标实体、转移到相邻主机、底层服务和守护程序，以及正在使用的开放端口和协议。我们将研究一些工具，这些工具将其中一些工具整合到一个更大的解决方案中，但是精通**dig**、**fierce**、**dnsenum**、**dnsmap**、**WHOIS**和**DNSRecon**将大大提高准确性和效力。
- en: The WHOIS database has been in use since the early days of the Internet, and
    while the intricate service provider and hosting paradigms mean WHOIS rarely contains
    the end user of the domain and their contact information, it is this information
    that can start an investigation. We've all used it in our experience, so we'll
    hop into the next-level tools.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: WHOIS数据库自互联网早期以来就已经在使用，尽管复杂的服务提供商和托管范式意味着WHOIS很少包含域的最终用户及其联系信息，但正是这些信息可以启动调查。我们在经验中都使用过它，因此我们将进入下一级工具。
- en: Digging up the dirt
  id: totrans-117
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 挖掘信息
- en: DNS records provide human-relatable aliases for IP addresses associated with
    the various functions of a domain. I would encourage a good review of DNS operations
    and the associated record types at periodic intervals to ensure you are always
    up to speed on any new trends in DNS use and to jog your memory. It is not uncommon
    to find new applications and protocols borrowing DNS record space for their own
    use. Keeping DNS knowledge fresh ensures you are well prepared to leverage those
    new applications.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: DNS记录为与域的各种功能相关联的IP地址提供了人类可关联的别名。我建议定期对DNS操作和相关记录类型进行全面审查，以确保您始终了解DNS使用中的任何新趋势，并唤起您的记忆。发现新的应用程序和协议借用DNS记录空间是很常见的。保持DNS知识的新鲜确保您能够充分利用这些新应用程序。
- en: The utility `dig` has been a stalwart of the pen testing community for DNS enumeration;
    chances are you've used it and have some favorite switches you like to employ.
    When it comes to web pen testing, we'll be concentrating on the answer field,
    and with the various switches that dig offers, we can use it to map out other
    related record types as well.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 实用程序`dig`一直是DNS枚举的渗透测试社区的中流砥柱；很可能你已经使用过它，并且有一些你喜欢使用的开关。在进行网络渗透测试时，我们将集中在答案字段上，并且利用`dig`提供的各种开关，我们可以使用它来映射其他相关的记录类型。
- en: Digging record types
  id: totrans-120
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 挖掘记录类型
- en: 'Dig can be used to query for and map out the associated record types for **A**,
    **MX**, **NS**, **SOA**, or other records quickly and easily. The default is A
    records, which indicate the domain''s main IPv4 addresses, but you may only want
    to locate the associated name servers (NS records), for instance, to attempt MITM
    attacks. MX records and pointers to the mail servers on a domain can be useful
    in crafting phishing campaigns to target users. If we want to see all of the record
    types associated with a domain, we could use the `ANY` keyword:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '`dig`可以用于快速而轻松地查询和映射与**A**、**MX**、**NS**、**SOA**或其他记录相关的记录类型。默认是A记录，表示域的主要IPv4地址，但您可能只想定位相关的名称服务器（NS记录），例如尝试进行中间人攻击。例如，域的MX记录和指向域上的邮件服务器的指针可以用于制定钓鱼攻击以针对用户。如果我们想查看与域相关的所有记录类型，我们可以使用`ANY`关键字：'
- en: '[PRE10]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](img/B03918_03_15.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_15.png)'
- en: Basic dig output - useful, but could be more succinct.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 基本的`dig`输出-有用，但可以更简洁。
- en: In order to find the mail servers associated with Packt Publishing, we would
    merely enter the MX keyword to filter just those record types.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 为了找到与Packt Publishing相关的邮件服务器，我们只需输入MX关键字来过滤那些记录类型。
- en: 'Each of the subsections in the basic `dig` output can be filtered, either by
    naming the specific section, such as `+nocomments`, `+noquestion`, `+noauthority`,
    `+noadditional`, or `+nostats` for instance. To turn all of these sections off,
    you can use the `+noall` shortcut and then turn on your desired section (for example
    `+answer`) to the end, as follows:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 基本`dig`输出中的每个子部分都可以通过命名特定部分来过滤，例如`+nocomments`，`+noquestion`，`+noauthority`，`+noadditional`或`+nostats`。要关闭所有这些部分，您可以使用`+noall`快捷方式，然后在末尾打开所需的部分（例如`+answer`），如下所示：
- en: '[PRE11]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](img/B03918_03_16.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_16.png)'
- en: The dig output shortened to focus only on records of interest to us
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 将`dig`输出缩短，只关注我们感兴趣的记录
- en: The `+short` modifier can eliminate a lot of superfluous information as well
    and is well worth appending to your standard queries to help shorten outputs.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '`+short`修饰符也可以消除大量多余的信息，并且值得附加到您的标准查询中，以帮助缩短输出。'
- en: '`dig` also offers the ability to do a **zone transfer**, which, if the target
    is not protected against it, allows an attacker to pull down the entire forwarding
    zone of a domain. Something that is only supposed to happen between legitimate
    nameservers on the domain, a successful zone transfer is a windfall to the attacker
    and is something we should always test and look for. To demonstrate a zone transfer,
    we''ll use the wonderful training site Diji Ninja''s own domain ([https://digi.ninja/projects/zonetransferme.php](https://digi.ninja/projects/zonetransferme.php))
    and type this:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '`dig`还提供了执行**区域传输**的能力，如果目标没有受到保护，允许攻击者下载域的整个转发区域。这只应该发生在域上的合法域名服务器之间，成功的区域传输对攻击者来说是一笔意外之财，我们应该始终测试和寻找。为了演示区域传输，我们将使用出色的培训网站Diji
    Ninja自己的域名（[https://digi.ninja/projects/zonetransferme.php](https://digi.ninja/projects/zonetransferme.php)）并输入以下内容：'
- en: '[PRE12]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](img/B03918_03_17.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_17.png)'
- en: Conducting a zone transfer is quite a coup, when it works.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 进行区域传输是一件了不起的事情，当它成功时。
- en: '`dig` offers a clean and easy toolset, but often, the target environment is
    larger than what `dig` can present on well, or we are looking for more in-depth
    results. This is where `dnsrecon` comes in. I would recommend repeating the same
    sorts of exercises with `dnsrecon` to see how it compares with dig and help you
    determine which tool is to be your primary effort.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '`dig`提供了一个清晰简单的工具集，但通常，目标环境比`dig`可以呈现的要大，或者我们正在寻找更深入的结果。这就是`dnsrecon`的用武之地。我建议使用`dnsrecon`重复相同类型的练习，以了解它与dig的比较，并帮助您确定哪个工具将成为您的主要工具。'
- en: Getting fierce
  id: totrans-136
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 变得凶猛
- en: '`dig` and `dnsrecon` are fantastic tools, but wouldn''t it be nice if we could
    go a little further and have a tool that tries to connect to the site''s address
    blocks, automates the zone transfer, and does it all while logging? **Fierce**
    (written in Perl by Robert *RSnake* Hansen) can do just that. There are many options
    and modifiers that can be used when invoking Fierce, but in most cases, I do initial
    discovery using dig, move to Fierce for an attempted zone transfer and some connection
    probing, and then move into a more graphical and organized tool such as Maltego
    to build my network maps and enumerate relationships. To use Fierce to attempt
    a zone transfer and send the logs to a file, you can simply invoke the tool and
    it will do so automatically:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '`dig`和`dnsrecon`是很棒的工具，但如果我们能进一步并拥有一个工具，它尝试连接到站点的地址块，自动执行区域传输，并在记录时执行所有这些操作，那不是很好吗？**Fierce**（由Robert
    *RSnake* Hansen用Perl编写）可以做到这一点。在调用Fierce时可以使用许多选项和修改器，但在大多数情况下，我使用dig进行初始发现，然后转到Fierce尝试进行区域传输和一些连接探测，然后转到更具图形化和组织性的工具，如Maltego，来构建我的网络地图和枚举关系。要使用Fierce尝试进行区域传输并将日志发送到文件，您只需调用该工具，它将自动执行：'
- en: '[PRE13]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Because this site allows zone transfers, I''ll see the results in the running
    output and the `txt` file I designated:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 因为这个网站允许区域传输，所以我会在运行输出和我指定的`txt`文件中看到结果：
- en: '![](img/B03918_03_18.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_18.png)'
- en: Fierce automates what it takes several dig or dnsrecon queries to do.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: Fierce自动化了需要进行多次dig或dnsrecon查询的操作。
- en: 'Fierce also allows you to attempt to connect to open ports on any public IPs
    using the `â��connect` switch. You''ll need to provide `wordlist` so that Fierce
    has some potential credentials to try, and you''ll want to run this on a dedicated
    machine or overnight, as the process can be lengthy, depending on the size of
    the domain. We can kick this off using the following:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: Fierce还允许您尝试使用`-connect`开关连接任何公共IP上的开放端口。您需要提供`wordlist`，以便Fierce有一些潜在的凭据可供尝试，并且您需要在专用机器上或在夜间运行此操作，因为该过程可能需要很长时间，具体取决于域的大小。我们可以使用以下方式启动此操作：
- en: '[PRE14]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Next steps with Nikto
  id: totrans-144
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Nikto的下一步
- en: Once we have a full array of DNS records and other relevant intelligence, we
    typically shift into scanning for vulnerabilities (also known as **vulns**). **Nikto**
    is my preferred scanner and I'll usually keep these results for tuning tools that
    scan vulnerabilities but also pivot into later phases. Nikto exports into several
    file types, including HTML, XML, TXT, and CSV, and using it begins the active
    recon phase.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们获得了完整的DNS记录和其他相关情报，通常会转入扫描漏洞（也称为**vulns**）。**Nikto**是我首选的扫描器，我通常会保留这些结果，以便调整扫描漏洞的工具，同时转入后续阶段。Nikto可以导出多种文件类型，包括HTML、XML、TXT和CSV，并且使用它开始了主动侦察阶段。
- en: Note
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Because it is an active tool, its use constitutes a legally provoking act, and
    as such, it is advised to only use it in practice against lab machines and for
    systems where you have explicit permission to test. I don't have enough collateral
    for posting bail on your behalf.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 因为它是一个主动工具，它的使用构成了一个合法的挑衅行为，因此建议只在实验室机器上进行实践，并且只对您有明确许可的系统进行测试。我没有足够的抵押品来代表您发布保释金。
- en: 'To use Nikto, we''ll need to identify the host or host list (the latter defined
    in a host file) and a location for our output logs, but there is an extensive
    list of menu items worth considering to tailor our scans. Besides the output file
    and logging parameters, there are actually predefined tunings that are available
    to run some common, best-practice test sets against the specified hosts. These
    options are a great shortcut to making the best use of Nikto in your scans, and
    are detailed in the main page:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用Nikto，我们需要确定主机或主机列表（在主机文件中定义），以及输出日志的位置，但有一个广泛的菜单项目列表值得考虑，以定制我们的扫描。除了输出文件和日志参数之外，实际上还有预定义的调整可用于针对指定主机运行一些常见的最佳实践测试集。这些选项是使用Nikto进行扫描的最佳捷径，并在主页中有详细说明：
- en: '[PRE15]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'A default scan will run all tests, but if there are restrictions as to what
    is permitted, these tunings can help keep the test compliant. When you require
    anonymity, it may also be desired to leverage an intentional proxy (either one
    you have established or one of many free ones (for example those on [http://proxy-list.org](http://proxy-list.org)),
    or better yet, a host you''ve already compromised for the purpose). To do so,
    you would specify the proxy server in `config.txt` (or an explicitly called alternative)
    using your favorite editor. **Nano** is my first choice, but **vim** or **emacs**
    works just fine:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 默认扫描将运行所有测试，但如果有限制，这些调整可以帮助保持测试的合规性。当您需要匿名时，可能还希望利用一个有意义的代理（您已经建立的代理或许多免费代理之一（例如[http://proxy-list.org](http://proxy-list.org)上的代理），或者更好的是，您已经为此目的而受到限制的主机）。为此，您将使用您喜欢的编辑器在`config.txt`中指定代理服务器（或显式调用替代方案）。**Nano**是我的第一选择，但**vim**或**emacs**也可以很好地工作：
- en: '[PRE16]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Scroll down to the **`P`****`roxy settings`** section and enter the appropriate
    details:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 滚动到**`P`****`roxy settings`**部分，并输入适当的详细信息：
- en: '[PRE17]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We can then launch our scans using the configured proxy as follows:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以使用配置的代理启动我们的扫描，如下所示：
- en: '[PRE18]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](img/B03918_03_19.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_19.png)'
- en: Nikto is a versatile and powerful scanner - practice in a closed environment
    makes a huge difference.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: Nikto是一个多才多艺、强大的扫描器——在封闭环境中进行实践会产生巨大的差异。
- en: As with any tool, it is sometimes important to realize which switches to avoid.
    For black-box testing (pen testing with a more realistic covert charter, where
    the tester tries to emulate an attacker and is provided with no advantageous access),
    it is essential to avoid options that cause excessive queries and chatty scans,
    and most of the time the `+mutate` switch is not worth the trouble. If you are
    white-box testing (known to the operators, not focused on stealth, and just exploring
    in the open), then it can make sense to provide greater coverage.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 与任何工具一样，有时重要的是意识到要避免哪些开关。对于黑盒测试（使用更真实的隐蔽特权进行的渗透测试，其中测试人员试图模拟攻击者，并且没有任何有利的访问权限），必须避免导致过多查询和啰嗦扫描的选项，大多数情况下`+mutate`开关不值得麻烦。如果进行白盒测试（对操作员已知，不专注于隐秘，并且只是在公开中探索），那么提供更广泛的覆盖范围是有意义的。
- en: Employing Maltego to organize
  id: totrans-159
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 利用Maltego进行组织
- en: '**Maltego** is one of my favorite recon tools in that it helps visualize the
    many links and relationships between disparate data sources. *Jason Beltrame*
    and I covered it in the *Penetration Testing with Raspberry Pi â�� Second Edition*
    ([https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition](https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition)),
    but since then, I have begun to use it in use cases I could not have imagined.
    As fun as it has been to plunge into this, there are certainly some best-practices
    that have assisted in avoiding information overload. The most recent version available
    in Kali''s distribution, 4.0.11, includes new footprinting techniques such as
    **Company Stalker**, **Find Wikipedia Edits**, **Twitter Digger**, and **Monitor**.
    All of the transforms can be of use in web pen testing, but these new social-focused
    starting points stress the move by **Paterva** to make Maltego indispensable to
    all hacking communities.'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '**Maltego**是我最喜欢的侦察工具之一，因为它帮助可视化不同数据源之间的许多链接和关系。*Jason Beltrame*和我在*Penetration
    Testing with Raspberry Pi â�� Second Edition*中对其进行了介绍（[https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition](https://www.packtpub.com/networking-and-servers/penetration-testing-raspberry-pi-second-edition)），但自那时起，我已经开始在无法想象的用例中使用它。尽管投入其中很有趣，但肯定有一些最佳实践有助于避免信息过载。Kali发行版中最新版本4.0.11包括新的足迹技术，如**Company
    Stalker**、**Find Wikipedia Edits**、**Twitter Digger**和**Monitor**。所有转换都可以在Web渗透测试中使用，但这些新的以社交为重点的起点强调了**Paterva**的努力，使Maltego成为所有黑客社区不可或缺的工具。'
- en: 'I tend toward using it as a graphical documentation of information gleaned
    from social engineering, LinkedIn/email searches, and pinning them on domains.
    The ability to pivot and transform against an entity has even helped me to uncover
    multiple domains across multiple hosting companies that through two or three layers
    of obfuscation are actually run by the same network of scammers. Recursion through
    transforms can help find additional users that may have local accounts or indicate
    relatives or friends whose names and information could populate our dictionaries.
    A quick example would be to do a Company Stalker machine against Packt Publishing''s
    web domain:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 我倾向于将其用作从社会工程、LinkedIn/电子邮件搜索中获取的信息的图形文档，并将它们固定在域上。对实体进行转变和转换的能力甚至帮助我发现了多个跨多个托管公司的域，经过两三层混淆后实际上是由同一网络的骗子运营的。通过转换的递归可以帮助找到可能具有本地帐户的其他用户，或者指示可能填充我们的字典的亲戚或朋友的姓名和信息。一个快速的例子是对Packt
    Publishing的网域进行公司跟踪机器：
- en: '![](img/B03918_03_20.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_20.png)'
- en: This Maltego graph is zoomed out to protect the innocent, but also to show the
    relational nature of information it tracks.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 这个Maltego图已经缩小，以保护无辜者，同时也展示了它所跟踪的信息的关联性质。
- en: As you can see, there are several documents found in the base machine's process
    (orange dots) and each of those files has associated metadata, such as people
    (green), certificates (yellow), and locations (red). If we burrow down into a
    person, we can ask for transforms that search for all potential email addresses
    (blue). I find Maltego to be very helpful when you provide it with additional
    seed information from other OSINT sources to help focus, or nudge the model towards
    linking the original machine and other information. You can add any form of identity,
    but additional web domains or e-mail addresses, social networking usernames, or
    IP blocks and interfaces can greatly improve the fidelity and usefulness of Maltego
    graphs.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，基础机器的进程中发现了几个文档（橙色点），每个文件都有关联的元数据，如人员（绿色）、证书（黄色）和位置（红色）。如果我们深入研究一个人，我们可以要求进行搜索所有潜在的电子邮件地址的转换（蓝色）。我发现当您向Maltego提供来自其他OSINT来源的额外种子信息以帮助聚焦或推动模型链接原始机器和其他信息时，Maltego非常有帮助。您可以添加任何形式的身份，但额外的Web域或电子邮件地址、社交网络用户名或IP块和接口可以极大地提高Maltego图的准确性和有用性。
- en: Being social with your target
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 与目标社交
- en: '* * *'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'If you are not using **Social-Engineer Toolkit** (**SET**, [https://www.trustedsec.com/social-engineer-toolkit/](https://www.trustedsec.com/social-engineer-toolkit/)),
    you are missing out on something important. We can certainly use it to spoof Google,
    Facebook, and Twitter to attract victims and launch attacks or scrape their credentials,
    but we can also use it in spoofing our target web application so as to hijack
    sessions and map user behaviors. As victims unknowingly browse these duplicate
    websites from the comfort of a coffee shop chair, attackers can gather the victims''
    passwords or even inject a command shell that gives them full access to the victims''
    systems. It is a great tool for security professionals to demonstrate how users
    more often than not will not pay attention to the location where they enter sensitive
    information as long as the page looks legit. Let''s take a look at how to use
    SET against the mirror that we pulled down from [www.hackthissite.org.](http://www.hackthissite.org.)
    Here is a diagram we can use to help envision what this attack looks like:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有使用**社会工程师工具包**（**SET**，[https://www.trustedsec.com/social-engineer-toolkit/](https://www.trustedsec.com/social-engineer-toolkit/)），那么您就错过了一些重要的东西。我们当然可以用它来欺骗Google、Facebook和Twitter来吸引受害者并发动攻击或窃取他们的凭证，但我们也可以用它来欺骗我们的目标Web应用程序，以劫持会话并映射用户行为。当受害者在咖啡店的舒适椅子上无意中浏览这些重复的网站时，攻击者可以收集受害者的密码，甚至注入一个命令shell，从而完全访问受害者的系统。对于安全专业人员来说，这是一个很好的工具，可以演示用户通常不会注意输入敏感信息的位置，只要页面看起来合法。让我们看看如何使用SET对我们从[www.hackthissite.org](http://www.hackthissite.org)下载的镜像进行攻击。这是一个我们可以用来帮助设想这种攻击的图表：
- en: '![](img/B03918_03_21-2.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_21-2.png)'
- en: SET can be used for many attacks, but who doesn't like a classic MITM?
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: SET可以用于许多攻击，但谁不喜欢经典的MITM呢？
- en: 'My typical use for SET is to select option **`1) Social Engineering Attacks`**,
    then select **`2) Website Attack Vectors`**. What I''m looking for is in **`3)
    Credential Harvester Attack Method`**, so we can grab our poor target users''
    login credentials. We can use the built-in templates or import custom sites (useful
    for corporate portals or lesser-used web applications); but why wouldn''t we want
    to just use the mirror we already captured? We''ll choose option **`3) Custom
    Import`**. This will turn our Kali Linux VM into a malicious front-end for [www.hackthissite.org](http://www.hackthissite.org),
    presenting itself as the real deal and scraping credentials or any other HTML-based
    information fields:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 我的典型用途是选择选项**`1)社会工程攻击`**，然后选择**`2)网站攻击向量`**。我要找的是**`3)凭证窃取攻击方法`**，这样我们就可以获取我们可怜的目标用户的登录凭证。我们可以使用内置模板或导入自定义站点（对企业门户或使用较少的Web应用程序很有用）；但为什么我们不想使用我们已经捕获的镜像呢？我们会选择选项**`3)自定义导入`**。这将把我们的Kali
    Linux虚拟机变成[www.hackthissite.org](http://www.hackthissite.org)的恶意前端，表现得像真的一样，并且可以抓取凭证或任何其他基于HTML的信息字段：
- en: '`**`![](img/B03918_03_22.png)`**'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '`**`![](img/B03918_03_22.png)`**'
- en: SET configuration using a previous mirror - modify and tweak to make it even
    more convincing.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 使用先前镜像的SET配置-修改和调整以使其更具说服力。
- en: A quick check of our mirror shows it is now up-and-running; our task now is
    to persuade users to direct their initial sessions to here.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 快速检查我们的镜像显示它现在已经运行起来了；我们现在的任务是说服用户将他们的初始会话重定向到这里。
- en: '![](img/B03918_03_23.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_23.png)'
- en: A quick check pointing to my copy of the site shows our MITM clone is ready
    to roll.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 快速检查我的网站副本显示我们的MITM克隆已经准备就绪。
- en: Entering some credentials in the **`Login`** fields and submitting them, I can
    see that they are captured live and recorded in a log file.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在**`登录`**字段中输入一些凭证并提交它们，我可以看到它们被实时捕获并记录在日志文件中。
- en: '![](img/B03918_03_24.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B03918_03_24.png)'
- en: Any HTTP messages that arriveÂ are captured, so credentials or personal information
    is ours to own.`  `## Summary
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 任何到达的HTTP消息都会被捕获，因此凭证或个人信息就是我们的了。`## 摘要
- en: '* * *'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: As I mentioned in the beginning of this chapter, the recon phase can make or
    break the subsequent phases. The information gathering will feed your cracking
    and fuzzing operations, narrowing search fields to something significantly more
    manageable. The work saved in focusing the testing translates into tighter test
    criteria, more successful testing approaches, less churn and trial and error,
    and much more salient reports. Customers often learn as much about what we find
    in this phase as they will in the remaining phases, and this brings up a crucial
    point. The quality and quantity of information available online about their systems
    and the people using them can have dramatic consequences in the future. Proactive
    actions to limit or reduce this exposure improves their security posture and should
    be both encouraged and coached.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我在本章开头提到的，侦察阶段可以决定后续阶段的成败。信息收集将为您的破解和模糊操作提供数据，将搜索范围缩小到更易管理的范围。在专注于测试中节省的工作转化为更严格的测试标准，更成功的测试方法，更少的翻转和试错，以及更有意义的报告。客户通常在这个阶段学到的东西和在剩下的阶段学到的一样多，这提出了一个关键问题。关于他们的系统和使用它们的人在线上可获得的信息的质量和数量可能会对未来产生重大影响。积极采取行动来限制或减少这种曝光将改善他们的安全状况，并且应该得到鼓励和指导。
- en: In this chapter, we explored some deeper uses of the most popular OSINT gathering
    tools. We saw how we can quickly map the various network and domain components
    in a web application's hosting architecture, and even began to scan that infrastructure
    with tighter command line options that yield more succinct and useful data than
    the defaults. We also delved into better uses of search engines and leveraged
    some popular online resources that have documented some truly scary query strings.
    Social engineering in many forms were discussed, and we built our own MITM attack
    to capture credentials based on our mirrored website. Wrapping up, we looked at
    how Maltego begins to unravel the target environment's layers and aid in visualizing
    our adversary.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了一些最流行的OSINT收集工具的更深层用途。我们看到了如何快速映射Web应用程序托管架构中的各种网络和域组件，甚至开始使用更紧凑的命令行选项扫描基础设施，以获得比默认设置更简洁和有用的数据。我们还深入研究了更好地使用搜索引擎，并利用了一些流行的在线资源，这些资源记录了一些真正可怕的查询字符串。我们讨论了许多形式的社会工程学，并建立了自己的MITM攻击，以捕获基于我们镜像网站的凭据。最后，我们看了Maltego如何开始解开目标环境的层，并帮助可视化我们的对手。
- en: In the next chapter, you'll learn how to crawl web applications more effectively
    for quick scans using the Arachni framework. As an intercepting proxy to interact
    with the conversation between the server and client, we'll see how Arachni can
    go further to automate some attacks to provide additional test vectors, launch
    scans, trace flows on DOM, and JavaScript environments. As a bonus, you'll learn
    to use Arachni to mimic mobile platforms and even produce higher quality reports,
    either as stand-alone or as the basis for a multi-tool pen test deliverable. The
    work in this chapter is about to pay off, folks!`
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，您将学习如何使用Arachni框架更有效地对Web应用程序进行快速扫描。作为一个拦截代理来与服务器和客户端之间的对话进行交互，我们将看到Arachni如何进一步自动化一些攻击，提供额外的测试向量，启动扫描，跟踪DOM和JavaScript环境中的流程。作为一个额外的奖励，您将学会使用Arachni来模拟移动平台，甚至生成更高质量的报告，无论是作为独立报告还是作为多工具渗透测试交付的基础。本章的工作即将取得回报，朋友们！
