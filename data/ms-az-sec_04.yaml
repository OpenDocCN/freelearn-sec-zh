- en: '*Chapter 3*: Managing Cloud Identities'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第3章*：管理云身份'
- en: Back in the days when IT security was synonymous with blocking network traffic,
    life was easy. You could be sure that your physical walls built your perimeter,
    so you simply needed to protect your borders. However, today, your network endpoints
    are no longer enough to secure your perimeter. Today, we see an increasing amount
    of phishing and credential theft attacks against corporate environments. We're
    in an age where corporate data is moving out of its secure enterprise network
    environment. It's the age of cloud services such as Office 365, and so traditional
    security strategies aren't enough to safeguard data as the data is outside secure
    walls. We need a new approach to add on top of the traditional approach. This
    new approach is "identity is the new perimeter." This makes identity something
    we need to protect more than ever before. Of course, this does not mean that we
    have to do away with the old method of protecting the network, and we'll explore
    this in [*Chapter 4*](B15414_04_Final_JM_ePub.xhtml#_idTextAnchor087), *Network
    Security*.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去，IT安全几乎等同于阻挡网络流量，那时的生活非常简单。你可以确信你的物理围墙构建了你的边界，因此你只需要保护你的边界。然而，今天，仅靠网络端点已经不足以保障你的边界。如今，我们看到越来越多针对企业环境的钓鱼攻击和凭证窃取攻击。我们正处于一个企业数据逐渐脱离其安全企业网络环境的时代。这是云服务时代，例如Office
    365，因此传统的安全策略不足以保护数据，因为数据已经在安全围墙之外。我们需要在传统方法的基础上增加新的方法。这种新方法就是“身份是新的边界”。这使得身份成为我们比以往任何时候都更需要保护的内容。当然，这并不意味着我们必须放弃保护网络的旧方法，我们将在[*第4章*](B15414_04_Final_JM_ePub.xhtml#_idTextAnchor087)《网络安全》中探讨这一点。
- en: 'In general, to avoid random attacks, you need to raise the bar and make an
    attack attempt as expensive as possible for an attacker. It''s just like protecting
    your home: if you secure your front door with a higher **resistance class** (**RC**),
    have grids in front of your windows, an automated lighting system to light up
    your property, and your neighbor does not, then burglars looking for random targets
    will most probably not even try to attack your home. This is because an attack
    attempt against your home would probably be too time consuming, or the probability
    of being detected is too high; thus, it would be too expensive from an attacker''s
    point of view. This does not work if you are suffering a sophisticated attack
    that is planned and targeted against your home or identities (there is no absolute
    security!), but it helps against all the random attack attempts out in the wild.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，为了避免随机攻击，你需要提高门槛，并让攻击尝试对攻击者来说尽可能昂贵。这就像保护你的家一样：如果你用更高的**抗性等级**（**RC**）保护前门，在窗户前安装格栅，使用自动照明系统照亮你的财产，而你的邻居没有这样做，那么寻找随机目标的窃贼很可能根本不会尝试攻击你的家。这是因为对你的家进行攻击可能会非常耗时，或者被发现的概率太高；因此，从攻击者的角度来看，代价太高。如果你遭受的是针对你的家或身份的精心策划、针对性的攻击（没有绝对的安全！），那么这种方法就不起作用，但它有助于抵御所有随机的攻击尝试。
- en: 'In this chapter, we will not only cover strategies to protect your identities,
    but you will also learn how to reduce the attack surface of your privileged accounts.
    The topics we will cover are the following:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章不仅将介绍保护身份的策略，还将帮助你了解如何减少特权账户的攻击面。我们将讨论的主题如下：
- en: Exploring passwords and passphrases
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探讨密码和密码短语
- en: Understanding **multi-factor authentication (MFA)**
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解**多因素认证（MFA）**
- en: Using Conditional Access
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用条件访问
- en: Introducing **Azure Active Directory** **(Azure AD)** Identity Protection
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍**Azure Active Directory** **(Azure AD)** 身份保护
- en: Understanding **role-based access control (RBAC)**
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解**基于角色的访问控制（RBAC）**
- en: Protecting admin accounts with Azure AD **Privileged Identity Management (PIM)**
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Azure AD **特权身份管理（PIM）**保护管理员账户
- en: Hybrid authentication and **Single Sign-On (SSO)**
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 混合认证和**单点登录（SSO）**
- en: Understanding passwordless authentication
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解无密码认证
- en: Licensing considerations
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 许可证考虑
- en: Exploring passwords and passphrases
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探讨密码和密码短语
- en: 'When talking about identity security, there is one principle you always have
    to keep in mind: *assume breach*. The question is not *whether your accounts are
    attacked* but *whether you know about it* and *whether you can prevent attackers
    from being successful*. We can already see that there are many successful attacks
    against cloud identities every day. There is no single solution for protecting
    your identities, but you need to leverage a broader toolset to be resilient against
    identity attacks.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在谈论身份安全时，有一个原则你必须始终记住：*假设已经被攻破*。问题不在于*你的账户是否被攻击*，而在于*你是否知道这一点*以及*你是否能防止攻击者成功*。我们已经可以看到，每天都有许多成功攻击云身份的案例。没有单一的解决方案能保护你的身份，但你需要利用更广泛的工具集，以应对身份攻击。
- en: Important Note
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: The question is not whether your cloud identities are under attack but whether
    you can make sure that attackers are not successful.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 问题不在于你的云身份是否受到攻击，而在于你是否能确保攻击者不会成功。
- en: If we start with passwords, you could say that no one likes them. Well, attackers
    do, because they often give attackers leverage for a following **identity-focused
    attack** attempt. Given the fact that people tend to create their passwords based
    on their life experiences, an attacker generally needs to be good at gathering
    background information about a specific user to guess their password. This, of
    course, means some effort on the attacker's side, and this would most probably
    be executed in a sophisticated attack against a high-value target. You can see
    that passwords are not a good solution for protecting your accounts.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们从密码谈起，你可以说没有人喜欢它们。嗯，攻击者倒是喜欢，因为它们常常为攻击者提供了进行后续**以身份为中心的攻击**的契机。鉴于人们往往根据自己的生活经历创建密码，攻击者通常需要擅长收集有关特定用户的背景信息，以猜测其密码。当然，这意味着攻击者需要付出一些努力，而这通常会在针对高价值目标的复杂攻击中进行。你可以看到，密码并不是保护账户的好方法。
- en: 'Furthermore, passwords can lead to **denial of service** (**DoS**). In **Active
    Directory Domain Services (AD DS)** on Windows Server, lots of companies use a
    respective security policy that will lock out user accounts for a given time (or
    infinitely) after a given number of failed login attempts. The problem is that
    authenticated users—that is, users that have been able to log into Active Directory
    — are able to read this security policy, and they are able to list user accounts
    from AD. An authenticated user can be any employee (internal attacker), or someone
    who is trying to attack a company from outside and who was able to get access
    to a set of login credentials (external attacker). Leveraging PowerShell, an attacker
    can easily:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，密码还可能导致**拒绝服务（DoS）**攻击。在Windows Server的**Active Directory 域服务（AD DS）**中，许多公司使用相应的安全策略，在多次登录失败后，锁定用户账户一定时间（或无限期）。问题在于，已认证的用户——即那些能够登录到Active
    Directory的用户——能够读取这个安全策略，并且他们能够列出AD中的用户账户。已认证的用户可以是任何员工（内部攻击者），也可以是某个试图从外部攻击公司并且能够获取一组登录凭证的人（外部攻击者）。利用PowerShell，攻击者可以轻松地：
- en: Find out what security policy is in place
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解当前的安全政策
- en: List all user accounts
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 列出所有用户账户
- en: Lock all user accounts by trying to log in with incorrect passwords
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尝试使用错误密码登录，锁定所有用户账户
- en: Repeat this script every *x* number of minutes.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每隔*X*分钟重复此脚本。
- en: If someone does so, no one in this directory will be able to log in again, so
    the company will suffer a DoS. That said, you should *not* implement this lockout
    policy but monitor login attempts instead, and then make educated decisions if
    something unusual happens. Keep an eye on your security event logs on Windows
    servers or the syslog/auth log domain on Linux.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有人这么做，本目录中的任何人都将无法再登录，因此公司将遭受拒绝服务（DoS）攻击。也就是说，你不应该*实施*这种锁定策略，而是应监控登录尝试，并在出现异常情况时做出明智决策。请留意Windows服务器上的安全事件日志，或Linux上的syslog/auth日志域。
- en: Dictionary attacks and password protection
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 字典攻击与密码保护
- en: 'Dictionary attacks, such as brute-force and password spray attacks, still find
    success every day. In a dictionary attack, attackers try combinations of usernames
    and well-known and often-used passwords against an authentication service. The
    brute-force attack is more noisy and easier to recognize. With brute force, an
    attacker will try lots of passwords for a single user account, hoping that one
    of the attacks will be successful. In the backend, you will see lots of failed
    login attempts, so you can easily react to it. However, a password spray attack
    is way more sensitive since an attacker will only use a small set of passwords
    against lots of user accounts. If the attacks are very slow and widely distributed,
    it is very hard to notice an attack. To avoid successful password spray and brute-force
    attacks in the cloud and, to be more precise, in Azure AD, there are some easy
    best practices:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 字典攻击，例如暴力破解和密码喷洒攻击，仍然每天都会成功。在字典攻击中，攻击者尝试将用户名和常见的、经常使用的密码组合用于身份验证服务。暴力破解攻击比较显眼且更容易被识别。在暴力破解攻击中，攻击者会对一个用户帐户尝试多个密码，希望其中一个攻击能够成功。在后端，你会看到大量失败的登录尝试，因此你可以轻松地作出反应。然而，密码喷洒攻击则更加隐蔽，因为攻击者只会对多个用户帐户使用少量的密码。如果攻击非常缓慢且分散，那么就很难发现攻击。为了避免在云中，尤其是在
    Azure AD 中，密码喷洒和暴力破解攻击的成功发生，可以采用一些简单的最佳实践：
- en: Encourage your users to use passphrases instead of passwords
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 鼓励用户使用密码短语而不是传统密码
- en: Block passwords or patterns that should not be used in your environment
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 阻止在你的环境中不应该使用的密码或模式
- en: Currently, you can use passwords or passphrases with up to 256 (!) characters
    in Azure AD. Even if you were to only use all 26 letters from the alphabet in
    uppercase and lowercase, this would mean (2x26)²⁵⁶ 256 possibilities, which results
    in a number near infinity.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，你可以在 Azure AD 中使用最多 256 个字符的密码或密码短语。即使你仅使用所有大写和小写字母中的 26 个字母，这也意味着 (2x26)²⁵⁶
    共有 256 种可能性，结果几乎接近无穷大。
- en: That said, and knowing that you cannot only use uppercase and lowercase letters,
    but also numbers and other characters in a passphrase, it makes a whole lot of
    combinations. You see, you should definitely enable and encourage your users to
    use passphrases with a lot of letters.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，考虑到你不仅可以使用大写和小写字母，还可以在密码短语中使用数字和其他字符，这会产生大量的组合。你看，绝对应该启用并鼓励用户使用包含大量字母的密码短语。
- en: For passwords you do not want to allow in your organization, there is another
    option you can enable. By default, Microsoft does not allow you to use passwords
    or password patterns that can be found on password lists and that are known to
    be used in dictionary attacks. For example, a pattern that is not allowed is your
    username, or any part of it. In addition to that, it might make sense for your
    company to avoid passwords that are easily relatable to your enterprise. This
    could be well-known marketing phrases, corporate abbreviations, and so on. In
    Azure AD, there is an option to create a custom banned password list that can
    be used to either audit or enforce the usage of secure passwords. You can even
    use this custom list to enable password protection for your on-premises Windows
    Server AD by installing and enabling an on-premises agent.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 对于你不希望在组织中使用的密码，还有另一种选项可以启用。默认情况下，Microsoft 不允许使用可以在密码列表中找到的、已知会被字典攻击使用的密码或密码模式。例如，一个不被允许的模式是你的用户名或其中的任何一部分。此外，可能对你的公司有意义的是避免使用容易与企业相关的密码。这可能包括著名的营销词汇、公司缩写等。在
    Azure AD 中，你可以创建一个自定义禁止密码列表，既可以用来审计，也可以强制使用安全密码。你甚至可以使用这个自定义列表为本地 Windows Server
    AD 启用密码保护，通过安装并启用本地代理。
- en: The custom banned password list can contain up to 1,000 case-sensitive terms
    between 4 and 16 characters in length. One nice feature is the fact that character
    substitution such as "e" and "3" or "o" and "0" is considered.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 自定义禁止密码列表最多可以包含 1,000 个区分大小写的词条，长度介于 4 到 16 个字符之间。一个很棒的特点是，字符替代（例如“e”与“3”或“o”与“0”）也会被考虑在内。
- en: '![Figure. 3.1 - Configuration of a custom banned password list in Azure AD'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.1 - 在 Azure AD 中配置自定义禁止密码列表'
- en: '](img/Fig._3.1.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.1.jpg)'
- en: Figure. 3.1 - Configuration of a custom banned password list in Azure AD
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.1 - 在 Azure AD 中配置自定义禁止密码列表
- en: In order to configure a custom banned password list, you need to navigate to
    **Azure Active Directory** -> **Authentication methods** -> **Password protection**
    in the Azure portal, as seen in *Fig. 3.1.* On that screen, you'll also find configuration
    options for the **Custom smart lockout** feature. As mentioned before, you might
    find an on-premises AD security policy forcing accounts to be locked after a given
    number of failed login attempts. This is kind of an on/off decision and you can
    easily increment the lockout counter with the same password to force account lockouts.
    Remember that this is why you should disable such policies in your on-premises
    AD and monitor login attempts instead.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置自定义的禁止密码列表，你需要在 Azure 门户中导航至**Azure Active Directory** -> **身份验证方法** -> **密码保护**，如*图
    3.1*所示。在该屏幕上，你还会找到**自定义智能锁定**功能的配置选项。如前所述，你可能会发现本地 AD 安全策略在一定次数的登录失败后强制锁定账户。这是一种开关决策，你可以轻松通过使用相同的密码增加锁定计数器，从而强制账户锁定。记住，这也是为什么你应该禁用本地
    AD 中的此类策略并监控登录尝试的原因。
- en: 'However, in Azure AD, smart lockout is the feature that combines the best of
    two worlds: letting users work without blocking them unnecessarily and preventing
    attackers from guessing your passwords at the same time. To achieve that goal,
    smart lockout comes with some interesting features:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在 Azure AD 中，智能锁定是结合了两全其美的特性：让用户在不被不必要地阻塞的情况下工作，同时防止攻击者猜测你的密码。为了实现这一目标，智能锁定提供了一些有趣的功能：
- en: Users are not meant to be blocked from working. Smart lockout recognizes attack
    attempts and login attempts from valid users. Attack attempts are treated differently,
    so legitimate users are still able to work while attackers are blocked.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户并不应该被阻止工作。智能锁定能够识别攻击尝试和有效用户的登录尝试。攻击尝试会被区别对待，因此合法用户仍然可以正常工作，而攻击者则会被阻止。
- en: Smart lockout stores the last three bad password hashes. Doing so, you cannot
    simply use the lockout counter to enforce DoS by using the same bad password several
    times.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 智能锁定会存储最后三个错误密码的哈希值。通过这种方式，你不能仅仅通过多次使用相同的错误密码来增加锁定计数器，从而实施拒绝服务攻击。
- en: The default lockout threshold is 10 bad attempts with a lockout duration of
    60 seconds. Smart lockout is always on for Azure AD; however, it does not guarantee
    that legitimate user accounts are never locked out. The service uses familiar
    versus unfamiliar locations to try to figure out whether a login attempt comes
    from a bad actor or a genuine user. However, there is still a probability that
    users will be blocked from logging in. And one important point is that the service
    does not necessarily protect you from highly sensitive password spray attacks.
    This is not because the service is bad but because those kinds of attacks can
    become really difficult to discover.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认的锁定阈值是 10 次错误尝试，锁定持续时间为 60 秒。智能锁定始终开启在 Azure AD 中；然而，它并不保证合法的用户账户永远不会被锁定。该服务会通过比较熟悉与不熟悉的位置来尝试判断登录尝试是否来自恶意行为者或真正的用户。然而，仍然存在用户被阻止登录的概率。一个重要的点是，服务并不一定能保护你免受高度敏感的密码喷洒攻击。这并不是因为服务本身存在问题，而是因为这类攻击可能会变得非常难以发现。
- en: 'Imagine an attacker has a list of nine passwords and they use a widely spread
    network of bots to attack thousands of user accounts in one custom domain over
    a time frame of weeks. In that situation, there are some facts to realize:'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 假设攻击者有一份包含九个密码的列表，并且他们利用广泛分布的机器人网络在几周的时间内攻击一个自定义域中的成千上万个用户账户。在这种情况下，有几个事实需要注意：
- en: The number of login attempts per user account will not exceed the default threshold.
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个用户账户的登录尝试次数不会超过默认阈值。
- en: By using several widely spread host systems to run the attack, it is hard to
    discover whether a login attempt is valid or malicious. However, Microsoft will
    also take into account whether a login attempt comes from a known bad IP address
    or an unfamiliar location.
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通过使用多个广泛分布的主机系统来执行攻击，很难发现一个登录尝试是有效的还是恶意的。然而，微软也会考虑登录尝试是否来自已知的恶意 IP 地址或不熟悉的位置。
- en: So, in this scenario, the service will probably not block an attacker. Of course,
    the nine passwords in the list need to be quite sophisticated to be accepted.
    However, there is still a probability of an attacker being successful at guessing
    your passwords.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，在这种情况下，该服务可能不会阻止攻击者。当然，列表中的九个密码需要足够复杂才能被接受。然而，攻击者猜测你的密码仍然有成功的概率。
- en: Now that you know why passwords are not enough to protect your accounts, let's
    move one step further and see how MFA can give an additional layer of security
    to your accounts.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您知道了密码不足以保护您的账户，接下来我们进一步了解 MFA 如何为您的账户增加一层额外的安全防护。
- en: Understanding Multi-Factor Authentication (MFA)
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解多因素认证（MFA）
- en: 'There are only a few technical features that protect your accounts more than
    using MFA. With MFA, it is not enough to know a username and a password; you are
    also challenged to prove who you are using another authentication factor. With
    MFA, you generally need to be able to log in with:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 很少有技术功能能比使用 MFA 更好地保护您的账户。通过 MFA，知道用户名和密码是不够的；您还需要通过其他认证因素来证明您的身份。通过 MFA，通常需要能够通过以下方式登录：
- en: Something you are, such as your user account name or a biometrical attribute
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的身份信息，例如您的用户账户名或生物识别属性
- en: Something you know, such as a password
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您知道的东西，例如密码
- en: Something you have, such as an additional authentication factor (smartcard,
    smartphone app, or security key).
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您拥有的东西，例如额外的认证因素（智能卡、智能手机应用或安全密钥）。
- en: 'Given the fact that an MFA challenge is only triggered after a successful login
    attempt, it is still reliant on passphrases that are not easy to guess. In other
    words: if an MFA challenge is triggered, the respective username/password combination
    has already been successfully validated.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于 MFA 挑战只有在登录尝试成功后才会触发，它仍然依赖于不容易猜测的密码。换句话说：如果触发了 MFA 挑战，相应的用户名/密码组合已经成功验证。
- en: '![Figure. 3.2 - An MFA challenge is triggered after the user''s credentials
    have successfully been validated'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.2 - 在用户凭证成功验证后，触发 MFA 挑战'
- en: '](img/Fig._3.2.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.2.jpg)'
- en: Figure. 3.2 - An MFA challenge is triggered after the user's credentials have
    successfully been validated
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.2 - 在用户凭证成功验证后，触发 MFA 挑战
- en: 'Today, there are several options for using MFA in Azure AD:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如今，Azure AD 提供了多种使用 MFA 的选项：
- en: A push message from the Microsoft Authenticator smartphone app
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自 Microsoft Authenticator 智能手机应用的推送消息
- en: A **one-time password** (**OTP**) from the Microsoft Authenticator smartphone
    app
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自 Microsoft Authenticator 智能手机应用的 **一次性密码** (**OTP**)
- en: A text message with an OTP sent to your mobile device
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过短信发送到您移动设备的 OTP 代码
- en: A phone call to an authentication phone
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 致认证电话的电话
- en: A security key or token
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个安全密钥或令牌
- en: If you have set up MFA the right way, you can literally react to all situations
    with a combination of these options. If you do not have access to mobile data
    or Wi-Fi, you can use the OTP code from a text message or from your smartphone
    app. If you leave your smartphone at home, you can get a call to your office phone
    (or another authentication phone you defined during the configuration process).
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正确设置了 MFA，您可以通过这些选项的组合应对所有情况。如果您无法访问移动数据或 Wi-Fi，您可以使用短信中的 OTP 代码或智能手机应用中的
    OTP。如果您把智能手机忘在家里，您可以接到办公室电话（或者您在配置过程中定义的其他认证电话）。
- en: Important Note
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Important to note is the fact that you should not use your mobile phone number
    as your authentication phone because of obvious reasons. If you lose your phone
    or leave it at home, there won't be many options left.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，由于显而易见的原因，您不应将手机号码作为身份验证电话。如果您丢失了手机或将手机忘在家里，您将没有太多可选项。
- en: In [*Chapter 2*](B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038), *Governance
    and Security*, you learned about the segregation of duties and the principle of
    least privilege. Accounts only get the access rights they really need to fulfill
    a task. However, it is important to prevent being accidentally locked out from
    your Azure AD environment. So, there is still a need for accounts with higher
    privileges, such as subscription owner or Global Administrator access. This is
    why you need to create at least two administrative emergency access accounts.
    Some of these emergency access or *break glass* accounts need to be protected
    with MFA, too. Now, a single smartphone does not seem to be a good option for
    these kinds of accounts, because, according to Murphy's law, something will go
    wrong; the smartphone's owner is always on holiday, ill, or not available because
    of other reasons when you need them. A good thing to know is that you can have
    up to five authentication factors connected to a single account. For example,
    you could associate three security keys, one smartphone app, and a phone number
    with one account to make sure that there will always be at least one method you
    can use to fulfill an MFA challenge.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在[*第 2 章*](B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038)《治理与安全》中，您学习了职责分离和最小权限原则。帐户只获得完成任务所需的访问权限。然而，重要的是要防止意外被锁定在
    Azure AD 环境之外。因此，仍然需要具有更高权限的帐户，如订阅所有者或全局管理员访问权限。这就是为什么您需要创建至少两个管理员紧急访问帐户的原因。部分这些紧急访问或*备用解锁*帐户也需要通过
    MFA 进行保护。现在，单一智能手机似乎并不是这些帐户的好选择，因为根据墨菲定律，事情总会出错；当您需要它们时，智能手机的拥有者总是度假、病倒或因为其他原因无法使用。值得知道的是，您可以将最多五个身份验证因素连接到一个帐户。例如，您可以将三个安全密钥、一个智能手机应用和一个电话号码与一个帐户关联，以确保始终有至少一种方法可以用来完成
    MFA 挑战。
- en: MFA activation in Azure AD
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 Azure AD 中启用 MFA
- en: 'From an administrator''s perspective, activation of MFA in Azure AD is pretty
    straightforward:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 从管理员的角度来看，在 Azure AD 中启用 MFA 非常简单：
- en: In the Azure portal, navigate to **Azure Active Directory** and select the **Users**
    navigation pane. In the upper-right corner, navigate to **•••More** and then select
    **Multi-Factor Authentication**, as shown in the following screenshot:![Figure.
    3.3 - MFA activation in the Azure portal
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Azure 门户中，导航到**Azure Active Directory**，并选择**用户**导航窗格。在右上角，导航到**•••更多**，然后选择**多重身份验证**，如下图所示：![图
    3.3 - 在 Azure 门户中启用 MFA
- en: '](img/Fig._3.3.jpg)'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Fig._3.3.jpg)'
- en: Figure. 3.3 - MFA activation in the Azure portal
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 3.3 - 在 Azure 门户中启用 MFA
- en: You will be redirected to a retro-style portal at the [windowsazure.com](http://windowsazure.com)
    domain, in which you can enable or disable MFA for single users or bulk-update
    them by selecting several accounts or using a CSV file in the **users** tab.
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您将被重定向到 [windowsazure.com](http://windowsazure.com) 域的复古风格门户，在那里您可以启用或禁用单个用户的
    MFA，或者通过选择多个帐户或使用 CSV 文件批量更新它们，方法是在**用户**选项卡中进行操作。
- en: Before you enable MFA for user accounts, first switch from the **users** tab
    to the **service settings** tab to configure some custom settings for your environment,
    as shown in the following screenshot:![Figure. 3.4 - MFA - service settings
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在启用用户帐户的 MFA 之前，首先从**用户**选项卡切换到**服务设置**选项卡，以配置一些适合您环境的自定义设置，如下截图所示：![图 3.4 -
    MFA - 服务设置
- en: '](img/Fig._3.4.jpg)'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Fig._3.4.jpg)'
- en: Figure. 3.4 - MFA - service settings
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 3.4 - MFA - 服务设置
- en: The first option is to allow or disallow users to create app passwords for legacy
    non-browser apps that do not support MFA. Outlook used to be such an application;
    however, nowadays, most applications should be able to authenticate with MFA.
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 第一个选项是允许或不允许用户为不支持 MFA 的传统非浏览器应用程序创建应用程序密码。Outlook 曾经是这样的应用程序；然而，现如今，大多数应用程序应该能够通过
    MFA 进行身份验证。
- en: You can also define trusted IPs for which you can skip MFA. So, for example,
    if your users are authenticating from one of your corporate offices and you have
    defined your external IP range(s) here, you can define that MFA challenges are
    only triggered when someone wants to authenticate from outside your corporate
    buildings. You can also enable and disable single verification options if they
    do not fit your company's needs. The last setting is to allow users to remember
    MFA for devices they (but not you as a company!) trust. If you enable that option,
    users are not prompted with an MFA challenge again for a given period of time
    (between 1 and 60 days) on a particular device.
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您还可以定义可信 IP 地址，从而跳过 MFA。例如，如果您的用户从公司办公室进行身份验证，并且您已经在此处定义了外部 IP 范围，则可以定义只有当某人从公司大楼外部进行身份验证时，才会触发
    MFA 挑战。您还可以启用或禁用单一验证选项，如果它们不适合贵公司的需求。最后一个设置是允许用户记住他们（但不是您作为公司！）信任的设备上的 MFA。如果启用此选项，则在特定设备上，用户在给定的时间段（1
    到 60 天之间）内不会再次被提示进行 MFA 挑战。
- en: Now, back to enabling user accounts for MFA on the **users** tab. When you click
    the **Enable** link on the right side after selecting one or several user accounts,
    you are prompted to read the online deployment guide and then click on **enable
    multi-factor auth**. That's all from an administrator's point of view. Pretty
    easy? Indeed.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，回到在**用户**选项卡上启用用户帐户 MFA。当您在选择一个或多个用户帐户后，点击右侧的**启用**链接时，系统会提示您阅读在线部署指南，然后点击**启用多因素身份验证**。从管理员的角度来看，这就是所有操作。很简单吧？确实是。
- en: '![Figure. 3.5 - Enabling MFA for one or several user accounts'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.5 - 为一个或多个用户帐户启用 MFA'
- en: '](img/Fig._3.5.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.5.jpg)'
- en: Figure. 3.5 - Enabling MFA for one or several user accounts
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.5 - 为一个或多个用户帐户启用 MFA
- en: The MFA-activated user has to configure all individual settings after the next
    login attempt. Telephone numbers for the account are taken from the information
    that is already stored in Azure AD. However, the user can update these numbers
    in the wizard that appears after the next logon.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 MFA 的用户在下次登录尝试后必须配置所有个性化设置。帐户的电话号码将从已经存储在 Azure AD 中的信息中获取。然而，用户可以在下次登录时出现的向导中更新这些号码。
- en: MFA activation from a user's perspective
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从用户的角度来看启用 MFA
- en: 'After enforcing MFA for John, a new window will appear after his next successful
    login, telling him that his organization needs more information to protect his
    account, as shown in the following screenshot:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在为 John 强制启用 MFA 后，他下一次成功登录时将会弹出一个新窗口，告诉他组织需要更多信息来保护他的帐户，具体如以下截图所示：
- en: '![Figure. 3.6 - New window at the first login after MFA activation'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.6 - 启用 MFA 后第一次登录时的窗口'
- en: '](img/Fig._3.6.jpg)'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.6.jpg)'
- en: Figure. 3.6 - New window at the first login after MFA activation
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.6 - 启用 MFA 后第一次登录时的窗口
- en: 'John now only has two options: **Use a different account** to log in or click
    **Next** to proceed through the MFA activation process. That said, you should
    inform your users before activating MFA to let them know what''s going to happen
    and to reduce the amount of support tickets required!'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，John 只有两个选项：**使用不同帐户**登录或点击**下一步**继续执行 MFA 激活过程。也就是说，在激活 MFA 之前，您应该提前通知您的用户，让他们知道将会发生什么，并减少支持票的数量！
- en: 'Let''s look at what happens if John decides to complete the process:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如果 John 决定完成此过程会发生什么：
- en: John decides to proceed and clicks the **Next** button. On the following screen,
    he can decide which is going to be his primary authentication option. John's office
    phone number is already filled from the information stored in his Azure AD user
    account, and he cannot change it. The authentication phone number, however, can
    be individually configured.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: John 决定继续并点击**下一步**按钮。在接下来的屏幕上，他可以决定哪种方式将成为他的主要身份验证选项。John 的办公室电话号码已经从他在 Azure
    AD 用户帐户中存储的信息中自动填充，且无法更改。然而，身份验证电话号码可以单独配置。
- en: '![Figure. 3.7 - Office phone numbers cannot be individually changed but are
    filled from the values stored in the Azure AD user account'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.7 - 办公电话不能单独更改，而是从 Azure AD 用户帐户中存储的值填充'
- en: '](img/Fig._3.7.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.7.jpg)'
- en: Figure. 3.7 - Office phone numbers cannot be individually changed but are filled
    from the values stored in the Azure AD user account
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.7 - 办公电话不能单独更改，而是从 Azure AD 用户帐户中存储的值填充
- en: 'If John decides to use the authentication phone as his primary MFA option,
    he has to configure the number and then decide whether he wants to receive a phone
    call or a text message containing an OTP:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 John 决定使用认证电话作为他的主要 MFA 选项，他必须配置号码，然后选择是否希望接收包含 OTP 的电话或短信：
- en: '![Figure. 3.8 - Authentication phone - individually configure the number and
    select the contact method'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.8 - 认证电话 - 单独配置号码并选择联系方式'
- en: '](img/Fig._3.8.jpg)'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.8.jpg)'
- en: Figure. 3.8 - Authentication phone - individually configure the number and select
    the contact method
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.8 - 认证电话 - 单独配置号码并选择联系方式
- en: 'The third option is for John to use the Microsoft Authenticator app, which
    is available for all major smartphone operating systems in their respective app
    store. Here, again, he has two options to select from: either being informed by
    a push notification or using the verification code from the app, which is an OTP
    that changes every 30 seconds.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个选项是让 John 使用 Microsoft Authenticator 应用，该应用可以在所有主要智能手机操作系统的应用商店中找到。在这里，他有两个选择：要么通过推送通知接收信息，要么使用来自应用的验证码，验证码是每
    30 秒更换一次的 OTP（一次性密码）。
- en: '![Figure. 3.9 - Mobile app - select the primary MFA verification option'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.9 - 移动应用 - 选择主要的 MFA 验证选项'
- en: '](img/Fig._3.9.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.9.jpg)'
- en: Figure. 3.9 - Mobile app - select the primary MFA verification option
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.9 - 移动应用 - 选择主要的 MFA 验证选项
- en: 'John decides to use the mobile app and so has to click on the **Set up** button.
    He has already installed the Microsoft Authenticator app on his smartphone, so
    he can now easily proceed. A new window opens that shows John a **Quick Response
    (QR)** code to scan with the mobile app, as shown in the following screenshot:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: John 决定使用移动应用，因此必须点击 **设置** 按钮。他已经在智能手机上安装了 Microsoft Authenticator 应用，因此现在可以轻松继续。一个新窗口会打开，显示给
    John 一个 **快速响应（QR）** 代码，用移动应用扫描，如下图所示：
- en: '![Figure. 3.10 - Mobile app configuration window'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.10 - 移动应用配置窗口'
- en: '](img/Fig._3.10.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.10.jpg)'
- en: Figure. 3.10 - Mobile app configuration window
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.10 - 移动应用配置窗口
- en: 'In his app, John clicks the **+** symbol and selects the option to add a new
    **work or school account**. With the QR code scanner that opens in the smartphone
    app, John scans the code from his screen and will immediately find his account
    added to the app''s account list, as shown in the following screenshot:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在他的应用中，John 点击 **+** 符号并选择添加新的 **工作或学校帐户** 选项。在智能手机应用中打开的二维码扫描器中，John 扫描屏幕上的二维码，帐户将立即添加到应用的帐户列表中，如下图所示：
- en: '![Figure. 3.11 - John''s account has been added to the account list in his
    smartphone app'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.11 - John''s 账户已添加到他智能手机应用的账户列表中'
- en: '](img/Fig._3.11.jpg)'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.11.jpg)'
- en: Figure. 3.11 - John's account has been added to the account list in his smartphone
    app
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.11 - John's 账户已添加到他智能手机应用的账户列表中
- en: 'On his computer, John clicks **Next** so the app and the backend service are
    synchronized. The **configure mobile app** window will disappear again and John
    is then able to click the **Next** button. A push notification to the smartphone
    app is triggered, which can then be approved or declined, as shown in the following
    screenshot:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在电脑上，John 点击 **下一步**，这样应用和后台服务会同步。**配置移动应用** 窗口将再次消失，John 然后可以点击 **下一步** 按钮。系统会触发推送通知到智能手机应用，随后可以批准或拒绝，如下图所示：
- en: '![Figure. 3.12 - Push notification in the Microsoft Authenticator app'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.12 - Microsoft Authenticator 应用中的推送通知'
- en: '](img/Fig._3.12.jpg)'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.12.jpg)'
- en: Figure. 3.12 - Push notification in the Microsoft Authenticator app
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.12 - Microsoft Authenticator 应用中的推送通知
- en: Next, John is asked to enter his authentication phone number so Microsoft can
    make sure that John can authenticate logins even when he loses access to the mobile
    app.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，John 被要求输入他的认证电话号码，以便 Microsoft 确保即使 John 无法访问移动应用，他也能进行身份验证登录。
- en: '*Step 4* then presents John with the app password he needs to use instead of
    his own user account password. In applications that do not support phone-based
    MFA today, this password is only shown once, so users need to copy and store it
    so it can be used when needed. If the app password is not stored safely, users
    can create new app passwords later, but then again, the respective password is
    only shown once during creation. After that, the MFA configuration is finished,
    and John will be logged off. When he logs on again, John will have to accept the
    MFA challenge.'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '*步骤4*会向John展示他需要使用的应用密码，而不是他自己的用户账户密码。在当前不支持基于电话的MFA的应用程序中，该密码只显示一次，因此用户需要复制并保存它，以便在需要时使用。如果应用密码没有安全存储，用户可以稍后创建新的应用密码，但同样，密码只在创建时显示一次。之后，MFA配置完成，John将被注销。再次登录时，John必须接受MFA挑战。'
- en: MFA, in combination with strong passwords, can protect accounts from more than
    95% of attacks, and given the fact that Azure MFA can be used free of charge in
    the default configuration, there is no reason not to enable it.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: MFA结合强密码可以保护账户免受95%以上的攻击，而且考虑到Azure MFA在默认配置下可以免费使用，完全没有理由不启用它。
- en: Now that you know how to configure MFA from an administrator's and a user's
    perspective, let's move one step further and learn how conditional access can
    be used to fine-tune the MFA process according to your company's business needs.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经了解了如何从管理员和用户的角度配置MFA，让我们更进一步，了解如何根据公司的业务需求使用条件访问来微调MFA过程。
- en: Using Conditional Access
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用条件访问
- en: MFA, the feature we discussed in the previous section, is the perfect option
    for better protecting your cloud identities. But it is still kind of an on/off
    decision. Either you activate a user account for MFA or you don't. Wouldn't it
    be great to dynamically react to authentication attempts and then decide whether
    an MFA challenge is needed? With **Conditional Access**, there is a feature that
    enables us to define authentication conditions that require more or fewer challenges
    in the authentication process.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: MFA，我们在上一节中讨论的功能，是更好地保护云身份的完美选择。但它仍然是一个开关式的决策。你要么启用MFA用户账户，要么不启用。难道不是很棒，能够动态地响应身份验证尝试，然后决定是否需要MFA挑战吗？有了**条件访问**，我们可以定义认证条件，从而在认证过程中要求更多或更少的挑战。
- en: Conditional Access gives customers a broad variety of options to include or
    exclude in a policy. For example, you could enforce the usage of MFA for specified
    directory roles, such as Azure AD Global Administrators, and in addition to that,
    require that the login is performed on a corporate-owned device. Or, you could
    exclude your "normal" Office 365 workers from being challenged by MFA, but only
    if they are working from a corporate office. As soon as one of them tries to log
    in from a train station, mobile device, home office, and so on, an MFA challenge
    is triggered. You see, there are lots of options, and we'll cover them in this
    section.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 条件访问为客户提供了多种选择，可以在策略中包括或排除。例如，你可以强制指定目录角色使用MFA，比如Azure AD全局管理员，并且要求登录必须在公司拥有的设备上进行。或者，你可以将“正常”的Office
    365员工从MFA挑战中排除，但仅当他们在公司办公室工作时。只要其中一个人试图从火车站、移动设备、家庭办公室等地方登录，就会触发MFA挑战。你看，选择非常多，我们将在这一节中详细介绍。
- en: '![Figure. 3.13 - Conditional Access in Azure AD'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.13 - Azure AD中的条件访问'
- en: '](img/Fig._3.13.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.13.jpg)'
- en: Figure. 3.13 - Conditional Access in Azure AD
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.13 - Azure AD中的条件访问
- en: 'You''ll find all Conditional Access-related settings in the Azure portal under
    **Azure Active Directory** > **Conditional Access**:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 你会在Azure门户中的**Azure Active Directory** > **条件访问**下找到所有与条件访问相关的设置：
- en: '![Figure. 3.14 - Conditional Access overview page'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.14 - 条件访问概览页面'
- en: '](img/Fig._3.14.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.14.jpg)'
- en: Figure. 3.14 - Conditional Access overview page
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.14 - 条件访问概览页面
- en: The main section that appears now is the **Policies** section. Conditional Access
    policies define and enforce the complexity of authentication based on several
    conditions. Policies can depend on locations from which authentications come,
    user and sign-in risk, devices, applications, or a combination of all of these.
    You can use Conditional Access policies to decide when and for whom access to
    your cloud environment will be allowed or blocked. So, by using Conditional Access
    policies, you can always make sure to apply the right amount of security enforcements
    when they are needed to keep your environment secure, and not to challenge your
    users unnecessarily when not needed.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 现在出现的主要部分是**策略**部分。条件访问策略根据多个条件定义并强制执行身份验证的复杂性。策略可以依赖于身份验证请求的来源位置、用户和登录风险、设备、应用程序，或这些因素的组合。你可以使用条件访问策略来决定何时以及为谁允许或阻止访问你的云环境。因此，通过使用条件访问策略，你可以确保在需要时施加适当的安全措施，以保持环境安全，并避免在不需要时对用户进行不必要的挑战。
- en: Before we take a deeper look at how to define all those conditions in a Conditional
    Access policy, let's first have a look at named locations that can be used within
    these policies.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们更深入地了解如何在条件访问策略中定义所有这些条件之前，让我们先来看看可以在这些策略中使用的命名位置。
- en: Named locations
  id: totrans-127
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 命名位置
- en: There is a management area to define custom settings you can use in your Conditional
    Access policies. The first area to mention is **Named locations**. For **Named
    locations**, there are two different options to click. The first option is **Configure
    MFA trusted IPs**, which will redirect you to the **Services** settings in the
    legacy portal you already know from the previous section. You can use this option
    to define IP address ranges that should always be excluded from MFA challenges.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个管理区域，用于定义可以在条件访问策略中使用的自定义设置。首先要提到的是**命名位置**。对于**命名位置**，有两个不同的选项可以选择。第一个选项是**配置
    MFA 受信任的 IP 地址**，这将把你重定向到你从前一部分已经知道的传统门户中的**服务**设置。你可以使用这个选项定义应始终排除在 MFA 挑战之外的
    IP 地址范围。
- en: '![Figure. 3.15 - Conditional access - named locations'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.15 - 条件访问 - 命名位置](img/Fig._3.17.jpg)'
- en: '](img/Fig._3.15.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.15.jpg)'
- en: Figure. 3.15 - Conditional access - named locations
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.15 - 条件访问 - 命名位置
- en: The second option is **+ New location**, with which you can define IP ranges,
    and even countries and geographical regions, to use them for custom Conditional
    Access policies. If you select **Mark as trusted location** for an IP range, a
    user's sign-in risk is lowered when an authentication request comes from there.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个选项是**+ 新位置**，你可以使用它来定义 IP 范围，甚至是国家和地理区域，以便在自定义条件访问策略中使用它们。如果你为某个 IP 范围选择**标记为受信任位置**，那么当来自该位置的身份验证请求时，用户的登录风险将降低。
- en: '![Figure. 3.16 - Creating a trusted named location'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.16 - 创建一个受信任的命名位置](img/Fig._3.16.jpg)'
- en: '](img/Fig._3.16.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.16.jpg)'
- en: Figure. 3.16 - Creating a trusted named location
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.16 - 创建一个受信任的命名位置
- en: Sign-in risks are important for Azure AD Identity Protection, the feature we
    look into in the *Introducing Azure AD Identity Protection* section.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 登录风险对于 Azure AD 身份保护很重要，这是我们在*介绍 Azure AD 身份保护*部分中讨论的功能。
- en: Custom controls
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自定义控制
- en: With *custom controls*, you can redirect your users during the authentication
    process to an external compatible service to satisfy further authentication requirements
    outside of Azure AD. The user's browser window is redirected to a third-party
    service, where the user needs to perform any further authentication requirements
    before being granted access to their cloud resources. Custom controls depend on
    the third-party application. For example, you could integrate a third-party MFA
    provider into your authentication workflow instead of relying on the Azure AD
    MFA service.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 使用*自定义控制*，你可以在身份验证过程中将用户重定向到外部兼容服务，以满足 Azure AD 之外的进一步身份验证要求。用户的浏览器窗口将被重定向到一个第三方服务，在那里用户需要执行任何进一步的身份验证要求，才能获得访问云资源的权限。自定义控制依赖于第三方应用程序。例如，你可以将第三方
    MFA 提供商集成到身份验证工作流中，而不是依赖 Azure AD 的 MFA 服务。
- en: Terms of use
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用条款
- en: You can define custom terms of use that need to be accepted before users are
    allowed to access certain cloud applications. For example, you could allow users
    to use their own devices to access your environment, but only if they accept your
    terms of use.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以定义用户在访问某些云应用程序之前需要接受的自定义使用条款。例如，你可以允许用户使用自己的设备访问你的环境，但前提是他们接受你的使用条款。
- en: '![Figure. 3.17 - Terms of use'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.17 - 使用条款](img/Fig._3.17.jpg)'
- en: '](img/Fig._3.17.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.17.jpg)'
- en: Figure. 3.17 - Terms of use
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.17 - 使用条款
- en: To configure your custom terms of use, you need to upload one PDF for every
    language you want to create them for. After saving, the terms of use will appear
    in the grant control list when creating a new Conditional Access policy.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置自定义的使用条款，你需要为每种语言上传一个 PDF 文件。在保存后，使用条款将在创建新条件访问策略时显示在授权控制列表中。
- en: Conditional Access policies
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 条件访问策略
- en: As mentioned before, Conditional Access policies help you to always apply the
    right amount of security for every authentication situation, without unnecessarily
    blocking or challenging your users when not needed. They can be seen as is, then.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，条件访问策略帮助你始终为每个身份验证情况应用适当的安全性，而无需在不需要时不必要地阻止或挑战用户。因此，可以按原样查看它们。
- en: Conditional Access policies consist of *assignments* and *access controls*.
    Assignments define who will be impacted by this Conditional Access policy and
    in which situation. Access controls define whether access is blocked or granted,
    and if it's granted, on which conditions.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 条件访问策略由*分配*和*访问控制*组成。分配定义了谁将受此条件访问策略的影响，以及在哪种情况下。访问控制定义了是否阻止访问或允许访问，如果允许访问，则定义哪些条件。
- en: Assignments
  id: totrans-148
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分配
- en: 'In the **Assignments** section, you can select users and groups, cloud apps
    or user actions, and conditions to include or exclude in a Conditional Access
    policy, as shown in the following screenshot:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在**分配**部分，你可以选择在条件访问策略中包含或排除的用户和组、云应用或用户操作以及条件，如下图所示：
- en: '![Figure. 3.18 - Users and groups - select which users and groups are to be
    included'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.18 - 用户和组 - 选择哪些用户和组要包含'
- en: or excluded in a Conditional Access policy
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 或在条件访问策略中被排除
- en: '](img/Fig._3.18.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.18.jpg)'
- en: Figure. 3.18 - Users and groups - select which users and groups are to be included
    or excluded in a Conditional Access policy
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.18 - 用户和组 - 选择哪些用户和组要在条件访问策略中包含或排除
- en: You can choose to **Include** or **Exclude** **None**, **All users**, or a defined
    subset of users and groups in a Conditional Access policy. You can also select
    to exclude all guest and external users, directory roles (such as Global Administrators),
    or a defined subset of users and groups in your Conditional Access policy.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以选择在条件访问策略中**包含**或**排除** **无**、**所有用户**，或定义的用户和组的子集。你还可以选择排除所有来宾和外部用户、目录角色（如全局管理员）或在条件访问策略中定义的用户和组的子集。
- en: Important Note
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: When selecting all users and then blocking access with this policy, this will
    also affect all your administrator accounts. That said, you could lock yourself
    out when activating this policy. It is recommended to apply a policy to a small
    set of users first to make sure it behaves as expected!
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 当选择所有用户并使用此策略阻止访问时，这也会影响所有管理员帐户。也就是说，启用此策略时可能会将自己锁定在外。因此，建议先将策略应用于少数用户，以确保其按预期工作！
- en: You can also **Include** or **Exclude** cloud applications or user actions in
    the Conditional Access policy. Again, you can select **None**, **All apps**, or
    selected apps to be included, or define selected apps to be exempted from the
    policy.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以在条件访问策略中**包含**或**排除**云应用或用户操作。同样，你可以选择**无**、**所有应用**或选择包含的应用，或者定义从策略中豁免的应用。
- en: Important Note
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: When selecting all cloud apps to be included in your policy, this will also
    affect the Azure portal. Make sure not to lock yourself out by only activating
    the policy to a small set of users first, so you can make sure that it behaves
    as expected!
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择包含在策略中的所有云应用时，这也会影响 Azure 门户。确保不要只先对少数用户启用该策略，以免将自己锁定在外，从而确保它按预期工作！
- en: In the **User actions** section, you can select whether this policy affects
    the registration of security information for your users. That means that the policy
    is active for users when proceeding through the MFA registration process.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 在**用户操作**部分，你可以选择此策略是否影响用户的安全信息注册。这意味着在进行 MFA 注册过程时，策略对用户有效。
- en: 'Conditions to be included in your assignments are sign-in risk, device platforms,
    locations, client apps, and device state. Sign-in risk is calculated by Azure
    AD Identity Protection. You can select the sign-in risk level this policy will
    apply to from **No risk**/**Low**/**Medium**/**High**. Device platforms can be
    included or excluded. You can select to include any device platform in your policy,
    or to include or exclude one or several of the following:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 要包含在分配中的条件包括登录风险、设备平台、位置、客户端应用程序和设备状态。登录风险由 Azure AD 身份保护计算。你可以选择该策略适用的登录风险级别，**无风险**/**低风险**/**中风险**/**高风险**。可以包含或排除设备平台。你可以选择在策略中包含任何设备平台，或者选择包含或排除以下一个或多个：
- en: Android
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Android
- en: iOS
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: iOS
- en: Windows Phone
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Phone
- en: Windows
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows
- en: macOS
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: macOS
- en: You can include any location or select to include or exclude all trusted locations,
    or selected locations you have already defined in one of the preceding steps.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以选择任何位置，或选择包括或排除所有信任的位置，或者你在之前步骤中已经定义的选定位置。
- en: Client apps to include can either be a browser, or mobile apps and desktop clients,
    including modern authentication clients, Exchange ActiveSync clients, or other
    clients (older office clients or other mail protocols).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端应用程序可以是浏览器、移动应用程序和桌面客户端，包括现代认证客户端、Exchange ActiveSync 客户端或其他客户端（旧版 Office
    客户端或其他邮件协议）。
- en: You can either include all device states in a policy, or exclude devices that
    are hybrid Azure AD joined or marked as compliant in Intune.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在策略中包括所有设备状态，或者排除混合 Azure AD 加入的设备或在 Intune 中标记为符合要求的设备。
- en: Access controls
  id: totrans-170
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 访问控制
- en: 'In the **Access controls** section, you define whether you want to block or
    grant access to your environment depending on the selection you made before. If
    you want to grant access, you can either grant it without any condition or you
    can require one or all of the following controls to be enforced:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **访问控制** 部分，你可以根据之前所做的选择定义是否阻止或授予访问权限。如果你希望授予访问权限，可以选择无条件授予，也可以要求强制执行以下一个或多个控制：
- en: '**Require multi-factor authentication**: When the conditions you defined in
    the policy are met, user access is granted when the user responds to the MFA challenge.'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**要求多因素认证**：当你在策略中定义的条件得到满足时，用户响应 MFA 挑战后，将授予用户访问权限。'
- en: '**Require device to be marked as compliant**: In Intune, you can define device
    compliance policies. For example, you can mark a device as compliant only when
    it is corporate owned and currently patched.'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**要求设备标记为符合要求**：在 Intune 中，你可以定义设备合规性策略。例如，只有当设备为公司所有并且已经打上补丁时，才能将其标记为符合要求。'
- en: '**Require hybrid Azure AD joined device**: Devices that are hybrid Azure AD
    joined are owned by an organization. They exist in the cloud and on-premises,
    which means that they are joined to both Windows Server AD and Azure AD.'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**要求混合 Azure AD 加入的设备**：混合 Azure AD 加入的设备由组织拥有。它们同时存在于云端和本地，这意味着它们既加入 Windows
    Server AD，又加入 Azure AD。'
- en: '**Require approved client app**: Access is only granted if one of the approved
    client apps is used to access corporate information. Today, an approved client
    app can be one out of more than 25 apps related to Microsoft 365, including, but
    not limited to, Microsoft Azure Information Protection, Microsoft Excel, Microsoft
    Edge, Microsoft Intune Managed Browser, Microsoft Teams, and Microsoft Outlook.'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**要求批准的客户端应用程序**：仅当使用其中一个批准的客户端应用程序访问公司信息时，才会授予访问权限。目前，批准的客户端应用程序可以是与 Microsoft
    365 相关的 25 多个应用程序之一，包括但不限于 Microsoft Azure 信息保护、Microsoft Excel、Microsoft Edge、Microsoft
    Intune 管理浏览器、Microsoft Teams 和 Microsoft Outlook。'
- en: '**Require app protection policy**: You can use Intune to define an app protection
    policy for Microsoft Cortana, Microsoft Outlook, Microsoft OneDrive, and Microsoft
    Planner. With this setting, you can enforce that an app protection policy is present
    before granting access to corporate information, as illustrated in the following
    screenshot:'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**要求应用保护策略**：你可以使用 Intune 为 Microsoft Cortana、Microsoft Outlook、Microsoft OneDrive
    和 Microsoft Planner 定义应用保护策略。通过此设置，你可以在授予公司信息访问权限之前，强制要求应用保护策略存在，如下截图所示：'
- en: '![Figure. 3.19 - Conditions for granting access using Conditional Access'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.19 - 使用条件访问授予访问权限的条件'
- en: '](img/Fig._3.19.jpg)'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.19.jpg)'
- en: Figure. 3.19 - Conditions for granting access using Conditional Access
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.19 - 使用条件访问授予访问权限的条件
- en: Now that you know how to configure Conditional Access policies in theory, let's
    go a step further and try to define settings for some behaviors.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经知道了如何在理论上配置条件访问策略，接下来我们再进一步，尝试为一些行为定义设置。
- en: 'For example, you could create a policy that blocks access for all devices that
    are not hybrid Azure AD joined. However, this policy should not affect users that
    are members of a particular group of administrators. A policy that would fit your
    needs could include the following:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你可以创建一个策略，阻止所有未混合Azure AD连接的设备访问。然而，这个策略不应该影响属于特定管理员组的用户。适合你需求的策略可能包括以下内容：
- en: Include all users and exclude the particular group of administrators.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 包括所有用户，排除特定的管理员组。
- en: Exclude devices that are hybrid Azure AD joined.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 排除混合Azure AD连接的设备。
- en: Block access.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 阻止访问。
- en: 'You might also want to enforce MFA when authentication attempts are not coming
    from a trusted location or if users are not using corporate-owned devices. This
    policy would:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还希望在身份验证尝试不是来自可信位置，或用户没有使用公司拥有的设备时强制执行多重身份验证（MFA）。该策略将会：
- en: Include all users.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 包括所有用户。
- en: Include all locations and exclude all trusted locations.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 包括所有位置，排除所有可信位置。
- en: Grant access and require MFA.
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 授予访问权限并要求MFA。
- en: Important Note
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要提示
- en: It is best practice not to include all users without exception in your Conditional
    Access policies. This is because you would risk locking yourself out of your cloud
    environment.
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 最佳实践是不在条件访问策略中包括所有用户，除非有例外。因为这样会有锁定自己无法访问云环境的风险。
- en: 'Your organization might enforce your users to proceed through the MFA enrollment
    from their office. That way, your organization can make sure that even if a user''s
    credentials have been leaked, an attacker would need to be within your network
    perimeter to configure MFA. A Conditional Access policy to enforce that might
    be configured like this:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 你的组织可能会要求用户在办公地点完成MFA注册。通过这种方式，组织可以确保即使用户的凭证被泄露，攻击者也需要在你的网络边界内才能配置MFA。强制执行该策略的条件访问策略可以这样配置：
- en: Include all users and exclude privileged roles or a particular user group containing
    administrative accounts.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 包括所有用户，排除特权角色或包含管理员帐户的特定用户组。
- en: Activate the **Register security information** user action.
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用**注册安全信息**用户操作。
- en: Include a selected location that defines your office location.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 包括定义办公位置的选定位置。
- en: Block access.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 阻止访问。
- en: With Conditional Access, you can granularly define when and how access to your
    cloud environment is granted or declined. During the course of this topic, we
    have already touched on Azure AD Identity Protection. Now, let's move on to the
    next section, in which you will learn what Azure AD Identity Protection actually
    is and how you can use it.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 使用条件访问，你可以细化定义何时以及如何授予或拒绝访问云环境。在本节内容中，我们已经介绍了Azure AD身份保护。现在，让我们进入下一部分，你将了解Azure
    AD身份保护到底是什么，以及如何使用它。
- en: Introducing Azure AD Identity Protection
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 引入Azure AD身份保护
- en: As already mentioned, an important goal in terms of security is to make attack
    attempts as expensive as possible for an attacker. That said, it is important
    to raise the bar and have several complementing technologies in place that add
    extra value to your security posture. On the other hand, you want to make sure
    not to block legitimate user authentications so you do not negatively affect your
    users' login experience. Microsoft has been protecting cloud identities for more
    than 10 years now, and with Azure AD Identity Protection, they let you protect
    identities using their protection systems.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，安全方面的一个重要目标是尽可能增加攻击者尝试攻击的成本。换句话说，重要的是提高安全门槛，并采用几种互补的技术，为你的安全防护增加额外的价值。另一方面，你还需要确保不会阻止合法用户的身份验证，以免对用户的登录体验产生负面影响。微软已经保护云端身份超过10年，借助Azure
    AD身份保护系统，他们可以帮助你使用其保护机制来保护身份。
- en: Stealing the credentials of user accounts, even if they are not highly privileged,
    has always been a good way of gaining access to corporate resources. Over the
    years, attackers have learned to leverage third-party breaches or highly sophisticated
    phishing attacks to get hold of corporate credentials. Even if attackers gain
    access to low-privileged user accounts, as soon as they do, it is relatively easy
    for them to elevate their level of privilege or gain access to important corporate
    resources through lateral movement.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 偷窃用户帐户的凭证，即使它们没有很高的权限，仍然是获取公司资源的好方法。多年来，攻击者已经学会了利用第三方泄露或高度复杂的钓鱼攻击来获取公司凭证。即使攻击者获得了低权限的用户帐户，他们也能相对容易地通过横向移动提升权限级别或访问重要的公司资源。
- en: 'So, what we need to do is the following:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们需要做的是以下几步：
- en: Protect all identities at all levels of privilege
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 保护所有级别特权的身份
- en: Prevent compromised identities from accessing corporate resources
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防止被泄露的身份访问企业资源
- en: Now, the second step is the more difficult one because you first need to find
    out whether an identity is compromised. This is when Azure AD Identity Protection
    comes into play.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，第二步更加困难，因为您首先需要弄清楚一个身份是否已经被泄露。这时，Azure AD 身份保护就发挥作用了。
- en: Azure AD Identity Protection at a glance
  id: totrans-204
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Azure AD 身份保护概览
- en: Adaptive machine learning algorithms and heuristics are what Azure AD utilizes
    when determining anomalies and suspicious behavior during the authentication of
    user accounts. With this data, Azure AD Identity Protection can generate reports
    and alerts that enable customers to evaluate recent logons. Furthermore, Azure
    AD Identity Protection can calculate user and sign-in risk levels that can be
    used in risk-based Conditional Access policies. For example, you can decide to
    enforce the usage of MFA when a login attempt's risk level is calculated as medium
    or above, or to block a sign-in attempt based on the risk calculation.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 在确定用户帐户身份验证中的异常和可疑行为时，利用的是自适应机器学习算法和启发式方法。通过这些数据，Azure AD 身份保护可以生成报告和警报，帮助客户评估最近的登录情况。此外，Azure
    AD 身份保护还能计算用户和登录的风险等级，并可用于基于风险的条件访问策略。例如，您可以决定在登录尝试的风险等级被计算为中等或更高时强制使用 MFA，或者基于风险计算来阻止登录尝试。
- en: '![Figure. 3.20 - A sign-in was blocked by Azure AD Identity Protection'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.20 - 一个登录尝试被 Azure AD 身份保护阻止'
- en: '](img/Fig._3.20.jpg)'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.20.jpg)'
- en: Figure. 3.20 - A sign-in was blocked by Azure AD Identity Protection
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.20 - 一个登录尝试被 Azure AD 身份保护阻止
- en: In the preceding screenshot, you see that a sign-in was blocked because the
    user's identity could not be verified. This is because John did not have MFA configured
    before this suspicious sign-in activity was detected. Of course, the person trying
    to log on and being blocked now is not able to configure MFA at this stage because
    that would enable attackers to configure the service according to their needs.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中，您可以看到一个登录尝试被阻止，因为无法验证用户的身份。原因是 John 在此可疑的登录活动被检测到之前没有配置 MFA。当然，现在试图登录并被阻止的人员无法在此阶段配置
    MFA，因为那样会让攻击者根据他们的需求来配置该服务。
- en: '![Figure. 3.21 - Azure AD Identity Protection Overview dashboard'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.21 - Azure AD 身份保护概览仪表盘'
- en: '](img/Fig._3.21.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.21.jpg)'
- en: Figure. 3.21 - Azure AD Identity Protection Overview dashboard
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.21 - Azure AD 身份保护概览仪表盘
- en: Azure AD uses several types of risk detection in realtime (5-10 minutes) and
    offline (2-4 hours). As soon as there has been a risk detection related to an
    account sign-in, this detection is added to a logical concept called *risky sign-ins*.
    A risky sign-in indicates a sign-in attempt that might have been performed by
    an attacker and not the legitimate account owner. Based on those detections, the
    probability that the sign-in has been performed by a bad actor is calculated and
    is reflected in the *sign-in risk level*. You can use the sign-in risk level (**Low**,
    **Medium**, **High**) to define a *sign-in risk policy*. The sign-in risk policy
    is an automated response depending on the specified sign-in risk level that is
    used to either block access to your resources or to require a user to pass an
    MFA challenge before being granted access to your corporate environment.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD 使用多种类型的风险检测，实时检测（5-10 分钟）和离线检测（2-4 小时）。一旦检测到与帐户登录相关的风险，该检测会被添加到一个逻辑概念中，称为
    *高风险登录*。高风险登录表示一个可能是攻击者进行的登录尝试，而非合法帐户所有者的操作。基于这些检测，会计算出登录由恶意行为者执行的概率，并反映在 *登录风险等级*
    中。您可以使用登录风险等级（**低**，**中**，**高**）来定义 *登录风险策略*。登录风险策略是根据指定的登录风险等级自动响应的策略，用来阻止访问您的资源或要求用户在获得访问权限之前通过
    MFA 挑战。
- en: Besides the sign-in risk, Azure AD also detects the probability that a user
    account has been compromised. This behavior is called *user risk detection*. All
    risk detections that have been detected for a user and that have not been resolved
    are known as *active risk detections*. All active risk detections that are associated
    with a user define the user risk. Based on the user risk, Azure AD calculates
    the probability (**Low**, **Medium**, **High**) that the user account has been
    compromised. This probability is known as the *user risk level*. For example,
    if a risky sign-in is detected and the MFA challenge is passed, there is no active
    risk detection for this user. Thus, in this case, the user risk level will stay
    low. You can define a *user risk policy* as an automated response for a specific
    user risk level. With this policy, you can either block access to corporate resources
    or enforce a password change to get the user back to a clean state.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 除了登录风险，Azure AD 还会检测用户账户是否被泄露的可能性。这种行为被称为*用户风险检测*。所有已经检测到并且尚未解决的风险检测都被称为*活动风险检测*。与用户相关的所有活动风险检测定义了该用户的风险。根据用户风险，Azure
    AD 会计算用户账户被泄露的概率（**低**、**中**、**高**）。这个概率被称为*用户风险等级*。例如，如果检测到一个高风险的登录行为，但多重身份验证（MFA）挑战通过，则该用户没有任何活动风险检测。因此，在这种情况下，用户风险等级将保持在低水平。你可以定义一个*用户风险策略*，作为对特定用户风险等级的自动响应。通过此策略，你可以选择阻止访问企业资源，或强制要求用户更改密码，以恢复用户的清洁状态。
- en: Risk detection
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 风险检测
- en: 'In Azure AD, there currently are six different types of risk detection:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure AD 中，目前有六种不同类型的风险检测：
- en: '**Users with leaked credentials:** Leaked credentials occur due to mass credential
    theft by cybercriminals followed by public posting of these credentials, particularly
    on the dark web. Microsoft actively monitors such channels and compares the leaked
    username and password pairings against existing users, and identifies accounts
    that have leaked credentials.'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**凭证泄露的用户：** 凭证泄露是由于网络犯罪分子大规模窃取凭证并公开发布，特别是在暗网上。微软积极监控这些渠道，并将泄露的用户名和密码配对与现有用户进行比较，以识别那些有凭证泄露的账户。'
- en: '**Sign-ins from anonymous IP addresses:** Anonymous IP addresses are used by
    people who want to mask their device''s real IP address. There can be a number
    of reasons that lead to the use of such IP addresses, some of them malicious.
    Microsoft checks incoming sign-ins from IP addresses that have previously been
    identified as anonymous IP addresses.'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**来自匿名 IP 地址的登录：** 匿名 IP 地址是那些希望隐藏设备真实 IP 地址的用户所使用的。使用这些 IP 地址可能有多种原因，其中一些可能具有恶意性质。微软会检查来自先前被识别为匿名
    IP 地址的登录请求。'
- en: '**Impossible travel to atypical locations** are sign-ins from geographically
    distant locations. At least one location needs to be an atypical location based
    on the user''s sign-in behavior. For example, the user is on his or her first
    business trip to the US and logs in from there. In addition to that, the underlying
    machine learning algorithm considers the time between the sign-ins and the time
    it would have taken the user to travel from one location to the other. Microsoft
    tries to ignore obvious false-positives, such as **virtual private networks (VPNs)**
    between locations, or locations that have been known as familiar for other user
    accounts within the same organization. This risk detection type needs 14 days
    of analyzing user behavior before being able to calculate the risk for a user
    account.'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**不可能的旅行到非典型位置** 是指从地理上相距遥远的地点进行的登录。至少一个位置需要是根据用户的登录行为判定的非典型位置。例如，用户第一次去美国出差并从那里登录。除了这一点，底层的机器学习算法还会考虑登录之间的时间，以及用户从一个位置移动到另一个位置所需的时间。微软尽量忽略明显的误报，比如**虚拟专用网络（VPN）**
    连接，或者在同一组织中的其他用户账户所知的熟悉位置。此类风险检测需要 14 天的用户行为分析，才能计算出用户账户的风险。'
- en: '**Sign-ins from infected devices:** This method of risk detection depends on
    Microsoft keeping track of IP addresses that are known to communicate with bot
    servers. Microsoft matches all IP addresses connecting to the service against
    these known rogue IPs to determine whether there are sign-ins from infected devices.
    This type of risk detection also targets simple attack methods such as password
    spray attacks.'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**来自感染设备的登录：** 这种风险检测方法依赖于微软追踪已知与僵尸网络服务器通信的 IP 地址。微软会将所有连接到服务的 IP 地址与这些已知的恶意
    IP 地址进行匹配，以判断是否存在来自感染设备的登录。此类风险检测还会针对简单的攻击方法，如密码喷射攻击。'
- en: '**Sign-ins from IP addresses with suspicious activity:** In this method of
    detection, Microsoft examines IPs for signs of suspicious activity. The main indicator
    is when an IP address has a large number of failed sign-ins in a relatively short
    period of time. This can be an indication of a bad actor who is trying to guess
    passwords using simple attack methods such as brute-force or password spray attacks.'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**来自具有可疑活动的 IP 地址的登录：** 在这种检测方法中，微软会检查 IP 地址是否存在可疑活动。主要的指示器是 IP 地址在相对短的时间内发生大量失败的登录尝试。这可能表明一个不良行为者正在尝试通过暴力破解或密码喷洒等简单攻击方法猜测密码。'
- en: '**Sign-ins from unfamiliar locations:** This method of risk detection involves
    Microsoft maintaining a historical record of the IP addresses used by users regularly.
    The system detects whether a request is coming from an IP address that has not
    been used before. The system needs at least 30 days to create a useable history
    of familiar and unfamiliar locations.'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**来自不熟悉位置的登录：** 这种风险检测方法涉及微软维护一个用户常用 IP 地址的历史记录。系统会检测请求是否来自一个以前未曾使用过的 IP 地址。系统至少需要
    30 天的时间来创建一个可用的熟悉与不熟悉位置的历史记录。'
- en: Creating a sign-in risk or user risk policy
  id: totrans-223
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建登录风险或用户风险策略
- en: Policy creation is the easiest part of Azure AD Conditional Access. In order
    to create a sign-in risk policy, you just need to navigate to **Azure AD Identity
    Protection** -> **Sign-in risk policy** in the Azure portal. There, you define
    conditions (**Sign-in risk** level - **Low** and above, **Medium** and above,
    or **High**), access controls (block access or challenge the user with MFA), and
    select for which user or group you want to enable the policy. That's it.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 策略创建是 Azure AD 条件访问中最简单的部分。要创建登录风险策略，您只需在 Azure 门户中导航至**Azure AD 身份保护** -> **登录风险策略**。在这里，您定义条件（**登录风险**级别
    - **低**及以上、**中**及以上或**高**），访问控制（阻止访问或使用 MFA 挑战用户），并选择启用策略的用户或组。就这么简单。
- en: '![Figure. 3.22 - Creating a sign-in risk policy'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.22 - 创建登录风险策略'
- en: '](img/Fig._3.22.jpg)'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.22.jpg)'
- en: Figure. 3.22 - Creating a sign-in risk policy
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.22 - 创建登录风险策略
- en: For a new user risk policy, you navigate to **Azure AD Identity Protection**
    -> **User risk policy** and define the respective parameters. The difference from
    a sign-in risk policy is that you can either block access or enforce a password
    change for a risky user.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 对于新的用户风险策略，您可以导航至**Azure AD 身份保护** -> **用户风险策略**并定义相应的参数。与登录风险策略的不同之处在于，您可以选择阻止访问或强制风险用户更改密码。
- en: '![Figure. 3.23 - Creating a user risk policy'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.23 - 创建用户风险策略'
- en: '](img/Fig._3.23.jpg)'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.23.jpg)'
- en: Figure. 3.23 - Creating a user risk policy
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.23 - 创建用户风险策略
- en: Now you know how Azure AD Identity Protection works and how you can use calculated
    user and sign-in risk levels to protect your accounts. Now, we will move forward
    and focus on privileged user accounts.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经了解了 Azure AD 身份保护的工作原理以及如何使用计算出的用户和登录风险级别来保护您的帐户。接下来，我们将继续关注特权用户帐户。
- en: Understanding RBAC
  id: totrans-233
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解 RBAC
- en: In [*Chapter 2*](B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038), *Governance
    and Security*, we mentioned security principles such as segregation of duties
    and the principle of least privilege. With RBAC, we have the technical feature
    to implement these principles in Azure AD. RBAC is the way to manage access to
    all Azure resources, but also to Azure AD and Office 365.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [*第二章*](B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038) *治理与安全性* 中，我们提到了安全原则，如职务分离和最小特权原则。通过
    RBAC，我们拥有了在 Azure AD 中实施这些原则的技术特性。RBAC 是管理所有 Azure 资源访问的方式，也包括 Azure AD 和 Office
    365 的访问管理。
- en: 'As already discussed, Azure offers several levels of scope that can be used
    to grant access rights to accounts. Furthermore, there are several roles, such
    as **Owner**, **Azure Sentinel Contributor**, or **Reader**, as can be seen in
    the following screenshot:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Azure 提供了几个作用域级别，可以用于授予帐户的访问权限。此外，还有若干角色，如**所有者**、**Azure Sentinel 贡献者**或**阅读者**，如下图所示：
- en: '![Figure. 3.24 - RBAC role assignment in Microsoft Azure'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.24 - Microsoft Azure 中的 RBAC 角色分配'
- en: '](img/Fig._3.24.jpg)'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.24.jpg)'
- en: Figure. 3.24 - RBAC role assignment in Microsoft Azure
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.24 - Microsoft Azure 中的 RBAC 角色分配
- en: 'You need three different entities to create a role assignment:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 创建角色分配需要三个不同的实体：
- en: A security principal, which can be either one of users, groups, or service principals.
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全主体，可以是用户、组或服务主体中的任意一个。
- en: A role, which describes a set of management rights. For example, the contributor
    role contains all actions, except authorization-related rights. So, a contributor
    may manage all aspects at a given scope without being able to grant access to
    resources.
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个角色，描述了一组管理权限。例如，贡献者角色包含所有操作，除了与授权相关的权限。因此，贡献者可以管理给定范围内的所有方面，而无需授予访问资源的权限。
- en: A scope to set the access rights, starting from the management group level down
    to single resources.
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个设置访问权限的范围，从管理组级别到单个资源。
- en: If those three come together, this is what we call an RBAC role assignment.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这三者结合起来，这就是我们所说的 RBAC 角色分配。
- en: Important Note
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You need to be granted `Microsoft.Authorization/roleAssignments/write` and `Microsoft.Authorization/roleAssignments/delete`
    rights in order to be able to create or delete role assignments. These rights
    are, by default, granted to the RBAC roles User Access Administrator and Owner.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要被授予 `Microsoft.Authorization/roleAssignments/write` 和 `Microsoft.Authorization/roleAssignments/delete`
    权限，才能创建或删除角色分配。默认情况下，这些权限会授予 RBAC 角色“用户访问管理员”和“所有者”。
- en: You can edit role assignments at all management scopes of Azure. It is important
    to know that role assignments are inherited top to bottom. This means that if
    you configure a role assignment at a resource group level, the access rights are
    also valid on all resources within this particular resource group; and if you
    configure a role assignment at a management group level, it is inherited to all
    subscriptions, resource groups, and resources within that scope.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 Azure 的所有管理范围内编辑角色分配。需要注意的是，角色分配是从上到下继承的。这意味着，如果你在资源组级别配置角色分配，则该访问权限也适用于该资源组中的所有资源；如果你在管理组级别配置角色分配，则它会被继承到该范围内的所有订阅、资源组和资源。
- en: In the Azure portal, there is the **Access Control (IAM)** blade that is used
    to manage all aspects of RBAC. You can check access for particular accounts, find
    out explicit and inherited roles and deny assignments, and find out which built-in
    or custom roles exist for the given scope.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure 门户中，有一个**访问控制（IAM）**面板，用于管理 RBAC 的各个方面。你可以检查特定帐户的访问权限，了解显式和继承的角色以及拒绝分配，并查看给定范围内存在的内置或自定义角色。
- en: '![Figure. 3.25 - RBAC management blade in the Azure portal'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.25 - Azure 门户中的 RBAC 管理面板](img/Fig._3.25.jpg)'
- en: '](img/Fig._3.25.jpg)'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.25.jpg)'
- en: Figure. 3.25 - RBAC management blade in the Azure portal
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.25 - Azure 门户中的 RBAC 管理面板
- en: To create a new role assignment, you need to click **+ Add** and then select
    **Add role assignment**.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建新的角色分配，你需要点击**+ 添加**，然后选择**添加角色分配**。
- en: '![Figure. 3.26 - Adding a role assignment'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.26 - 添加角色分配](img/Fig._3.26.jpg)'
- en: '](img/Fig._3.26.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.26.jpg)'
- en: Figure. 3.26 - Adding a role assignment
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.26 - 添加角色分配
- en: You then select the role and security principal you want to grant access, and
    then save your selection. Done.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 然后选择你想要授予访问权限的角色和安全主体，并保存你的选择。完成。
- en: RBAC is pretty straightforward to implement, but can be way more challenging
    when planning for access rights in your environment. This is why you should already
    plan for RBAC roles when defining your governance concept.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 实施 RBAC 是相当直接的，但在规划你环境中的访问权限时可能会变得更加具有挑战性。这就是为什么在定义治理概念时你应该提前规划 RBAC 角色。
- en: Important Note
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Define the RBAC roles you need in your environment when creating your governance
    concept. Doing so, you will have a good overview of which access rights (roles)
    you need and who (which security principal) you need to grant access to. That
    said, it will be much easier to create your role assignments later.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建治理概念时，定义你在环境中需要的 RBAC 角色。这样，你将对需要哪些访问权限（角色）以及需要授予谁（哪个安全主体）访问权限有一个清晰的了解。这样，稍后创建角色分配时会更容易。
- en: In the following section, we will show you how to create custom RBAC roles so
    you can more granularly use roles according to your needs.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的部分中，我们将展示如何创建自定义的 RBAC 角色，以便你可以根据需要更细粒度地使用角色。
- en: Creating custom RBAC roles
  id: totrans-260
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建自定义 RBAC 角色
- en: 'Custom RBAC roles are used whenever built-in roles do not entirely fit your
    company''s needs regarding access rights to your cloud environments. As mentioned
    before, a role is basically a set of management rights that then are applied to
    users or groups in a role assignment. There is a difference between *custom Azure
    AD RBAC roles* and *custom RBAC roles for Azure resources*. If you want to create
    a custom Azure AD RBAC role, you need to go through the following steps:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 当内置角色不能完全满足贵公司在云环境访问权限方面的需求时，便需要使用自定义RBAC角色。如前所述，角色基本上是一组管理权限，然后应用到用户或组的角色分配中。*自定义Azure
    AD RBAC角色*和*自定义Azure资源RBAC角色*之间存在差异。如果您想创建一个自定义的Azure AD RBAC角色，您需要遵循以下步骤：
- en: Navigate to **Azure Active Directory** -> **Roles and administrators** and then
    click the + **New custom role** button in the Azure portal, as shown in the following
    screenshot:![Figure. 3.27 - Creating a new custom role
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**Azure Active Directory** -> **角色和管理员**，然后点击Azure门户中的+**新建自定义角色**按钮，如以下截图所示：![图
    3.27 - 创建新的自定义角色
- en: '](img/Fig._3.27.jpg)'
  id: totrans-263
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Fig._3.27.jpg)'
- en: Figure. 3.27 - Creating a new custom role
  id: totrans-264
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 3.27 - 创建新的自定义角色
- en: Enter a **Name** and, optionally, a **Description** for your custom role. You
    can decide either to **Start from scratch**, or to **Clone from a custom role**
    to continue with your custom role creation. In the following example, we decide
    to **Start from scratch**:![Figure. 3.28 - Defining basic information
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入**名称**，并可选择性地为您的自定义角色输入**描述**。您可以选择**从头开始**，或选择**从自定义角色克隆**来继续创建您的自定义角色。在以下示例中，我们选择了**从头开始**：![图
    3.28 - 定义基本信息
- en: '](img/Fig._3.28.jpg)'
  id: totrans-266
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Fig._3.28.jpg)'
- en: Figure. 3.28 - Defining basic information
  id: totrans-267
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 3.28 - 定义基本信息
- en: On the **Permissions** tab, you select all permissions that you later want to
    grant to your identity.
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**权限**选项卡上，选择您以后希望授予身份的所有权限。
- en: 'On the **Review + create** tab, you can finally confirm your settings, and
    by clicking the **Create** button, your custom Azure AD RBAC role is created,
    as illustrated in the following screenshot:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**查看 + 创建**选项卡上，您可以最终确认您的设置，点击**创建**按钮后，您的自定义Azure AD RBAC角色就会创建，如以下截图所示：
- en: '![Figure. 3.29 - Reviewing and creating your custom Azure AD RBAC role'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.29 - 审查并创建您的自定义Azure AD RBAC角色'
- en: '](img/Fig._3.29.jpg)'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.29.jpg)'
- en: Figure. 3.29 - Reviewing and creating your custom Azure AD RBAC role
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.29 - 审查并创建您的自定义Azure AD RBAC角色
- en: The creation of custom RBAC roles for Azure resources cannot be done in the
    Azure portal. You need to use PowerShell, the Azure **command-line interface (CLI),**
    or the Azure **representational state transfer (REST)** API. In this example,
    we will create a custom RBAC role with PowerShell.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: Azure资源的自定义RBAC角色不能通过Azure门户进行创建。您需要使用PowerShell、Azure**命令行界面(CLI)**或Azure**表述性状态传输(REST)**API。在本示例中，我们将通过PowerShell创建一个自定义RBAC角色。
- en: 'To create a custom RBAC role, you need to define which resource operations
    per resource provider have to be allowed to meet your goals. Therefore, you should
    initially find out which resource provider operations exist. You can do so by
    using the `Get-AzProviderOperation` cmdlet, as shown in the following code block:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建自定义的RBAC角色，您需要定义哪些资源提供程序的资源操作必须被允许，以满足您的目标。因此，您应该首先了解有哪些资源提供程序操作。您可以通过使用`Get-AzProviderOperation`
    cmdlet来实现，如以下代码块所示：
- en: '[PRE0]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'For example, if you want to find all resource provider operations for the `Microsoft.Compute/VirtualMachines/*`
    resource provider, the command and the result could look like this:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您想查找`Microsoft.Compute/VirtualMachines/*`资源提供程序的所有资源操作，命令和结果可能如下所示：
- en: '![Figure. 3.30 - Resource provider operations for Azure VMs'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.30 - Azure虚拟机的资源提供程序操作'
- en: '](img/Fig._3.30.jpg)'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.30.jpg)'
- en: Figure. 3.30 - Resource provider operations for Azure VMs
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.30 - Azure虚拟机的资源提供程序操作
- en: 'The resource provider operations that are listed in the preceding screenshot
    are all actions related to **virtual machines (VMs)** to which you can grant access
    to users, groups, or service principals. If you want to know which resource provider
    operations are tied to a specific RBAC role, you can find this out with the following
    command:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 前述截图中列出的资源提供程序操作都是与**虚拟机(VM)**相关的操作，您可以将这些操作的访问权限授予用户、组或服务主体。如果您想了解某个特定RBAC角色绑定了哪些资源提供程序操作，您可以使用以下命令来查询：
- en: '[PRE1]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'For example, if you want to know which actions are allowed for the Virtual
    Machine Contributor RBAC role, the command would be as follows:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您想了解虚拟机贡献者RBAC角色允许哪些操作，命令如下：
- en: '[PRE2]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: When you know which resource provider operations exist, you can start creating
    your custom RBAC role. Again, you can start by creating a new role from scratch
    or by using an existing role as a template to alter according to your needs. You
    will find examples for creating custom RBAC roles for Azure resources in the GitHub
    repository belonging to this book.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 当你知道存在哪些资源提供者操作时，你可以开始创建自定义 RBAC 角色。你可以从头开始创建新角色，或者使用现有角色作为模板，根据你的需要进行修改。你将会在本书的
    GitHub 仓库中找到有关为 Azure 资源创建自定义 RBAC 角色的示例。
- en: Now that you have learned what RBAC is and how you can leverage it, we will
    give you an introduction to **Azure AD Privileged Identity Management** (**Azure
    AD PIM**), another service focused on protecting privileged user accounts. Let's
    move on!
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经了解了 RBAC 及如何利用它，我们将为你介绍另一项服务——**Azure AD 特权身份管理**（**Azure AD PIM**），这项服务专注于保护特权用户账户。让我们继续吧！
- en: Protecting admin accounts with Azure AD PIM
  id: totrans-286
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Azure AD PIM 保护管理员账户
- en: In [*Chapter 2*](B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038)*, Governance
    and Security*, we discussed the fact that we often see customer environments in
    which administrators have a huge set of privileges they do not necessarily need.
    We also discussed **Separation of Duties** (**SoD**) and the fact that no one
    should have more privileges than ever needed for doing a particular job. Now,
    what if you could even reduce that set of access rights to a particular point
    in time or time range? Or what if you need an approval process for granting privileged
    access? Maybe you want to monitor the usage of privileged roles or want to decide
    whether a person still needs privileged access rights?
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [*第2章*](B15414_02_Final_JM_ePub.xhtml#_idTextAnchor038)*，《治理与安全》*中，我们讨论了我们经常看到的客户环境，其中管理员拥有大量他们不一定需要的特权。我们还讨论了**职责分离**（**SoD**）以及任何人都不应该拥有超过完成特定工作所需的权限。现在，如果你能将这一权限集缩减到某一特定时间点或时间范围呢？或者，如果你需要批准流程来授予特权访问权限呢？也许你想监控特权角色的使用情况，或者想决定某个人是否仍然需要特权访问权限？
- en: 'Azure AD PIM is a service that offers several features that help you further
    protect privileged accounts, some of which are the following:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD PIM 是一项服务，提供多个功能，帮助你进一步保护特权账户，其中一些功能包括：
- en: '**Just-in-time** and **time-bound** privileged access'
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**即时**和**时间限制**的特权访问'
- en: '**Approval** to activate privileged roles'
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**批准**以激活特权角色'
- en: '**Access reviews** to ensure that roles are still needed'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**访问审查**以确保角色仍然需要'
- en: Enforcing **MFA** for role activation
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 强制实施**多重身份验证（MFA）**以激活角色
- en: With Azure AD PIM, you can—but do not need to—infinitely grant access rights
    to privileged users; you make them "eligible" for requesting access rights. So,
    users are only granted access rights when they really need them. Access can be
    either approved automatically after a user requests access or by manual approval.
    The nice thing is, you can cover both Azure AD and Azure resource roles with Azure
    AD PIM.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Azure AD PIM，你可以——但不必——无限期地授予特权用户访问权限；你只需要将他们设置为“有资格”申请访问权限。因此，用户只有在真正需要时才会被授予访问权限。访问权限可以在用户请求访问后自动批准，或者通过手动批准。一个好的地方是，你可以通过
    Azure AD PIM 管理 Azure AD 和 Azure 资源角色。
- en: Tip
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: Make sure you have enforced the principle of least privilege in your organization
    before starting with PIM.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始使用 PIM 之前，确保你在组织中已经实施了最小特权原则。
- en: Enabling PIM
  id: totrans-296
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启用 PIM
- en: 'Before using PIM, you have to enable the service for your directory. You can
    do so by signing in to the Azure portal as a Global Administrator of your directory
    and then navigating to **Azure AD Privileged Identity Management**. Once there,
    you will find the option **Consent to PIM**, as shown in the following screenshot:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用 PIM 之前，你必须为你的目录启用此服务。你可以通过以目录的全局管理员身份登录 Azure 门户，然后导航到 **Azure AD 特权身份管理**
    来执行此操作。进入后，你将看到**同意 PIM**选项，如下图所示：
- en: '![Figure. 3.31 - Consenting to PIM'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.31 - 同意 PIM'
- en: '](img/Fig._3.31.jpg)'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.31.jpg)'
- en: Figure. 3.31 - Consenting to PIM
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.31 - 同意 PIM
- en: 'You then click on **Verify my identity** to verify your identity with MFA.
    If you haven''t already done so, you will be asked to activate MFA for your account,
    as covered in the *Understanding Multi-factor Authentication (MFA)* section in
    this chapter. Once your identity has been verified, you can click the **Consent**
    button and confirm the dialog by clicking **Yes**, as shown in the following screenshot:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 然后点击**验证我的身份**以通过 MFA 验证身份。如果你还没有这么做，你将被要求为你的账户启用 MFA，如本章的*了解多因素认证（MFA）*部分所述。身份验证完成后，你可以点击**同意**按钮，并点击**是**以确认对话框，如下图所示：
- en: '![Figure. 3.32 - Confirming PIM consent'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.32 - 确认 PIM 同意'
- en: '](img/Fig._3.32.jpg)'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.32.jpg)'
- en: Figure. 3.32 - Confirming PIM consent
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.32 - 确认 PIM 同意
- en: Now that you have activated PIM for your directory, you need to sign up to PIM
    to manage your Azure AD roles. You do so by navigating to the **Azure AD roles**
    section of the Azure AD PIM dashboard and clicking on **sign up**. Once sign-up
    completes, the Azure AD options will be enabled.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经为目录启用了 PIM，你需要注册 PIM 来管理你的 Azure AD 角色。你可以通过导航到 Azure AD PIM 仪表板的**Azure
    AD 角色**部分并点击**注册**来完成注册。一旦注册完成，Azure AD 选项将被启用。
- en: Managing Azure AD roles in PIM
  id: totrans-306
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 管理 Azure AD 角色在 PIM 中
- en: 'In the **Azure AD roles** view, you can manage PIM behavior for all Azure AD
    roles and also have access to Azure AD role-related tasks such as access reviews,
    approvals, or your own roles and access requests, as shown in the following screenshot:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 在**Azure AD 角色**视图中，你可以管理所有 Azure AD 角色的 PIM 行为，还可以访问与 Azure AD 角色相关的任务，如访问审查、批准或你自己的角色和访问请求，如下图所示：
- en: '![Figure. 3.33 - Azure AD role management in PIM'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.33 - 在 PIM 中管理 Azure AD 角色'
- en: '](img/Fig._3.33.jpg)'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.33.jpg)'
- en: Figure. 3.33 - Azure AD role management in PIM
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.33 - 在 PIM 中管理 Azure AD 角色
- en: The **Manage** section offers all the Azure AD PIM configuration options for
    your Azure AD directory. **Roles** gives you an overview of all Azure AD roles
    and enables you to add members to a particular role. In the **Members** section,
    you get an overview about all accounts that are either eligible or permanent members
    of privileged roles. It is an at-a-glance view of all users that have elevated
    rights in your directory. The **Alerts** section shows you issues to review. For
    example, you will get an overview of administrators that are not using their privileged
    roles (and therefore can be unassigned). You can also create regular **Access
    reviews** to determine whether particular accounts still need to be role members.
    In the respective section, you find a configuration wizard to create these recurring
    reviews. The **Wizard** in the respective section leads you through a process
    to convert users with existing permanent role assignments into eligible users.
    Finally, in **Settings**, you can configure global settings for Azure AD roles,
    alerts, and access reviews.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: '**管理**部分提供了所有 Azure AD PIM 配置选项，用于管理你的 Azure AD 目录。**角色**部分让你可以查看所有 Azure AD
    角色，并使你能够将成员添加到特定角色中。在**成员**部分，你可以看到所有符合条件或是永久成员的特权角色账户概览。这是一个快速查看你目录中所有具有提升权限用户的视图。**警报**部分展示了需要审查的问题。例如，你会看到没有使用其特权角色的管理员（因此可以取消分配）。你还可以创建定期的**访问审查**，以确定特定账户是否仍然需要成为角色成员。在相应的部分，你可以找到一个配置向导来创建这些定期审查。相应部分中的**向导**会引导你完成一个过程，将已有永久角色分配的用户转为符合条件的用户。最后，在**设置**中，你可以为
    Azure AD 角色、警报和访问审查配置全局设置。'
- en: Tip
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: You can require approval for a role activation. This requirement is a setting
    that comes with the role, not with the user account. That said, when you configure
    this requirement, it is valid for all users that are eligible to request access
    for this particular role.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以要求对角色激活进行批准。此要求是角色的设置，而不是用户账户的设置。也就是说，当你配置此要求时，它适用于所有有资格申请访问此特定角色的用户。
- en: 'Once an account is made eligible, its owner needs to request access before
    conducting a task. Let''s walk through an example: John works in the helpdesk
    team and this team is responsible for managing user accounts. Therefore, we make
    John''s account eligible for the *User Administrator* role. When John signs in
    to the Azure portal and then wants to manage user settings in Azure AD, he will
    only be able to see what usual user accounts are able to see; he won''t be able
    to manage any accounts. So, John navigates to the Azure AD PIM dashboard and sees
    that he needs to activate his role first.'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦一个账户被标记为合格，它的拥有者需要在执行任务之前请求访问。我们来举个例子：John 在帮助台团队工作，这个团队负责管理用户账户。因此，我们将 John
    的账户标记为 *用户管理员* 角色。当 John 登录到 Azure 门户并想要管理 Azure AD 中的用户设置时，他将只能看到普通用户账户能够看到的内容；他无法管理任何账户。于是，John
    导航到 Azure AD PIM 仪表板，看到自己需要先激活角色。
- en: '![Figure. 3.34 - Eligible roles for a user'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.34 - 用户可选角色'
- en: '](img/Fig._3.34.jpg)'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.34.jpg)'
- en: Figure. 3.34 - Eligible roles for a user
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.34 - 用户可选角色
- en: 'John can activate the role for the time that you configured before in the `1`
    hour only. In addition to that, we have enforced entering a justification that
    later can be reviewed in the audit history:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: John 可以在之前配置的 `1` 小时内激活角色。除此之外，我们还强制要求输入一个理由，之后可以在审计历史中查看：
- en: '![Figure. 3.35 - Activating a role'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.35 - 激活角色'
- en: '](img/Fig._3.35.jpg)'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.35.jpg)'
- en: Figure. 3.35 - Activating a role
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.35 - 激活角色
- en: John could also set a custom activation start time. For example, when John knows
    that he will need access later that day, he could manually set an activation time
    in the future. With a click on **Activate**, an activation request is submitted
    and validated once the activation is done. Then, after signing out and logging
    back in, John will have role membership in User Administrators for 1 hour.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: John 还可以设置自定义激活开始时间。例如，当 John 知道他当天稍后需要访问时，他可以手动设置未来的激活时间。点击 **激活** 后，会提交一个激活请求，并在激活完成后进行验证。然后，John
    登出并重新登录后，他将拥有用户管理员角色，持续 1 小时。
- en: '![Figure. 3.36 - Successful role activation'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.36 - 成功激活角色'
- en: '](img/Fig._3.36.jpg)'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.36.jpg)'
- en: Figure. 3.36 - Successful role activation
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.36 - 成功激活角色
- en: So, the process for the user is straightforward. Request access; log out and
    back in again; and then do the job. Of course, every activation request is logged,
    as well as every configuration change a user does when having elevated rights.
    As already mentioned, monitoring is essential, and so there's no way around it.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，用户的流程非常简单。请求访问；登出并重新登录；然后开始工作。当然，每个激活请求都会被记录，同时每个用户在拥有提升权限时进行的配置更改也会被记录。如前所述，监控至关重要，因此没有办法绕过它。
- en: Managing Azure resources with PIM
  id: totrans-327
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 PIM 管理 Azure 资源
- en: 'You can not only use PIM for managing Azure AD roles but also for Azure resource
    management based on RBAC. You first need to onboard Azure subscriptions to PIM
    so that you can use it to manage resource-based access rights. To do so, you navigate
    to **Azure resources** on the Azure AD PIM dashboard and select **Discover resources**.
    You then filter for unmanaged resources and select **Manage resource**, as illustrated
    in the following screenshot:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 你不仅可以使用 PIM 来管理 Azure AD 角色，还可以基于 RBAC 管理 Azure 资源。你首先需要将 Azure 订阅加入 PIM，才能使用它来管理基于资源的访问权限。为此，你需要在
    Azure AD PIM 仪表板中导航到 **Azure 资源**，然后选择 **发现资源**。接着，你过滤出未管理的资源，并选择 **管理资源**，如下面的截图所示：
- en: '![Figure. 3.37 - Onboarding an Azure subscription to PIM'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.37 - 将 Azure 订阅加入 PIM'
- en: '](img/Fig._3.37.jpg)'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.37.jpg)'
- en: Figure. 3.37 - Onboarding an Azure subscription to PIM
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.37 - 将 Azure 订阅加入 PIM
- en: You can also select a **Management** group to onboard to PIM. PIM will automatically
    manage role assignments for all child resources within the given scope after onboarding.
    The configuration options are similar to the ones for Azure AD management with
    PIM. One difference is that you need to enter a start and an end date for the
    role assignment. After the end date, the user will no longer be eligible for requesting
    access. The maximum is a time frame of 1 year.
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以选择一个**管理**组来加入 PIM。PIM 在加入后会自动管理所选范围内所有子资源的角色分配。配置选项与 Azure AD 管理的 PIM 相似。唯一的区别是，你需要输入角色分配的开始和结束日期。结束日期后，用户将无法再请求访问。最大时长为
    1 年。
- en: Let's take an example. In his role as project owner for the Mastering Azure
    Security project, John needs to manage all resources within a particular resource
    group that has been created for this project. However, he should not be able to
    give other users or groups access to that resource group so access to the Contributor
    role should be the right one for him.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 举个例子。在作为“Mastering Azure Security”项目的项目负责人时，John 需要管理为此项目创建的特定资源组中的所有资源。然而，他不应该能够将其他用户或组的访问权限授予该资源组，因此，访问“贡献者”角色将是最合适的选择。
- en: '![Figure. 3.38 - John is a member of the Contributor role via PIM'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.38 - John 通过 PIM 成为贡献者角色成员'
- en: '](img/Fig._3.38.jpg)'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.38.jpg)'
- en: Figure. 3.38 - John is a member of the Contributor role via PIM
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.38 - John 通过 PIM 成为贡献者角色成员
- en: If John logs in to the Azure portal, he won't be able to see any resources or
    resource groups because he has no permanent access rights to Azure resources.
    Again, he navigates to the Azure AD PIM dashboard, selects Azure resources, and
    then activates his role. After logging out and signing in again, John is able
    to manage his resources in the **MasteringAzSec** resource group.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 John 登录到 Azure 门户，他将看不到任何资源或资源组，因为他没有对 Azure 资源的永久访问权限。然后，他再次导航到 Azure AD
    PIM 仪表板，选择 Azure 资源，激活他的角色。注销后重新登录，John 就能够管理他在**MasteringAzSec**资源组中的资源。
- en: Tip
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: PIM always activates roles for 1 or several hours, even if access is only needed
    for 10 minutes. Therefore, users can find an option to deactivate roles after
    they have finished their tasks by navigating to **My roles** and then **Active
    roles** in both the **Azure AD roles** and the **Azure resources** sections.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: PIM 总是将角色激活 1 小时或更长时间，即使访问仅需要 10 分钟。因此，用户可以找到一个选项，在完成任务后通过导航到**我的角色**，然后在**Azure
    AD 角色**和**Azure 资源**部分的**活动角色**中停用角色。
- en: You have now learned how to further reduce your privileged accounts' attack
    surfaces by using Azure AD PIM.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您已经学习了如何通过使用 Azure AD PIM 进一步减少特权帐户的攻击面。
- en: Hybrid authentication and SSO
  id: totrans-341
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 混合身份验证和单一登录（SSO）
- en: Organizations have come a long way from an on-premises IT infrastructure since
    they started to roll out cloud-based **Software as a Service (SaaS**) applications
    such as Microsoft Office 365\. Users usually do not want to keep track of several
    accounts and, as they already have a corporate account based on Windows Server
    AD, they usually want to also use that account for cloud-based authentications.
    Now, this is when Azure AD Connect comes into play.
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 组织在从本地 IT 基础设施转向基于云的**软件即服务（SaaS）**应用程序（如 Microsoft Office 365）时，已经走了很长一段路。用户通常不想跟踪多个帐户，因为他们已经拥有基于
    Windows Server AD 的公司帐户，并且通常希望也能将该帐户用于基于云的身份验证。这时，Azure AD Connect 就发挥了作用。
- en: Azure AD Connect is a directory replication service that helps you to synchronize
    existing user accounts from an on-premises Windows Server AD with Azure AD. This
    is a mandatory step because you can only grant access rights and licenses to cloud-based
    identities in Azure AD, not to on-premises accounts.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD Connect 是一个目录复制服务，帮助您将现有的本地 Windows Server AD 用户帐户与 Azure AD 同步。这是一个必要步骤，因为您只能为
    Azure AD 中的云身份授予访问权限和许可证，而不能为本地帐户授予。
- en: 'With Azure AD Connect, you have several options to provide a single sign-on
    experience to your users. In the following diagram, you can see a decision tree
    that helps you to decide which of them is the best for your organization:'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Azure AD Connect，您可以提供多种选项来为用户提供单一登录体验。在下图中，您可以看到一个决策树，帮助您决定哪种方式最适合您的组织：
- en: '![Figure. 3.39 - Azure AD Connect authentication decision tree'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.39 - Azure AD Connect 身份验证决策树'
- en: '](img/Fig._3.39.jpg)'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.39.jpg)'
- en: Figure. 3.39 - Azure AD Connect authentication decision tree
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.39 - Azure AD Connect 身份验证决策树
- en: '**Password Hash Sync + Seamless SSO** is the easiest way to go. With this,
    your on-premises password hashes are replicated to the corresponding cloud identities,
    so users can use the same usernames and passwords across all login environments.
    Seamless SSO eliminates unnecessary login prompts when users are signed in.'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: '**密码哈希同步 + 无缝单一登录（SSO）**是最简单的方法。通过此方法，本地的密码哈希将被复制到相应的云身份中，因此用户可以在所有登录环境中使用相同的用户名和密码。无缝
    SSO 可以消除用户登录时不必要的提示。'
- en: If you have stronger requirements, such as user-level AD security policies that
    should be enforced during sign-in, you can go with **Pass-through Auth + Seamless
    SSO**. In this scenario, you install a software agent on one or more on-premises
    servers. These servers can validate your user credentials directly against your
    on-premises domain controllers by building up a secure tunnel through which cloud-based
    logons can be validated.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有更强的要求，例如在登录时应强制执行的用户级 AD 安全策略，你可以选择 **Pass-through Auth + Seamless SSO**。在此方案中，你需要在一个或多个本地服务器上安装软件代理。这些服务器可以通过建立一个安全隧道，直接验证用户凭证，进而实现基于云的登录验证。
- en: '**Federation** with **Active Directory Federation Services (AD FS)** or another
    federation service is the most complex authentication method. It should be used
    in scenarios where sign-in features are not natively supported by Azure AD. These
    features include the following:'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: '**与 Active Directory 联邦服务（AD FS）** 或其他联邦服务的**联邦身份验证**是最复杂的身份验证方法。它应在 Azure
    AD 原生不支持登录功能的场景中使用。这些功能包括以下内容：'
- en: Sign-in using smartcards or certificates.
  id: totrans-351
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用智能卡或证书进行登录。
- en: Sign-in using an on-premises MFA server.
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用本地 MFA 服务器进行登录。
- en: Sign-in using a third-party authentication solution.
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用第三方身份验证解决方案进行登录。
- en: Multi-site on-premises authentication solutions.
  id: totrans-354
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多站点本地身份验证解决方案。
- en: Tip
  id: totrans-355
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 提示
- en: We recommend always enabling password hash synchronization in Azure AD Connect.
    Doing so, you have a fallback scenario in case your on-premises authentication
    platform is not working properly, and you can use Azure AD Identity Protection
    to get leaked credential reports. Furthermore, you can enable **self-service password
    reset** (**SSPR**) when password hash synchronization is enabled.
  id: totrans-356
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们建议始终在 Azure AD Connect 中启用密码哈希同步。通过这样做，当你的本地身份验证平台无法正常工作时，你将有一个备用方案，并且可以使用
    Azure AD Identity Protection 获取泄露凭证报告。此外，当启用密码哈希同步时，你可以启用 **自助密码重置**（**SSPR**）。
- en: With SSPR, you can effectively reduce both users' non-effective time and support
    efforts for your helpdesk team. SSPR provides users with an effective means to
    unblock their corporate accounts if they forget their passwords. In order to use
    SSPR, users must provide a secondary authentication method. When they lose access
    to their corporate password, users need to verify their previously registered
    alternate authentication method to prove their identity. After that, the user
    can enter a new password. If it is a hybrid user account, meaning an account that
    is replicated by Azure AD Connect, the new password is written back to the on-premises
    Active Directory. The feature you need to enable in Azure AD Connect in this case
    is called *password writeback*.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 SSPR，可以有效减少用户的非工作时间和帮助台团队的支持工作量。SSPR 为用户提供了一个有效的手段，如果他们忘记密码，可以解锁他们的公司账户。为了使用
    SSPR，用户必须提供一种二次身份验证方法。当他们失去对公司密码的访问权限时，用户需要验证他们之前注册的备用身份验证方法以证明身份。之后，用户可以输入新密码。如果这是一个混合用户账户，意味着该账户通过
    Azure AD Connect 进行了复制，则新密码将被写回到本地 Active Directory。在这种情况下，你需要在 Azure AD Connect
    中启用的功能是 *密码回写*。
- en: Currently, there is a preview for the combined registration of SSPR and MFA
    that offers you a new experience for your users' security registration.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 当前，SSPR 和 MFA 的联合注册提供了一个新的用户安全注册体验，正在预览阶段。
- en: '![Figure. 3.40 - Combined registration for SSPR and MFA'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.40 - SSPR 和 MFA 的联合注册'
- en: '](img/Fig._3.40.jpg)'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.40.jpg)'
- en: Figure. 3.40 - Combined registration for SSPR and MFA
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.40 - SSPR 和 MFA 的联合注册
- en: 'Today, you can enable it for your Azure AD tenant by navigating to **Azure
    Active Directory** -> **User Settings** -> **Manage User Feature Preview Settings**.
    You can enable the preview features for all users or a selected group, as shown
    in the following screenshot:'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 今天，你可以通过导航至 **Azure Active Directory** -> **用户设置** -> **管理用户功能预览设置** 来为你的 Azure
    AD 租户启用此功能。你可以为所有用户或选择的组启用预览功能，如以下截图所示：
- en: '![Figure. 3.41 - Enabling combined registration for SSPR and MFA in your tenant'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.41 - 在租户中启用 SSPR 和 MFA 的联合注册'
- en: '](img/Fig._3.41.jpg)'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.41.jpg)'
- en: Figure. 3.41 - Enabling combined registration for SSPR and MFA in your tenant
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.41 - 在租户中启用 SSPR 和 MFA 的联合注册
- en: After that, users for whom this setting applies are able to use the new experience
    at [https://myprofile.microsoft.com/](https://myprofile.microsoft.com/).
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，适用此设置的用户可以在 [https://myprofile.microsoft.com/](https://myprofile.microsoft.com/)
    上使用新的体验。
- en: '![Figure. 3.42 - The new combined experience'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.42 - 新的联合体验'
- en: '](img/Fig._3.42.jpg)'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.42.jpg)'
- en: Figure. 3.42 - The new combined experience
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.42 - 新的结合体验
- en: Integrating on-premises identities into Azure AD is a great way to enhance the
    sign-in experience across your hybrid organization, and you just learned about
    the considerations to bear in mind before starting your hybrid journey. In the
    *Exploring passwords and passphrases* section, you learned that passwords are
    not good enough to protect your accounts. So, let's move on now to passwordless
    sign-ins in Azure AD.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 将本地身份集成到 Azure AD 是提升混合组织登录体验的绝佳方式，你刚刚了解了在开始混合之旅前需要注意的事项。在*探索密码和密码短语*部分，你了解到密码不足以保护帐户。所以，让我们继续讨论
    Azure AD 中的无密码登录。
- en: Understanding passwordless authentication
  id: totrans-371
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解无密码身份验证
- en: In a world in which passwords are not enough to protect identities, we need
    another, more secure, approach to further protect identities. Passwords can be
    guessed or phished without physically having access to a user's device or storage.
    With passwordless authentication, Azure AD offers two different methods to sign
    in to a cloud-based user account without needing passwords anymore.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 在密码已不足以保护身份的世界中，我们需要另一种更安全的方式来进一步保护身份。密码可能被猜测或通过钓鱼攻击获取，即使没有物理访问用户设备或存储的权限。而通过无密码身份验证，Azure
    AD 提供了两种不同的方法来登录到基于云的用户帐户，无需密码。
- en: 'You can use the **Microsoft Authenticator app**, the app you already know from
    the *Understanding MFA* section. With this method, you are prompted to approve
    your sign-in by tapping a number in the Authenticator app, as shown in the following
    screenshot:'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用**Microsoft Authenticator 应用**，这款应用你在*了解 MFA*部分已经熟悉了。使用这种方法时，你只需在 Authenticator
    应用中点击一个数字以批准登录，如下图所示：
- en: '![Figure. 3.43 - Phone-based passwordless authentication'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.43 - 基于手机的无密码身份验证'
- en: '](img/Fig._3.43.jpg)'
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.43.jpg)'
- en: Figure. 3.43 - Phone-based passwordless authentication
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.43 - 基于手机的无密码身份验证
- en: All the user has to do is to register the app as an MFA option and then, in
    the smartphone app, choose **Enable phone sign-in** from the drop-down menu. After
    following the instructions in the app, the user can sign in to the app, without
    entering a password.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 用户只需将该应用注册为 MFA 选项，然后在智能手机应用中从下拉菜单中选择**启用手机登录**。按照应用中的说明操作后，用户可以无需输入密码登录应用。
- en: The second option is to use a **FIDO2 security key** to sign in against Azure
    AD. FIDO2-based passwordless authentication is currently in preview and is only
    supported on Windows 10 and in the Microsoft Edge browser.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 第二种选择是使用**FIDO2 安全密钥**对 Azure AD 进行登录。基于 FIDO2 的无密码身份验证目前处于预览阶段，仅在 Windows 10
    和 Microsoft Edge 浏览器中受支持。
- en: '![Figure. 3.44 - FIDO2 security keys'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.44 - FIDO2 安全密钥'
- en: '](img/Fig._3.44.jpg)'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.44.jpg)'
- en: Figure. 3.44 - FIDO2 security keys
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.44 - FIDO2 安全密钥
- en: 'Using this method, the user needs to have physical access to the security key
    that is needed during the authentication process. The user needs to be enabled
    for the enhanced security registration preview so access to the [https://myprofile.microsoft.com/](https://myprofile.microsoft.com/)
    portal is enabled, as described in the *Hybrid authentication and SSO* section.
    To use a security key, it needs to be added to the user''s security info, as shown
    in the following screenshot:'
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这种方法时，用户需要在身份验证过程中拥有物理访问安全密钥的权限。用户需要启用增强安全性注册预览功能，这样才能访问[https://myprofile.microsoft.com/](https://myprofile.microsoft.com/)门户，如*混合身份验证和单点登录*部分所述。要使用安全密钥，必须将其添加到用户的安全信息中，如下图所示：
- en: '![Figure. 3.45 - Associating a security key with a user''s profile'
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.45 - 将安全密钥与用户的个人资料关联'
- en: '](img/Fig._3.45.jpg)'
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.45.jpg)'
- en: Figure. 3.45 - Associating a security key with a user's profile
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.45 - 将安全密钥与用户的个人资料关联
- en: After following the instructions, the user will be able to authenticate against
    Azure AD without entering a password.
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 按照说明操作后，用户将能够在不输入密码的情况下对 Azure AD 进行身份验证。
- en: Global settings
  id: totrans-387
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 全局设置
- en: 'Before you can enable passwordless authentication on a per-user basis, the
    feature needs to be enabled for the Azure AD tenant. The settings can be found
    in the Azure AD portal under **Azure AD** -> **Security** -> **Authentication
    methods**, as shown in the following screenshot:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 在你能为每个用户启用无密码身份验证之前，必须首先为 Azure AD 租户启用此功能。相关设置可以在 Azure AD 门户中的**Azure AD**
    -> **安全性** -> **身份验证方法**下找到，如下图所示：
- en: '![Figure. 3.46 - Enabling passwordless authentication for an Azure AD tenant'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 3.46 - 为 Azure AD 租户启用无密码身份验证'
- en: '](img/Fig._3.46.jpg)'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: '](img/Fig._3.46.jpg)'
- en: Figure. 3.46 - Enabling passwordless authentication for an Azure AD tenant
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.46 - 为Azure AD租户启用无密码认证
- en: You have now learned how to enable passwordless authentication for your users.
    In the next section, you will learn about the licensing of security features in
    Azure AD.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在已经学习了如何为用户启用无密码认证。在下一节中，你将学习关于Azure AD中安全功能的许可。
- en: Licensing considerations
  id: totrans-393
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 许可考虑
- en: Azure AD licensing can become a bit complex when it comes to security features.
    This is why we decided to compare different licenses and to explain which license
    you need for which feature. Azure AD is always licensed on a per-user basis, so
    you need one respective license for each user. For all security features that
    have been discussed in this chapter, you will either need an Azure AD Premium
    P1 or an Azure AD Premium P2 license. These licenses are also part of Microsoft
    365 and **Enterprise Mobility + Security** (**EMS**) license packages.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: Azure AD许可在安全功能方面可能会变得有些复杂。因此，我们决定比较不同的许可，并解释每个功能需要哪个许可。Azure AD始终按每用户许可模式授权，因此你需要为每个用户提供相应的许可。对于本章讨论的所有安全功能，你将需要Azure
    AD Premium P1或Azure AD Premium P2许可。这些许可也是Microsoft 365和**企业流动性与安全性**（**EMS**）许可包的一部分。
- en: Microsoft 365 E3 contains EMS E3, which contains features of Azure AD Premium
    P1.
  id: totrans-395
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft 365 E3包含EMS E3，其中包括Azure AD Premium P1的功能。
- en: Microsoft 365 E5 contains EMS E5, which contains features of Azure AD Premium
    P2.
  id: totrans-396
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft 365 E5包含EMS E5，其中包括Azure AD Premium P2的功能。
- en: 'For the following features, you will need an Azure AD Premium P2 license:'
  id: totrans-397
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于以下功能，你将需要Azure AD Premium P2许可证：
- en: Azure AD PIM
  id: totrans-398
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure AD PIM
- en: Azure AD Identity Protection
  id: totrans-399
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure AD身份保护
- en: Risk-based Conditional Access policies
  id: totrans-400
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于风险的条件访问策略
- en: 'For the following features, an Azure AD Premium P1 license is sufficient:'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 对于以下功能，Azure AD Premium P1许可证已足够：
- en: Azure MFA
  id: totrans-402
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure MFA
- en: Conditional Access based on group, location, and device status
  id: totrans-403
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于组、位置和设备状态的条件访问
- en: Self-service password reset
  id: totrans-404
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自助密码重置
- en: Summary
  id: totrans-405
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Identity is the new perimeter and so it's essential to properly protect user
    and administrator accounts in the cloud. In this chapter, you have learned why
    passwords are not enough to protect your accounts and how to protect them with
    MFA, Azure AD Identity Protection, and passwordless authentication. You are able
    to reduce your privileged accounts' attack surface as of now, to integrate Azure
    AD into your existing environments.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 身份是新的边界，因此在云中正确保护用户和管理员账户至关重要。在本章中，你已经了解了为什么密码不足以保护账户，以及如何通过MFA、Azure AD身份保护和无密码认证来保护账户。从现在开始，你可以减少特权账户的攻击面，并将Azure
    AD集成到现有环境中。
- en: In the next chapter, you will learn how to protect network infrastructure resources
    on Azure and which platform services you need to achieve a better security posture.
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，你将学习如何保护Azure上的网络基础设施资源，以及为了实现更好的安全态势你需要哪些平台服务。
- en: Questions
  id: totrans-408
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: With the cloud, identity is…
  id: totrans-409
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在云中，身份是…
- en: A. More exposed to attacks
  id: totrans-410
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: A. 更容易受到攻击
- en: B. Less exposed to attacks
  id: totrans-411
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. 更少暴露于攻击
- en: C. Equally exposed to attacks
  id: totrans-412
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. 同样容易受到攻击
- en: We can control password settings with…
  id: totrans-413
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过…控制密码设置
- en: A. Azure AD protection
  id: totrans-414
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: A. Azure AD保护
- en: B. Account protection
  id: totrans-415
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. 账户保护
- en: C. Password protection
  id: totrans-416
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. 密码保护
- en: We can increase account security with…
  id: totrans-417
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过…提高账户安全性
- en: A. More complex passwords
  id: totrans-418
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: A. 更复杂的密码
- en: B. More frequent password changes
  id: totrans-419
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. 更频繁的密码更改
- en: C. Multi-Factor Authentication (MFA)
  id: totrans-420
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. 多因素认证（MFA）
- en: D. Two-Factor Authentication (2FA)
  id: totrans-421
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: D. 双重身份验证（2FA）
- en: You can control actions that require MFA.
  id: totrans-422
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以控制需要MFA的操作。
- en: A. Yes
  id: totrans-423
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: A. 是
- en: B. No
  id: totrans-424
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. 否
- en: C. Only for some actions
  id: totrans-425
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. 仅针对某些操作
- en: Which report is not available in risk detection?
  id: totrans-426
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在风险检测中哪个报告不可用？
- en: A. Users with leaked credentials
  id: totrans-427
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: A. 泄露凭证的用户
- en: B. Impossible travel
  id: totrans-428
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. 不可能的旅行
- en: C. Infected users
  id: totrans-429
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. 被感染的用户
- en: D. Infected devices
  id: totrans-430
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: D. 被感染的设备
- en: With roles in **Privileged Identity Management** (**PIM**), the user has…
  id: totrans-431
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 具有**特权身份管理**（**PIM**）角色的用户拥有…
- en: A. More privileges
  id: totrans-432
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: A. 更多特权
- en: B. Fewer privileges
  id: totrans-433
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. 更少的特权
- en: C. To activate privileges
  id: totrans-434
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. 激活特权
- en: The most secure authentication is…
  id: totrans-435
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最安全的身份验证是…
- en: A. A strong password
  id: totrans-436
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: A. 强密码
- en: B. MFA
  id: totrans-437
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: B. MFA
- en: C. Passwordless
  id: totrans-438
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C. 无密码
