- en: 3 Setting up for Advanced Penetration Testing Techniques
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3 为高级渗透测试技术做准备
- en: Join our book community on Discord
  id: totrans-1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 加入我们的 Discord 书籍社区
- en: '[https://packt.link/SecNet](https://packt.link/SecNet)![Qr code Description
    automatically generated](../media/file73.png)Learning the methodology and techniques
    of performing penetration testing is always exciting. While many professionals
    may focus on specific types of penetration testing, such as internal or external
    network penetration testing, social engineering penetration testing, or even web
    application security testing, it''s always beneficial to understand how to perform
    wireless penetration testing and how to compromise a Microsoft Windows domain
    in an enterprise environment.In this chapter, you will learn how to setup an Active
    Directory domain environment that will enable you perform advanced penetration
    testing exercises such as red teaming techniques to discover security vulnerabilities
    and compromise the Domain Controller, taking over the domain of the organization.
    In addition, you will setup a RADIUS access server to provide **Authentication,
    Authorization and Accounting** (**AAA**) services to our enterprise wireless network.
    In this chapter, we will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/SecNet](https://packt.link/SecNet)![二维码描述自动生成](../media/file73.png)学习渗透测试的方法和技巧总是令人兴奋的。尽管许多专业人员可能专注于特定类型的渗透测试，例如内部或外部网络渗透测试、社交工程渗透测试，甚至是
    Web 应用程序安全测试，但了解如何执行无线渗透测试以及如何在企业环境中攻破 Microsoft Windows 域始终是有益的。在本章中，您将学习如何设置一个活动目录域环境，使您能够执行高级渗透测试练习，例如红队技术，发现安全漏洞并攻破域控制器，接管组织的域。此外，您还将设置一个
    RADIUS 访问服务器，为我们的企业无线网络提供**认证、授权和计费**（**AAA**）服务。在本章中，我们将涵盖以下主题：'
- en: Building an Active Directory red team lab
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建一个活动目录红队实验室
- en: Setting up a wireless penetration testing lab
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置无线渗透测试实验室
- en: Let’s dive in!
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧！
- en: Technical Requirements
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To follow along with the exercises in this chapter, please ensure that you
    have met the following hardware and software requirements:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 为了跟随本章中的练习，请确保您已经满足以下硬件和软件要求：
- en: Oracle VM VirtualBox - [https://www.virtualbox.org/](https://www.virtualbox.org/)
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Oracle VM VirtualBox - [https://www.virtualbox.org/](https://www.virtualbox.org/)
- en: Windows 10 Enterprise - [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise)
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 10 Enterprise - [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise)
- en: Windows Server 2019 - [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019)
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Server 2019 - [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019)
- en: Ubuntu Server 22.04 LTS - [https://releases.ubuntu.com/jammy/](https://releases.ubuntu.com/jammy/)
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ubuntu Server 22.04 LTS - [https://releases.ubuntu.com/jammy/](https://releases.ubuntu.com/jammy/)
- en: Building an Active Directory red team lab
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建一个活动目录红队实验室
- en: '**Active Directory** is a role within the Microsoft Windows Server operating
    system that enables IT administrators to centrally manage all users, devices,
    and policies within a Windows environment. Active Directory ensures that centralized
    management is available for user accounts across an entire Windows domain, as
    well as that policies can be created and assigned to various user groups to ensure
    people have the necessary access rights to perform actions that are related to
    their job duties.Active Directory is commonly found within many organizations
    around the world. As an aspiring ethical hacker and penetration tester, it''s
    important to understand how to discover various security vulnerabilities within
    a Microsoft Windows domain and leverage those security flaws to compromise an
    organization''s **Domain Controller** and its systems, services, and shared resources.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**活动目录**是 Microsoft Windows Server 操作系统中的一个角色，使 IT 管理员能够集中管理 Windows 环境中的所有用户、设备和策略。活动目录确保整个
    Windows 域内的用户帐户可以进行集中管理，并且可以创建并分配策略给不同的用户组，以确保人员拥有执行与其工作职责相关的操作所需的访问权限。活动目录在全球许多组织中广泛存在。作为一个有抱负的道德黑客和渗透测试员，了解如何发现
    Microsoft Windows 域中的各种安全漏洞，并利用这些安全缺陷攻破组织的**域控制器**及其系统、服务和共享资源是非常重要的。'
- en: 'To learn more about the role and importance of a Domain Controller, please
    see: [https://www.techtarget.com/searchwindowsserver/definition/domain-controller](https://www.techtarget.com/searchwindowsserver/definition/domain-controller).'
  id: totrans-14
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 要了解更多关于域控制器的作用和重要性，请参阅：[https://www.techtarget.com/searchwindowsserver/definition/domain-controller](https://www.techtarget.com/searchwindowsserver/definition/domain-controller)。
- en: 'This section will teach you how to create a Microsoft Windows lab environment
    with a Microsoft Windows Server 2019 and 2 Windows 10 Enterprise clients as virtual
    machines. This lab environment will allow you to practice advanced penetration
    testing techniques such as red teaming exercises on a Windows domain and exploit
    security flaws in Active Directory environments.The following diagram shows the
    RedTeamLab environment:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将教你如何创建一个 Microsoft Windows 实验环境，其中包括一个 Microsoft Windows Server 2019 和 2
    台 Windows 10 企业版客户端作为虚拟机。这个实验环境将允许你练习高级渗透测试技术，如针对 Windows 域的红队演练以及在 Active Directory
    环境中利用安全漏洞。下图展示了 RedTeamLab 环境：
- en: '![](../media/file74.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file74.png)'
- en: 'As we can see, our Kali Linux virtual machine is directly connected to the
    systems within the *RedTeamLab* environment. In later sections of this book, you
    will learn how to perform exploitation and post-exploitation techniques on targets,
    so when you''re exploiting the systems within the Windows domain, we will assume
    you have already broken into the network and have compromised at least one system
    that’s connected to Active Directory. For now, we will focus on setting up our
    environment for security testing later.The following table shows the user accounts
    that we will be setting up in the *RedTeamLab* environment:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，我们的 Kali Linux 虚拟机直接连接到*RedTeamLab*环境中的系统。在本书的后续章节中，你将学习如何对目标进行漏洞利用和后期利用技术，因此当你在
    Windows 域内进行攻击时，我们假设你已经成功入侵网络，并至少攻破了一个连接到 Active Directory 的系统。现在，我们将专注于为后续的安全测试设置环境。下表显示了我们将在*RedTeamLab*环境中设置的用户账户：
- en: '![](../media/file75.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file75.png)'
- en: 'As shown in the preceding table, we will create 2 domain users (*gambit* ad
    *rogue*), an additional domain administrator (*wolverine*) and a service account
    which domain administrative privileges (*sqladmin*).To get started setting up
    the red team section of our lab, please use the following instructions:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如上表所示，我们将创建 2 个域用户（*gambit* 和 *rogue*），一个额外的域管理员（*wolverine*）以及一个具有域管理员权限的服务账户（*sqladmin*）。为了开始设置我们的红队实验室部分，请使用以下指示：
- en: Part 1 – Setting up Windows Server
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第1部分 – 设置 Windows Server
- en: 'In this section, you will learn how to setup Microsoft Windows Server 2019
    as a virtual machine. To get started with this exercise, please use the following
    instructions:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，你将学习如何将 Microsoft Windows Server 2019 设置为虚拟机。请按照以下步骤开始本练习：
- en: 'On your host computer, go to [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019),
    and click on **Download the VHD**, ensure you complete the registration form to
    access the download links for the **Virtual Hard Disk** (**VHD**) **64-bit edition**
    file as shown below:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的主机电脑上，访问[https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019)，点击**下载
    VHD**，确保你完成注册表单，以便访问**虚拟硬盘**（**VHD**）**64位版本**的下载链接，如下所示：
- en: '![](../media/file76.png)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file76.png)'
- en: Rather than downloading an ISO image, using a pre-built VHD for Windows Server
    2019 will reduce the time needed to install the Windows Server 2019 operating
    system as a virtual machine.
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 与下载 ISO 镜像相比，使用预构建的 Windows Server 2019 VHD 文件将减少将 Windows Server 2019 操作系统安装为虚拟机所需的时间。
- en: Once the Windows Server 2019 VHD file is downloaded on your host computer, open
    **Oracle VM VirtualBox Manager** and click on **New** to create a new virtual
    machine environment.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦 Windows Server 2019 VHD 文件下载到你的主机计算机上，打开**Oracle VM VirtualBox 管理器**，点击**新建**来创建一个新的虚拟机环境。
- en: 'When the **Create Virtual Machine** window appears, click on **Expert Mode**
    and use the following configurations:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当**创建虚拟机**窗口出现时，点击**专家模式**并使用以下配置：
- en: 'Name: Windows Server 2019'
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：Windows Server 2019
- en: 'Type: Microsoft Windows'
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类型：Microsoft Windows
- en: 'Version: Windows 2019 (64-bit)'
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 版本：Windows 2019（64位）
- en: 'Hard Disk: Use an Existing Virtual Hard Disk File (Click on the folder icon
    > Add > select the Windows Server 2019 VHD file).'
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬盘：使用现有的虚拟硬盘文件（点击文件夹图标 > 添加 > 选择 Windows Server 2019 VHD 文件）。
- en: Click on **Finish** to save the virtual machine
  id: totrans-31
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 点击**完成**以保存虚拟机
- en: Once the **Windows Server 2019 virtual machine** is created and saved on **Oracle
    VM VirtualBox Manager**, select it and click on **Settings**.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦 **Windows Server 2019 虚拟机** 在 **Oracle VM VirtualBox 管理器** 中创建并保存，选择它并点击
    **设置**。
- en: 'On the **Settings** window, select the **Network** category and use the following
    settings for **Adapter 1**:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **设置** 窗口中，选择 **网络** 类别，并使用以下设置配置 **适配器 1**：
- en: 'Adapter 1: Enable network Adapter'
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器 1：启用网络适配器
- en: 'Attached to: Internal Network'
  id: totrans-35
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 附加到：内部网络
- en: 'Name: *RedTeamLab* (manually type it in the field)'
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：*RedTeamLab*（手动输入该字段）
- en: 'Promiscuous Mode: Allow All'
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 混杂模式：允许所有
- en: 'The following screenshot shows the preceding configurations for Adapter 1:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了适配器 1 的前述配置：
- en: '![](../media/file77.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file77.png)'
- en: Next, select the **Windows Server 2019 virtual machine** and click on **Start**
    to power-on.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择 **Windows Server 2019 虚拟机** 并点击 **启动** 以开机。
- en: Once the virtual machine is running, you will prompted to select your home country/region,
    preferred app language and keyboard layout, click on **Next**.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦虚拟机运行，您将被提示选择您的国家/地区、首选应用语言和键盘布局，点击 **下一步**。
- en: Next, you will need to read the **License terms** and click on **Accept**.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，您需要阅读 **许可条款** 并点击 **接受**。
- en: Next, create a password for the built-in `Administrator` account, use `P@ssword1`
    as the password and click on **Finish**.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，为内建的 `Administrator` 帐户创建密码，使用 `P@ssword1` 作为密码，并点击 **完成**。
- en: 'Next, log-in to Windows Server 2019 virtual machine. On the virtual machine
    menu bar, select **Input** > **Keyboard** > **Insert Ctrl-Alt-Del** to view the
    login window:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，登录到 Windows Server 2019 虚拟机。在虚拟机菜单栏中，选择 **输入** > **键盘** > **插入 Ctrl-Alt-Del**
    以查看登录窗口：
- en: '![](../media/file78.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file78.png)'
- en: 'Login using username: `Administrator` and password: `P@ssword1`.'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用用户名：`Administrator` 和密码：`P@ssword1` 登录。
- en: Part 2 – Configuring virtual machine additional features
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第 2 部分 – 配置虚拟机附加功能
- en: Ensure the Windows Server 2019 virtual machine is running and you’re logged-in.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保 Windows Server 2019 虚拟机正在运行并且已登录。
- en: 'To scale the virtual machine’s desktop resolution to fit your host computer’s
    monitor, on the virtual machine menu bar, select **Devices** > **Insert Guest
    Additions CD image** as shown below:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将虚拟机的桌面分辨率调整为适合主机计算机的显示器，在虚拟机菜单栏中，选择 **设备** > **插入来宾附加 CD 镜像**，如下所示：
- en: '![](../media/file79.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file79.png)'
- en: 'Next, open **Windows Explorer** within Windows Server 2019 and navigate to
    **This PC** and double-click on the **VirtualBox Guest Additions** virtual disk
    as shown below:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在 Windows Server 2019 中打开 **Windows 资源管理器**，导航到 **此电脑**，双击 **VirtualBox
    Guest Additions** 虚拟磁盘，如下所示：
- en: '![](../media/file80.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file80.png)'
- en: When the installation window appears, click on **Next** and ensure that you
    use the default settings during the installation process. When it's complete,
    do not reboot.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当安装窗口出现时，点击 **下一步** 并确保在安装过程中使用默认设置。安装完成后，请不要重启。
- en: 'Next, within the Windows Server 2019, click on the **Start** button (bottom-left
    corner) and open **Windows PowerShell**. Use the following commands to static
    assign an IP address and subnet mask to the Ethernet network adapter:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在 Windows Server 2019 中，点击 **开始** 按钮（左下角）并打开 **Windows PowerShell**。使用以下命令为以太网网络适配器静态分配
    IP 地址和子网掩码：
- en: '[PRE0]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, change the default hostname to `DC1` and reboot the server with the following
    commands:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，将默认主机名更改为 `DC1`，并使用以下命令重启服务器：
- en: '[PRE1]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令的执行结果：
- en: '![](../media/file81.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file81.png)'
- en: 'Next, after the server reboots, login using the Administrator credentials.
    The Windows Server desktop interface will automatically scale to fit your monitor''s
    resolution. If it doesn''t, simply toggle this with the **VirtualBox menu bar**
    > **View** > **Auto-resize Guest Display** option as shown below:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，服务器重启后，使用管理员凭据登录。Windows Server 桌面界面会自动调整为适应显示器的分辨率。如果没有，您可以通过 **VirtualBox
    菜单栏** > **查看** > **自动调整来宾显示** 选项来切换，如下所示：
- en: '![](../media/file82.png)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file82.png)'
- en: Part 3 – Setting Active Directory Domain Services
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第 3 部分 – 设置活动目录域服务
- en: 'Active Directory is a very important and popular role within Microsoft Windows
    Server as it allows IT professionals to centrally manage all users, devices, and
    policies within a Windows environment. To set up Active Directory within our lab,
    please use the following instructions:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 活动目录是 Microsoft Windows Server 中非常重要且流行的角色，它允许 IT 专业人员集中管理 Windows 环境中的所有用户、设备和策略。要在我们的实验室中设置活动目录，请按照以下说明操作：
- en: Open the **Windows PowerShell** application within the Windows Server 2019 virtual
    machine.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开**Windows PowerShell**应用程序，在Windows Server 2019虚拟机中进行操作。
- en: 'Install the **Active Directory Domain Service** and it’s management tools using
    the following commands:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令安装**Active Directory域服务**及其管理工具：
- en: '[PRE2]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Next, configure a new Active Directory forest and domain with the name `redteamlab.local`
    using the following commands:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令配置名为`redteamlab.local`的新的Active Directory林和域：
- en: '[PRE3]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'You’ll be prompted to enter a **Safe Mode Administrator Password**, use `P@ssword1`.
    When prompted to continue the operation, type `Y` and hit **Enter** to continue
    as shown in the following screenshot:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 系统会提示您输入**安全模式管理员密码**，请输入`P@ssword1`。当系统提示继续操作时，输入`Y`并按**Enter**继续，具体操作请参考以下截图：
- en: '![](../media/file83.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file83.png)'
- en: The setup process takes a few minutes to complete, then the Windows Server will
    automatically reboot.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程需要几分钟完成，然后Windows Server将自动重启。
- en: After the server reboots, login using the Administrator credentials. This time,
    you’ll be logging-in as a domain administrator on the server.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器重启后，使用管理员凭据登录。这时，您将作为域管理员登录服务器。
- en: Part 4 – Creating domain users and administrator accounts
  id: totrans-73
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第四部分 – 创建域用户和管理员账户
- en: 'The following steps will carefully guide you through the process of creating
    domain users and domain administrators, and assigning the user to various security
    groups. To ensure these steps are simple and concise, we will be using the Windows
    PowerShell on Windows Server:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将详细指导您如何创建域用户和域管理员，并将用户分配到各种安全组。为了确保这些步骤简洁明了，我们将使用Windows Server上的Windows
    PowerShell：
- en: 'On the Windows Server 2019 virtual machine, open the **Windows PowerShell**
    application and use the following commands to create 4 domain user accounts:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Windows Server 2019虚拟机中，打开**Windows PowerShell**应用程序，使用以下命令创建4个域用户账户：
- en: '[PRE4]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令的执行结果：
- en: '![](../media/file84.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file84.png)'
- en: Next, let's make the `wolverine` account a high-privilege user account that
    has the same privileges as the administrator by using the following commands
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令将`wolverine`账户设置为具有与管理员相同权限的高权限用户账户：
- en: '[PRE5]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令的执行结果：
- en: '![](../media/file85.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file85.png)'
- en: Next, we will do the same for the `sqladmin` account
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将对`sqladmin`账户执行相同操作：
- en: '[PRE6]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令的执行结果：
- en: '![](../media/file86.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file86.png)'
- en: Part 5 - Disabling antimalware protection and the domain firewall
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第五部分 - 禁用反恶意软件保护和域防火墙
- en: 'Within our lab, we need to ensure the Windows Defender antimalware protection
    is disabled on client that are connected to the Windows domain. Some techniques
    are be used to bypass antiviruses that will work today and tomorrow, and it will
    not afterwards due to the continuous advancement of malware protection and solutions.
    The following steps will guide you through the process of ensuring Windows Defender
    and the host-based firewall is disabled on all systems by leveraging **Group Policy
    Objects** (**GPOs**):'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的实验室中，我们需要确保连接到Windows域的客户端禁用了Windows Defender反恶意软件保护。某些技术可以绕过当前和未来的防病毒软件，但随着恶意软件保护技术和解决方案的持续进步，未来将无法继续使用这些方法。以下步骤将引导您通过**组策略对象**（**GPO**）确保所有系统上禁用Windows
    Defender和主机防火墙：
- en: 'On the Windows Server 2019 virtual machine, open the **Windows PowerShell**
    application and use the following commands to create a new GPO called `DisableAVGPO`:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Windows Server 2019虚拟机中，打开**Windows PowerShell**应用程序，使用以下命令创建一个名为`DisableAVGPO`的新GPO：
- en: '[PRE7]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The following screenshot shows the expected results when executing the preceding
    commands:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了执行前述命令时预期的结果：
- en: '![](../media/file87.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file87.png)'
- en: 'Next, use the following commands to disable the antimalware service from always
    running:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令禁用反恶意软件服务的常驻运行：
- en: '[PRE8]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'As shown below, the preceding commands successfully updated the `DisableAVGPO`
    policy:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如下所示，前述命令成功更新了`DisableAVGPO`策略：
- en: '![](../media/file88.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file88.png)'
- en: Next, turn-off the antimalware real-time protection using the following commands
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令关闭反恶意软件的实时保护：
- en: '[PRE9]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The following screenshot shows the preceding commands updated the policy:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令更新了策略：
- en: '![](../media/file89.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file89.png)'
- en: Next, turn-off Windows Defender Antivirus by using the following commands
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令关闭 Windows Defender Antivirus：
- en: '[PRE10]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The following screenshot shows execution of the preceding commands:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令的执行情况：
- en: '![](../media/file90.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file90.png)'
- en: 'Next, turn-off Windows Defender Firewalls with the following commands:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令关闭 Windows Defender 防火墙：
- en: '[PRE11]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'As shown in the following screenshot, the preceding commands executed successfully:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 如下截图所示，前述命令执行成功：
- en: '![](../media/file91.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file91.png)'
- en: Part 6 – Setting up for service authentication attacks
  id: totrans-109
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第六部分 – 为服务身份验证攻击做好设置
- en: 'During our red teaming section, you will learn how to discover file and network
    sharing resources on a Windows environment. This section demonstrates how to create
    a network file share on Windows Server 2019 to simulate a vulnerable service that
    can be exploited by a threat actor.To get started with this exercise, please use
    the following instructions:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的红队部分，你将学习如何在 Windows 环境中发现文件和网络共享资源。本节演示了如何在 Windows Server 2019 上创建网络文件共享，以模拟一个可以被威胁行为者利用的易受攻击的服务。开始本练习时，请按照以下指示操作：
- en: 'On Windows Server 2019, open the **Windows PowerShell** application with administrative
    privileges and execute the following commands to create a shared folder on the
    `C:` drive:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows Server 2019 上，以管理员权限打开 **Windows PowerShell** 应用程序并执行以下命令，以在 `C:`
    驱动器上创建共享文件夹：
- en: '[PRE12]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The following screenshots the execution of the preceding commands:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了前述命令的执行情况：
- en: '![](../media/file92.png)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file92.png)'
- en: 'Next, we can verify the shared folder by opening **Server Manager** application
    and selecting **File and Storage Services** > **Shares**, as shown here:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们可以通过打开 **Server Manager** 应用程序并选择 **File and Storage Services** > **Shares**
    来验证共享文件夹，如下所示：
- en: '![](../media/file93.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file93.png)'
- en: 'Next, to ensure we can simulate a cyber-attack to compromise the Kerberos feature
    on a Windows Server environment, we need to create a **Service Principal Name**
    (**SPN**) on our Domain Controller, which is our Windows Server. Open the **Windows
    PowerShell** application with administrative privileges and execute the following
    commands:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，为确保我们能够模拟网络攻击来破坏 Windows Server 环境中的 Kerberos 功能，我们需要在我们的域控制器（即 Windows
    Server）上创建 **Service Principal Name**（**SPN**）。以管理员权限打开 **Windows PowerShell**
    应用程序并执行以下命令：
- en: '[PRE13]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The following screenshot shows the execution of the preceding command to assign
    the `sqladmin` account as an SPN:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了执行前述命令以将 `sqladmin` 账户分配为 SPN：
- en: '![](../media/file94.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file94.png)'
- en: 'To learn more about service principle names on Windows Server, please see:
    [https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names](https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names).'
  id: totrans-121
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 若要了解更多有关 Windows Server 上服务主体名称的信息，请访问： [https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names](https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names)。
- en: Lastly, use the `slmgr /rearm` command on the Windows Server 2019 virtual machine
    to prevent it from automatically powering-off as it’s a trial version. Reboot
    the system to ensure the changes take effect, then power-off the virtual machine
    until it’s needed later.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，在 Windows Server 2019 虚拟机上使用 `slmgr /rearm` 命令，防止其作为试用版自动关机。重启系统以确保更改生效，然后将虚拟机关机，直到稍后需要使用时。
- en: Part 7 – Installing Windows 10 Enterprise
  id: totrans-123
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第七部分 – 安装 Windows 10 企业版
- en: 'In this section, you will learn how to set up two Microsoft Windows 10 client
    systems within the Red Team lab topology. One virtual machine will be logged on
    as Bob, while the other user will be logged on as Alice. To get started with this
    exercise, please use the following instructions:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，你将学习如何在红队实验室拓扑中设置两台 Microsoft Windows 10 客户端系统。一台虚拟机将以 Bob 用户登录，另一台则以 Alice
    用户登录。开始本练习时，请按照以下指示操作：
- en: On your host computer, to download Microsoft Windows 10 Enterprise ISO file,
    go to [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise)
    and click on **Download the ISO – Enterprise**.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的主机计算机上，若要下载 Microsoft Windows 10 企业版 ISO 文件，请访问 [https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise)
    并点击 **Download the ISO – Enterprise**。
- en: 'Next, complete the registration form and click on the **Download** button,
    then select **ISO - Enterprise 64-bit edition** as shown below:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，填写注册表单并点击 **Download** 按钮，然后选择 **ISO - Enterprise 64-bit edition**，如下所示：
- en: '![](../media/file95.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file95.png)'
- en: Once the Windows 10 Enterprise ISO file downloaded onto your host computer,
    open **Oracle VM VirtualBox Manager** and click on **New** to create a new virtual
    machine.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦 Windows 10 企业版 ISO 文件下载到您的主机计算机上，打开**Oracle VM VirtualBox 管理器**，点击**新建**以创建一个新的虚拟机。
- en: 'The **Create Virtual Machine** window will appear, use the following configurations:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**创建虚拟机**窗口将出现，使用以下配置：'
- en: 'Name: Bob-PC'
  id: totrans-130
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：Bob-PC
- en: 'ISO Image: Use the drop-down menu, select **Other** > then select the Windows
    10 Enterprise ISO file and click on Open to attach it.'
  id: totrans-131
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: ISO 镜像：使用下拉菜单，选择**其他** > 然后选择 Windows 10 企业版 ISO 文件并点击打开以附加该文件。
- en: 'Type: Microsoft Windows'
  id: totrans-132
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类型：Microsoft Windows
- en: 'Version: Windows 10 (64-bit)'
  id: totrans-133
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 版本：Windows 10（64 位）
- en: 'Skip Unattended Installation: Yes (check the box)'
  id: totrans-134
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跳过无人值守安装：是（勾选此框）
- en: 'The following screenshot shows the preceding configurations:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了前面的配置：
- en: '![](../media/file96.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file96.png)'
- en: Once you’re all set, click on **Finish** to save the virtual environment.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 一切设置完成后，点击**完成**以保存虚拟环境。
- en: 'Next, select the Bob-PC virtual machine and click on **Settings** as shown
    below:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择 Bob-PC 虚拟机并点击**设置**，如下所示：
- en: '![](../media/file97.png)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file97.png)'
- en: 'Click on the **Network** category and apply the following settings to Adapter
    1:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**网络**类别，并对适配器 1 应用以下设置：
- en: 'Adapter 1: Enable network Adapter'
  id: totrans-141
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 适配器 1：启用网络适配器
- en: 'Attached to: Internal Network'
  id: totrans-142
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 附加到：内部网络
- en: 'Name: *RedTeamLab* (manually type it in the field)'
  id: totrans-143
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：*RedTeamLab*（手动输入此字段）
- en: 'Promiscuous Mode: Allow All'
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 混杂模式：允许所有
- en: 'The following screenshot shows the preceding configurations for Adapter 1:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了适配器 1 的前面配置：
- en: '![](../media/file98.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file98.png)'
- en: Next, select the newly created virtual machine and click on **Start** to power-on
    the system.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择新创建的虚拟机，点击**启动**以开启系统。
- en: On the **Windows Setup** window, click on **Next**, then click on **Install
    now**.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**Windows 设置**窗口中，点击**下一步**，然后点击**立即安装**。
- en: Accept the **Applicable notices and license terms**, and click on **Next**.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受**适用的通知和许可条款**，然后点击**下一步**。
- en: 'For the installation type, click on **Custom: Install Windows only (advanced)**
    option.'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于安装类型，点击**自定义：仅安装 Windows（高级）**选项。
- en: 'Then, select **Dive 0: Unallocated Space** and click on **Next** to start the
    installation. After the installation is completed, the virtual machine will automatically
    reboot twice.'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，选择**Dive 0：未分配空间**并点击**下一步**开始安装。安装完成后，虚拟机将自动重启两次。
- en: After the second reboot, you’ll be prompted to select your region, and click
    on **Yes**.
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第二次重启后，系统将提示您选择区域，点击**是**。
- en: Next, select your keyboard layout, and click on **Yes**. You can skip the option
    for adding a second keyboard layout.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择您的键盘布局，点击**是**。您可以跳过添加第二个键盘布局的选项。
- en: 'During the setup process of Windows 10, you''ll be asked to connect to a network.
    Select the **I don''t have internet** option to continue as shown below:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows 10 设置过程中，系统会要求您连接到网络。选择**我没有互联网**选项继续，如下所示：
- en: '![](../media/file99.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file99.png)'
- en: Next, click on **Continue with limited setup**.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，点击**继续进行有限的设置**。
- en: 'Next, create the username: `bob` with the password: `P@ssword2`.'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，创建用户名：`bob`，密码为：`P@ssword2`。
- en: Disable any unnecessary services on the privacy window and disable Cortana.
    Afterwards, the setup process continues and will log you in automatically to the
    Windows 10 desktop.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在隐私窗口中禁用所有不必要的服务，并禁用 Cortana。之后，设置过程将继续，并自动登录到 Windows 10 桌面。
- en: Install the **VirtualBox Guest Additions** on the Windows 10 virtual machine.
    Please see *Part 2, steps 2 – 4*.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows 10 虚拟机上安装**VirtualBox 客户端增强功能**。请参阅*第 2 部分，第 2 步至第 4 步*。
- en: 'On Bob-PC, open the **Command Prompt** with administrative privileges and turn
    on network discovery and file sharing using the following commands:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Bob-PC 上，打开具有管理员权限的**命令提示符**，并使用以下命令启用网络发现和文件共享：
- en: '[PRE14]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了前面命令的执行结果：
- en: '![](../media/file100.png)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file100.png)'
- en: 'Next, use the following commands to change the default hostname to Bob-PC:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令将默认主机名更改为 Bob-PC：
- en: '[PRE15]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Once this virtual machine is rebooted, the hostname will now be Bob-PC, the
    Windows network and file sharing will be enabled. Power-off Bob-PC for now.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦此虚拟机重新启动，主机名将变为 Bob-PC，并启用 Windows 网络和文件共享。现在关闭 Bob-PC。
- en: 'Next, let’s create another Windows 10 virtual machine and call it **Alice-PC**.
    Repeat *steps 3 – 20* and ensure you set **Alice-PC** as both the name of the
    new virtual machine (*step 4*) and the hostname (*step 20*). Create the username:
    `alice` with the password: `P@ssword2` as the local user during the setup process.'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们创建另一个 Windows 10 虚拟机，并将其命名为 **Alice-PC**。重复 *步骤 3 – 20*，并确保您将 **Alice-PC**
    作为新虚拟机的名称（*步骤 4*）和主机名（*步骤 20*）。在安装过程中创建用户名：`alice`，密码：`P@ssword2` 作为本地用户。
- en: Part 8 – Adding the clients to the domain
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第 8 部分 – 将客户端添加到域
- en: 'Use the following instructions to joining each Windows 10 virtual machine,
    Bob-PC and Alice-PC to the Domain Controller:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下指示将每台 Windows 10 虚拟机 **Bob-PC** 和 **Alice-PC** 加入到域控制器：
- en: Power-on the **Windows Server 2019** virtual machine, **Bob-PC** and **Alice-PC**.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 **Windows Server 2019** 虚拟机，**Bob-PC** 和 **Alice-PC**。
- en: 'On **Bob-PC** and **Alice-PC**, open the **Command Prompt** with administrative
    privileges (**Run As Administrator**) and use the `ping 192.168.42.40` command
    to test network connectivity between each Windows 10 system and the Windows Server
    2019 machine as shown below:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **Bob-PC** 和 **Alice-PC** 上，以管理员权限（**以管理员身份运行**）打开 **命令提示符**，使用 `ping 192.168.42.40`
    命令测试每台 Windows 10 系统与 Windows Server 2019 机器之间的网络连接，如下所示：
- en: '![](../media/file101.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file101.png)'
- en: As shown in the preceding screenshot, **Bob-PC** was able to communicate with
    the **Windows Server 2019** virtual machine successfully.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 如前述截图所示，**Bob-PC** 能够成功与 **Windows Server 2019** 虚拟机通信。
- en: 'Next, use the following commands on **Bob-PC** and **Alice-PC** to join the
    `redteamlab.local` domain:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在 **Bob-PC** 和 **Alice-PC** 上使用以下命令加入 `redteamlab.local` 域：
- en: '[PRE16]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Next, the **Windows PowerShell credentials request** window will appear, simply
    enter the domain administrator account (`Administrator`/`P@ssword1`) to authenticate
    the request and click as shown below:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，将会出现 **Windows PowerShell 凭据请求** 窗口，请输入域管理员账户 (`Administrator`/`P@ssword1`)
    来验证请求并点击如下所示：
- en: '![](../media/file102.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file102.png)'
- en: 'Once the system has rebooted, click on **Other user** at the bottom-left corner
    of the login window. Then, log in using a domain user account, such as username:
    `gambit` or `rogue` with the password: `Password1` as shown below:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统重新启动后，在登录窗口的左下角单击 **其他用户**。然后，使用域用户账户登录，例如用户名：`gambit` 或 `rogue`，密码：`Password1`，如下所示：
- en: '![](../media/file103.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file103.png)'
- en: Part 9 – Setting up for account takeover and file sharing attacks
  id: totrans-180
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第 9 部分 – 设置账户接管和文件共享攻击
- en: 'To ensure we can exploit file-sharing services and perform account takeover
    attacks on Windows clients that are connected to the domain, please use the following
    instruction:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保我们可以利用文件共享服务并对连接到域的 Windows 客户端执行账户接管攻击，请使用以下指示：
- en: 'Login to **Bob-PC** and **Alice-PC** using a domain administrator account,
    such as username: `redteamlab\Administrator` and password: `P@ssword1` as shown
    below:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用域管理员账户登录 **Bob-PC** 和 **Alice-PC**，例如用户名：`redteamlab\Administrator`，密码：`P@ssword1`，如下所示：
- en: '![](../media/file104.png)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file104.png)'
- en: 'Open the **Command Prompt** with administrative privileges and use the following
    commands to make the domain user accounts, `gambit` and `rogue`, local administrators
    on **Bob-PC** and **Alice-PC**:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以管理员权限打开 **命令提示符**，并使用以下命令将域用户账户 `gambit` 和 `rogue` 设为 **Bob-PC** 和 **Alice-PC**
    的本地管理员：
- en: '[PRE17]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[PRE18]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了上述命令的执行：
- en: '![](../media/file105.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file105.png)'
- en: 'Next, using the same **Command Prompt** window, use the following commands
    to create a local shared folder on each Windows 10 machine, **Bob-PC** and **Alice-PC**:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在同一 **命令提示符** 窗口中，使用以下命令在每台 Windows 10 机器 **Bob-PC** 和 **Alice-PC** 上创建一个本地共享文件夹：
- en: '[PRE19]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了上述命令的执行：
- en: '![](../media/file106.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file106.png)'
- en: Lastly, power-down your Windows 10 and Windows Server 2019 virtual machines
    until they are needed later on.
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，关闭您的 Windows 10 和 Windows Server 2019 虚拟机，直到稍后需要它们。
- en: Having completed this section, you have built a Microsoft Windows lab environment
    containing the most common type of services and configurations found in many organizations.
    This environment will enable you to perform advanced exploitation techniques on
    Active Directory in later sections of this book, which focuses on red team exercises.
    In the next section, you will learn how to set up a wireless penetration testing
    lab to practice wireless exploitation.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 完成本节后，你已经建立了一个包含许多组织中最常见服务和配置的 Microsoft Windows 实验环境。这个环境将帮助你在本书后续章节中进行高级渗透技术的演练，专注于红队演习。在下一节中，你将学习如何设置一个无线渗透测试实验室，以练习无线漏洞利用。
- en: Setting up a wireless penetration testing lab
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置无线渗透测试实验室
- en: 'Understanding how to perform wireless penetration testing helps organizations
    to determine how a real threat actor is able to discover and exploit security
    vulnerabilities on their company’s wireless network infrastructure.Within many
    organizations, you will commonly find wireless networks that are implemented to
    support the wireless mobility for their employees. Employees can connect their
    smartphones, Internet of Things (IoT) devices, tablets, and laptops to the corporate
    Wi-Fi network and access the resources on the wired network, such as printers
    and servers. In small and large organizations, the wireless router or access point
    is usually configured using one of the following wireless security standards:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 了解如何进行无线渗透测试有助于组织确定真实威胁行为者如何发现并利用公司无线网络基础设施上的安全漏洞。在许多组织中，你通常会发现无线网络被部署来支持员工的无线移动性。员工可以将智能手机、物联网
    (IoT) 设备、平板电脑和笔记本电脑连接到公司 Wi-Fi 网络，并访问有线网络上的资源，如打印机和服务器。在小型和大型组织中，无线路由器或接入点通常会使用以下无线安全标准之一进行配置：
- en: '**Wired Equivalent Privacy** (**WEP**)'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**有线等效隐私** (**WEP**)'
- en: '**Wi-Fi Protected Access** (**WPA**)'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Wi-Fi 受保护访问** (**WPA**)'
- en: '**Wi-Fi Protected Access 2** (**WPA2**)'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Wi-Fi 受保护访问 2** (**WPA2**)'
- en: '**Wi-Fi Protected Access 3** (**WPA3**)'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Wi-Fi 受保护访问 3** (**WPA3**)'
- en: 'Most modern wireless networks are usually configured with WPA2 and WPA3 standards.
    The preceding list of security standards are also designed for small networks
    and the regular consumer as they are simple to configure using a single shared
    password, known as a **Pre-Shared Key** (**PSK**). Therefore, anyone who wants
    to access the wireless network will need the same PSK.In large environments, there
    is a need to improve the security and centralized management of users on the corporate
    wireless network. Security professionals typically implement an **Authentication,
    Authorization, and Accounting** (**AAA**) server such as **Remote Authentication
    Dial-In User Service** (**RADIUS**) on the network, which handles the centralized
    management of network users, accounts, and policies. The following are the access
    methods for wireless networks:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 现代大多数无线网络通常配置了 WPA2 和 WPA3 标准。前述的安全标准也为小型网络和普通消费者设计，因为它们通过使用一个共享密码（称为 **预共享密钥**
    (**PSK**)）来简化配置。因此，任何想要访问无线网络的人都需要相同的 PSK。在大型环境中，需要提高无线网络用户的安全性和集中管理。安全专家通常会在网络上实现一个
    **认证、授权与计费** (**AAA**) 服务器，如 **远程认证拨号用户服务** (**RADIUS**)，以处理网络用户、帐户和策略的集中管理。以下是无线网络的访问方法：
- en: '**Pre-Shared Key** (**PSK**) – This methods enables you to configure a password
    or passphrase on the wireless router or access point. Anyone with the PSK can
    access the network.'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预共享密钥** (**PSK**) – 这种方法允许你在无线路由器或接入点上配置密码或密码短语。任何拥有 PSK 的人都可以访问网络。'
- en: Enterprise – This method leverages a centralized access server running RADIUS
    to handle AAA. Each user on the wireless network will require a unique user account
    to be created on the access server, with policies assigned to the account and
    logs are generated for accountability.
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 企业版 – 这种方法利用运行 RADIUS 的集中访问服务器来处理 AAA。无线网络上的每个用户都需要在访问服务器上创建一个独特的用户帐户，并为该帐户分配策略，同时生成日志以确保问责制。
- en: '**Wi-Fi Protected Setup** (**WPS**) – This access method removes the need for
    using passwords and passphrases on the wireless network. It provides an easy method
    to authenticate to the wireless network using an 8-digit pin. However, there are
    known security vulnerabilities and attacks on retrieving the WPS pin.'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Wi-Fi 受保护设置** (**WPS**) – 这种访问方法取消了在无线网络上使用密码和密码短语的需求。它提供了一种通过 8 位数字 PIN
    来轻松认证无线网络的方法。然而，已知存在安全漏洞和攻击方式来获取 WPS PIN。'
- en: 'Therefore, in this section, you will learn how to setup a wireless penetration
    testing lab environment that supports security testing for both personal and enterprise
    wireless networks. You will need a wireless router or access point that supports
    WEP to learn how to perform security testing on older security standards, WPA2-Personal
    for security testing on newer security standards, and WPA2-Enterprise for security
    testing of enterprise wireless networks. In addition, having a wireless router
    which supports WPA3 will be beneficial for learning how to compromise WPA3 targeted
    networks.The following diagram shows the wireless penetration testing lab environment:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在这一部分，你将学习如何设置支持个人和企业无线网络安全测试的无线渗透测试实验环境。你将需要一个支持WEP的无线路由器或接入点，来学习如何对旧的安全标准进行安全测试，WPA2-Personal用于新安全标准的安全测试，WPA2-Enterprise用于企业无线网络的安全测试。此外，拥有支持WPA3的无线路由器将有助于学习如何攻破WPA3目标网络。以下图示展示了无线渗透测试实验环境：
- en: '![](../media/file107.png)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file107.png)'
- en: As shown in the preceding diagram, the RADIUS server (access server) and wireless
    router/access point is connected to an organization internal network. Therefore,
    if an attacker is able to compromise the wireless network, the adversary will
    gain unauthorized access to the corporate network and perform lateral movement.The
    next section will demonstrate how to set up RADIUS on top a Ubuntu server as a
    virtual machine on your computer and associate it with a wireless router or access
    point.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 如前图所示，RADIUS服务器（接入服务器）和无线路由器/接入点连接到组织的内部网络。因此，如果攻击者能够攻破无线网络，敌方将获得未授权的访问权限，进而执行横向移动。下一部分将演示如何在你的计算机上设置RADIUS，并将其与无线路由器或接入点关联。
- en: Setting up a RADIUS server
  id: totrans-208
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置RADIUS服务器
- en: 'In this section, we will be leveraging the power of virtualization to set up
    a RADIUS server, such as FreeRadius, on our network to handle the AAA processes
    of the wireless router for testing WPA2-Enterprise.To get started with this exercise,
    please use the following instructions:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将利用虚拟化的力量，在我们的网络上设置一个RADIUS服务器，如FreeRadius，来处理无线路由器的AAA流程，用于测试WPA2-Enterprise。要开始这项练习，请按照以下说明操作：
- en: Part 1 – Install a Ubuntu server
  id: totrans-210
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 第1部分 – 安装Ubuntu服务器
- en: Firstly, you’ll need to download and setup Ubuntu Server as a virtual machine.
    On your host machine, go to [https://ubuntu.com/download/server](https://ubuntu.com/download/server)
    to download the **Ubuntu Server 22.04 LTS** ISO image.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，你需要下载并设置Ubuntu Server作为虚拟机。在你的主机上，访问[https://ubuntu.com/download/server](https://ubuntu.com/download/server)下载**Ubuntu
    Server 22.04 LTS** ISO镜像。
- en: Next, open **Oracle VM VirtualBox Manager** and click on **New** to create a
    new virtual machine.
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，打开**Oracle VM VirtualBox Manager**并点击**新建**来创建一个新的虚拟机。
- en: 'On the Create Virtual Machine window, ensure you use the following configurations:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建虚拟机窗口，确保使用以下配置：
- en: 'Name: Radius Server'
  id: totrans-214
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：Radius Server
- en: 'ISO Image: Use the drop-down menu, select Other, then select the Ubuntu Server
    ISO file.'
  id: totrans-215
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: ISO镜像：使用下拉菜单，选择“其他”，然后选择Ubuntu Server ISO文件。
- en: 'Type: Linux'
  id: totrans-216
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类型：Linux
- en: 'Version: Ubuntu (64-bit)'
  id: totrans-217
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 版本：Ubuntu（64位）
- en: 'Skip Unattended Installation: Check the box'
  id: totrans-218
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跳过无人值守安装：勾选该框
- en: 'The following screenshot shows the preceding configurations:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了前述配置：
- en: '![](../media/file108.png)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file108.png)'
- en: After clicking on **Finish** to save the new virtual machine, select the **Radius
    Server** virtual machine and click on **Settings**.
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**保存新虚拟机后，选择**Radius Server**虚拟机并点击**设置**。
- en: 'On the **Settings** windows, select the Network category and use the following
    configurations for Adapter 1:'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**设置**窗口中，选择网络类别，并为适配器1使用以下配置：
- en: Enable the network adapter
  id: totrans-223
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启用网络适配器
- en: 'Attached to: Bridged Adapter'
  id: totrans-224
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 附加到：桥接适配器
- en: 'Name: Use the drop-down menu to select your physical network adapter on your
    host machine that’s connected to your physical network.'
  id: totrans-225
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 名称：使用下拉菜单选择与物理网络连接的主机上的物理网络适配器。
- en: Next, power-on the **Radius Server** virtual machine to start the installation
    process of Ubuntu Server.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，启动**Radius Server**虚拟机以开始Ubuntu Server的安装过程。
- en: On the installation window, select **Try or Install Ubuntu Server** option to
    start the installation process.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装窗口中，选择**试用或安装Ubuntu Server**选项以开始安装过程。
- en: Next, select your preferred language and hit **Enter**.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择你偏好的语言并按**回车**。
- en: Next, select your preferred keyboard configuration and select **Done**.
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，选择你偏好的键盘配置并选择**完成**。
- en: On the **Choose type of install**, select Ubuntu Server and select **Done**.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择安装类型**菜单中，选择Ubuntu Server并选择**完成**。
- en: Next, on the **Network connection** menu, an IP address will automatically be
    assigned to this Ubuntu Server from your network, ensure you take note of the
    address and select **Done**.
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在**网络连接**菜单中，将自动为此Ubuntu Server从您的网络分配一个IP地址，请确保记下该地址并选择**完成**。
- en: On the **Configure proxy** menu, leave as default and select **Done**.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**配置代理**菜单中，保持默认设置并选择**完成**。
- en: On the **Configure Ubuntu archive mirror** menu, leave as default and select
    **Done**.
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**配置Ubuntu归档镜像**菜单中，保持默认设置并选择**完成**。
- en: On the **Guided storage configuration** menu, leave as default and select **Done**.
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**引导存储配置**菜单中，保持默认设置并选择**完成**。
- en: On the **Storage configuration** menu, leave as default and select **Done**.
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**存储配置**菜单中，保持默认设置并选择**完成**。
- en: When the **Confirm destructive action** window appears, select **Continue**.
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当**确认破坏性操作**窗口出现时，选择**继续**。
- en: On the **Profile setup** menu, create a user account for yourself and select
    **Done**.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**配置文件设置**菜单中，为自己创建一个用户账户并选择**完成**。
- en: On the **Upgrade to Ubuntu Pro** menu, leave as default and select **Continue**.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**升级到Ubuntu Pro**菜单中，保持默认设置并选择**继续**。
- en: On the **SSH Setup** menu, use the spacebar on your keyboard to select **Install
    OpenSSH server** option, then select **Done**.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**SSH设置**菜单中，使用键盘上的空格键选择**安装OpenSSH服务器**选项，然后选择**完成**。
- en: Next, the **Featured Server Snaps** menu will appear, leave as default and select
    **Done**.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，**特色服务器快照**菜单将出现，保持默认设置并选择**完成**。
- en: The installation process will take some time to complete as it will attempt
    to automatically download and install updates. After this process is completed,
    select **Reboot Now**.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装过程需要一些时间完成，因为它会尝试自动下载并安装更新。完成此过程后，选择**立即重启**。
- en: After the reboot, if there’s an error on automatically ejecting the ISO file
    from the cd-rom drive, simply hit Enter on the console screen to continue.
  id: totrans-242
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 重启后，如果ISO文件未能从光驱中自动弹出，只需在控制台屏幕上按Enter键继续。
- en: Part 2 – Setting up FreeRadius
  id: totrans-243
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 第二部分 – 设置FreeRadius
- en: 'In this section, you will learn how to setup FreeRadius on the Ubuntu server,
    create user accounts for users on the wireless network.Please use the following
    instruction to get started with this exercise:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中，您将学习如何在Ubuntu服务器上设置FreeRadius，创建无线网络用户的用户账户。请使用以下说明开始此练习：
- en: Ensure the **Radius Server** virtual machine is running in **Oracle VM VirtualBox
    Manager**.
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保**Radius服务器**虚拟机在**Oracle VM VirtualBox管理器**中运行。
- en: 'Next, on your Windows host machine, open the Windows **Command Prompt** application
    and use the following commands to remotely connect to the virtual machine:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在Windows主机上，打开Windows的**命令提示符**应用程序，并使用以下命令远程连接到虚拟机：
- en: '[PRE20]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The following screenshots the expected output when executing the preceding
    commands:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了执行前述命令时的预期输出：
- en: '![](../media/file109.png)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file109.png)'
- en: Keep in mind, passwords are invisible when you’re entering them on a terminal
    interface for security reasons.
  id: totrans-250
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 请记住，在终端界面输入密码时，为了安全原因，密码是不可见的。
- en: 'Next, use the following commands to update the local package repository list
    and install FreeRadius:'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令更新本地软件包仓库列表并安装FreeRadius：
- en: '[PRE21]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The following screenshot shows the execution of the preceding commands:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了执行前述命令的结果：
- en: '![](../media/file110.png)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file110.png)'
- en: 'Next, use the following commands to verify the sub-directories of FreeRadius:'
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令验证FreeRadius的子目录：
- en: '[PRE22]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The following screenshot shows the list of files and directories within the
    3.0 folder:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了3.0文件夹内的文件和目录列表：
- en: '![](../media/file111.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file111.png)'
- en: The `users` file contains the user credentials, while the `clients.conf` file
    contains the AAA client accounts, such as the wireless router within our lab topology.
  id: totrans-259
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '`users`文件包含用户凭据，而`clients.conf`文件包含AAA客户端账户，例如我们实验室拓扑中的无线路由器。'
- en: 'Next, let’s use the Nano command-line text editor to modify the `users` file
    and create a user account:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用Nano命令行文本编辑器修改`users`文件并创建一个用户账户：
- en: '[PRE23]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Using the directional keys on your keyboard, to the following line:'
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用键盘上的方向键，选择以下行：
- en: '[PRE24]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Then uncomment the line by removing the `#` symbol and change the password
    from `hello` to `password123` as shown below:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 然后通过删除`#`符号取消注释该行，并将密码从`hello`更改为`password123`，如下面所示：
- en: '![](../media/file112.png)'
  id: totrans-265
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file112.png)'
- en: Next, save the file by pressing `CTRL + X`, then `Y` and Enter.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，按 `CTRL + X`，然后按 `Y` 和 Enter 键保存文件。
- en: 'Next, let’s create a client account for the wireless router, use the following
    commands to edit the `clients.conf` file:'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们创建一个无线路由器的客户端账户，使用以下命令编辑 `clients.conf` 文件：
- en: '[PRE25]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Using the directional keys, go to the **Defines a RADIUS client** section and
    insert the following code:'
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用方向键，进入 **定义 RADIUS 客户端** 部分，并插入以下代码：
- en: '[PRE26]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The following screenshots shows the preceding code within the `clients.conf`
    file:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了 `clients.conf` 文件中的前述代码：
- en: '![](../media/file113.png)'
  id: totrans-272
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file113.png)'
- en: The client IP address (`172.16.17.123`) is the IP address of the wireless router,
    please sure you check the IP address of your wireless router and substitute with
    the one in the preceding code. If the client IP address is not the same as your
    wireless router, the user (bob) will not be able to authenticate to the RADIUS
    server.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端 IP 地址（`172.16.17.123`）是无线路由器的 IP 地址，请确保检查无线路由器的 IP 地址，并用前述代码中的 IP 地址替换。如果客户端
    IP 地址与无线路由器的 IP 地址不同，用户（bob）将无法通过 RADIUS 服务器进行身份验证。
- en: Press `CTRL + X`, then `Y` and Enter to save the file.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按 `CTRL + X`，然后按 `Y` 和 Enter 键保存文件。
- en: 'Next, use the following commands to restart the FreeRadius service and verify
    it’s status:'
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令重新启动 FreeRadius 服务并验证其状态：
- en: '[PRE27]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'The following screenshot shows the `freeradius` service is active and running:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了 `freeradius` 服务已启动并正在运行：
- en: '![](../media/file114.png)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file114.png)'
- en: 'Additionally, use the `sudo lsof -i -P -n | grep freerad` command to verify
    ports `1812` and `1813` are open for the FreeRadius services as shown below:'
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此外，使用 `sudo lsof -i -P -n | grep freerad` 命令验证端口 `1812` 和 `1813` 是否为 FreeRadius
    服务打开，如下所示：
- en: '![](../media/file115.png)'
  id: totrans-280
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file115.png)'
- en: Part 3 – Setting the wireless router with RADIUS
  id: totrans-281
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 第三部分 – 配置带有 RADIUS 的无线路由器
- en: 'This section will show you how to configure a wireless router to operate query
    a RADIUS server on the network. For this section, you will need a physical wireless
    router that supports the WPA2-Personal, and WPA-Enterprise security modes. The
    following diagram shows the IP addresses of the RADIUS server and wireless router,
    keep in mind the IP addresses may be different on your personal network:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分将展示如何配置无线路由器以查询网络上的 RADIUS 服务器。在本部分中，您需要一台支持 WPA2-Personal 和 WPA-Enterprise
    安全模式的物理无线路由器。下图展示了 RADIUS 服务器和无线路由器的 IP 地址，注意您的个人网络中 IP 地址可能会有所不同：
- en: '![](../media/file116.png)'
  id: totrans-283
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file116.png)'
- en: 'To get started configuring the wireless router with RADIUS, please use the
    following guidelines:'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始配置带有 RADIUS 的无线路由器，请使用以下指南：
- en: Power-on the wireless router and login to the management dashboard.
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开无线路由器并登录管理仪表盘。
- en: 'Next, go to the **Wireless** tab and change the **Network Name** (**SSID**)
    to `Target_Net`, as shown below:'
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，进入 **无线** 选项卡，将 **网络名称**（**SSID**）更改为 `Target_Net`，如下所示：
- en: '![](../media/file117.png)'
  id: totrans-287
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file117.png)'
- en: 'Next, on the Wireless Security menu, use the following configuration to enable
    the wireless router to query the RADIUS server on the network:'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在无线安全菜单中，使用以下配置使无线路由器能够查询网络中的 RADIUS 服务器：
- en: 'Security Mode: WPA2-Enterprise'
  id: totrans-289
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全模式：WPA2-Enterprise
- en: 'Encryption: AES'
  id: totrans-290
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 加密：AES
- en: 'RADIUS Server: Enter the IP address of the RADIUS server virtual machine'
  id: totrans-291
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: RADIUS 服务器：输入 RADIUS 服务器虚拟机的 IP 地址
- en: 'RADIUS Port: 1812'
  id: totrans-292
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: RADIUS 端口：1812
- en: 'Shared Secret: radiusclientpassword1'
  id: totrans-293
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 共享密钥：radiusclientpassword1
- en: 'The following screenshot shows the preceding configurations when applied to
    the wireless router:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了将前述配置应用于无线路由器时的情况：
- en: '![](../media/file118.png)'
  id: totrans-295
  prefs: []
  type: TYPE_IMG
  zh: '![](../media/file118.png)'
- en: Keep in mind, you need to ensure the IP address on your wireless router matches
    the IP address within the `clients.conf` file on the RADIUS server, as well as
    the IP address of the RADIUS server matches the IP address on the wireless security
    configuration on the wireless router.Having completed this section, you have learned
    how to set up a wireless penetration testing lab environment to perform advanced
    penetration testing techniques.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，您需要确保无线路由器上的 IP 地址与 RADIUS 服务器上的 `clients.conf` 文件中的 IP 地址匹配，同时 RADIUS 服务器的
    IP 地址与无线路由器上的无线安全配置中的 IP 地址匹配。完成本部分后，您已学习如何设置一个无线渗透测试实验室环境，以执行高级渗透测试技术。
- en: Summary
  id: totrans-297
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 总结
- en: During this chapter, you have gained the hands-on skills to build a Windows
    environment that simulates a typical enterprise organization with domain users,
    various service accounts, administrators, and shared network resources. Additionally,
    you have learnt how to create a wireless network lab that contains a RADIUS server
    to provide AAA services, which help replicate an enterprise wireless network within
    a large organization. These lab environments will be utilized later in this book
    when you learn about advanced penetration testing techniques such as red team
    exercises.I trust that the knowledge presented in this chapter has provided you
    with valuable insights, supporting your path towards becoming an ethical hacker
    and penetration tester in the dynamic field of cybersecurity. May this newfound
    understanding empower you in your journey, allowing you to navigate the industry
    with confidence and make a significant impact. In the next chapter, *Reconnaissance
    and Network Penetration Testing*, you will learn how to perform **Open Source
    Intelligence** (**OSINT**) to passively collect sensitive information on a target.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你已经掌握了构建一个Windows环境的实践技能，这个环境模拟了一个典型的企业组织，包含域用户、各种服务账户、管理员和共享网络资源。此外，你还学习了如何创建一个包含RADIUS服务器的无线网络实验室，用于提供AAA服务，帮助你在大型组织中复制企业无线网络。这些实验室环境将在本书后续章节中被用到，尤其是在你学习高级渗透测试技术（如红队演习）时。我相信本章所呈现的知识为你提供了宝贵的洞察，支持你在网络安全这个动态领域中成为一名道德黑客和渗透测试员的道路。愿这份新获得的理解赋能你的旅程，让你以自信的姿态在行业中前行，并产生深远的影响。在下一章，*侦察与网络渗透测试*，你将学习如何执行**开源情报**（**OSINT**），以被动方式收集目标的敏感信息。
- en: Further Reading
  id: totrans-299
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: Active Directory Domain Services - [https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/install-active-directory-domain-services--level-100-](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/install-active-directory-domain-services--level-100-)
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 活动目录域服务 - [https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/install-active-directory-domain-services--level-100-](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/deploy/install-active-directory-domain-services--level-100-)
- en: Wireless security standards - [https://www.techtarget.com/searchnetworking/feature/Wireless-encryption-basics-Understanding-WEP-WPA-and-WPA2](https://www.techtarget.com/searchnetworking/feature/Wireless-encryption-basics-Understanding-WEP-WPA-and-WPA2)
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无线安全标准 - [https://www.techtarget.com/searchnetworking/feature/Wireless-encryption-basics-Understanding-WEP-WPA-and-WPA2](https://www.techtarget.com/searchnetworking/feature/Wireless-encryption-basics-Understanding-WEP-WPA-and-WPA2)
- en: Understanding FreeRadius - [https://www.techtarget.com/searchsecurity/definition/RADIUS](https://www.techtarget.com/searchsecurity/definition/RADIUS)
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解FreeRadius - [https://www.techtarget.com/searchsecurity/definition/RADIUS](https://www.techtarget.com/searchsecurity/definition/RADIUS)
