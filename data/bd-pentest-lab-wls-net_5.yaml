- en: Chapter 5. Implementing Security
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章 实施安全性
- en: 'This chapter is dedicated to security solutions, as well as their installation
    and configuration. It will show you how to protect the lab environment from external
    attacks and unauthorized access, and how improve the lab complexity to practice
    advanced penetration testing and hacking techniques at the same time. We are going
    to divide security solutions and measures into two main groups: host-based (protecting
    hosts they are installed on) and network-based (protecting the whole lab network).
    Additionally, we want to have a closer look at a security information and event
    management solution that can be used to work together with the security mechanisms
    in order to identify network attacks and constantly monitor the security of a
    network.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章专注于安全解决方案及其安装和配置。它将向你展示如何保护实验环境免受外部攻击和未经授权的访问，并且如何提高实验室复杂度，从而同时练习高级渗透测试和黑客技术。我们将把安全解决方案和措施分为两大类：基于主机的（保护它们所安装的主机）和基于网络的（保护整个实验室网络）。此外，我们还希望深入了解一种安全信息和事件管理解决方案，它可以与安全机制配合使用，以识别网络攻击并持续监控网络的安全性。
- en: 'This chapter covers the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包括以下主题：
- en: Network-based security measures
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于网络的安全措施
- en: Host-based security measures
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于主机的安全措施
- en: Security information and event management system
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全信息和事件管理系统
- en: Network-based security solutions
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于网络的安全解决方案
- en: 'In this chapter, we are not trying to adhere to the levels of the standard
    ISO/OSI model, but we distinguish two main abstract security levels: network and
    host levels.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们并不打算严格遵循标准ISO/OSI模型的各个层次，而是区分了两大抽象的安全层次：网络层和主机层。
- en: The host level is represented with host-based security solutions that are aimed
    towards protecting a certain host. However, network-based solutions are aimed
    towards protecting the whole network or its parts (or groups of hosts). We would
    like to start the chapter with network-based solutions.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 主机层通过基于主机的安全解决方案来保护特定主机。然而，基于网络的解决方案则旨在保护整个网络或其部分（或主机组）。我们希望从基于网络的解决方案开始本章内容。
- en: Configuring network access control
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置网络访问控制
- en: In order to imitate a real network and to protect our lab from access from an
    external network, we need to implement access control measures between our various
    lab VLANs on the network level. The access control mechanism that we are going
    to use is called **access control lists** (**ACLs**) and can be implemented on
    the core router.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 为了模拟一个真实的网络并保护我们的实验室不受外部网络的访问，我们需要在网络层面实施不同实验室VLAN之间的访问控制措施。我们将使用的访问控制机制被称为**访问控制列表**（**ACLs**），并可以在核心路由器上实现。
- en: Generally speaking, ACL is a list of rules determining which traffic is allowed
    or disallowed and in which directions. We are also going to create several ACLs
    that will block or allow network traffic between various VLANs.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，ACL是一个规则列表，用来决定哪些流量是允许或不允许的，且指明流量的方向。我们还将创建几个ACL，来阻止或允许不同VLAN之间的网络流量。
- en: You may think that logically it should be done in [Chapter 3](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 3. Configuring Networking Lab Components"), *Configuring Networking Lab
    Components* during the network device configuration and you would be right! But
    we decided to put the ACL subtopic in this chapter because it influences the security
    of the whole lab environment and not only devices, and it should be emphasized.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会认为，逻辑上这应该在[第3章](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "第3章 配置网络实验室组件")，*配置网络实验室组件*中进行网络设备配置时完成，确实如此！但我们决定将ACL子话题放在这一章，因为它影响的是整个实验室环境的安全，而不仅仅是设备，所以应该重点强调。
- en: Isolating external and guest networks
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 隔离外部和访客网络
- en: 'For the security of our lab, we need to isolate untrusted network segments
    as is required according to the communication rules described in [Chapter 3](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 3. Configuring Networking Lab Components"), *Configuring Networking Lab
    Components*. Let''s quickly recall them:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保证实验室的安全，我们需要按照[第3章](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "第3章 配置网络实验室组件")，*配置网络实验室组件*中描述的通信规则来隔离不受信任的网络段。让我们快速回顾一下这些规则：
- en: '| Source | Allowed destination | Purpose |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| 源 | 允许的目标 | 目的 |'
- en: '| --- | --- | --- |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Admin workstation |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| 管理工作站 |'
- en: All network devices
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有网络设备
- en: All servers
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有服务器
- en: All user workstations
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有用户工作站
- en: Internet (external network)
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: '| Network and system administration |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| 网络与系统管理 |'
- en: '| Servers |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| 服务器 |'
- en: Internet (external network)
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: '| Software installation and updates |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| 软件安装和更新 |'
- en: '| User workstations |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| 用户工作站 |'
- en: Internet (external network)
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: Servers
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器
- en: '| Internet access, access to the internal network services |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| 互联网访问，访问内部网络服务 |'
- en: '| Trusted WLAN |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| 受信任 WLAN |'
- en: Internet (external network)
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: Servers
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器
- en: '| Internet access, access to the internal network services |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| 互联网访问，访问内部网络服务 |'
- en: '| Guest WLAN |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| 客户端 WLAN |'
- en: Internet (external network)
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: '| Internet access |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| 互联网访问 |'
- en: 'First, we need to block all the incoming traffic from the external network
    and isolate the guest WLAN. Log in to the router console, start the configuration
    mode, and create an ACL for that purpose called `wan` with the following commands:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要阻止所有来自外部网络的入站流量，并隔离客户 WLAN。登录到路由器控制台，启动配置模式，并创建一个名为 `wan` 的 ACL，使用以下命令：
- en: '[PRE0]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Let''s quickly explain what we have just done:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速解释一下我们刚刚做了什么：
- en: The first and the sixth lines create extended named ACLs with the names `wan`
    and `guest` and enter the ACL configuration mode.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第一行和第六行创建了名为 `wan` 和 `guest` 的扩展命名 ACL，并进入 ACL 配置模式。
- en: The second and seventh commands set the user-friendly comments for the new ACLs.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第二行和第七行的命令设置了新 ACL 的用户友好注释。
- en: The third and fourth lines deny all IP and ICMP traffic from the network 192.168.0.0/16
    to any destination. We are using the keyword `log` to write all denied packets
    to the log for a further analysis (it allows us to detect possible attacks on
    our lab).
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第三行和第四行拒绝来自网络 192.168.0.0/16 到任何目的地的所有 IP 和 ICMP 流量。我们使用关键字 `log` 将所有被拒绝的包写入日志，以便进一步分析（这使我们能够检测到可能的攻击）。
- en: The last two commands deny all IP and ICMP traffic from any source to the 192.168.0.0/16
    network.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后两条命令拒绝所有来自任何来源到 192.168.0.0/16 网络的 IP 和 ICMP 流量。
- en: 'Now, we need to apply the ACL to the router subinterface, serving communications
    with an external network (in our case it is `fa0/0.5`). Exit the ACL configuration
    mode and get into the interface configuration mode (if you have defined sub-interfaces
    other than the ones we have done, just substitute `fa0/0.5` with the one corresponding
    to your subinterface connected to a SOHO router):'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要将 ACL 应用到路由器子接口，该子接口负责与外部网络的通信（在我们的例子中是 `fa0/0.5`）。退出 ACL 配置模式，进入接口配置模式（如果你定义了与我们所做的不同的子接口，只需将
    `fa0/0.5` 替换为与你的 SOHO 路由器连接的子接口对应的接口）：
- en: '[PRE1]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, assign the ACL called `wan` to be applied on network traffic coming to
    the subinterface from outside:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，分配名为 `wan` 的 ACL 以应用于来自外部的网络流量到子接口：
- en: '[PRE2]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Next, assign the ACL called `guest` to be applied on network traffic coming
    to the subinterface from inside:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，分配名为 `guest` 的 ACL，以应用于来自内部的网络流量到子接口：
- en: '[PRE3]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Isolating internal VLANs
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 隔离内部 VLAN
- en: 'The following ACL for the rest of the router subinterfaces can be created and
    applied in a similar manner. Therefore, we will put them in a table for convenience:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 可以以类似的方式创建并应用其他路由器子接口的 ACL。因此，我们将它们放入表格中以方便查看：
- en: '| Name | Subinterface | Direction | ACL | Remark |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 子接口 | 方向 | ACL | 备注 |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| `trusted-in` | `fa0/0.4` | `in` | `deny ip 172.16.1.0 0.0.0.255 172.16.0.0
    0.0.0.255``deny ip 172.16.1.0 0.0.0.255 10.1.0.0 0.0.0.255``deny icmp 172.16.1.0
    0.0.0.255 172.16.0.0 0.0.0.255``deny icmp 172.16.1.0 0.0.0.255 10.1.0.0 0.0.0.255``permit
    ip any any``permit icmp any any` | Access from trusted WLANs |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| `trusted-in` | `fa0/0.4` | `in` | `deny ip 172.16.1.0 0.0.0.255 172.16.0.0
    0.0.0.255``deny ip 172.16.1.0 0.0.0.255 10.1.0.0 0.0.0.255``deny icmp 172.16.1.0
    0.0.0.255 172.16.0.0 0.0.0.255``deny icmp 172.16.1.0 0.0.0.255 10.1.0.0 0.0.0.255``permit
    ip any any``permit icmp any any` | 来自受信任 WLAN 的访问 |'
- en: '| `users-in` | `fa0/0.3` | `in` | `deny ip 172.16.0.0 0.0.0.255 172.16.1.0
    0.0.0.255``deny ip 172.16.0.0 0.0.0.255 10.1.0.0 0.0.0.255``deny icmp 172.16.0.0
    0.0.0.255 172.16.1.0 0.0.0.255``deny icmp 172.16.0.0 0.0.0.255 10.1.0.0 0.0.0.255``permit
    ip any any``permit icmp any any` |   |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| `users-in` | `fa0/0.3` | `in` | `deny ip 172.16.0.0 0.0.0.255 172.16.1.0
    0.0.0.255``deny ip 172.16.0.0 0.0.0.255 10.1.0.0 0.0.0.255``deny icmp 172.16.0.0
    0.0.0.255 172.16.1.0 0.0.0.255``deny icmp 172.16.0.0 0.0.0.255 10.1.0.0 0.0.0.255``permit
    ip any any``permit icmp any any` |   |'
- en: '| `servers-in` | `fa0/0.2` | `in` | `permit ip 10.0.0.0 0.0.0.255 172.16.0.0
    0.0.255.255 established``permit icmp 10.0.0.0 0.0.0.255 172.16.0.0 0.0.255.255
    established``deny ip 10.0.0.0 0.0.0.255 172.16.0.0 0.0.255.255``deny icmp 10.0.0.0
    0.0.0.255 172.16.0.0 0.0.255.255``deny ip 10.0.0.0 0.0.0.255 10.1.0.0 0.0.255.255``deny
    icmp 10.0.0.0 0.0.0.255 10.1.0.0 0.0.255.255``permit ip any any``permit icmp any
    any` | Deny connections to users and trusted WLANs initiated by servers |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| `servers-in` | `fa0/0.2` | `in` | `permit ip 10.0.0.0 0.0.0.255 172.16.0.0
    0.0.255.255 established``permit icmp 10.0.0.0 0.0.0.255 172.16.0.0 0.0.255.255
    established``deny ip 10.0.0.0 0.0.0.255 172.16.0.0 0.0.255.255``deny icmp 10.0.0.0
    0.0.0.255 172.16.0.0 0.0.255.255``deny ip 10.0.0.0 0.0.0.255 10.1.0.0 0.0.255.255``deny
    icmp 10.0.0.0 0.0.0.255 10.1.0.0 0.0.255.255``permit ip any any``permit icmp any
    any` | 拒绝服务器发起的用户和可信 WLAN 的连接 |'
- en: Securing wireless access
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确保无线访问安全
- en: According to our lab idea, we want to have secure wireless access to the lab
    environment, a trusted WLAN.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的实验室设计，我们希望能够实现对实验室环境的安全无线访问，即一个可信的 WLAN。
- en: As you remember from [Chapter 1](part0014_split_000.html#DB7S2-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 1. Understanding Wireless Network Security and Risks"), *Understanding
    Wireless Network Security and Risks*, the best way to secure WLAN access is to
    implement WPA-Enterprise security based on the IEEE 802.1x standard. To be more
    exact, it should be based on **EAP over LAN** (**EAPOL**) and an AAA server.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你在[第1章](part0014_split_000.html#DB7S2-3ecab517ca6e4afbb3c20ab15f7b4d82 "第1章：理解无线网络安全与风险")中记得的那样，*理解无线网络安全与风险*，确保
    WLAN 访问的最佳方式是实现基于 IEEE 802.1x 标准的 WPA-Enterprise 安全性。更准确地说，它应该基于 **EAP over LAN**
    (**EAPOL**) 和一个 AAA 服务器。
- en: We decided to choose FreeRADIUS as a suitable solution for an AAA server. FreeRADIUS
    is a software package containing a RADIUS server software and several auxiliary
    libraries and modules. Currently, we are interested only in the RADIUS server,
    which is enough to fulfill our tasks.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们决定选择 FreeRADIUS 作为适合的 AAA 服务器解决方案。FreeRADIUS 是一个包含 RADIUS 服务器软件以及多个辅助库和模块的软件包。目前，我们只对
    RADIUS 服务器感兴趣，这足以完成我们的任务。
- en: FreeRADIUS is a very popular solution with a modular architecture. It works
    really fast and distributes the important services for a lab, free of charge.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: FreeRADIUS 是一个非常流行的解决方案，具有模块化架构。它运行非常快速，并且免费为实验室分发重要服务。
- en: 'Before we start implementing the solution, we would like to list our next steps
    to give you a clearer overview of the whole process:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始实施解决方案之前，我们想列出接下来的步骤，以便给你一个更清晰的整个过程概览：
- en: Preparing a VM with FreeRADIUS.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 准备带有 FreeRADIUS 的虚拟机。
- en: Creating certificates.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建证书。
- en: Configuring a RADIUS server.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置 RADIUS 服务器。
- en: Configuring an access point.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置接入点。
- en: Configuring a WLAN client.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置 WLAN 客户端。
- en: Preparing the RADIUS server
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 准备 RADIUS 服务器
- en: 'We are going to install FreeRADIUS on a Debian-based virtual Linux server and
    put it into the server subnet on IP address 10.0.0.6\. The installation process
    is very similar to the Ubuntu Server installation process:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在基于 Debian 的虚拟 Linux 服务器上安装 FreeRADIUS，并将其放置在 IP 地址为 10.0.0.6 的服务器子网中。安装过程与
    Ubuntu Server 安装过程非常相似：
- en: Create a VM with 1024 MB RAM.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个 1024 MB 内存的虚拟机。
- en: Download a Debian Linux 8 (Jessie) image from the official website.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从官方网站下载 Debian Linux 8（Jessie）镜像。
- en: Install Debian Linux using guided installation and don't forget to set strong
    passwords for the root and non-root users during the installation, as this server
    will provide lab's security and we don't want it to be vulnerable.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用引导安装安装 Debian Linux，并且不要忘记在安装过程中为 root 用户和非 root 用户设置强密码，因为该服务器将提供实验室的安全性，我们不希望它存在漏洞。
- en: After the installation, start the VM and log in under the root account.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，启动虚拟机并以 root 账户登录。
- en: Make sure that the VM can access the Internet. Use NAT if is not connected to
    the lab network or configure IP settings if it is.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保虚拟机可以访问互联网。如果没有连接到实验室网络，请使用 NAT，或者如果已连接，请配置 IP 设置。
- en: 'Check whether the `/etc/apt/sources.list` file contains the following line:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 `/etc/apt/sources.list` 文件是否包含以下内容：
- en: '[PRE4]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: If not, add this line to the file.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果没有，将此行添加到文件中。
- en: Update the packages list.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更新软件包列表。
- en: 'Install FreeRADIUS using the following commands:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令安装 FreeRADIUS：
- en: '[PRE5]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Note
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Alternatively, you can download the newest version of FreeRADIUS from the official
    FTP server and compile it (change the package version number to the current one
    and make sure that the `gcc` compiler is installed):'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你也可以从官方 FTP 服务器下载最新版本的 FreeRADIUS 并进行编译（更改软件包版本号为当前版本，并确保安装了 `gcc` 编译器）：
- en: '[PRE6]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Preparing the certificates
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 准备证书
- en: Every authorized user in our lab will have a personal certificate for the trusted
    WLAN connections, and it is logical to prepare certificates before we start to
    put their paths into the server's configuration.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 我们实验室中的每个授权用户将拥有一个用于受信WLAN连接的个人证书，因而在开始将证书路径写入服务器配置之前，准备证书是合乎逻辑的。
- en: 'You can use the lab certificate authority installed in [Chapter 4](part0029_split_000.html#RL0A1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 4. Designing Application Lab Components"), *Designing Application Lab
    Components*, to create all the necessary certificates. We already have a CA certificate
    created, so we only need to create server and client certificates and sign them
    with the CA:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用在[第4章](part0029_split_000.html#RL0A1-3ecab517ca6e4afbb3c20ab15f7b4d82 "Chapter
    4. Designing Application Lab Components")，*设计应用实验室组件*，中安装的实验室证书颁发机构（CA）来创建所有必要的证书。我们已经创建了一个CA证书，因此只需要创建服务器和客户端证书，并使用CA进行签名：
- en: 'Create a server key and a certificate request:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建服务器密钥和证书请求：
- en: '[PRE7]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Create a `lab_ca.srl` file with a two-digit serial number in it, for example,
    01.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个包含两位数序列号的`lab_ca.srl`文件，例如，01。
- en: 'Sign the server certificate request using the CA (you will need to provide
    a path to the CA certificate and key files if they are not in the current directory)
    and create a server certificate:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用CA签署服务器证书请求（如果CA证书和密钥文件不在当前目录中，你需要提供它们的路径），并创建服务器证书：
- en: '[PRE8]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Create a client key and certificate request:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建客户端密钥和证书请求：
- en: '[PRE9]'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Here, you should fill the certificate's field **Common name** with the identity
    of the user that will hold the certificate, for example, `attacker1` or `alex`.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这里，你应该填写证书的**常用名称**字段，填写持有该证书的用户身份，例如`attacker1`或`alex`。
- en: 'Sign the client certificate using the certificate authority:'
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用证书颁发机构签署客户端证书：
- en: '[PRE10]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Export the client certificate in the PKCS#12 format for a Windows client:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将客户端证书导出为PKCS#12格式，以便Windows客户端使用：
- en: '[PRE11]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You can create multiple client certificates for as many users as you would like
    to allow access to your lab via the trusted WLAN. Copy the server and CA certificates
    into the `/etc/freeradius/certs/lab` directory on the FreeRADIUS server.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以为想要通过受信WLAN访问实验室的用户创建多个客户端证书。将服务器证书和CA证书复制到FreeRADIUS服务器上的`/etc/freeradius/certs/lab`目录中。
- en: Configuring RADIUS
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置RADIUS
- en: Now, it is time to configure FreeRADIUS for our needs. The configuration files
    can be found in the `/etc/freeradius` directory.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，是时候为我们的需求配置FreeRADIUS了。配置文件可以在`/etc/freeradius`目录中找到。
- en: 'We are interested in the following configuration files now:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们关注以下配置文件：
- en: '`clients.conf`: This defines connection settings between authenticators (Cisco
    access point in our case) and an authentication server (FreeRADIUS)'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`clients.conf`：定义认证器（在我们这个例子中是思科接入点）和认证服务器（FreeRADIUS）之间的连接设置。'
- en: '`eap.conf`: This defines **extensible authentication protocol** (**EAP**) types
    and settings'
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`eap.conf`：定义**可扩展认证协议**（**EAP**）类型和设置。'
- en: clients.conf
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: clients.conf
- en: 'We need to add the following lines to the file to set the connection parameters
    for the authenticator:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要向文件中添加以下行，以设置认证器的连接参数：
- en: '[PRE12]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The `secret` parameter contains a password used by an AP to connect to the RADIUS
    server, so you might want to use a strong combination of symbols to raise the
    security of your lab.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '`secret`参数包含一个密码，用于AP连接到RADIUS服务器，因此你可能需要使用强密码组合来提高实验室的安全性。'
- en: eap.conf
  id: totrans-109
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: eap.conf
- en: 'Here, we set all the necessary parameters for the EAP-TLS authentication:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们为EAP-TLS认证设置所有必要的参数：
- en: '[PRE13]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The `certdir` and `cadir` parameters set the directory where FreeRADIUS will
    search for server and CA certificates. In our case, they are both in `/etc/freeradius/certs/lab`.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '`certdir`和`cadir`参数设置FreeRADIUS查找服务器和CA证书的目录。在我们的例子中，它们都位于`/etc/freeradius/certs/lab`。'
- en: The `private_key_password` parameter is the password that you typed when creating
    the server's private key.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`private_key_password`参数是你在创建服务器私钥时输入的密码。'
- en: Configuring the access point
  id: totrans-114
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置接入点
- en: 'We have already configured the Ethernet interface of the access point in [Chapter
    3](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82 "Chapter 3. Configuring
    Networking Lab Components"), *Configuring Networking Lab Components*, but we have
    omitted the wireless interface configuration because it is highly dependent on
    a RADIUS server which we didn''t have before the current chapter. Now it is time
    to fill this gap:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在[第3章](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82 "第3章.
    配置网络实验室组件")，*配置网络实验室组件*中配置了接入点的以太网接口，但由于无线接口的配置高度依赖于我们在当前章节之前没有配置的 RADIUS 服务器，我们略过了该部分。现在是时候弥补这一空缺了：
- en: Connect to the AP's console port and enter the privileged mode with the `enable`
    command and the password that you set during the initial AP configuration in [Chapter
    3](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82 "Chapter 3. Configuring
    Networking Lab Components"), *Configuring Networking Lab Components* (the default
    password is `Cisco`).
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 连接到 AP 的控制台端口，并使用 `enable` 命令进入特权模式，并输入您在[第3章](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "第3章. 配置网络实验室组件")，*配置网络实验室组件*中初始 AP 配置时设置的密码（默认密码为 `Cisco`）。
- en: 'Let''s configure the authentication server (RADIUS) settings first:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要配置认证服务器（RADIUS）设置：
- en: '[PRE14]'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Change `YourSecret` to the value that you have set in `clients.conf` during
    the FreeRADIUS configuration.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `YourSecret` 替换为您在 FreeRADIUS 配置中设置的 `clients.conf` 中的值。
- en: 'Now, we need to configure the radio interface called `dot11radio`:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们需要配置名为 `dot11radio` 的无线接口：
- en: '[PRE15]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '`lab_private` is the SSID for our trusted WLAN and you can change it to anything
    you like.'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`lab_private` 是我们受信 WLAN 的 SSID，您可以将其更改为您喜欢的任何名称。'
- en: 'As the next step, we will configure the WLAN settings:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一步，我们将配置 WLAN 设置：
- en: '[PRE16]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: You can omit the `guest-mode` command to disable SSID broadcasting, making your
    WLAN slightly more secure (but not really raising the security level).
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以省略 `guest-mode` 命令来禁用 SSID 广播，从而使您的 WLAN 稍微更加安全（但实际上并没有大幅提高安全性）。
- en: 'After configuring the radio interface and the SSID, we can assign the SSID
    to the interface and turn the interface on:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置无线接口和 SSID 后，我们可以将 SSID 分配给该接口并启用接口：
- en: '[PRE17]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Note
  id: totrans-128
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'If you have chosen to set a software AP for the trusted WLAN, you can use the
    following tools:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您选择为受信 WLAN 设置软件 AP，您可以使用以下工具：
- en: Built-in tools or `hostapd` software on Linux (we will show how to install and
    configure it in [Chapter 7](part0047_split_000.html#1CQAE1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 7. Preparing a Wireless Penetration Testing Platform"), *Preparing a
    Wireless Penetration Testing Platform*)
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Linux 上的内置工具或 `hostapd` 软件（我们将在[第7章](part0047_split_000.html#1CQAE1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "第7章. 准备无线渗透测试平台")，*准备无线渗透测试平台*中展示如何安装和配置它）
- en: Special software (for example, Connectify or ARPMiner) on Windows
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 上的特殊软件（例如 Connectify 或 ARPMiner）
- en: After installing and configuring the chosen software, you will need to add a
    link between a wireless network and the virtual lab infrastructure using the tool
    Cloud of the GNS3 system, as described earlier in [Chapter 3](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 3. Configuring Networking Lab Components"), *Configuring Networking Lab
    Components*.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 安装并配置所选软件后，您需要使用 GNS3 系统中的 Cloud 工具，在无线网络和虚拟实验室基础设施之间建立连接，如在[第3章](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "第3章. 配置网络实验室组件")，*配置网络实验室组件*中所述。
- en: Configuring the WLAN client
  id: totrans-133
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置 WLAN 客户端
- en: 'As a closing step, we need to test our newly created WLAN by connecting a client
    machine to it. Let''s do it on a Windows 8.1 machine:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 作为最后一步，我们需要通过将客户端机器连接到新创建的 WLAN 来进行测试。我们将在 Windows 8.1 机器上执行此操作：
- en: First, you need to copy the attacker's certificate in the PKCS#12 format to
    a client machine and install it.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，您需要将攻击者的证书（PKCS#12 格式）复制到客户端机器上并进行安装。
- en: Then you need to click on the networking icon in the system tray to get a list
    of available wireless networks, as with WEP- or WPA-PSK-protected networks.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，您需要点击系统托盘中的网络图标，以获取可用无线网络列表，类似于 WEP 或 WPA-PSK 保护的网络。
- en: Choose the **lab_private** option in the wireless network list and click on
    the **Other ways to connect** link:![Configuring the WLAN client](../images/00035.jpeg)
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在无线网络列表中选择 **lab_private** 选项，并点击 **其他连接方式** 链接：![配置 WLAN 客户端](../images/00035.jpeg)
- en: Then, click on **Certificate**, choose the lab certificate, and click on **OK**:![Configuring
    the WLAN client](../images/00036.jpeg)
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击**证书**，选择实验室证书，点击**确定**：![配置 WLAN 客户端](../images/00036.jpeg)
- en: 'Now, you are connected to the trusted WLAN and can penetrate our vulnerable
    servers. So far, we have reliably secured our trusted WLAN and the whole lab network
    from an unauthorized network access. We have almost reached the main goal of the
    book: building a lab with wireless access protected from attacks from outside.'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你已经连接到受信 WLAN，并可以渗透我们的易受攻击服务器。到目前为止，我们已经可靠地保护了我们的受信 WLAN 和整个实验室网络，防止了未授权的网络访问。我们几乎达到了本书的主要目标：构建一个受外部攻击保护的无线接入实验室。
- en: Installing a network intrusion detection system
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装网络入侵检测系统
- en: Now, let's see how we go ahead with installing the system in our network to
    detect any intrusion.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看如何在我们的网络中安装该系统，以检测任何入侵。
- en: Activating SPAN
  id: totrans-142
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 激活 SPAN
- en: Cisco devices have a feature called **Switched Port Analyzer** (**SPAN**), which
    basically mirrors network traffic from selected source ports to a selected destination
    port. We need this feature to copy network traffic coming through the server VLAN
    to our network-based IDS for further analysis.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 思科设备有一个名为**交换端口分析器**（**SPAN**）的功能，它基本上将选定源端口的网络流量镜像到选定的目标端口。我们需要这个功能，将通过服务器
    VLAN 传入的网络流量复制到我们的基于网络的 IDS 进行进一步分析。
- en: 'We are going to monitor the whole server traffic (ports `fa0/7`-`fa0/10`) on
    the `fa0/11` port, so let''s configure SPAN on our core switch with the following
    commands:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将监控整个服务器的流量（端口 `fa0/7` 到 `fa0/10`），通过 `fa0/11` 端口，因此让我们使用以下命令在核心交换机上配置 SPAN：
- en: '[PRE18]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Snort
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Snort
- en: Snort is a free, open source network **Intrusion Detection System** (**IDS**)
    capable of performing packet logging and real-time traffic analysis in IP-based
    networks.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: Snort 是一个免费的、开源的网络**入侵检测系统**（**IDS**），能够在基于 IP 的网络中执行数据包日志记录和实时流量分析。
- en: Note
  id: totrans-148
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: There are other alternatives to Snort that you might want to explore, for example,
    Suricata.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还想探索 Snort 的其他替代品，例如，Suricata。
- en: 'This IDS identifies the following:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 该 IDS 识别以下内容：
- en: Attacks on network protocols
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 针对网络协议的攻击
- en: Scanning (ports and services)
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描（端口和服务）
- en: DoS attacks
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DoS 攻击
- en: Attacks on services such as FTP, DNS, e-mail, and so on
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 针对 FTP、DNS、电子邮件等服务的攻击
- en: Attacks on databases
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 针对数据库的攻击
- en: Attacks on the Web
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 针对 Web 的攻击
- en: Exploits and various malwares
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞利用和各种恶意软件
- en: 'Taking into account the following points, we have a system with powerful features
    for security monitoring:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到以下几点，我们拥有一个具有强大功能的安全监控系统：
- en: Ability to write their own rules
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 能够编写自己的规则
- en: Enhanced functionality by using the connectivity modules
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用连接模块增强功能
- en: Flexible system of warning about the attacks (log files, output devices, or
    a database ID)
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 灵活的攻击警告系统（日志文件、输出设备或数据库 ID）
- en: 'Snort can be executed on various operating systems: Windows and Unix-like.
    In our case, we are using Ubuntu Server 14 and we will consider the Linux distribution.'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: Snort 可以在多种操作系统上执行：Windows 和类 Unix 系统。在我们的例子中，我们使用的是 Ubuntu Server 14，并将考虑 Linux
    发行版。
- en: Installing Snort
  id: totrans-163
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 安装 Snort
- en: 'So, the installation process is pretty simple in Ubuntu Linux. We should just
    execute one command:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，在 Ubuntu Linux 上安装过程非常简单。我们只需要执行一条命令：
- en: '[PRE19]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'After a few minutes, installation will be complete and we can start the Snort
    service on our system using the following command:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 几分钟后，安装将完成，我们可以使用以下命令在系统上启动 Snort 服务：
- en: '[PRE20]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Next, let's update the Snort rules set. You can get the latest version of the
    rules from the official website at [https://www.snort.org/downloads](https://www.snort.org/downloads)
    in the **Rules** section. We will use the **Registered user release** set, because
    it is the most up-to-date one. However, it needs registration. You can sign up
    at [https://www.snort.org/users/sign_up](https://www.snort.org/users/sign_up).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们更新 Snort 规则集。你可以从官方网站的[https://www.snort.org/downloads](https://www.snort.org/downloads)
    **规则**部分获取最新版本的规则。我们将使用**注册用户版本**，因为它是最新的。然而，这需要注册。你可以在[https://www.snort.org/users/sign_up](https://www.snort.org/users/sign_up)注册。
- en: 'After downloading, let''s unpack the downloaded archive file and copy the rules
    directories `so_rules` and `preproc_rules` in `/etc/snort`:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 下载后，让我们解压下载的压缩文件并将规则目录 `so_rules` 和 `preproc_rules` 复制到 `/etc/snort`：
- en: '[PRE21]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'After that, we need to restart Snort:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们需要重启 Snort：
- en: '[PRE22]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: After all these manipulations, we have a working instance of the IDS Snort system.
    Next, let's configure our intrusion detection system in more detail.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 完成所有这些操作后，我们有了一个工作中的 IDS Snort 系统实例。接下来，让我们更详细地配置我们的入侵检测系统。
- en: Configuring Snort
  id: totrans-174
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 配置 Snort
- en: 'The main configuration of Snort is located in the `snort.conf` file in the
    `/etc/snort/` directory. Initially, this file is based on the example configuration.
    It is big but very well commented, so it should not make you seriously confused.
    The configuration file consists of nine sections:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: Snort 的主要配置位于 `/etc/snort/` 目录下的 `snort.conf` 文件中。最初，该文件基于示例配置。它很大，但注释非常详细，因此不应让您感到困惑。配置文件包括九个部分：
- en: Network variables
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络变量
- en: Configuration of the decoder
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 解码器的配置
- en: Configuration of the base detection engine
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基础检测引擎的配置
- en: Configuration of dynamic loaded libraries
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 动态加载库的配置
- en: Configuration of preprocessors
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预处理器的配置
- en: Configuration of output plugins
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出插件的配置
- en: Customization of your rule set
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 规则集的自定义
- en: Customization of preprocessor and decoder rule set
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 预处理器和解码器规则集的自定义
- en: Customization of shared object rule set
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 共享对象规则集的自定义
- en: 'Let''s start with basic variables that will describe our infrastructure:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从描述我们基础设施的基本变量开始：
- en: '| Type | Variable | Value | Description |'
  id: totrans-186
  prefs: []
  type: TYPE_TB
  zh: '| 类型 | 变量 | 值 | 描述 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-187
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| `ipvar` | `HOME_NET` | [10.0.0.0/24,10.1.0.0/24] | Home network, from which
    attacks are possible. It is a host or a list of hosts whose traffic will analyze
    Snort. |'
  id: totrans-188
  prefs: []
  type: TYPE_TB
  zh: '| `ipvar` | `HOME_NET` | [10.0.0.0/24,10.1.0.0/24] | 内部网络，可能发生攻击的源。它是一个主机或一组主机，Snort
    将分析这些主机的流量。 |'
- en: '| `ipvar` | `EXTERNAL_NET` | [172.16.0.0/24,192.168.0.0/24,172.16.2.0/24] |
    The network from which the attack could begin. |'
  id: totrans-189
  prefs: []
  type: TYPE_TB
  zh: '| `ipvar` | `EXTERNAL_NET` | [172.16.0.0/24,192.168.0.0/24,172.16.2.0/24] |
    攻击可能开始的网络。 |'
- en: '| `ipvar` | `DNS_SERVERS` | 10.0.0.2 | It is a list of DNS servers. |'
  id: totrans-190
  prefs: []
  type: TYPE_TB
  zh: '| `ipvar` | `DNS_SERVERS` | 10.0.0.2 | 它是 DNS 服务器的列表。 |'
- en: '| `ipvar` | `HTTP_SERVERS` | 10.0.0.3,10.0.0.5 | It is a list of web servers.
    |'
  id: totrans-191
  prefs: []
  type: TYPE_TB
  zh: '| `ipvar` | `HTTP_SERVERS` | 10.0.0.3,10.0.0.5 | 它是 Web 服务器的列表。 |'
- en: '| `ipvar` | `SQL_SERVERS` | 10.0.0.3 | It is a list of SQL servers. |'
  id: totrans-192
  prefs: []
  type: TYPE_TB
  zh: '| `ipvar` | `SQL_SERVERS` | 10.0.0.3 | 它是 SQL 服务器的列表。 |'
- en: '| `portvar` | `HTTP_PORTS` | 80,443 | It is a list of web ports. |'
  id: totrans-193
  prefs: []
  type: TYPE_TB
  zh: '| `portvar` | `HTTP_PORTS` | 80,443 | 它是 Web 端口的列表。 |'
- en: '| `ipvar` | `SIP_SERVERS` | 10.0.0.4 | It is a list of SIP servers. |'
  id: totrans-194
  prefs: []
  type: TYPE_TB
  zh: '| `ipvar` | `SIP_SERVERS` | 10.0.0.4 | 它是 SIP 服务器的列表。 |'
- en: We leave the default values for the other settings in this file. Of course,
    you can configure Snort to work in the way that best suits your needs. Since this
    is a learning laboratory, settings in a particular case may be quite different.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 我们保留该文件中其他设置的默认值。当然，您可以配置 Snort 以最适合您需求的方式工作。由于这是一个学习实验室，特定情况下的设置可能会有所不同。
- en: 'In order for the changes to take effect, we need to restart the Snort daemon:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使更改生效，我们需要重启 Snort 守护进程：
- en: '[PRE23]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Now, we can try to run Snort:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以尝试运行 Snort：
- en: '[PRE24]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'After starting the daemon, we will check the network interface that Snort is
    listening to:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 启动守护进程后，我们将检查 Snort 正在监听的网络接口：
- en: '[PRE25]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: If the interface is in promisc mode, everything is fine.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 如果接口处于混杂模式，一切正常。
- en: Snort rules
  id: totrans-203
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: Snort 规则
- en: Writing your own rules is not difficult but is often necessary, because vulnerabilities
    are found every day, and in the case of a test laboratory, infrastructure is changing
    for the needs of tests.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 编写您自己的规则并不难，但通常是必要的，因为每天都会发现漏洞，在测试实验室的情况下，基础设施会根据测试需求不断变化。
- en: 'The structure of the rules corresponds to the following scheme:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 规则的结构遵循以下方案：
- en: <Action> <Protocol> <Port> <Direction> <Port> ([metadata] [content of the package]
    [Data] [Action after detection])
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: <动作> <协议> <端口> <方向> <端口>（[元数据] [包内容] [数据] [检测后的动作]）
- en: 'Actions are divided into the following parts:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 动作分为以下几部分：
- en: '| Action | Description |'
  id: totrans-208
  prefs: []
  type: TYPE_TB
  zh: '| 动作 | 描述 |'
- en: '| --- | --- |'
  id: totrans-209
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `alert` | Create an alert using the selected method, and pass the information
    to the system log. |'
  id: totrans-210
  prefs: []
  type: TYPE_TB
  zh: '| `alert` | 使用选定的方法创建警报，并将信息传递到系统日志。 |'
- en: '| `log` | Use the system log to record information about the package. |'
  id: totrans-211
  prefs: []
  type: TYPE_TB
  zh: '| `log` | 使用系统日志记录包的相关信息。 |'
- en: '| `pass` | Ignore the package. |'
  id: totrans-212
  prefs: []
  type: TYPE_TB
  zh: '| `pass` | 忽略该包。 |'
- en: '| `activate` | Use another dynamic rule. |'
  id: totrans-213
  prefs: []
  type: TYPE_TB
  zh: '| `activate` | 使用另一个动态规则。 |'
- en: '| `dynamic` | After you have made the active rule, a rule is activated with
    the procedure logging. |'
  id: totrans-214
  prefs: []
  type: TYPE_TB
  zh: '| `dynamic` | 在激活规则后，通过日志记录过程激活规则。 |'
- en: '| `drop` | Discard packet using a firewall, and pass information to the system
    log. It works only in the inline mode. |'
  id: totrans-215
  prefs: []
  type: TYPE_TB
  zh: '| `drop` | 使用防火墙丢弃数据包，并将信息传送到系统日志。此选项仅在内联模式下生效。 |'
- en: '| `sdrop` | Discard the packet using software firewall and do not use the system
    log. It works only in the inline mode. |'
  id: totrans-216
  prefs: []
  type: TYPE_TB
  zh: '| `sdrop` | 使用软件防火墙丢弃数据包，并且不使用系统日志。此选项仅在内联模式下生效。 |'
- en: '| `reject` | Using firewall, discard the packet if the protocol is TCP, or
    record a message in the log file: ICMP port is not available if the package comes
    over UDP. It works only in the inline mode. |'
  id: totrans-217
  prefs: []
  type: TYPE_TB
  zh: '| `reject` | 使用防火墙，若协议为TCP则丢弃数据包，或者如果数据包是通过UDP传输且ICMP端口不可用，则在日志文件中记录消息。此选项仅在内联模式下生效。
    |'
- en: 'Next, follow the protocol. This parameter can take the following values: TCP,
    UDP, IP, and ICMP.'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，遵循协议。该参数可以取以下值：TCP、UDP、IP和ICMP。
- en: 'The next three parameters determine the source and destination IP addresses
    and port numbers for the rule to be applied to. They can be set as a certain value,
    a range, or any value. A range of IP addresses can be set with a CIRD block mask
    starting with `/`, for example: `/24`. A range of ports can be set with the start
    and end port numbers separated with a colon, for example: `25 : 445`.'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的三个参数决定了规则应用的源和目标IP地址及端口号。它们可以设置为某个特定值、一个范围或任何值。IP地址范围可以通过以“/”开头的CIRD块掩码来设置，例如：`/24`。端口范围可以通过用冒号分隔的起始端口和结束端口来设置，例如：`25:445`。
- en: It also important to specify the traffic direction in which the rule should
    be applied with the symbols `->` for the direction from source to destination
    or `<>` for a bidirectional traffic flow.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，重要的是指定规则应应用的流量方向，使用符号`->`表示从源到目标的方向，或`<>`表示双向流量。
- en: After specifying all the parameters of a rule, you can also set several options
    that follow the rule header in brackets and should be separated from each other
    with a semicolon. The option keywords should be separated from their values with
    a colon.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 在指定规则的所有参数后，你还可以设置若干选项，这些选项会出现在规则头部后面并用分号分隔。选项关键词应与其值通过冒号分开。
- en: 'All options can be divided into four categories:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 所有选项可以分为四类：
- en: '| Category | Description |'
  id: totrans-223
  prefs: []
  type: TYPE_TB
  zh: '| 类别 | 描述 |'
- en: '| --- | --- |'
  id: totrans-224
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `meta-data` | These options are not specified for a data validation package.
    It contains information about the type of attack, the possible vulnerability of
    the materials, links, and so on. |'
  id: totrans-225
  prefs: []
  type: TYPE_TB
  zh: '| `meta-data` | 这些选项未指定用于数据验证包。它包含关于攻击类型、材料的潜在漏洞、链接等信息。 |'
- en: '| `payload` | Parameters of this category contain information about the data
    itself, which contains a package. |'
  id: totrans-226
  prefs: []
  type: TYPE_TB
  zh: '| `payload` | 该类别的参数包含有关数据本身的信息，这些数据包含在数据包中。 |'
- en: '| `non-payload` | This category contains official information about the packet
    (header). |'
  id: totrans-227
  prefs: []
  type: TYPE_TB
  zh: '| `non-payload` | 该类别包含关于数据包（头部）的官方信息。 |'
- en: '| `post-detection` | It specifies the tasks to be carried out after finding
    the information in the package. |'
  id: totrans-228
  prefs: []
  type: TYPE_TB
  zh: '| `post-detection` | 指定在发现数据包中的信息后需要执行的任务。 |'
- en: For effective monitoring of activities, you should learn the language rules
    of Snort. Unfortunately, the full description of all rules is beyond the scope
    of this book, but you can find more information on the Internet.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 为了有效监控活动，你应学习Snort的语言规则。不幸的是，本书无法详细描述所有规则，但你可以在互联网上找到更多信息。
- en: For now, we have a working network intrusion detection system and we can develop
    it for specific needs.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，我们已经有了一个正常工作的网络入侵检测系统，可以根据特定需求进行开发。
- en: Host-based security solutions
  id: totrans-231
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于主机的安全解决方案
- en: The second class of security solutions that we are going to cover in the current
    chapter is host-based solutions. Such solutions are installed on the same hosts
    which they have to protect.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在当前章节中介绍的第二类安全解决方案是基于主机的解决方案。此类解决方案安装在它们需要保护的同一主机上。
- en: 'You need to have a host-based security solution in your lab mainly for two
    purposes: to practice firewall/IPS evasion techniques and to test the detectability
    and obfuscation of your exploits (payloads) and malware. But, as always, there
    could be other personal reasons for having such security measures.'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 在实验室中，你需要拥有基于主机的安全解决方案，主要有两个目的：一是练习防火墙/IPS规避技术，二是测试你的漏洞利用（payloads）和恶意软件的可检测性及混淆效果。但正如往常一样，可能还有其他个人原因需要采取这样的安全措施。
- en: Workstation security
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作站安全
- en: To better imitate a real enterprise network and create a possibility for testing
    various evasion techniques, we are going to install free endpoint security solutions
    on our lab workstations.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地模拟真实企业网络，并为测试各种规避技术创造条件，我们将为我们的实验室工作站安装免费的端点安全解决方案。
- en: We recommend that you create snapshots of your workstations before installing
    any host-based security solutions, as they will definitely make penetrating workstations
    a bit problematic and you don't need it before you proceed to an advanced hacking
    level. Using snapshots allows quick switching between the various system states
    of a VM and you can always fall back if you have broken something.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 我们建议在安装任何基于主机的安全解决方案之前，先创建工作站的快照，因为这些解决方案肯定会使穿透工作站变得有些麻烦，而在你进入更高级的黑客层级之前并不需要它。使用快照可以在虚拟机的不同系统状态之间快速切换，如果你搞坏了某些东西，随时可以恢复。
- en: EMET
  id: totrans-237
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: EMET
- en: The first workstation security solution in our list is the **Enhanced Mitigation
    Experience Toolkit** (**EMET**) from Microsoft. This tool helps to protect applications
    from being exploited if they contain software vulnerabilities. The tool uses a
    lot of protection techniques, including memory randomization and protection techniques
    as well as certificate pinning feature to withstand man-in-the-middle attacks.
    It can be obtained from the official website at [http://www.microsoft.com/emet](http://www.microsoft.com/emet).
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 我们列表中的第一个工作站安全解决方案是来自微软的**增强型缓解体验工具包**（**EMET**）。该工具帮助保护应用程序免受利用，如果它们包含软件漏洞。该工具使用了多种保护技术，包括内存随机化和保护技术，以及证书固定功能，以抵御中间人攻击。可以从官方网站下载，网址为[http://www.microsoft.com/emet](http://www.microsoft.com/emet)。
- en: We are going to install EMET 5.2 on a Windows 7 workstation. The installation
    process using graphical interface is not complicated, so we will use a lot of
    screenshots.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在 Windows 7 工作站上安装 EMET 5.2。通过图形界面进行安装过程并不复杂，因此我们将使用大量的截图。
- en: Log in to a Windows 7 workstation and download EMET 5.2 (or newer if it is already
    available) from the official webpage:![EMET](../images/00037.jpeg)
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 Windows 7 工作站，并从官方网站下载 EMET 5.2（如果已经有更高版本，则下载更高版本）：[!EMET](../images/00037.jpeg)
- en: EMET 5.2 download menu
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: EMET 5.2 下载菜单
- en: Start the installation wizard and follow the dialog-based instructions:![EMET](../images/00038.jpeg)
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动安装向导并按照对话框中的指示进行操作：[!EMET](../images/00038.jpeg)
- en: EMET 5.2 installation process
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: EMET 5.2 安装过程
- en: Choose the recommended settings:![EMET](../images/00039.jpeg)
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择推荐的设置：[!EMET](../images/00039.jpeg)
- en: EMET 5.2 settings choice
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: EMET 5.2 设置选择
- en: After the installation, you can find the EMET icon in the taskbar. Right-click
    on it and open EMET:![EMET](../images/00040.jpeg)
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，你可以在任务栏找到 EMET 图标。右键点击它并打开 EMET：[!EMET](../images/00040.jpeg)
- en: EMET 5.2 main window
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: EMET 5.2 主窗口
- en: You can click on the **Apps** button in the menu to see which protection setting
    is set for which applications:![EMET](../images/00041.jpeg)
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以点击菜单中的**应用程序**按钮，查看每个应用程序的保护设置：[!EMET](../images/00041.jpeg)
- en: EMET 5.2 application protection settings
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: EMET 5.2 应用保护设置
- en: Now, we can proceed with installing a host-based intrusion prevention system.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以继续安装基于主机的入侵防御系统。
- en: HIPS
  id: totrans-251
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: HIPS
- en: Like EMET, we need a HIPS and antivirus mostly for evasion testing purposes
    and for advanced attacks or research scenarios. You can choose any of the popular
    software and the more solutions you have in the lab, the better it is because
    it will allow you to test your payloads and evasion techniques against a wider
    range of detection and protection tools. This will give you a better chance of
    a successful attack.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 像 EMET 一样，我们需要一个 HIPS 和杀毒软件，主要用于规避测试和高级攻击或研究场景。你可以选择任何流行的软件，实验室中有的安全解决方案越多越好，因为它将使你能够对更多的检测和保护工具进行
    payload 和规避技术的测试。这会大大增加你成功攻击的机会。
- en: Tip
  id: totrans-253
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Normally, it is not recommended to install a lot of security solutions of one
    type from different vendors as they can conflict and cause system instability.
    In our example, we have tested the proposed solution, but if you want to do the
    same thing with other software, we recommend you test it properly.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，不推荐安装来自不同厂商的同类型大量安全解决方案，因为它们可能会发生冲突并导致系统不稳定。在我们的示例中，我们已经测试过所推荐的解决方案，但如果你想用其他软件做同样的事情，我们建议你进行充分的测试。
- en: For demonstration purposes, it will be enough to install just one solution,
    and preferably it should be free. We have chosen Comodo Internet Security 2015.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 出于演示目的，安装一个解决方案就足够了，最好选择免费的。我们选择了 Comodo Internet Security 2015。
- en: 'Comodo **Internet Security** (**IS**) is a solution that combines antivirus,
    firewall, and auto-sandbox software and has a free version available at Comodo''s
    website. The steps are as follows:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: Comodo **Internet Security**（**IS**）是一个结合了杀毒软件、防火墙和自动沙箱软件的解决方案，并且在 Comodo 网站上有免费的版本。步骤如下：
- en: The installation process is also simple, as in the case of EMET. But it has
    some peculiarities. You should not miss the small link **Customize Installation**
    in the bottom-left corner of the second installation dialog:![HIPS](../images/00042.jpeg)
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装过程也很简单，就像 EMET 一样。但它有一些特殊性。你不应忽视第二个安装对话框左下角的一个小链接**自定义安装**：![HIPS](../images/00042.jpeg)
- en: Accessing the Comodo IS installation customization dialog
  id: totrans-258
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 访问 Comodo IS 安装自定义对话框
- en: For our purposes, we don't need the GeekBuddy component or the Chromodo browser,
    so just uncheck the corresponding checkboxes:![HIPS](../images/00043.jpeg)
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于我们的用途，我们不需要 GeekBuddy 组件或 Chromodo 浏览器，所以只需取消选中相应的复选框：![HIPS](../images/00043.jpeg)
- en: Choosing Comodo IS components to install
  id: totrans-260
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 选择要安装的 Comodo IS 组件
- en: We also do not want Comodo to change our DNS settings, so uncheck the appropriate
    checkbox on the next dialog too. It is up to you to decide if you want to help
    Comodo by setting Yahoo! as the default search engine. However, in the case of
    a lab workstation, it will not help Comodo anyhow so we uncheck the option:![HIPS](../images/00044.jpeg)
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们也不希望 Comodo 更改我们的 DNS 设置，所以在下一个对话框中也取消选中相应的复选框。是否帮助 Comodo 将 Yahoo! 设置为默认搜索引擎由你决定。然而，在实验室工作站的情况下，这对
    Comodo 并没有帮助，因此我们取消了该选项：![HIPS](../images/00044.jpeg)
- en: Comodo IS installation customization
  id: totrans-262
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Comodo IS 安装自定义
- en: Finish the installation and restart the workstation.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成安装并重启工作站。
- en: Comodo Internet Security 2015 is installed and working now. The last thing left
    to do is to create a snapshot of the VM state:![HIPS](../images/00045.jpeg)
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Comodo Internet Security 2015 已安装并正常工作。剩下的最后一件事是创建虚拟机状态的快照：![HIPS](../images/00045.jpeg)
- en: Comodo IS main window
  id: totrans-265
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Comodo IS 主窗口
- en: Web application firewall
  id: totrans-266
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Web 应用防火墙
- en: Web application firewall is a class of security solutions that is dedicated
    to protecting web applications by inspecting HTTP/S requests and responses and
    taking various actions based on special patterns (rules). Those actions can be
    blocking or logging or some more complicated actions can be taken.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: Web 应用防火墙是一类安全解决方案，专门通过检查 HTTP/S 请求和响应来保护 Web 应用，并根据特定的模式（规则）采取各种行动。这些行动可以是阻止、日志记录，或者采取一些更复杂的行动。
- en: 'When talking about free web application firewalls, the first one that comes
    to our mind is definitely ModSecurity. To better explain what is it, we are going
    to quote the description from the official ModSecurity website ([https://www.modsecurity.org/](https://www.modsecurity.org/)):'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 说到免费 Web 应用防火墙，首先想到的肯定是 ModSecurity。为了更好地解释它是什么，我们将引用官方 ModSecurity 网站的描述 ([https://www.modsecurity.org/](https://www.modsecurity.org/))：
- en: '"ModSecurity is an open source, cross-platform web application firewall (WAF)
    module. Known as the "Swiss Army Knife" of WAFs, it enables web application defenders
    to gain visibility into HTTP(S) traffic and provides a power rules language and
    API to implement advanced protections."'
  id: totrans-269
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '"ModSecurity 是一个开源的跨平台 Web 应用防火墙（WAF）模块。被称为 WAF 的“瑞士军刀”，它使 Web 应用防御者能够查看 HTTP(S)
    流量，并提供强大的规则语言和 API 来实现高级保护。"'
- en: We think we will not be wrong if we say that it is the most popular free web
    application firewall in the world and we would like to show you how to prepare
    it for lab usage on our web server. So, let's start.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 我们认为如果说它是世界上最受欢迎的免费 Web 应用防火墙，我们不会错，并且我们想向你展示如何在我们的 Web 服务器上为实验室使用准备它。那么，让我们开始吧。
- en: 'First, we should install ModSecurity. There are several ways to install ModSecurity,
    but the fastest and the easiest one in our case is installing it from the Ubuntu
    package repository using **Advanced Packaging Tool** (**APT**). Log in to the
    web server and run the following commands:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们应该安装 ModSecurity。安装 ModSecurity 有几种方式，但在我们的情况下，最快且最简单的方式是通过 **高级包装工具**（**APT**）从
    Ubuntu 软件包仓库进行安装。登录到 Web 服务器并运行以下命令：
- en: '[PRE26]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'To check whether ModSecurity was successfully installed and loaded, you can
    use the `apachectl` utility with the option `-M` and `grep`:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查 ModSecurity 是否成功安装并加载，可以使用 `apachectl` 工具，选项为 `-M` 并使用 `grep`：
- en: '[PRE27]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: You should see something similar to `security2_module` (shared), which indicates
    that ModSecurity was successfully integrated to Apache.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该看到类似于`security2_module`（共享）的内容，这表示 ModSecurity 已成功集成到 Apache 中。
- en: 'ModSecurity keeps its configs in the `/etc/modsecurity/` directory and it is
    distributed with a sample of predefined rules and configs. The default configuration
    file is `modsecurity.conf-recommended`. It is a good idea to keep a backup of
    that file so that we will create a copy that will serve as a working config:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: ModSecurity将其配置文件保存在`/etc/modsecurity/`目录下，并附带一组预定义的规则和配置。默认配置文件是`modsecurity.conf-recommended`。建议你备份该文件，以便我们可以创建一个副本，作为工作配置：
- en: '[PRE28]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'After that, we need to restart Apache web server in order to make it load with
    the new ModSecurity config:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们需要重启Apache web服务器，以使其加载新的ModSecurity配置：
- en: '[PRE29]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: ModSecurity can work as an intrusion detection system and as an intrusion prevention
    system. When working in the detection mode, ModSecurity just logs activities that
    were determined as malicious according to a current rule set. In the prevention
    mode, it can actually block attacks.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: ModSecurity可以作为入侵检测系统（IDS）或入侵防御系统（IPS）工作。在检测模式下，ModSecurity只是记录被当前规则集判定为恶意的活动。在防御模式下，它可以实际阻止攻击。
- en: The mode settings (as well as a lot of other ModSecurity settings) can be changed
    in `/etc/modsecurity/modsecurity.conf`.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 模式设置（以及许多其他ModSecurity设置）可以在`/etc/modsecurity/modsecurity.conf`中更改。
- en: 'For initial web hacking training, you probably don''t want your attacks to
    be blocked, and in this case you can leave ModSecurity in an IDS mode (detection
    mode), leaving the `SecRuleEngine` option with the following value:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 对于初步的网络攻击训练，你可能不希望你的攻击被阻止，这时你可以将ModSecurity保持在IDS模式（检测模式），将`SecRuleEngine`选项设置为以下值：
- en: '[PRE30]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: This will allow you to practice various attacks without any interference from
    the WAF. At the same time, it allows you to understand how WAF works with a current
    rule set by inspecting its logs.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 这将允许你在没有WAF干扰的情况下进行各种攻击练习。同时，它还允许你通过查看日志来理解WAF如何与当前规则集一起工作。
- en: 'When you want to practice advanced attacks with WAF evasion techniques, you
    can switch WAF into the prevention mode by changing the value of the `SecRuleEngine`
    option to `On`:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 当你想要练习高级攻击并使用WAF规避技巧时，可以通过将`SecRuleEngine`选项的值改为`On`，将WAF切换到防御模式：
- en: '[PRE31]'
  id: totrans-286
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'There is also another interesting configuration option that is important in
    case of limited processing resources on VMs: `SecResponseBodyAccess`. This option
    enables and disables server response body inspection, which does not makes a lot
    of sense in a lab environment unless you need it for specific tasks. It also consumes
    additional processing resources that can slow down the server a bit. Our recommendation
    is to turn the response body inspection off in the meantime and turn it on when
    it is really necessary. The feature is turned on by default:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有趣的配置选项是针对VM资源有限的情况，`SecResponseBodyAccess`。此选项启用或禁用服务器响应体检查，在实验环境中除非有特定任务需求，否则并不太有意义。它还会消耗额外的处理资源，可能会稍微减慢服务器速度。我们的建议是暂时关闭响应体检查，只有在确实需要时再打开。默认情况下此功能是启用的：
- en: '[PRE32]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'We need to change it:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要进行修改：
- en: '[PRE33]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'To make use of ModSecurity, it should have rules set, according to which it
    will inspect requests (and/or responses). There is a predefined rule set distributed
    with ModSecurity and called **Core Rule Set** (**CRS**). You can find it in `/usr/share/modsecurity-crs/`.
    To activate the rule set, we need to explicitly include their directories in Apache''s
    configuration in the file `/etc/apache2/mods-enabled/mod-security.conf` file and
    create symlinks to the rules that we would like to activate in `/usr/share/modsecurity-crs/activated_rules/`:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用ModSecurity，它应该有规则集，依据这些规则它将检查请求（和/或响应）。ModSecurity随附有一个预定义的规则集，称为**核心规则集**（**CRS**）。你可以在`/usr/share/modsecurity-crs/`中找到它。要激活规则集，我们需要在Apache的配置文件`/etc/apache2/mods-enabled/mod-security.conf`中显式包含它们的目录，并在`/usr/share/modsecurity-crs/activated_rules/`中创建指向我们希望激活的规则的符号链接：
- en: 'Open the `/etc/apache2/mods-enabled/security2.conf` file in the editor and
    put the following lines in the `<IfModule security2_module> </IfModule>` section:'
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`/etc/apache2/mods-enabled/security2.conf`文件，在`<IfModule security2_module>
    </IfModule>`部分中加入以下内容：
- en: '[PRE34]'
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Create symlinks in `/usr/share/modsecurity-crs/activated_rules/`. Go to the
    directory and execute the following commands:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`/usr/share/modsecurity-crs/activated_rules/`中创建符号链接。进入该目录并执行以下命令：
- en: '[PRE35]'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Reload the Apache service for the changes to take effect:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新加载Apache服务以使更改生效：
- en: '[PRE36]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Now the configuration phase is finished, we need to check if ModSecurity works
    and detects malicious requests. Let''s use DVWA for that. Open a browser on another
    machine and navigate to `http://10.0.0.5/dvwa/login.php`. Enter an obvious SQL
    injection pattern in the username field, for example:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 现在配置阶段已经结束，我们需要检查 ModSecurity 是否正常工作并能检测到恶意请求。我们可以使用 DVWA 来进行测试。在另一台机器上打开浏览器，访问
    `http://10.0.0.5/dvwa/login.php`。在用户名字段中输入明显的 SQL 注入模式，例如：
- en: '[PRE37]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Click on the **Login** button or just hit *Enter*. Go back to the web server
    and check the content of the ModSecurity''s log:'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 点击 **登录** 按钮或直接按 *Enter* 键。返回到 Web 服务器并检查 ModSecurity 日志的内容：
- en: '[PRE38]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'The log should contain an alert indicating that the request matched a pattern
    from the SQL injection rule set:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 日志中应该包含一条警告，表明请求匹配了 SQL 注入规则集中的模式：
- en: '![Web application firewall](../images/00046.jpeg)'
  id: totrans-303
  prefs: []
  type: TYPE_IMG
  zh: '![Web 应用防火墙](../images/00046.jpeg)'
- en: ModSecurity has detected an SQL injection
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: ModSecurity 检测到 SQL 注入
- en: Note
  id: totrans-305
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This is just an example, but we strongly recommend you go beyond the examples
    and experiment by tweaking WAF rules and other WAFs in order to acquire outstanding
    penetration testing skills.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 这只是一个示例，但我们强烈建议你超越这些示例，进行更多实验，调整 WAF 规则和其他 WAF，以提高你的渗透测试技能。
- en: ClamAV
  id: totrans-307
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ClamAV
- en: So, we have protected workstations based on the Windows operating system from
    virus threats. Now, it's time to protect our Linux servers and e-mail services
    from malicious code.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这种方式，我们已经保护了基于 Windows 操作系统的工作站免受病毒威胁。现在，是时候保护我们的 Linux 服务器和电子邮件服务免受恶意代码的侵害了。
- en: To build a multi-tier protection, we must protect not only Windows platform
    hosts, but also Linux servers, as well as transfer and store file services. So,
    we create automatic scans for viruses for all incoming and outgoing e-mail messages.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 为了建立多层防护，我们不仅要保护 Windows 平台的主机，还需要保护 Linux 服务器，以及传输和存储文件服务。因此，我们为所有进出邮件消息创建自动病毒扫描。
- en: For this purpose, as an antivirus solution, we consider ClamAV. ClamAV is antivirus
    software that runs on many operating systems, including Unix-like OSes, OpenVMS,
    Microsoft Windows, and Apple Mac OS X. ClamAV is produced under the GNU General
    Public License and is a free software.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 在此过程中，作为一种防病毒解决方案，我们选择 ClamAV。ClamAV 是一款运行在多种操作系统上的防病毒软件，包括类 Unix 操作系统、OpenVMS、Microsoft
    Windows 和 Apple Mac OS X。ClamAV 根据 GNU 通用公共许可证发布，是一款自由软件。
- en: The main objective of ClamAV is integration with e-mail servers to verify the
    files attached to messages. The package includes a scalable multi-threaded daemon
    clamd, which is controlled from the command line scanner clamscan, as well as
    a module signature that updates via the Internet freshclam.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV 的主要目标是与电子邮件服务器集成，以验证附件中的文件。该软件包包括一个可扩展的多线程守护进程 clamd，由命令行扫描器 clamscan
    控制，以及一个通过互联网更新的模块签名 freshclam。
- en: 'Some of the ClamAV features are as follows:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV 的一些功能如下：
- en: Command-line management
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 命令行管理
- en: Can be used with most e-mail servers, including the implementation of milter-interface
    with Sendmail
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以与大多数电子邮件服务器一起使用，包括通过 milter 接口与 Sendmail 配合使用
- en: Scanner implemented as a C library
  id: totrans-315
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描器以 C 库的形式实现
- en: Scanning files and e-mail on the fly
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 即时扫描文件和电子邮件
- en: Definition of over 850,000 viruses, worms, Trojans, and phishing messages
  id: totrans-317
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义超过 85 万种病毒、蠕虫、木马和钓鱼信息
- en: Analysis of compressed files
  id: totrans-318
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持压缩文件的分析
- en: Support for scanning mbox, Maildir, and raw mail files
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持扫描 mbox、Maildir 和原始邮件文件
- en: Analysis file formats, such as portable executable, packed UPX, FSG, and Petite
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析文件格式，如便携式可执行文件、打包的 UPX、FSG 和 Petite
- en: Installing
  id: totrans-321
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装
- en: 'Well, let''s start with solution''s installation. For obtaining the ClamAV
    distribution package, please visit the manufacturer''s website [http://www.clamav.net/download.html](http://www.clamav.net/download.html).
    Or, as in our case, you can use built-in operating system tools. Since we are
    using the Ubuntu Linux operating system 14.04.3, we just run following command
    in the console on behalf of the root user:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 好的，我们从安装解决方案开始。要获取 ClamAV 分发包，请访问厂商网站 [http://www.clamav.net/download.html](http://www.clamav.net/download.html)。或者，像我们这种情况，你也可以使用操作系统的内建工具。由于我们使用的是
    Ubuntu Linux 14.04.3 操作系统，我们只需以 root 用户身份在控制台中运行以下命令：
- en: '[PRE39]'
  id: totrans-323
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'If you prefer to use a normal user, you can execute following command:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你更倾向于使用普通用户，可以执行以下命令：
- en: '[PRE40]'
  id: totrans-325
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: After this, we will have a working instance of ClamAV. To start or stop the
    service, you can use the built-in tools of your operating system.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些步骤后，我们将拥有一个可用的 ClamAV 实例。要启动或停止服务，你可以使用操作系统的内建工具。
- en: Configuring
  id: totrans-327
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置
- en: 'In the next step, we need to reconfigure ClamAV so that the ClamAV daemon uses
    TCP connections instead of a local Unix socket. For this, just execute the following
    command:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，我们需要重新配置 ClamAV，以便 ClamAV 守护进程使用 TCP 连接而不是本地 Unix 套接字。为此，只需执行以下命令：
- en: '[PRE41]'
  id: totrans-329
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'This command will start a configuration wizard. Let''s leave all the answers
    at the default values, except for the following:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将启动配置向导。让我们将所有答案保持默认值，除了以下内容：
- en: Socket type (set it to `TCP` instead of `Unix`)
  id: totrans-331
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 套接字类型（将其设置为 `TCP`，而不是 `Unix`）
- en: The TCP port `clamd` will listen on (you can set your own TCP port address for
    listening to incoming messages, but we recommend you leave it as `3310`)
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TCP 端口 `clamd` 将监听（你可以为接收消息设置自己的 TCP 端口地址，但我们建议将其保留为 `3310`）
- en: The IP address `clamd` will listen on (here, we should set the IP address of
    the used network interface, but you can also set it as any)
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`clamd` 将监听的 IP 地址（在这里，我们应该设置所用网络接口的 IP 地址，但你也可以将其设置为任何）'
- en: You can check or clarify your configuration of ClamAV by editing the configuration
    file `/etc/clamav/clamd.conf`.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过编辑配置文件 `/etc/clamav/clamd.conf` 来检查或确认 ClamAV 的配置。
- en: 'After the reconfiguration process is completed, we need to restart the ClamAV
    daemon:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 配置重新设置完成后，我们需要重启 ClamAV 守护进程：
- en: '[PRE42]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Next, we should update the database. For this, we need to execute the following
    command:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们应该更新数据库。为此，我们需要执行以下命令：
- en: '[PRE43]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Usage and integration with the mail server
  id: totrans-339
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 与邮件服务器的使用和集成
- en: 'We have installed the antivirus solution and updated the database. Now we need
    to check how it works. For example, to check a directory, run the following command:'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经安装了防病毒解决方案并更新了数据库。现在，我们需要检查它是如何工作的。例如，要检查一个目录，运行以下命令：
- en: '[PRE44]'
  id: totrans-341
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: This command will check the entire filesystem if it is necessary to check any
    particular directory; instead of `/`, specify the directory name. To check a suspicious
    file, just type `clamscan FILENAME`. Let's check our antivirus with an **EICAR**
    (**European Institute for Computer Antivirus Research**) test file. It is a standard
    file that is used to check whether the antivirus and inherently is not a virus.
    You can get this file at [http://www.eicar.org/download/eicar.com.txt](http://www.eicar.org/download/eicar.com.txt).
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将检查整个文件系统，如果需要检查某个特定目录，指定该目录的名称即可。要检查可疑文件，只需输入 `clamscan FILENAME`。让我们用 **EICAR**（**欧洲计算机防病毒研究所**）测试文件来检查我们的防病毒软件。该文件是一个标准文件，用于检查防病毒软件，它本身并不是病毒。你可以在
    [http://www.eicar.org/download/eicar.com.txt](http://www.eicar.org/download/eicar.com.txt)
    获取此文件。
- en: 'The next screenshot shows the output of ClamAV:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 下一张截图显示了 ClamAV 的输出：
- en: '![Usage and integration with the mail server](../images/00047.jpeg)'
  id: totrans-344
  prefs: []
  type: TYPE_IMG
  zh: '![与邮件服务器的使用和集成](../images/00047.jpeg)'
- en: The ClamAV output
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: ClamAV 输出
- en: 'Next, we need to check the open port for connecting third-party applications.
    It''s enough to execute the following command:'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要检查开放的端口以连接第三方应用程序。执行以下命令即可：
- en: '[PRE45]'
  id: totrans-347
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'After checking that it works, let''s make sure that our mail server scans all
    messages for viruses. To do this, perform the following steps:'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 确认其正常工作后，我们需要确保邮件服务器扫描所有消息以查找病毒。为此，请执行以下步骤：
- en: Run the management console of hMailServer and go to **Settings** | **Anti-virus**.
    In the right-hand pane, go to the **General** tab to determine what to do with
    infected messages:![Usage and integration with the mail server](../images/00048.jpeg)
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 hMailServer 管理控制台并进入 **设置** | **防病毒**。在右侧面板中，进入 **常规** 选项卡，确定对感染的消息应该采取什么措施：![与邮件服务器的使用和集成](../images/00048.jpeg)
- en: hMailServer settings
  id: totrans-350
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: hMailServer 设置
- en: 'On the **ClamAV** tab, we should set connection options for the ClamAV server:'
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **ClamAV** 选项卡中，我们应该设置 ClamAV 服务器的连接选项：
- en: Hostname (`10.0.0.107`)
  id: totrans-352
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主机名 (`10.0.0.107`)
- en: TCP/IP port (`3310`)
  id: totrans-353
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: TCP/IP 端口 (`3310`)
- en: To check the connection, click on the **Test…** button:![Usage and integration
    with the mail server](../images/00049.jpeg)
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要检查连接，请点击 **测试…** 按钮：![与邮件服务器的使用和集成](../images/00049.jpeg)
- en: hMailServer settings
  id: totrans-355
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: hMailServer 设置
- en: Now all the traffic of the `lab.local` e-mail accounts is scanning on the ClamAV
    server.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，所有来自 `lab.local` 电子邮件帐户的流量都在 ClamAV 服务器上进行扫描。
- en: OSSEC
  id: totrans-357
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: OSSEC
- en: We have already set up a network intrusion detection system and HIPS for Windows
    hosts. Let's now consider another option for Linux platform hosts.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经为 Windows 主机设置了网络入侵检测系统和 HIPS。现在，让我们考虑另一种适用于 Linux 平台主机的选项。
- en: OSSEC ([http://ossec.github.io/](http://ossec.github.io/)) is a host system
    intrusion detection system (HIDS), and it is free and open source. It conducts
    analysis of system logs, integrity checking, monitoring the registry of Windows,
    rootkit detection, and alerting at a particular time and event. It provides the
    function of intrusion detection for most operating systems, including Linux, BSD-like,
    Mac OS, Solaris, and Windows. Its cross-platform architecture makes it easy to
    manage and monitor for multiple operating systems.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: OSSEC ([http://ossec.github.io/](http://ossec.github.io/)) 是一个主机入侵检测系统（HIDS），它是免费且开源的。它对系统日志进行分析、完整性检查、监控
    Windows 注册表、根工具检测，并在特定时间和事件发生时进行警报。它为大多数操作系统提供入侵检测功能，包括 Linux、BSD 类系统、Mac OS、Solaris
    和 Windows。它的跨平台架构使得管理和监控多个操作系统变得容易。
- en: OSSEC consists of a main application (server), agents, and the web management
    interface.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: OSSEC 由主应用程序（服务器）、代理和 Web 管理界面组成。
- en: Installing
  id: totrans-361
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装
- en: 'Well, let''s start with OSSEC by installing it in our infrastructure. First
    of all, we need to satisfy some requirements. OSSEC requires `gcc`, `libc`, and
    `apache` with `php5` support. For this, we should execute the following commands:'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 好的，我们通过在我们的基础设施中安装 OSSEC 来开始。首先，我们需要满足一些要求。OSSEC 需要 `gcc`、`libc` 和支持 `php5`
    的 `apache`。为此，我们应该执行以下命令：
- en: '[PRE46]'
  id: totrans-363
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Next, we need to obtain OSSEC. For this purpose, we should execute the following
    commands:'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要获取 OSSEC。为此，我们应该执行以下命令：
- en: '[PRE47]'
  id: totrans-365
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Now that we have installation packages, let''s install them using the following
    command:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了安装包，接下来使用以下命令安装它们：
- en: '[PRE48]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'It starts a wizard with a few questions that we should answer. The most important
    question is about the type of installation. Here, we should create two different
    types of installation: for agents and for the server.'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 它启动了一个向导，向我们提出一些问题，我们需要回答。最重要的问题是关于安装类型的。在这里，我们应该创建两种不同的安装类型：代理和服务器。
- en: 'Next, let''s install the web part of OSSEC. Move the `ossec-wui` directory
    to the folder where it can be accessed by the web server:'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，安装 OSSEC 的 Web 部分。将 `ossec-wui` 目录移动到可以被 Web 服务器访问的文件夹中：
- en: '[PRE49]'
  id: totrans-370
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Then, execute the setup script:'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，执行安装脚本：
- en: '[PRE50]'
  id: totrans-372
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: The wizard will start, so we should answer questions such as login and password
    to gain access to the web interface of OSSEC.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 向导将启动，我们需要回答一些问题，如登录和密码，以便访问 OSSEC 的 Web 界面。
- en: Configuring
  id: totrans-374
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置
- en: OSSEC stores all the files in `/var/ossec`. Let's open the `/var/ossec/ossec.conf`
    file and give it the form we need. Here, we set sending alerts to e-mail by selecting
    the server address, mailing address, and the maximum possible number of messages
    per hour.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: OSSEC 将所有文件存储在 `/var/ossec` 目录下。我们打开 `/var/ossec/ossec.conf` 文件并根据需要进行配置。在这里，我们通过选择服务器地址、邮件地址以及每小时最大可能的消息数量来设置发送警报到电子邮件。
- en: Then, there is a block of rules that describes what and how OSSEC will react.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，有一块规则描述了 OSSEC 将如何以及对什么做出反应。
- en: The `syscheck` section sets the integrity check. Its meaning lies in the fact
    that the system calculates a hash of each file in the specified directory and
    checks them periodically. Here, we set what we will monitor in a directory and
    how long it will be checked for. The section describes the command scripts that
    can be used by the system under certain conditions.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: '`syscheck` 部分设置了完整性检查。它的意义在于系统计算指定目录中每个文件的哈希值并定期检查它们。在这里，我们设置了要监控的目录以及检查的时间间隔。该部分描述了在某些条件下系统可以使用的命令脚本。'
- en: In the end, we set log files that need to be analyzed and compared with the
    rules.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们设置需要分析的日志文件，并与规则进行比较。
- en: 'Now, the coarse settings of the OSSEC server are finished and we can run it:'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，OSSEC 服务器的粗略设置完成，我们可以启动它：
- en: '[PRE51]'
  id: totrans-380
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: If successful, you will receive an e-mail with a message on startup in the mailing
    address.
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 如果成功，你将收到一封电子邮件，邮件中包含启动时的消息。
- en: 'After this, we need to add the user account of the web server (`www-data`)
    to the OSSEC group. Open the `/etc/group` file in editor:'
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，我们需要将 Web 服务器的用户账户（`www-data`）添加到 OSSEC 组中。用编辑器打开 `/etc/group` 文件：
- en: '[PRE52]'
  id: totrans-383
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Find the line `ossec:x:1002` and change it to `ossec:x:1002:www-data`.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 找到 `ossec:x:1002` 这一行，并将其修改为 `ossec:x:1002:www-data`。
- en: After that, we need to set permissions for the `tmp` directory of our OSSEC
    instance and restart Apache service.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们需要为 OSSEC 实例的 `tmp` 目录设置权限并重启 Apache 服务。
- en: '[PRE53]'
  id: totrans-386
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Now we can access the OSSEC web interface using the following link: `http://localhost/ossec-wui/`.'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以使用以下链接访问 OSSEC Web 界面：`http://localhost/ossec-wui/`。
- en: Connecting OSSEC agents
  id: totrans-388
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接 OSSEC 代理
- en: 'Let''s install an OSSEC agent from the same distribution. We choose the agent
    mode in the wizard. For the question "What''s the IP Address or hostname of the
    OSSEC HIDS server?" we input the IP address of our OSSEC server. Now, we need
    to associate the OSSEC agent with our server. For this, we should go to the server
    and launch the manager working with the agents:'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从相同的发行版安装一个 OSSEC 代理。在向导中选择代理模式。对于问题“OSSEC HIDS 服务器的 IP 地址或主机名是什么？”我们输入 OSSEC
    服务器的 IP 地址。现在，我们需要将 OSSEC 代理与我们的服务器关联。为此，我们应该去服务器并启动与代理一起工作的管理器：
- en: '[PRE54]'
  id: totrans-390
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'In the interactive mode, we need to perform the following steps:'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 在交互模式下，我们需要执行以下步骤：
- en: Select *A* to add an agent (A).
  id: totrans-392
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 *A* 添加代理（A）。
- en: Write the name of our agent.
  id: totrans-393
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 写下我们代理的名称。
- en: Specify the IP address of our agent.
  id: totrans-394
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定我们代理的 IP 地址。
- en: Choose an agent ID. We can leave the ID that OSSEC suggests.
  id: totrans-395
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个代理 ID。我们可以保留 OSSEC 提示的 ID。
- en: '"Confirm adding it? (Y / n)" Answer with *y*.'
  id: totrans-396
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: “确认添加吗？（Y / n）”选择 *y*。
- en: Then, select the *E* key to extract an agent.
  id: totrans-397
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，选择 *E* 键来移除代理。
- en: Specify the ID of our new agent.
  id: totrans-398
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定我们新代理的 ID。
- en: Copy the base64 string and press *Enter*.
  id: totrans-399
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制 base64 字符串并按 *Enter*。
- en: Select the Q output from the manager to work with agents.
  id: totrans-400
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从管理器中选择 Q 输出，以便与代理一起工作。
- en: 'Restart the server for the successful addition of the agent:'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 重启服务器以成功添加代理：
- en: '[PRE55]'
  id: totrans-402
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Then, let''s go to our agent and go in the manager working with the agents:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们进入我们的代理并进入与代理一起工作的管理器：
- en: '[PRE56]'
  id: totrans-404
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'In the interactive mode, we need to perform the following steps:'
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 在交互模式下，我们需要执行以下步骤：
- en: Select the *I* key to import from the server to add a key that we copied.
  id: totrans-406
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 *I* 键从服务器导入，添加我们复制的密钥。
- en: Insert the key, add the agent, and exit.
  id: totrans-407
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 插入密钥，添加代理并退出。
- en: 'Then, we can run our agent:'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们可以运行我们的代理：
- en: '[PRE57]'
  id: totrans-409
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'It should come in the mail notification that a new agent is connected. Go to
    the server to check whether the agent is connected:'
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 应该会收到邮件通知，提示有新代理已连接。去服务器检查代理是否连接：
- en: '[PRE58]'
  id: totrans-411
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: Here, we will see the list of our agents with the status `Active`. Also, `/var/ossec/logs/alerts.alerts.log`
    should have an event like that.
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将看到我们代理的列表，状态为 `Active`。此外，`/var/ossec/logs/alerts.alerts.log` 中应有类似的事件。
- en: So the OSSEC agent is connected. Now, we can see our agent in the web interface.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 所以 OSSEC 代理已经连接。现在，我们可以在 web 界面中看到我们的代理。
- en: Note
  id: totrans-414
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you want to learn more about OSSEC, the official documentation is available
    at [http://ossec.github.io/docs/](http://ossec.github.io/docs/).
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想了解更多关于 OSSEC 的信息，可以访问官方文档：[http://ossec.github.io/docs/](http://ossec.github.io/docs/)。
- en: SIEM
  id: totrans-416
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: SIEM
- en: '**SIEM** (**Security information and event management**) is the union of two
    terms denoting the application areas **Security Information Management** (**SIM**)
    and **Security Event Management** (**SEM**). The SIEM technology provides real-time
    analysis of events (alarms), security emanating from network devices, and applications.'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: '**SIEM** (**安全信息和事件管理**) 是两个术语的结合，表示 **安全信息管理** (**SIM**) 和 **安全事件管理** (**SEM**)
    的应用领域。SIEM 技术提供网络设备和应用程序产生的事件（警报）、安全的实时分析。'
- en: In our environment, SIEM solutions allows us to track security events and to
    better correlate the actions of the simulated attacker and security specialist.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的环境中，SIEM 解决方案使我们能够跟踪安全事件，并更好地关联模拟攻击者和安全专家的行动。
- en: The field of knowledge about SIEM is very broad and requires several books.
    In this book, we will only touch on this subject and show how to install the popular
    free solution OSSIM.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: SIEM 领域的知识非常广泛，需要几本书来讲解。在本书中，我们将仅触及此主题并展示如何安装流行的免费解决方案 OSSIM。
- en: '**OSSIM** (**Open Source Security Information Management**) is a management,
    control, and information security system. Out of the box, OSSIM includes the following
    functionality:'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: '**OSSIM** (**开源安全信息管理**) 是一个管理、控制和信息安全系统。开箱即用，OSSIM 包含以下功能：'
- en: The collection, analysis, and correlation of events—SIEM
  id: totrans-421
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件的收集、分析和关联—SIEM
- en: The **host intrusion detection system** (**HIDS**)—OSSEC
  id: totrans-422
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主机入侵检测系统** (**HIDS**)—OSSEC'
- en: '**Network intrusion** **detection system** (**NIDS**)—Suricata'
  id: totrans-423
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络入侵** **检测系统** (**NIDS**)—Suricata'
- en: '**Wireless Intrusion** **Detection System** (**WIDS**)—Kismet'
  id: totrans-424
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**无线入侵** **检测系统** (**WIDS**)—Kismet'
- en: Monitoring sites networks—Nagios
  id: totrans-425
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控站点网络—Nagios
- en: An analysis of network anomalies—P0f, PADS, FProbe, Arpwatch, and others
  id: totrans-426
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络异常分析—P0f、PADS、FProbe、Arpwatch 等
- en: Vulnerability scanner—OpenVAS
  id: totrans-427
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞扫描器—OpenVAS
- en: A powerful system of exchange of information about threats among users OSSIM—OTX
  id: totrans-428
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个强大的用户间威胁信息交换系统 OSSIM—OTX
- en: More than 200 plugins for parsing and correlating logs from various external
    devices and services
  id: totrans-429
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 超过200个插件，用于解析和关联来自各种外部设备和服务的日志
- en: OSSIM is distributed in the form of a distribution image on a CD and at the
    same time, it only uses the 64-bit version of the software.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: OSSIM以CD的分发镜像形式分发，同时仅使用软件的64位版本。
- en: The distribution ISO image can be downloaded from the official website at [https://www.alienvault.com/products/ossim](https://www.alienvault.com/products/ossim).
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: 可以从官方网站[https://www.alienvault.com/products/ossim](https://www.alienvault.com/products/ossim)下载分发ISO镜像。
- en: Installing
  id: totrans-432
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装中
- en: An OSSIM system is installed with the help of the installation image containing
    a complete Debian system and all the necessary components and modules.
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: OSSIM系统是通过安装镜像来安装的，该镜像包含一个完整的Debian系统以及所有必要的组件和模块。
- en: The system requires a fairly productive machine with multiple processors and
    at least 3 GB of RAM. After creating the VM and connecting the downloaded ISO
    image, we can start the VM.
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 系统要求一台具有多个处理器并至少有3 GB RAM的高性能机器。创建虚拟机并连接下载的ISO镜像后，我们可以启动虚拟机。
- en: 'The installation is not different from installing Debian: just insert the OSSIM
    disk image into the DVD drive of your virtual machine, boot from it and follow
    the installation guide. Upon completion of the installation, a console window
    will appear.'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程与安装Debian没有区别：只需将OSSIM镜像插入虚拟机的DVD驱动器，从中启动并按照安装指南进行操作。安装完成后，将出现一个控制台窗口。
- en: Let's go to the link printed in the console and enter user credentials. After
    these steps, installing OSSIM is complete.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们访问控制台中打印的链接并输入用户凭据。完成这些步骤后，OSSIM的安装就完成了。
- en: Configuration wizard
  id: totrans-437
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置向导
- en: So, let's configure OSSIM. For this purpose, enter the credentials specified
    in the previous step. Again, we will get the configuration wizard.
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，让我们配置OSSIM。为此，输入前一步中指定的凭据。再次，我们将进入配置向导。
- en: First of all, we need to configure network interfaces with the IP setting of
    the server where you installed OSSIM.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要配置网络接口，并设置安装了OSSIM的服务器的IP地址。
- en: On the next tab, OSSIM will automatically scan the network and prompts us to
    specify the types of the found hosts.
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个标签页，OSSIM将自动扫描网络并提示我们指定找到的主机类型。
- en: In the next step, we can automatically install the host intrusion detection
    system (OSSIM provides OSSEC). Let's try to install it on Windows hosts. To do
    this, we have to select the host name and credentials (for example, a domain administrator)
    and click on **Deploy**.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，我们可以自动安装主机入侵检测系统（OSSIM提供了OSSEC）。让我们尝试在Windows主机上安装它。为此，我们需要选择主机名和凭据（例如，域管理员），然后点击**部署**。
- en: After these steps, OSSIM will congratulate us with a message for successfully
    installing and configuring it.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 完成这些步骤后，OSSIM将通过一条成功安装和配置的消息来祝贺我们。
- en: Configuring HIDS
  id: totrans-443
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置HIDS
- en: To configure HIDS, go to **Environment** | **Detection** | **HIDS** | **Agents**
    and you will see two hosts. The first host is OSSIM itself and the second one
    is a Windows Server, which we deployed by clicking on **Deploy HIDS** in the **Setup
    Wizard**. So, go to the menu **HIDS agents**.
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置HIDS，进入**环境** | **检测** | **HIDS** | **代理**，你将看到两个主机。第一个主机是OSSIM本身，第二个是我们通过在**设置向导**中点击**部署HIDS**部署的Windows
    Server。所以，进入**HIDS代理**菜单。
- en: Agent installation on a Windows host is performed automatically and requires
    no additional input or any information. A setting on a Linux host fully corresponds
    to the previously described process in the *OSSEC* section.
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows主机上的代理安装是自动完成的，不需要额外的输入或任何信息。Linux主机上的设置完全符合前面在*OSSEC*部分中描述的过程。
- en: The HIDS installation is finished now, so go to **Environment** | **Detection**
    and you can see the logs of OSSEC now.
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 现在HIDS安装完成，所以进入**环境** | **检测**，你现在可以看到OSSEC的日志了。
- en: Summary
  id: totrans-447
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have shown readers how to protect the lab network from an
    unauthorized access and external attacks by installing and configuring network-
    and host-based security solutions. In addition to securing the lab network, we
    have prepared it to practice such important penetration testing topics as bypassing
    and evading security mechanisms and assessing their effectiveness.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们向读者展示了如何通过安装和配置基于网络和主机的安全解决方案来保护实验室网络免受未经授权的访问和外部攻击。除了保护实验室网络外，我们还为实践绕过和规避安全机制以及评估其有效性等重要渗透测试主题做好了准备。
- en: The lab environment is ready for practicing now and in the next chapter we would
    like to give a brief overview of various penetration testing and security assessment
    frameworks and toolkits along with some examples of their usage in the lab.
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 实验环境已经准备好进行实践，在下一章中，我们将简要概述各种渗透测试和安全评估框架及工具包，并提供一些它们在实验中的使用示例。
