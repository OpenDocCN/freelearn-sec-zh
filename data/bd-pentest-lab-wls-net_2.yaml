- en: Chapter 2. Planning Your Lab Environment
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二章。规划您的实验室环境
- en: As with any building, software, device, or other type of technical and non-technical
    projects, you need to start with a proper planning before proceeding to build
    a lab. This order is necessary to get the most benefits from your lab environment
    and at the same time to stay safe from any kinds of unwanted attacks. Preliminary
    planning also helps to avoid an unnecessary repetition of some installation and
    configuration tasks that can suddenly arise during the implementation phase if
    you realize that something is missing or some significant changes should be done
    in an almost finished lab environment.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 与任何建筑、软件、设备或其他类型的技术和非技术项目一样，您在开始建立实验室之前需要进行适当的规划。这个顺序是必要的，以便最大程度地从实验室环境中获得收益，同时确保免受任何类型的意外攻击。预先的规划还可以帮助避免在实施阶段出现的一些安装和配置任务的重复，尤其是在你意识到某些内容缺失或某些重要更改必须在几乎完成的实验室环境中进行时。
- en: 'In this chapter, we will guide you through the whole planning phase from understanding
    what do you need a lab for to choosing the lab components and topology based on
    your own requirements. To reach this goal, we will cover the following topics
    in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将引导您完成整个规划阶段，从理解您为何需要实验室到根据自己的需求选择实验室组件和拓扑结构。为实现这一目标，本章将涵盖以下主题：
- en: Understanding what tasks your lab should fulfill
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解您的实验室应该完成的任务
- en: Planning the network topology
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 规划网络拓扑
- en: Choosing appropriate components
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择合适的组件
- en: Planning lab security
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 规划实验室安全
- en: Understanding what tasks your lab should fulfill
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解您的实验室应该完成的任务
- en: Under this topic, we are going to help you to determine your needs and what
    you want to achieve with your lab. After understanding your needs, you will be
    able to set requirements for your lab—stating what should it contain and how should
    its components interact. This step allows you to prepare the basis of the next
    step—deciding which lab components do you need to include in a lab and which roles
    to assign them.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个主题下，我们将帮助您确定您的需求以及您希望通过实验室实现的目标。了解了您的需求后，您将能够为实验室设定要求——阐明实验室应包含哪些内容以及其组件如何相互作用。此步骤使您能够为下一步做准备——决定您需要在实验室中包含哪些组件以及为它们分配哪些角色。
- en: Objectives of a lab
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实验室的目标
- en: 'Let''s start from listing the typical purposes for having a lab:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从列出拥有实验室的典型目的开始：
- en: '**Learn practical penetration testing**: It is essential for a beginner to
    have an environment where they can practice penetration testing techniques they
    learn and consolidate newly learned information. During this education, you most
    likely will want to have a model of a real-world corporate network and you can
    emulate it in a lab.'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**学习实用的渗透测试**：对初学者来说，拥有一个可以练习他们学到的渗透测试技术并巩固新学到的信息的环境是至关重要的。在这一过程中，您很可能希望拥有一个真实世界企业网络的模型，并可以在实验室中模拟它。'
- en: '**Improve and maintain penetration testing skills**: Experienced professionals
    also need a lab to periodically try some new attack techniques, research vulnerabilities,
    or refresh their knowledge. Penetration testing knowledge and hacking skills tend
    to be forgotten or go extinct without regular practical exercises and this is
    equally true for pentesters and all other professions and specialties.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**提升和维护渗透测试技能**：有经验的专业人士也需要一个实验室，定期尝试一些新的攻击技术、研究漏洞或刷新他们的知识。渗透测试知识和黑客技能如果没有定期的实践练习，往往会被遗忘或消失，这对渗透测试人员以及所有其他职业和专长领域同样适用。'
- en: '**Evaluate penetration testing tools and frameworks**: You can use a lab to
    quickly deploy new penetration testing frameworks and attack suites, test their
    capabilities and convenience, their effectiveness, and result quality. It can
    be especially helpful when dealing with one or more commercial tools or frameworks
    and you need to understand is it is worth paying for, do you get what you expect
    from that tool, and compare several tools to decide which one you are going to
    buy and use. Even black-hat hackers are interested in testing various security
    solutions to tweak their attack tools, develop or modify malware which is not
    supposed to be detected or beaten by security solutions, or perform a research
    for the purpose of identifying and abusing new vulnerabilities in security solutions.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估渗透测试工具和框架**：你可以使用实验室快速部署新的渗透测试框架和攻击套件，测试它们的能力、便利性、有效性和结果质量。尤其在涉及一个或多个商业工具或框架时，它尤其有用，因为你需要了解这些工具是否值得付费，是否能满足你的预期，并对比几个工具，决定哪一个值得购买和使用。即使是黑帽黑客，也有兴趣测试各种安全解决方案，以调整他们的攻击工具，开发或修改不应该被安全解决方案检测到或击败的恶意软件，或者进行研究，以识别和利用安全解决方案中的新漏洞。'
- en: '**Evaluate security tools and solutions**: Normally, almost all penetration
    testing projects include not only hacking activities, but also a phase of developing
    security recommendations based on results of a test. To be able to provide deep
    and qualitative recommendations, a security professional has to be familiar with
    the recommended solutions and one of the opportunities to do so is to try security
    solutions himself.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估安全工具和解决方案**：通常，几乎所有的渗透测试项目不仅包括黑客活动，还包括根据测试结果制定安全建议的阶段。为了能够提供深入且高质量的建议，安全专家必须熟悉推荐的解决方案，而其中一个途径就是亲自尝试安全解决方案。'
- en: '**Demonstrate attacks and security risks**: Sometimes, a customer or a company
    management (who is also a customer for a security specialist, but an internal
    one) wants to better understand risks associated with certain vulnerabilities
    to be able to make a correct risk-management decision. Attack demonstrations can
    also be very helpful in an education process when teaching other people while
    giving security testing classes. Various attack techniques can be demonstrated
    in real time or can be recorded in a lab environment and then shown in a class.
    As it was already mentioned earlier, seeing in an example how does an attack works
    increases the education quality significantly. A lot of companies worldwide maintain
    awareness programs to educate their employees in security to reduce the risks
    associated with the so-called "human factor." A lot of awareness programs face
    the same problem: it is hard to realize the security risks for non-security professionals,
    thus it is hard for them to remember and follow security rules and recommendations.
    Using a lab in an awareness program to demonstrate to employees the risks helps
    them to better understand and remember them, because they already understand what
    and how can happen. Another example is when a security specialist needs to demonstrate
    attacks and associated risks for marketing purposes.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**展示攻击和安全风险**：有时，客户或公司管理层（他们也是安全专家的客户，但属于内部客户）希望更好地理解与特定漏洞相关的风险，以便做出正确的风险管理决策。攻击演示在教学过程中也非常有帮助，尤其是教授安全测试课程时。各种攻击技术可以在实时环境中演示，也可以在实验室环境中录制，然后在课堂上展示。如前所述，看到实际攻击示范能显著提高教育质量。世界各地的许多公司都维持意识提升项目，教育员工了解安全性，减少与所谓“人为因素”相关的风险。许多意识提升项目面临相同的问题：非安全专业人士很难理解安全风险，因此也很难记住并遵循安全规则和建议。通过在意识提升项目中使用实验室演示给员工风险，帮助他们更好地理解和记住这些风险，因为他们已经明白了什么以及如何发生。另一个例子是，当安全专家需要为了市场营销目的演示攻击和相关风险时。'
- en: Although there are some other very specific reasons why one needs to have a
    lab, most of the cases usually fit into the purposes listed above and can be categorized
    this way.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管有一些其他非常具体的原因需要拥有实验室，大多数情况通常适合上述列出的目的，并且可以归类为这些类型。
- en: Lab tasks
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实验室任务
- en: Now it is time for you to determine what you want to improve, test, research,
    or demonstrate with your lab; which areas of security testing; and which skills
    are your main points of interest. To simplify our list, we combine them by areas.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候决定你想在实验室中改进、测试、研究或展示什么内容了；哪些安全测试领域；哪些技能是你主要关注的点。为了简化我们的列表，我们按领域将其进行合并。
- en: Note
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Sometimes, it could seem odd why we refer to IT-infrastructure hacking in a
    book about a wireless lab, but we would like to clarify this point: when we talk
    about corporate networks (where penetration testing makes sense), we should keep
    in mind, that wireless networks have their own underlying network infrastructure,
    and they are usually connected to other networks with important corporate IT resources.
    This is what we want to emulate in a lab—having WLANs protected in a different
    way for practicing wireless penetration testing and at the same time providing
    wireless access to a model of a real-world network for other types of hacking.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，我们可能会觉得为什么在一本关于无线实验室的书中谈到 IT 基础设施黑客攻击显得有些奇怪，但我们希望澄清这一点：当我们谈论企业网络（渗透测试有意义的地方）时，我们应该记住，无线网络有其自身的底层网络基础设施，通常它们与其他具有重要企业
    IT 资源的网络相连。这就是我们想要在实验室中模拟的场景——通过不同方式保护 WLAN，用于无线渗透测试练习，同时提供无线访问权限，以便对真实世界网络的模型进行其他类型的黑客攻击。
- en: Network reconnaissance
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 网络侦察
- en: 'To perform a successful penetration test, it is essential to understand a target
    of an attack and a network reconnaissance is the basis for that purpose. As probably
    the most important stage of the penetration testing, network reconnaissance is
    basically gathering and processing all the available information about an attack
    target, its features, and capabilities. Network reconnaissance can be:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行成功的渗透测试，了解攻击目标至关重要，而网络侦察正是为此目的的基础。作为渗透测试中最重要的阶段之一，网络侦察基本上是收集和处理所有关于攻击目标、其特性和能力的可用信息。网络侦察可以是：
- en: '**Active**: This involves interactions with a target, by sending a specially
    crafted packet and the subsequent analysis of the target reaction to external
    impact'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主动**：涉及与目标的交互，通过发送特制数据包并分析目标对外部影响的反应。'
- en: '**Passive**: This does not require any interaction, and it is performed by
    listening to the radio and wired network traffic'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**被动**：不需要任何交互，主要通过监听无线和有线网络流量来进行。'
- en: 'The goals of an activity could be:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 活动的目标可以包括：
- en: To collect sensitive data, which is being transmitted unencrypted, for example,
    the content of network frames
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 收集未加密传输的敏感数据，例如网络帧的内容。
- en: To collect information about a target network topology and network protocols
    in use (including obsolete and dangerous protocols detection)
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 收集有关目标网络拓扑和正在使用的网络协议的信息（包括检测过时和危险的协议）。
- en: To obtain versions of network services, system software, and applications
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取网络服务、系统软件和应用程序的版本信息。
- en: To identify vendors and models of hardware in use
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别正在使用的硬件供应商和型号。
- en: The final part of a network reconnaissance is a comprehensive analysis of the
    gathered information suggesting potential vulnerabilities and misconfigurations
    of a target environment that can be exploited in order to develop an attack plan.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 网络侦察的最后部分是对收集到的信息进行全面分析，建议可能存在的漏洞和错误配置，以便制定攻击计划并加以利用。
- en: Thus, the more information you collect, the more chances of success you will
    have.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你收集的信息越多，成功的机会就越大。
- en: Web application hacking
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Web 应用程序攻击
- en: Probably, the most popular and one of the most demanded topics nowadays as more
    and more desktop software and old-fashioned static websites migrate into web applications.
    That is why web application hacking became a must-have skill for professional
    penetration testers.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，随着越来越多的桌面软件和传统静态网站迁移到 web 应用程序，Web 应用程序攻击成为最受欢迎和需求量最大的主题之一。这就是为什么 Web 应用程序黑客攻击成为专业渗透测试人员必备技能的原因。
- en: The list of web application attacks includes but is not limited to cross-site
    scripting, injection attacks, cross-site request forgery, application logic attacks,
    fuzzing parameters, authentication bypass, session management attacks, and more.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: Web 应用程序攻击的列表包括但不限于跨站脚本攻击、注入攻击、跨站请求伪造、应用程序逻辑攻击、模糊测试参数、认证绕过、会话管理攻击等。
- en: Tip
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If you want to have a look at the currently most critical web security vulnerabilities,
    you can refer to the OWASP Top 10 list at [https://www.owasp.org/index.php/Top_10_2013-Top_10](https://www.owasp.org/index.php/Top_10_2013-Top_10).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想了解当前最关键的网络安全漏洞，可以参考OWASP Top 10列表，链接地址为[https://www.owasp.org/index.php/Top_10_2013-Top_10](https://www.owasp.org/index.php/Top_10_2013-Top_10)。
- en: Hacking and researching network services
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 黑客攻击和研究网络服务
- en: Network services (SMB, FTP, and SSH) along with their vulnerabilities and misconfigurations
    usually serve as gates to operating systems and not only for legitimate users.
    They also have their own specifics and an understanding of their operation can
    lead an attacker from anonymous access to control over a whole system. Improperly
    configured integrated OS mechanisms and permissions can also serve that purpose.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 网络服务（如SMB、FTP和SSH）及其漏洞和配置错误通常作为操作系统的入口，不仅对合法用户如此，它们也有自己的特点，了解它们的运作方式可以使攻击者从匿名访问进入并控制整个系统。不正确配置的操作系统集成功能和权限也能达到同样的目的。
- en: With network services, you can practice overflow vulnerabilities exploitation,
    attacking weak cryptography and weak permissions, privilege escalation, authentication
    bypass, credentials guessing, network reconnaissance, and other skills.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 使用网络服务，你可以练习溢出漏洞利用、攻击弱加密和弱权限、特权提升、身份验证绕过、凭证猜测、网络侦察等技能。
- en: AD hacking
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: AD攻击
- en: Microsoft Active Directory is the key to owning a whole enterprise network and
    as with any technology it also has its own specifics and flaws. AD is usually
    very complicated to integrate and maintain in complex enterprise networks what
    leads to numerous misconfigurations, so it is always a juicy target for penetration
    testers and hackers. But some of its flaws and misconfigurations are not easy
    to abuse without detailed understanding of how it works and can be attacked.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 微软Active Directory是控制整个企业网络的关键，和任何技术一样，它也有自己的特点和缺陷。AD通常在复杂的企业网络中很难集成和维护，这导致了大量的配置错误，因此它总是渗透测试人员和黑客的美味目标。但其中一些缺陷和配置错误没有对其工作原理和攻击方式的详细理解，是不容易被滥用的。
- en: This category implies network reconnaissance techniques, abusing group policies,
    stealing credentials, pass-the-hash and hash cracking attacks, and so on.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 本类别包括网络侦察技术、滥用组策略、窃取凭证、哈希传递和哈希破解攻击等。
- en: DBMS hacking
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: DBMS攻击
- en: DBMS surely overlaps with web application and network service hacking in some
    aspects, but it's a huge separate topic which includes much more than just interacting
    with web applications and listener security. If you want to go deeper into database
    hacking, there are plenty of things to research and practice.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: DBMS确实在某些方面与Web应用和网络服务攻击有所交集，但它是一个庞大的独立话题，涉及的内容远超仅仅与Web应用和监听器安全的互动。如果你想深入研究数据库攻击，有许多值得探索和实践的内容。
- en: DBMS hacking includes classic vulnerability exploitations, authentication bypass,
    and so on, but it goes deeper into DB specifics taking into account various levels
    of permissions, various roles, and other DBMS specifics.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库管理系统（DBMS）攻击包括经典的漏洞利用、身份验证绕过等，但它更深入地探讨了数据库的具体情况，考虑了不同的权限级别、不同的角色以及其他DBMS特性。
- en: Network layer attacks
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 网络层攻击
- en: Network layer attacks are definitely a less popular topic, because network technologies
    develop less rapidly than web topics and there is an opinion that almost everything
    was already researched and hacked in this topic. But it is a must for every penetration
    tester and most of the security specialists.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 网络层攻击无疑是一个较不受欢迎的话题，因为网络技术的发展速度不如Web技术，且有一种观点认为这个话题几乎所有内容都已被研究和攻击。但对于每个渗透测试人员和大多数安全专家来说，这仍是必须掌握的领域。
- en: Attacks of this group include bypassing firewalls and access control lists,
    breaking out of VLANs, man-in-the-middle attacks, DoS-attacks, and so on.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 本组攻击包括绕过防火墙和访问控制列表、突破VLAN、中间人攻击、拒绝服务攻击（DoS）等。
- en: Bypassing firewalls and breaking out of VLANs have slightly different underlying
    attack techniques, but the goal is the same—to bypass existing access control
    rules and measures in order to reach normally unreachable network elements (network
    services, subnets, network segments, and so on) and attack or misuse them.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 绕过防火墙和突破VLAN有不同的攻击技术，但目标是相同的——绕过现有的访问控制规则和措施，以便访问通常无法到达的网络元素（如网络服务、子网、网络段等），并对其进行攻击或滥用。
- en: Wi-Fi penetration testing
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Wi-Fi 渗透测试
- en: As we are building a lab accessible via Wi-Fi, it would be wise to get additional
    benefits from it by practicing Wi-Fi penetration testing among the other tasks,
    especially since Wi-Fi became widespread and firmly entrenched as one of the most
    important enterprise technologies.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们正在构建一个通过 Wi-Fi 访问的实验室，明智的做法是通过在其他任务中进行 Wi-Fi 渗透测试，从中获得额外的收益，尤其是在 Wi-Fi 已广泛普及并牢固地确立为最重要的企业技术之一的情况下。
- en: 'In the Wi-Fi topic, the following skills can be practiced: attacking WPA-PSK,
    attacking WPA-Enterprise, flooding, de-authentication attacks, attacking weak
    cryptography, WEP cracking, man-in-the-middle attacks, and sniffing attacks.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Wi-Fi 主题中，可以练习以下技能：攻击 WPA-PSK、攻击 WPA-Enterprise、洪泛攻击、去认证攻击、攻击弱加密、WEP 破解、中间人攻击以及嗅探攻击。
- en: Man-in-the-middle attacks
  id: totrans-53
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 中间人攻击
- en: '**Man-in-the-middle** (**MiTM**) attacks are a subtype of network layer attacks,
    but they should be reviewed separately for wireless network connections. The first
    thing we should understand is that MiTM attacks make it possible to intercept
    network traffic by physically or virtually placing an attacking machine between
    a source and a target of network traffic.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '**中间人攻击** (**MiTM**) 是网络层攻击的一种子类型，但在无线网络连接中应当单独审视。我们首先需要理解的是，MiTM 攻击使得通过物理或虚拟地将攻击机器置于网络流量的源头和目标之间，从而拦截网络流量成为可能。'
- en: In case of 802.11, a wireless network is a public network, and if it is unencrypted
    or if it has weak encryption, an attacker can intercept all data on the target
    wireless network, even without a logical connection. But if attackers set a rogue
    access point, they are able to read and modify other clients' network traffic
    and directly attack them (evil-twin attack) regardless of the WLAN protection
    type.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在 802.11 的情况下，无线网络是一个公共网络，如果它没有加密或加密较弱，攻击者即使没有逻辑连接，也能拦截目标无线网络上的所有数据。但如果攻击者设置了一个恶意接入点，他们能够读取和修改其他客户端的网络流量，并直接攻击它们（恶意双胞胎攻击），无论
    WLAN 的保护类型如何。
- en: MiTM attacks in wireless networks are performed through monitoring and injecting
    wireless communication traffic. Thus, it is possible to attack WLANs on the first
    and the second levels of the OSI model. MiTM attacks are often used in conjunction
    with de-authentication attacks, to make a participant disconnect from the network
    on behalf of an access point. De-authentication attacks are also often used to
    carry out **Denial-of-Service** (**DoS**) attacks.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: MiTM 攻击在无线网络中通过监控和注入无线通信流量来执行。因此，攻击者可以在 OSI 模型的第一层和第二层对 WLAN 进行攻击。MiTM 攻击通常与去认证攻击结合使用，使得参与者代表接入点从网络断开连接。去认证攻击也经常被用来执行
    **拒绝服务** (**DoS**) 攻击。
- en: In the case of wireless networks, DoS attacks can be a part of complex attacks
    on a WLAN along with social engineering attacks, MiTM attacks, attacks on authentication,
    and so on. But an attacker can perform a pure DoS attack intended to interrupt
    a WLAN service, for example, flooding a WLAN with jamming signals or garbage traffic.
    We have listed only the most common areas of practical security and of course,
    you can have your own specific tasks which you would like to perform in a lab,
    but in almost all cases they could be referred to one or several categories in
    our list.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在无线网络的情况下，DoS 攻击可以作为对 WLAN 的复杂攻击的一部分，结合社交工程攻击、MiTM 攻击、认证攻击等。但攻击者也可以进行纯粹的 DoS
    攻击，目的是中断 WLAN 服务，例如，通过干扰信号或垃圾流量使 WLAN 发生洪泛。我们列出了最常见的实际安全领域，当然，你也可以有自己希望在实验室中执行的特定任务，但几乎所有任务都可以归属于我们列表中的一类或多类。
- en: Planning the network topology
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 规划网络拓扑
- en: An essential step in building a network is developing a network topology. A
    network topology determines how lab components can be interconnected physically
    and logically, significantly influences data flows inside a network and sets requirements
    and limitations on network protocols usage.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 构建网络时的一个基本步骤是开发网络拓扑。网络拓扑决定了实验室组件如何在物理和逻辑上互联，并显著影响网络内部的数据流，设置了网络协议使用的要求和限制。
- en: Network segmentation is another important mechanism to think about in the planning
    stage. A network segmentation allows us to implement network management protocols
    to practice more network layer attacks, and it allows us to use integrated security
    features of network devices and dedicated network-based firewalls to provide better
    inter-segment isolation and network access control.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 网络分段是规划阶段需要考虑的另一个重要机制。网络分段允许我们实施网络管理协议，从而实践更多的网络层攻击，并且可以利用网络设备的集成功能和专用的网络防火墙提供更好的子网隔离和网络访问控制。
- en: Thus, if you want to implement certain network protocols operating in a lab,
    which make sense with practicing certain attack types and provide security to
    the lab at the same time, we need to plan a segmental lab's network with several
    subnets and virtual LANs instead of just connecting all lab components to one
    switch. We are not going to implement the security measures mentioned earlier,
    but we will implement some network segmentation to secure the lab and allow you
    to improve the lab security later if you want.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，如果你想在实验室中实现某些网络协议，这些协议与实践某些攻击类型并同时提供实验室安全性是有意义的，我们需要规划一个带有多个子网和虚拟局域网的分段实验室网络，而不是仅仅将所有实验室组件连接到一个交换机。我们不会实现之前提到的所有安全措施，但我们会实现一些网络分段来保护实验室，并且如果你需要，未来可以进一步加强实验室的安全性。
- en: 'Lab environment security is also highly dependent on a network topology that
    is implemented in a lab, so we should state general security requirements before
    we start to plan subnets and network segments:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 实验室环境的安全性也高度依赖于实验室中实现的网络拓扑，因此在开始规划子网和网络段之前，我们应该先确定一些基本的安全需求：
- en: We need to keep our internal network segments insecure to allow practice various
    attacks and, at the same time, we do not want to see somebody unauthorized accessing
    our lab whatever intentions they may have
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要保持内部网络段的不安全性，以便练习各种攻击，同时我们也不希望看到任何未经授权的人进入我们的实验室，无论他们有什么意图。
- en: The lab should be accessible for authorized users and devices via a protected
    WLAN, but it should be also possible to connect testing machines directly to the
    lab LAN to practice certain network attacks
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实验室应该可以通过受保护的 WLAN 供授权用户和设备访问，但同时也应允许将测试机器直接连接到实验室 LAN，以便实践某些网络攻击。
- en: After we have understood our lab security requirements, let's proceed with defining
    subnets and network segments which we would like to have in our lab.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们理解了实验室的安全需求后，接下来我们将定义实验室中希望拥有的子网和网络段。
- en: It is common practice to separate server and user workspaces in enterprise networks
    and assign different IP ranges to them. That is what we are going to implement
    to imitate a real network. Additionally, we are going to establish a separate
    management VLAN for managing servers—again, as in a real enterprise network. This
    will allow you to practice attack scenarios such as getting management access
    to a server after privilege escalation on a normal user workstation or build a
    network tunnel from a hacker's machine to a management interface of a network
    device via a hacked server.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在企业网络中，将服务器和用户工作空间分开并为它们分配不同的 IP 范围是常见做法。这正是我们将要实现的目标，以模拟一个真实的网络。此外，我们还将为管理服务器建立一个单独的管理
    VLAN——同样，这也是在真实企业网络中常见的做法。这将使你能够实践攻击场景，比如在普通用户工作站上通过权限提升获取服务器的管理访问权限，或者通过被黑客攻陷的服务器构建一个从黑客机器到网络设备管理接口的网络隧道。
- en: Usually, large companies want to provide Internet access to their visitors and
    still keep their internal networks safe from the possible risks associated with
    untrusted connections. Such risks can be represented, for example, by intended
    malicious behavior or even non-intended malware spreading from visitor devices.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，大公司希望为访客提供互联网访问权限，同时保持其内部网络免受来自不受信任连接的潜在风险。这些风险可能表现为恶意行为，甚至是非故意的恶意软件通过访客设备传播。
- en: To minimize those risks, companies usually implement guest network segments.
    They are normally logically or physically isolated from other enterprise networks
    and network segments but allow visitors to access the Internet. With the high
    popularity of mobile devices, WLAN became the most convenient and widely spread
    technology for guest networks.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 为了最小化这些风险，公司通常会实现访客网络段。它们通常与其他企业网络和网络段在逻辑或物理上隔离，但允许访客访问互联网。随着移动设备的广泛使用，WLAN
    成为了访客网络最方便且最普及的技术。
- en: We also would like to have a guest WLAN in the lab and mostly because we don't
    want to ever switch our trusted WLAN in a less secure mode than the one which
    protects our lab in the best way. Our lab is supposed to be accessible mostly
    via Wi-Fi (remember the book's name?) but to be vulnerable inside, so it a very
    important point to do not reduce the security of the trusted WLAN.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还希望实验室中有一个访客WLAN，主要是因为我们不想将受信任的WLAN切换到比保护我们实验室更不安全的模式。我们的实验室应该主要通过Wi-Fi访问（记得书名吗？），但内部是脆弱的，因此，保持受信任WLAN的安全性是一个非常重要的点。
- en: 'Taking into account all requirements provided previously along with the idea
    to imitate a real network without building a huge and expensive infrastructure,
    let''s design a lab with a popular scheme for small offices called **Router-on-a-Stick**.
    It is assumed in this scheme that the whole network is built on two network devices:
    a switch and a router that is connected just to one port on a switch.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到之前提供的所有要求，并且想要模拟一个真实的网络而不需要建设一个庞大且昂贵的基础设施，让我们设计一个流行的小型办公室网络方案，称为**Router-on-a-Stick**。在此方案中，假设整个网络是基于两个网络设备构建的：一个交换机和一个仅连接到交换机一个端口的路由器。
- en: The Router-on-a-Stick scheme assumes that a local network is connected to an
    external network (or ISP) via only one designated and logically isolated switch
    port. Please keep in mind that everything outside this port is an untrusted environment.
    The guest WLAN subnet is also an untrusted network environment because it is exposed
    to the air and destined for connecting untrusted devices.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**Router-on-a-Stick**方案假设本地网络通过唯一的指定且逻辑隔离的交换机端口连接到外部网络（或ISP）。请记住，所有该端口之外的环境都是不受信任的。访客WLAN子网也是不受信任的网络环境，因为它暴露在空中，且专门用于连接不受信任的设备。'
- en: We think it is a good idea for a lab to join untrusted network areas and connect
    the guest WLAN via a SOHO Wi-Fi router.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 我们认为让实验室加入不受信任的网络区域，并通过SOHO Wi-Fi路由器连接访客WLAN是一个好主意。
- en: If you decide to get an additional network-based firewall with an IPS module,
    a good place to install it is between a SOHO and a core routers. Thus, it will
    become an additional layer of security and will protect the internal lab network
    against attacks originated from external and guest networks.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你决定增加一个带有IPS模块的基于网络的防火墙，安装它的一个好地方是在SOHO与核心路由器之间。这样，它将成为一个额外的安全层，能够保护内部实验室网络免受来自外部和访客网络的攻击。
- en: 'To better represent all the ideas described till now, let''s depict the resulting
    network topology in a diagram:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地呈现到目前为止描述的所有想法，让我们在图表中展示结果的网络拓扑：
- en: '![Planning the network topology](../images/00008.jpeg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![规划网络拓扑](../images/00008.jpeg)'
- en: The lab network topology diagram
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 实验室网络拓扑图
- en: As the last step, let's define an addressing scheme for our network.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一步，让我们为我们的网络定义一个地址方案。
- en: 'The server subnet will have static IP addresses as in real networks and the
    user subnet can operate a DHCP server to provide dynamic IP addresses to workstations.
    The guest network and the trusted WLAN should also assign dynamic IP addresses.
    You can find the IP ranges for each subnet in the following list:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器子网将具有静态IP地址，如同真实网络一样，用户子网可以运行一个DHCP服务器，为工作站提供动态IP地址。访客网络和受信任的WLAN也应分配动态IP地址。你可以在以下列表中找到每个子网的IP范围：
- en: '**Server subnet**: 10.0.0.0/24'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务器子网**：10.0.0.0/24'
- en: '**User subnet**: 172.16.0.0/24'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户子网**：172.16.0.0/24'
- en: '**Guest WLAN**: 192.168.0.0/24'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**访客WLAN**：192.168.0.0/24'
- en: '**Trusted WLAN**: 172.16.1.0/24'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**受信任的WLAN**：172.16.1.0/24'
- en: '**Management VLAN**: 10.1.0.0/24'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**管理VLAN**：10.1.0.0/24'
- en: So, the network topology has been developed and we can continue with choosing
    lab components.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，网络拓扑已经开发完成，我们可以继续选择实验室组件。
- en: Choosing appropriate components
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 选择合适的组件
- en: Under this topic, we are going to decide which lab components can fulfill the
    tasks determined in the previous topic.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在本主题下，我们将决定哪些实验室组件可以完成前面主题中确定的任务。
- en: As it is not always easy to get enough budget and hardware to build a penetration
    testing lab in an enterprise environment and even harder to do it at home, we
    are going to use virtualization and free software as much as possible in this
    book. That decision influences the next topics significantly, because it sets
    additional requirements for a lab.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 由于在企业环境中建立渗透测试实验室并不总是容易获得足够的预算和硬件，甚至在家里做到这一点更难，因此在本书中我们将尽可能多地使用虚拟化和免费软件。这个决策显著影响后续主题，因为它为实验室设定了额外的要求。
- en: Virtualization has also another significant advantage—flexibility to quickly
    modify the lab environment content according to current tasks by simply turning
    virtual hosts on and off.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟化还有一个显著的优势——可以根据当前任务灵活地快速修改实验环境内容，只需简单地开启或关闭虚拟主机。
- en: For a virtual lab, you will need a computer powerful enough to run three to
    four virtual machines at the same time. We would recommend having at least four
    cores CPU and 8 GB of RAM. Additionally, you will need at least 150 GB of free
    space on a hard drive. Of course, if you have a bigger hard drive and if it is
    an SSD drive, your lab will work much better.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 对于虚拟实验室，你需要一台足够强大的计算机，能够同时运行三到四个虚拟机。我们建议至少配备四核CPU和8GB内存。此外，你还需要至少150GB的硬盘空间。当然，如果你的硬盘更大，且是SSD硬盘，那么你的实验室运行效果会更好。
- en: If you are going to build the lab on hardware network devices, it is better
    to have a couple of computers (probably less powerful, than the one described
    in the previous paragraph) to connect them to various switch ports and run VMs
    in different VLANs at the same time. But you will need them for a limited number
    of lab tasks only. If you have an opportunity to deploy a hardware virtualization
    platform based on a hypervisor such as ESXi or Xen with enough resources to run
    five to six virtual machines at once, it would be even better.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你打算在硬件网络设备上构建实验室，最好准备几台计算机（可能性能不如前面一段描述的那台）来将它们连接到不同的交换机端口，并同时在不同的VLAN上运行虚拟机。但你只会在有限数量的实验任务中使用它们。如果你有机会部署基于虚拟化平台的硬件，例如ESXi或Xen，并且有足够的资源一次性运行五到六台虚拟机，那就更好了。
- en: Network devices
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络设备
- en: 'As a basis for every network environment, we are going to start by choosing
    network devices for our lab. There are several options depending on an amount
    of budget that you are ready to spend on a lab and we will provide manuals for
    two of them:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 作为每个网络环境的基础，我们将从选择实验室的网络设备开始。根据你准备为实验室投入的预算，可能有几种选择，我们将为其中的两种提供手册：
- en: '**Option 1 (0 budget)**: Installing and configuring virtual network devices'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选项 1（0预算）**：安装和配置虚拟网络设备'
- en: '**Option 2 (budget 50-55 € or above)**: Buying and configuring old Cisco devices'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选项 2（预算50-55欧元或以上）**：购买和配置旧的思科设备'
- en: Note
  id: totrans-95
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You can always find old and relatively cheap network devices at your local advertisement
    boards and online shops such as eBay or Amazon. We recommend you to check shops
    and delivery options available in your country and city to assess price options
    and make the best choice from the options mentioned above.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 你总是可以在本地的广告板和在线商店（如eBay或Amazon）找到旧的且相对便宜的网络设备。我们建议你查看在你所在国家和城市的商店和配送选项，以评估价格并从上述选项中做出最佳选择。
- en: For example, our three Cisco devices cost us 15€ each on eBay.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们在eBay上购买的三台思科设备每台花费了15欧元。
- en: In the next chapter, we are going to implement both the options so you can choose
    which one is more suitable for you. Of course, each of the options has its own
    advantages and disadvantages.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将实现这两种选项，以便你可以选择更适合你的方案。当然，每种选项都有其优缺点。
- en: 'The main advantage of using hardware devices is getting very good performance,
    but the disadvantages are obvious: usually you need to pay for them, they are
    pretty noisy and they consume additional electricity.'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 使用硬件设备的主要优点是可以获得非常好的性能，但缺点也很明显：通常需要为它们付费，它们比较吵，而且会消耗额外的电力。
- en: The advantage of virtual network devices is their price and flexibility, but
    you can experience a lack of performance.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟网络设备的优势是价格和灵活性，但可能会遇到性能不足的情况。
- en: In our examples, we will use an old Cisco 1700 Series router and a Cisco 2900
    Series switch for a hardware option (see the following image) and GNS3 as a free
    solution for virtual network devices.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的示例中，我们将使用一台旧的思科1700系列路由器和一台思科2900系列交换机作为硬件选项（见下图），并使用GNS3作为虚拟网络设备的免费解决方案。
- en: '![Network devices](../images/00009.jpeg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![网络设备](../images/00009.jpeg)'
- en: The Cisco switch and router
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 思科交换机和路由器
- en: Tip
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Alternatively, you can use virtual network devices from the company Brocade,
    but they are not free and we have not tried them.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，你也可以使用Brocade公司提供的虚拟网络设备，但它们不是免费的，而且我们没有尝试过它们。
- en: 'We will also employ two Wi-Fi access points: a simple and cheap SOHO Wi-Fi
    router for a guest WLAN, Internet connection, and a Cisco AIR-AP521G-E-K9 access
    point for a trusted WLAN. You can see what it looks like at the following image:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将使用两个 Wi-Fi 接入点：一个简单且便宜的 SOHO Wi-Fi 路由器，用于访客 WLAN 和互联网连接，另一个是思科 AIR-AP521G-E-K9
    接入点，用于受信 WLAN。你可以在以下图像中看到它的样子：
- en: '![Network devices](../images/00010.jpeg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![网络设备](../images/00010.jpeg)'
- en: The Cisco switch and router
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 思科交换机和路由器
- en: Tip
  id: totrans-109
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: As an alternative to a simple SOHO Wi-Fi router, you can get a Wi-Fi router
    that supports open-source firmware images such as OpenWRT or DD-WRT. It will allow
    you to extend Wi-Fi security capabilities and play with a greater number of wireless
    attack types. For example, some Linksys routers support it.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 作为简单的 SOHO Wi-Fi 路由器的替代品，你可以购买支持开源固件镜像（如 OpenWRT 或 DD-WRT）的 Wi-Fi 路由器。它将允许你扩展
    Wi-Fi 安全功能，并尝试更多种类的无线攻击。例如，一些 Linksys 路由器就支持这种功能。
- en: If your budget permits, you can buy newer devices and a separated network firewall
    with an IPS module to provide higher security for our internal lab network, but
    we will not cover these topics in this book.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 如果预算允许，你可以购买更新的设备和一个带有 IPS 模块的独立网络防火墙，以为我们的内部实验室网络提供更高的安全性，但我们在本书中不会涉及这些话题。
- en: Server and workstation components
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 服务器和工作站组件
- en: Servers and workstations are actually the end-attack points in almost every
    scenario, because they perform most of network communications, generate and process
    data and network traffic, and store information and server users. In other words,
    enterprise networks are being hacked mainly because of them.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器和工作站实际上几乎在每种场景中都是最终攻击点，因为它们执行大部分网络通信，生成和处理数据及网络流量，并存储信息和服务器用户。换句话说，企业网络主要是因为它们而遭到攻击。
- en: Therefore, we should pay enough attention to planning the most important lab
    part as it will determine what we will actually be able to practice in a lab environment.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们应当充分关注规划最重要的实验室部分，因为它将决定我们在实验室环境中实际能够练习的内容。
- en: Our lab will consist of about a dozen hosts, but to simulate real-world conditions,
    we need a centralized administrative system to manage user accounts and hosts
    as one of the most important lab components. Solutions usually used for such purposes
    are based on directory services serving via a client-server interconnection model
    based on **Lightweight Directory Access Protocol** (**LDAP**). In our case, we
    are going to implement Microsoft Active Directory solution for such a centralized
    infrastructure management imitation.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的实验室将由大约十几台主机组成，但为了模拟现实世界的条件，我们需要一个集中式管理系统来管理用户账户和主机，作为最重要的实验室组件之一。通常用于此类目的的解决方案基于目录服务，通过基于**轻量级目录访问协议**（**LDAP**）的客户端-服务器连接模型提供服务。在我们的案例中，我们将实现
    Microsoft Active Directory 解决方案，用于这种集中式基础设施管理的仿真。
- en: Other lab components will serve certain application and representation-level
    tasks and we want to provide our readers with a certain level of flexibility during
    the lab building process in order to be able to customize the lab environment
    according to your own tasks and requirements.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 其他实验室组件将用于特定的应用和表示层任务，我们希望在实验室构建过程中为读者提供一定的灵活性，以便根据自己的任务和需求定制实验环境。
- en: 'A very comfortable and fast way to plan such customization is to create a self-explanatory
    table that will allow us to quickly define the correspondence between lab components
    and the certain tasks they allow us to fulfill:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 规划此类定制化的一个非常舒适且快速的方法是创建一个自解释表格，帮助我们快速定义实验室组件与它们允许我们完成的特定任务之间的对应关系：
- en: '| Tasks and attacks | Desired lab components |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| 任务与攻击 | 所需实验室组件 |'
- en: '| --- | --- |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Network reconnaissance | Linux and Windows workstations and serversWindows
    Domain with at least one domain controllerHost-based firewallsHost-based IDPSHost-based
    antivirus solutionsMisconfigured switch and routerDHCP and DNS server |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| 网络侦察 | Linux 和 Windows 工作站及服务器 Windows 域，至少有一个域控制器 主机防火墙 主机入侵检测与防御系统（IDPS）
    主机防病毒解决方案 配置错误的交换机和路由器 DHCP 和 DNS 服务器 |'
- en: '| Hacking and researching network services |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| 黑客攻击与研究网络服务 |'
- en: '| Network layer attacks and tunneling techniques |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| 网络层攻击与隧道技术 |'
- en: '| Web application hackingDBMS hacking | Web servers with various vulnerable
    web applications and DBMS installedWeb application firewall |'
  id: totrans-123
  prefs: []
  type: TYPE_TB
  zh: '| Web 应用攻击 DBMS 攻击 | 安装有各种脆弱的 Web 应用程序和数据库管理系统的 Web 服务器 Web 应用防火墙 |'
- en: '| Password and hash attacks | Linux and Windows workstations and serversWindows
    domain with at least one domain controllerFTP serviceSSH service |'
  id: totrans-124
  prefs: []
  type: TYPE_TB
  zh: '| 密码和哈希攻击 | Linux和Windows工作站及服务器Windows域，至少有一个域控制器FTP服务SSH服务 |'
- en: '| Wireless attacks | Wireless access pointsRADIUS serverAny client Wi-Fi device
    (preferably several various devices) |'
  id: totrans-125
  prefs: []
  type: TYPE_TB
  zh: '| 无线攻击 | 无线接入点RADIUS服务器任何客户端Wi-Fi设备（最好是多个不同设备） |'
- en: '| Privilege escalation techniques | Windows and Linux workstations and servers
    with vulnerable software |'
  id: totrans-126
  prefs: []
  type: TYPE_TB
  zh: '| 特权提升技术 | 存在漏洞软件的Windows和Linux工作站及服务器 |'
- en: In the following chapters, we will create virtual machines with certain parameters
    for the chosen lab components depending on their expected functionality.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将根据所选实验组件的预期功能，创建具有特定参数的虚拟机。
- en: Planning lab security
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 规划实验安全
- en: After defining the lab topology and choosing the lab components, it is time
    to have a closer look at the security. Obviously, we do not want to become somebody's
    victim due to the fact that we intentionally leave a lot of vulnerabilities in
    a lab environment.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义实验拓扑并选择实验组件之后，是时候仔细查看安全性了。显然，我们不希望由于故意在实验环境中留下大量漏洞而成为某个攻击者的受害者。
- en: At the same time, practicing security evasion techniques is definitely important
    for penetration testers and security specialists, especially for developing their
    skills to the advanced level.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，练习安全规避技术对于渗透测试人员和安全专家来说绝对重要，特别是对于提高他们的高级技能。
- en: 'According to our general security requirements and the purpose of building
    a lab, we are going to configure maximal security at the entry points to our lab
    network: at the gateway and at the trusted WLAN.'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的总体安全要求以及建立实验的目的，我们将配置最大程度的安全性，重点放在实验网络的入口点：网关和受信任的WLAN。
- en: Further, we want to define the lab security requirements in detail and group
    them by areas.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们希望详细定义实验安全要求并按区域进行分组。
- en: Access control
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 访问控制
- en: Access control is a powerful measure that allows us to enforce security if it
    is designed and configured properly. At the same time, it increases network complexity
    making attacks more sophisticated and providing the ability to make hacking exercises
    more interesting and more useful in the meaning of acquired skills.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 访问控制是一项强有力的措施，可以在设计和配置得当时强制执行安全性。同时，它增加了网络的复杂性，使得攻击变得更加复杂，也提供了使黑客练习更有趣、更有意义（在技能获得方面）的可能性。
- en: 'For the purposes of our lab, access control can be represented at two main
    levels: network-based, implemented on network devices, and host-based, implemented
    on network hosts.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的实验，访问控制可以在两个主要层面上进行表示：基于网络的访问控制，实施在网络设备上；以及基于主机的访问控制，实施在网络主机上。
- en: 'Keeping that in mind, let''s define network-based access control requirements:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 记住这一点，我们来定义基于网络的访问控制要求：
- en: If we are going to let our lab components access the Internet, but leave them
    directly inaccessible in the other direction (from the Internet), we should use
    **network address translation** (**NAT**) technology at the both of our routers.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我们希望让实验组件访问互联网，但在另一个方向（从互联网到实验室）保持它们不可直接访问，我们应当在两个路由器上使用**网络地址转换**（**NAT**）技术。
- en: Workstations should be accessible from the server segment without any limitations.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 工作站应当可以从服务器段访问，且不受任何限制。
- en: To protect our internal lab from unauthorized intrusion through a guest WLAN,
    the internal network should not be accessible from the guest subnet at all, as
    well as the guest WLAN should not be accessible from the internal network. Untrusted
    guest devices should be able to only access Internet.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了保护我们的内部实验网络不受通过访客WLAN的未经授权入侵，内部网络应当完全不可从访客子网访问，访客WLAN也应当不可从内部网络访问。不受信任的访客设备应只能访问互联网。
- en: To allow all attacks, the whole network should be accessible for authenticated
    WLAN users without any limitations.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了允许所有攻击，整个网络应对经过身份验证的WLAN用户完全开放，不受任何限制。
- en: If correctly implemented, these access control rules combined with the chosen
    network topology will significantly rise our lab's security and bring practicing
    network attacks to a higher level.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 如果正确实施，这些访问控制规则与所选网络拓扑结合，将显著提升实验室的安全性，并将网络攻击的实践提升到一个更高的水平。
- en: Integrated security mechanisms
  id: totrans-142
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 集成安全机制
- en: The security of any infrastructure can be measured by its weakest component.
    Therefore, protection of the infrastructure should consist of several levels and
    only the complex protection can provide a high level of security. It is important
    to understand that information security systems consist not only of information
    security imposed solutions, but also of integrated security mechanisms built-in
    to components of an infrastructure.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 任何基础设施的安全性都可以通过其最薄弱的环节来衡量。因此，基础设施的保护应由多个层次组成，只有复杂的保护才能提供较高的安全性。需要理解的是，信息安全系统不仅包括强制实施的信息安全解决方案，还包括集成在基础设施组件中的内置安全机制。
- en: To review and choose built-in security mechanisms, we will use an approach going
    up from low to high and from hardware to software levels.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 为了评审和选择内置的安全机制，我们将采用从低到高、从硬件到软件的方式进行。
- en: Often, cheap wired network devices have a limited set of basic security mechanisms,
    such as access control mechanisms and basic traffic filtering (simple rule-based
    firewalling capabilities), for example, access filtering based on MAC-address
    values. But in most cases, these measures will be sufficient to significantly
    reduce security violation risks and to protect from self-distributing malicious
    software and potential attackers with an average skill level.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，廉价的有线网络设备只提供一套有限的基本安全机制，例如访问控制机制和基本的流量过滤（基于规则的简单防火墙能力），例如，基于MAC地址的访问过滤。但在大多数情况下，这些措施足以显著减少安全漏洞风险，并防止自传播的恶意软件和具备一般技能水平的潜在攻击者。
- en: It is important to mention that network devices have management interfaces which
    should be protected very properly because they possess great risks for the whole
    network infrastructure. Usually, there are several such interfaces available by
    various network ports (Telnet, SSH, and Web) and access to these interfaces is
    granted by a combination of login and password. Also, if a potential attacker
    gains access to these interfaces, the consequences could be painful for the infrastructure
    up to intercepting business critical information and interrupting all network
    services of the entire company.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 需要特别提到的是，网络设备具有管理接口，这些接口应当得到妥善保护，因为它们对整个网络基础设施存在极大的风险。通常，通过各种网络端口（Telnet、SSH和Web）可以访问这些接口，访问这些接口需要通过登录名和密码组合来验证。如果潜在攻击者获得这些接口的访问权限，后果可能对基础设施造成严重影响，甚至可能会拦截关键信息并中断整个公司所有网络服务。
- en: According to our security requirements, we are going to use integrated security
    mechanisms in different ways on the network entry points (gateway and wireless
    access points) which have to be protected and on the internal network devices
    that have to be vulnerable for training purposes.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的安全要求，我们将在网络入口点（网关和无线接入点）和内部网络设备上以不同的方式使用集成的安全机制，这些设备需要得到保护，而内部设备则需要保持一定的脆弱性用于培训目的。
- en: 'We will list all built-in security features configured by default on internal
    network devices and will configure the following ones on the network entry points:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将列出所有在内部网络设备上默认配置的内置安全功能，并将在网络入口点配置以下功能：
- en: Strong network-based access control
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 强网络基础访问控制
- en: Strong password policies for authentication
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 强密码策略用于认证
- en: Event logging
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件日志
- en: Encrypted management communications where possible (HTTPS and SSH)
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽可能加密管理通信（HTTPS和SSH）
- en: 'The next level of a network abstraction is hosts (servers and workstations).
    When we consider all the hosts from the information security point of view, we
    consider their operating systems. In the context of security issues, an operating
    system is a system software with a set of local and network services that provide
    interaction between a user and an infrastructure. Needless to say, modern operating
    systems come with a set of built-in security features, which are primarily aimed
    at protection against unauthorized access. Here are some of the typical security
    features:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 网络抽象的下一级是主机（服务器和工作站）。当我们从信息安全的角度考虑所有主机时，我们会关注它们的操作系统。在安全问题的背景下，操作系统是一种系统软件，包含一组本地和网络服务，提供用户与基础设施之间的互动。不用说，现代操作系统带有一套内置的安全功能，主要目的是防止未经授权的访问。以下是一些典型的安全功能：
- en: Identification and authentication (account management, password policies, and
    so on)
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 身份识别与认证（帐户管理、密码策略等）
- en: Authorization
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 授权
- en: Access differentiation to data stores
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对数据存储的访问差异化
- en: Access control to software installation and software execution
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 软件安装和执行的访问控制
- en: Access control to OS services management
  id: totrans-158
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作系统服务管理的访问控制
- en: Access control to change OS and system applications settings
  id: totrans-159
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作系统和系统应用设置变更的访问控制
- en: Network activity filtration (built-in firewalls)
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络活动过滤（内置防火墙）
- en: Integrity control of OS system data
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 操作系统数据完整性的控制
- en: Event logging
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 事件日志记录
- en: In our lab, we will have to distinguish host configurations based on two roles,
    the server and workstation, since there are functional differences.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的实验室中，我们需要根据两种角色——服务器和工作站——区分主机配置，因为它们在功能上存在差异。
- en: To allow analysis and investigation of security incidents and attacks, event
    logging subsystem should be also activated on all hosts. In the case of the server,
    event logging should be more detailed than on the workstation, for example, it
    is important to log successful or failed attempts to login. A more interesting
    event for logging on workstations is periodical stopping and starting of services,
    because it is very likely a malware activity.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够分析和调查安全事件和攻击，应该在所有主机上启用事件日志记录子系统。在服务器上，事件日志记录应该比工作站更为详细，例如，记录成功或失败的登录尝试。在工作站上，更为重要的日志事件是周期性停止和启动服务，因为这很可能是恶意软件活动的表现。
- en: Information systems that will be used in our testing infrastructure generally
    have a minimum set of security mechanisms. Usually, these are authentication,
    access control and event logging. The set of security mechanisms and possible
    settings in each information system is individual.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我们测试基础设施中使用的信息系统通常具有最基本的安全机制。这些机制通常包括认证、访问控制和事件日志记录。每个信息系统的安全机制和可能的设置都是独特的。
- en: Built-in security mechanisms configured by default on modern Windows and Linux
    workstations provide a sufficient level of security for our needs. Therefore,
    we are going to let them stay as is in most cases, but we will enforce workstation
    security with additional third-party security solutions that we will discuss in
    the next topic.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 现代 Windows 和 Linux 工作站默认配置的内置安全机制为我们的需求提供了足够的安全级别。因此，在大多数情况下，我们将保持其原有配置，但我们将通过额外的第三方安全解决方案来加强工作站的安全性，这些解决方案将在下一主题中讨论。
- en: As we are going to have all servers and workstations as virtual machines, it
    is wise to use such a convenient virtualization feature as a snapshot. A snapshot
    is basically a saved system state which can be quickly restored. We recommend
    that you have at least two security states saved in snapshots. The first one is
    less secure for practicing simple and medium complicated attacks on it, and the
    second one will be used for practicing advanced attack techniques or in cases
    when you do not need to attack this host at the moment, but it should be turned
    on to provide some services to other hosts being attacked.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们将所有服务器和工作站设置为虚拟机，因此使用快照这一便捷的虚拟化功能是明智的。快照本质上是一个保存的系统状态，可以快速恢复。我们建议至少保存两个安全状态的快照。第一个快照相对不那么安全，用于练习简单和中等复杂的攻击，第二个快照则用于练习高级攻击技术，或者在你不需要攻击该主机时，可以将其打开以为其他正在被攻击的主机提供服务。
- en: Security solutions
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安全解决方案
- en: Though network access control and integrated security mechanisms provide a good
    level of security, having additional security solutions is a good idea. The intention
    to practice security evasion and breaking techniques along with the idea to imitate
    a real enterprise network with our lab are other fundamental requirements for
    implementing additional security solutions.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管网络访问控制和集成的安全机制提供了良好的安全保障，但增加额外的安全解决方案仍然是一个不错的选择。实践安全规避和攻破技术的意图，以及模仿真实企业网络的实验室环境，都是实施额外安全解决方案的基本要求。
- en: First of all, we need to secure the access to the WLAN which will be used to
    connect authorized users to the lab environment. We will configure WPA-Enterprise
    with mutual digital certificate-based authentication as the most secure solution
    and use a RADIUS server with FreeRADIUS software for that purpose. This is a free
    and open source software providing us a lot of authentication options and it is
    relatively easy to configure.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要确保 WLAN 的访问安全，以便将授权用户连接到实验室环境。我们将配置基于相互数字证书认证的 WPA-Enterprise 作为最安全的解决方案，并使用
    FreeRADIUS 软件的 RADIUS 服务器来实现这一目的。FreeRADIUS 是一个免费开源软件，提供了多种认证选项，并且相对容易配置。
- en: An additional security for some workstations will be provided by **host-based
    IDPS** (**HIDPS**) and antivirus solutions installed on them. It will also let
    you practice existing or developing new security evasion attack techniques. We
    will use free HIDPS with antivirus features developed by COMODO because it has
    all the necessary capabilities and is not complicated in configuration.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 对某些工作站的额外安全保护将通过安装在其上的**基于主机的入侵检测和防御系统**（**HIDPS**）和杀毒软件提供。这还将让你练习现有或开发新的安全规避攻击技术。我们将使用由COMODO开发的免费HIDPS，它具备所有必要的功能，并且配置简单。
- en: Security hints
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安全提示
- en: In the course of this book, sometimes we are going to give you additional security
    hints on building and using a lab or just regarding currently discussed technologies.
    Security hints will be provided separately because normally they do not belong
    to the main content of the book, but in our opinion they are still worth mentioning
    and emphasizing.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的过程中，有时我们会为您提供额外的安全提示，涉及构建和使用实验室或当前讨论的技术。安全提示将单独提供，因为它们通常不属于本书的主要内容，但在我们看来，它们仍然值得提及并强调。
- en: 'So, let''s present the first security hints:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们呈现第一个安全提示：
- en: Despite that we apply a lot of security features in the lab, it still contains
    a lot of vulnerabilities and you are going to test dangerous tools that can be
    unpredictable sometimes, so we recommend you to connect your lab to an external
    network or the Internet only when it is really necessary.
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽管我们在实验室中应用了很多安全功能，但它仍然存在很多漏洞，而且您将测试一些有时可能不可预测的危险工具，因此我们建议您仅在真正必要时将实验室连接到外部网络或互联网。
- en: Interoperability with third-party devices should be minimized. For this purpose,
    access points should be placed in a controlled area. Additionally, signal ranges
    of our WLANs should be limited, for example, by reducing a signal power of an
    access point.
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与第三方设备的互操作性应尽量减少。为此，接入点应放置在受控区域。此外，我们的WLAN信号范围应有限制，例如，通过降低接入点的信号功率来限制。
- en: If you need to practice hacking WEP or other weak network security mechanisms,
    it is wise to save a safe configuration of affected devices and revert to it after
    practicing to do not forget to configure some important parameters into their
    safe values.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您需要练习黑客攻击WEP或其他弱网络安全机制，明智的做法是保存受影响设备的安全配置，并在实践后恢复它，以免忘记将某些重要参数配置为安全值。
- en: When practicing WEP and WPA-PSK hacking, it is wise to physically disconnect
    a Wi-Fi router from a lab network, so nobody will be able to hack your lab during
    that time when it stays poorly protected while you are practicing.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在练习WEP和WPA-PSK黑客攻击时，明智的做法是将Wi-Fi路由器物理断开与实验室网络的连接，这样在您练习时，实验室将处于不太安全的状态，没人能在这段时间内攻击您的实验室。
- en: Summary
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we developed a basis structure for our lab that allows us to
    start building a lab systematically, clearly understanding why we have chosen
    certain lab components and which tasks they will fulfill for us.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们为我们的实验室开发了一个基础结构，使我们能够系统地开始构建实验室，并清晰地理解我们为何选择某些实验室组件，以及它们将为我们完成哪些任务。
- en: We hope that after reading this chapter, you can identify your personal needs
    and tasks in the provided lists and make a deliberate conclusion what do you want
    to have in your lab and what is not necessary for you.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望在阅读完本章后，您能够在提供的清单中识别出个人需求和任务，并得出有意识的结论，了解您希望在实验室中拥有哪些内容，以及哪些内容对您来说是不必要的。
- en: The developed network topology combines principles used for building real enterprise
    networks and enough complexity to practice various types of penetration testing
    techniques. It is affordable for a home lab as well as in a corporate network.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 开发的网络拓扑结合了构建真实企业网络所用的原则，以及足够的复杂性，以便练习各种类型的渗透测试技术。它适用于家庭实验室，也适用于企业网络。
- en: In the next chapter, we will actually start building the lab network according
    to our topology and show you how to install and configure network devices.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将根据我们的拓扑结构实际开始构建实验室网络，并向您展示如何安装和配置网络设备。
