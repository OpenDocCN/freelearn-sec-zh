- en: '8'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '8'
- en: Pentesting Azure Features through Serverless Applications and Tools
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过无服务器应用程序和工具进行 Azure 渗透测试
- en: In the last chapter, we looked at the various SaaS, PaaS, and IaaS services
    Azure has to offer.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们查看了 Azure 提供的各种 SaaS、PaaS 和 IaaS 服务。
- en: Now, it’s time to actually practice some vulnerability scanning and pentesting
    in your very own Azure deployment! This will be fun and educational. If you have
    gone through [*Chapter 5*](B18672_05.xhtml#_idTextAnchor080), *Pentesting AWS
    Features through Serverless Applications and Tools*, we’re going to be doing the
    same kind of work in this chapter, but in Azure.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，是时候在你自己的 Azure 部署中实际进行一些漏洞扫描和渗透测试了！这将会既有趣又富有教育意义。如果你已经阅读过 [*第 5 章*](B18672_05.xhtml#_idTextAnchor080)，*通过无服务器应用程序和工具进行
    AWS 渗透测试*，我们将在本章进行类似的工作，但是在 Azure 上。
- en: This chapter features a step-by-step guide to using Azure’s own first-party
    security tools to check security configurations and conduct vulnerability assessments.
    The featured tools are Microsoft Defender for Cloud and Azure Firewall Manager.
    After that, we will learn how to configure the most popular third-party Azure
    pentesting tools. The featured tools are Prowler, MFASweep, and ScoutSuite. Lastly,
    we’ll have a look at the pentesting tutorials to find credentials, enumerate Azure
    services, conduct vulnerability scans, and discover exposed services with Prowler,
    MFASweep, and ScoutSuite.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将提供一个逐步指南，教你如何使用 Azure 自有的第一方安全工具检查安全配置并进行漏洞评估。重点介绍的工具是 Microsoft Defender
    for Cloud 和 Azure Firewall Manager。之后，我们将学习如何配置最流行的第三方 Azure 渗透测试工具。重点介绍的工具有 Prowler、MFASweep
    和 ScoutSuite。最后，我们将通过 Prowler、MFASweep 和 ScoutSuite，查看渗透测试教程，找出凭证、列举 Azure 服务、进行漏洞扫描，并发现暴露的服务。
- en: 'The following topics will be covered in this chapter:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涉及以下主题：
- en: Setting up an Azure instance
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 Azure 实例
- en: Setting up an Azure account
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 Azure 账户
- en: Using Azure Cloud Shell and PowerShell
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Azure Cloud Shell 和 PowerShell
- en: Azure native security tools
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 原生安全工具
- en: Azure pentesting tools
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure 渗透测试工具
- en: Exploiting Azure applications
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用 Azure 应用程序
- en: So, let’s get into some practical exercises!
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，让我们开始一些实际的练习吧！
- en: Technical requirements
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'We will be working with Microsoft’s infrastructure. Massive Azure data centers
    will be doing the bulk of the computer processing work for the exercises in this
    chapter. So, fortunately, you don’t need to have a top-of-the-line workstation.
    You will need the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将与 Microsoft 的基础设施合作。本章练习中的大部分计算处理将由庞大的 Azure 数据中心完成。所以，幸运的是，你不需要拥有顶级工作站。你需要以下设备：
- en: A web browser
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个网页浏览器
- en: A desktop or laptop PC
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一台桌面或笔记本电脑
- en: An Android or iPhone smartphone
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一部 Android 或 iPhone 智能手机
- en: A good, reliable internet connection
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个良好的、可靠的互联网连接
- en: 'Check out the following video to view the Code in Action: [https://bit.ly/3rUulqT](https://bit.ly/3rUulqT)'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 请查看以下视频，查看代码实战：[https://bit.ly/3rUulqT](https://bit.ly/3rUulqT)
- en: Setting up an Azure instance
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 Azure 实例
- en: Anyone can set up their own Microsoft Azure account. Many Azure services are
    free of charge. I strongly recommend deploying your own Azure instance to practice
    vulnerability scanning and pentesting in Azure before you do paid work for a client
    so that you can practice your skills. And chances are that your Azure test deployment
    is simpler than the Azure network the organization you work for operates!
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 任何人都可以设置自己的 Microsoft Azure 账户。许多 Azure 服务是免费的。我强烈建议你在为客户做付费工作之前，先部署自己的 Azure
    实例来练习漏洞扫描和渗透测试，这样你可以练习你的技能。而且你在 Azure 上进行的测试部署可能比你所在组织的 Azure 网络还要简单！
- en: Thanks to the magic of the cloud and the fact that the computer processing,
    data storage, and bandwidth are on Microsoft’s infrastructure, you don’t need
    to have a powerful workstation computer to try the exercises I will demonstrate
    in this chapter. A typical desktop or laptop PC with Windows, macOS, or Linux,
    good web functionality, and a modern web browser will do.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 多亏了云计算的魔力，以及计算处理、数据存储和带宽都托管在 Microsoft 的基础设施上，你不需要拥有一台强大的工作站电脑就能尝试本章中我所演示的练习。一台典型的桌面或笔记本电脑，配备
    Windows、macOS 或 Linux，良好的网络功能和现代浏览器就足够了。
- en: 'First, open your web browser and go to Microsoft’s guide to free Azure services
    ([https://azure.microsoft.com/en-ca/free](https://azure.microsoft.com/en-ca/free)).
    Here are most of the Azure services that are free as of the time of this writing
    in 2023:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，打开你的网页浏览器，访问 Microsoft 免费 Azure 服务的指南（[https://azure.microsoft.com/en-ca/free](https://azure.microsoft.com/en-ca/free)）。以下是截至
    2023 年本书撰写时大部分免费的 Azure 服务：
- en: '**Azure Active Directory** is always free, but you’re limited to 50,000 stored
    objects with a **single sign-on** (**SSO**) authentication interface. Again, this
    shouldn’t be a problem with your test deployment.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory** 始终免费，但你被限制为50,000个存储对象，并提供**单点登录**（**SSO**）身份验证接口。同样，对于你的测试部署，这应该不是问题。'
- en: '**Azure Advisor** services are always free and unlimited. Advisor makes personalized
    recommendations and identifies best practices for using Azure.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Advisor** 服务始终免费且不限量。Advisor提供个性化建议，并识别使用Azure的最佳实践。'
- en: You get 12 months of **Anomaly Detector** services for free. Anomaly Detector
    uses **artificial intelligence** (**AI**) and **machine learning** (**ML**) to
    help you troubleshoot technical problems in Azure.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以免费使用12个月的**Anomaly Detector**服务。Anomaly Detector利用**人工智能**（**AI**）和**机器学习**（**ML**）帮助你在Azure中排除技术问题。
- en: '**Azure App Configuration** is always free, but there’s a limit of 1,000 requests
    per day with 10 MB of storage. It’s very unlikely that your Azure test deployment
    will make more than 1,000 requests per day. App Configuration manages and stores
    the configurations of your Azure apps.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure App Configuration** 始终免费，但每日请求数限制为1,000次，存储空间为10 MB。你的Azure测试部署不太可能超过每日1,000次请求。App
    Configuration用于管理和存储你的Azure应用配置。'
- en: '**Azure App Service** is always free. App Service makes it possible to create
    apps for any platform or device using tools such as PHP and Node.js. You are limited
    to 10 apps with 1 GB of storage and 1 hour per day, though. This is unlikely to
    be an issue with your test deployment.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure App Service** 始终免费。App Service使你能够使用PHP和Node.js等工具为任何平台或设备创建应用。你被限制为10个应用，存储为1
    GB，每天使用1小时。对于你的测试部署来说，这不太可能成为问题。'
- en: '**Azure DevOps** is always free but with a limit of five users. Azure DevOps
    facilitates building apps with CI/CD methodologies, using Git repositories. Basically,
    if your app needs to deploy several updates per day, Azure DevOps helps to make
    it happen.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure DevOps** 始终免费，但限制为五个用户。Azure DevOps帮助通过CI/CD方法构建应用，使用Git存储库。基本上，如果你的应用需要每天进行多次更新，Azure
    DevOps将帮助你实现这一目标。'
- en: '**Azure Files** is free for the first 12 months. It makes it possible to migrate
    your files across platforms without changing any code. But you’re limited to 100
    GB of **locally redundant storage** (**LRS**) transactions and 2 million file
    operations. That may be restrictive to some corporate clients, but it’s unlikely
    to be a problem with your test deployment. (LRS is about synchronously replicating
    data to three disks.)'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Files** 在前12个月是免费的。它使你能够跨平台迁移文件，而无需更改任何代码。但你被限制为100 GB的**本地冗余存储**（**LRS**）事务和200万次文件操作。这对于一些企业客户可能会有些限制，但对于你的测试部署来说不太可能是个问题。（LRS是指将数据同步复制到三个磁盘上。）'
- en: '**Azure Kubernetes Service** (**AKS**) is always free. That’s very important
    because Kubernetes containerization is one of the most common use cases for cloud
    networks! You’ll learn about pentesting Kubernetes containerizations in Azure
    in [*Chapter 9*](B18672_09.xhtml#_idTextAnchor159).'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Kubernetes Service**（**AKS**）始终免费。这非常重要，因为Kubernetes容器化是云网络中最常见的用例之一！你将在[*第9章*](B18672_09.xhtml#_idTextAnchor159)中了解在Azure中渗透测试Kubernetes容器化。'
- en: '**Azure Lighthouse** is always free. It allows you to manage different service
    providers interfacing with your Azure network under the Zero Trust network security
    model. Zero Trust is a more secure alternative to the old perimeter model of security.
    Instead of having a perimeter with your trusted computers inside, the internet
    and other untrusted computers outside, and authentication at the perimeter, Zero
    Trust creates authentication vectors at all possible points and distrusts all
    unauthenticated data transmissions by default, even if they’re coming from inside
    your own network.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Lighthouse** 始终免费。它允许你在“零信任”网络安全模型下，管理与你的Azure网络接口的不同服务提供商。零信任是比旧的周界安全模型更安全的一种替代方案。与其有一个周界，信任内部的计算机，外部是互联网和其他不受信任的计算机，并在周界进行身份验证，零信任在所有可能的点创建身份验证矢量，并默认不信任所有未经身份验证的数据传输，即使它们来自你自己的网络内部。'
- en: '**Azure Maps** is an equivalent to Google Maps in the Azure ecosystem. It has
    many APIs and features and integrates natively with all Azure applications. You
    can do things with custom embedded maps on your own mobile, desktop, and web applications
    alike. Using Azure Maps in the applications you develop is always free, but you’re
    limited to 1,000 to 5,000 transactions for specific mapping and location insights
    features.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Maps** 是 Azure 生态系统中类似于 Google Maps 的服务。它拥有许多 API 和功能，并且与所有 Azure 应用程序本地集成。您可以在移动设备、桌面和
    Web 应用程序中使用自定义嵌入地图。在您开发的应用程序中使用 Azure Maps 是免费的，但特定的地图和位置洞察功能限制为 1,000 到 5,000
    个事务。'
- en: '**Azure Migrate** is always free. It helps you migrate your **virtual machines**
    (**VMs**) from your premises or other cloud platforms to Azure.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Migrate** 总是免费的。它帮助您将虚拟机（**VMs**）从您的本地环境或其他云平台迁移到 Azure。'
- en: '**Azure Policy** helps you comply with data privacy and cybersecurity regulations.
    This is likely more of an issue for your employer than for your Azure test deployment.
    But you do get free access to configuration and change tracking features.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Policy** 帮助您遵守数据隐私和网络安全法规。这对您的雇主可能比您的 Azure 测试部署更为重要。但您可以免费访问配置和更改跟踪功能。'
- en: You get 15 GB of outbound data transfer bandwidth free for the first 12 months,
    and 100 GB of inbound data transfer for free always.
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 首次 12 个月内，您将免费获得 15 GB 的出站数据传输带宽，并且始终免费获得 100 GB 的入站数据传输。
- en: '**Blobs** are a kind of unstructured data object. You get 5 GB of LRS storage
    in Blob Storage, with 20,000 read and 10,000 write operations for free for the
    first 12 months. But I don’t anticipate you using Blob Storage for your test deployment
    anyway.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Blob** 是一种非结构化数据对象。在 Blob Storage 中，首次 12 个月内免费获得 5 GB 的 LRS 存储空间，包括 20,000
    次读取和 10,000 次写入操作。但我不预期您会在测试部署中使用 Blob Storage。'
- en: As far as **Cloud Shell** is concerned, you get 5 GB of free storage in Azure
    Files for free for the first 12 months. It’s the Azure equivalent of AWS CloudShell,
    which I demonstrated in *Chapters 5* and *6*. Having access to a CLI in your web
    browser is very important, and you almost certainly will be using Azure Cloud
    Shell in your Azure test deployment too!
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 就 **Cloud Shell** 而言，在 Azure 文件中免费获得 5 GB 存储空间，首次 12 个月免费。这是 AWS CloudShell
    的 Azure 等效，我在 *第 5* 和 *第 6* 章中演示了它。在 Web 浏览器中访问 CLI 非常重要，您几乎肯定也会在 Azure 测试部署中使用
    Azure Cloud Shell！
- en: '**Container Apps** is always free but with some limits. Container Apps makes
    it possible to deploy apps and microservices in serverless containers, and you’re
    limited to 180,000 vCPU seconds, 360,000 GiB seconds, and 2 million requests.
    That’s unless you’re ready to pay extra.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Container Apps** 总是免费的，但有一些限制。Container Apps 可以在无服务器容器中部署应用程序和微服务，但您的使用受到
    180,000 vCPU 秒、360,000 GiB 秒和 2 百万请求的限制，除非您愿意额外付费。'
- en: '**Container Registry** stores and manages your container images throughout
    Azure’s ecosystem. It’s free for the first 12 months, but you’re limited to one
    Standard tier registry with 100 GB storage and 10 webhooks.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**容器注册表** 在 Azure 生态系统中存储和管理容器映像。首次 12 个月免费，但您的限制为一个标准层注册表，包括 100 GB 存储和 10
    个 Webhook。'
- en: '**Cost Management** is always free. So, you won’t be paying extra to save money
    and optimize your Azure cloud services expenses with full visibility into your
    expenditures. And of course, if you always stay within the free services and their
    limits, then there won’t be any expenditures in the first place! But you can always
    check with Cost Management anyway.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**成本管理** 总是免费的。因此，您不需要额外付费来节省和优化 Azure 云服务的费用，可以全面了解您的支出情况。当然，如果始终保持在免费服务及其限制内，那么就根本不会有支出！但无论如何，您都可以通过成本管理进行检查。'
- en: '**Database Migration Service** makes it easier to migrate databases from on-premises
    servers to the cloud. It’s unlikely you’ll be doing that with your test deployment,
    but the Free Standard Compute level is always free.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据库迁移服务** 使数据库从本地服务器迁移到云更加轻松。但是在测试部署中，免费标准计算级别总是免费的。'
- en: '**DevTest Labs** enables developers to test their work in dev/test environments.
    It’s always free.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DevTest Labs** 让开发人员能够在开发/测试环境中测试其工作。它总是免费的。'
- en: '**Event Grid** assures reliable event delivery at a massive scale, to facilitate
    service integration. It’s always free, but you’re limited to 100,000 operations
    per month. You should be fine!'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Event Grid** 保证在大规模下可靠地传递事件，以促进服务集成。它总是免费的，但您每月的操作限制为 100,000 次。这应该足够了！'
- en: '**Functions** makes it possible to process events with a serverless code architecture.
    Just in case you want to use it, 1 million requests are always free.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**函数**使得可以使用无服务器代码架构处理事件。万一你需要使用它，1,000,000 次请求始终免费。'
- en: '**Key Vault** safely stores the encryption keys you use in your Azure services.
    Its services are free for the first 12 months, but you’re limited to 10,000 transactions,
    RSA 2048-bit keys, or secret operations at the Standard tier.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**密钥保管库**安全地存储你在 Azure 服务中使用的加密密钥。它的服务在前 12 个月免费，但你限于 10,000 次事务、RSA 2048 位密钥或标准级别的机密操作。'
- en: You get some amount of **Linux VMs** for free for the first 12 months. The limit
    is 750 hours of B1s burstable VMs.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在前 12 个月内，你可以免费获得一定数量的 **Linux 虚拟机**。限制是 750 小时的 B1s 弹性虚拟机。
- en: '**Load Balancer** assures that the usage of your Azure deployment is balanced
    across servers according to demands at any given time. For the first 12 months,
    you get 750 hours, 15 GB of data processing, and up to five rules with Standard
    Load Balancer.'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**负载均衡器**确保你的 Azure 部署根据任何给定时刻的需求，在服务器间平衡使用。在前 12 个月内，你可以免费获得 750 小时、15 GB
    数据处理和最多五个规则的标准负载均衡器。'
- en: '**Managed Disks** is a service used for Azure Virtual Machines block storage.
    For the first 12 months, you get 2 drives of 64 GB SSD storage, plus 1 GB snapshot
    and 2 million I/O operations for free. Anything more is going to cost you!'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**托管磁盘**是用于 Azure 虚拟机块存储的服务。在前 12 个月内，你可以免费获得 2 个 64 GB SSD 存储驱动器、1 GB 快照和
    200 万次 I/O 操作。超出部分将产生费用！'
- en: '**Media Services** makes it possible for you to deploy streaming media to any
    kind of device, such as streaming video or audio. It’s unlikely that you’ll be
    doing that with your test deployment. But just in case, you get 5 hours each of
    Standard Passthrough, Live Transcription, and Standard Streaming endpoints free
    for the first 12 months.'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**媒体服务**让你能够将流媒体部署到任何设备上，如流视频或音频。你可能在测试部署中不需要这样做，但万一需要，你可以在前 12 个月内免费获得每项 5
    小时的标准通道、实时转录和标准流媒体端点服务。'
- en: '**Monitor** gives you full visibility and observability into your applications,
    infrastructure, and network. There are different limits per feature, but otherwise,
    it’s always free.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**监控**让你可以全面了解和观察你的应用程序、基础设施和网络。每个功能有不同的限制，但除此之外，它始终免费。'
- en: '**Network Watcher** helps you monitor, diagnose, and otherwise understand your
    network performance in Azure. It’s always free, but you’re limited to 5 GB storage
    with 1,000 checks, 10 tests, and 10 connection metrics.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络观察器**帮助你监控、诊断并理解你的 Azure 网络性能。它始终免费，但你限于 5 GB 存储，1,000 次检查，10 次测试和 10 个连接度量。'
- en: '**Notification Hubs** allows you to send push notifications to any mobile device
    (iOS and Android). You’re limited to 1 million push notifications, but that much
    is free. This should only be a concern if you’re using your Azure instance to
    deploy mobile apps, though.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**通知中心**允许你向任何移动设备（iOS 和 Android）发送推送通知。你限于 100 万次推送通知，但这些是免费的。不过，如果你用 Azure
    部署移动应用，才需要关注这个限制。'
- en: '**Private Link** lets you privately access your Azure services from any of
    your own endpoints. It’s always free.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**私有链接**让你可以从任何自己的端点私密地访问你的 Azure 服务。它始终免费。'
- en: '**Resource Manager** lets you see how your app resources are being used and
    enables you to manage it all. It’s always free.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**资源管理器**让你查看应用资源的使用情况，并使你能够管理它们。它始终免费。'
- en: '**Security Center** makes it possible to prevent, detect, and respond to threats
    across all your Azure deployments. Policy assessments and recommendations are
    always free!'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全中心**使你能够在所有 Azure 部署中防止、检测和响应威胁。策略评估和建议始终免费！'
- en: It’s highly likely that your web apps and other database-driven apps will need
    **SQL Database**. For the first 12 months, you get a 250 GB S0 instance with 10
    database transaction units for free.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 很可能你的 web 应用和其他基于数据库的应用需要 **SQL 数据库**。在前 12 个月内，你可以免费获得一个 250 GB S0 实例，并附带 10
    个数据库事务单元。
- en: '**SQL Server 2019 Developer Edition** makes it possible to build, test, and
    demonstrate applications outside of your production environment. It’s always free.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SQL Server 2019 开发版**让你可以在生产环境之外构建、测试和展示应用程序。它始终免费。'
- en: You also get some amount of **Windows VMs** for free for the first 12 months.
    Again, the limit is 750 hours of B1s burstable VMs.
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在前 12 个月内，你也可以免费获得一定数量的 **Windows 虚拟机**。同样，限制是 750 小时的 B1s 弹性虚拟机。
- en: You get 50 instances of **Virtual Network** for free, always. But that’s for
    provisioning private networks and connecting them to a data center that’s on your
    premises. That’s not likely something you’ll need for your test deployment.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你将免费获得 50 个 **虚拟网络** 实例，永久有效。但这是用于配置私有网络并将其连接到你本地的数据中心。对于你的测试部署来说，这不太可能是必需的。
- en: '**VPN Gateway** makes it possible to deploy VPNs across data centers and cloud
    services. That encrypts your data in transit in a very effective way. You get
    750 hours for free for the first 12 months. But that’s probably a service that’s
    much more useful for the organization that you’re working for than for your Azure
    test deployment.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**VPN 网关** 使得在数据中心和云服务之间部署 VPN 成为可能。这能非常有效地加密你的传输数据。前 12 个月内，你可以免费使用 750 小时。但这可能是对于你所在的组织来说，比对于你的
    Azure 测试部署更有用的服务。'
- en: Let’s deploy an Azure instance for you to use for testing purposes.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们部署一个 Azure 实例，供你用于测试目的。
- en: Setting up an Azure account
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置 Azure 账户
- en: 'Everything you need to do to launch your first Azure instance to practice your
    pentesting skills can be done from your web browser. Here’s how:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 启动你的第一个 Azure 实例并练习渗透测试技能所需的所有操作都可以通过网页浏览器完成。以下是操作步骤：
- en: 'While you’re on the Azure free services web page ([https://azure.microsoft.com/en-ca/free](https://azure.microsoft.com/en-ca/free)),
    click on the green **Start** **free** button:'
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你进入 Azure 免费服务网页时（[https://azure.microsoft.com/en-ca/free](https://azure.microsoft.com/en-ca/free)），点击绿色的
    **开始** **免费** 按钮：
- en: '![Figure 8.1 – Azure free account creation page](image/B18672_08_1.jpg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.1 – Azure 免费账户创建页面](image/B18672_08_1.jpg)'
- en: Figure 8.1 – Azure free account creation page
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.1 – Azure 免费账户创建页面
- en: You’ll be taken to a screen to sign in to a Microsoft account. If you use Windows
    10 or Windows 11 at home, chances are you already have a Microsoft account. You
    can choose to use your existing Microsoft account, create a new Microsoft account
    (which you may do even if you already have another Microsoft account), or sign
    in with your GitHub credentials if you have them.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 你将被引导到一个登录微软账户的页面。如果你在家使用 Windows 10 或 Windows 11，可能已经拥有微软账户。你可以选择使用现有的微软账户，创建一个新的微软账户（即使你已经有另一个微软账户，也可以创建新的账户），或者如果有
    GitHub 账户，可以用 GitHub 凭证登录。
- en: 'I decided to use a Microsoft account that I already have. I’m cautious when
    it comes to cybersecurity, so I already had **multi-factor authentication** (**MFA**)
    set up on my Android phone with Microsoft Authenticator. I used my password and
    a code sent to my phone through Microsoft Authenticator, and I was logged in.
    Microsoft Authenticator is free for both Android and iOS, and I strongly recommend
    using it for your Azure services. Here’s where you can learn more about Microsoft
    Authenticator: [https://www.microsoft.com/en-ca/security/mobile-authenticator-app](https://www.microsoft.com/en-ca/security/mobile-authenticator-app).'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我决定使用我已经拥有的微软账户。我对网络安全很谨慎，所以我已经在我的 Android 手机上通过微软身份验证器设置了 **多因素身份验证**（**MFA**）。我使用密码和通过微软身份验证器发送到我手机的验证码成功登录。微软身份验证器适用于
    Android 和 iOS，且免费使用，我强烈建议你在使用 Azure 服务时使用它。你可以在这里了解更多关于微软身份验证器的信息：[https://www.microsoft.com/en-ca/security/mobile-authenticator-app](https://www.microsoft.com/en-ca/security/mobile-authenticator-app)。
- en: Just to make sure there’s no confusion, I use my phone for Microsoft Authenticator,
    but I use my Windows 11 laptop to work with Azure through its web interfaces.
    It’s not very practical to manage your cloud services from your phone. Fortunately,
    a MacBook or a Linux PC works just as well as a Windows PC for this work.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 为确保没有任何混淆，我使用手机进行微软身份验证器（Microsoft Authenticator），但我使用 Windows 11 笔记本电脑通过其网页界面与
    Azure 进行工作。从手机管理云服务不太实际。幸运的是，MacBook 或 Linux 电脑与 Windows 电脑一样适合这项工作。
- en: Once I logged in, I was taken to a form where I entered my name, my region (in
    my case, Canada), and my phone number. I even got $200 USD of credit to use in
    my first 30 days! Thank you, Microsoft. My phone number was confirmed via an SMS
    text message. Then, I entered my home mailing address and agreed to the customer
    agreement. At the bottom of the form, click on **Next**.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录后，我被引导到一个表单，填写了我的姓名、所在地区（在我的情况中是加拿大）和电话号码。我还获得了 200 美元的信用额度，可以在前 30 天内使用！谢谢，微软。我的电话号码通过短信进行了验证。然后，我填写了我的家庭邮寄地址并同意了客户协议。在表单底部，点击
    **下一步**。
- en: Then, you’ll see a screen where you enter your credit card information. Even
    if you’re using free services, this step is mandatory. Your card will be charged
    if you incur any number of paid services or consume over your free services limits.
    I recommend using Azure’s Cost Management app to watch that carefully!
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你将看到一个需要输入信用卡信息的屏幕。即使你正在使用免费服务，这一步也是必须的。如果你使用了任何收费服务或超出了免费服务限制，信用卡将会被扣费。我建议使用
    Azure 的成本管理应用来密切关注这一点！
- en: At the bottom, click on the blue **Sign** **up** button.
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在底部，点击那个蓝色的**注册**按钮。
- en: Wait a few moments, and your account will be set up. Then, you’ll see a screen
    that says **You’re ready to start with Azure**. Click on the blue button that
    says **Go to the Azure portal**. It sounds very exciting! We’re going on a cloud
    services journey together.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待片刻，账户将会被设置好。然后，你将看到一个显示**你已准备好开始使用 Azure**的屏幕。点击那个蓝色按钮，按钮上写着**前往 Azure 门户**。听起来非常激动人心！我们将一起踏上云服务之旅。
- en: 'The QuickStart Center will show you a lot of different options for you to get
    started. You can take an online course, follow setup guides, or start a project.
    The project options under the **Projects and guides** tab are:'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 快速入门中心将为你展示多种不同的选项，帮助你开始使用。你可以参加在线课程、跟随设置指南或开始一个项目。在**项目和指南**标签下的项目选项有：
- en: '**Create a** **web app**'
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**创建一个** **Web 应用**'
- en: '**Deploy a** **virtual machine**'
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**部署** **虚拟机**'
- en: '**Deploy and run a** **container-based app**'
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**部署并运行一个** **基于容器的应用**'
- en: '**Set up** **a database**'
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**设置** **数据库**'
- en: '**Get started with data analytics, machine learning,** **and intelligence**'
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开始数据分析、机器学习** **和智能化工作**'
- en: '**Store, back up, or** **archive data**'
  id: totrans-81
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**存储、备份或** **归档数据**'
- en: '**Build, deploy, and operate a** **serverless app**'
  id: totrans-82
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**构建、部署并运营一个** **无服务器应用**'
- en: 'You can see an overview of this here:'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以在这里看到概述：
- en: '![Figure 8.2 – Microsoft Azure Quickstart Center](image/B18672_08_2.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.2 – Microsoft Azure 快速入门中心](image/B18672_08_2.jpg)'
- en: Figure 8.2 – Microsoft Azure Quickstart Center
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.2 – Microsoft Azure 快速入门中心
- en: For now, let’s deploy a VM. (We’ll deploy and run a container-based app in [*Chapter
    9*](B18672_09.xhtml#_idTextAnchor159).)
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们来部署一个虚拟机。（我们将在[*第 9 章*](B18672_09.xhtml#_idTextAnchor159)中部署并运行一个基于容器的应用。）
- en: 'Next, you’ll be given the option to create a Windows VM or a Linux VM:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，你将有机会创建一个 Windows 虚拟机或 Linux 虚拟机：
- en: '![Figure 8.3 – Screen to deploy a VM from Quickstart Center](image/B18672_08_3.jpg)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.3 – 从快速入门中心部署虚拟机的屏幕](image/B18672_08_3.jpg)'
- en: Figure 8.3 – Screen to deploy a VM from Quickstart Center
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.3 – 从快速入门中心部署虚拟机的屏幕
- en: Because I used a Linux VM in the AWS chapter, we’ll shake things up and choose
    a Windows VM here. But if you create a Linux VM, you can use the Linux Bash commands
    at the CLI that I used in [*Chapter 5*](B18672_05.xhtml#_idTextAnchor080) for
    AWS.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 因为在 AWS 章节中我使用了 Linux 虚拟机，所以我们来点不同的，选择一个 Windows 虚拟机。但是如果你创建一个 Linux 虚拟机，你可以在
    CLI 中使用我在[*第 5 章*](B18672_05.xhtml#_idTextAnchor080)中为 AWS 使用的 Linux Bash 命令。
- en: 'The next screen says **Create a virtual machine** at the top. You’ll have a
    form to fill out:'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一屏幕顶部显示**创建虚拟机**。你将需要填写一个表单：
- en: Under **Project details**, leave the subscription as default or **Azure subscription
    1**. Under resource group, leave it at **(New)** **Resource group**.
  id: totrans-92
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在**项目详情**下，保持订阅为默认值或**Azure 订阅 1**。在资源组下，保持为**（新建）资源组**。
- en: Under **Instance details**, give VM an original name that you’ll remember. I
    entered **PentestingWindowsVM**. Spaces and special characters aren’t allowed!
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在**实例详情**下，为虚拟机取一个你容易记住的名字。我输入了**PentestingWindowsVM**。不允许使用空格和特殊字符！
- en: I chose **(US) East US** as my region. But you can choose any region that you’d
    like. It doesn’t even need to be near your physical location. You can be in India
    and choose **(Europe) Norway East** if you want!
  id: totrans-94
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我选择了**（美国）东部美国**作为我的区域。但你可以选择任何你喜欢的区域。它甚至不需要靠近你的实际位置。你可以在印度并选择**（欧洲）挪威东部**，如果你愿意的话！
- en: Under **Availability options**, I chose **No infrastructure redundancy required**.
    That’s your safest bet if you want to avoid service charges. However, the organization
    you work for has much greater needs than your test deployment and would probably
    choose a different option.
  id: totrans-95
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在**可用性选项**下，我选择了**不需要基础设施冗余**。如果你希望避免服务费用，这是最安全的选择。不过，你所在的组织需求远大于你的测试部署，可能会选择不同的选项。
- en: Under **Security type**, I chose **Standard**. That’s the safest bet for your
    own test deployment to avoid service charges, but a business, institution, or
    enterprise should probably choose a greater security level.
  id: totrans-96
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 **安全类型** 下，我选择了 **标准**。这是针对你自己的测试部署来说最安全的选择，可以避免产生服务费用，但对于企业、机构或大公司来说，可能需要选择更高的安全级别。
- en: I left the default Windows Server 2016 Datacenter as my image. x64 is the only
    VM architecture option for that image. Besides, ARM64 isn’t a free service option.
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我保留了默认的 Windows Server 2016 数据中心作为我的镜像。x64 是该镜像的唯一虚拟机架构选项。另外，ARM64 不是免费的服务选项。
- en: I chose the smallest possible size (1 vCPU, 3.5 GiB memory for $91.98 per month).
    I’m only going to be using my instance for a month, and this will fit into my
    $200 USD of free credit. Fingers crossed! You don’t need a large size for your
    own test deployment.
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我选择了最小的配置（1 vCPU，3.5 GiB 内存，月费用 $91.98）。我只打算使用我的实例一个月，而这正好可以在我的 $200 USD 免费额度内。希望一切顺利！对于你自己的测试部署来说，不需要选择较大的配置。
- en: On the next screen, create a username and password for your administrator account.
    Make sure your password is strong! I used a password manager to generate a complex
    password with lots of characters. I recommend using a password manager too, perhaps
    one built into your web browser. Then, you won’t have to remember your complex
    passwords.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一屏上，为你的管理员账户创建一个用户名和密码。确保你的密码足够强！我使用了密码管理器来生成一个包含大量字符的复杂密码。我也建议你使用密码管理器，或许是一个内置于你浏览器中的密码管理器。这样，你就不必记住那些复杂的密码了。
- en: On the next screen, I disabled public inbound ports. Then, at the bottom left,
    I clicked on the blue **Review + create** button because I decided to leave the
    rest of the defaults for **Disks**, **Networking**, **Management**, and **Monitoring**.
    Your view may look similar or a little different. Look at the words on your screen
    carefully. I plan to cancel my Azure account in about a month. But if you need
    to keep your Azure test deployment longer, then I recommend clicking on **Next**
    instead of **Review + create** and consider your options carefully.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一屏上，我禁用了公共入站端口。然后，在左下角，我点击了蓝色的 **审核 + 创建** 按钮，因为我决定保留 **磁盘**、**网络**、**管理**
    和 **监控** 的默认设置。你的界面可能看起来差不多，或者略有不同。仔细查看屏幕上的文字。我计划在大约一个月后取消我的 Azure 账户。如果你需要长时间保留你的
    Azure 测试部署，我建议你点击 **下一步** 而不是 **审核 + 创建**，然后仔细考虑你的选项。
- en: If the options on your screen look good, click on the blue **Create** button
    in the lower-left corner. Otherwise, click on the **Previous** button to change
    your configuration accordingly.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果屏幕上的选项看起来不错，点击左下角的蓝色 **创建** 按钮。否则，点击 **上一步** 按钮来更改你的配置。
- en: It takes a few moments for your deployment to be ready. Be patient!
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 部署准备好需要一些时间，请耐心等待！
- en: Your mileage may vary. But for me, my deployment took about a minute to take
    effect. Then, the screen said **Your deployment is complete**. So, I clicked on
    the blue **Go to** **resource** button.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 你的体验可能有所不同。但对我来说，部署大约花了一分钟时间才生效。然后，屏幕上显示 **您的部署已完成**。于是，我点击了蓝色的 **转到资源** 按钮。
- en: In [*Chapter 9*](B18672_09.xhtml#_idTextAnchor159), we will pentest the VM we
    just deployed.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [*第 9 章*](B18672_09.xhtml#_idTextAnchor159)中，我们将对刚才部署的虚拟机进行渗透测试。
- en: If you’re really technical, you’ll love the screen that appears after clicking
    **Go to resource**. You can browse all of the technicalities of your VM and other
    Azure services. But for now, let’s get into Azure Cloud Shell.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你真的很懂技术，你一定会喜欢点击 **转到资源** 后出现的界面。你可以浏览你虚拟机和其他 Azure 服务的所有技术细节。但现在，我们先进入 Azure
    Cloud Shell。
- en: Using Azure Cloud Shell and PowerShell
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Azure Cloud Shell 和 PowerShell
- en: 'Wherever you are in the web interface for managing your Azure services (the
    URL in your address bar should say **portal.azure.com**), as long as you’re logged
    in, there will be a blue menu bar at the top. To the right of the search bar,
    there’s an icon that looks like a command prompt (something like this: **>_**):'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你在管理 Azure 服务的网页界面上在哪一位置（你地址栏中的 URL 应该显示为 **portal.azure.com**），只要你已登录，在页面顶部会有一条蓝色菜单栏。在搜索栏的右侧，会有一个类似命令提示符的图标（大概是这样：**>_**）：
- en: '![Figure 8.4 – Azure menu bar and Cloud Shell](image/B18672_08_4.jpg)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.4 – Azure 菜单栏和 Cloud Shell](image/B18672_08_4.jpg)'
- en: Figure 8.4 – Azure menu bar and Cloud Shell
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.4 – Azure 菜单栏和 Cloud Shell
- en: 'Click on it to launch Azure Cloud Shell. In Azure Cloud Shell, you can switch
    back and forth between PowerShell and Bash at the drop-down menu in the top-left
    corner. You may have to choose **Create storage** the first time you launch Cloud
    Shell:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 点击它来启动 Azure Cloud Shell。在 Azure Cloud Shell 中，你可以通过左上角的下拉菜单在 PowerShell 和 Bash
    之间切换。首次启动 Cloud Shell 时，你可能需要选择 **创建存储**：
- en: '![Figure 8.5 – Azure Cloud Shell screen](image/B18672_08_5.jpg)'
  id: totrans-111
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.5 – Azure Cloud Shell 屏幕](image/B18672_08_5.jpg)'
- en: Figure 8.5 – Azure Cloud Shell screen
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.5 – Azure Cloud Shell 屏幕
- en: 'You’ll find some Bash commands in [*Chapter 5*](B18672_05.xhtml#_idTextAnchor080),
    *Pentesting AWS Features through Serverless Applications and Tools*. We will be
    using Bash when installing and executing the tools in this chapter. But let’s
    review some useful PowerShell commands that you can use at the Azure Cloud Shell
    CLI. They’re handy to know, and you may need to use PowerShell commands when conducting
    some other activities in Azure Cloud Shell:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 你将在 [*第 5 章*](B18672_05.xhtml#_idTextAnchor080) 中找到一些 Bash 命令，*通过无服务器应用和工具渗透测试
    AWS 功能*。我们将在本章中使用 Bash 来安装和执行工具。但让我们先回顾一些你可以在 Azure Cloud Shell CLI 中使用的有用的 PowerShell
    命令。它们非常实用，你可能在执行 Azure Cloud Shell 中的其他活动时需要使用 PowerShell 命令：
- en: 'Similar to Bash, you can use the following commands to change which directory
    you have open:'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类似于 Bash，你可以使用以下命令来更改当前打开的目录：
- en: '**cd**'
  id: totrans-115
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**cd**'
- en: '**chdir**'
  id: totrans-116
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**chdir**'
- en: 'Copy an item with one of the following commands before the filename of the
    item you’re copying:'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在你复制项目之前，使用以下命令之一，并在命令中输入你想要复制的文件名：
- en: '**copy**'
  id: totrans-118
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**copy**'
- en: '**cp**'
  id: totrans-119
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**cp**'
- en: 'You can move an item with any of the following commands. You’ll also need to
    enter the file path and filename that you’re moving and the destination file path
    in the command:'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以使用以下任何命令来移动项目。你还需要在命令中输入要移动的文件路径和文件名，以及目标文件路径：
- en: '**mi**'
  id: totrans-121
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**mi**'
- en: '**move**'
  id: totrans-122
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**move**'
- en: '**mv**'
  id: totrans-123
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**mv**'
- en: 'Remove an item with one of the following commands and the name of the file
    or files you’d like to remove. Remember, this will delete your files:'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用以下命令和你想要删除的文件名来移除一个项目。记住，这将删除你的文件：
- en: '**del**'
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**del**'
- en: '**erase**'
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**erase**'
- en: '**rd**'
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rd**'
- en: '**ri**'
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ri**'
- en: '**rm**'
  id: totrans-129
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rm**'
- en: 'This command will remove an entire directory. Be careful when you use it:'
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这个命令将删除整个目录。使用时请小心：
- en: '**rmdir**'
  id: totrans-131
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rmdir**'
- en: 'If you want to create a new item, use the following command. I’ll usually only
    use it for text-based documents that can be modified in Notepad, though. Using
    this command will create an empty file with the filename you choose in your command:'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你想创建一个新项目，请使用以下命令。通常，我只会用它来创建可以在记事本中修改的文本文件。使用这个命令会创建一个空文件，并使用你在命令中选择的文件名：
- en: '**ni**'
  id: totrans-133
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ni**'
- en: 'Set a new value on an item with this command:'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用这个命令设置项目的新值：
- en: '**si**'
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**si**'
- en: For instance, you can enter **si path <string>** to a string or **si value <object>**
    to an object, such as [https://ss64.com/ps/set-item.html](https://ss64.com/ps/set-item.html).
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 例如，你可以输入 **si path <string>** 来设置一个字符串，或者 **si value <object>** 来设置一个对象，例如 [https://ss64.com/ps/set-item.html](https://ss64.com/ps/set-item.html)。
- en: 'Start a background job (executable task) with this command:'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用这个命令启动一个后台任务（可执行任务）：
- en: '**sajb**'
  id: totrans-138
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**sajb**'
- en: 'Suspend the job with this command:'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用这个命令挂起任务：
- en: '**sujb**'
  id: totrans-140
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**sujb**'
- en: 'Resume the job with this command:'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用这个命令恢复任务：
- en: '**rujb**'
  id: totrans-142
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rujb**'
- en: 'Start a stopped service:'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动一个已停止的服务：
- en: '**sasv**'
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**sasv**'
- en: 'In Azure Cloud Shell, whether you run PowerShell or Bash, the following guide
    will be displayed the moment you launch Cloud Shell. The commands I’ve shown here
    so far work in the Azure CLI, and checking out the built-in help guide is always
    a good use of your time:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Azure Cloud Shell 中，无论你运行的是 PowerShell 还是 Bash，启动 Cloud Shell 后，以下指南将会显示出来。我在这里展示的命令适用于
    Azure CLI，查看内置帮助指南总是一个很好的时间利用方式：
- en: '[PRE0]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Up next, let us take a look at some of the native Azure security tools.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们看看一些原生的 Azure 安全工具。
- en: Azure native security tools
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 原生安全工具
- en: Here’s what’s built into Azure that can help you with security.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 Azure 中内置的可以帮助你提高安全性的一些工具。
- en: Microsoft Defender
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Microsoft Defender
- en: Microsoft Defender for Cloud is an important application for checking your security
    posture in Azure. It will give you security recommendations based on your current
    configuration and let you know about some of the security vulnerabilities you
    have. This is information that you can use in your pentest report.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Defender for Cloud 是一个重要的应用程序，用于检查你在 Azure 中的安全状况。它会根据你当前的配置提供安全建议，并告知你存在的一些安全漏洞。这些信息可以用于你的渗透测试报告。
- en: 'Let’s open Microsoft Defender and see what we can learn about how secure our
    Azure deployment is:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们打开 Microsoft Defender，看看我们能了解到有关 Azure 部署的安全性：
- en: To execute the application, first, make sure that you’re logged in to your Azure
    account in your web browser. Visit [portal.azure.com](http://portal.azure.com).
    You should then see this screen.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要执行该应用，首先确保你已在浏览器中登录 Azure 帐户。访问 [portal.azure.com](http://portal.azure.com)。你应该会看到这个屏幕。
- en: Next, at the blue menu bar at the top, enter **Defender** in the search bar.
    A link to Microsoft Defender for Cloud should populate. Click on it.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，在顶部的蓝色菜单栏中，在搜索框中输入**Defender**。应该会显示出指向 Microsoft Defender for Cloud 的链接。点击它。
- en: You may need to add Microsoft Defender for Cloud as a paid service. If you haven’t
    signed up for it already, there will be a handy **Upgrade** button on the main
    page of the application. Be careful to check the subscription fees before you
    commit!
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可能需要将 Microsoft Defender for Cloud 添加为付费服务。如果你尚未注册，可以在应用的主页面看到一个方便的**升级**按钮。提交前务必检查订阅费用！
- en: 'Once you’re in Microsoft Defender for Cloud, there will be a menu on the left-hand
    side with a number of different sections (*Figure 8**.6*). They represent different
    tools for understanding your security posture in Azure:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦进入 Microsoft Defender for Cloud，你将在左侧菜单中看到多个不同的部分（*图 8.6*）。它们代表了用于了解你在 Azure
    中安全态势的不同工具：
- en: '**Recommendations** will show you some security improvement recommendations,
    classified as **High**, **Medium**, and **Low** in severity.'
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**推荐**将向你显示一些安全改进建议，按严重程度分类为**高**、**中**和**低**。'
- en: '**Attach path analysis** will show if Defender has identified an attack path
    to your Azure instance that a threat actor could use. Hopefully, this page will
    say **No attack paths were found**. Whether or not an attack path was found, you
    can include this information in your pentest report.'
  id: totrans-158
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**附加路径分析**将显示 Defender 是否已识别出攻击者可能利用的攻击路径，指向你的 Azure 实例。希望该页面显示**未找到攻击路径**。无论是否找到攻击路径，你都可以将此信息纳入你的渗透测试报告。'
- en: '**Security alerts** is similar to **Recommendations**. Alerts are classified
    as **High**, **Medium**, and **Low** in severity.'
  id: totrans-159
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全警报**类似于**推荐**。警报按严重程度分类为**高**、**中**和**低**。'
- en: '**Cloud Security Explorer** will show you a bunch of query templates you can
    execute:'
  id: totrans-160
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**云安全探索器**将展示一系列你可以执行的查询模板：'
- en: Internet-exposed VMs
  id: totrans-161
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网暴露的虚拟机
- en: Internet-exposed VMs with high-severity vulnerabilities
  id: totrans-162
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在高危漏洞的互联网暴露虚拟机
- en: VMs vulnerable to a specific vulnerability
  id: totrans-163
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在特定漏洞的虚拟机
- en: Internet-exposed SQL servers with managed identity
  id: totrans-164
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公开访问的带有托管身份的互联网暴露 SQL 服务器
- en: User accounts without MFA and with permissions to storage accounts
  id: totrans-165
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有 MFA 且具有存储账户权限的用户账户
- en: Azure Kubernetes pods running images with high-severity vulnerabilities
  id: totrans-166
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行具有高危漏洞的 Azure Kubernetes Pods
- en: Key Vault keys and secrets without any expiration period
  id: totrans-167
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有任何过期期限的 Key Vault 密钥和机密
- en: User accounts with permission to vulnerable VMs
  id: totrans-168
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拥有脆弱虚拟机权限的用户账户
- en: Internet-exposed SQL servers tagged as production
  id: totrans-169
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标记为生产环境的互联网暴露 SQL 服务器
- en: External users with permission to SQL VMs that allow code execution on the host
  id: totrans-170
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拥有 SQL 虚拟机权限并允许在主机上执行代码的外部用户
- en: VMs with Log4Shell vulnerability that has permissions to storage accounts
  id: totrans-171
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在 Log4Shell 漏洞并具有存储账户权限的虚拟机
- en: Kubernetes namespaces that contain vulnerable pods
  id: totrans-172
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 含有漏洞 Pods 的 Kubernetes 命名空间
- en: Internet-exposed **Simple Storage Service** (**S3**) buckets with sensitive
    data that allow public access
  id: totrans-173
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公开访问的互联网暴露的**简单存储服务**（**S3**）存储桶，包含敏感数据
- en: Internet-exposed storage account containers with sensitive data that allow public
    access
  id: totrans-174
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公开访问的存储账户容器，包含敏感数据并允许公开访问
- en: '**Diagnose and solve problems** offers a number of automated troubleshooters
    to resolve issues in these areas:'
  id: totrans-175
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**诊断和解决问题**提供了多个自动化故障排除工具，帮助解决以下领域的问题：'
- en: Defender **cloud security posture management** (**CSPM**) plan
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Defender **云安全态势管理**（**CSPM**）计划
- en: Defender for servers
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器防护
- en: Onboarding and settings
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 入驻和设置
- en: Pricing, billing, and usage
  id: totrans-179
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定价、计费和使用情况
- en: Secure score and recommendations
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全评分和推荐
- en: Security alerts
  id: totrans-181
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全警报
- en: '**Vulnerability** **assessment** (**VA**)'
  id: totrans-182
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**漏洞** **评估**（**VA**）'
- en: The latter two troubleshooters should be especially useful for you to make sure
    your security alerts and vulnerability assessments work properly!
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 后两个故障排除工具对你确保安全警报和漏洞评估正常工作特别有用！
- en: Under **Cloud Security**, **Security posture** will present an overview with
    a secure score and environment indicators (Management groups, Subscriptions, Unhealthy
    resources, and Recommendations). You can also generate a governance report from
    the top of the screen. This data may be useful to include in your pentest report.
  id: totrans-184
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在**云安全**下，**安全态势**会展示一个概览，包含安全评分和环境指标（管理组、订阅、不健康资源和建议）。你还可以从屏幕顶部生成治理报告。这些数据可能在你的渗透测试报告中有所帮助。
- en: From the left menu in Microsoft Defender for Cloud, you can also view **Azure
    Firewall Manager**, which will show you monitoring reports and overviews.
  id: totrans-185
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Microsoft Defender for Cloud 的左侧菜单中，你还可以查看**Azure 防火墙管理器**，它会显示监控报告和概览。
- en: You can also manage **Azure Firewall Policies**, **distributed denial-of-service**
    (**DDoS**) **Protection Plans**, and **Web Application** **Firewall Policies**.
  id: totrans-186
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你还可以管理**Azure 防火墙策略**、**分布式拒绝服务**（**DDoS**）**保护计划**和**Web 应用防火墙策略**。
- en: In the next section, I’ll walk you through the installation processes we’ll
    use when we exploit our own Azure test deployments.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节，我将带你了解我们在利用自己 Azure 测试部署时使用的安装过程。
- en: Azure pentesting tools
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Azure 渗透测试工具
- en: In the previous chapter, I listed several different third-party applications
    that you can use when you pentest Azure.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章，我列出了几种你在进行 Azure 渗透测试时可以使用的第三方应用程序。
- en: Everything that I’ll demonstrate here is permitted under Microsoft’s policies,
    as long as you’re either conducting these activities in your own Azure instance
    or you have permission from the owner of the Azure instance you’re working with
    to conduct vulnerability scanning and pentesting there.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我在这里演示的所有操作都符合 Microsoft 的政策，只要你是在自己的 Azure 实例中进行这些活动，或者你已获得你正在使用的 Azure 实例所有者的许可，允许你在其上进行漏洞扫描和渗透测试。
- en: But I believe there’s no such thing as being too cautious. So, I’m linking to
    Microsoft’s policies again ([https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement](https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement)).
    Please read and understand those policies so that you can abide by them, whether
    or not the Azure instance you’re working in is yours, because ultimately, you’re
    still working in Microsoft’s infrastructure either way!
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 但我认为没有过于谨慎的说法。因此，我再次提供微软的政策链接（[https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement](https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement)）。请阅读并理解这些政策，以便你能够遵守它们，无论你在的
    Azure 实例是否属于你，因为归根结底，无论如何你还是在微软的基础设施中工作！
- en: Prowler
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Prowler
- en: 'In the AWS section ([*Chapter 5*](B18672_05.xhtml#_idTextAnchor080)), we found
    Prowler to be a very useful vulnerability scanning tool. Prowler is also good
    for vulnerability scanning in Azure, so I’ll walk you through Prowler’s installation
    process in Azure:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在 AWS 部分（[*第 5 章*](B18672_05.xhtml#_idTextAnchor080)），我们发现 Prowler 是一个非常有用的漏洞扫描工具。Prowler
    在 Azure 中也同样适用，所以我将带你了解如何在 Azure 中安装 Prowler：
- en: 'Launch Azure Cloud Shell by looking to the right of the search bar at the top.
    There’s an icon that looks like a command prompt (something like this: **>_**).'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过查看顶部搜索栏右侧，点击一个类似命令提示符的图标（像这样：**>_**）来启动 Azure Cloud Shell。
- en: Click on it!
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 点击它！
- en: Instead of launching the PowerShell CLI in Azure Cloud Shell, we’ll need to
    run Bash instead. At the top left of the Azure Cloud Shell display, there’s a
    drop-down menu to switch back and forth between PowerShell and Bash. Make sure
    Bash is selected.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们不打算在 Azure Cloud Shell 中启动 PowerShell CLI，而是需要运行 Bash。在 Azure Cloud Shell
    显示的左上方，有一个下拉菜单，可以在 PowerShell 和 Bash 之间切换。确保选择了 Bash。
- en: 'We’re going to use **pip** to install Prowler, so it might be useful to make
    sure the version of **pip** that you have installed in Azure is up to date. Try
    this command first:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用**pip**来安装 Prowler，因此确保你在 Azure 中安装的**pip**版本是最新的可能会很有帮助。首先尝试这个命令：
- en: '[PRE1]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, we’re going to install Prowler with one simple command. First, make sure
    you’re in your home directory or the directory you’d like to run and install Prowler
    in. Use the **cd** command if you need to do so. Then, use **pip** to install
    Prowler, like this:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将通过一个简单的命令来安装 Prowler。首先，确保你位于主目录或者你希望在其中运行并安装 Prowler 的目录。如果需要，可以使用**cd**命令来进行切换。然后，使用**pip**来安装
    Prowler，像这样：
- en: '[PRE2]'
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You’ll see the various Prowler components downloaded at the command line, and
    then all of the necessary packages should be installed. Hopefully, you will be
    good to go! If you need more help, check out the official Prowler documentation
    ([https://docs.prowler.cloud/en/latest/](https://docs.prowler.cloud/en/latest/))
    and the official pip documentation ([https://pip.pypa.io/en/stable/](https://pip.pypa.io/en/stable/)).
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 你会看到命令行中下载了各种 Prowler 组件，然后所有必要的包应该都会被安装。希望一切顺利！如果你需要更多帮助，可以查看官方的 Prowler 文档
    ([https://docs.prowler.cloud/en/latest/](https://docs.prowler.cloud/en/latest/))
    和官方的 pip 文档 ([https://pip.pypa.io/en/stable/](https://pip.pypa.io/en/stable/))。
- en: Next, let’s install MFASweep ([https://github.com/dafthack/MFASweep](https://github.com/dafthack/MFASweep)).
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们安装 MFASweep ([https://github.com/dafthack/MFASweep](https://github.com/dafthack/MFASweep))。
- en: MFASweep
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: MFASweep
- en: '**MFASweep** is a PowerShell script that attempts to log in to various Microsoft
    services using a provided set of credentials and will attempt to identify if MFA
    is enabled. It’s very important for all user accounts in Azure to have MFA enabled
    to protect those accounts from cyber attackers.'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '**MFASweep** 是一个 PowerShell 脚本，尝试使用提供的凭据登录到各种 Microsoft 服务，并检查是否启用了多因素认证（MFA）。对于
    Azure 中的所有用户账户，启用 MFA 非常重要，以保护这些账户免受网络攻击者的侵害。'
- en: Let’s install it!
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始安装吧！
- en: In another web browser tab, make sure you’re logged in to your GitHub account
    at [github.com](http://github.com). If necessary, create a new GitHub account.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在另一个浏览器标签页中，确保你已登录到你的 GitHub 账户，网址是 [github.com](http://github.com)。如果需要，可以创建一个新的
    GitHub 账户。
- en: 'Next, run this command to link your GitHub account to your Azure account. You
    may need to add a **one-time password** (**OTP**) in order to do so. If that’s
    the case, an OTP for you to enter into GitHub (in the other web browser tab) will
    be generated:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，运行此命令将你的 GitHub 账户与 Azure 账户关联。你可能需要输入 **一次性密码**（**OTP**）来完成此操作。如果是这样，你将会生成一个
    OTP，输入到 GitHub（在另一个浏览器标签页中）：
- en: '[PRE3]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, enter this command to use Git to install MFASweep:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，输入这个命令来使用 Git 安装 MFASweep：
- en: '[PRE4]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![Figure 8.6 – MFASweep installation process in Azure](image/B18672_08_6.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.6 – MFASweep 在 Azure 中的安装过程](image/B18672_08_6.jpg)'
- en: Figure 8.6 – MFASweep installation process in Azure
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.6 – MFASweep 在 Azure 中的安装过程
- en: In the preceding screenshot, you can see the GitHub repository cloning process
    and installation of MFASweep at the command line.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的截图中，你可以看到 GitHub 仓库克隆过程以及 MFASweep 在命令行中的安装过程。
- en: ScoutSuite
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ScoutSuite
- en: 'Now, let’s install ScoutSuite. ScoutSuite is useful for auditing the security
    posture of our Azure instance. In Bash, enter this command:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们安装 ScoutSuite。ScoutSuite 对审计我们的 Azure 实例的安全状态非常有用。在 Bash 中输入以下命令：
- en: '[PRE5]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Various ScoutSuite components will be downloaded and installed. But if that
    doesn’t work properly, I recommend checking out the ScoutSuite page on GitHub
    ([https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite))
    for additional help:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 各种 ScoutSuite 组件将会被下载并安装。如果这一步没有正常进行，建议访问 GitHub 上的 ScoutSuite 页面 ([https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite))
    获取更多帮助：
- en: '![Figure 8.7 – ScoutSuite installation process](image/B18672_08_7.jpg)'
  id: totrans-218
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.7 – ScoutSuite 安装过程](image/B18672_08_7.jpg)'
- en: Figure 8.7 – ScoutSuite installation process
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.7 – ScoutSuite 安装过程
- en: Now, let’s use the tools we installed!
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们使用我们安装的工具！
- en: Exploiting Azure applications
  id: totrans-221
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 利用 Azure 应用程序
- en: Now, let’s run some security tests with the tools we’ve installed.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们使用我们安装的工具进行一些安全测试。
- en: Prowler
  id: totrans-223
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Prowler
- en: 'First, let’s run a default Prowler scan in Azure. The default scan is an effective
    general vulnerability assessment. Follow these steps:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们在 Azure 中运行一个默认的 Prowler 扫描。默认扫描是一个有效的通用漏洞评估。请按照以下步骤进行：
- en: Launch Azure Cloud Shell and make sure you’re using Bash. At the top left of
    the Azure Cloud Shell display, there’s a drop-down menu to switch back and forth
    between PowerShell and Bash. There you go!
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 Azure Cloud Shell，确保使用的是 Bash。在 Azure Cloud Shell 界面左上方，有一个下拉菜单可以在 PowerShell
    和 Bash 之间切换。搞定了！
- en: 'I like to just make sure that Prowler is installed properly before I commence
    a scan. Check the version of Prowler you have with this command:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我喜欢在开始扫描之前先确认 Prowler 是否正确安装。使用以下命令检查你安装的 Prowler 版本：
- en: '[PRE6]'
  id: totrans-227
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Next, let’s see which security checks you can run with Prowler in Azure with
    this command:'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们使用这个命令查看你可以在 Azure 中运行的 Prowler 安全检查：
- en: '[PRE7]'
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Now, let’s run some of the checks that were listed as a response to the previous
    command. Make sure **--az-cli-auth** is at the end of your **prowler azure** command
    so that you can execute it with the necessary permissions.
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们运行一些先前命令响应中列出的检查。确保**--az-cli-auth**位于你的**prowler azure**命令的末尾，以便你可以用必要的权限执行它。
- en: 'If you experience technical problems with IAM at the command line, you can
    check your IAM settings by visiting this page in another web browser tab (Make
    sure you’re logged in to your Azure administrative account properly!):'
  id: totrans-231
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果在命令行中遇到IAM的技术问题，你可以通过在另一个浏览器标签页中访问这个页面来检查你的IAM设置（确保你已正确登录到你的Azure管理帐户！）：
- en: '[https://portal.azure.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles/adminUnitObjectId//resourceScope/%2F](https://portal.azure.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles/adminUnitObjectId//resourceScope/%2F)'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[https://portal.azure.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles/adminUnitObjectId//resourceScope/%2F](https://portal.azure.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles/adminUnitObjectId//resourceScope/%2F)'
- en: 'Run a few checks from the **--list-checks** output, like this:'
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行几个来自**--list-checks**输出的检查，像这样：
- en: '[PRE8]'
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: In between **--checks** and **--az-cli-auth**, you can input the names of any
    checks that are displayed as a result of the **prowler azure --list-checks** command.
    Give them a try! Try as many checks as you want.
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在**--checks**和**--az-cli-auth**之间，你可以输入任何显示为**prowler azure --list-checks**命令结果的检查名称。试试看！尽可能多地尝试各种检查。
- en: The result of the checks scan will print on screen according to whether they
    passed or failed. You can also acquire logs from your scan in HTML, CSV, and JSON
    formats by going to the **/****home/<your_name_here>/output/** directory.
  id: totrans-236
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 检查扫描的结果将根据其通过或失败情况显示在屏幕上。你还可以通过访问**/home/<your_name_here>/output/**目录，以HTML、CSV和JSON格式获取扫描日志。
- en: 'Next, you can see which services you can scan with Prowler in Azure with this
    command:'
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，你可以通过这个命令查看你可以在Azure中使用Prowler扫描哪些服务：
- en: '[PRE9]'
  id: totrans-238
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The Azure services you can scan will output in a list at the command line.
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以扫描的Azure服务将在命令行中输出一个列表。
- en: 'Next, let’s scan those services! Use a command like this:'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们扫描这些服务！使用类似这样的命令：
- en: '[PRE10]'
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Between **--services** and **--az-cli-auth**, you can enter the names of any
    services you’d like printed on screen from the **prowler azure –****list-services**
    command:'
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在**--services**和**--az-cli-auth**之间，你可以输入任何你希望从**prowler azure --list-services**命令中显示在屏幕上的服务名称：
- en: As with the checks scan, you can also acquire logs from your scan in HTML, CSV,
    and JSON formats by going to the **/****home/<your_name_here>/output/** directory.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 与检查扫描一样，你也可以通过访问**/home/<your_name_here>/output/**目录，以HTML、CSV和JSON格式获取扫描日志。
- en: Let’s run an MFA check with MFASweep.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用MFASweep进行MFA检查。
- en: MFASweep
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: MFASweep
- en: Making sure that MFA is enabled on all of the accounts linked to your (or your
    client’s) Azure instance is very important! Passwords are a relatively weak method
    of authentication. Passwords are frequently cracked or breached. Implementing
    MFA is crucial to ensuring that your accounts are still secure, even when cyber
    threat actors threaten your passwords. I use Microsoft Authenticator on my phone
    as my second factor of authentication. In cybersecurity speak, my password is
    “something I know,” while Microsoft Authenticator (via my phone) is “something
    I have.” If I were to implement some sort of biometrics, such as a fingerprint
    scanner, that’d be “something I am.”
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 确保在与你（或你的客户）Azure实例关联的所有帐户上启用MFA非常重要！密码是一种相对较弱的身份验证方法，密码经常被破解或泄露。实施MFA对确保你的帐户仍然安全至关重要，即使在网络威胁者威胁到你的密码时。我在手机上使用Microsoft
    Authenticator作为我的第二身份验证因素。在网络安全术语中，我的密码是“我知道的东西”，而Microsoft Authenticator（通过我的手机）是“我拥有的东西”。如果我实施某种生物识别技术，例如指纹扫描仪，那将是“我是谁”。
- en: 'Let’s execute MFASweep to check to see if the user accounts in Azure have MFA
    enabled. This command will make MFASweep check both my main Azure account and
    **Active Directory Federation** **Services** (**ADFS**):'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们执行MFASweep检查Azure中的用户帐户是否启用了MFA。这个命令将让MFASweep检查我的主Azure帐户和**Active Directory
    Federation** **Services**（**ADFS**）：
- en: '[PRE11]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Notice how careful I am not to share my Azure credentials in that example! That’s
    the kind of thinking you need to use to be effective at cybersecurity. We call
    that **OPSEC**, otherwise known as **operational security**.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 注意我在那个例子中是多么小心地不分享我的Azure凭证！这就是你在网络安全中需要采用的思维方式。我们称之为**OPSEC**，即**操作安全**。
- en: 'A new command line will be populated that starts with **>>**. I found that
    it took several minutes to see the results of my scan, so you may need to be patient:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 一个新的命令行将以 **>>** 开头。我发现查看扫描结果需要几分钟，因此你可能需要耐心等待：
- en: '![Figure 8.8 – MFASweep scan results](image/B18672_08_8.jpg)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.8 – MFASweep 扫描结果](image/B18672_08_8.jpg)'
- en: Figure 8.8 – MFASweep scan results
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.8 – MFASweep 扫描结果
- en: ScoutSuite
  id: totrans-253
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ScoutSuite
- en: Now, it’s time to conduct a basic ScoutSuite scan in Azure. Your authentication
    credentials should already be set from using the previous tools.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，是时候在 Azure 中进行基本的 ScoutSuite 扫描了。您的身份验证凭据应该已经通过使用之前的工具设置好了。
- en: 'Run the scan with the following command:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令运行扫描：
- en: '[PRE12]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'A number of actions will output at the command line, like this:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 一些操作将在命令行输出结果，如下所示：
- en: '![Figure 8.9 – ScoutSuite scanning at the command line](image/B18672_08_9.jpg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.9 – 在命令行上使用 ScoutSuite 扫描](image/B18672_08_9.jpg)'
- en: Figure 8.9 – ScoutSuite scanning at the command line
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.9 – 在命令行上使用 ScoutSuite 扫描
- en: 'When that’s all done, logs in JS, JSON, and HTML formats will be written here:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，JS、JSON 和 HTML 格式的日志将写入此处：
- en: '**scoutsuite-report/scoutsuite-results/scoutsuite_results_azure-tenant-<unique_identifier_here>.<file_extension_here>**'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '**scoutsuite-report/scoutsuite-results/scoutsuite_results_azure-tenant-<unique_identifier_here>.<file_extension_here>**'
- en: Prowler, MFASweep, and ScoutSuite should produce command-line output and logs
    that you will find very useful when pentesting Azure. Make sure to include these
    results in your pentest report and interpret them in your own words.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: Prowler、MFASweep 和 ScoutSuite 应该会产生命令行输出和日志，这些内容在渗透测试 Azure 时非常有用。确保将这些结果包含在渗透测试报告中，并用你自己的话解释它们。
- en: Summary
  id: totrans-263
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: There are a number of handy tools you can use to check your security posture
    in Azure, run vulnerability scans, and conduct simple pentests. All of the information
    you can acquire from these tools can be useful to include in your pentest report.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用多种便捷工具来检查您在 Azure 中的安全态势，运行漏洞扫描并进行简单的渗透测试。您从这些工具中获得的所有信息都可以作为渗透测试报告的一部分。
- en: Microsoft Defender for Cloud is your main security posture hub. It provides
    security recommendations, security alerts, attack path analysis, troubleshooters,
    and security configuration information. Azure Firewall Manager is also built in.
    Azure Firewall helps to allow and deny activity in your Azure instance. You definitely
    want to deny activity that could help a cyber threat actor!
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: Microsoft Defender for Cloud 是您的主要安全态势中心。它提供安全建议、安全警报、攻击路径分析、故障排除工具和安全配置相关信息。Azure
    防火墙管理器也内置其中。Azure 防火墙有助于在您的 Azure 实例中允许或拒绝活动。您绝对需要拒绝可能帮助网络威胁行为者的活动！
- en: The Azure Cloud Shell CLI can be executed in your web browser while you’re logged
    in to Azure’s web application. We can install and run third-party pentesting tools
    from Azure Cloud Shell.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: Azure Cloud Shell CLI 可以在您登录 Azure Web 应用程序时在浏览器中执行。我们可以从 Azure Cloud Shell
    安装并运行第三方渗透测试工具。
- en: Prowler is just as useful for pentesting Azure as it is for pentesting AWS.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: Prowler 在渗透测试 Azure 时与渗透测试 AWS 一样有用。
- en: MFASweep is specifically for Azure. It’s the most effective way to make sure
    MFA is set up to protect all accounts that have access to your Azure instance.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: MFASweep 专为 Azure 设计。它是确保 MFA 设置保护所有访问您 Azure 实例的帐户的最有效方法。
- en: ScoutSuite is another tool with a lot of very useful scans and checks for Azure
    built right in.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: ScoutSuite 是另一个工具，内置了许多非常有用的 Azure 扫描和检查功能。
- en: In the next chapter, we’ll deploy containerized applications in Azure, and pentest
    them too.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将部署容器化应用程序到 Azure，并进行渗透测试。
- en: Further reading
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'To learn more about the topics covered in this chapter, you can visit the following
    links:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解本章涵盖的主题，您可以访问以下链接：
- en: '*A list of free services in* *Azure*: [https://azure.microsoft.com/en-ca/free](https://azure.microsoft.com/en-ca/free)'
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Azure 中的免费服务列表*：[https://azure.microsoft.com/en-ca/free](https://azure.microsoft.com/en-ca/free)'
- en: '*A cheat sheet with PowerShell* *commands*: [https://www.comparitech.com/net-admin/powershell-cheat-sheet/](https://www.comparitech.com/net-admin/powershell-cheat-sheet/)'
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*带有 PowerShell* *命令的备忘单*：[https://www.comparitech.com/net-admin/powershell-cheat-sheet/](https://www.comparitech.com/net-admin/powershell-cheat-sheet/)'
- en: '*Prowler* *documentation*: [https://docs.prowler.cloud](https://docs.prowler.cloud)'
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Prowler* *文档*：[https://docs.prowler.cloud](https://docs.prowler.cloud)'
- en: '*MFASweep*: [https://github.com/dafthack/MFASweep](https://github.com/dafthack/MFASweep)'
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*MFASweep*：[https://github.com/dafthack/MFASweep](https://github.com/dafthack/MFASweep)'
- en: '*ScoutSuite*: [https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite)'
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*ScoutSuite*：[https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite)'
