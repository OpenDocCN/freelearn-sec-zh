- en: '6'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '6'
- en: Acquiring Host-Based Evidence
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取基于主机的证据
- en: Host systems are the targets of malicious actions far too often. Host systems
    represent a possible initial target so that someone can gain a foothold in the
    network or a pivot point for additional attacks, or the end goal of threat actors.
    As a result, incident response analysts should be prepared to investigate these
    systems. Modern operating systems such as Microsoft Windows create a variety of
    evidentiary artifacts during the execution of an application, when changes to
    files are made, or when user accounts are added. All these changes leave traces
    of activity that can be evaluated by incident response analysts. The amount of
    data that’s available to incident response analysts is increasing as storage and
    memory in even the lowest-cost consumer systems continue to expand. Commonly available
    systems are routinely manufactured with extensive memory and storage in terabytes;
    there is a great deal of data that could assist incident responders in determining
    a root cause. As a result, incident response analysts should be prepared to acquire
    different types of evidence from systems for further analysis.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 主机系统往往是恶意行为的主要目标。主机系统可能成为攻击者获得网络立足点、进行进一步攻击的枢纽，或作为威胁行为者的最终目标。因此，事件响应分析师应该做好准备调查这些系统。现代操作系统，如微软Windows，在应用程序执行时、文件更改时或添加用户账户时，会创建各种证据性产物。这些更改都会留下活动痕迹，供事件响应分析师评估。随着存储和内存的不断扩大，即使是最低成本的消费者系统，事件响应分析师可用的数据量也在不断增加。常见的系统通常制造时配备了大量内存和存储空间，容量达到TB级别；这些数据能够帮助事件响应人员确定根本原因。因此，事件响应分析师应该准备从系统中获取不同类型的证据，以便进一步分析。
- en: 'We will cover the following topics in this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下主题：
- en: Preparation
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备工作
- en: Order of volatility
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 易失性顺序
- en: Evidence acquisition
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 证据获取
- en: Acquiring volatile memory
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取易失性内存
- en: Acquiring non-volatile evidence
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取非易失性证据
- en: Preparation
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: In terms of preparation, incident response analysts should have the necessary
    tools at their disposal to acquire host-based evidence. The techniques that will
    be discussed within this chapter do not rely on any highly-specialized technology,
    but rather on tools that can be acquired for little or no cost. It is critical
    that the tools that are selected for the acquisition of evidence are those that
    are provided by reputable sources, have been proven effective by other CSIRT personnel,
    and have been validated for efficacy prior to use. Outside of software, the only
    additional hardware that is required is external hard drives and common desktop
    computers.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在准备方面，事件响应分析师应确保拥有必要的工具来获取基于主机的证据。本章将讨论的技术不依赖于任何高度专业化的技术，而是依赖于可以以很低成本甚至免费获得的工具。选择用于获取证据的工具至关重要，这些工具应该来自信誉良好的来源，已经通过其他CSIRT人员验证有效，并且在使用前已验证其有效性。除了软件外，所需的额外硬件仅为外部硬盘驱动器和常见的台式计算机。
- en: When supporting an enterprise environment, it is a good idea for incident response
    personnel to have a solid understanding of the types of systems that are commonly
    deployed. For example, in an enterprise that utilizes strictly Microsoft operating
    systems, the tools that are available should have the ability to support a wide
    range of versions of the Microsoft OS. In other circumstances, incident response
    personnel may support an enterprise where there is an 80/20 split between Microsoft
    and Linux systems; incident response personnel should be prepared with tools and
    techniques that support the acquisition of evidence.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在支持企业环境时，事件响应人员应该对常见部署的系统类型有一个清晰的理解。例如，在一个严格使用微软操作系统的企业中，可用的工具应该能够支持多个版本的微软操作系统。在其他情况下，事件响应人员可能会支持一个微软和Linux系统比例为80/20的企业；因此，事件响应人员应该准备好支持获取证据的工具和技术。
- en: Many of the tools and techniques that will be discussed in this chapter require
    administrator privileges. Incident responders should be provided with the necessary
    credentials to perform these tasks. It should be noted that analysts should only
    use existing accounts and that adding accounts to a possibly compromised system
    may make evidence inadmissible in a judicial proceeding. One technique is for
    incident response analysts to be given individual credentials that are enabled
    only during an incident. This allows the organization to separate the legitimate
    use of credentials from possible malicious ones. This also allows the incident
    response team to recreate their actions. It is worth noting that highly technical
    adversaries will often monitor the network they are attacking during an active
    compromise to determine whether they are being detected. Therefore, these credentials
    should not indicate that they are tied to the incident response analysts or other
    personnel investigating a possible breach.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 许多在本章讨论的工具和技术需要管理员权限。事件响应人员应提供执行这些任务所需的凭据。值得注意的是，分析人员应仅使用现有帐户，并且在可能被入侵的系统中添加帐户可能会使证据在司法程序中不可接受。其中一项技术是为事件响应分析人员提供仅在事件期间启用的个人凭据。这允许组织将凭证的合法使用与可能的恶意使用分开。这也使事件响应团队能够重现其行动。值得注意的是，高度技术的对手通常会在主动威胁期间监视他们正在攻击的网络，以确定是否被检测到。因此，这些凭据不应表明它们与事件响应分析人员或其他调查可能违反的人员有关联。
- en: Order of volatility
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 挥发性的顺序
- en: Not all evidence on a host system is the same. Volatility is used to describe
    how data on a host system is maintained after changes such as logoffs or power
    shutdowns. Data that will be lost if the system is powered down is referred to
    as **volatile data**. Volatile data can be data in the CPU, routing table, or
    ARP cache. One of the most critical pieces of volatile evidence is the memory
    currently running on the system. When investigating incidents such as malware
    infections, the memory in a live system is of critical importance. Malware leaves
    a number of key pieces of evidence within the memory of a system and, if lost,
    can leave the incident response analyst with little or no room to investigate.
    This can include such artifacts as registry data, command history, and network
    connections.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 主机系统上并非所有证据都相同。挥发性用于描述主机系统上的数据在注销或断电后如何维持。如果系统断电将丢失的数据称为**挥发性数据**。挥发性数据可以是CPU中的数据、路由表或ARP缓存。在调查如恶意软件感染的事件中，运行系统的内存是至关重要的。恶意软件在系统内存中留下许多关键证据，如果丢失，可能会导致事件响应分析人员无法进行有效调查。这可以包括注册表数据、命令历史记录和网络连接等工件。
- en: '**Non-volatile data** is the data that is stored on a hard drive and will usually
    persist after shutting down. Non-volatile data includes **Master File Table**
    (**MFT**) entries, registry information, and the actual files on the hard drive.
    While malware creates evidence in memory, there are still items of evidentiary
    value in non-volatile memory. The following diagram shows the different levels
    of volatility of digital evidence that should be taken into account when determining
    the order of acquisition:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '**非易失性数据**是存储在硬盘上的数据，在关机后通常仍会保留。非易失性数据包括**主文件表**（**MFT**）条目、注册表信息和硬盘上的实际文件。虽然恶意软件在内存中创建证据，但非易失性存储器中仍然存在具有证据价值的项目。以下图表显示了数字证据不同挥发级别，在确定获取顺序时应考虑这些级别：'
- en: '![](img/Image_B18571_06_01.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_01.jpg)'
- en: Figure 6.1 – Digital evidence volatility
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.1 - 数字证据挥发性
- en: In the next section, we will learn how to collect evidence.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将学习如何收集证据。
- en: Evidence acquisition
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 证据获取
- en: 'There are a variety of methods that are used to not only access a potential
    evidence source but also determine the type of acquisition that can be undertaken.
    To define these methods, it is important to have a clear understanding of the
    manner and type of acquisition that can be utilized:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 有各种方法不仅用于访问潜在的证据源，还用于确定可以进行的获取类型。为了定义这些方法，重要的是要清楚了解可以使用的获取方式和类型。
- en: '**Local**: Having access to the system under investigation is often a luxury
    for most enterprises. Even so, there are many times when incident response analysts
    or other personnel have direct physical access to the system. A local acquisition
    can often be performed via a USB or other device and, in some circumstances, using
    the system itself.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地**：对于大多数企业来说，能够直接访问正在调查的系统通常是一种奢侈。不过，很多情况下，事件响应分析师或其他工作人员可以直接物理访问系统。本地采集通常可以通过USB或其他设备执行，某些情况下，也可以使用系统本身进行采集。'
- en: '**Remote**: In a remote acquisition, incident response analysts leverage tools
    and network connections to acquire evidence. A remote acquisition is an obvious
    choice if incident response analysts are dealing with geographical challenges.
    This can also be useful if incident response analysts cannot be on-site immediately.
    (The next chapter will focus on remote evidence acquisition.)'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程**：远程采集是指事件响应分析师利用工具和网络连接进行证据采集。如果事件响应分析师面临地理上的挑战，远程采集是一个显而易见的选择。如果事件响应分析师无法立即到现场，这种方法也非常有用。（下一章将重点介绍远程证据采集。）'
- en: '**Live acquisition**: A live acquisition of evidence occurs when the incident
    response analyst acquires the evidence from a system that is currently powered
    on and running. Some of the techniques that will be demonstrated in this chapter
    have to be deployed on a live system (for example, capturing running memory).
    Completely acquiring digital evidence from a live system may be a technique that’s
    necessary for high-availability environments where a suspected system cannot be
    taken offline. These techniques allow incident response analysts to acquire and
    analyze evidence to determine whether a system is indeed compromised.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**实时采集**：实时采集证据是指事件响应分析师从当前已开机并运行的系统中获取证据。本章将展示的一些技术必须在实时系统上部署（例如，捕获运行中的内存）。在高可用性环境中，完全从实时系统中获取数字证据可能是必要的技术，因为可疑系统不能下线。这些技术使事件响应分析师能够采集并分析证据，判断系统是否被攻击。'
- en: '**Offline acquisition**: The offline acquisition method is the one that’s often
    used by law enforcement agencies to preserve digital evidence on the hard drive.
    This technique requires that the system be powered down and the hard drive removed.
    Once the drive is accessed, specialized tools are utilized to acquire the hard
    drive evidence. There are some drawbacks to focusing strictly on offline acquisition.
    First is the loss of any volatile memory. Second, it may be time-consuming to
    acquire a suspect system’s hard drive, image it, and process the image for investigation.
    This may create a situation where incident responders do not have any idea of
    what has transpired for more than 24 hours.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**离线采集**：离线采集方法通常由执法机构使用，用来保护硬盘上的数字证据。该技术要求系统关闭并移除硬盘。一旦访问硬盘，专门的工具会被用来采集硬盘证据。严格依赖离线采集有一些缺点。首先是易失性内存的丢失。其次，获取可疑系统的硬盘、制作镜像并处理该镜像以进行调查可能非常耗时。这可能会导致事件响应人员在超过24小时内无法了解事态进展。'
- en: Depending on the type of incident and any constraints in time or geography,
    incident response analysts should be prepared to perform any of these types of
    acquisitions. The best-case scenario is for a CSIRT to have the ability to perform
    both live and offline acquisition on any suspect system. This provides the greatest
    amount of evidence that can be analyzed. In terms of preparation, analysts should
    have the necessary tools and experience to conduct evidence acquisition through
    any of these methods.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 根据事件类型以及时间或地理位置的限制，事件响应分析师应该准备执行这些类型的证据采集。最佳的情况是，计算机安全事件响应团队（CSIRT）能够在任何可疑系统上执行实时和离线采集。这能提供最多的证据，供进一步分析。就准备而言，分析师应该具备必要的工具和经验，通过这些方法进行证据采集。
- en: To perform local acquisition, incident response analysts require an external
    hard drive or USB drive with sufficient space for the capture of at least the
    running memory of the system or systems that are being investigated, along with
    other files if deemed necessary. In order to ensure the integrity of the evidence
    being collected, it is advisable to configure the USB drive into two partitions.
    The first partition should contain the necessary tools to perform the evidence
    acquisition, while the second should act as a repository for the evidence. This
    also allows the incident response analyst to move evidence to a more permanent
    form of storage and subsequently, wipe the evidence partition without having to
    reinstall all the tools.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行本地采集，事件响应分析员需要一个外部硬盘或USB驱动器，具备足够的空间用于捕获至少被调查系统的运行内存，以及其他必要的文件。为了确保所收集证据的完整性，建议将USB驱动器配置为两个分区。第一个分区应包含执行证据采集所需的工具，而第二个分区应作为证据的存储库。这还允许事件响应分析员将证据转移到更持久的存储形式，然后清除证据分区，而无需重新安装所有工具。
- en: Evidence collection procedures
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 证据收集程序
- en: 'There are a number of parallels between digital forensics and other forensic
    disciplines such as trace evidence. The key parallel is that organizations acquiring
    evidence need to have a procedure that is sound, reproducible, and well documented.
    The following are some guidelines for the proper collection of digital evidence:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 数字取证与其他法医学科（如痕迹证据）之间存在许多相似之处。关键的相似之处在于，获取证据的组织需要有一个稳健、可复现且文档化良好的程序。以下是一些收集数字证据的正确指南：
- en: '**Photograph the system and the general scene**: One of the key pieces of equipment
    that can save time is a small digital camera. While it may seem overkill to photograph
    a system in place, in the event that actions that have been taken by incident
    responders see the inside of a courtroom, having photos will allow for proper
    reconstruction of the events. One word of caution, though, is to make sure that
    you utilize a separate digital camera. Utilizing a cell phone may expose the device
    to discovery in the event of a lawsuit or criminal proceeding. The best method
    is to snap all of the photos necessary at a convenient time and place and transfer
    them to permanent storage.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**拍摄系统和现场照片**：一项节省时间的重要设备是小型数码相机。尽管拍摄系统现场可能显得有些多余，但如果事件响应人员所采取的行动进入法庭，拥有照片将有助于事件的还原。然而，需要注意的是，务必使用单独的数码相机。使用手机可能会在诉讼或刑事程序中暴露该设备。最佳方法是在方便的时间和地点拍摄所需的所有照片，并将其转移到永久存储中。'
- en: '**Determine whether the system is powered up**: If the system is powered on,
    leave it on. If the system is powered off, do not power it on. Several changes
    take place when turning a system on or off. If the system is powered on, the volatile
    memory will be available for capture. In addition, in the case of full disk encryption,
    leaving the system on will allow the responder to still acquire the logical disk
    volumes. If the system is turned off, preserving this state ensures that any evidence
    in the non-volatile memory is preserved. If incident response personnel feel that
    the system may be a danger to other systems, simply remove the network connection
    to isolate it.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**确定系统是否已开机**：如果系统已经开机，保持开机状态。如果系统处于关机状态，请勿开机。开关机时会发生一些变化。如果系统已开机，易失性内存将可供捕获。此外，在启用全盘加密的情况下，保持系统开机可以让响应人员仍然能够获取逻辑磁盘分区。如果系统处于关机状态，保持此状态可以确保非易失性内存中的任何证据得到保留。如果事件响应人员认为该系统可能对其他系统构成威胁，可以通过断开网络连接将其隔离。'
- en: '**Acquire the running memory**: This is a critical piece of evidence that can
    produce a wealth of data concerning running processes, DLLs in use, and network
    connections. Due to this, procedures for acquiring memory will be covered extensively
    in this chapter.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**获取运行中的内存**：这是一个至关重要的证据，可以提供大量关于正在运行的进程、使用中的动态链接库（DLL）和网络连接的数据。因此，获取内存的程序将在本章中详细讨论。'
- en: '**Acquire registry and log files**: While these files are non-volatile in nature,
    having near-immediate access is beneficial, especially when investigating malware
    or other exploitation means.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**获取注册表和日志文件**：虽然这些文件本质上是非易失性的，但迅速获取它们是有益的，尤其是在调查恶意软件或其他攻击手段时。'
- en: '**Unplug the power from the back of the system**: If the system is a laptop,
    remove the battery as well. This preserves the state of the system.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**从系统背面拔掉电源**：如果系统是笔记本电脑，还要拆下电池。这样可以保留系统的状态。'
- en: '**Photograph the back or bottom of the system to capture the model and serial
    number**: This procedure allows the incident response analyst to capture any information
    that’s necessary for the chain of custody.'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**拍摄系统背面或底部以获取型号和序列号**：此程序允许事件响应分析师获取对保管链必要的任何信息。'
- en: '**Remove the cover to the system and photograph the hard drive to capture the
    model and serial number**: Again, this aids in the reconstruction of the chain
    of custody.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**拆下系统的盖子并拍摄硬盘以获取型号和序列号**：再次有助于重建保管链。'
- en: '**Remove the hard drive from the system and package it in an anti-static bag**:
    Secure the drive in a sealable envelope or box. Anti-static bags will protect
    the hard drive, and the packaging should ensure that any attempt to open it will
    be evident. This can be facilitated through purpose-designed evidence bags or
    simple mailing envelopes that can be sealed with tape. The seizing analyst should
    sign any seals. Furthermore, indicate the incident number, evidence number, date,
    time, and seizing analyst somewhere on the exterior of the packaging.'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**从系统中取出硬盘并将其放入防静电袋中**：将硬盘安全地放入可密封的信封或盒子中。防静电袋将保护硬盘，而包装应确保任何尝试打开它的行为都会显而易见。这可以通过专门设计的证据袋或可以用胶带密封的简单邮寄信封来实现。扣押分析师应在任何封条上签字。此外，在包装外部的某处标明事件编号、证据编号、日期、时间和扣押分析师。'
- en: '**Document all actions**: Ensure that dates and times are recorded, as well
    as which incident response analyst performed the action. Incident reporting is
    often the last stage of any response. As a result, hours or even days can pass
    before analysts are able to record their actions. Due to this, pictures and notes
    that are taken during the initial seizure are invaluable when it comes to reconstructing
    the sequence of events.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**记录所有操作**：确保记录日期和时间，以及执行操作的事件响应分析师。事故报告通常是任何响应的最后阶段。因此，在分析师能够记录他们的操作之前，可能会过去几个小时甚至几天。因此，在最初扣押期间拍摄的照片和笔记在重建事件序列时至关重要。'
- en: In the next section, we will look at acquiring volatile memory.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将看看如何获取易失性内存。
- en: Acquiring volatile memory
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取易失性内存
- en: Traditional digital forensics, or what is often referred to now as dead box
    forensics, focuses on the hard disk drive that’s been taken from a shut-down system
    acting as the primary source of evidence. This approach works well when addressing
    criminal activity such as fraud or child exploitation, where image files, word
    processor documents, and spreadsheets can be discovered in a forensically sound
    manner. The issue with this approach is that to properly acquire this evidence,
    the system has to be powered off, thereby destroying any potential evidence that
    could be found within the volatile memory.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 传统数字取证，或现在通常称为死盒取证，侧重于从关闭系统中取出的硬盘驱动器作为主要证据来源。这种方法在处理诸如欺诈或儿童剥削等犯罪活动时效果很好，其中可以以取证合规的方式发现图像文件、文字处理文档和电子表格。这种方法的问题在于，为了正确获取这些证据，系统必须关闭电源，从而破坏了可能存在于易失性内存中的任何潜在证据。
- en: As opposed to traditional criminal activity, incident responders will find that
    a great deal of evidence for a security incident is contained within the memory
    of a potentially compromised system. This is especially true when examining systems
    that have been infected with malware or exploited by utilizing a common platform
    such as Metasploit.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 与传统犯罪活动相反，事件响应人员会发现，安全事件的大量证据包含在潜在受损系统的内存中。当检查已感染恶意软件或通过使用诸如Metasploit等常见平台进行利用的系统时，这一点尤为真实。
- en: Key pieces of trace evidence are often found within the running memory of the
    compromised system. As a result, before powering down the system and removing
    the hard drive, it is critical that the running memory is acquired for processing.
    There are several free and commercial tools that can be leveraged by incident
    response analysts to acquire running memory. Which tool is used will often be
    dependent on the techniques and tools used during the analysis phase, which is
    covered in *Chapter 10*.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 关键的痕迹证据常常存在于被攻陷系统的运行内存中。因此，在关闭系统并拆卸硬盘之前，必须先获取运行内存进行处理。有多个免费的和商业化的工具可以供事件响应分析员用来获取运行内存。使用哪种工具通常取决于分析阶段使用的技术和工具，分析阶段的内容在
    *第 10 章* 中讨论。
- en: Running memory can be acquired in two ways. First, memory can be acquired locally
    via a USB device or other writable medium that is directly connected to the suspect
    system. The other method of acquiring memory is through a remote connection. This
    can be facilitated through the use of specialized software that performs the acquisition
    over a network connection (remote acquisition techniques will be covered in the
    next chapter).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 获取运行内存有两种方法。首先，可以通过直接连接到嫌疑系统的 USB 设备或其他可写介质来本地获取内存。另一种获取内存的方法是通过远程连接。这可以通过使用专门的软件，通过网络连接进行获取（远程获取技术将在下一章中讨论）。
- en: If an incident response analyst has physical access to a potentially compromised
    system, they have the option of acquiring the memory and other evidence locally.
    This involves the use of tools that are run from a USB device or a similar removable
    medium that is connected to the potentially compromised system. From there, the
    tools are run, and the evidence is collected. A local acquisition is often conducted
    in conjunction with seizing the hard drive and other evidence from the system.
    There are several tools that are available for local acquisition. For the purposes
    of this book, three such tools – **Exterro’s FTK Imager**, **Velocidex’s WinPmem**,
    and **Belkasoft’s RamCapturer** – will be examined.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果事件响应分析员可以物理接触到潜在被攻陷的系统，他们可以选择本地获取内存和其他证据。这涉及到使用从 USB 设备或类似的可移动介质中运行的工具，连接到潜在被攻陷的系统。然后，运行这些工具并收集证据。本地获取通常是与没收系统的硬盘和其他证据一起进行的。有多个工具可以用于本地获取。本书将介绍三种此类工具——**Exterro
    的 FTK Imager**、**Velocidex 的 WinPmem** 和 **Belkasoft 的 RamCapturer**。
- en: When acquiring memory in this fashion, it is advisable to utilize an external
    drive with sufficient capacity for multiple files. Incident response analysts
    should make use of a USB device with two partitions. The first of these partitions
    contains the tools that are necessary to perform the memory acquisition, while
    the second partition will contain the evidence files. This way, incident response
    analysts can be sure that the evidence does not become commingled with their tools.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在以这种方式获取内存时，建议使用一个具有足够容量的外部驱动器来存储多个文件。事件响应分析员应使用一个具有两个分区的 USB 设备。第一个分区包含执行内存获取所需的工具，而第二个分区则存储证据文件。这样，事件响应分析员可以确保证据不会与工具混合。
- en: FTK Imager
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: FTK Imager
- en: 'Exterro’s FTK Imager is a Windows software platform that performs a variety
    of imaging tasks, including acquiring the running memory of a system. The software
    can be downloaded at [https://www.exterro.com/ftk-imager](https://www.exterro.com/ftk-imager).
    Let’s take a look at this platform:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: Exterro 的 FTK Imager 是一个 Windows 软件平台，执行多种成像任务，包括获取系统的运行内存。该软件可以在 [https://www.exterro.com/ftk-imager](https://www.exterro.com/ftk-imager)
    下载。让我们来看一下这个平台：
- en: Once downloaded, install the executable in the **Tools** partition of the USB
    drive.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载后，将可执行文件安装到 USB 驱动器的 **Tools** 分区中。
- en: 'Open the `FTK Imager` folder and run the executable as an administrator. (FTK
    Imager requires the use of drivers and, as a result, requires administrator privileges.)
    The following window will appear:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 `FTK Imager` 文件夹并以管理员身份运行可执行文件。（FTK Imager 需要使用驱动程序，因此需要管理员权限。）以下窗口将会出现：
- en: '![](img/Image_B18571_06_02.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_02.jpg)'
- en: Figure 6.2 – FTK Imager main window
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.2 – FTK Imager 主窗口
- en: 'Click on **File** and then on **Capture Memory**. This opens the following
    window:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **File**，然后选择 **Capture Memory**。这将打开以下窗口：
- en: '![](img/Image_B1857_06_03.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B1857_06_03.jpg)'
- en: Figure 6.3 – FTK Imager memory capture
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.3 – FTK Imager 内存捕获
- en: Browse to the `Laptop1` or `Evidence Item 1`. Another option that is useful
    is to use the system name, such as in *Figure 6**.3*. Also, check the **Include
    pagefile** checkbox. There might not be any information of evidentiary value within
    the pagefile, but it may become important later during the investigation (the
    pagefile will be discussed later on, in *Chapter 10*).
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览到`Laptop1`或`Evidence Item 1`。另一种有用的选项是使用系统名称，如*图6**.3*所示。还要勾选**Include pagefile**复选框。页面文件中可能没有具有证据价值的信息，但在调查过程中可能会变得重要（页面文件将在*第10章*中讨论）。
- en: Finally, there is the option to create an AD1 file; this is Exterro’s proprietary
    file format. This file is for the analysis of the captured image using the FTK
    analysis program. For the purposes of this book, the standard output is sufficient
    for the analysis that will be performed.
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，可以选择创建一个AD1文件；这是Exterro的专有文件格式。这个文件用于使用FTK分析程序分析捕获的映像。对于本书的目的，标准输出足以进行后续分析。
- en: 'Once the configuration details have been set, click on **Capture Memory** and
    the following screen will appear:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置好配置细节后，点击**Capture Memory**，然后将显示以下屏幕：
- en: '![](img/Image_B18571_06_04.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_04.jpg)'
- en: Figure 6.4 – FTK Imager memory capture progress
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.4 – FTK Imager内存捕获进度
- en: 'After FTK Imager dumps the RAM, it will then extract the pagefile, as seen
    in the following figure:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在FTK Imager转储RAM后，它将提取页面文件，如下图所示：
- en: '![](img/Image_B18571_06_05.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_05.jpg)'
- en: Figure 6.5 – FTK Imager page file extraction
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.5 – FTK Imager页面文件提取
- en: 'After running this, FTK Imager will indicate whether the memory capture was
    successful or not:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行此工具后，FTK Imager将指示内存捕获是否成功：
- en: '![](img/Image_B18571_06_06.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_06.jpg)'
- en: Figure 6.6 – FTK Imager memory capture success
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.6 – FTK Imager内存捕获成功
- en: 'Examining the evidence partition of the evidence drive reveals the two files,
    as shown in the following screenshot:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 检查证据驱动器的证据分区，能看到两个文件，如下图所示：
- en: '![](img/Image_B18571_06_07.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_07.jpg)'
- en: Figure 6.7 – FTK Imager output files
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.7 – FTK Imager输出文件
- en: Memory file size
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 内存文件大小
- en: Depending on the system, the `.mem` file may not exactly match the onboard RAM
    of the target system. In this case, the target system has 16 GB of physical RAM
    but the `.mem` file is nearly 2 GB larger. This can occur with operating systems
    that use virtual memory. In other circumstances, the actual RAM file may be smaller.
    This is an expected and normal occurrence.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 根据系统的不同，`.mem`文件可能与目标系统的内存不完全匹配。在这种情况下，目标系统有16 GB的物理内存，但`.mem`文件大约大2 GB。这可能发生在使用虚拟内存的操作系统中。在其他情况下，实际的RAM文件可能会更小。这是预期中的正常情况。
- en: The one disadvantage that FTK Imager has is that it requires a good deal of
    access to drivers and has several features. This makes moving the tool from system
    to system difficult. It also significantly reduces the ability to utilize FTK
    Imager in a script.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: FTK Imager的一个缺点是它需要对驱动程序有较多的访问权限，并且有许多功能。这使得将工具从一个系统移动到另一个系统变得困难，也显著降低了在脚本中使用FTK
    Imager的能力。
- en: WinPmem
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: WinPmem
- en: On the opposite side of the spectrum from FTK Imager is WinPmem. This is a single
    command line executable that can be executed in the same way that FTK Imager is
    executed. The one main difference is that the tool is much easier to script, so
    it can be deployed across several systems at once or in conjunction with other
    evidence collection.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: FTK Imager的对立工具是WinPmem。它是一个单一的命令行可执行文件，可以像FTK Imager一样执行。主要的区别在于，这个工具更容易进行脚本编写，因此可以一次性部署到多个系统，或者与其他证据收集工具一起使用。
- en: WinPmem is a free tool that is available at [https://github.com/Velocidex/WinPmem](https://github.com/Velocidex/WinPmem).
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: WinPmem是一个免费的工具，可以在[https://github.com/Velocidex/WinPmem](https://github.com/Velocidex/WinPmem)上获得。
- en: 'Once downloaded, the executable can be placed anywhere the analyst needs. WinPmem
    is a command line tool so let’s examine the specific commands needed to capture
    the memory of the running system:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 下载后，可将可执行文件放置在分析师需要的位置。WinPmem是一个命令行工具，因此我们来看看捕获运行系统内存所需的具体命令：
- en: 'To acquire the physical memory of the target system, open a Windows Command
    Prompt instance as an administrator. Typing `E:\winpmem_mini_x64_rc2.exe -help`
    will produce the following help menu:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要获取目标系统的物理内存，请以管理员身份打开Windows命令提示符实例。输入`E:\winpmem_mini_x64_rc2.exe -help`，将显示以下帮助菜单：
- en: '![](img/Image_B18571_06_08.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_08.jpg)'
- en: Figure 6.8 – WinPmem help menu
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图6.8 – WinPmem帮助菜单
- en: 'Next, configure WinPmem to acquire the memory of the system by running the
    following command:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，通过运行以下命令配置 WinPmem 以获取系统的内存：
- en: '[PRE0]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The preceding command tells WinPmem to acquire the raw memory and output it
    to a file with the name `Acc_LT09.raw`, which will be created on the evidence
    partition of the USB drive in use. After entering the command, hitting the *Enter*
    key will produce the following:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上述命令告诉 WinPmem 获取原始内存并将其输出到名为 `Acc_LT09.raw` 的文件，该文件将创建在正在使用的 USB 驱动器的证据分区中。输入命令后，按下
    *Enter* 键将生成以下内容：
- en: '![](img/Image_B18571_06_09.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_09.jpg)'
- en: Figure 6.9 – WinPmem output
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.9 – WinPmem 输出
- en: 'WinPmem then runs through the entire memory structure. During this process,
    it will produce the following output:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后 WinPmem 会遍历整个内存结构。在此过程中，它将生成以下输出：
- en: '![](img/Image_B18571_06_10.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_10.jpg)'
- en: Figure 6.10 – WinPmem output
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.10 – WinPmem 输出
- en: WinPmem provides the flexibility of a single executable that can be easily copied
    and deployed across multiple systems. The obvious drawback is the lack of a GUI.
    A good middle ground between FTK Imager and WinPmem is Belkasoft’s RAM Capturer.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: WinPmem 提供了一个可以轻松复制并部署到多个系统的单一可执行文件的灵活性。显而易见的缺点是缺乏图形用户界面（GUI）。FTK Imager 和 WinPmem
    之间的一个不错的折中选择是 Belkasoft 的 RAM Capturer。
- en: RAM Capturer
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: RAM Capturer
- en: 'RAM Capturer is a free tool provided by the software company Belkasoft. RAM
    Capturer is a simple tool to utilize and, like FTK Imager and WinPmem, it can
    be run from a USB. RAM Capturer combines the simplicity of WinPmem with an easy-to-use
    GUI like FTK Imager:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: RAM Capturer 是由软件公司 Belkasoft 提供的免费工具。RAM Capturer 是一个简单易用的工具，像 FTK Imager 和
    WinPmem 一样，它可以通过 USB 启动运行。RAM Capturer 将 WinPmem 的简便性与 FTK Imager 的易用 GUI 相结合：
- en: 'Right-click on the **RAM Capturer** executable and choose **Run as Administrator**.
    This will produce the following window:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击 **RAM Capturer** 可执行文件并选择 **以管理员身份运行**。这将会显示以下窗口：
- en: '![](img/Image_B18571_06_11.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_11.jpg)'
- en: Figure 6.11 – RAM Capturer start window
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.11 – RAM Capturer 启动窗口
- en: 'The only input that’s required for acquisition is to place the path of the
    folder where the memory image should be placed. Once the output has been set,
    click on the **Capture!** button and let it run:'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取内存所需的唯一输入是指定存放内存镜像的文件夹路径。一旦设置了输出路径，点击 **Capture!** 按钮并让它运行：
- en: '![](img/Image_B18571_06_12.jpg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_12.jpg)'
- en: Figure 6.12 – RAM Capturer progress
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.12 – RAM Capturer 进度
- en: 'Once RAM Capturer completes, the following message will appear:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦 RAM Capturer 完成，以下消息将出现：
- en: '![](img/Image_B18571_06_13.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_13.jpg)'
- en: Figure 6.13 – RAM Capturer completion
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.13 – RAM Capturer 完成
- en: When looking at memory acquisition tools, the best approach is to capture as
    much data as possible as efficiently as possible. Tools such as FTK Imager are
    highly reliable and allow for acquiring not just memory but also other key pieces
    of evidence. However, at times, this may not be possible, and responders will
    have to use a USB key with a lightweight tool such as RAM Capturer. The best option
    is to determine the type of forensic tools that will be used to examine the evidence
    and then select the appropriate tool to acquire memory.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑内存获取工具时，最佳的方法是尽可能高效地捕获尽可能多的数据。像 FTK Imager 这样的工具非常可靠，不仅可以获取内存，还能获取其他关键证据。然而，有时这可能不可行，响应人员将不得不使用一个带有轻量级工具（如
    RAM Capturer）的 USB 键。最佳选择是确定将用于检查证据的法医工具类型，然后选择合适的工具来获取内存。
- en: When looking at acquiring memory, another key factor with these tools that make
    them useful is that they can also be leveraged if responders do not have physical
    access to the suspect system.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在获取内存时，这些工具的一个关键特点是，它们也可以在响应人员无法物理接触嫌疑系统的情况下被利用。
- en: Virtual systems
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟系统
- en: Other systems that incident response analysts should prepare to address are
    virtual machines. The one distinct advantage that virtual systems have over physical
    systems is their ability to maintain the current state by either performing a
    snapshot of the system or simply pausing. This allows incident response analysts
    to simply copy the entire file over to an evidence drive for later analysis. It
    is recommended that analysts ensure that they conduct a hash of each component
    of the virtual machine pre- and post-copy to ensure the integrity of the evidence.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 事件响应分析师应准备应对的其他系统是虚拟机。虚拟系统相对于物理系统的一个明显优势是，它们能够通过执行系统快照或简单地暂停系统来保持当前状态。这使得事件响应分析师只需将整个文件复制到证据驱动器上，供后续分析。建议分析师确保在复制前后对虚拟机的每个组件进行哈希，以确保证据的完整性。
- en: 'One key feature of popular virtualization software such as VMware is that the
    virtual machine utilizes two files for the running memory. The first of these
    is the **Virtual Memory** (**VMEM**) file. The VMEM file is the RAM or physical
    memory of the virtual machine. The second file is the **VMware Suspended State**
    (**VMSS**) file. The VMSS file contains the files that are saved as part of the
    suspended state of the virtual machine. Let’s take a look at this:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 像VMware这样的流行虚拟化软件的一个关键特点是，虚拟机使用两个文件来处理运行时内存。第一个文件是**虚拟内存**（**VMEM**）文件。VMEM文件是虚拟机的RAM或物理内存。第二个文件是**VMware暂停状态**（**VMSS**）文件。VMSS文件包含虚拟机在暂停状态时保存的文件。我们来看看这个：
- en: To acquire the running memory from a VMware virtual machine, pause the system.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要从VMware虚拟机中获取运行时内存，暂停系统。
- en: Second, transfer the VMSS and VMEM files to a removable media source such as
    a USB. VMware software will often include the `Vmss2Core.exe` application as part
    of the installation process. This application combines the VMSS and VMEM files
    into a single `.dmp` file that can be analyzed with forensic tools. Both these
    files are required to create a complete memory capture.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 其次，将VMSS和VMEM文件传输到可移动存储介质（如USB）。VMware软件通常会在安装过程中包括`Vmss2Core.exe`应用程序。该应用程序将VMSS和VMEM文件合并成一个单一的`.dmp`文件，可以使用取证工具进行分析。要创建完整的内存捕获，必须同时拥有这两个文件。
- en: 'To create the `.dmp` file, run the following command:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建`.dmp`文件，请运行以下命令：
- en: '[PRE1]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: From here, the responder will have the necessary `.dmp` file to conduct analysis.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 从这里，响应人员将拥有必要的`.dmp`文件以进行分析。
- en: Acquiring non-volatile evidence
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取非易失性证据
- en: Although there is a great deal of data running in memory, it is still important
    to acquire the hard drive from a potentially compromised system. There is a great
    deal of evidence on these devices, even in the case of malware or other exploitation.
    Hard drive evidence becomes even more important when examining potential incidents
    such as internal malicious action or data loss. To ensure that this evidence is
    available and can be utilized in a court of law, incident responders should be
    well versed in the procedures we’ve discussed in this chapter.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管内存中运行着大量数据，但从潜在被攻破的系统中获取硬盘数据仍然非常重要。这些设备中包含大量证据，即使是在恶意软件或其他攻击的情况下也是如此。在检查潜在事件时，例如内部恶意行为或数据丢失，硬盘证据变得更加重要。为了确保这些证据能够在法庭上使用，事件响应人员应熟练掌握我们在本章中讨论的程序。
- en: In certain circumstances, incident responders may want to acquire two key pieces
    of data from suspected compromised systems before shutting down a running system.
    While not volatile in nature, the registry keys and event log files can aid analysts
    during their investigation. Acquiring these files from an imaged hard drive is
    largely dependent on the time that’s needed to image and then process the entire
    hard disk drive. As a result, there are a few techniques that can be leveraged
    to acquire these key pieces of evidence.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，事件响应人员可能希望在关闭正在运行的系统之前从疑似被攻破的系统中获取两个关键数据。虽然这些数据本身不是易失性的，但注册表键值和事件日志文件可以在调查过程中帮助分析师。从镜像硬盘中获取这些文件主要依赖于影像和处理整个硬盘驱动器所需的时间。因此，有一些技术可以用来获取这些关键证据。
- en: 'In the event that analysts have access to the system, they can utilize the
    command line to access the log files by running the following command:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 如果分析师能够访问系统，他们可以通过运行以下命令，利用命令行访问日志文件：
- en: '[PRE2]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: This command can be repeated for security, application, and system logs.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令可以对安全、应用程序和系统日志重复执行。
- en: FTK obtaining protected files
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: FTK获取受保护的文件
- en: 'FTK Imager also allows for the capture of registry key settings and other information
    that can aid in an investigation. Let’s take a look:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: FTK Imager 还允许捕获注册表键设置和其他有助于调查的信息。让我们来看看：
- en: Open FTK Imager and navigate to the **File** tab.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 FTK Imager，并导航到 **文件** 标签。
- en: 'Click on **Obtain Protected Files**. The following dialog box will appear:'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **获取受保护的文件**。将出现以下对话框：
- en: '![](img/Image_B18571_06_14.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_14.jpg)'
- en: Figure 6.14 – FTK protected files acquisition
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.14 – FTK 受保护文件获取
- en: Click on **Browse...** and navigate to the evidence file location.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **浏览...** 并导航到证据文件所在的位置。
- en: Next, click the radio button for `user`, `system`, `SAM`, and `NTUSER.DAT` files.
    From here, analysis can take place before the imaging process. This allows for
    a more rapid response to an incident.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，点击 `user`、`system`、`SAM` 和 `NTUSER.DAT` 文件的单选按钮。此时可以在成像过程之前进行分析，这使得对事件的响应更加迅速。
- en: The CyLR response tool
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: CyLR 响应工具
- en: An open source tool that aids responders in this type of acquisition is the
    `CyLR.exe` application. This standalone executable, available at [https://github.com/orlikoski/CyLR/releases](https://github.com/orlikoski/CyLR/releases),
    can be run from a USB or on the system. It is a small application but can acquire
    a great deal of evidence that can be leveraged as part of the initial investigation
    or possibly triage. Another key feature of `CyLR.exe` is its ability to send the
    data that’s been acquired to a remote system either for storage or processing,
    as we will demonstrate in *Chapter 12*.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 一款开源工具帮助响应人员进行此类获取操作，即 `CyLR.exe` 应用程序。这个独立的可执行文件可以从 [https://github.com/orlikoski/CyLR/releases](https://github.com/orlikoski/CyLR/releases)
    下载并运行，可以从 USB 或系统中运行。它是一个小型应用程序，但可以获取大量证据，这些证据可以作为初步调查的一部分或可能的分类处理来利用。`CyLR.exe`
    的另一个关键特性是，它能够将获取的数据发送到远程系统进行存储或处理，正如我们将在*第 12 章*中演示的那样。
- en: To acquire the non-volatile log files and other protected files, navigate to
    the `CyLR.exe` executable via Command Prompt and run it as an administrator. The
    output directory containing the evidence files will be placed in the same directory
    as the `CyLR.exe` application. This is handy if you’re running this from a USB
    device as the output will land directly on the USB.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 若要获取非易失性日志文件和其他受保护文件，请通过命令提示符导航到 `CyLR.exe` 可执行文件，并以管理员身份运行它。包含证据文件的输出目录将与 `CyLR.exe`
    应用程序位于同一目录。如果您从 USB 设备运行此工具，这样做非常方便，因为输出将直接保存在 USB 上。
- en: 'While the `CyLR.exe` application is running, the responder will be able to
    see the individual files that are being acquired:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 当 `CyLR.exe` 应用程序正在运行时，响应人员将能够看到正在获取的各个文件：
- en: '![](img/Image_B18571_06_15.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_15.jpg)'
- en: Figure 6.15 – CyLR output
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.15 – CyLR 输出
- en: 'Depending on the processor and available RAM, `CyLR.exe` can be expected to
    run for a few minutes. Afterward, the following message will appear:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 根据处理器和可用 RAM 的不同，`CyLR.exe` 预计运行几分钟。之后，以下消息将出现：
- en: '![](img/Image_B18571_06_16.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_16.jpg)'
- en: Figure 6.16 – CyLR completion message
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.16 – CyLR 完成消息
- en: 'Finally, a check of the directory where `CyLR.exe` was run will reveal a compressed
    file with the name of the system as the filename. Uncompressing the file reveals
    the extensive evidence that was collected:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，检查运行 `CyLR.exe` 的目录，将会发现一个压缩文件，其文件名为系统的名称。解压缩文件后，可以看到收集的广泛证据：
- en: '![](img/Image_B18571_06_17.jpg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_17.jpg)'
- en: Figure 6.17 – CyLR acquired files
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.17 – CyLR 获取的文件
- en: The output contains the log files, registry files, and master file table, which
    will be important in later chapters. The ability to acquire this data from a simple
    tool is a major advantage of using `CyLR.exe` to acquire evidence before a system
    is shut down.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 输出包括日志文件、注册表文件和主文件表，这些将在后续章节中非常重要。通过简单工具获取这些数据是使用 `CyLR.exe` 在系统关闭前获取证据的一个主要优势。
- en: Kroll Artifact Parser and Extractor
  id: totrans-136
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Kroll 工件解析器与提取工具
- en: Like CyLR, the **Kroll Artifact Parser and Extractor** (**KAPE**) is a digital
    forensics purpose-designed tool that extracts forensically relevant artifacts
    and parses them to be analyzed using a variety of additional tools. KAPE utilizes
    a combination of modules and targets to extract the relevant evidence. This extraction
    can be performed on both live systems and disk images. KAPE can be downloaded
    from the Kroll website at [https://www.kroll.com/en/insights/publications/cyber/kroll-artifact-parser-extractor-kape](https://www.kroll.com/en/insights/publications/cyber/kroll-artifact-parser-extractor-kape).
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 与 CyLR 类似，**Kroll Artifact Parser and Extractor** (**KAPE**) 是一款专为数字取证设计的工具，能够提取具有法证相关性的工件，并解析这些工件以便使用各种附加工具进行分析。KAPE
    利用模块和目标的组合来提取相关证据。该提取过程可以在活跃系统和磁盘映像上执行。KAPE 可以从 Kroll 网站下载：[https://www.kroll.com/en/insights/publications/cyber/kroll-artifact-parser-extractor-kape](https://www.kroll.com/en/insights/publications/cyber/kroll-artifact-parser-extractor-kape)。
- en: 'The entire toolset is contained within a single compressed file. Once downloaded,
    extract the contents of the folder. KAPE can be run on the local system or on
    a USB drive; this allows the analyst to simply attach the USB to the suspect system
    and execute all commands from there. There are two executables: `kape.exe` is
    a command-line version and `gkape.exe` is a GUI-based version. Run `gkape.exe`
    as an administrator and the following window appears:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 整个工具集包含在一个压缩文件中。下载后，解压文件夹内容。KAPE 可以在本地系统或 USB 驱动器上运行；这允许分析员只需将 USB 驱动器连接到嫌疑系统并从那里执行所有命令。文件中有两个可执行文件：`kape.exe`
    是命令行版本，`gkape.exe` 是基于图形界面的版本。以管理员身份运行 `gkape.exe`，然后会出现以下窗口：
- en: '![](img/Image_B18571_06_18.jpg)'
  id: totrans-139
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_18.jpg)'
- en: Figure 6.18 – KAPE GUI
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.18 – KAPE 图形界面
- en: 'The number **1** in *Figure 6**.18* is where the analyst configures the target
    selection. Number **2** shows the target selections. These are the evidence-collection
    items that the analysts will select for extraction. The number **3** indicates
    where the KAPE command line will appear. For the following example, KAPE will
    be run against a live system. The following will capture the necessary evidence
    to conduct an initial triage analysis of the target system using a preset evidence
    list:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 6.18** 中的数字 **1** 是分析员配置目标选择的位置。数字 **2** 显示了目标选择。这些是分析员将选择用于提取的证据收集项。数字
    **3** 表示 KAPE 命令行将出现的位置。在以下示例中，KAPE 将对一个活跃系统进行操作。接下来将捕获必要的证据，以便使用预设的证据列表对目标系统进行初步分诊分析：'
- en: 'In this example, KAPE will be run against the root directory of a Windows system,
    indicated by the drive letter `C`. The output files from the extraction will go
    to an `Acct_LT009` folder on a removable USB drive, as seen in *Figure 6**.19*:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这个示例中，KAPE 将在 Windows 系统的根目录中运行，根目录由驱动器字母 `C` 表示。提取后的输出文件将保存到一个可移动 USB 驱动器上的
    `Acct_LT009` 文件夹中，如 *图 6.19* 所示：
- en: '![](img/Image_B18571_06_19.jpg)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_19.jpg)'
- en: Figure 6.19 – Setting target source and destinations
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.19 – 设置目标源和目标位置
- en: 'Next, the analyst needs to select the target for extraction. In this case,
    the analyst is conducting an initial triage and selects the `!``SANS_Triage` target:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，分析员需要选择提取的目标。在此案例中，分析员正在进行初步分诊并选择 `!``SANS_Triage` 目标：
- en: '![](img/Image_B18571_06_20.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_20.jpg)'
- en: Figure 6.20 – SANS_Triage target
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.20 – SANS_Triage 目标
- en: 'To see what each of the target selections extracts as artifacts, double-click
    on the selection. In this case, the following window displays the extracted artifacts:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看每个目标选择提取的工件，双击该选择。在此案例中，以下窗口显示了提取的工件：
- en: '![](img/Image_B18571_06_21.jpg)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_21.jpg)'
- en: Figure 6.21 – SANS target details
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.21 – SANS 目标详情
- en: 'After selecting the targets, KAPE provides the command line that will be used.
    KAPE can also be run on the command line with the `kape.exe` executable. This
    allows analysts to craft the command in the GUI and use the output in scripts
    if necessary:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择目标后，KAPE 会提供将要使用的命令行。KAPE 也可以通过命令行运行 `kape.exe` 可执行文件。这允许分析员在图形界面中构建命令，并在必要时将输出用于脚本：
- en: '![](img/Image_B18571_06_22.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_22.jpg)'
- en: Figure 6.22 – KAPE command-line command
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.22 – KAPE 命令行命令
- en: 'The selection output the following command:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 选择输出以下命令：
- en: '[PRE3]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Once the parameters are set, the analyst clicks on the **Execute!** button.
    A new window will open indicating that any contents of the target or module destination
    will be destroyed. Analysts should ensure the contents of the folder for the artifacts
    are free of any files. Click **OK** to proceed.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置参数后，分析师点击**执行！**按钮。一个新窗口将会打开，提示目标或模块目标的任何内容将被销毁。分析师应确保工件文件夹的内容没有任何文件。点击**确定**以继续。
- en: '![](img/Image_B18571_06_23.jpg)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_23.jpg)'
- en: Figure 6.23 – Data destruction warning
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.23 – 数据销毁警告
- en: 'KAPE opens an additional window that shows the progress of artifact identification
    and extraction:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: KAPE 打开了一个额外的窗口，显示工件识别和提取的进度：
- en: '![](img/Image_B18571_06_24.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_24.jpg)'
- en: Figure 6.24 – KAPE command output
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.24 – KAPE 命令输出
- en: 'After KAPE has finished processing, the `C` directory, along with KAPE files,
    is on the USB drive:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: KAPE 处理完成后，`C` 目录以及 KAPE 文件已存储在 USB 驱动器上：
- en: '![](img/Image_B18571_06_25.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_25.jpg)'
- en: Figure 6.25 – KAPE targets acquired
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.25 – 获取的 KAPE 目标
- en: 'A check of the `C` directory shows some of the artifacts that were extracted:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 `C` 目录显示出一些提取的工件：
- en: '![](img/Image_B18571_06_26.jpg)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](img/Image_B18571_06_26.jpg)'
- en: Figure 6.26 – Details of KAPE acquired artifacts
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6.26 – KAPE 获取的工件详情
- en: Proper evidence handling starts the overall process that aims to determine the
    root cause of an incident and, potentially, identify the responsible party. For
    evidence to be of any use in an incident investigation, it has to be acquired
    in a sound manner. Incident responders should have a solid foundation in understanding
    the various types of acquisition and the tools and techniques that are available
    and apply those tools and techniques to the various situations that may arise.
    By applying solid techniques and properly documenting their actions, incident
    responders will be in a position to utilize the evidence to not only determine
    the root cause of an incident but also to back up their actions in a courtroom
    if necessary.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 正确的证据处理开始了整个过程，旨在确定事件的根本原因，并可能识别责任方。为了使证据在事件调查中发挥作用，必须以正确的方式获取证据。事件响应人员应具备坚实的基础，理解各种获取类型，以及可用的工具和技术，并将这些工具和技术应用于可能出现的不同情况。通过应用可靠的技术并正确记录他们的操作，事件响应人员将能够利用证据，不仅确定事件的根本原因，还能在必要时在法庭上支持他们的行动。
- en: Summary
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: There is a wealth of information on a running system. Threats such as fileless
    malware require analysts and incident responders to act quickly while the system
    is still running. Capturing this evidence requires both preparation and proper
    execution of digital forensic tools. Over the course of this chapter, we examined
    how understanding the order of volatility of evidence is useful in crafting an
    acquisition strategy. We then examined the procedures that should be leveraged
    in live system acquisition. Finally, we pivoted into using command-line and GUI
    tools to acquire the needed artifacts. These techniques are invaluable to incident
    responders as they ensure that the evidence acquired is trustworthy and reliable.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 运行中的系统包含大量信息。像无文件恶意软件这样的威胁要求分析师和事件响应人员在系统仍然运行时迅速采取行动。捕捉这些证据需要充分的准备和数字取证工具的正确执行。在本章中，我们讨论了了解证据的挥发性顺序对于制定获取策略的作用。接着我们研究了在实时系统获取中应使用的程序。最后，我们转向使用命令行和图形用户界面工具来获取所需的工件。这些技术对于事件响应人员来说是无价的，因为它们能确保获取的证据是可信且可靠的。
- en: In the next chapter, we will look at how to acquire similar evidence from a
    remote system.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨如何从远程系统获取类似的证据。
- en: Questions
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Answer the following questions to test your knowledge of this chapter:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 请回答以下问题，以测试你对本章的理解：
- en: When looking at the order of volatility, which of the following evidence categories
    should be acquired first?
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在查看挥发性顺序时，以下哪一类证据应首先获取？
- en: Random Access Memory
  id: totrans-175
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 随机存取存储器
- en: Pagefile or Swap File
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 页面文件或交换文件
- en: Central Processing Unit, Registers
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 中央处理单元，寄存器
- en: Storage Drive
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存储驱动器
- en: It is a good practice to acquire the pagefile with RAM if using FTK Imager.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果使用 FTK Imager，最好在获取 RAM 时同时获取页面文件。
- en: 'True'
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 正确
- en: 'False'
  id: totrans-181
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 错误
- en: When recreating the memory from a virtual system, responders should acquire
    both the VMSS and VMEM file.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在从虚拟系统重建内存时，响应人员应同时获取 VMSS 和 VMEM 文件。
- en: 'True'
  id: totrans-183
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 正确
- en: 'False'
  id: totrans-184
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 错误
- en: Further reading
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'For more information about the topics covered in this chapter, you can refer
    to the following:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 有关本章涵盖的主题的更多信息，您可以参考以下内容：
- en: '*Order of* *Volatility*: [https://www.forensicswiki.org/wiki/Digital_evidence#Order_of_Volatility](https://www.forensicswiki.org/wiki/Digital_evidence#Order_of_Volatility)'
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*易失性顺序*： [https://www.forensicswiki.org/wiki/Digital_evidence#Order_of_Volatility](https://www.forensicswiki.org/wiki/Digital_evidence#Order_of_Volatility)'
- en: '*The Advanced Data Acquisition* *Model*: [https://researchrepository.murdoch.edu.au/id/eprint/14422/](https://researchrepository.murdoch.edu.au/id/eprint/14422/)'
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*高级数据采集* *模型*： [https://researchrepository.murdoch.edu.au/id/eprint/14422/](https://researchrepository.murdoch.edu.au/id/eprint/14422/)'
- en: '*Best Practices in Digital Evidence* *Collection*: [https://digital-forensics.sans.org/blog/2009/09/12/best-practices-in-digital-evidence-collection/](https://digital-forensics.sans.org/blog/2009/09/12/best-practices-in-digital-evidence-collection/)'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*数字证据* *收集最佳实践*： [https://digital-forensics.sans.org/blog/2009/09/12/best-practices-in-digital-evidence-collection/](https://digital-forensics.sans.org/blog/2009/09/12/best-practices-in-digital-evidence-collection/)'
