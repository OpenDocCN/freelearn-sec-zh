- en: '14'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '14'
- en: Ransomware Preparation and Response
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 勒索病毒准备与响应
- en: With the availability of cryptocurrency, threat actors have been given the necessary
    tools to extract payment from victims without fear of being caught. This has led
    directly to the rise of ransomware, an attack where threat actors deploy malware
    that encrypts the victim’s files and extorts payment for the victim to get them
    back. Over the last 10 years, the development of more sophisticated tools and
    techniques to compromise victims has led to ransomware attacks impacting governments,
    large healthcare institutions, and major corporations, all to extract the maximum
    amount of ransom to enrich the various threat actors.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 随着加密货币的普及，威胁者拥有了从受害者那里提取赎金的必要工具，而无需担心被捕。这直接促成了勒索病毒的兴起，这是一种攻击方式，威胁者通过部署加密受害者文件的恶意软件并勒索赎金，让受害者支付以解锁文件。过去10年来，更加复杂的工具和技术的发展使得勒索病毒攻击影响到政府、大型医疗机构和大企业，所有这一切都是为了从受害者身上榨取最大赎金，丰富各种威胁者。
- en: Given the prolific nature of ransomware, it is a good bet that incident responders
    will have to respond to these types of attacks. To address incidents involving
    ransomware more effectively, analysts should be familiar with the tactics and
    techniques, along with the response actions, that will bring them back up and
    running if an attack occurs.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于勒索病毒的广泛传播，事件响应人员很可能需要应对这些类型的攻击。为了更有效地应对涉及勒索病毒的事件，分析人员应该熟悉相关的战术和技术，以及相应的响应行动，以便在发生攻击时能够迅速恢复运行。
- en: 'In this chapter, we will focus on the background elements, as outlined here:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将重点讨论以下背景要素：
- en: History of ransomware
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 勒索病毒的历史
- en: Conti ransomware case study
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Conti勒索病毒案例研究
- en: Proper ransomware preparation
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正确的勒索病毒准备
- en: Eradication and recovery
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根除与恢复
- en: With a solid foundation in place, we will examine specific investigative and
    analysis techniques in the next chapter.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在打下坚实的基础之后，我们将在下一章中探讨具体的调查与分析技术。
- en: History of ransomware
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 勒索病毒的历史
- en: 'Even though a version of malware that encrypts data has been around since the
    late 1980s, the current explosion in ransomware coincides with the development
    of cryptocurrency. This is the ability to anonymously send and receive digital
    currency that has allowed ransomware threat actors to execute attacks and extract
    payment from their victims while remaining anonymous. Over the past decade, this
    type of attack has gone through an evolution in terms of sophistication but has
    largely remained consistent with some core TTPs, such as an initial infection
    followed by propagating the ransomware and encrypting a user’s files with the
    intent to extract payment for the decryption key. We will briefly discuss some
    of the key variants in this evolution, as seen in the following diagram:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管自1980年代末以来就存在加密数据的恶意软件版本，但目前勒索病毒的爆发与加密货币的发展密切相关。加密货币的出现使得勒索病毒威胁者能够匿名发送和接收数字货币，这让他们能够在保持匿名的同时执行攻击并从受害者那里提取赎金。在过去的十年中，这种攻击形式在复杂性上经历了进化，但在一些核心战术、技术和程序（TTPs）方面基本保持一致，比如初始感染、传播勒索病毒以及加密用户文件，目的是为了获取解密密钥的赎金。我们将在下图中简要讨论这一演变中的一些关键变种：
- en: '![Figure 14.1 – A brief history of ransomware ](img/B18571_14_001.jpg)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![图14.1 – 勒索病毒简史](img/B18571_14_001.jpg)'
- en: Figure 14.1 – A brief history of ransomware
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.1 – 勒索病毒简史
- en: CryptoLocker
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: CryptoLocker
- en: The first ransomware attacks took place between September 2013 and May 2014
    and utilized the **CryptoLocker** ransomware variant. This variant was delivered
    via malicious email attachments and the **Gameover ZeuS** botnet. This variant
    of ransomware used the 2,048-bit RSA key to encrypt local files and mapped network
    drives. The attack also informed the victim that their files were encrypted, along
    with directions on how to pay the ransom. The attackers were halted through law
    enforcement intervention that ended up taking down the Gameover ZeuS botnet in
    May 2014\. This intervention even included an indictment of the Russian national
    Evgeniy Bogachev for his alleged involvement in maintaining the botnet associated
    with the attacks.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 第一波勒索病毒攻击发生在2013年9月到2014年5月之间，使用了**CryptoLocker**勒索病毒变种。该变种通过恶意电子邮件附件和**Gameover
    ZeuS**僵尸网络传播。此勒索病毒变种使用2048位RSA密钥加密本地文件和映射的网络驱动器。攻击者还会告知受害者他们的文件已被加密，并提供支付赎金的说明。通过执法部门的干预，攻击者被阻止，最终在2014年5月摧毁了Gameover
    ZeuS僵尸网络。此干预甚至包括对俄罗斯国籍的Evgeniy Bogachev的起诉，因其涉嫌参与维护与这些攻击相关的僵尸网络。
- en: CryptoWall
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: CryptoWall
- en: The next major variant to hit victim machines was **CryptoWall**, coming to
    prominence after the demise of the CryptoLocker variant. Much like CryptoLocker,
    this combined Trojan-ransomware variant used a 2,048-bit RSA encryption algorithm
    to encrypt the victim’s files. The primary delivery mechanism of the malware is
    through compressed files containing PDF documents.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个重大变种是**CryptoWall**，它在CryptoLocker变种消失后崭露头角。与CryptoLocker类似，这种结合了特洛伊木马和勒索病毒的变种使用2048位RSA加密算法来加密受害者的文件。该恶意软件的主要传播方式是通过包含PDF文档的压缩文件。
- en: CTB-Locker
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: CTB-Locker
- en: At about the same time the CryptoWall and CryptoLocker variants were prominent,
    the **CTB-Locker** variant was also infecting victims’ systems. Delivered mostly
    through malicious email attachments or fake downloads, this variant did add some
    additional features, such as the use of **The Onion Routing** (**TOR**) network
    for Command and Control, as well as deleting the Volume Shadow Copy of infected
    systems to inhibit recovery.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 与CryptoWall和CryptoLocker变种同时流行的，还有**CTB-Locker**变种，它也在感染受害者的系统。这个变种主要通过恶意电子邮件附件或伪造下载进行传播，且增加了一些附加功能，如使用**洋葱路由**（**TOR**）网络进行命令与控制，并删除感染系统的卷影复制，以阻止恢复。
- en: One additional feature that CTB-Locker leveraged was the affiliate model or
    **Ransomware-as-a-Service** (**RaaS**). In this model, independent threat actors
    are given access to the ransomware and associated tools to conduct the attacks
    with a portion of their ransom being paid to the threat actors running the ransomware
    operation.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: CTB-Locker利用的一个附加功能是加盟模式或**勒索病毒即服务**（**RaaS**）。在这种模式下，独立的攻击者可以访问勒索病毒和相关工具，以进行攻击，并从他们的赎金中提取一部分支付给运营勒索病毒的攻击者。
- en: TeslaCrypt
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: TeslaCrypt
- en: While most ransomware encrypts a wide variety of files, the **TeslaCrypt** variant
    targeted files associated with online gaming. The initial version of TeslaCrypt
    would encrypt saved games, player profiles, and game modifications. It was only
    in later versions that the variant would encrypt more Microsoft and other common
    files. TeslaCrypt utilized the Angler Adobe Flash exploit to infect systems using
    an asymmetrical encryption key. The initial versions contained a flaw in the encryption
    scheme and decrypters were released by Cisco Talos. In May 2016, the TeslaCrypt
    threat actors ceased their operations and released a decryption key.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然大多数勒索病毒会加密各种文件，但**TeslaCrypt**变种则专门针对与在线游戏相关的文件。TeslaCrypt的初始版本会加密保存的游戏、玩家档案和游戏修改文件。直到后来的版本，才会加密更多的Microsoft文件及其他常见文件。TeslaCrypt利用了Angler
    Adobe Flash漏洞，通过不对称加密密钥感染系统。最初的版本存在加密方案的缺陷，Cisco Talos发布了解密工具。2016年5月，TeslaCrypt的攻击者停止了其操作并释放了解密密钥。
- en: SamSam
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: SamSam
- en: The **SamSam** ransomware variant originated in Iran, as indicated by the indictment
    of two Iranian nationals Faramarz Shahi Savandi and Mohammed Mehdi Shah Mansouri.
    Throughout their campaign, the SamSam ransomware infected over 200 organizations
    in the United States, collecting an estimated $6 million from victims. The attacks
    leveraged vulnerabilities in the **Remote Desktop Protocol** (**RDP**) or Java-based
    web servers to gain an initial foothold in the victim’s network. From there, the
    threat actors would move laterally and encrypt as many systems as possible with
    a 2,048-bit RSA encryption algorithm.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**SamSam**勒索病毒变种起源于伊朗，根据对两名伊朗国民Faramarz Shahi Savandi和Mohammed Mehdi Shah Mansouri的起诉可以看出。在他们的攻击活动中，SamSam勒索病毒感染了超过200个美国组织，从受害者那里收集了约600万美元。攻击利用了**远程桌面协议**（**RDP**）或基于Java的Web服务器的漏洞，成功在受害者的网络中获取初步控制权。之后，攻击者会横向移动，尽可能加密更多系统，使用的是2048位RSA加密算法。'
- en: Locky
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Locky
- en: One common tactic that’s used by ransomware threat actors is the use of a macro-enabled
    Microsoft Word document. Using phishing techniques, victims are enticed to open
    the document with macros enabled. Once this is done, the macro downloads a Trojan
    virus that encrypts the system. The threat actors behind **Locky** used this technique
    to great effect across a variety of victims. Using either an RSA or AES cipher,
    the malware variant can encrypt files on the drive, removable drives, and network-connected
    drives.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 勒索病毒攻击者常用的一种策略是利用启用了宏的Microsoft Word文档。通过网络钓鱼技术，受害者被诱导打开启用了宏的文档。一旦执行，宏会下载一个特洛伊病毒并加密系统。**Locky**背后的攻击者利用这种技术对多个受害者造成了巨大影响。使用RSA或AES加密算法，该恶意病毒可以加密驱动器、可移动驱动器和网络连接的驱动器上的文件。
- en: WannaCry
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: WannaCry
- en: A short-lived but devastating attack, **WannaCry** was a high-profile attack
    that impacted over 200,000 computers across the globe. This attack used the recently
    disclosed Eternal Blue exploit, which leveraged a vulnerability in the Microsoft
    SMB service using the backdoor tool **DoublePulsar**, which allowed the ransomware
    to install and copy itself to other systems. The WannaCry attack lasted only a
    few hours on May 12, 2017, after a security researcher, Marcus Hutchins, discovered
    a kill switch that prevented additional infections. After additional research,
    the United States and the United Kingdom both attributed the attack to the North
    Korean government.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 一个短暂但破坏性极大的攻击，**WannaCry**是一起影响全球超过20万台计算机的高调攻击。此次攻击利用了近期披露的Eternal Blue漏洞，利用Microsoft
    SMB服务中的一个漏洞，并通过后门工具**DoublePulsar**使勒索病毒得以安装并复制到其他系统中。WannaCry攻击仅持续了几个小时，直到2017年5月12日，安全研究员Marcus
    Hutchins发现了一个杀死开关，防止了进一步的感染。经过进一步研究，美国和英国都将此次攻击归咎于朝鲜政府。
- en: Ryuk
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Ryuk
- en: Thought to be the work of the Russian cybercriminal group Wizard Spider, Ryuk
    has the distinction of demanding the top three highest payments in 2020\. This
    shows the group behind **Ryuk** targets large organizations for large payouts.
    The ransomware can shut down 180 services and 40 processes to ensure the maximum
    impact on the victim’s systems. The data is encrypted with an AES-256 symmetric
    key that is further encrypted with a 4,096-bit RSA key, making the encrypted files
    near impossible to recover without the key. Making use of the RaaS, Ryuk uses
    **Download-as-a-Service** (**DaaS**), in which the malware coders use a third
    party to deliver the ransomware to the target.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 被认为是俄罗斯网络犯罪集团Wizard Spider的作品，Ryuk具有要求2020年三大最高支付的独特地位。这表明**Ryuk**背后的集团将目标瞄准了大型组织，以获取大额赎金。勒索病毒可以关闭180个服务和40个进程，以确保最大限度地影响受害者的系统。数据使用AES-256对称密钥加密，并进一步使用4,096位RSA密钥加密，使得没有密钥几乎不可能恢复加密的文件。利用RaaS，Ryuk使用**Download-as-a-Service**（**DaaS**），即恶意软件编码人员通过第三方将勒索病毒传送给目标。
- en: Ryuk also uses a more complex multi-stage attack. In this case, a phishing email
    is sent to a victim. Once the attachment, such as a macro-enabled Word document,
    is opened, an additional tool, referred to as a dropper, is used. These droppers,
    such as BazarBackdoor or Trickbot, will often be used to add additional tools
    for command and control. Once control is established, the ransomware is loaded
    and executed.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: Ryuk同样使用了更为复杂的多阶段攻击。在这种情况下，会向受害者发送一封钓鱼邮件。一旦附件（如启用宏的Word文档）被打开，就会使用一个额外的工具，称为投放器。这些投放器，如BazarBackdoor或Trickbot，通常用于添加额外的命令和控制工具。一旦控制权建立，勒索病毒就会被加载并执行。
- en: Ryuk is closely related to another prolific variant, Conti. This variant represents
    a highly sophisticated tool that combines the elements of ransomware variants
    from past versions into a highly impactful attack.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Ryuk与另一个高产的变种Conti密切相关。这个变种代表了一种高度复杂的工具，它将过去版本中的勒索病毒变种元素结合成一次极具影响力的攻击。
- en: Conti ransomware case study
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Conti勒索病毒案例研究
- en: 'One of the most prolific ransomware variants to hit is Conti. There are two
    aspects to Conti that make it stand out in terms of threat actors. The first of
    these aspects is that Conti is a RaaS threat actor. This type of threat actor
    uses an affiliate model where highly skilled recruits are found on hacking forums.
    From there, they are provided the tools and techniques necessary to execute the
    initial stage: attack and deploy ransomware. The original coders of the Conti
    variant are then provided a fee of anywhere between 10 to 30 percent of the ransom.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 最具生产力的勒索病毒变种之一是Conti。Conti的两个特点使其在威胁行为者中脱颖而出。第一个特点是Conti是一个RaaS（勒索软件即服务）威胁行为者。这种类型的威胁行为者使用一种加盟模式，在黑客论坛上寻找高度熟练的招募人员。从那里，他们会获得执行初始阶段所需的工具和技术：攻击并部署勒索病毒。Conti变种的原始编码人员随后会获得10%到30%不等的赎金作为报酬。
- en: The second of these is that Conti affiliates will often exfiltrate data, along
    with encrypting files. This data is then held “hostage” by the affiliate for ransom.
    If the victim organization did not pay in time, the data would be released. Conti
    affiliates were even able to use a website both on the internet and on the dark
    web to post the data.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个特点是，Conti的加盟者通常会在加密文件的同时窃取数据。然后，这些数据会被“劫持”，用于勒索。如果受害组织未能及时支付赎金，数据将被公开。Conti的加盟者甚至能够在互联网和暗网上使用一个网站发布这些数据。
- en: Before being shut down, the Conti variant and the affiliates used a wide variety
    of tools and techniques that serve as a good case study of how ransomware threat
    actors operate. In this case, first, we will look at the affiliate’s background,
    disclosures, and the TTPs that the group and its affiliates use as part of their
    attacks.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在被关闭之前，Conti 变种及其加盟团体使用了多种多样的工具和技术，成为研究勒索软件威胁行为者操作模式的一个优秀案例。在这个案例中，我们将首先研究该加盟团体的背景、披露内容以及该团体及其加盟者在攻击中使用的
    TTP（战术、技术和程序）。
- en: Background
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 背景
- en: The RaaS model was first observed in December 2019\. The name Conti refers to
    the specific variant of malware that is used, often deployed with the Trickbot
    Trojan developed by the threat actor Wizard Spider. This group, first seen in
    September 2016, is believed to be based in Russia and is a sophisticated financially
    motivated threat actor.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: RaaS 模型首次出现在 2019 年 12 月。Conti 这个名字指的是所使用的特定恶意软件变种，通常与威胁行为者 Wizard Spider 开发的
    Trickbot 木马一起部署。这个团体首次出现在 2016 年 9 月，据信其总部位于俄罗斯，是一个技术先进、以财务为驱动的威胁行为者。
- en: While operational, the RaaS threat actors tied to Conti have attacked a variety
    of organizations, including the government and large enterprises. Even during
    the COVID-19 pandemic, the affiliates had carried out attacks against 16 separate
    healthcare or first-responder networks. Some of these attacks carried a ransom
    of 25 million dollars US.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在运作期间，与 Conti 相关的 RaaS 威胁行为者攻击了包括政府和大型企业在内的多种组织。即便在 COVID-19 大流行期间，加盟团体仍然对 16
    个不同的医疗或急救网络发动攻击。这些攻击中的一些勒索金额高达 2500 万美元。
- en: One key facet of the affiliate model that Conti utilizes is the sophisticated
    task division within the overall organization. There are specific teams that handle
    the technical aspects of initial access and then hand off the remaining work to
    another team. There are also specific teams that handle the ransomware negotiations
    with the victim organization.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: Conti 所使用的加盟模型的一个关键特点是组织内部的精细任务分工。有专门的团队负责初步访问的技术环节，然后将剩余的工作交给其他团队处理。还有专门的团队负责与受害者组织进行勒索软件谈判。
- en: 'Conti also added a new element to the already lucrative ransomware threat by
    adding another extortion element to their attacks. Conti set up websites both
    on the publicly available internet and the dark web where they would threaten
    the release of exfiltrated data to the public if their demands were not met. This
    was done to force more pressure on victims to pay the ransom to not only get their
    data decrypted but also save themselves from the embarrassment of public disclosure:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: Conti 还通过向攻击中加入额外的勒索元素，进一步提升了原本就非常盈利的勒索软件威胁。Conti 在公开互联网和暗网中设置了多个网站，威胁称如果受害者不满足其要求，他们将公开泄露被窃取的数据。这样做是为了迫使受害者支付赎金，不仅是为了恢复数据解密，还为了避免公共披露带来的尴尬：
- en: '![Figure 14.2 – Conti disclosure site ](img/B18571_14_002.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.2 – Conti 披露网站](img/B18571_14_002.jpg)'
- en: Figure 14.2 – Conti disclosure site
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.2 – Conti 披露网站
- en: 'On the same website, Conti actors also threatened retaliation for the crisis
    that began with the Russian invasion of Ukraine in 2022\. This declaration was
    followed by increased attacks by the group against targets in Ukraine. The major
    difference was that the attacks were carried out against government networks and
    critical infrastructure in a departure from the ransom extraction motive:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在同一个网站上，Conti 行为者还威胁对 2022 年俄乌战争危机进行报复。此声明之后，该团体对乌克兰的目标进行了更多攻击。主要的不同点是，这些攻击针对的是政府网络和关键基础设施，而不再是单纯的勒索目的。
- en: '![Figure 14.3 – Conti Ukraine response ](img/B18571_14_003.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.3 – Conti 乌克兰响应](img/B18571_14_003.jpg)'
- en: Figure 14.3 – Conti Ukraine response
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.3 – Conti 乌克兰响应
- en: In its short 2 years of operations, Conti and its affiliates became a major
    threat to organizations, ranging from government, healthcare, critical infrastructure,
    and large corporations. Their sophisticated model of task division and technical
    ability made it a model for potential future threat actors to emulate. Given this,
    it caught many by surprise when the group ceased its operations in May 2022, shutting
    down its infrastructure, including its disclosure site. Affiliate members then
    went on to other groups. One event may have accelerated the group’s demise and
    that was the disclosure of internal documents and tools by an affiliate member.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在短短2年的运营中，Conti及其附属机构已经成为政府、医疗、关键基础设施以及大公司等组织的重大威胁。它们的精密任务分工和技术能力使其成为潜在未来威胁行为者的模仿对象。鉴于此，当该组织在2022年5月停止运营并关闭其基础设施，包括其披露网站时，许多人感到意外。附属成员随后加入了其他团体。一项事件可能加速了该组织的解散，那就是一个附属成员披露了内部文件和工具。
- en: Operational disclosure
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作披露
- en: 'On August 5, 2021, a user with the screen name `m1Geelka` posted to the Russian
    language cybersecurity forum `xss.is` the technical and operational manuals used
    by the Conti ransomware group and its affiliates. The user posted a link to download
    the manuals and software from a file-sharing site for anyone with access to the
    forum. This post was soon deleted but for security researchers, it was a bonanza
    of data and intelligence into the group’s operations:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 2021年8月5日，一位用户名为`m1Geelka`的用户在俄罗斯语言的网络安全论坛`xss.is`上发布了Conti勒索软件组及其附属机构使用的技术和操作手册。该用户提供了一个链接，供有权限访问论坛的任何人下载手册和软件，该链接指向一个文件共享网站。此帖很快被删除，但对于安全研究人员来说，这是一次关于该组操作的重磅数据和情报收获：
- en: '![Figure 14.4 – Conti disclosure ](img/B18571_14_004.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.4 – Conti 披露](img/B18571_14_004.jpg)'
- en: Figure 14.4 – Conti disclosure
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.4 – Conti 披露
- en: 'The disclosures are still currently available at [https://share.vx-underground.org/Conti/](https://share.vx-underground.org/Conti/)
    and include updates from additional disclosures of the Conti group’s TTPs from
    February and March 2022\. For example, the disclosed documents included screen
    captures of the use of tools such as Cobalt Strike, as shown here:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 这些披露内容目前仍然可以在[https://share.vx-underground.org/Conti/](https://share.vx-underground.org/Conti/)访问，包含了2022年2月和3月Conti组TTPs（战术、技术和程序）更新的附加披露。例如，披露的文件中包含了使用Cobalt
    Strike等工具的屏幕截图，如下所示：
- en: '![Figure 14.5 – Conti Cobalt Strike use ](img/B18571_14_005.jpg)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.5 – Conti 使用 Cobalt Strike](img/B18571_14_005.jpg)'
- en: Figure 14.5 – Conti Cobalt Strike use
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.5 – Conti 使用 Cobalt Strike
- en: The disclosures included other key details of the group’s operations and methods.
    This included chat logs, source code, and manuals related to tool use. The unique
    feature of this disclosure was the near complete picture of the threat actors
    and their affiliate’s operational methods and tools. Using this data, we can get
    a picture of the specific tactics and techniques a sophisticated ransomware group
    can employ and better prepare to defend and detect against them.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 这些披露内容包括了该组织运营和方法的其他关键细节。包括了聊天记录、源代码以及与工具使用相关的手册。此次披露的独特之处在于几乎完整呈现了威胁行为者及其附属机构的操作方法和工具。通过这些数据，我们可以清楚地看到一个复杂的勒索软件组织可能采用的具体战术和技术，从而更好地准备防御和检测它们。
- en: Tactics and techniques
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 战术和技术
- en: 'Conti affiliates utilize a variety of tactics and techniques. In this section,
    we will examine some of the more common of these as there is significant overlap
    with those used by affiliates and other ransomware threat actors. For a complete
    breakdown of the TTPs associated with the Conti ransomware variant, consult the
    MITRE ATT&CK profile at [https://attack.mitre.org/software/S0575/](https://attack.mitre.org/software/S0575/).
    For context on an actual Conti ransomware campaign, the **Cybersecurity and Infrastructure
    Agency** (**CISA**) published an advisory concerning the Conti threat actors with
    a detailed breakdown of the MITRE ATT&CK tactics that were observed during over
    a thousand attacks: [https://www.cisa.gov/uscert/sites/default/files/publications/AA21-265A-Conti_Ransomware_TLP_WHITE.pdf](https://www.cisa.gov/uscert/sites/default/files/publications/AA21-265A-Conti_Ransomware_TLP_WHITE.pdf).'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: Conti 的附属人员采用多种策略和技术。在本节中，我们将探讨其中一些更常见的策略和技术，因为这些策略与附属人员及其他勒索病毒威胁行为者使用的策略有很大的重叠。要完整了解与
    Conti 勒索病毒变种相关的 TTPs，请参考 MITRE ATT&CK 配置文件：[https://attack.mitre.org/software/S0575/](https://attack.mitre.org/software/S0575/)。有关实际
    Conti 勒索病毒攻击活动的背景，**网络安全和基础设施局**（**CISA**）发布了关于 Conti 威胁行为者的咨询报告，并详细列出了在超过千次攻击中观察到的
    MITRE ATT&CK 战术：[https://www.cisa.gov/uscert/sites/default/files/publications/AA21-265A-Conti_Ransomware_TLP_WHITE.pdf](https://www.cisa.gov/uscert/sites/default/files/publications/AA21-265A-Conti_Ransomware_TLP_WHITE.pdf)。
- en: Initial access
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 初始访问
- en: The primary method that Conti leverages is **Spear Phishing campaigns [T1566.001]**
    or the use of **Malicious Links [1566.002]** contained within an email. Emails
    will often contain a macro-enabled Microsoft Word document with a filename deliberately
    chosen to entice a user to open the attachment. In other incidents, the Conti
    affiliates have been known to use compromised credentials to connect to internet-exposed
    systems with RDP enabled. This allows them to establish a foothold within the
    network without the need to send a phishing email.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: Conti 主要采用的方式是**鱼叉式钓鱼攻击 [T1566.001]**或邮件中包含的**恶意链接 [1566.002]**。这些邮件通常会包含一个启用了宏的
    Microsoft Word 文档，文件名故意设置为吸引用户打开附件。在其他案例中，Conti 附属人员已知使用被泄露的凭据通过启用 RDP 的互联网暴露系统进行连接。这样，他们可以在不发送钓鱼邮件的情况下，在网络内建立立足点。
- en: Other affiliates used pretext calls, where they pretended to be a helpdesk person
    and had the user download a remote access software such as GoToAssist. From there,
    the attacker can place malware or other tools to begin the follow-on actions.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 其他附属人员使用伪装电话，他们假装是帮助台人员，诱使用户下载远程访问软件，如 GoToAssist。然后，攻击者可以植入恶意软件或其他工具，开始后续的操作。
- en: Execution
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 执行
- en: 'Once the macro-enabled Word document is opened, the macro will often execute
    a Windows PowerShell script to execute the **Command and Scripting Interpreter:
    PowerShell [T1059.001]** technique. This script is often used to download a secondary
    payload, often a RAT such as Trickbot, Qbot, or Bazar. This establishes the initial
    foothold into the victim’s network.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦启用了宏的 Word 文档被打开，宏通常会执行一个 Windows PowerShell 脚本，以执行**命令和脚本解释器：PowerShell [T1059.001]**技术。这个脚本常用于下载二级有效载荷，通常是像
    Trickbot、Qbot 或 Bazar 这样的 RAT。这样就建立了对受害者网络的初步控制。
- en: 'A few methods must be used to execute the malware. One technique that’s often
    used by Contin affiliates is to warp the RAT in a DLL file. This file will then
    be placed in a directory. The Windows `rundll32.exe` executable will be used to
    execute the RAT in what is referred to as a **System Binary Proxy Execution: Rundll32
    [T1218.011]**. This technique is still seen in the wild, even though many EDR
    tools can detect such behavior.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 执行恶意软件需要使用几种方法。Conti 附属人员常用的一种技术是将 RAT 嵌入 DLL 文件中。该文件将被放置在一个目录中。然后，使用 Windows
    `rundll32.exe` 可执行文件来执行 RAT，这种方法称为**系统二进制代理执行：Rundll32 [T1218.011]**。即便许多 EDR
    工具可以检测到此类行为，这种技术在实际环境中仍然存在。
- en: 'It is here that we will also start looking at the tool Cobalt Strike. This
    tool is often found in ransomware incidents and is commonly associated with Conti.
    This tool is a commercial post-exploitation tool that has a wide range of functionality
    within an integrated system. Cobalt Strike also includes other common post-exploitation
    frameworks such as Metasploit and post-exploitation tools such as Mimikatz, which
    can be used for a variety of credential threat and abuse attacks. The overall
    look and feel of the tool are similar to that of Armitage, as shown in the following
    screenshot:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将开始查看工具 Cobalt Strike。这个工具常出现在勒索软件事件中，并且通常与 Conti 有关。Cobalt Strike 是一款商业化的后期利用工具，具有广泛的功能，能够在一个集成系统中执行各种操作。Cobalt
    Strike 还包括其他常见的后期利用框架，如 Metasploit 和后期利用工具如 Mimikatz，可用于各种凭证威胁和滥用攻击。该工具的整体外观和操作感受类似于
    Armitage，如下图所示：
- en: '![Figure 14.6 – Cobalt Strike GUI ](img/B18571_14_006.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.6 – Cobalt Strike 图形用户界面](img/B18571_14_006.jpg)'
- en: Figure 14.6 – Cobalt Strike GUI
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.6 – Cobalt Strike 图形用户界面
- en: Cobalt Strike will often be executed alongside or in place of the RAT that is
    executed at this stage of the attack.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: Cobalt Strike 通常会在此攻击阶段与 RAT 一起执行，或者代替 RAT 执行。
- en: Privilege escalation
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 权限提升
- en: 'Wizard Spider has been observed loading a malicious DLL file into an existing
    or running process in an attack referred to as **Process Injection: Dynamic-link
    Library Injection [T1055.001]**. In this technique, the attacker can inject arbitrary
    code into a running process. This allows the attackers to execute the malicious
    code and bypass detection. Depending on the process written to, the malicious
    code may also be run at elevated privileges.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: Wizard Spider 被观察到在一次被称为 **进程注入：动态链接库注入 [T1055.001]** 的攻击中，将恶意 DLL 文件注入现有或正在运行的进程。在此技术中，攻击者可以将任意代码注入到正在运行的进程中。这使得攻击者能够执行恶意代码并绕过检测。根据写入的进程，恶意代码可能还会以提升的权限运行。
- en: Defense evasion
  id: totrans-70
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 防御规避
- en: Modern antivirus and EDR solutions have gotten much better at detecting malware,
    exploits, and other malicious activity on endpoints. Ransomware threat actors
    such as Conti use a variety of methods to ensure that they are not detected and
    stopped. In addition to process injection, the Cobalt Strike platform has additional
    functionality that allows threat actors to maintain stealth. For example, the
    tool uses the **Obfuscated Files or Information [T1027]** technique by hashing
    API Windows API calls so that antivirus or EDR tools do not identify any of the
    suspicious API calls associated with Cobalt Strike usage.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 现代的杀毒软件和 EDR 解决方案在检测恶意软件、漏洞利用和其他恶意活动方面变得更加高效。勒索软件威胁演员，如 Conti，采用各种方法确保不被检测和阻止。除了进程注入外，Cobalt
    Strike 平台还具有额外的功能，允许威胁演员保持隐蔽。例如，该工具通过哈希化 Windows API 调用，使用 **混淆文件或信息 [T1027]**
    技术，使得杀毒软件或 EDR 工具无法识别与 Cobalt Strike 使用相关的任何可疑 API 调用。
- en: 'One additional defense evasion tactic that is often observed not only with
    Conti but many of the ransomware threat actors is the use of Base64 encoding for
    PowerShell scripts. This provides a measure of obfuscation by doesn’t write specific
    commands to the storage. Instead, it relies on PowerShell to decode and execute
    the commands. For example, the following Windows Event Log entry shows the Base64-encoded
    script:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 另外一个常见的防御规避策略，不仅在 Conti 中观察到，在许多勒索软件威胁演员中也有广泛使用，就是利用 Base64 编码 PowerShell 脚本。此策略通过不将具体命令写入存储来提供一种混淆手段。相反，它依赖
    PowerShell 解码并执行命令。例如，以下 Windows 事件日志条目展示了 Base64 编码的脚本：
- en: '![Figure 14.7 – Base64-encoded PowerShell script ](img/B18571_14_007.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.7 – Base64 编码的 PowerShell 脚本](img/B18571_14_007.jpg)'
- en: Figure 14.7 – Base64-encoded PowerShell script
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.7 – Base64 编码的 PowerShell 脚本
- en: Credential access
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 凭证访问
- en: 'Accessing or creating valid credentials with elevated privileges is critical
    to the lateral movement components of ransomware attacks. Conti utilizes a few
    different tools and techniques to gain access to credentials. The first of these
    is the use of the Sysinternals tool `procdump.exe`. This tool is used in the **OS
    Credential Dumping: LSASS Memory [T1003.001]** technique, where it is leveraged
    to dump the **Local Security Authority Subsystem Service** (**LSASS**), which
    contains the Windows OS credentials.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 获取或创建具有提升权限的有效凭证，对于勒索软件攻击的横向移动组件至关重要。Conti 利用几种不同的工具和技术来获取凭证。第一种是使用 Sysinternals
    工具 `procdump.exe`。该工具在 **操作系统凭证转储：LSASS 内存 [T1003.001]** 技术中被使用，用于转储 **本地安全认证子系统服务**（**LSASS**），该服务包含
    Windows 操作系统的凭证。
- en: 'Conti has also used the post-exploitation tool Mimikatz to perform a similar
    type of action as the Windows Sysinternals tool `procdump.exe`. The binary and
    associated files are available on GitHub at [https://github.com/ParrotSec/mimikatz](https://github.com/ParrotSec/mimikatz).
    Mimikatz can also obtain the plaintext passwords of user and administrator accounts
    on the system, as shown in the following screenshot:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: Conti还使用了后渗透工具Mimikatz，执行类似Windows Sysinternals工具`procdump.exe`的操作。该二进制文件和相关文件可在GitHub上找到：[https://github.com/ParrotSec/mimikatz](https://github.com/ParrotSec/mimikatz)。Mimikatz还可以获取系统上用户和管理员账户的明文密码，如下图所示：
- en: '![Figure 14.8 – Mimikatz ](img/B18571_14_008.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![图14.8 – Mimikatz](img/B18571_14_008.jpg)'
- en: Figure 14.8 – Mimikatz
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.8 – Mimikatz
- en: Mimikatz can also acquire Kerberos tickets, along with other features, to obtain
    access to valid credentials. Post-exploitation frameworks such as Metasploit and
    Cobalt Strike include Mimikatz.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Mimikatz还可以获取Kerberos票证，以及其他功能，以获得有效的凭证。像Metasploit和Cobalt Strike这样的后渗透框架包括Mimikatz。
- en: Discovery
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 发现
- en: Once an established foothold has been achieved, ransomware actors such as Conti
    will need to map the internal network to determine the best way to impact as many
    systems as possible. In some instances, this includes running command-line tools
    such as `net localgroup`. Conti has been known to use the network discovery functionality
    within Cobalt Strike. Finally, for more complex networks, you can use the Active
    Directory mapping tool Bloodhound, available at [https://github.com/BloodHoundAD/BloodHound](https://github.com/BloodHoundAD/BloodHound).
    This tool allows the attacker to not only map the network but also provide a visual
    graph. This, in turn, may provide insight into the best attack path.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦建立了立足点，像Conti这样的勒索软件攻击者需要绘制内部网络图，以确定影响尽可能多系统的最佳方式。在某些情况下，这包括运行命令行工具如`net localgroup`。已知Conti使用Cobalt
    Strike中的网络发现功能。最后，对于更复杂的网络，可以使用Active Directory映射工具Bloodhound，下载地址：[https://github.com/BloodHoundAD/BloodHound](https://github.com/BloodHoundAD/BloodHound)。该工具不仅能绘制网络图，还能提供可视化图表，进而可能为最佳攻击路径提供见解。
- en: Lateral movement
  id: totrans-83
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 横向移动
- en: Before executing this tactic, the malicious activity is largely contained to
    a few systems that have either been compromised with the initial execution of
    the RAT or have been compromised by additional tools. The next phase after discovery
    is lateral movement. This is where Conti actors are attempting to compromise as
    many systems as possible so that the impact of the ransomware will be sufficient
    to cause the victim to pay the ransom.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行这一战术之前，恶意活动通常只限于少数已被初步执行RAT或通过其他工具被攻陷的系统。发现后的下一阶段是横向移动。这时，Conti的攻击者试图攻陷尽可能多的系统，以便勒索软件的影响足以迫使受害者支付赎金。
- en: 'Lateral movement for ransomware is largely dependent on having access to credentials,
    often with elevated privileges that allow the use of remote access either through
    the **Server Message Block** (**SMB**) or RDP. In the case of SMB, the specific
    technique is referred to as **Remote Services: SMB/Windows Admin Shares [T1021.002]**.
    In this technique, the attacker will often use the Windows Sysinternals tool PsExec
    to connect to and write to the ADMIN$ network share. They are then able to execute
    additional commands or transfer malicious tools and executables.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 勒索软件的横向移动在很大程度上依赖于拥有凭证的访问权限，通常是具有提升权限的凭证，这使得可以通过**服务器消息块**（**SMB**）或RDP进行远程访问。对于SMB，特定的技术被称为**远程服务：SMB/Windows管理员共享
    [T1021.002]**。在这一技术中，攻击者通常使用Windows Sysinternals工具PsExec连接到并写入ADMIN$网络共享。然后，他们能够执行额外的命令或传输恶意工具和可执行文件。
- en: 'Another technique that is often leveraged is **Remote Services: Remote Desktop
    Protocol [1021.001]**. In this case, Conti can leverage the **Virtual Network
    Computing** (**VNC**) functionality of Cobalt Strike to connect to additional
    systems running RDP. From here, they can execute additional commands or place
    additional tools on newly compromised systems.'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种常用的技术是**远程服务：远程桌面协议 [1021.001]**。在这种情况下，Conti可以利用Cobalt Strike的**虚拟网络计算**（**VNC**）功能连接到运行RDP的其他系统。从这里，他们可以执行额外的命令或在新被攻陷的系统上放置其他工具。
- en: An aspect of these techniques is that they depend on having access to legitimate
    administrator-level credentials.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 这些技术的一个方面是，它们依赖于拥有合法管理员级别凭证的访问权限。
- en: Command and Control
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 命令与控制
- en: One of the key components of the Cobalt Strike post-exploitation tool is its
    ability to customize Command and Control infrastructure. The tool makes use of
    listeners, which are configured by the threat actor. Threat actors can configure
    the listener to use a variety of TCP and UDP protocols such as DNS, HTTP, and
    HTTPS.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: Cobalt Strike 后期利用工具的一个关键组成部分是其定制指挥与控制基础设施的能力。该工具使用由威胁行为者配置的监听器。威胁行为者可以配置监听器，使用多种
    TCP 和 UDP 协议，如 DNS、HTTP 和 HTTPS。
- en: 'In addition to the listener, threat actors can also configure an array of malleable
    C2 profiles. These profiles allow the threat actor to obfuscate the C2 traffic
    to bypass detection mechanisms such as intrusion detection or intrusion prevention
    systems. For example, the following section of a malleable profile was taken from
    [https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile](https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile).
    In this profile, the C2 traffic is designed to mimic normal HTTP traffic. One
    specific portion that is worth examining is the following:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 除了监听器，威胁行为者还可以配置一组可修改的 C2 配置文件。这些配置文件使威胁行为者能够模糊化 C2 流量，以绕过入侵检测或入侵防御系统等检测机制。例如，下面这一段可修改的配置文件来自
    [https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile](https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile)。在该配置文件中，C2
    流量被设计成模拟正常的 HTTP 流量。值得检查的一个特定部分如下：
- en: '[PRE0]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: In this portion of the profile, various settings have been configured. The first
    is the sleep time, which is the interval in seconds when the C2 beacon reaches
    out to the external C2 system for instructions. To bypass IDS systems that look
    for this type of beaconing behavior, a jitter is set. This is a random time that
    can be set that either adds or removes the sleep time so that there is a randomization
    of the beaconing activity. The other key piece of data is the user agent, which
    the profile uses to appear to be a web browser initiating the connection. A casual
    review of any network traffic would show that user agent string.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置文件的这一部分，已经配置了各种设置。第一个是睡眠时间，这是 C2 信标向外部 C2 系统发送指令时的间隔（以秒为单位）。为了绕过 IDS 系统对这种信标行为的检测，设置了一个抖动时间。这是一个随机时间，可以通过增加或减少睡眠时间来随机化信标活动。另一个关键数据是用户代理，配置文件使用它来使连接看起来像是一个
    web 浏览器发起的。随意检查任何网络流量都会显示该用户代理字符串。
- en: These malleable profiles are openly available and provide Cobalt Strike with
    the ability to appear like legitimate traffic. In even a small network, this traffic
    between the Cobalt Strike system and the victim systems would blend in with all
    the other traffic that is traversing the ingress/egress point of the network.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 这些可修改的配置文件是公开可用的，并使 Cobalt Strike 能够伪装成合法的流量。在一个小型网络中，Cobalt Strike 系统与受害系统之间的流量会与所有其他在网络进出口点传输的流量混合在一起。
- en: Exfiltration
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据泄露
- en: One of the key facets of Conti that separated it from other earlier groups or
    campaigns was the theft of data, as well as encryption. In this case, Conti used
    common tools such as WinSCP or PuTTY to send aggregated data via **Secure File
    Transfer Protocol** (**SFTP**) or through the simple HTTPS technique **Exfiltration
    Over Web** **Service [T1567]**.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Conti 与其他早期组织或攻击活动的主要区别之一就是数据盗窃和加密。在这种情况下，Conti 使用了 WinSCP 或 PuTTY 等常见工具，通过
    **安全文件传输协议**（**SFTP**）或简单的 HTTPS 技术 **Web 服务数据泄露 [T1567]** 来发送聚合数据。
- en: Impact
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 影响
- en: The Conti group is associated with the Conti ransomware, which encrypts data
    on infected systems in line with the MITRE ATT&CK technique `CreateIoCompletionPort()`,
    `PostQueuedCompletionStatus()`, and `GetQueuedCompletionPort()` to encrypt files
    with an AES-256 encryption key that is paired with an RSA-4096 public encryption
    key. One unique feature of the Conti variant is that it will bypass `.exe`, `.dll`,
    and `.lnk` files and not encrypt them.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: Conti 组与 Conti 勒索病毒相关，该勒索病毒会根据 MITRE ATT&CK 技术 `CreateIoCompletionPort()`、`PostQueuedCompletionStatus()`
    和 `GetQueuedCompletionPort()` 加密感染系统上的数据，使用一个与 RSA-4096 公钥配对的 AES-256 加密密钥来加密文件。Conti
    变种的一个独特特征是它会跳过 `.exe`、`.dll` 和 `.lnk` 文件，并且不会加密它们。
- en: Conti can also execute the **Service Stop [1489]** technique by stopping 146
    separate Windows OS services or processes. These services are related to backups
    and security tools. This allows the ransomware to execute properly and removes
    any ability for the victim to leverage a backup for database or other restoration
    purposes.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: Conti还可以通过停止146个独立的Windows操作系统服务或进程，执行**Service Stop [1489]**技术。这些服务与备份和安全工具相关联。这样，勒索软件就能正常执行，并且消除了受害者利用备份进行数据库或其他恢复的能力。
- en: Finally, the Conti ransomware can `vssadmin` command. Again, this removes the
    ability of the victim to restore the system after the encryption process. Essentially,
    if Conti is successfully executed, it has an almost certain chance to encrypt
    all but a limited number of files, making the system unusable.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，Conti勒索软件可以使用`vssadmin`命令。再次强调，这会删除受害者在加密过程后恢复系统的能力。本质上，如果Conti成功执行，它几乎肯定会加密所有文件，只有少数文件除外，导致系统无法使用。
- en: Proper ransomware preparation
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 适当的勒索软件准备
- en: Ransomware attacks are devastating to an enterprise. Not many incidents short
    of a natural disaster have the impact that a ransomware attack has. While an APT-style
    network intrusion that aims to gain access to confidential data is severe, they
    often do not leave the entire network encrypted, especially if they are attempting
    to maintain a level of stealth so that the intrusion goes undetected.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 勒索软件攻击对企业造成的破坏是毁灭性的。除了自然灾害，没有多少事件能像勒索软件攻击那样产生如此大的影响。虽然旨在获取机密数据的APT类型网络入侵也非常严重，但它们通常不会加密整个网络，尤其是当入侵者试图保持一定的隐蔽性，以便入侵不被察觉时。
- en: In preparing for a ransomware attack, organizations should focus on two specific
    areas. The first is to make the network and endpoints resilient to the impact
    of a ransomware attack. This approach functions under the assumption that the
    threat actor may gain access to a system, but that proper preparation will leave
    them with little in terms of tools or methods to carry their attack any further
    from an initial foothold. The second preparation step is to ensure that the CSIRT
    is familiar with the TTPs of ransomware threat actors and is ready to meet the
    challenge of containing and removing a threat actor from the network.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在为勒索软件攻击做准备时，组织应关注两个具体领域。首先，确保网络和端点对勒索软件攻击的影响具有韧性。此方法的前提是假设威胁行为者可能会访问系统，但适当的准备将使他们在从初始立足点进一步攻击时，几乎没有工具或方法。第二个准备步骤是确保CSIRT团队熟悉勒索软件威胁行为者的TTP（战术、技术和程序），并准备应对隔离和清除网络中的威胁行为者的挑战。
- en: Ransomware resiliency
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 勒索软件韧性
- en: 'Being resilient against ransomware simply means that we acknowledge that the
    threat exists and has a chance of at least stopping the attack at the endpoint.
    If that does not work, the organization can limit the reach and associated impact
    so that only a few select systems are impacted and normal operations can continue.
    A ransomware resilience strategy should incorporate the following:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 对抗勒索软件的韧性意味着我们承认这一威胁的存在，并且至少有机会在端点阻止攻击。如果这样做无效，组织可以限制勒索软件的蔓延及其相关影响，确保只有少数选定的系统受到影响，从而使正常操作得以继续。勒索软件韧性策略应包括以下内容：
- en: '`rundll32.exe` to execute malicious code. While the use of PowerShell or `rundll32.exe`
    is not in and of itself malicious, the use of the command line to run DLL files
    or Base64-encoded PowerShell is often indicative of malicious behavior.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`rundll32.exe`执行恶意代码。尽管PowerShell或`rundll32.exe`的使用本身并不具恶意，但通过命令行运行DLL文件或Base64编码的PowerShell通常表明存在恶意行为。
- en: '**System hygiene**: As we saw in the Conti ransomware overview, the group would
    often make use of Windows Sysinternals tools as part of their overall attack.
    Couple that with the use of local administrator accounts and the compromise of
    a single system may pose a significant risk. Systems administrators should ensure
    that deployed endpoints are limited in tools to those that are necessary. Removing
    RDP access, local administrator accounts, and tools such as ProcDump or PsExec
    can make it more difficult to move laterally and infect other systems.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**系统卫生**：正如我们在Conti勒索软件概述中看到的，该团伙通常会利用Windows Sysinternals工具作为整体攻击的一部分。再加上使用本地管理员账户，单一系统的妥协可能会带来重大风险。系统管理员应确保部署的端点仅限于必要的工具。移除RDP访问、本地管理员账户以及像ProcDump或PsExec这样的工具，可以使横向移动和感染其他系统变得更加困难。'
- en: There are several industry-accepted standards for system hardening, such as
    the **Security Technical Implementation Guides** (**STIGs**), which provide details
    on how to configure and harden a variety of systems. Other guides are available.
    Each organization has to determine its risk and apply the appropriate hardening
    as it sees necessary. The overall goal, no matter how the systems are hardened,
    is to make it difficult for the threat actor to operate in your network.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 有几个行业公认的系统加固标准，例如**安全技术实施指南**（**STIGs**），提供了如何配置和加固各种系统的详细信息。还有其他指南可以参考。每个组织必须根据其风险来决定并应用适当的加固措施。无论系统如何加固，整体目标都是使威胁行为者在网络中进行操作变得更加困难。
- en: '**Network topology**: One aspect that stands out concerning ransomware attacks
    that impact the entire network is a “flat” network topology. In this topology,
    all systems can speak to others. For example, a LAN segment for accounts payable
    would be able to reach research and development, even though there is no need
    for these systems to communicate with each other. In short, a flat network allows
    the ransomware threat actor to propagate across the entire enterprise using compromised
    credentials and their tool of choice.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络拓扑**：关于影响整个网络的勒索软件攻击，一个突出的方面是“扁平”网络拓扑。在这种拓扑中，所有系统都可以与其他系统通信。例如，支付账款的局域网段就能与研发部门的系统进行通信，尽管这些系统之间并没有必要相互通信。简而言之，扁平网络允许勒索软件威胁行为者使用被攻破的凭证和他们选择的工具，在整个企业范围内传播。'
- en: The answer to this is to build a network topology in the same way a shipbuilder
    goes about designing a container ship. Below the waterline, the ship has watertight
    compartments so that if the ship’s hull is compromised, water can only come into
    that compartment alone, keeping the ship above water. The network topology should
    function in much the same way, where different LAN segment communications are
    limited to only necessary communication. The practice of **network segmentation**
    creates specific “watertight” compartments that limit the ability of a threat
    actor to move laterally.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案是像造船工设计集装箱船那样构建网络拓扑。在水线以下，船体有防水舱，以便如果船体受损，水只能进入那个舱室，从而保持船只浮在水面上。网络拓扑应当以类似的方式工作，其中不同的局域网段通信仅限于必要的交流。**网络分段**的做法创造了特定的“防水”舱室，限制了威胁行为者横向移动的能力。
- en: '**Multi-factor authentication**: Remote access is a critical component when
    managing even a small enterprise network. However, the issue is that threat actors
    will often use these to their advantage in spreading ransomware. It is advisable
    to have a **multi-factor authentication** (**MFA**) mechanism in place to limit
    the ability of a threat actor to move laterally if they can compromise an administrator
    account.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**多因素认证**：远程访问是管理即使是小型企业网络时的关键组成部分。然而，问题在于，威胁行为者通常会利用这些方式来传播勒索软件。建议实施**多因素认证**（**MFA**）机制，以限制威胁行为者在能够突破管理员账户的情况下横向移动的能力。'
- en: '**Secure backups**: As part of the evolving ransomware threat, we have seen
    groups such as Conti interfere with the ability of organizations to recover from
    a ransomware attack. In the case of Conti, this has included removing the Volume
    Shadow Copy from systems that have been infected. Other groups have even gone
    so far as conducting network discovery to find network-connected **Storage Area
    Networks** (**SANs**) that contained backups and encrypting those as well, essentially
    leaving the organization with no backups. As a result, organizations should assess
    their backup strategy and potentially use offline backups or a cloud solution
    that is in line with their recovery point and recovery time objectives.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全备份**：作为勒索软件威胁不断发展的一个方面，我们已经看到像Conti这样的团体干扰组织从勒索软件攻击中恢复的能力。在Conti的案例中，这包括从已感染的系统中移除卷影复制。其他团体甚至更进一步，进行网络发现，寻找连接网络的**存储区域网络**（**SAN**），并加密其中的备份，实际上使组织无法恢复备份。因此，组织应该评估其备份策略，并可能使用离线备份或符合恢复点和恢复时间目标的云解决方案。'
- en: Prepping the CSIRT
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备CSIRT
- en: 'There are a few additional steps related to ransomware that should be included
    in any incident response plan or playbook. The following are some of the key considerations
    when it comes to responding to ransomware:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些额外的步骤与勒索软件相关，应该包含在任何事件响应计划或行动手册中。以下是应对勒索软件时的一些关键考虑因素：
- en: '**Rapid isolation or containment**: The most significant risk from ransomware
    is how rapidly it can spread. It can take as little as a few hours for the threat
    actor to complete their objective. To counter this, incident responders should
    ensure that containment can be quickly executed on key technologies such as routers,
    switches, and firewalls. The stumbling block of this rapid containment is the
    need to clear decisions with leadership before such actions take place. This increases
    the time necessary to contain the attack. The best option is to, before an incident,
    discuss under what circumstances the network or security team will cut off communications
    between network segments or the internet so that they have the authority to take
    actions to stem the attack.'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**快速隔离或封锁**：勒索软件带来的最大风险是它传播的速度。攻击者可能仅需几小时就能完成他们的目标。为应对这一点，事件响应人员应确保能够快速在关键技术如路由器、交换机和防火墙上执行隔离操作。快速隔离的障碍在于需要在行动之前与领导层确认决策。这会增加隔离攻击所需的时间。最佳的做法是，在事件发生之前讨论在何种情况下网络或安全团队将切断网络段或互联网之间的通信，这样他们便有权限采取措施遏制攻击。'
- en: '**Keep up to date on TTPs**: Ransomware threat actors will continually change
    their TTPs to keep ahead of the preventive and detective technology in use in
    modern enterprises. Some of these changes can be subtle and in other instances
    can manifest as significant changes. In either case, threat intelligence sources
    are critical to understanding the threat, how they operate, and how best to align
    preventive and detective controls.'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**保持对TTP的更新**：勒索软件攻击者会不断改变他们的TTP（战术、技术和程序），以保持领先于现代企业中的预防和侦测技术。这些变化有时可能是微妙的，有时则会表现为显著的变化。在任何情况下，威胁情报来源对于理解威胁、攻击者如何操作以及如何最好地调整预防和侦测控制措施至关重要。'
- en: '**Tabletop exercises**: Finally, one specific action that incident responders
    can take is to craft and facilitate a **tabletop exercise** (**TTX**) for technical
    and leadership that walks through the entire incident life cycle to ensure that
    all units are aligned and key decisions are made before the incident. This ensures
    that actions that are executed during a live incident are preplanned and can decrease
    the time necessary to make key decisions, thereby reducing the incident’s impact.'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**桌面演练**：最后，事件响应人员可以采取的具体行动之一是为技术团队和领导层设计并组织一个**桌面演练**（**TTX**），该演练将涵盖整个事件生命周期，以确保各个单位协调一致，并在事件发生前做出关键决策。这确保了在实际事件中执行的行动是预先计划好的，从而可以减少做出关键决策所需的时间，进而降低事件的影响。'
- en: Eradication and recovery
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 根除与恢复
- en: If a ransomware attack was successful in an organization, it is important to
    have a plan at hand to bring the organization back up and running as quickly as
    possible. Additionally, as we have seen, these attacks are highly sophisticated
    and involve complex malware that can embed itself deep into the operating system.
    This makes ensuring that the threat has been entirely removed from the network
    difficult. As a result, there are specific ways to contain, eradicate, and recover
    from a ransomware incident that can ensure the best possible outcome.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果勒索软件攻击在组织中成功，重要的是要有一个预案，尽快将组织恢复正常运行。此外，正如我们所看到的，这些攻击非常复杂，涉及到深层嵌入操作系统的复杂恶意软件。这使得确保网络中彻底清除威胁变得困难。因此，有一些特定的方法可以隔离、根除并从勒索软件事件中恢复，从而确保最好的结果。
- en: Containment
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 隔离
- en: Containing a ransomware incident involves two major actions. The first is to
    remove the capability of the adversary to exercise C2 over compromised systems.
    Adversaries often use a combination of commercial and open source tools such as
    Cobalt Strike or Metasploit, which use a variety of connection types. The goal
    of the initial investigation involves examining systems to identify the nature
    of the C2 infrastructure and communications so that they can be blocked.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 隔离勒索软件事件涉及两个主要行动。第一个是切断对被攻击系统的C2（指挥与控制）能力。攻击者通常使用商业和开源工具的组合，如Cobalt Strike或Metasploit，这些工具采用各种连接类型。初步调查的目标是检查系统，以确定C2基础设施和通信的性质，从而加以封锁。
- en: The second major action is to remove the ability of the adversary to move laterally
    or to infect additional systems. The key facet of ransomware attacks is the adversary’s
    objective to infect as many systems as possible, thereby increasing the chances
    that a victim will pay the ransom.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个主要措施是切断对手横向移动或感染其他系统的能力。勒索软件攻击的关键特征是对手的目标是尽可能感染更多的系统，从而增加受害者支付赎金的可能性。
- en: Firewall rules
  id: totrans-122
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 防火墙规则
- en: For incidents that are not contained within a LAN segment and have the possibility
    of causing enterprise-wide damage, a firewall rule that removes all internet connections
    should be considered until such time the Command and Control mechanism and its
    associated indicators are identified and a more targeted firewall ruleset can
    be configured. The obvious challenge with this type of containment strategy is
    that critical systems will be adversely impacted. Every situation is different,
    and the specific circumstances should be evaluated before taking this step.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 对于未被局域网段包含且有可能导致整个企业受损的事件，考虑使用一个防火墙规则来切断所有互联网连接，直到识别出指挥与控制机制及其相关指标，并能够配置更具针对性的防火墙规则集。这种类型的遏制策略的明显挑战是关键系统将受到不利影响。每个情况都不同，应该在采取这一步骤之前评估具体情况。
- en: Disabling SMB communication
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 禁用 SMB 通信
- en: Adversaries often make use of the SMB function in a Windows enterprise environment.
    Containing a ransomware incident requires removing this functionality. For example,
    you should disable SMBv1 across the entire enterprise permanently (if enabled).
    You should disable SMBv2/v3 temporarily if an alert or triage investigation suggests
    that the protocol is being utilized for lateral movement. Microsoft recommends
    that SMB v2/3 is not permanently disabled. Further guidance from Microsoft is
    available at [https://support.microsoft.com/en-us/help/2696547/detect-enable-disable-smbv1-smbv2-smbv3-in-windows-and-windows-server](https://support.microsoft.com/en-us/help/2696547/detect-enable-disable-smbv1-smbv2-smbv3-in-windows-and-windows-server).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 对手通常会在 Windows 企业环境中利用 SMB 功能。遏制勒索软件事件需要移除此功能。例如，如果启用了 SMBv1，你应当在整个企业中永久禁用它。如果警报或初步调查显示该协议正在被用于横向移动，你应该暂时禁用
    SMBv2/v3。微软建议不永久禁用 SMB v2/3。有关更多微软的指导，请访问 [https://support.microsoft.com/en-us/help/2696547/detect-enable-disable-smbv1-smbv2-smbv3-in-windows-and-windows-server](https://support.microsoft.com/en-us/help/2696547/detect-enable-disable-smbv1-smbv2-smbv3-in-windows-and-windows-server)。
- en: Disabling administrative shares
  id: totrans-126
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 禁用管理员共享
- en: 'Another target of both network exploitation and ransomware attacks is finding
    and accessing network administrative shares. Fortalice Solutions recommends blocking
    admin shares as they are often used by the adversary to spread files or as a source
    for scripts or commands:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 网络利用和勒索软件攻击的另一个目标是查找和访问网络管理共享。Fortalice Solutions 建议阻止管理员共享，因为对手经常利用这些共享来传播文件，或用作脚本或命令的来源：
- en: '**Option 1**: To block admin shares, a recommended solution is to push out
    a GPO preference that applies to the computers to edit the registry:'
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选项 1**：要阻止管理员共享，推荐的解决方案是推出一个 GPO 偏好设置，应用到计算机上以编辑注册表：'
- en: '[PRE1]'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Create a new `DWORD` value here, named `AutoShareWks`. Leave the value data
    set to Zero. This may require you to restart the host. For further information,
    the following blog provides additional guidance and examples of registry value
    changes: [https://winaero.com/blog/disable-administrative-shares-in-windows-10-windows-8-and-windows-7/](https://winaero.com/blog/disable-administrative-shares-in-windows-10-windows-8-and-windows-7/).'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在此创建一个新的 `DWORD` 值，命名为 `AutoShareWks`，并将值数据设置为零。这可能需要你重新启动主机。欲了解更多信息，以下博客提供了关于注册表值更改的额外指导和示例：[https://winaero.com/blog/disable-administrative-shares-in-windows-10-windows-8-and-windows-7/](https://winaero.com/blog/disable-administrative-shares-in-windows-10-windows-8-and-windows-7/)。
- en: '**Option 2**: From the Windows command line, enter the following:'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选项 2**：从 Windows 命令行输入以下内容：'
- en: '[PRE2]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Disabling admin shares may cause some adverse impacts. The following blog post
    provides some guidance on what to expect when admin shares are missing: [https://support.microsoft.com/en-us/help/842715/overview-of-problems-that-may-occur-when-administrative-shares-are-missing](https://support.microsoft.com/en-us/help/842715/overview-of-problems-that-may-occur-when-administrative-shares-are-missing).'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 禁用管理员共享可能会带来一些不利影响。以下博客文章提供了缺少管理员共享时可能出现的问题的指导：[https://support.microsoft.com/en-us/help/842715/overview-of-problems-that-may-occur-when-administrative-shares-are-missing](https://support.microsoft.com/en-us/help/842715/overview-of-problems-that-may-occur-when-administrative-shares-are-missing)。
- en: Restricting PowerShell use
  id: totrans-134
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 限制PowerShell使用
- en: Adversaries will often make use of PowerShell as part of delivering ransomware.
    Tools such as PowerSploit are configured to exploit PowerShell’s ability to conduct
    a wide range of actions across the enterprise. If PowerShell must be enabled in
    the environment due to dependent third-party applications, ensure legacy PowerShell
    v2 is disabled as it allows runtime bypassing of the constrained language mode
    and the **Antimalware Scan** **Interface** (**AMSI**).
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 对手通常会利用PowerShell作为交付勒索软件的一部分。像PowerSploit这样的工具被配置为利用PowerShell进行企业范围内的各种操作。如果由于依赖的第三方应用程序，必须在环境中启用PowerShell，请确保禁用旧版PowerShell
    v2，因为它允许绕过受限语言模式并绕过**反恶意软件扫描** **接口**（**AMSI**）。
- en: Restricting remote access
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 限制远程访问
- en: Remote access applications such as RDP should be disabled until the incident
    is contained or an MFA solution is in place. RDP can be disabled via GPO. One
    concern that is often voiced at this point by incident responders is that removing
    RDP during an incident may impact their ability to acquire evidence. While this
    may be true, the real impact of leaving RDP enabled can be significant. This is
    where tools and techniques for remote evidence capture are critical – it allows
    the responders to remove the ability for attackers to access other systems while
    also allowing the responders to acquire the necessary evidence.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 远程访问应用程序，如RDP，应在事件得到控制或MFA解决方案到位之前禁用。RDP可以通过GPO进行禁用。在这一点上，事件响应人员常常会提出一个问题，即在事件期间禁用RDP可能会影响他们获取证据的能力。虽然这种担忧是有一定道理的，但保持RDP启用的真正影响可能是相当严重的。这时，远程证据捕获工具和技术就显得尤为关键——它可以让响应人员在阻止攻击者访问其他系统的同时，也能够收集必要的证据。
- en: Eradication
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 根除
- en: Eradication involves removing the threat actor from the network. This includes
    removing any malware the threat actor implanted, any additional tools that were
    used, and any credentials that may have been compromised. While simple in concept,
    the reality of modern ransomware attacks is that they use a variety of persistence
    mechanisms to ensure that the threat actors continue to have access. Additionally,
    much of the data that is on systems is already encrypted.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 根除是指将威胁行为者从网络中移除。这包括移除威胁行为者植入的任何恶意软件、使用的任何附加工具以及任何可能已被泄露的凭证。虽然这一概念看似简单，但现代勒索软件攻击的现实是，它们使用多种持久化机制确保威胁行为者能够继续访问。此外，系统上的许多数据已经被加密。
- en: The challenge for responders is that without a complete and thorough investigation,
    it is difficult to determine how far the threat actors were able to compromise
    systems. For example, RATs associated with ransomware attacks can place persistence
    mechanisms in scheduled tasks or implant scripts in the registry to execute at
    every startup. Completely reverse-engineering the malware will provide this data
    but the best option is to start fresh.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 响应人员面临的挑战是，在没有完全和深入的调查情况下，很难确定威胁行为者能够侵入系统的深度。例如，与勒索软件攻击相关的RATs（远程访问木马）可能会在计划任务中设置持久化机制，或者在注册表中植入脚本以便在每次启动时执行。完全反向工程恶意软件可以提供这些数据，但最佳选项是从头开始。
- en: Removing the threat actor from infected systems often requires a complete rebuild
    from a trusted **Gold Image** or an image that is a known good. The best place
    to start this process is the **Business Continuity Plan** (**BCP**) or **Business
    Resumption Plan** (**BRP**). This outlines how to reconstruct systems from backups
    or reimage and redeploy the image.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 从感染的系统中移除威胁行为者通常需要从受信任的**金镜像**或已知的良好镜像中进行完全重建。开始这一过程的最佳地方是**业务连续性计划**（**BCP**）或**业务恢复计划**（**BRP**）。该计划概述了如何从备份中重建系统或重新制作镜像并重新部署。
- en: Recovery
  id: totrans-142
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 恢复
- en: Recovery operations should be carefully executed to ensure that an infected
    system is not reintroduced into the network. If there is sufficient evidence,
    a full **root cause analysis** (**RCA**) should be conducted before moving to
    the recovery stage. This ensures that all vulnerabilities or system configurations
    that were exploited by the threat actor are discovered and can be corrected as
    part of the process. Further, systems should only be reintroduced upon a clean
    security tool scan with the appropriate security controls that have been updated
    with the IOCs located during the incident.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 应仔细执行恢复操作，以确保感染系统不会重新引入网络。如果有足够的证据，应在进入恢复阶段之前进行全面的**根本原因分析**（**RCA**）。这确保发现并能够根据过程修正威胁行动者利用的所有漏洞或系统配置。此外，只有在经过更新并包含在事件中定位的IOC的适当安全控制的清洁安全工具扫描后，才应重新引入系统。
- en: Recovery operations can be broken down into two broad categories. The first
    of these is eradicating and redeploying systems to the enterprise architecture.
    In [*Chapter 2*](B18571_02.xhtml#_idTextAnchor028), we discussed the architecture
    necessary to recover from an incident.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 恢复操作可以分为两大类。其中之一是根除和重新部署系统到企业架构。在[*第2章*](B18571_02.xhtml#_idTextAnchor028)中，我们讨论了从事故中恢复所需的架构。
- en: Recovery network architecture
  id: totrans-145
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 恢复网络架构
- en: 'In [*Chapter 2*](B18571_02.xhtml#_idTextAnchor028), we examined a sample recovery
    architecture for recovering from an incident. The following is a more detailed
    and technical examination of this recovery method, specifically tailored to ransomware:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在[*第2章*](B18571_02.xhtml#_idTextAnchor028)中，我们审查了一个从事故中恢复的示例恢复架构。以下是对此恢复方法的更详细和技术上的审查，专门针对勒索软件：
- en: 'Configure three separate **Virtual Local Area** **Networks** (**VLANs**):'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置三个单独的**虚拟本地区域网络**（**VLANs**）：
- en: '**Infected VLAN**: This is the network where all infected systems are hosted.
    This can be the production network in circumstances where a large number of systems
    are infected. Ideally, this should be configured as a separate network.'
  id: totrans-148
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**感染VLAN**：这是所有感染系统托管的网络。在大量系统感染的情况下，这可以是生产网络。理想情况下，这应配置为一个单独的网络。'
- en: '**Staging VLAN**: This VLAN is used for incident triage, reimaging, patching,
    security tool installs, and preparing for redeployment:'
  id: totrans-149
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分期VLAN**：这个VLAN用于事故分类、重新映像、打补丁、安装安全工具和准备重新部署：'
- en: The internet should only be enabled for triage, reimaging, software updates,
    and updates to security technology
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网应仅用于事故分类、重新映像、软件更新和安全技术更新
- en: Possibility to enable PXE boot for reimaging
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可能启用PXE引导以进行重新映像
- en: Enable all security tools such as host intrusion detection, antivirus, or endpoint
    detection and response to detect and quarantine any potential malware or exploits
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启用所有安全工具，如主机入侵检测、防病毒软件或终端检测和响应，以检测和隔离任何潜在的恶意软件或攻击
- en: Monitor systems for reinfection before moving to clean them
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在清洁它们之前监视系统以防止重新感染
- en: '**Clean VLAN**:'
  id: totrans-154
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**清洁VLAN**：'
- en: A dully new network with no connection to the “dirty” or “staging” VLANs
  id: totrans-155
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个完全新的网络，与“脏”或“分期”VLAN没有连接
- en: This will likely involve a new local domain
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这可能涉及到一个新的本地域
- en: Only move systems to here when they are proven to be clean
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只有在证明清洁后才将系统移至此处
- en: If a domain controller has been compromised, new domain controllers should be
    built from scratch and a known good backup should be deployed on top.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 如果域控制器已被攻击，应从头开始构建新的域控制器，并部署一个已知的好备份。
- en: Enterprise password reset
  id: totrans-159
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 企业密码重置
- en: 'Many ransomware attacks will impact the domain controllers, along with other
    systems. If the threat actor can identify the domain controller and can compromise
    the `NTDS.DIT` file – the database containing the credentials for the entire enterprise
    – a global password reset will have to be conducted using the following process:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 许多勒索软件攻击将影响域控制器以及其他系统。如果威胁行动者能够识别域控制器并能够破坏包含整个企业凭据的`NTDS.DIT`文件，则将必须使用以下过程进行全局密码重置：
- en: Change the passwords of all accounts in highly privileged groups.
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更改所有高度特权组中账户的密码。
- en: Roll KRBGT twice (https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/manage/ad-forest-recovery-resetting-the-krbtgt-password).
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 两次滚动 KRBGT（https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/manage/ad-forest-recovery-resetting-the-krbtgt-password）。
- en: 'Change the built-in local admin passwords and possibly deny remote login:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更改内置本地管理员密码并可能拒绝远程登录：
- en: Use Microsoft’s **Local Administrator Password Solution** (**LAPS**) to randomize
    the local administrator password on every endpoint to stop lateral movement and
    store it in Active Directory if it’s manually needed
  id: totrans-164
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用微软的**本地管理员密码解决方案**（**LAPS**）随机化每个终端的本地管理员密码，防止横向移动，并在需要时将其存储在 Active Directory
    中。
- en: Force password change on the next login for all general user accounts.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 强制所有普通用户账户在下次登录时更改密码。
- en: Disable the ability of the Windows operating system to cache credentials on
    any device where credentials are not needed ([https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-access-do-not-allow-storage-of-passwords-and-credentials-for-network-authentication](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-access-do-not-allow-storage-of-passwords-and-credentials-for-network-authentication)).
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 禁用 Windows 操作系统在任何不需要凭证的设备上缓存凭证的功能（[https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-access-do-not-allow-storage-of-passwords-and-credentials-for-network-authentication](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-access-do-not-allow-storage-of-passwords-and-credentials-for-network-authentication)）。
- en: Remote access MFA
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 远程访问 MFA
- en: It is highly recommended that any remote access to systems connected to the
    internal network have MFA enabled. Adversaries are continuing to make use of legitimate
    credentials and accessing remote systems that leverage only a single factor.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 强烈建议任何访问连接到内部网络的系统的远程访问启用多因素认证（MFA）。攻击者继续利用合法凭证并访问仅依赖单一身份验证因素的远程系统。
- en: Enhanced logging
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 增强的日志记录
- en: 'When systems are redeployed, there should be increased monitoring. This will
    increase the likelihood that any systems that may have been compromised and not
    properly recovered can be identified before a significant impact. The following
    are some additional monitoring steps for Windows Event and System logs that are
    important to have forwarded to a SIEM or other log management solution:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 当系统重新部署时，应增加监控。这将提高识别任何可能已被攻击并未正确恢复的系统的可能性，从而在造成重大影响之前发现它们。以下是一些需要转发到 SIEM 或其他日志管理解决方案的重要
    Windows 事件和系统日志的附加监控步骤：
- en: Deploy Sysmon where possible (especially on domain controllers or critical systems).
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在可能的情况下部署 Sysmon（特别是在域控制器或关键系统上）。
- en: Enable Security Event Log – Permitted a Connection & Bind to Port (5156, 5158
    Event IDs).
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用安全事件日志 – 允许连接和绑定到端口（5156, 5158 事件 ID）。
- en: Enable Security Event Log – IPC$ Connections (5140,5145 Event IDs).
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用安全事件日志 – IPC$ 连接（5140, 5145 事件 ID）。
- en: 'Ensure that PowerShell version 5 has been deployed across all systems. PowerShell
    version 5 allows for enhanced logging, which can help you identify misuse of PowerShell.
    Logging will need to be configured using Group Policy to the following settings:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保所有系统已部署 PowerShell 版本 5。PowerShell 版本 5 支持增强日志记录，有助于识别 PowerShell 滥用。日志记录需要通过组策略配置以下设置：
- en: 'Turn on Module Logging: Enabled.'
  id: totrans-175
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开启模块日志记录：已启用。
- en: 'Turn on PowerShell Script Block Logging: Enabled.'
  id: totrans-176
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开启 PowerShell 脚本块日志记录：已启用。
- en: 'Turn on Script Execution: Not Configured.'
  id: totrans-177
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开启脚本执行：未配置。
- en: 'Turn on PowerShell Transcription: Enabled.'
  id: totrans-178
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开启 PowerShell 转录：已启用。
- en: 'Set the default source path for Update-Help: Not Configured.'
  id: totrans-179
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置 Update-Help 的默认源路径：未配置。
- en: Local log retention will need to be configured to keep at least 90 days of logs
    present on each server. Logs should forward immediately to the centralized log
    storage system for longer-term retention and analysis.
  id: totrans-180
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本地日志保留需要配置，以确保每台服务器至少保留 90 天的日志。日志应立即转发到集中式日志存储系统，以便进行长期保留和分析。
- en: It is obvious that recovery is a critical component and that organizations may
    want to get this done as quickly as possible. With that being said, this process
    must be systematic and take the threat into account. Not walking through the recovery
    process in a TTX or rushing the processes increases the chance that a still-infected
    system is reintroduced to the network and the ransomware attack will begin again.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，恢复是一个关键组成部分，组织可能希望尽快完成这一过程。话虽如此，恢复过程必须是系统化的，并考虑到威胁。如果在 TTX 中没有按流程走恢复步骤，或者急于完成过程，会增加将仍然感染的系统重新引入网络的风险，从而导致勒索病毒攻击再次发生。
- en: Summary
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Ransomware is a threat that will be around us for the foreseeable future. In
    this chapter, we looked at the history of ransomware, the common TTPs in use by
    threat actors such as Conti, how to align our incident response to that threat,
    and finally how to contain, eradicate, and recover from it. Understanding these
    TTPs gives us insight into how to detect and prevent such attacks. Understanding
    the response element allows us to respond appropriately and limit the impact.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 勒索软件是一种我们在可预见的未来都会面临的威胁。本章中，我们回顾了勒索软件的历史、威胁行为者如Conti常用的TTP（战术、技术和程序）、如何将我们的事件响应与这一威胁对接，以及如何遏制、消除并从中恢复。了解这些TTP可以帮助我们更好地检测和预防此类攻击。理解响应要素使我们能够做出适当的反应，并限制其影响。
- en: In the next chapter, we will examine specific investigative and analysis techniques.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨具体的调查和分析技术。
- en: Questions
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'Answer the following questions to test your knowledge of this chapter:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 回答以下问题，以测试你对本章内容的掌握：
- en: Which threat actor is related to both Ryuk and Conti?
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 哪个威胁行为者与Ryuk和Conti相关？
- en: AtomicSquirrel
  id: totrans-188
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: AtomicSquirrel
- en: BadWitch
  id: totrans-189
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: BadWitch
- en: Wizard Spider
  id: totrans-190
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: Wizard Spider
- en: BlackEnergy
  id: totrans-191
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: BlackEnergy
- en: In the event of a Domain Controller compromise, it is important to perform a
    global password reset.
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在域控制器遭到破坏的情况下，执行全局密码重置非常重要。
- en: 'True'
  id: totrans-193
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 正确
- en: 'False'
  id: totrans-194
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 错误
- en: What is the critical component that drives ransomware?
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 推动勒索软件的关键组件是什么？
- en: Commonly available RATs
  id: totrans-196
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 常见的远程访问木马（RAT）
- en: Cryptocurrency
  id: totrans-197
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加密货币
- en: Commercial penetration testing tools
  id: totrans-198
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 商业渗透测试工具
- en: Poor security hygiene
  id: totrans-199
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不良的安全卫生
- en: Threat actor lateral movement can be inhibited by which of the following?
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下哪项可以抑制威胁行为者的横向移动？
- en: MFA
  id: totrans-201
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: MFA
- en: Limiting RDP
  id: totrans-202
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 限制RDP
- en: Limiting SMB
  id: totrans-203
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 限制SMB
- en: All of the above
  id: totrans-204
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上述所有内容
- en: Further reading
  id: totrans-205
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 深入阅读
- en: 'Refer to the following resources for more details about the topics covered
    in this chapter:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下资源，了解本章涵盖的更多内容：
- en: '*Preventing* *Ransomware*: [https://www.packtpub.com/product/preventing-ransomware/9781788620604](https://www.packtpub.com/product/preventing-ransomware/9781788620604
    )'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*防止* *勒索软件*：[https://www.packtpub.com/product/preventing-ransomware/9781788620604](https://www.packtpub.com/product/preventing-ransomware/9781788620604)'
- en: '*Incident Response Techniques for Ransomware* *Attacks*: https://www.packtpub.com/product/incident-response-techniques-for-ransomware-attacks/9781803240442'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*勒索软件事件响应技巧* *攻击*：[https://www.packtpub.com/product/incident-response-techniques-for-ransomware-attacks/9781803240442](https://www.packtpub.com/product/incident-response-techniques-for-ransomware-attacks/9781803240442)'
