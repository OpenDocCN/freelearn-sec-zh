- en: Chapter 3. Configuring Networking Lab Components
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章 配置网络实验室组件
- en: We have already spent enough time on the preparations for building a lab and
    now it is finally time to actually start building it.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在搭建实验室的准备工作上花费了足够的时间，现在终于是实际开始搭建的时候了。
- en: In this chapter, we will show you the configuration of hardware and virtual
    network devices for both the options of building a lab, so you can easily choose
    the one that fits your needs best.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将展示如何配置硬件和虚拟网络设备，以便搭建实验室的两种选择，您可以轻松选择最适合您需求的方案。
- en: 'The chapter consists of the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包括以下主题：
- en: General lab network communication rules
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通用实验室网络通信规则
- en: Configuring hardware wired devices
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置硬件有线设备
- en: Configuring virtual wired network devices
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置虚拟有线网络设备
- en: Configuring WLANs
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 WLAN
- en: General lab network communication rules
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通用实验室网络通信规则
- en: Network diagrams are a very convenient way to represent a network topology and
    its architecture. They are widely used by nearly all **small or home office**
    (**SOHO**) and enterprise networks. But this representation often lacks a logical
    layer for providing a better understanding of how network components interact
    and in which directions network traffic flows. It is not an easy task to show
    it in a diagram, so network engineers use a bunch of documentation for that purpose,
    mostly combining tables, flowcharts, and diagrams.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 网络图是表示网络拓扑结构及其架构的一个非常方便的方式。几乎所有的**小型或家庭办公室**（**SOHO**）和企业网络都广泛使用这种表示方式。但这种表示通常缺少一个逻辑层，无法更好地理解网络组件如何交互以及网络流量的流向。在图示中展示这些内容并不容易，因此网络工程师通常使用大量文档来实现这一目的，主要是结合表格、流程图和网络图。
- en: 'But as we have a very simple network diagram and a pretty straightforward understanding
    of how network traffic should flow, we can try to depict it as an additional layer
    on our network diagram, as shown in the following diagram:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 但由于我们有一个非常简单的网络图，并且对网络流量的流动方向有非常直观的理解，我们可以尝试将其作为一个附加层描绘在我们的网络图中，如下图所示：
- en: '![General lab network communication rules](../images/00011.jpeg)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![通用实验室网络通信规则](../images/00011.jpeg)'
- en: The network diagram including a logical layer
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 包含逻辑层的网络图
- en: 'To extend the diagram and better explain the target access rules, let''s take
    a look at the additional information on the permitted access in the following
    table:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 为了扩展图示并更好地解释目标访问规则，下面表格中展示了关于允许访问的附加信息：
- en: '| Source | Allowed destination | Purpose |'
  id: totrans-14
  prefs: []
  type: TYPE_TB
  zh: '| 来源 | 允许的目标 | 目的 |'
- en: '| --- | --- | --- |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Admin workstation |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| 管理员工作站 |'
- en: All network devices
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有网络设备
- en: All servers
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有服务器
- en: All user workstations
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有用户工作站
- en: Internet (external network)
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: '| Network and system administration |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| 网络和系统管理 |'
- en: '| Servers |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| 服务器 |'
- en: Internet (external network)
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: '| Software installation and updates |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| 软件安装和更新 |'
- en: '| User workstations |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| 用户工作站 |'
- en: Internet (external network)
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: Servers
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器
- en: '| Internet access, access to the internal network services |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| 互联网访问，访问内部网络服务 |'
- en: '| Trusted WLAN |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| 受信 WLAN |'
- en: Internet (external network)
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: Servers
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器
- en: '| Internet access, access to the internal network services |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| 互联网访问，访问内部网络服务 |'
- en: '| Guest WLAN |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| 客户 WLAN |'
- en: Internet (external network)
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 互联网（外部网络）
- en: '| Internet access |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| 互联网访问 |'
- en: We don't want any access to our lab network from an external network or guest
    WLAN, thus we should not permit it. Also, there is no need to access the user
    subnet from the trusted WLAN and server subnet, so we do not allow it. The last
    rule is that only an administrator should be able to access any services on network
    devices; therefore, we do not allow it to any other lab component.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不希望任何外部网络或客户 WLAN 访问我们的实验室网络，因此我们不允许此类访问。同时，用户子网和受信 WLAN 以及服务器子网之间也无需访问，因此我们不允许它。最后的规则是，只有管理员才能访问网络设备上的任何服务；因此，我们不允许其他实验室组件访问这些服务。
- en: Configuring hardware wired devices
  id: totrans-37
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置硬件有线设备
- en: So, that is enough theory. Now let's proceed with some practice and finally
    configure the network devices.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，理论部分已经足够了。现在让我们进行一些实践，最终配置网络设备。
- en: 'We will configure our routers and switches via console ports using a special
    console cable, which in our case has a RJ-45 connector at one end and a DB-9 connector
    at the other end. You are unlikely to find DB-9 ports on contemporary computers,
    thus we need to have a DB-9-USB adapter cable to be able to connect it to a USB
    port. You can see an example of such a cable and an adapter in the following images
    from the Cisco website:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过控制台端口使用一种特殊的控制台电缆来配置路由器和交换机，在我们这个例子中，电缆一端是 RJ-45 连接器，另一端是 DB-9 连接器。现代计算机上很难找到
    DB-9 端口，因此我们需要一个 DB-9 到 USB 的适配器电缆，以便将其连接到 USB 端口。你可以在以下来自 Cisco 网站的图片中看到这种电缆和适配器的示例：
- en: '![Configuring hardware wired devices](../images/00012.jpeg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![配置硬件有线设备](../images/00012.jpeg)'
- en: The Cisco console cable
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: Cisco 控制台电缆
- en: '![Configuring hardware wired devices](../images/00013.jpeg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![配置硬件有线设备](../images/00013.jpeg)'
- en: The DB-9 to USB adapter
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: DB-9 到 USB 适配器
- en: Tip
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: You might need to install special drivers for using an adapter, so please check
    your adapter's user manual.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能需要安装特殊的驱动程序来使用适配器，因此请检查适配器的用户手册。
- en: 'Alternatively, you can get a console cable with both RJ-45 and USB connectors,
    for example, on eBay ([http://www.ebay.com/](http://www.ebay.com/)):'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，你可以购买带有 RJ-45 和 USB 接口的控制台电缆，例如在 eBay 上（[http://www.ebay.com/](http://www.ebay.com/)）：
- en: '![Configuring hardware wired devices](../images/00014.jpeg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![配置硬件有线设备](../images/00014.jpeg)'
- en: The RJ-45 to USB console cable
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: RJ-45 到 USB 控制台电缆
- en: 'We will also need a terminal software to be able to communicate with devices
    via console ports. On Linux or MAC OS X, you can communicate with a Cisco device
    via its console port using, for example, a software "screen." You just need to
    find the interface name using the `dmesg` command after connecting a cable and
    use it as a parameter for screen utility:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要一个终端软件，以便通过控制台端口与设备进行通信。在 Linux 或 MAC OS X 上，你可以通过其控制台端口与 Cisco 设备进行通信，例如使用“screen”软件。你只需要在连接电缆后，通过
    `dmesg` 命令找到接口名称，并将其作为参数传递给 screen 工具：
- en: '[PRE0]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'In our case, we can see the following message that contains the interface name:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的例子中，我们可以看到以下信息，其中包含接口名称：
- en: '[PRE1]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, we use this name with `screen`:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们使用这个名称和`screen`：
- en: '[PRE2]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: We are able to communicate with a device's console port.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以与设备的控制台端口进行通信。
- en: In Windows, you can use the free PuTTY software. We will show you this variant
    of connection, but all further device configuration steps are the same regardless
    of the OS you are using to communicate with the devices.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows 上，你可以使用免费的 PuTTY 软件。我们将展示这种连接方式，但所有进一步的设备配置步骤是相同的，无论你使用什么操作系统与设备进行通信。
- en: Note
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We will not provide an extended explanation for every configuration step because
    our goal is not to teach you network device administration, but to get a working
    instance to perform our lab tasks. You can get information about any Cisco command
    using the `?` sign with a command name in the terminal, for example, `show ?`.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会为每个配置步骤提供详细的解释，因为我们的目标不是教你网络设备管理，而是让你得到一个可用的实例来执行实验任务。你可以通过在终端中使用命令名称后加上
    `?` 符号，获取任何 Cisco 命令的帮助信息，例如，`show ?`。
- en: Preparing the console connection on Windows
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 Windows 上准备控制台连接
- en: The first step for preparing the console connection on Windows is to determine
    a serial port number to use with the PuTTY software. To do that, you need to turn
    a device on and connect its console port to one of the USB ports on your computer.
    A console port is marked or signed accordingly. Do not get confused and connect
    your console cable to other RJ-45 ports on the router—it will not work as we need
    it to.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 准备 Windows 控制台连接的第一步是确定要与 PuTTY 软件一起使用的串口号。为此，你需要打开设备并将其控制台端口连接到计算机的 USB 端口之一。控制台端口会有相应的标记或指示。不要混淆，将控制台电缆连接到路由器的其他
    RJ-45 端口——这样是无法工作的。
- en: If you have newer device models, they probably have USB console ports that you
    can connect to any of your computer's USB ports with a USB cable (Type A to Type
    mini B). In order to be able to communicate via this cable, you need to install
    a Cisco USB console driver that you can find at the official Cisco website.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是较新的设备型号，它们可能配有 USB 控制台端口，你可以用 USB 电缆（A 型到迷你 B 型）将其连接到计算机的任何 USB 端口。为了能够通过这根电缆进行通信，你需要安装
    Cisco USB 控制台驱动程序，可以在 Cisco 官方网站找到。
- en: 'After connecting a console cable and turning the device on, open **Device Manager**
    in Windows and find the COM and LPT ports in the device tree. Under this branch,
    you can find a USB-to-serial-port device and get a COM port number from it:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 连接控制台电缆并打开设备后，在 Windows 中打开 **设备管理器**，在设备树中找到 COM 和 LPT 端口。在此分支下，您可以找到一个 USB
    到串口设备，并从中获取一个 COM 端口号：
- en: '![Preparing the console connection on Windows](../images/00015.jpeg)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![在 Windows 上准备控制台连接](../images/00015.jpeg)'
- en: Getting COM-port number
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 获取 COM 端口号
- en: 'Now that we know the COM port number, we can open PuTTY and set the **Connection
    type** to **Serial** and the **Serial line** to the right COM port, which is **COM3**
    in our case:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道了 COM 端口号，我们可以打开 PuTTY 并将 **连接类型** 设置为 **串行**，将 **串行线** 设置为正确的 COM 端口，我们这里是
    **COM3**：
- en: '![Preparing the console connection on Windows](../images/00016.jpeg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![在 Windows 上准备控制台连接](../images/00016.jpeg)'
- en: Getting the COM port number
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 获取 COM 端口号
- en: Now, we are ready to connect and communicate with your devices.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经准备好连接并与您的设备通信。
- en: Tip
  id: totrans-69
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: You can also save this connection so you do not need to configure it every time
    you want to work with device consoles.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以保存此连接，这样您就不需要每次想使用设备控制台时都进行配置。
- en: Note
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: During the work on your lab network, you will probably meet some configuration
    challenges. Yes, we provide a pretty detailed manual in this book, but as it usually
    happens in the heterogeneous IT world, one just not simply configure something
    serious using a step-by-step manual. There are always some things that do not
    work or work not in the way you desire. There could be various reasons for that,
    such as different software versions or different hardware, so you should have
    no fear of checking Google for a solution on the Internet. We would say, you should
    appreciate such an opportunity to learn and understand your environment.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的实验网络中工作期间，您可能会遇到一些配置挑战。是的，我们在本书中提供了非常详细的手册，但正如通常在异构的 IT 环境中发生的那样，仅仅按步骤手册配置某些严肃的东西是不太可能的。总会有一些事情不能正常工作或者不按您所期望的方式工作。造成这种情况的原因可能有很多，比如不同的软件版本或不同的硬件，因此您不应害怕在互联网上查找解决方案。我们建议您应该珍惜这样的学习机会，深入了解您的环境。
- en: 'For solving any challenges during your lab installation and maintenance, you
    will need to use two important IOS commands: `logging buffered` and `debug`.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 要解决实验安装和维护过程中的任何挑战，您需要使用两个重要的 IOS 命令：`logging buffered` 和 `debug`。
- en: You can also download and read the official *Cisco IOS Configuration Fundamentals
    Command Reference* from the Cisco website and use it as reference material.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以从 Cisco 网站下载并阅读官方的 *Cisco IOS 配置基础命令参考* 作为参考资料。
- en: Core switch
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 核心交换机
- en: Let's start by installing and configuring our switch, which will serve as our
    network's core and provide basic connectivity between the lab components.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从安装和配置交换机开始，它将作为我们网络的核心，并在实验组件之间提供基本连接。
- en: 'Our switch has 12 ports and we should determine a port layout first. We need
    one physical interface for connecting an external untrusted network, one physical
    interface for a router connection, one physical interface for an admin workstation,
    three interfaces for users, four interfaces for servers, and one interface for
    an access point to establish a trusted WLAN. Let''s summarize it in the following
    table:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的交换机有 12 个端口，我们首先需要确定端口布局。我们需要一个物理接口用于连接外部不受信任网络，一个物理接口用于路由器连接，一个物理接口用于管理工作站，三个用户接口，四个服务器接口和一个接入点接口用于建立受信任的
    WLAN。让我们在以下表格中总结一下：
- en: '| Interface | Connection |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| 接口 | 连接 |'
- en: '| --- | --- |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `fa0/1` | Router |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/1` | 路由器 |'
- en: '| `fa0/2` | External router (network) |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/2` | 外部路由器（网络） |'
- en: '| `fa0/3` | Admin workstation |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/3` | 管理工作站 |'
- en: '| `fa0/4-fa0/6` | User subnet |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/4-fa0/6` | 用户子网 |'
- en: '| `fa0/7-fa0/10` | Server subnet |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/7-fa0/10` | 服务器子网 |'
- en: '| `fa0/11` | Trusted WLAN |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/11` | 受信任的 WLAN |'
- en: Now when you know where to connect what, you can start connecting a router to
    our switch and performing the initial switch configuration.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您知道在哪里连接什么之后，您可以开始将路由器连接到我们的交换机并执行初始交换机配置。
- en: Initial configuration
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 初始配置
- en: In case you are using virtual or new network devices, initial configuration
    can be limited to just setting a hostname with the command `hostname`. But if
    you got used devices (this is very likely if you use it for a lab), there could
    be old configurations saved that you obviously do not need. So that we do not
    unintentionally allow anything unsecure to be enabled or disabled, as the first
    initial configuration step, we are going to erase the current config and revert
    the OS to factory settings.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是虚拟或新的网络设备，初始配置可能仅限于设置主机名，使用命令`hostname`。但如果你使用的是旧设备（如果你用于实验室，这种情况非常可能），可能会有旧的配置被保存，而这些配置显然是不需要的。为了避免无意中启用或禁用任何不安全的功能，作为首次配置的第一步，我们将删除当前配置并将操作系统恢复到出厂设置。
- en: Note
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注
- en: Device configurations could be password-protected by their previous owners and
    you probably do not know those passwords. In that case, you can use a hardware
    switch to factory reset a device. Such a switch often looks like a button with
    a sign "mode." You need to push and hold it for a while to have an effect. Refer
    to the Cisco website for certain device configuration manuals.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 设备配置可能会被之前的拥有者设置了密码，而你可能不知道这些密码。在这种情况下，你可以使用硬件开关将设备恢复到出厂设置。这样的开关通常看起来像一个带有“mode”标志的按钮。你需要按住它一段时间才能生效。有关特定设备配置手册，请参考思科官网。
- en: 'To do this, connect to the device console and first of all get into privileged
    command mode by entering the following command:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，连接到设备控制台，首先通过输入以下命令进入特权命令模式：
- en: '[PRE3]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'You will see that your command invitation ends with a `#` sign which means
    you are in the privileged mode now. Now, we need to start the configuration terminal
    mode with the command:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 你会看到你的命令提示符以`#`符号结尾，这意味着你现在处于特权模式。现在，我们需要通过以下命令启动配置终端模式：
- en: '[PRE4]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Now, erase an old config and revert to a blank one with the following commands:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，使用以下命令擦除旧配置并恢复为空白配置：
- en: '[PRE5]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Reloading an OS will take some time. If you have a cable connected to the device''s
    Ethernet port, the switch will try to load a configuration image from a TFTP Server
    attempting to discover it via multicast messages sent to 255.255.255.255\. Most
    likely, you do not have a TFTP Server reachable and you will see error messages
    in the console similar to the following:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 重新加载操作系统将需要一些时间。如果你有一根电缆连接到设备的以太网端口，交换机会尝试通过多播消息发送到255.255.255.255来从TFTP服务器加载配置镜像。很可能，你没有可访问的TFTP服务器，因此你会在控制台看到类似于以下的错误消息：
- en: '`%Error opening tftp://255.255.255.255/network-confg (Timed out)`'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '`%Error opening tftp://255.255.255.255/network-confg (Timed out)`'
- en: 'After reloading the device, an invitation to start an initial configuration
    dialog should appear. We do not recommend using it if you are not sure what you
    are doing, to avoid any differences in our configuration and yours. But if you
    want to use it, just answer yes or run the command `setup` from the privileged
    mode if the dialog has not appeared. This dialog will guide you through the initial
    configuration with simple questions. Here''s a statement from the official Cisco
    documentation:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 重新加载设备后，应该会出现启动初始配置对话框的提示。如果你不确定自己在做什么，我们不建议使用它，以避免你的配置与我们的配置有所不同。但如果你想使用它，只需回答“是”或在对话框未出现时从特权模式下运行命令`setup`。此对话框将通过简单的问题引导你完成初始配置。以下是思科官方文档中的一段话：
- en: If you make a mistake while using the setup command facility, you can exit and
    run the setup command facility again. Press Ctrl-C, and enter the setup command
    at the privileged EXEC mode prompt.
  id: totrans-100
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 如果你在使用设置命令时出错，你可以退出并重新运行设置命令。按Ctrl-C，并在特权EXEC模式提示符下输入设置命令。
- en: 'To finish our initial configuration, set a hostname for the core switch with
    the following commands:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 为了完成我们的初步配置，请使用以下命令为核心交换机设置主机名：
- en: '[PRE6]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Here, `sw` is your chosen name for the device. Of course, you can choose whichever
    name you like, but we recommend using the same names that we provide in this book
    to avoid possible confusion later.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，`sw`是你为设备选择的名称。当然，你可以选择任何你喜欢的名称，但我们建议使用本书中提供的名称，以避免以后可能的混淆。
- en: Configuring interfaces and VLANs
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置接口和VLAN
- en: As the next step, let's configure the switch's interfaces and virtual local
    area networks to logically separate our lab subnets from each other.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 作为下一步，让我们配置交换机的接口和虚拟局域网，以便将我们的实验室子网在逻辑上彼此隔离。
- en: 'First, we need to determine a VLAN to interface with the layout and assign
    VLAN numbers and names, as shown in the following table:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要确定一个VLAN与接口的布局，并为其分配VLAN号码和名称，如下表所示：
- en: '| Interface | Mode | VLAN number | VLAN name |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| 接口 | 模式 | VLAN号码 | VLAN名称 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| `fa0/1` | trunk | - | - |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/1` | 干道 | - | - |'
- en: '| `fa0/2` | access | 5 | external |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/2` | 接入 | 5 | 外部 |'
- en: '| `fa0/3` | access | 1 | default |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/3` | 接入 | 1 | 默认 |'
- en: '| `fa0/4-fa0/6` | access | 3 | users |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/4-fa0/6` | 接入 | 3 | 用户 |'
- en: '| `fa0/7-fa0/11` | access | 2 | servers |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/7-fa0/11` | 接入 | 2 | 服务器 |'
- en: '| `fa0/12` | access | 4 | trusted_wlan |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| `fa0/12` | 接入 | 4 | 受信任的无线局域网 |'
- en: Note
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: In Cisco networks, the trunk mode allows a port to transfer traffic of any VLAN
    accessible on a device opposite to an access mode which transfers traffic only
    for one VLAN assigned to it.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 在思科网络中，干道模式允许端口传输设备上任何可访问的VLAN的流量，而接入模式则只传输分配给该端口的单一VLAN的流量。
- en: Now, let's implement it as a switch configuration.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们将其作为交换机配置来实现。
- en: 'Start with sequentially entering the privileged and config modes if you are
    not in yet, and then define your VLAN numbers and names with the following console
    commands:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你还没有进入特权模式和配置模式，可以按顺序输入相应命令，然后使用以下控制台命令定义你的VLAN号码和名称：
- en: '[PRE7]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'After defining VLANs, we need to set interfaces to the right modes, give them
    descriptions, assign VLAN numbers, and turn them on. We do so using the following
    commands:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 定义VLAN之后，我们需要将接口设置为正确的模式，给它们添加描述，分配VLAN号码，并开启接口。我们可以使用以下命令实现：
- en: '[PRE8]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Tip
  id: totrans-122
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'If you have accidentally set wrong interface configs, you can easily remove
    them by executing the same command with a preceding `no` statement, for example,
    consider the following command:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不小心设置了错误的接口配置，可以通过在相同命令前加上`no`来轻松删除它们。例如，考虑以下命令：
- en: '[PRE9]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'It can be cancelled with the following command:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过以下命令取消配置：
- en: '[PRE10]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Once you have configured VLANs, you can use the commands `show vlan` and `show
    interfaces` to review your configuration. To see the whole configuration, use
    the command `show running-config`.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你配置了VLAN，你可以使用命令 `show vlan` 和 `show interfaces` 来查看你的配置。要查看整个配置，使用命令 `show
    running-config`。
- en: Tip
  id: totrans-128
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'Play with the show command: enter `show ?` and try various commands from the
    displayed list to see various configuration parameters.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 玩转show命令：输入 `show ?`，并尝试从显示的列表中选择各种命令，以查看不同的配置参数。
- en: At the moment, we have a basic working config and we can connect other lab components
    to the core switch, but it is wise to do some basic hardening before as we are
    building a secure lab.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我们已经有了一个基本的工作配置，可以将其他实验室组件连接到核心交换机，但由于我们正在搭建一个安全的实验室，建议在此之前进行一些基本的加固。
- en: 'There are two main purposes of hardening the core switch: protecting our lab
    from external malicious activity and preparing the switch for practicing advanced
    attack techniques. We will show you some basic hardening steps, but we recommend
    you to go further and use the official Cisco IOS device hardening guide available
    at their website:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 加固核心交换机的主要目的是：保护我们的实验室免受外部恶意活动，并为练习高级攻击技术做准备。我们将向你展示一些基本的加固步骤，但建议你进一步参考思科官网提供的正式的IOS设备加固指南：
- en: '[http://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html](http://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html)'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html](http://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html)'
- en: 'Let''s start hardening by setting a password for the privileged mode with the
    following command in the configuration mode (`config t`):'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过在配置模式（`config t`）中使用以下命令设置特权模式密码来开始加固：
- en: '[PRE11]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You can change `secret_password` to your desired password.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以将 `secret_password` 更改为你想要的密码。
- en: 'Next, we need to disable **Cisco Discovery Protocol** (**CDP**) on the interface
    connected to an external network (`fa0/2`):'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要在连接到外部网络的接口（`fa0/2`）上禁用**思科发现协议**（**CDP**）：
- en: '[PRE12]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This will limit the information broadcast about our network devices to an external
    untrusted network.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这将限制关于我们网络设备的信息广播到外部的不受信任网络。
- en: 'To save a new configuration and prevent it from being deleted after rebooting
    the device, we need to copy the running configuration to the startup configuration:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保存新的配置并防止其在重启设备后被删除，我们需要将运行配置复制到启动配置：
- en: '[PRE13]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Now, we have a functioning lab network core and we can proceed to configuring
    our router.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经搭建了一个功能齐全的实验室网络核心，接下来可以开始配置我们的路由器。
- en: Hardening the core switch
  id: totrans-142
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 加固核心交换机
- en: Our gateway (that is our core router at the same time) should perform routing
    between subnets, allowing the lab components to communicate with each other. It
    also should provide a DHCP service for the user subnet and the trusted WLAN and
    perform network address translation many-to-one for Internet (external network)
    access.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的网关（同时也是我们的核心路由器）应该在子网之间进行路由，使得实验室组件能够互相通信。它还应该为用户子网和受信WLAN提供DHCP服务，并为互联网（外部网络）访问执行多对一的网络地址转换（NAT）。
- en: 'As with every network device, we are going to start with the initial configuration.
    This is similar to the one we have done for the core switch. In this case, we
    just need to connect the router''s port `fa0/0` with the switch''s port `fa0/1`
    using an Ethernet cable, revert router configs to blank, and set a hostname `gw`:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 和所有网络设备一样，我们将从初始配置开始。这与我们为核心交换机所做的配置类似。在这种情况下，我们只需要使用以太网电缆将路由器的端口`fa0/0`与交换机的端口`fa0/1`连接，恢复路由器的配置为空白，并设置主机名`gw`：
- en: '[PRE14]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Tip
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'You can always save a configuration using the same command as for the core
    switch: `copy running-config startup-config`.'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用与核心交换机相同的命令保存配置：`copy running-config startup-config`。
- en: 'At this point, we are ready to configure the prerequisites for the router''s
    main functionality: subinterfaces and subnets.'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我们已经准备好配置路由器的主要功能所需的先决条件：子接口和子网。
- en: Configuring subinterfaces and subnets
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置子接口和子网
- en: 'In our lab, we are implementing the router-on-a-stick scheme to allow all internal
    subnets to be served by only one FastEthernet router interface. To do this, we
    need to create subinterfaces of the interface `fa0/0` for each VLAN in our network
    and assign IP addresses to them. The gateway will have the IP address with the
    last octet equal to 1 in every subnet:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的实验室中，我们正在实现“路由器在一个接口”方案，以便所有内部子网都通过一个FastEthernet路由器接口提供服务。为此，我们需要为网络中的每个VLAN创建`fa0/0`接口的子接口，并为它们分配IP地址。网关将在每个子网中具有最后一个八位字节等于1的IP地址：
- en: '[PRE15]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Note
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When we are in the interface configuration mode after entering the command `interface
    f...`, we need to first set an encapsulation mode and only after that set an IP
    address and a network mask, otherwise we get an error.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们进入接口配置模式（输入命令`interface f...`后），我们需要首先设置封装模式，只有在此之后才设置IP地址和子网掩码，否则会出现错误。
- en: 'After finishing the configuration of subinterfaces, let''s activate the parent
    interface to activate all subinterfaces:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 完成子接口配置后，让我们激活父接口以激活所有子接口：
- en: '[PRE16]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now, we can type the command `end` to exit the configuration mode and then
    check our resulting interface configs by entering the following command:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以输入命令`end`退出配置模式，然后通过输入以下命令来检查我们的结果接口配置：
- en: '[PRE17]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We should see a list like this:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到类似这样的列表：
- en: '![Configuring subinterfaces and subnets](../images/00017.jpeg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![配置子接口和子网](../images/00017.jpeg)'
- en: The interface status in a terminal window
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 终端窗口中的接口状态
- en: We can see all our subinterfaces along with their new IP addresses and states
    from the preceding listing.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以从之前的列表中看到所有子接口以及它们的新IP地址和状态。
- en: Configuring auxiliary services
  id: totrans-162
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置辅助服务
- en: 'After configuring router''s subinterfaces, it is time to set up a DHCP server
    on our router for the user subnet and trusted WLANs:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 配置完路由器的子接口后，是时候为我们的用户子网和受信WLAN设置DHCP服务器了：
- en: '[PRE18]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Next, let's configure NAT on the gateway so the lab network components can access
    external networks for downloading software updates, DNS resolution, e-mail exchange,
    and so on.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们在网关上配置NAT，以便实验室网络组件可以访问外部网络，以便下载软件更新、DNS解析、电子邮件交换等。
- en: 'First, we need to identify the inside and outside NAT interfaces. We want to
    provide Internet access only to our users, admin, and servers, that is, VLANs
    1 to 4 and the router subinterfaces `fa0/0.1`, `fa0/0.2`, `fa0/0.3`, and `fa0/0.4`,
    respectively. These are our inside interfaces:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要确定内外NAT接口。我们希望仅为我们的用户、管理员和服务器提供Internet访问，即VLANs 1至4以及路由器的子接口`fa0/0.1`、`fa0/0.2`、`fa0/0.3`和`fa0/0.4`。这些是我们的内部接口：
- en: '[PRE19]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'An outside interface is one which is connected to an external network and this
    is `fa0/0.5` in our case. This interface obtains its IP address from an external
    authority via DHCP:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 外部接口是连接到外部网络的接口，在我们的情况下是`fa0/0.5`。该接口通过DHCP从外部授权机构获取其IP地址：
- en: '[PRE20]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Tip
  id: totrans-170
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If you have trouble with the NAT configuration, you can activate the debugging
    mode for NAT with the command `debug ip nat` to be able to track the source of
    your problem and fix it.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在 NAT 配置中遇到问题，可以通过命令 `debug ip nat` 激活 NAT 调试模式，以便追踪问题源并解决它。
- en: Additionally, the command `show ip nat translations` can also be helpful.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，命令 `show ip nat translations` 也可以提供帮助。
- en: Next, let's configure a DNS service on the gateway. We will enable the DNS role
    and set Google's DNS server with the IP address 8.8.8.8 as our external name server.
    If you build a lab in a corporate network, you can use the IP address of your
    corporate DNS servers.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们在网关上配置 DNS 服务。我们将启用 DNS 角色并设置 Google 的 DNS 服务器，IP 地址为 8.8.8.8，作为我们的外部名称服务器。如果你在公司网络中构建实验室，可以使用公司
    DNS 服务器的 IP 地址。
- en: 'DNS role configuration can be performed in two steps:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: DNS 角色配置可以分为两步：
- en: 'Enable the role on the router and allow domain lookup with the following commands
    in the configuration mode:'
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在配置模式下启用路由器上的角色，并允许域名查找，使用以下命令：
- en: '[PRE21]'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Assign upstream name servers from which our router will get DNS information
    for requests to the Internet (insert the IP address of your preferred named server
    or add another with the same command):'
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 分配上游名称服务器，供我们的路由器获取 DNS 请求的互联网信息（插入你首选的命名服务器的 IP 地址，或使用相同命令添加其他服务器）：
- en: '[PRE22]'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Tip
  id: totrans-179
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: 'If you want to assign domain names to your servers or any other hosts in the
    lab network to be able to address them by name instead of IP address, you can
    do so with the following additional command for every host (change the name and
    IP according to your need): `gw(config)# ip host admin 10.1.0.30`.'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想为服务器或实验室网络中的其他主机分配域名，以便通过名称而非 IP 地址来访问它们，可以使用以下附加命令为每个主机配置（根据需要更改名称和 IP
    地址）：`gw(config)# ip host admin 10.1.0.30`。
- en: Basic gateway hardening
  id: totrans-181
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 基本网关加固
- en: 'The router is responsible for the communication control between our lab and
    the external untrusted network, which is assigned to VLAN 5 on the subinterface
    `fa0/0.5`. Thus we have to apply some hardening to the router and this interface.
    As a router-level security feature, we will utilize **access control lists** (**ACLs**)
    (we will talk about this later in [Chapter 5](part0038_split_000.html#147LC2-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 5. Implementing Security"), *Implementing Security*) and password protection
    for a privileged mode:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 路由器负责控制我们实验室与外部不可信网络之间的通信，该路由器被分配到 VLAN 5 并配置在子接口 `fa0/0.5` 上。因此，我们必须对路由器和该接口进行一些加固。作为路由器级的安全特性，我们将使用**访问控制列表**（**ACL**）（稍后我们将在[第
    5 章](part0038_split_000.html#147LC2-3ecab517ca6e4afbb3c20ab15f7b4d82 "Chapter
    5. 实施安全")，*实施安全*中讨论）和特权模式的密码保护：
- en: '[PRE23]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Next, let''s harden the security of the external facing subinterface `fa0/0.5`
    by disabling unnecessary and potentially dangerous services. Get into the configuration
    mode of the interface:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们通过禁用不必要的、潜在危险的服务来加固外部连接子接口 `fa0/0.5` 的安全性。进入该接口的配置模式：
- en: '[PRE24]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Let''s disable CDP and HSRP to reduce the attack surface and information disclosure
    about our devices to the untrusted subnet and enter the following commands:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们禁用 CDP 和 HSRP，以减少设备暴露给不可信子网的攻击面和信息泄露，并输入以下命令：
- en: '[PRE25]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: The first command explicitly disables CDP which can broadcast valuable information
    about our device to the untrusted network.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 第一条命令显式禁用 CDP，它可能会将设备的有价值信息广播到不可信的网络。
- en: The second and third commands explicitly disable **Hot Standby Routing Protocol**
    (**HSRP**) and **Virtual Router Redundancy Protocol** (**VRRP**), which could
    be used to carry out attacks from on untrusted network.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 第二条和第三条命令显式禁用 **热备份路由协议**（**HSRP**）和 **虚拟路由器冗余协议**（**VRRP**），这些协议可能被用来进行来自不可信网络的攻击。
- en: 'As the last step in router configuration, save the changes so that you do not
    lose them:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 作为路由器配置的最后一步，保存更改，以防丢失设置：
- en: '[PRE26]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Configuring virtual wired network devices
  id: totrans-192
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置虚拟有线网络设备
- en: Now, let's consider how we can implement our lab network using virtual devices.
    The logical topology will be exactly the same as the network topology described
    earlier (implemented on hardware devices) and have the same addressing. The main
    resources will be deployed in virtual machines on a single-host high-performance
    computer. For virtualization resources, we will use the free multiplatform software
    GNS3 and VirtualBox.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '现在，让我们考虑如何使用虚拟设备来实现我们的实验室网络。逻辑拓扑将与之前描述的网络拓扑完全相同（在硬件设备上实现），并且具有相同的寻址。主要资源将部署在单主机高性能计算机上的虚拟机中。对于虚拟化资源，我们将使用免费的跨平台软件GNS3和VirtualBox。  '
- en: To start off, we need a high-performance computer with the correct operating
    system. In our case, it will be a laptop with an i7 x64 processor, 8 GB RAM, and
    running operating system Windows 8.1.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: '首先，我们需要一台高性能的计算机，并且操作系统正确。在我们的案例中，它将是一台配备i7 x64处理器、8 GB内存，运行Windows 8.1操作系统的笔记本电脑。  '
- en: Network virtualization platform
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络虚拟化平台
- en: '**Graphical Network Simulator** (**GNS3**) is a platform for experiments, tests,
    demonstrations, and learning network technologies. GNS3 is a cross-platform tool
    and works on Windows, Linux, and Mac OS X. It has a convenient graphic interface
    and essentially is a GUI for Dynamips. Dynamips is a software emulator for Cisco
    routers, which allows us to emulate the hardware of router, loading, and interacting
    with real images of Cisco IOS. Dynamips supports the following platforms:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '**图形网络模拟器**（**GNS3**）是一个用于实验、测试、演示和学习网络技术的平台。GNS3是一个跨平台工具，支持Windows、Linux和Mac
    OS X。它具有便捷的图形界面，本质上是Dynamips的图形用户界面。Dynamips是一个思科路由器的软件模拟器，它允许我们模拟路由器的硬件，加载并与思科IOS的真实镜像交互。Dynamips支持以下平台：  '
- en: 1700 (1710-1760)
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '1700（1710-1760）  '
- en: 2600 (2610-2650 XM)
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '2600（2610-2650 XM）  '
- en: '2691'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '2691  '
- en: 3600 (3620, 3640, 3660)
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '3600（3620, 3640, 3660）  '
- en: '3725'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '3725  '
- en: '3745'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '3745  '
- en: 7200 (from NPE-100 to NPE-G1)
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '7200（从NPE-100到NPE-G1）  '
- en: 'As a virtualization platform, GNS has some disadvantages. The most critical
    limitations are as follows:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '作为一个虚拟化平台，GNS存在一些缺点。最关键的限制如下：  '
- en: '**Highly demanding for CPU and memory**: 10 routers will seriously load the
    PC. The CPU usage can be reduced through the "idle PC" mechanism, which will be
    described later in the *Network topology implementation* section.'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对CPU和内存的要求很高**：10个路由器会严重加载PC。CPU使用率可以通过“空闲PC”机制降低，稍后在*网络拓扑实现*部分会详细描述。  '
- en: '**Weak L2 support**: There is no full emulation of network switches, only routers.
    But it is possible to set access/trunk ports and set switch modules with limited
    L2 functionality routers.'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**L2支持较弱**：没有完全的网络交换机仿真，仅支持路由器。但可以设置接入/中继端口，并且可以配置具有有限L2功能的路由器交换模块。  '
- en: But despite these limitations, a test lab can be built on the GNS engine.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: '但尽管存在这些限制，仍然可以在GNS引擎上构建测试实验室。  '
- en: Since GNS is a virtual router, it needs an image of Cisco IOS (or other) router
    operating system to function. You can obtain Cisco IOS images from the Cisco website,
    if you have an account with the necessary rights, or you can download them from
    the Internet. Another option is to download images from respective hardware equipment,
    if you have access to them.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '由于GNS是一个虚拟路由器，它需要一个思科IOS（或其他）路由器操作系统的镜像才能运行。如果你有必要权限的Cisco账号，可以从Cisco网站获取IOS镜像，或者你也可以从互联网下载。另一种选择是从相关硬件设备上下载镜像，如果你有访问权限的话。  '
- en: Software installation
  id: totrans-209
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '软件安装  '
- en: 'First of all, we need to download the current version of GNS3 from the official
    website [https://www.gns3.com/](https://www.gns3.com/) after a simple registration
    procedure. After downloading the installation file (it should be named like `GNS3-1.4.4-all-in-one.exe`),
    just run it. The installation process is straightforward. This is a common process
    with the welcome screen, the license agreement window, and finally the checklist
    of components that will be installed. The GNS3 installation package comes with
    a set of necessary third-party software and if you are installing it from scratch,
    then leave it all. If some of them are already installed, you can uncheck those
    components:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: '首先，我们需要从官方网站[https://www.gns3.com/](https://www.gns3.com/)下载当前版本的GNS3，并完成简单的注册程序。下载安装文件后（文件名应类似于`GNS3-1.4.4-all-in-one.exe`），只需运行该文件。安装过程非常简单。该过程通常包括欢迎屏幕、许可证协议窗口，以及最后将要安装的组件清单。GNS3安装包包含了一套必要的第三方软件，如果你是全新安装，可以保留所有的默认选项。如果某些组件已经安装，你可以取消勾选那些组件：  '
- en: '![Software installation](../images/00018.jpeg)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![软件安装](../images/00018.jpeg)  '
- en: GNS3 components
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 'GNS3组件  '
- en: After several clicks on the **Next** button, we will have a working network
    virtualization platform.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**下一步**按钮几次后，我们将拥有一个正常工作的网络虚拟化平台。
- en: 'In our case, we are using Microsoft Windows 8.1 as a host operating system,
    so the installation process flows as described. But GNS3 is a multiplatform software,
    so you can also use it on Linux systems where the installation process is different
    but simple too. For example, GNS3 is available in repositories of Ubuntu or Debian
    and to install it you should just execute the command:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的案例中，我们使用的是Microsoft Windows 8.1作为宿主操作系统，因此安装过程按照所述流程进行。但GNS3是一个跨平台软件，因此你也可以在Linux系统上使用它，尽管安装过程不同，但同样简单。例如，GNS3在Ubuntu或Debian的仓库中可用，只需执行以下命令即可安装：
- en: '[PRE27]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Note
  id: totrans-216
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'If you want to install GNS3 on Mac OS X, you can find a detailed installation
    guide at the official website: [https://gns3.com/support/docs/quick-start-guide-for-mac-users](https://gns3.com/support/docs/quick-start-guide-for-mac-users).'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想在Mac OS X上安装GNS3，可以在官方网站找到详细的安装指南：[https://gns3.com/support/docs/quick-start-guide-for-mac-users](https://gns3.com/support/docs/quick-start-guide-for-mac-users)。
- en: Initial configuration
  id: totrans-218
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 初始配置
- en: So, it is time for starting and configuring our virtualization platform. For
    that purpose, let's find the shortcut for GNS3 on the desktop and execute it.
    When the application starts, you'll be prompted to save a new project.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是启动和配置虚拟化平台的时候了。为此，让我们在桌面上找到GNS3的快捷方式并执行它。当应用程序启动时，系统会提示你保存一个新项目。
- en: 'After entering the name of the project, the application will open a working
    user interface of our virtual environment:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 输入项目名称后，应用程序将打开我们的虚拟环境工作用户界面：
- en: '![Initial configuration](../images/00019.jpeg)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![初始配置](../images/00019.jpeg)'
- en: The GNS3 user interface
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: GNS3用户界面
- en: To set up the program, let's go to **Edit** | **Preferences**. Now, we can configure
    the working environment for own convenience. In the **General** tab, we can choose
    the paths for saving working files, the styles and display settings of the interface,
    and the most important thing at this tab is the console emulation software and
    its settings. But since we are using Microsoft Windows as the host OS, we leave
    the defaults (PuTTY). In the **Server** tab, we can change the server component
    parameters of GNS3, for example, the connection parameters of a remote server.
    But at this step, we leave defaults. In the **Packet capture** tab, we can configure
    our connection to the network traffic analyzer. In the **VPCS** tab, we can choose
    how to use host stubs. Host stubs can be used to validate network schema (for
    example, `ping`, `tracert`, and so on). The default application is installed with
    GNS3\. Here, we can leave the default settings. In the **VirtualBox** tab, we
    should set paths to the VirtualBox management application (`VBoxManage.exe`).
    We won't use the tabs **IOS on Unix** and **QEMU** in our lab, so we will leave
    these tabs without changes too.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置程序，让我们进入**编辑** | **首选项**。现在，我们可以根据自己的需要配置工作环境。在**常规**标签页中，我们可以选择保存工作文件的路径、界面的样式和显示设置，最重要的是此标签页中的控制台仿真软件及其设置。但由于我们使用的是Microsoft
    Windows作为宿主操作系统，我们保持默认设置（PuTTY）。在**服务器**标签页中，我们可以更改GNS3的服务器组件参数，例如远程服务器的连接参数。但在这一步，我们保持默认设置。在**数据包捕获**标签页中，我们可以配置与网络流量分析器的连接。在**VPCS**标签页中，我们可以选择如何使用主机存根。主机存根可以用来验证网络架构（例如，`ping`、`tracert`等）。默认应用程序随GNS3一起安装。在这里，我们可以保留默认设置。在**VirtualBox**标签页中，我们应设置VirtualBox管理应用程序（`VBoxManage.exe`）的路径。在我们的实验中，我们不会使用**IOS
    on Unix**和**QEMU**标签页，因此我们也不做更改。
- en: 'What we need to do now is to add the Cisco IOS images in the list of used devices
    (if we have already obtained IOS images). This can be done in the **Dynamips**
    tab. At this step, we need to create two virtual devices: switch and gateway.
    After clicking on the **New** button, it will start the wizard for creating a
    virtual device. In the beginning, we are invited to enter the path to the IOS
    image file. After that, the image file will be decompressed and will be followed
    by a series of questions about the device. The specification of the platform should
    be recognized automatically. RAM should be left at the default value. On the **Network
    adapters** page, you should select the adapters that will be used and their slots.'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在需要做的是将 Cisco IOS 镜像添加到已使用设备列表中（如果我们已经获取了 IOS 镜像）。这可以在**Dynamips**选项卡中完成。在这一步，我们需要创建两个虚拟设备：交换机和网关。点击**新建**按钮后，将启动虚拟设备创建向导。开始时，我们需要输入
    IOS 镜像文件的路径。之后，镜像文件将被解压，接着会出现一系列关于设备的问题。平台的规格应自动识别。RAM 应保持默认值。在**网络适配器**页面中，您应选择将要使用的适配器及其插槽。
- en: For the virtual switch device, we should select the switched network adapter.
    In GNS3, it is NM-16ESW. In our case, we use slot 0\. You can choose another,
    but we recommend you to use the same one to match with the *hardware configuration*
    case described earlier. For the virtual gateway device, we should select the interface
    with 1 port, for example, NM-1FE-TX, and put it in slot 0.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 对于虚拟交换机设备，我们应该选择交换网络适配器。在 GNS3 中，它是 NM-16ESW。在我们的案例中，我们使用插槽 0。您可以选择其他插槽，但我们建议使用与之前描述的*硬件配置*一致的插槽。对于虚拟网关设备，我们应该选择带有
    1 个端口的接口，例如 NM-1FE-TX，并将其放入插槽 0。
- en: 'The last thing to address is the **Idle PC** value; at this step, leave this
    field blank:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 最后需要处理的是**空闲 PC**值；在这一步，保持该字段为空：
- en: '![Initial configuration](../images/00020.jpeg)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![初始配置](../images/00020.jpeg)'
- en: Virtual IOS devices
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟 IOS 设备
- en: So, after these manipulations, we will have two virtual Cisco IOS instances
    in the list of available devices.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，经过这些操作后，我们将在可用设备列表中看到两个虚拟的 Cisco IOS 实例。
- en: Network topology implementation
  id: totrans-230
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 网络拓扑实现
- en: 'Next, let''s implement our network topology in the GNS3 workspace. The process
    of designing a network diagram is similar to any other designing system: select
    device icons and drag them to the workspace. After that, connect network interfaces
    of the devices with each other using the **Add a link** tool.'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们在 GNS3 工作区中实现我们的网络拓扑。设计网络图的过程类似于其他任何设计系统：选择设备图标并将其拖到工作区中。然后，使用**添加连接**工具将设备的网络接口相互连接。
- en: 'In our case, the result is similar to the following screenshot:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的案例中，结果类似于以下截图：
- en: '![Network topology implementation](../images/00021.jpeg)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![网络拓扑实现](../images/00021.jpeg)'
- en: The network diagram
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 网络拓扑图
- en: Now, we use stubs **VPCS** as hosts. The switch and the router are our Cisco
    IOS devices created earlier based on IOS images for Dynamips. For connections
    with a SOHO router and a hardware AP, we use the tool called **Cloud**.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们使用存根**VPCS**作为主机。交换机和路由器是我们之前基于 Dynamips 的 IOS 镜像创建的 Cisco IOS 设备。与 SOHO
    路由器和硬件 AP 的连接，我们使用一个叫做**Cloud**的工具。
- en: 'To match with the *hardware configuration* case described earlier, connections
    between interfaces should be as follows:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 为了与之前描述的*硬件配置*一致，接口之间的连接应如下所示：
- en: '| Functional group | Connection type | Device | Interface |'
  id: totrans-237
  prefs: []
  type: TYPE_TB
  zh: '| 功能组 | 连接类型 | 设备 | 接口 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-238
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| Servers | `Ethernet0` | SW | `F0/7` to `F0/10` |'
  id: totrans-239
  prefs: []
  type: TYPE_TB
  zh: '| 服务器 | `Ethernet0` | SW | `F0/7` 到 `F0/10` |'
- en: '| User hosts | `Ethernet0` | SW | `F0/4` to `F0/6` |'
  id: totrans-240
  prefs: []
  type: TYPE_TB
  zh: '| 用户主机 | `Ethernet0` | SW | `F0/4` 到 `F0/6` |'
- en: '| Management | `Ethernet0` | SW | `F0/3` |'
  id: totrans-241
  prefs: []
  type: TYPE_TB
  zh: '| 管理 | `Ethernet0` | SW | `F0/3` |'
- en: '| Cloud | `nio_gen_eth:Ethernet` | SW | `F0/2` |'
  id: totrans-242
  prefs: []
  type: TYPE_TB
  zh: '| Cloud | `nio_gen_eth:Ethernet` | SW | `F0/2` |'
- en: '| GW | `FastEthernet0/0` | SW | `F0/1` |'
  id: totrans-243
  prefs: []
  type: TYPE_TB
  zh: '| GW | `FastEthernet0/0` | SW | `F0/1` |'
- en: After all the components are placed in the project workspace, we need to fill
    in the field **Idle PC** of our IOS devices. The parameter **Idle PC** allows
    us to significantly reduce the CPU usage, but it can be changed only if the device
    is running. Thus we need to start these network devices by clicking on the button
    **Start devices** placed on the toolbar of the main window, or by clicking on
    the item **Start** in the context menu of the device. For each IOS device, we
    need to select the item **Idle PC** in the context menu and in appeared dialog
    we should select the value marked by an asterisk.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 在将所有组件放入项目工作区后，我们需要填写 IOS 设备的 **Idle PC** 字段。**Idle PC** 参数可以显著降低 CPU 使用率，但只有在设备运行时才能更改。因此，我们需要通过点击主窗口工具栏上的
    **Start devices** 按钮，或通过点击设备上下文菜单中的 **Start** 项目来启动这些网络设备。对于每个 IOS 设备，我们需要在上下文菜单中选择
    **Idle PC** 项目，在弹出的对话框中选择标有星号的值。
- en: Switch
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 交换机
- en: Interaction with the device is performed via the console. For this, we just
    need to right-click on the device icon in the project workspace and select **Console**
    from the context menu. After that, the terminal emulator will be launched with
    the established connection.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 与设备的交互通过控制台进行。为此，我们只需要右键点击项目工作区中的设备图标，并从上下文菜单中选择 **Console**。之后，终端仿真器将启动并建立连接。
- en: 'So, let''s create the config for our core switch. First of all, we set the
    hostname:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，让我们为我们的核心交换机创建配置。首先，我们设置主机名：
- en: '[PRE28]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Then we create the VLANs:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们创建 VLAN：
- en: '[PRE29]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'In the next step, we set up the interfaces, set one trunk port to the router,
    and set the access ports for network hosts:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，我们设置接口，设置一个连接到路由器的中继端口，并为网络主机设置接入端口：
- en: '[PRE30]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: As you can see, the work with the virtual network device corresponds to the
    work with the hardware configuration case; there is a little difference in the
    way how physical devices are connected to each other.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，虚拟网络设备的操作与硬件配置的操作相对应；物理设备连接方式略有不同。
- en: If you work with virtual network devices, it is not so important to properly
    harden them like hardware devices.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用虚拟网络设备，像硬件设备那样对其进行适当的加固并不是那么重要。
- en: Gateway
  id: totrans-255
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网关
- en: 'There is no significant difference in configuring hardware and virtual devices;
    therefore, we do the same as we did in the case of hardware configuration:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 配置硬件和虚拟设备没有显著差异；因此，我们采取与硬件配置相同的方式：
- en: '[PRE31]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Virtual host emulation
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟主机仿真
- en: Now, we need to check our virtual network's working capacity with host emulators.
    We will show you how to connect VirtualBox VMs to the virtual network in the next
    chapter, but at the moment the functionality of emulators is enough for testing
    purposes.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要检查虚拟网络与主机仿真器的工作状态。我们将在下一章向你展示如何将 VirtualBox 虚拟机连接到虚拟网络，但目前仿真器的功能已足够用于测试目的。
- en: 'Such emulators are already provided by GNS; they are stubs of the type **VPCS**.
    These virtual devices allow us to perform basic operations for emulating real
    devices based on IP connections (ICMP ping and TCP/UDP connections). The interaction
    with such devices is done by the console and manual input of commands. In our
    case, for setting up addresses in the device console, we just need to input a
    command:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 这种仿真器已经由 GNS 提供；它们是 **VPCS** 类型的桩设备。这些虚拟设备允许我们执行基于 IP 连接的基本操作（ICMP ping 和 TCP/UDP
    连接）。与这些设备的交互通过控制台进行，并通过手动输入命令来实现。在我们的案例中，要在设备控制台中设置地址，我们只需要输入一个命令：
- en: '[PRE32]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Of course, we can use static addresses for this purpose in the device console
    input command:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，我们可以在设备控制台输入命令时使用静态地址：
- en: '[PRE33]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Where:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 其中：
- en: 10.0.0.101 is the host address
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 10.0.0.101 是主机地址
- en: 255.255.255.0 is the network mask
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 255.255.255.0 是网络掩码
- en: 10.0.0.1 is the gateway address
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 10.0.0.1 是网关地址
- en: 'For testing network connectivity and operability, we can use the ICMP-based
    commands `ping` and `tracert`:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试网络连接性和可操作性，我们可以使用基于 ICMP 的命令 `ping` 和 `tracert`：
- en: '[PRE34]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Note
  id: totrans-270
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Using GNS, we can also easily capture network traffic, for example, with Wireshark.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 GNS，我们还可以轻松捕获网络流量，例如使用 Wireshark。
- en: 'You need to do the following:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要做以下操作：
- en: 1) Right-click on the link between the two devices.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 1) 右键点击两个设备之间的链接。
- en: 2) Choose the item **Сapture** from the context menu.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 2) 从上下文菜单中选择 **Capture** 项。
- en: 3) After that, Wireshark will start (or another application that was set in
    the **Packet capture** tab of GNS3 preferences).
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 3) 之后，Wireshark 将启动（或者启动在 GNS3 偏好设置的 **Packet capture** 标签中设置的其他应用程序）。
- en: In the Wireshark window, we will have all the intercepted packets.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 在Wireshark窗口中，我们将看到所有被拦截的数据包。
- en: Wireless hardware devices
  id: totrans-277
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 无线硬件设备
- en: The only type of network device that we cannot virtualize is a wireless access
    points. Therefore, we will use the physical network devices. As in the case of
    hardware configuration, it will be an access point and a SOHO router.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 我们无法虚拟化的唯一类型的网络设备是无线接入点。因此，我们将使用物理网络设备。就像硬件配置的情况一样，它将是一个接入点和一个SOHO路由器。
- en: For interaction with the external world, GNS3 provides a tool **Cloud**, which
    is the built-in connector between the GNS3 virtual infrastructure and the network
    adapter of the host computer.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 为了与外部世界进行交互，GNS3提供了一个工具**Cloud**，它是GNS3虚拟基础设施与主机计算机网络适配器之间的内置连接器。
- en: If your host computer has two Ethernet adapters, you can use two clouds to connect
    to each physical device. But if your host computer is a laptop, as in our case,
    you can use an Ethernet adapter for connecting to the SOHO router and use the
    wireless adapter of your host computer as the access point instead of a hardware
    access point.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的主机计算机有两个以太网适配器，你可以使用两个云来连接每个物理设备。但如果你的主机是笔记本电脑，像我们这种情况，你可以使用一个以太网适配器连接到SOHO路由器，并将主机的无线适配器用作接入点，而不是硬件接入点。
- en: 'If you have only one Ethernet adapter and still do not want to use the wireless
    adapter of the host computer, you have two options:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只有一个以太网适配器，并且仍然不想使用主机的无线适配器，你有两个选择：
- en: Manually switching between hardware devices (AP and SOHO router)
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在硬件设备之间手动切换（AP和SOHO路由器）
- en: Preparing an additional VM with a software AP and a USB Wi-Fi interface connected
    to it using the USB-forwarding feature of VirtualBox (we briefly show how to install
    the necessary software and implement such a scenario in [Chapter 7](part0047_split_000.html#1CQAE1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 7. Preparing a Wireless Penetration Testing Platform"), *Preparing a
    Wireless Penetration Testing Platform*)
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备一个额外的虚拟机，带有软件AP和一个通过VirtualBox的USB转发功能连接到它的USB Wi-Fi接口（我们简要介绍如何安装必要的软件并在[第7章](part0047_split_000.html#1CQAE1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "第7章. 准备无线渗透测试平台")，*准备无线渗透测试平台*中实现这样的场景）
- en: Now, let's see how to connect a network adapter of the host computer to our
    virtual infrastructure.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们看看如何将主机计算机的网络适配器连接到我们的虚拟基础设施。
- en: Right-click on the icon of the **Сloud** tool and open the configuration window
    of **Cloud** by selecting **Configure** from the context menu. We should specify
    the network adapter that we want to use in the field **Ethernet NIO** in the configuration
    window by navigating to **Cloud** | **Ethernet**. After that, click on the button
    **Add**.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 右键点击**Cloud**工具的图标，通过从上下文菜单中选择**Configure**打开**Cloud**的配置窗口。在配置窗口中，我们应该在**Ethernet
    NIO**字段中指定我们要使用的网络适配器，路径是**Cloud** | **Ethernet**。之后，点击**Add**按钮。
- en: '![Wireless hardware devices](../images/00022.jpeg)'
  id: totrans-286
  prefs: []
  type: TYPE_IMG
  zh: '![无线硬件设备](../images/00022.jpeg)'
- en: The Cloud configuration window
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 云配置窗口
- en: Now, **Cloud** is configured. Quite simple, isn't it?
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，**Cloud**已经配置完成。相当简单，不是吗？
- en: Configuring WLANs
  id: totrans-289
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置WLAN
- en: 'Now, let''s consider the creation of a wireless network as part of our test
    infrastructure. Based on the resources that we have, we can create wireless networks
    using three techniques:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们考虑作为测试基础设施的一部分创建一个无线网络。根据我们拥有的资源，我们可以使用三种技术来创建无线网络：
- en: Guest WLAN based on the SOHO router
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于SOHO路由器的客户端WLAN
- en: Trusted WLAN based on the hardware access point
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于硬件接入点的可信WLAN
- en: Trusted WLAN based on the software access point
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于软件接入点的可信WLAN
- en: Each technique has its own characteristics (advantages and disadvantages) and
    provides a number of choices. We will cover all three options.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 每种技术都有其特点（优点和缺点），并提供了多个选择。我们将涵盖这三种选择。
- en: Guest WLAN
  id: totrans-295
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 客户端WLAN
- en: As our guest WLAN is based on a SOHO router, we will discuss both wired and
    wireless configurations here to build a guest WLAN and provide Internet access
    (external network) for the whole lab network.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们的客户端WLAN是基于SOHO路由器的，接下来我们将在这里讨论有线和无线配置，以构建一个客户端WLAN，并为整个实验室网络提供互联网访问（外部网络）。
- en: All modern SOHO routers (like ASUS, Linksys, and D-Link) provide pretty much
    the same capabilities and configuration options and modes regardless of the model.
    Therefore, we are not going to provide step-by-step instructions on where to click
    and what to type in the web interface of a certain router model (especially because
    it does not make any sense for IT specialists). However, we are going to just
    provide you certain settings instead to assure that we have the same network configs
    with our readers and will not have any compatibility issues in later chapters.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 所有现代SOHO路由器（如华硕、Linksys和D-Link）提供几乎相同的功能、配置选项和模式，无论型号如何。因此，我们不会提供关于在特定路由器型号的网页界面上点击什么和输入什么的逐步说明（特别是因为对于IT专家来说，这没有任何意义）。不过，我们将提供某些设置，以确保我们与读者的网络配置一致，且在后续章节中不会出现兼容性问题。
- en: 'Please enable a DHCP server role for the LAN network if it was not enabled
    yet and set the following configs:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 如果LAN网络的DHCP服务器角色尚未启用，请启用它，并设置以下配置：
- en: '| Settings | Values |'
  id: totrans-299
  prefs: []
  type: TYPE_TB
  zh: '| 设置项 | 值 |'
- en: '| --- | --- |'
  id: totrans-300
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| LAN IP address | 192.168.0.2 |'
  id: totrans-301
  prefs: []
  type: TYPE_TB
  zh: '| LAN IP地址 | 192.168.0.2 |'
- en: '| DHCP IP pool start | 192.168.0.3 |'
  id: totrans-302
  prefs: []
  type: TYPE_TB
  zh: '| DHCP IP池开始 | 192.168.0.3 |'
- en: '| DHCP IP pool end | 192.168.0.20 |'
  id: totrans-303
  prefs: []
  type: TYPE_TB
  zh: '| DHCP IP池结束 | 192.168.0.20 |'
- en: Now, configure the WLAN settings on your SOHO router and set your guest WLAN
    name (SSID) to whatever you like (we just name it `Guest`), set the protection
    type as WPA2, and set a strong passphrase (we assume that as a security specialist
    you know what makes a strong passphrase, so we will not discuss password rules
    here).
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在SOHO路由器上配置WLAN设置，并将你的访客WLAN名称（SSID）设置为你喜欢的任何名称（我们将其命名为`Guest`），将保护类型设置为WPA2，并设置一个强密码（我们假设作为安全专家，你知道什么构成强密码，因此我们在这里不讨论密码规则）。
- en: As the last steps in the SOHO router configuration, reboot it, connect any client
    device to the guest WLAN, and test the Internet connection.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 作为SOHO路由器配置的最后步骤，重启路由器，连接任何客户端设备到访客WLAN，并测试互联网连接。
- en: Preparing the hardware access point
  id: totrans-306
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备硬件接入点
- en: 'Let''s continue installing and configuring our hardware access point. Now,
    we can connect to the access point device directly via a COM-port and follow the
    instructions given here. Since we are using devices from one manufacturer and
    are working with the same software platform, the configuration process is very
    similar to our previous tasks. Of course, configuring an access point has its
    own nuances, which we will now outline. First, let''s go to privileged mode:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续安装和配置硬件接入点。现在，我们可以直接通过COM端口连接到接入点设备，并按照这里提供的说明操作。由于我们使用的是同一制造商的设备，并且在相同的软件平台上工作，配置过程与我们之前的任务非常相似。当然，配置接入点有其自身的细节，我们将现在简要说明。首先，进入特权模式：
- en: '[PRE35]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Set a hostname for our device:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 为我们的设备设置一个主机名：
- en: '[PRE36]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Limit access to the device (only the local access level):'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 限制设备访问（仅本地访问级别）：
- en: '[PRE37]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Next, we will set a password for the privileged mode:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将为特权模式设置密码：
- en: '[PRE38]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Finally, we should configure a bridge network interface to allow the trusted
    WLAN to communicate with the rest of our lab infrastructure:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们应配置一个桥接网络接口，以便使受信任的WLAN能够与我们实验室的其他基础设施通信：
- en: '[PRE39]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Now, we just need to save the new configuration and finish the WLAN setup for
    now:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们只需保存新配置，并暂时完成WLAN的设置：
- en: '[PRE40]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: We will leave further hardware AP configuration (as well as software AP) for
    [Chapter 5](part0038_split_000.html#147LC2-3ecab517ca6e4afbb3c20ab15f7b4d82 "Chapter 5. Implementing
    Security"), *Implementing Security*, where we will already have a RADIUS server
    installed to be able to apply proper security to our trusted WLAN.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[第5章](part0038_split_000.html#147LC2-3ecab517ca6e4afbb3c20ab15f7b4d82 "第5章：实施安全")中进一步讨论硬件AP配置（以及软件AP），*实施安全*，届时我们将已经安装了RADIUS服务器，以便能够为我们的受信任WLAN应用适当的安全性。
- en: Summary
  id: totrans-320
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: 'In this chapter, we discussed the network communication and access rules in
    our lab environment. You saw two options for building your lab network: based
    on hardware Cisco devices and based on virtual ones.'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了实验室环境中的网络通信和访问规则。你看到构建实验室网络的两种选择：基于硬件Cisco设备和基于虚拟设备。
- en: You can now configure your devices and get a working network for any of the
    two provided options, depending on which one you chose for your lab budget.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以配置你的设备，并根据你为实验室预算选择的选项之一，构建一个可用的网络。
- en: Whenever you need it, you can go further and add and configure more network
    components/devices/subnets to extend your lab in much the same way as we have
    configured our basic lab network.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 每当你需要时，你可以进一步添加和配置更多的网络组件/设备/子网，以与我们配置的基础实验室网络相同的方式扩展你的实验室。
- en: 'In the next chapter, we will show you how to design application lab components
    that will fulfill our main lab task: learning and practicing penetration testing.'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将向你展示如何设计应用实验室组件，以完成我们的主要实验任务：学习和实践渗透测试。
