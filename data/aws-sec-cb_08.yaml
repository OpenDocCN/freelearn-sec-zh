- en: '8'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '8'
- en: Compliance with GuardDuty, Macie, Inspector, and Analyzer
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: GuardDuty、Macie、Inspector 和 Analyzer 的合规性
- en: Regularly checking for compliance within our account and being notified if anything
    is not compliant is an important step toward keeping our account secure. In this
    chapter, we will learn about some services within AWS that can help us in checking
    compliance, with the help of additional intelligence and rules. We will learn
    about **Amazon GuardDuty** , **Amazon Macie** , and **Amazon Inspector** , which
    use machine learning and advanced algorithms to help us check for compliance.
    AWS Config is another service that can help with compliance, but we already covered
    it in [*Chapter 7*](B21384_07.xhtml#_idTextAnchor265) .
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 定期检查账户的合规性，并在发现任何不合规时收到通知，是保持账户安全的重要步骤。在本章中，我们将了解 AWS 内的一些服务，这些服务可以帮助我们检查合规性，通过附加的智能和规则。我们将学习**Amazon
    GuardDuty**、**Amazon Macie**和**Amazon Inspector**，它们利用机器学习和高级算法帮助我们检查合规性。AWS Config
    是另一项可以帮助合规性的服务，但我们已在[*第7章*](B21384_07.xhtml#_idTextAnchor265)中讲解过它。
- en: 'This chapter includes the following recipes:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包括以下操作：
- en: Setting up and using Amazon GuardDuty
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置并使用 Amazon GuardDuty
- en: Aggregating findings from multiple accounts in GuardDuty
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 聚合来自多个账户的 GuardDuty 发现结果
- en: Setting up and using Amazon Macie
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置并使用 Amazon Macie
- en: Setting up and using Amazon Inspector
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置并使用 Amazon Inspector
- en: Setting up and using AWS Security Hub
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置并使用 AWS Security Hub
- en: Using IAM Analyzer to inspect unused access
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 IAM Analyzer 检查未使用的访问权限
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'Before diving into the recipes of this chapter, we need to ensure that we have
    the following requirements and knowledge in place:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始本章的操作之前，我们需要确保具备以下要求和知识：
- en: We need an active AWS Account to complete the recipes within this chapter. If
    we are using an AWS Organization, we can use the management account of the Organization
    as we will be configuring many things at the AWS Organization level in this chapter.
    I will be using the **aws-sec-cookbook-1** account that we created in the *Multi-account
    management with AWS Organizations* recipe in [*Chapter 1*](B21384_01.xhtml#_idTextAnchor020)
    .
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要一个有效的 AWS 账户来完成本章中的操作。如果我们使用 AWS 组织，我们可以使用组织的管理账户，因为在本章中我们将在 AWS 组织级别配置很多内容。我将使用在[*第1章*](B21384_01.xhtml#_idTextAnchor020)中的*多账户管理与
    AWS 组织*食谱中创建的**aws-sec-cookbook-1**账户。
- en: For administrative actions, we need a user who has **AdministratorAccess** permission
    to the AWS account we are working with.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于管理员操作，我们需要一个具有**AdministratorAccess**权限的用户，才能访问我们正在使用的 AWS 账户。
- en: Code files for this chapter are available at [https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter08](https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter08)
    .
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的代码文件可在[https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter08](https://github.com/PacktPublishing/AWS-Security-Cookbook-Second-Edition/tree/main/Chapter08)
    获取。
- en: Setting up and using Amazon GuardDuty
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置并使用 Amazon GuardDuty
- en: In this recipe, we will learn how to set up and use Amazon GuardDuty. GuardDuty
    analyzes data from sources such as CloudTrail management logs, VPC flow logs,
    and Route 53 DNS logs, and uses machine learning, anomaly detection, and integrated
    threat intelligence to find malicious activities and unauthorized behavior. Note
    that if you use another DNS resolver, such as OpenDNS or GoogleDNS, or if you
    set up your own DNS resolvers, GuardDuty cannot access and process data from these
    sources. GuardDuty can be integrated with CloudWatch and SNS to raise alarms and
    send notifications. GuardDuty can also aggregate data from multiple accounts.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们将学习如何设置并使用 Amazon GuardDuty。GuardDuty 分析来自 CloudTrail 管理日志、VPC 流日志和
    Route 53 DNS 日志等源的数据，并使用机器学习、异常检测和集成的威胁情报来发现恶意活动和未经授权的行为。请注意，如果您使用其他 DNS 解析器，如
    OpenDNS 或 GoogleDNS，或设置了自己的 DNS 解析器，GuardDuty 无法访问和处理来自这些源的数据。GuardDuty 可以与 CloudWatch
    和 SNS 集成，以触发警报并发送通知。GuardDuty 还可以聚合来自多个账户的数据。
- en: Getting ready
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To successfully complete this recipe, we will need a working AWS account and
    a user, as described in the *Technical requirements* section. We will also need
    an S3 bucket.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 要成功完成这个操作，我们需要一个有效的 AWS 账户和一个用户，具体要求请参见*技术要求*部分。我们还需要一个 S3 存储桶。
- en: How to do it...
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'If we are using GuardDuty for the first time, we need to first enable GuardDuty.
    Let us get started:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们第一次使用 GuardDuty，我们需要先启用 GuardDuty。让我们开始吧：
- en: Go to the **GuardDuty** service in the AWS management console.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 AWS 管理控制台中转到**GuardDuty**服务。
- en: If we are using GuardDuty for the first time, we should see options such as
    the following. If GuardDuty is already enabled, proceed to *Step 4* .
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们是第一次使用 GuardDuty，应该会看到如下选项。如果 GuardDuty 已经启用，请跳到*步骤 4*。
- en: '![Figure 8.1 – Enabling GuardDuty](image/B21384_08_1.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.1 – 启用 GuardDuty](image/B21384_08_1.jpg)'
- en: Figure 8.1 – Enabling GuardDuty
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.1 – 启用 GuardDuty
- en: Select **Amazon GuardDuty - all features** and click on **Get started** . We
    should now see the **Welcome to GuardDuty** screen; click on **Enable GuardDuty**
    .
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**Amazon GuardDuty - 全功能**，然后点击**开始使用**。我们现在应该看到**欢迎使用 GuardDuty**屏幕；点击**启用
    GuardDuty**。
- en: Click on **Findings** in the left sidebar on the **GuardDuty** dashboard. We
    can see the findings categorized as **High** , **Medium** , and **Low** here.
    As we have just enabled it, you may not see any findings initially.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**GuardDuty**仪表板的左侧边栏点击**发现**。我们可以看到这里的发现按**高**、**中**和**低**分类。由于我们刚刚启用它，初始时可能不会看到任何发现。
- en: '![Figure 8.2 – The Findings screen](image/B21384_08_2.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.2 – 发现屏幕](image/B21384_08_2.jpg)'
- en: Figure 8.2 – The Findings screen
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.2 – 发现屏幕
- en: We can click on any of the events to see additional information provided about
    that finding. We can then scroll down to the **Action** , **Target** , and **Additional
    information** sections to learn more about the event.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以点击任何一个事件，查看该发现提供的更多信息。然后我们可以向下滚动到**操作**、**目标**和**附加信息**部分，了解更多关于该事件的信息。
- en: Next, we will whitelist and blacklist IPs in GuardDuty.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将在 GuardDuty 中进行 IP 白名单和黑名单管理。
- en: Whitelisting and blacklisting IPs in GuardDuty
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 GuardDuty 中进行 IP 白名单和黑名单管理
- en: 'We can whitelist and blacklist IPs in GuardDuty as follows:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照以下方式在 GuardDuty 中进行 IP 白名单和黑名单管理：
- en: 'Create and upload the following two files, one with trusted IPs and one with
    threat lists, and upload them into an S3 bucket:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建并上传以下两个文件，一个是信任的 IP 列表，另一个是威胁列表，并将它们上传到 S3 存储桶：
- en: '**trusted-ips.txt** : This is a text file with the list of IPs and CIDR ranges
    we want to trust. Each IP or CIDR range should be on its own line.'
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**trusted-ips.txt**：这是一个文本文件，包含我们希望信任的 IP 和 CIDR 范围。每个 IP 或 CIDR 范围应该占一行。'
- en: '![Figure 8.3 – The trusted-ips file](image/B21384_08_3.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.3 – 信任的 IP 文件](image/B21384_08_3.jpg)'
- en: Figure 8.3 – The trusted-ips file
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.3 – 信任的 IP 文件
- en: '**threat-lists.txt** : This is a text file with the list of IPs and CIDR ranges
    we want to add to the suspicious IP list. Each IP or CIDR range should be on its
    own line.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**threat-lists.txt**：这是一个文本文件，包含我们希望添加到可疑 IP 列表中的 IP 和 CIDR 范围。每个 IP 或 CIDR
    范围应该占一行。'
- en: '![Figure 8.4 – The threat-list file](image/B21384_08_4.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.4 – 威胁列表文件](image/B21384_08_4.jpg)'
- en: Figure 8.4 – The threat-list file
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.4 – 威胁列表文件
- en: Now, go back to the **GuardDuty** dashboard. Click on **Lists** in the left
    sidebar.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，返回到**GuardDuty**仪表板。在左侧边栏点击**列表**。
- en: Under **Trusted IP lists** , click on **Add a trusted** **IP list** .
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**信任的 IP 列表**下，点击**添加信任的 IP 列表**。
- en: In the pop-up screen named **Add a trusted IP list** , give a name to our list
    in the **List name** field. For **Location** , enter the S3 URL of your trusted
    IP list, which is of the **https://myguarddutydemo.s3.amazonaws.com/trusted-ips.txt**
    form. For **Format** , select **Plaintext** . Then select the **I agree** checkbox.
    Finally, click on **Add list** . We should now see our list under T **rusted**
    **IP lists** .
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在名为**添加信任的 IP 列表**的弹出屏幕中，在**列表名称**字段为我们的列表命名。对于**位置**，输入您信任的 IP 列表的 S3 URL，格式为**https://myguarddutydemo.s3.amazonaws.com/trusted-ips.txt**。对于**格式**，选择**纯文本**。然后勾选**我同意**复选框。最后，点击**添加列表**。我们现在应该可以在**信任的
    IP 列表**下看到我们的列表。
- en: Click the checkbox beside our list. Click on the **Action** dropdown and click
    on **Activate** . We should see a success message indicating that the list has
    been activated. It may take some time for the changes to take effect.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 勾选我们列表旁边的复选框。点击**操作**下拉菜单，然后点击**激活**。我们应该看到一条成功消息，指示该列表已被激活。可能需要一些时间才能使更改生效。
- en: Under **Threat IP lists** , click on **Add a threat IP list** . We should see
    a pop-up screen named **Add a threat** **IP list** .
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**威胁 IP 列表**下，点击**添加威胁 IP 列表**。我们应该看到一个名为**添加威胁 IP 列表**的弹出屏幕。
- en: Repeat *Steps 3* *to* *5* but add our threat list instead of a trusted IP list.
    We should see our list under **Threat** **IP lists** .
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复*步骤 3* *到* *5*，但添加我们的威胁列表，而不是信任的 IP 列表。我们应该会在**威胁 IP 列表**下看到我们的列表。
- en: 'To verify that the trusted and threat IP lists are working correctly, we can
    simulate traffic from IPs in our lists and check the GuardDuty findings:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了验证信任的 IP 列表和威胁 IP 列表是否正常工作，我们可以模拟来自列表中 IP 的流量，并检查 GuardDuty 的发现结果：
- en: '**Whitelisted IPs** ( **Trusted IPs** ): Generate traffic from an IP address
    that is in our **trusted-ips.txt** file. Monitor GuardDuty findings to ensure
    that this traffic is not flagged as suspicious or malicious.'
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**白名单 IP**（**受信任的 IP**）：从我们 **trusted-ips.txt** 文件中的 IP 地址生成流量。监控 GuardDuty
    发现，确保该流量未被标记为可疑或恶意。'
- en: '**Blacklisted IPs** ( **Threat IPs** ): Generate traffic from an IP address
    that is in our threat-lists.txt file. Check the GuardDuty findings to confirm
    that this traffic is flagged as suspicious or malicious.'
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**黑名单 IP**（**威胁 IP**）：从我们威胁列表文件中的 IP 地址生成流量。检查 GuardDuty 发现，确认该流量是否被标记为可疑或恶意。'
- en: Review the GuardDuty dashboard and findings to ensure that the whitelisted IPs
    are not generating any alerts and that the blacklisted IPs are flagged appropriately.
    This will confirm that our lists are being used effectively by GuardDuty.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查 GuardDuty 仪表盘和发现，以确保白名单中的 IP 不会生成任何警报，并且黑名单中的 IP 已被正确标记。这样可以确认我们的列表被 GuardDuty
    有效使用。
- en: In this section, we whitelisted and blacklisted a few IP addresses by adding
    them to the trusted IP lists and threat lists, respectively. We will learn more
    about how they work in the *How it works...* section of this recipe.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们通过分别将几个 IP 地址添加到受信任的 IP 列表和威胁列表中，将这些 IP 地址列入白名单和黑名单。我们将在本教程的 *工作原理…*
    部分深入了解它们是如何工作的。
- en: How it works...
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: We first enabled GuardDuty. When we enabled GuardDuty, we granted it permissions
    to analyze various logs and data sources, such as VPC Flow logs, AWS CloudTrail
    management event logs, DNS query logs, AWS CloudTrail S3 data event logs, EKS
    audit logs, Lambda network activity logs, and RDS login activity logs, to generate
    security findings, as you should have seen while doing *Step 3* of the *How to
    do it...* section for this recipe. Additionally, GuardDuty can analyze **Elastic
    Block Storage** ( **EBS** ) volume data to detect malware. When we enable GuardDuty
    in a supported region for the first time, our account is automatically enrolled
    in a 30-day free trial, which may also include some protection plans by default.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先启用了 GuardDuty。当我们启用 GuardDuty 时，我们授予它权限以分析各种日志和数据源，如 VPC 流日志、AWS CloudTrail
    管理事件日志、DNS 查询日志、AWS CloudTrail S3 数据事件日志、EKS 审计日志、Lambda 网络活动日志和 RDS 登录活动日志，以生成安全发现，正如你在执行本教程
    *如何操作…* 部分的 *第 3 步* 时看到的那样。此外，GuardDuty 可以分析 **弹性块存储**（**EBS**）卷数据以检测恶意软件。当我们第一次在支持的区域启用
    GuardDuty 时，我们的账户会自动加入 30 天的免费试用期，这期间可能还会默认包括一些保护计划。
- en: By default, when we first enable GuardDuty, all protection plans are activated,
    except for Runtime Monitoring and Malware Protection for S3. These can be enabled
    through the GuardDuty console or APIs. Usage of GuardDuty’s Malware Protection
    and Runtime Monitoring services is governed by the Amazon GuardDuty Service Terms.
    We can suspend or disable GuardDuty or any specific protection plan at any time
    to stop it from processing and analyzing data, events, and logs. However, suspending
    or disabling GuardDuty does not affect Malware Protection for S3. To stop malware
    scanning of our S3 buckets, we must individually delete the Malware Protection
    plan for each bucket. Note that GuardDuty does not manage or provide access to
    the logs and data it analyzes; we can configure these data sources through their
    respective consoles or APIs.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，当我们第一次启用 GuardDuty 时，所有保护计划都会激活，除了 S3 的运行时监控和恶意软件保护。这些可以通过 GuardDuty 控制台或
    API 启用。GuardDuty 的恶意软件保护和运行时监控服务的使用受 Amazon GuardDuty 服务条款的约束。我们可以随时暂停或禁用 GuardDuty
    或任何特定的保护计划，停止其处理和分析数据、事件和日志。然而，暂停或禁用 GuardDuty 不会影响 S3 的恶意软件保护。要停止对我们的 S3 存储桶进行恶意软件扫描，我们必须单独删除每个存储桶的恶意软件保护计划。请注意，GuardDuty
    不管理或提供其分析的日志和数据的访问权限；我们可以通过各自的控制台或 API 配置这些数据源。
- en: For testing purposes, we generated sample findings from the GuardDuty console;
    GuardDuty generated 54 sample events (in my case – it could vary for you since
    GuardDuty adds and deprecates finding types throughout the year). GuardDuty events
    are categorized into three severity levels, from lowest to highest, denoted by
    blue, yellow, and red icons, where blue is the least severe and red is the most
    severe. Once we click on a finding, we will get additional information about the
    finding.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进行测试，我们从 GuardDuty 控制台生成了示例发现；GuardDuty 生成了 54 个示例事件（在我的案例中 – 这可能会有所不同，因为
    GuardDuty 会在一年中增加和淘汰发现类型）。GuardDuty 事件分为三个严重性级别，从最低到最高，分别由蓝色、黄色和红色图标表示，蓝色为最轻，红色为最严重。点击发现后，我们将获得关于该发现的更多信息。
- en: We whitelisted and blacklisted a few IP addresses by adding them to the trusted
    IP and threat lists, respectively. GuardDuty will not generate findings for IP
    addresses that are included in the trusted IP lists. This is done to avoid false
    alarms, especially from company IP addresses. However, we need to keep in mind
    that attacks can be internal too. Threat lists consist of known malicious IP addresses.
    The addresses we provide will be used along with the ones already available with
    AWS based on their research and experiences.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过将一些 IP 地址添加到受信任 IP 和威胁列表中，分别将它们列入白名单和黑名单。GuardDuty 不会对已包含在受信任 IP 列表中的 IP
    地址生成检测结果。这是为了避免误报，特别是来自公司 IP 地址的误报。然而，我们需要记住，攻击也可能来自内部。威胁列表由已知的恶意 IP 地址组成。我们提供的地址将与
    AWS 基于其研究和经验所提供的地址一起使用。
- en: We can add an IP or a CIDR range to the trusted IP lists and threat lists in
    various formats, such as plain text (an IP or a CIDR per line), **Structured Threat
    Information Expression** ( **STIX** ), **Open Threat Exchange** ( **OTX** ) CSV,
    FireEye iSIGHT Threat Intelligence CSV, Proofpoint ET Intelligence Feed CSV, and
    AlienVault Reputation Feed. Currently, we can have up to 2,000 lines in a trusted
    IP list and 250,000 lines in a threat list.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将一个 IP 或 CIDR 范围添加到受信任 IP 列表和威胁列表中，格式多样，包括纯文本格式（每行一个 IP 或 CIDR），**结构化威胁信息表达式**（**STIX**）、**开放威胁交换**（**OTX**）CSV、FireEye
    iSIGHT 威胁情报 CSV、Proofpoint ET 情报源 CSV、AlienVault 声誉源 CSV。目前，受信任 IP 列表最多可以有 2,000
    行，威胁列表最多可以有 250,000 行。
- en: There’s more...
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: As a new feature, Amazon GuardDuty Malware Protection for S3 detects malicious
    file uploads to our selected Amazon S3 buckets. We can enable Malware Protection
    for S3 for a bucket that belongs to our own account and monitor the malware scan
    status using the embedded Amazon CloudWatch metrics in the GuardDuty console.
    We have seen this option in *Figure 8* *.1* .
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一项新功能，Amazon GuardDuty S3 恶意软件保护可以检测上传到我们选择的 Amazon S3 存储桶中的恶意文件。我们可以为属于我们账户的
    S3 存储桶启用恶意软件保护，并使用 GuardDuty 控制台中嵌入的 Amazon CloudWatch 指标来监控恶意软件扫描状态。我们在 *图 8*
    *.*1* 中已经看到了这个选项。
- en: 'Let’s go through some important concepts related to GuardDuty:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们了解一些与 GuardDuty 相关的重要概念：
- en: GuardDuty can detect compromised EC2 instances by analyzing VPC flow logs—for
    example, GuardDuty can detect whether an instance is used in a **Denial of Service**
    ( **DOS** ) attack.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GuardDuty 通过分析 VPC 流日志来检测受损的 EC2 实例——例如，GuardDuty 可以检测实例是否被用于 **拒绝服务**（**DOS**）攻击。
- en: GuardDuty can detect whether our instances have been used for cryptocurrency
    mining. It can also detect whether our credentials have been stolen by accessing
    malicious IPs, using EC2 instance profiles outside of EC2, or making anomalous
    API calls to AWS resources such as S3, EC2, RDS, and so on.
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GuardDuty 可以检测我们的实例是否被用于加密货币挖矿。它还可以检测我们的凭证是否被盗，例如通过访问恶意 IP、使用 EC2 实例配置文件访问 EC2
    以外的资源，或对 AWS 资源（如 S3、EC2、RDS 等）发出异常的 API 调用。
- en: GuardDuty can scan for and detect malicious artifacts in EC2 instances and EKS
    infrastructure. It can also help identify malicious file uploads to S3 buckets.
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GuardDuty 可以扫描并检测 EC2 实例和 EKS 基础设施中的恶意文件。它还可以帮助识别上传到 S3 存储桶中的恶意文件。
- en: GuardDuty is a regional service. Even when multiple accounts are enabled and
    multiple AWS regions are used, the GuardDuty security findings remain in the same
    regions where the underlying data was generated.
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GuardDuty 是一项区域性服务。即使启用了多个账户并使用了多个 AWS 区域，GuardDuty 的安全检测结果仍然保留在生成底层数据的同一地区。
- en: We can aggregate GuardDuty findings across different accounts into one account.
    We will discuss this in the *Aggregating findings from multiple accounts in* *GuardDuty*
    recipe.
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以将来自不同账户的 GuardDuty 检测结果汇总到一个账户中。我们将在 *GuardDuty 中汇总多个账户的检测结果* 配方中讨论这个内容。
- en: We can export GuardDuty findings across different accounts and regions to an
    Amazon S3 bucket to simplify the aggregation of all the findings. This is a new
    feature and is different from aggregating findings across different accounts into
    one account.
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以将不同账户和区域的 GuardDuty 检测结果导出到一个 Amazon S3 存储桶中，以简化所有检测结果的汇总。这是一个新功能，区别于将多个账户的检测结果汇总到一个账户中。
- en: We can use CloudWatch and SNS to monitor GuardDuty findings and send notifications.
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以使用 CloudWatch 和 SNS 来监控 GuardDuty 的检测结果并发送通知。
- en: 'GuardDuty pricing is based on the amount of data analyzed:'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GuardDuty 的定价是基于分析的数据量：
- en: For VPC flow log and DNS log analysis, GuardDuty charges us based on the size
    of the data analyzed.
  id: totrans-68
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于 VPC 流日志和 DNS 日志分析，GuardDuty 根据分析的数据大小收费。
- en: For CloudTrail events, GuardDuty charges us based on the number of events analyzed.
  id: totrans-69
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于 CloudTrail 事件，GuardDuty 会根据分析的事件数量收费。
- en: GuardDuty supports the processing, storage, and transmission of credit card
    data by a merchant or service provider, and has been validated as being compliant
    with the **Payment Card Industry** ( **PCI** ) **Data Security** **Standard**
    ( **DSS** )
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GuardDuty 支持商家或服务提供商处理、存储和传输信用卡数据，并已通过**支付卡行业**(**PCI**) **数据安全**(**DSS**) **标准**的合规性验证。
- en: Setting up Amazon EventBridge to monitor our findings from GuardDuty
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置 Amazon EventBridge 以监控来自 GuardDuty 的发现
- en: 'The steps to set up **Amazon EventBridge** to monitor our findings from GuardDuty
    can be summarized as follows:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 设置 **Amazon EventBridge** 以监控来自 GuardDuty 的发现的步骤总结如下：
- en: Go to the **EventBridge** service in the management console.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到管理控制台中的**EventBridge** 服务。
- en: Important note
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: EventBridge was formerly known as Amazon CloudWatch Events. As of now, if we
    navigate to CloudWatch and click on **Rules** under the **Events** section, we
    will be redirected to the EventBridge console.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: EventBridge 曾被称为 Amazon CloudWatch 事件。目前，如果我们导航到 CloudWatch 并点击**事件**部分下的**规则**，我们将被重定向到
    EventBridge 控制台。
- en: Click on **Rules** under **Buses** from the left sidebar.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧边栏中点击**总线**下的**规则**。
- en: Click on **Create rule** to go to the **Create** **rule** page.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建规则**以进入**创建规则**页面。
- en: On the **Define rule detail** page, provide a name and description for our rule.
    Leave the value for **Event bus** as **default** and **Rule type** as **Rule with
    an event pattern** and click on **Next** .
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**定义规则详细信息**页面中，为我们的规则提供名称和描述。将**事件总线**的值保持为**默认**，**规则类型**为**带事件模式的规则**，然后点击**下一步**。
- en: In the **Build event pattern** section, scroll down to **Event pattern** .
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**构建事件模式**部分，向下滚动到**事件模式**。
- en: Set **Event source** to **AWS events or Eventbridge** **partner events** .
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置**事件源**为**AWS 事件或 EventBridge** **合作伙伴事件**。
- en: Set **AWS service** to **GuardDuty** .
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置**AWS 服务**为**GuardDuty**。
- en: Set **Event Type** to **GuardDuty Finding** .
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置**事件类型**为**GuardDuty 发现**。
- en: 'Click on **Next** . Under **Targets** , do the following:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。在**目标**下，执行以下操作：
- en: Under **Select a target** , select **SNS topic** from the dropdown.
  id: totrans-84
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择目标**下，从下拉菜单中选择**SNS 主题**。
- en: Select a topic. You can create an SNS topic by following the *Creating an SNS
    topic to send emails* recipe in [*Chapter 7*](B21384_07.xhtml#_idTextAnchor265)
    .
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个主题。你可以通过参考 [*第 7 章*](B21384_07.xhtml#_idTextAnchor265) 中的*创建 SNS 主题以发送电子邮件*配方来创建
    SNS 主题。
- en: Click on **Next** .
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。
- en: Optionally, click **Add new tags** and click on **Next** .
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，点击**添加新标签**，然后点击**下一步**。
- en: Review the rule and click on **Create rule** .
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审核规则并点击**创建规则**。
- en: Navigate back to the **GuardDuty** service and click on **Settings** on the
    left sidebar.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回**GuardDuty**服务并点击左侧边栏的**设置**。
- en: Scroll down to **Sample findings** and click on **Generate sample findings**
    . After some time, check the inbox of the email address we configured for our
    SNS topic, and we should get an email about our GuardDuty findings.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动到**示例发现**并点击**生成示例发现**。稍后，检查我们为 SNS 主题配置的电子邮件地址的收件箱，应该会收到一封关于 GuardDuty
    发现的邮件。
- en: To configure and modify the frequency with which GuardDuty updates Event Bridge
    and S3, we can go to the **GuardDuty** service, click on **Settings** from the
    left sidebar, and **Edit** in the **Findings export** **options** section.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要配置和修改 GuardDuty 更新 EventBridge 和 S3 的频率，我们可以转到**GuardDuty**服务，点击左侧边栏的**设置**，并在**发现导出**选项部分点击**编辑**。
- en: If we have not yet configured the export to S3, we will be provided with a **Configure
    now** option to configure it.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们尚未配置导出到 S3，则会提供一个**立即配置**选项来进行配置。
- en: See also
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Read more about GuardDuty at [https://www.cloudericks.com/blog/getting-started-with-amazon-guardduty](https://www.cloudericks.com/blog/getting-started-with-amazon-guardduty)
    .
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 阅读更多关于 GuardDuty 的信息，请访问 [https://www.cloudericks.com/blog/getting-started-with-amazon-guardduty](https://www.cloudericks.com/blog/getting-started-with-amazon-guardduty)。
- en: Aggregating findings from multiple accounts in GuardDuty
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 汇总来自多个账户的 GuardDuty 发现
- en: In this recipe, we will configure GuardDuty to **aggregate findings** from multiple
    AWS accounts into a single account. Aggregating findings from multiple accounts
    into a single dedicated account provides a central place to query the findings
    from all our accounts. We can also make configuration changes in one place for
    all the accounts.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个流程中，我们将配置 GuardDuty 以 **聚合发现结果**，将多个 AWS 账户的发现结果汇总到一个账户中。将多个账户的发现结果聚合到一个专用账户中，可以为我们提供一个查询所有账户发现结果的集中位置。我们也可以在一个地方为所有账户进行配置更改。
- en: Getting ready
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: 'We need the following to successfully complete this recipe:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要以下内容来成功完成这个流程：
- en: Two working AWS accounts are required. We will call them the aggregate account
    and the logger account. The aggregate account will aggregate logs from the member
    account.
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 需要两个有效的 AWS 账户。我们将它们称为聚合账户和日志账户。聚合账户将聚合来自成员账户的日志。
- en: Note down the AWS account ID and the email address of the member account. If
    we are using AWS Organizations and IAM Identity Center, as we saw in [*Chapter
    1*](B21384_01.xhtml#_idTextAnchor020) , we can get these from the management account
    within the AWS Organizations service or the IAM Identity Center service.
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 记下成员账户的 AWS 账户 ID 和电子邮件地址。如果我们使用的是 AWS Organizations 和 IAM 身份中心，正如我们在 [*第一章*](B21384_01.xhtml#_idTextAnchor020)
    中看到的，我们可以从 AWS Organizations 服务或 IAM 身份中心服务的管理账户中获取这些信息。
- en: We should enable GuardDuty in the aggregate account and member by following
    the *Setting up and using Amazon GuardDuty* recipe from this chapter.
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们应该通过本章节中的 *设置和使用 Amazon GuardDuty* 流程，启用聚合账户和成员账户中的 GuardDuty。
- en: How to do it...
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We can configure GuardDuty to aggregate the findings from member accounts as
    follows:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照以下方式配置 GuardDuty，以聚合成员账户的发现结果：
- en: Go to the **GuardDuty** service in the management console of the aggregate account.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入聚合账户的管理控制台中的 **GuardDuty** 服务。
- en: Click on **Accounts** from the left sidebar.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击 **账户**。
- en: Click on **Add accounts** **by invitation** .
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **通过邀请添加账户**。
- en: Enter the AWS account ID and email address for the member account. Click on
    **Next** .
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入成员账户的 AWS 账户 ID 和电子邮件地址，然后点击 **下一步**。
- en: We should see our account on the **Accounts** page. The **Status** field will
    have the **Invite not** **sent** value.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们应该能在 **账户** 页面看到我们的账户。**状态** 字段将显示 **邀请未发送**。
- en: Select the account we just added, click on the **Actions** dropdown, and click
    on **Invite** .
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择我们刚刚添加的账户，点击 **操作** 下拉菜单，然后点击 **邀请**。
- en: On the pop-up screen, you may optionally provide a message. Leave the selection
    for **Also send an email notification to the root user on the invitee’s AWS account
    and generate an alert in the invitee’s Personal Health Dashboard** unchecked and
    click on **Send invitation.** The status of our account should change to **Invited**
    .
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在弹出窗口中，您可以选择性地提供消息。保持 **同时向受邀者 AWS 账户的根用户发送电子邮件通知，并在受邀者的个人健康仪表板中生成警报** 的选项未选中，然后点击
    **发送邀请**。我们账户的状态应该会变为 **已邀请**。
- en: Go to the **GuardDuty** service in the management console of the member account.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入成员账户的管理控制台中的 **GuardDuty** 服务。
- en: If we are enabling GuardDuty now, we will be taken to the **Invitations** page
    after enabling. Otherwise, go to the **Accounts** page from the left sidebar and
    click **Accept invitation** .
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们现在启用 GuardDuty，启用后将跳转到 **邀请** 页面。否则，请从左侧边栏进入 **账户** 页面并点击 **接受邀请**。
- en: Click on **Settings** from the left sidebar to go to the **Settings** page and
    click on **Generate** **sample findings** .
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击 **设置**，进入 **设置** 页面并点击 **生成** **示例发现**。
- en: Go to the **GuardDuty** dashboard in the aggregator account and check for findings
    from our member account.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入聚合账户中的 **GuardDuty** 仪表板，检查是否有来自我们成员账户的发现结果。
- en: In this recipe, we configured a member account to send logs to an aggregator
    account. The aggregate account will aggregate logs from the member account that
    we added and any other member accounts we will add later.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个流程中，我们配置了一个成员账户，将日志发送到聚合账户。聚合账户将聚合来自我们添加的成员账户以及以后添加的任何其他成员账户的日志。
- en: How it works...
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: First, we logged in to the main account, which is the account that will aggregate
    all GuardDuty findings. We then invited a member account. We had already noted
    down the account ID, and so it should have known the root email address of this
    account. We then logged in to our member account and accepted the invitation.
    After that, we generated sample findings from the member account. Finally, we
    logged back into our main account and verified that the findings from the member
    account were now present in the main account.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们登录到主账户，这个账户将聚合所有 GuardDuty 发现结果。然后，我们邀请了一个成员账户。我们已经记下了该账户的账户 ID，并且应该知道该账户的根邮箱地址。接着，我们登录到成员账户并接受邀请。之后，我们从成员账户生成了示例发现结果。最后，我们重新登录到主账户并验证，发现成员账户的发现结果已经出现在主账户中。
- en: There’s more...
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'GuardDuty retains the generated findings for 90 days. It exports the active
    findings to Amazon EventBridge (EventBridge). Additionally, we have the option
    to export these findings to an Amazon S3 bucket. This allows us to track historical
    data of potentially suspicious activities in our account and assess the effectiveness
    of the recommended remediation steps. We can do this by following these steps:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: GuardDuty 会保留生成的发现结果 90 天。它将活动发现结果导出到 Amazon EventBridge（EventBridge）。此外，我们还可以选择将这些发现结果导出到
    Amazon S3 存储桶。这使我们能够跟踪账户中潜在可疑活动的历史数据，并评估推荐的修复步骤的有效性。我们可以按照以下步骤进行：
- en: 'Configure the KMS key as follows:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按如下方式配置 KMS 密钥：
- en: '**Create or choose a KMS key** : Select an existing KMS key or create a new
    one.'
  id: totrans-121
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**创建或选择一个 KMS 密钥**：选择现有的 KMS 密钥或创建一个新的密钥。'
- en: '**Attach a policy to the KMS key** : Attach a policy to the KMS key to grant
    GuardDuty access. Refer to the **guardduty_kms_policy.json** file from the code
    files for sample policy content.'
  id: totrans-122
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**将策略附加到 KMS 密钥**：将策略附加到 KMS 密钥，以授予 GuardDuty 访问权限。请参阅代码文件中的**guardduty_kms_policy.json**文件，了解示例策略内容。'
- en: 'Configure the S3 bucket as follows:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按如下方式配置 S3 存储桶：
- en: '**Choose an S3 bucket** : Either create a new bucket or use an existing one.'
  id: totrans-124
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**选择一个 S3 存储桶**：可以创建一个新的存储桶或使用现有的存储桶。'
- en: '**Update the bucket policy** : Update the bucket policy to allow GuardDuty
    uploads. Refer to the **guardduty_s3_bucket_policy.json** file from the code files
    for sample policy content.'
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**更新存储桶策略**：更新存储桶策略以允许 GuardDuty 上传。请参阅代码文件中的**guardduty_s3_bucket_policy.json**文件，了解示例策略内容。'
- en: 'Configure findings export in GuardDuty Console as follows:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 GuardDuty 控制台中按如下方式配置发现导出：
- en: Got to the GuardDuty dashboard.
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 GuardDuty 仪表盘。
- en: Navigate to **Settings** by clicking on the **Settings** option from the left
    sidebar.
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击左侧边栏的**设置**选项进入**设置**。
- en: 'Configure **Export Options** as follows:'
  id: totrans-129
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按如下方式配置**导出选项**：
- en: Scroll down to the **Finding export** **options** section.
  id: totrans-130
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动到**发现导出** **选项**部分。
- en: Click on **Configure now** .
  id: totrans-131
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**立即配置**。
- en: Enter the S3 bucket and KMS key ARNs. Provide the ARN of the S3 bucket where
    the findings will be exported. Provide the ARN of the KMS key to encrypt the findings.
  id: totrans-132
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 S3 存储桶和 KMS 密钥的 ARN。提供将导出发现结果的 S3 存储桶 ARN。提供用于加密发现结果的 KMS 密钥 ARN。
- en: Click on **Save** to apply the settings.
  id: totrans-133
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**以应用设置。
- en: By following the preceding steps, we can configure AWS GuardDuty to export its
    findings to an S3 bucket, ensuring that the data is aggregated and secured across
    accounts and regions. Please make sure that you update the sample policy files
    with actual values as needed.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行上述步骤，我们可以配置 AWS GuardDuty 将其发现结果导出到 S3 存储桶，确保跨账户和区域聚合并保护数据。请确保根据需要使用实际值更新示例策略文件。
- en: See also
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Read more about the export findings feature in GuardDuty at [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_exportfindings.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_exportfindings.html)
    .
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在 GuardDuty 中阅读有关导出发现功能的更多信息：[https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_exportfindings.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_exportfindings.html)。
- en: Setting up and using Amazon Macie
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置和使用 Amazon Macie
- en: In this recipe, we will learn how to set up and use Amazon Macie. Macie is a
    machine learning-powered service in AWS and is used primarily to discover, classify,
    and protect sensitive data. Macie can analyze data in S3 buckets to find sensitive
    information, such as credentials, financial information, **Protected Health Information**
    ( **PHI** ), **Personally Identifiable Information** ( **PII** ), **API keys**
    , source code, and so on, and then classify them into different security levels.
    Macie can be used with CloudWatch to raise alarms and send notifications. Macie
    can also analyze API calls from CloudTrail to detect anomalies.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在本文档中，我们将学习如何设置和使用 Amazon Macie。Macie 是 AWS 中基于机器学习的服务，主要用于发现、分类和保护敏感数据。Macie
    可以分析 S3 存储桶中的数据，以查找诸如凭据、财务信息、**受保护健康信息**（**PHI**）、**个人可识别信息**（**PII**）、**API 密钥**、源代码等敏感信息，并将其分类为不同的安全级别。Macie
    可与 CloudWatch 配合使用来发出警报并发送通知。Macie 还可以分析来自 CloudTrail 的 API 调用以检测异常。
- en: Getting ready
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'We need the following to successfully complete this recipe:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要以下内容才能成功完成此文档：
- en: We will need a working AWS account and a user, as described in the *Technical*
    *requirements* section.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要一个有效的 AWS 帐户和用户，如*技术要求*部分所述。
- en: We need an S3 bucket. The bucket should be in the same region in which we configure
    Macie. I have created a bucket in the **us-east-1** region.
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要一个 S3 存储桶。存储桶应该位于我们配置 Macie 的同一区域中。我已在**us-east-1**区域创建了一个存储桶。
- en: 'Our S3 bucket should have the following files with fake sensitive data and
    are provided with the code files associated with the chapter:'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们的 S3 存储桶应包含以下带有假敏感数据的文件，并提供与章节相关的代码文件：
- en: '**credit-cards-data.txt** with sample credit card data'
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**credit-cards-data.txt**带有样本信用卡数据'
- en: '**custom-data-license-plates.txt** with sample license plates'
  id: totrans-145
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**custom-data-license-plates.txt**带有样本车牌'
- en: How to do it...
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做…
- en: 'We can configure Macie to discover and classify risks in an S3 bucket as follows:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照以下步骤配置 Macie 来发现和分类 S3 存储桶中的风险：
- en: Go to the **Amazon Macie** service in the AWS management console.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到 AWS 管理控制台中的**Amazon Macie**服务。
- en: Important note
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: If we are using Macie for the first time, we should see a page with a **Get
    started** button. Click on **Get started** . Make sure that the region selected
    is the same as our bucket, view the service role permissions, and enable Macie
    to start a 30-day trial. We will then be taken to the **Summary** page. The 30-day
    free trial of automated sensitive data discovery does not cover sensitive data
    discovery jobs. If you initiate and execute a job, you will incur charges based
    on the total volume of uncompressed data analyzed by the job.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们是第一次使用 Macie，应该会看到一个带有**开始**按钮的页面。单击**开始**。确保所选的区域与我们的存储桶相同，查看服务角色权限，并启用
    Macie 开始 30 天的试用期。然后我们将进入**摘要**页面。自动敏感数据发现的 30 天免费试用不包括敏感数据发现作业。如果您启动并执行作业，则将根据作业分析的未压缩数据总量收取费用。
- en: Click on **Jobs** in the left sidebar of the Macie dashboard.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Macie 仪表板的左侧边栏中单击**作业**。
- en: Important note
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: If we haven’t configured a repository for our sensitive data discovery results,
    we will get a warning. We need to set up this repository within 30 days of enabling
    Macie. Please note that Macie only stores our sensitive data discovery results
    and findings for 90 days. We can click on **Configure** now to configure an existing
    or new bucket as the repository for sensitive data discovery results, or we can
    do it later (within 30 days) using the **Discovery results** menu item under **Settings**
    on the left sidebar.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们尚未为敏感数据发现结果配置存储库，将收到警告。我们需要在启用 Macie 后的 30 天内设置此存储库。请注意，Macie 仅存储我们的敏感数据发现结果和发现结果，有效期为
    90 天。我们可以立即单击**配置**以配置现有或新的存储桶作为敏感数据发现结果的存储库，或者我们可以稍后（在 30 天内）使用**设置**左侧边栏下的**发现结果**菜单项进行配置。
- en: Click on **Create job** to initiate the job creation process.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**创建作业**以启动作业创建过程。
- en: On the **Choose S3 buckets** page, opt for **Select specific buckets** to select
    the buckets you want to include in the job. We will select the bucket we created
    in the *Getting ready* section of this recipe.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择 S3 存储桶**页面，选择**选择特定的存储桶**以选择要在作业中包含的存储桶。我们将选择在本文档的*准备工作*部分创建的存储桶。
- en: Scroll down and click on **Next** .
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 滚动到底部并单击**下一步**。
- en: For the **Review S3 buckets** page, review and verify our bucket selections,
    and then choose **Next** .
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**审查 S3 存储桶**页面，请审查和验证我们的存储桶选择，然后选择**下一步**。
- en: For the **Refine the scope** page, choose **One-time job** , provide the **100%**
    value for **Sampling depth** , and click on **Next** .
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**精细化范围**页面，选择**一次性作业**，为**采样深度**提供**100%**的值，然后点击**下一步**。
- en: Important note
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Instead of choosing **One-time job** , we can select the **Scheduled job** option
    and set **Update frequency** to **Daily** , **Weekly** , or **Monthly** , but
    let us select **One-time job** for this recipe. Under **Advanced settings** ,
    we can specify criteria to include or exclude certain objects from the job’s analysis.
    If no criteria are provided, the job will analyze all objects in the buckets.
    For now, we should leave these settings as their defaults.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 不选择**一次性作业**，我们可以选择**定期作业**选项，并将**更新频率**设置为**每日**、**每周**或**每月**，但让我们为这个示例选择**一次性作业**。在**高级设置**下，我们可以指定包含或排除某些对象的标准以进行作业分析。如果没有提供标准，作业将分析存储桶中的所有对象。目前，我们应该将这些设置保持为默认设置。
- en: For **Managed data identifier options** , select **Recommended** .
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**管理的数据标识符选项**，选择**推荐**。
- en: '![Figure 8.5 – Managed data identifier options](image/B21384_08_5.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![图8.5 – 管理的数据标识符选项](image/B21384_08_5.jpg)'
- en: Figure 8.5 – Managed data identifier options
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.5 – 管理的数据标识符选项
- en: Scroll down and click **Next** .
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动并点击**下一步**。
- en: For **Custom data identifiers** , don’t add anything and click **Next** .
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**自定义数据标识符**，不添加任何内容，然后点击**下一步**。
- en: For **Select allow lists** , don’t add anything, and click **Next** .
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于**选择允许列表**，不添加任何内容，然后点击**下一步**。
- en: On the **Enter general settings** pane, enter **AWS Sec CB Demo** under **Job
    name** . Optionally, provide a job description and add any tags as needed. Click
    **Next** .
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**输入常规设置**窗格中，在**作业名称**下输入**AWS Sec CB Demo**。可选地，提供作业描述并根据需要添加任何标签。点击**下一步**。
- en: On the **Review and create** page, take a moment to carefully examine the configuration
    settings to ensure their accuracy, and review the estimated total cost of the
    job. Click on **Submit** .
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**审阅和创建**页面上，仔细检查配置设置以确保其准确性，并查看作业的预估总成本。点击**提交**。
- en: If we go to the **Jobs** page, the status of our job will be **Active (Running)**
    . Wait until the status is **Complete** . It could take 10 to 15 minutes.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们转到**作业**页面，我们的作业状态将为**活动（运行中）**。等到状态变为**完成**。可能需要10到15分钟。
- en: Click on the hyper-linked job name from the list, and from the **Show results**
    dropdown, click on **Show findings** to view the findings. Click on the finding
    to learn more about it.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从列表中点击超链接作业名称，然后从**显示结果**下拉菜单中，点击**显示发现**以查看发现情况。点击发现以了解更多信息。
- en: '![Figure 8.6 – The Macie Findings tab](image/B21384_08_6.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![图8.6 – Macie发现选项卡](image/B21384_08_6.jpg)'
- en: Figure 8.6 – The Macie Findings tab
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.6 – Macie发现选项卡
- en: In this section, we saw how we can use Amazon Macie to find the S3 objects that
    contain financial information such as bank account numbers or credit card numbers.
    Next, we will see how we can use a custom Macie data identifier.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们看到如何使用Amazon Macie查找包含银行账号或信用卡号等财务信息的S3对象。接下来，我们将看到如何使用自定义的Macie数据标识符。
- en: Adding a custom Macie data identifier
  id: totrans-174
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 添加自定义的Macie数据标识符
- en: 'We can configure and use a custom Macie data identifier as follows:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照以下步骤配置和使用自定义的Macie数据标识符：
- en: Navigate back to the Macie service in the AWS Management Console.
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航回AWS管理控制台中的Macie服务。
- en: Click on **Custom data identifiers** in the left sidebar.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧边栏中的**自定义数据标识符**。
- en: Click on **Create** .
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建**。
- en: 'Provide **UKLicensePlates** under **Name** . For **Description - optional**
    , enter **UK License Plates** , and set the **Regular expression** as the following:
    **([0-9][a-zA-Z][a-zA-Z]-?[0-9][a-zA-Z][a-zA-Z])|([a-zA-Z][a-zA-Z][a-zA-Z]-?[0-9][0-9][0-9])|([a-zA-Z][a-zA-Z]-?[0-9][0-9]-?[a-zA-Z][a-zA-Z])|([0-9][0-9][0-9]-?[a-zA-Z][a-zA-Z][a-zA-Z])|([0-9][0-9][0-9]-?[0-9][a-zA-Z][a-zA-Z])**'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**名称**下提供**UKLicensePlates**。对于**描述 - 可选**，输入**英国车牌**，并将**正则表达式**设置为以下内容：**([0-9][a-zA-Z][a-zA-Z]-?[0-9][a-zA-Z][a-zA-Z])|([a-zA-Z][a-zA-Z][a-zA-Z]-?[0-9][0-9][0-9])|([a-zA-Z][a-zA-Z]-?[0-9][0-9]-?[a-zA-Z][a-zA-Z])|([0-9][0-9][0-9]-?[a-zA-Z][a-zA-Z][a-zA-Z])|([0-9][0-9][0-9]-?[0-9][a-zA-Z][a-zA-Z])**
- en: Leave everything else as default and click **Submit** .
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将其他所有内容保持默认，然后点击**提交**。
- en: Create a new job by following the steps in the previous section; however, on
    the **Custom data identifiers** page, select **UKLicensePlates** , which we created
    in this section.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过按照上一节中的步骤创建新作业；但是，在**自定义数据标识符**页面上，选择在本节中创建的**UKLicensePlates**。
- en: '![Figure 8.7 – Selecting custom data identifiers](image/B21384_08_7.jpg)'
  id: totrans-182
  prefs: []
  type: TYPE_IMG
  zh: '![图8.7 – 选择自定义数据标识符](image/B21384_08_7.jpg)'
- en: Figure 8.7 – Selecting custom data identifiers
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 图8.7 – 选择自定义数据标识符
- en: Once the status of the job is **Complete** on the **Jobs** page, from the **Show
    results** dropdown, click on **Show findings** . We should be able to see a new
    finding corresponding to our custom identifier job.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦任务的状态显示为**完成**，在**任务**页面，从**显示结果**下拉菜单中，点击**显示发现**。我们应该能够看到一个新的发现，对应我们的自定义标识符任务。
- en: How it works...
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Macie can be used to analyze S3 buckets and CloudTrail logs. In this recipe,
    we explored Amazon Macie, a machine learning-powered service in AWS that helps
    discover, classify, and protect sensitive data stored in S3 buckets. We set up
    Macie, initiated a discovery job to scan a specific S3 bucket, and observed how
    it successfully identified pre-defined sensitive data types such as credit card
    numbers. We then extended its capabilities by creating a custom data identifier
    named **UKLicensePlates** using a regular expression to recognize a specific format
    within our S3 bucket. This custom identifier was incorporated into a new discovery
    job. Upon completion, we confirmed that Macie successfully recognized the six
    license plates, showcasing its ability to discover both pre-defined and user-defined
    sensitive data types.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: Macie可以用于分析S3存储桶和CloudTrail日志。在本配方中，我们探索了Amazon Macie，这是一项基于机器学习的AWS服务，帮助发现、分类和保护存储在S3存储桶中的敏感数据。我们设置了Macie，启动了一个发现任务来扫描特定的S3存储桶，并观察它如何成功识别预定义的敏感数据类型，例如信用卡号码。接着，我们通过使用正则表达式创建了一个名为**UKLicensePlates**的自定义数据标识符，以识别存储在S3存储桶中的特定格式。这个自定义标识符被加入到新的发现任务中。任务完成后，我们确认Macie成功识别了六个车牌号码，展示了它在发现预定义和用户定义的敏感数据类型方面的能力。
- en: There’s more...
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'Let’s go through some important concepts related to Macie:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们了解一些与Macie相关的重要概念：
- en: Macie can be used within enterprises for a variety of use cases. Macie can detect
    whether sensitive data or source code has been downloaded from unusual IP addresses.
    Macie can detect which users are causing the most high-risk events. Macie can
    group events by location and help us detect any activity from unknown locations.
    Macie can also give a high-level breakdown of the type of CloudTrail events within
    our account. If we see any unexpected calls, we can drill down to find out the
    root cause.
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Macie可以在企业中用于多种用途。Macie可以检测是否有敏感数据或源代码从异常的IP地址下载。Macie可以检测哪些用户导致了最严重的高风险事件。Macie可以按位置对事件进行分组，帮助我们检测来自未知位置的活动。Macie还可以提供我们账户中CloudTrail事件的高层次分析。如果我们看到任何意外的调用，可以深入调查以找出根本原因。
- en: Both Macie and GuardDuty have an overlap of functionalities related to analyzing
    API calls. Unlike GuardDuty, the focus of Macie is more on access patterns, such
    as uploading or downloading more data than is normally done. In general, it is
    preferable to use Macie alongside GuardDuty for better protection.
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Macie和GuardDuty在分析API调用方面有功能重叠。与GuardDuty不同，Macie的重点更多在于访问模式，例如上传或下载的数据量是否超过正常情况。一般来说，最好将Macie与GuardDuty结合使用，以获得更好的保护。
- en: Macie can be used alongside CloudWatch for raising alarms and sending notifications.
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Macie可以与CloudWatch一起使用，用于触发警报和发送通知。
- en: Macie can aggregate data from multiple accounts. We can add additional accounts
    from the **ACCOUNTS** tab on the **INTEGRATIONS** page after setting up the required
    permissions as mentioned.
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Macie可以汇总来自多个账户的数据。在设置好所需权限后，我们可以从**集成**页面的**账户**选项卡添加其他账户。
- en: Macie currently charges us for S3 content classification and CloudTrail event
    processing.
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Macie目前对S3内容分类和CloudTrail事件处理收费。
- en: Macie is a regional service. Macie must be enabled on a region-by-region basis
    and helps you view findings across all your accounts within each region.
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Macie是一个区域性服务。Macie必须在每个区域逐个启用，并帮助你查看该区域内所有账户的发现。
- en: 'The steps to configure notifications for Macie alerts with Amazon EventBridge
    and SNS can be summarized as follows:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 配置Macie警报通知与Amazon EventBridge和SNS的步骤可以总结如下：
- en: Go to the **Amazon EventBridge** service in the console.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入控制台中的**Amazon EventBridge**服务。
- en: Click on **Rules** under **Buses** from the left sidebar.
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏中点击**总线**下的**规则**。
- en: Click on **Create rule** to go to the **Create** **rule** page.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建规则**进入**创建规则**页面。
- en: On the **Define rule detail** page, provide a name and description for our rule.
    Leave **Event bus** and **Rule type** as **Rule with an event pattern** and click
    on **Next** .
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**定义规则详细信息**页面，为我们的规则提供名称和描述。将**事件总线**和**规则类型**保持为**带有事件模式的规则**，然后点击**下一步**。
- en: In the **Build event pattern** section, scroll down to **Event pattern** .
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**构建事件模式**部分，向下滚动到**事件模式**。
- en: Set **Event source** to **AWS services** .
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置**事件来源**为**AWS 服务**。
- en: Set **AWS service** to **Macie** .
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置**AWS 服务**为**Macie**。
- en: Set **Event Type** to **Macie Finding** .
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置**事件类型**为**Macie 发现**。
- en: Click on **Next** .
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。
- en: In the **Targets** section, under **Select a target** , select **SNS topic**
    from the dropdown.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**目标**部分，选择**选择目标**，从下拉菜单中选择**SNS 主题**。
- en: Select a **Topic** . You can create an SNS topic by following the *Creating
    an SNS topic to send emails* recipe in [*Chapter 7*](B21384_07.xhtml#_idTextAnchor265)
    .
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个**主题**。你可以通过按照[*第 7 章*](B21384_07.xhtml#_idTextAnchor265)中的*创建 SNS 主题以发送电子邮件*流程来创建
    SNS 主题。
- en: Click on **Next** .
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。
- en: Optionally, click **Add new tags** and click on **Next** .
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，点击**添加新标签**，然后点击**下一步**。
- en: Review the rule and click on **Create rule** .
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审查规则并点击**创建规则**。
- en: Navigate back to **Macie service** and create a job for our S3 bucket by following
    the steps in the previous section.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到**Macie 服务**并按照上一部分中的步骤为我们的 S3 存储桶创建任务。
- en: After some time, check the inbox of the email we configured for our SNS topic,
    and we should get an email about our Macie findings.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一段时间后，检查我们为 SNS 主题配置的电子邮件收件箱，我们应该会收到关于 Macie 发现结果的电子邮件。
- en: 'By default, Macie automatically sends its findings to Amazon EventBridge for
    further processing and integration with other AWS services. You have the flexibility
    to configure Macie to deliver findings to additional destinations and define how
    frequently updates are sent to each destination by following these steps:'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Macie 会自动将其发现结果发送到 Amazon EventBridge，进行进一步处理并与其他 AWS 服务集成。你可以根据以下步骤配置
    Macie 将发现结果发送到额外的目标，并定义更新发送到每个目标的频率：
- en: Navigate to the Macie console and click on **settings** on the left sidebar.
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 Macie 控制台，点击左侧边栏上的**设置**。
- en: Scroll down to **Publication of findings** and update the frequency for the
    policy findings.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动到**发现结果发布**，更新策略发现的频率。
- en: See also
  id: totrans-215
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: Read more about Amazon Macie at [https://www.cloudericks.com/blog/getting-started-with-amazon-macie](https://www.cloudericks.com/blog/getting-started-with-amazon-macie)
    .
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 了解更多关于 Amazon Macie 的信息，请访问 [https://www.cloudericks.com/blog/getting-started-with-amazon-macie](https://www.cloudericks.com/blog/getting-started-with-amazon-macie)。
- en: Setting up and using Amazon Inspector
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置和使用 Amazon Inspector
- en: In this recipe, we will learn how to set up and use Amazon Inspector. Inspector
    is a service that performs automated **security assessments** to find vulnerabilities
    or deviations from standard practices for applications deployed on AWS. We can
    check the Inspector’s findings directly in the console or from the detailed assessment
    report provided by the Inspector.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在本流程中，我们将学习如何设置和使用 Amazon Inspector。Inspector 是一项执行自动化**安全评估**的服务，用于发现部署在 AWS
    上的应用程序中的漏洞或偏离标准实践的情况。我们可以直接在控制台中查看 Inspector 的发现结果，或者从 Inspector 提供的详细评估报告中查看。
- en: Getting ready
  id: totrans-219
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'We need the following to successfully complete this recipe:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要以下内容才能成功完成这个流程：
- en: We need a working AWS account and a user, as described in the *Technical* *requirements*
    section.
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要一个有效的 AWS 账户和一个用户，如*技术要求*部分所述。
- en: An EC2 instance in the default VPC, within a public subnet within the VPC, is
    also required. For **Amazon Machine Image (AMI)** , select **Amazon Linux 2023
    AMI** . For **Instance type** , select **t2.micro** . For **Key pair (login)**
    , select an existing one you have access to or create a new one. Under **Network
    settings** , make sure that the value for **Auto-assign public IP** is **Enable**
    , and that **Create security group** is selected with the value for **Allow SSH
    traffic from** set to **Anywhere** .
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 还需要在默认 VPC 中，一个位于 VPC 公共子网的 EC2 实例。对于**Amazon Machine Image (AMI)**，选择**Amazon
    Linux 2023 AMI**。对于**实例类型**，选择**t2.micro**。对于**密钥对（登录）**，选择一个已有的，或者创建一个新的。 在**网络设置**中，确保**自动分配公共
    IP**的值为**启用**，并选择**创建安全组**，同时将**允许 SSH 流量来自**的值设置为**任何地方**。
- en: How to do it...
  id: totrans-223
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行...
- en: 'We can set up Inspector as follows:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按如下方式设置 Inspector：
- en: Go to the **Amazon Inspector** service in the console.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在控制台中进入**Amazon Inspector**服务。
- en: 'If we are logging in for the first time, we should see a **Get started** page.
    Currently, there is a free 15-day trial for accounts that are new to Inspector.
    Click on **Get started** . On the **Activate Inspector** page, we should see a
    message that reads as follows: **When you activate Inspector, you grant Inspector
    permissions to discover, classify, and protect sensitive data in AWS on your behalf
    and to generate findings about potential security issues. This will activate Inspector
    for your account only** . Click on **Activate Inspector** and wait until it is
    fully activated. On the left sidebar, we should get options including the following:'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果是第一次登录，我们应该看到一个**开始使用**页面。目前，对于首次使用 Inspector 的账户，提供 15 天的免费试用。点击 **开始使用**。在
    **激活 Inspector** 页面上，我们应该看到一条如下的消息：**当您激活 Inspector 时，您授权 Inspector 获得权限，代表您在
    AWS 中发现、分类并保护敏感数据，并生成有关潜在安全问题的发现报告。这将仅为您的账户激活 Inspector**。点击 **激活 Inspector**
    并等待完全激活。在左侧边栏中，我们应该能看到如下选项：
- en: '![Figure 8.8 – Amazon Inspector’s left sidebar](image/B21384_08_8.jpg)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.8 – Amazon Inspector 的左侧边栏](image/B21384_08_8.jpg)'
- en: Figure 8.8 – Amazon Inspector’s left sidebar
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.8 – Amazon Inspector 的左侧边栏
- en: If we expand **Findings** , we can see options such as **By vulnerability**
    , **By instance** , **By container image** , **By container repository** , **By
    Lambda function** , and **All findings** . We should also see messages such as
    the following, but it could be different in your case, as Amazon updates its user
    interface and messages frequently.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们展开 **发现**，我们可以看到选项，如 **按漏洞**、**按实例**、**按容器镜像**、**按容器仓库**、**按 Lambda 函数**
    和 **所有发现**。我们还应该会看到类似以下的消息，但由于 Amazon 经常更新其用户界面和消息，具体内容可能会有所不同。
- en: '![Figure 8.9 – Messages post-activating Amazon Inspector](image/B21384_08_9.jpg)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.9 – 启动 Amazon Inspector 后的消息](image/B21384_08_9.jpg)'
- en: Figure 8.9 – Messages post-activating Amazon Inspector
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.9 – 启动 Amazon Inspector 后的消息
- en: Wait for some time, then click on **Account management** from the left sidebar,
    go to the **Instances** tab, and verify that the status of our instance is **Actively
    monitoring** . The **Monitored using** column will have a value of **Agentless**
    as we are using an EBS-backed EC2 instance.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待一段时间后，点击左侧边栏中的 **账户管理**，进入 **实例** 选项卡，验证我们的实例状态是否为 **正在积极监控**。**监控方式** 栏将显示
    **无代理**，因为我们使用的是基于 EBS 的 EC2 实例。
- en: In the left sidebar, expand **Findings** and click on **All findings** .
  id: totrans-233
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧边栏中，展开 **发现**，然后点击 **所有发现**。
- en: '![Figure 8.10 – Inspector’s Findings menu](image/B21384_08_10.jpg)'
  id: totrans-234
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.10 – Inspector 的发现菜单](image/B21384_08_10.jpg)'
- en: Figure 8.10 – Inspector’s Findings menu
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.10 – Inspector 的发现菜单
- en: As we are using a newly launched EC2 instance with Amazon Linux, we won’t see
    many findings, but we should see one with **Severity** as **Medium** for **Port
    22 is reachable from an Internet Gateway –** **TCP** .
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们使用的是刚刚启动的 EC2 实例，并且是 Amazon Linux，我们不会看到太多发现，但我们应该会看到一个 **严重性** 为 **中等**
    的发现，内容为 **端口 22 可通过互联网网关访问 –** **TCP**。
- en: We quickly explored how to see the Inspector findings in this recipe. We will
    look into more options available within Inspector’s dashboard in the *There’s
    more...* section of this recipe.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本节中快速探索了如何查看 Inspector 发现。接下来，我们将在本节的 *更多内容...* 部分中查看 Inspector 仪表板中提供的更多选项。
- en: How it works...
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Amazon Inspector for EC2 scanning extracts metadata from instances and compares
    it to security advisories to produce findings, focusing on package vulnerabilities
    and network reachability issues. Network reachability scans occur every 24 hours,
    while package vulnerability scans have variable frequencies based on the scan
    method. Amazon Inspector employs both agent-based and agentless scan methods,
    depending on the account’s scan mode settings, to collect software inventory and
    detect vulnerabilities.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Inspector 对 EC2 的扫描会从实例中提取元数据，并将其与安全建议进行比较，以生成发现，重点关注软件包漏洞和网络可达性问题。网络可达性扫描每
    24 小时进行一次，而软件包漏洞扫描的频率则根据扫描方式有所不同。Amazon Inspector 根据账户的扫描模式设置，采用基于代理和无代理的扫描方式来收集软件清单并检测漏洞。
- en: Agent-based scans use the SSM agent to continuously collect software inventory
    from eligible instances. These scans identify vulnerabilities in both operating
    systems and application programming language packages in Linux instances. To perform
    agent-based scans, instances must have a supported OS, be SSM managed, and not
    be excluded by specific tags. Amazon Inspector uses various SSM associations and
    plugins to gather inventory data and update vulnerability findings regularly.
    Additionally, agentless scans, part of the hybrid scanning mode, utilize EBS snapshots
    to collect inventory data from instances, scanning for operating system and application
    package vulnerabilities.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 基于代理的扫描使用SSM代理从符合条件的实例中持续收集软件清单。这些扫描在Linux实例中识别操作系统和应用程序编程语言包的漏洞。要执行基于代理的扫描，实例必须具有受支持的操作系统，由SSM管理，并且不被特定标签排除。Amazon
    Inspector使用各种SSM关联和插件定期收集清单数据并更新漏洞发现。此外，无代理扫描作为混合扫描模式的一部分，利用EBS快照从实例中收集清单数据，扫描操作系统和应用程序包漏洞。
- en: 'Amazon Inspector offers two scan modes: agent-based and hybrid scanning. The
    agent-based mode provides continuous scans for SSM-managed instances, while hybrid
    scanning combines both methods, using agent-based scans for SSM-managed instances
    and agentless scans for eligible EBS-backed instances. Users can configure scan
    modes, manage exclusions, and ensure proper SSM agent setup to optimize vulnerability
    detection and maintain effective security monitoring for their EC2 instances.'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Inspector提供两种扫描模式：基于代理的扫描和混合扫描。基于代理的模式为SSM管理的实例提供持续扫描，而混合扫描结合了两种方法，对于SSM管理的实例使用基于代理的扫描，对于符合条件的EBS支持的实例使用无代理扫描。用户可以配置扫描模式，管理排除项，并确保适当设置SSM代理以优化漏洞检测，并保持对其EC2实例的有效安全监控。
- en: There’s more...
  id: totrans-242
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'We explored how EC2 instances are scanned in this recipe. Amazon Inspector
    also supports scanning for the following resources:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这个示例中探讨了EC2实例如何进行扫描。Amazon Inspector还支持对以下资源进行扫描：
- en: '**Amazon Elastic Container Registry** ( **ECR** ): Amazon Inspector scans container
    images stored in Amazon ECR for vulnerabilities. This ensures that container images
    used in your environment are secure and free from known issues.'
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Amazon弹性容器注册表**（**ECR**）：Amazon Inspector扫描存储在Amazon ECR中的容器映像以查找漏洞。这确保您环境中使用的容器映像是安全的且没有已知问题。'
- en: '**AWS Lambda** : Amazon Inspector scans AWS Lambda functions for vulnerabilities,
    checking the code and dependencies to ensure serverless applications remain secure.'
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS Lambda**：Amazon Inspector扫描AWS Lambda函数以查找漏洞，检查代码和依赖项以确保无服务器应用程序保持安全。'
- en: 'In this recipe, we explored the **Findings** option in the left sidebar to
    review the findings. The left sidebar also offers several other options, including
    the following:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们在左侧边栏中探索了**发现**选项以查看发现。左侧边栏还提供了其他几个选项，包括以下内容：
- en: '**Export SBOMs** : The **Software Bill of Materials** ( **SBOM** ) provides
    a detailed list of software components and their relationships within a system.
    Amazon Inspector can generate and export SBOMs, which are helpful for understanding
    and managing software dependencies, ensuring compliance with security policies,
    and identifying potential vulnerabilities. This helps organizations maintain a
    comprehensive inventory of their software components.'
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**导出SBOMs**：**软件材料清单**（**SBOM**）提供了系统内软件组件及其关系的详细列表。Amazon Inspector可以生成和导出SBOMs，这有助于理解和管理软件依赖关系，确保符合安全政策，并识别潜在漏洞。这有助于组织维护其软件组件的全面清单。'
- en: '**Suppression rules** : Suppression rules in Amazon Inspector allow users to
    manage findings by suppressing specific types or sources of findings. This helps
    reduce noise and focus on critical vulnerabilities. Users can create suppression
    rules based on criteria such as vulnerability ID, resource tags, or resource types
    to ensure that only relevant findings are highlighted in security reports.'
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**抑制规则**：Amazon Inspector中的抑制规则允许用户通过抑制特定类型或来源的发现来管理发现。这有助于减少噪音并专注于关键漏洞。用户可以根据漏洞ID、资源标签或资源类型等标准创建抑制规则，以确保安全报告中只突出显示相关的发现。'
- en: '**On-demand scans** : On-demand scans allow users to manually initiate scans
    for vulnerabilities or network reachability issues on EC2 instances as needed.
    This is particularly useful after deploying new software or making significant
    infrastructure changes. Under the **On-demand scans** menu, using the **CIS scans**
    option, we can evaluate the compliance of EC2 instances with **Center for Internet
    Security** ( **CIS** ) benchmarks, which are best practices for securing IT systems
    and data. These scans help organizations adhere to security standards and improve
    their security posture by identifying and addressing non-compliant configurations.'
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**按需扫描**：按需扫描允许用户根据需要手动启动扫描，以检测 EC2 实例的漏洞或网络可达性问题。这在部署新软件或进行重大基础设施变更后特别有用。在
    **按需扫描** 菜单下，使用 **CIS 扫描** 选项，我们可以评估 EC2 实例是否符合 **互联网安全中心**（**CIS**）基准，CIS 基准是保护
    IT 系统和数据的最佳实践。这些扫描帮助组织遵循安全标准，并通过识别和解决不符合标准的配置，提升安全防护水平。'
- en: Note on Inspector Classic
  id: totrans-250
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关于 Inspector Classic 的说明
- en: The Inspector dashboard currently has a sidebar link called **Switch to Inspector
    Classic** . Inspector Classic was the original version of Amazon Inspector, designed
    to help AWS users automate security assessments for their applications by checking
    for vulnerabilities and compliance issues. Although Inspector Classic was initially
    vital, it has largely been replaced by the new Amazon Inspector, which offers
    enhanced features and a more comprehensive, streamlined approach to security assessments.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: Inspector 仪表板当前有一个名为 **切换到 Inspector Classic** 的侧边栏链接。Inspector Classic 是 Amazon
    Inspector 的原始版本，旨在帮助 AWS 用户通过检查漏洞和合规性问题来自动化应用程序的安全评估。尽管 Inspector Classic 最初至关重要，但它已在很大程度上被新的
    Amazon Inspector 所取代，后者提供了增强的功能，并对安全评估提供了更全面、简化的方法。
- en: Inspector Classic remains available for users with existing dependencies, but
    transitioning to the new Amazon Inspector is advisable for the latest features,
    improved performance, and enhanced security capabilities. AWS continues to support
    Inspector Classic for backward compatibility, but new users and assessments should
    use the updated Amazon Inspector for optimal security management. For those interested
    in working with Inspector Classic, refer to the first edition of this book or
    the link provided in the *See* *also* section.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: Inspector Classic 仍然可供已有依赖关系的用户使用，但建议过渡到新的 Amazon Inspector，以便获取最新功能、提高性能和增强的安全能力。AWS
    继续支持 Inspector Classic 以保持向后兼容性，但新用户和评估应该使用更新版的 Amazon Inspector 以实现最佳的安全管理。对于有兴趣使用
    Inspector Classic 的用户，请参阅本书的第一版或在 *另见* *部分* 提供的链接。
- en: See also
  id: totrans-253
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: You can read more about Amazon Inspector at [https://www.cloudericks.com/blog/a-deep-dive-into-amazon-inspector-capabilities-and-integrations](https://www.cloudericks.com/blog/a-deep-dive-into-amazon-inspector-capabilities-and-integrations)
    .
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以阅读更多关于 Amazon Inspector 的内容，访问 [https://www.cloudericks.com/blog/a-deep-dive-into-amazon-inspector-capabilities-and-integrations](https://www.cloudericks.com/blog/a-deep-dive-into-amazon-inspector-capabilities-and-integrations)。
- en: Read about Inspector Classic at [https://www.cloudericks.com/blog/understanding-inspector-classic-and-transitioning-to-the-new-amazon-inspector](https://www.cloudericks.com/blog/understanding-inspector-classic-and-transitioning-to-the-new-amazon-inspector)
    .
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 阅读有关 Inspector Classic 的内容，请访问 [https://www.cloudericks.com/blog/understanding-inspector-classic-and-transitioning-to-the-new-amazon-inspector](https://www.cloudericks.com/blog/understanding-inspector-classic-and-transitioning-to-the-new-amazon-inspector)。
- en: Setting up and using AWS Security Hub
  id: totrans-256
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置和使用 AWS Security Hub
- en: In this recipe, we will explore how to set up and utilize AWS Security Hub.
    Security Hub aggregates findings from services such as Config, GuardDuty, Macie,
    and Inspector, offering a centralized platform to manage security alerts and automate
    compliance checks. Security Hub can do automated compliance checks using the CIS
    AWS Foundations Benchmarks, which is enabled by default when we enable Security
    Hub.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将探讨如何设置和使用 AWS Security Hub。Security Hub 聚合了来自 Config、GuardDuty、Macie
    和 Inspector 等服务的发现，提供了一个集中平台来管理安全警报和自动化合规性检查。Security Hub 可以使用 CIS AWS 基础基准进行自动化合规性检查，在启用
    Security Hub 时默认启用此功能。
- en: Getting ready
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'We need the following to successfully complete this recipe:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要以下内容才能成功完成本教程：
- en: A working AWS account and a user, as described in the *Technical* *requirements*
    section.
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如 *技术* *要求* 部分所述，提供一个有效的 AWS 账户和用户。
- en: Set up AWS Config and enable recording as discussed in the *Setting up and using
    AWS Config* recipe in [*Chapter 7*](B21384_07.xhtml#_idTextAnchor265) .
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按照 *设置和使用 AWS Config* 教程中的说明，设置 AWS Config 并启用记录功能，详见 [*第 7 章*](B21384_07.xhtml#_idTextAnchor265)。
- en: 'Set up one or more of the following services: Amazon GuardDuty, Amazon Macie,
    and Amazon Inspector, following the respective recipes in *Chapters 7* *and* *8*
    .'
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置以下一个或多个服务：Amazon GuardDuty、Amazon Macie 和 Amazon Inspector，按照*第 7 章* 和 *第
    8 章* 中的相应方法进行操作。
- en: How to do it...
  id: totrans-263
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'We can set up Security Hub in a region as follows:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按照以下方式在一个区域内设置 Security Hub：
- en: Go to the **Security Hub** service in the AWS management console.
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入 AWS 管理控制台中的**Security Hub**服务。
- en: If we are using Security Hub for the first time, we should see a **Get started
    with Security Hub** section. Click on **Go to Security Hub** . In the **Enable
    AWS Config** section, we should see a message that AWS Config needs to be enabled
    with recording along with possible steps, which I assume you have done as mentioned
    in the *Getting* *ready* section.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们是第一次使用 Security Hub，应该会看到一个**开始使用 Security Hub**的部分。点击**前往 Security Hub**。在**启用
    AWS Config**部分，我们应该看到一条消息，提示需要启用 AWS Config 并进行记录，可能还会提供相应步骤。我假设你已经按照*准备工作*部分中的内容完成了这些步骤。
- en: '![Figure 8.11 – The Enable AWS Config message while enabling Security Hub](image/B21384_08_11.jpg)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.11 – 启用 Security Hub 时的启用 AWS Config 消息](image/B21384_08_11.jpg)'
- en: Figure 8.11 – The Enable AWS Config message while enabling Security Hub
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.11 – 启用 Security Hub 时的启用 AWS Config 消息
- en: In the **Security standards** section, select the security standards we want
    to enable from the available options as we can see in *Figure 8* *.12* . In the
    **Delegated Administrator** section, we can add a delegated administrator account
    to manage Security Hub for this organization. Finally, click on **Enable** **Security
    Hub** .
  id: totrans-269
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**安全标准**部分，从可用选项中选择我们要启用的安全标准，如*图 8.12*所示。在**委托管理员**部分，我们可以添加一个委托管理员账户来管理该组织的
    Security Hub。最后，点击**启用** **Security Hub**。
- en: '![Figure 8.12 – Setting security standards while enabling Security Hub](image/B21384_08_12.jpg)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.12 – 在启用 Security Hub 时设置安全标准](image/B21384_08_12.jpg)'
- en: Figure 8.12 – Setting security standards while enabling Security Hub
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.12 – 在启用 Security Hub 时设置安全标准
- en: We should see a screen with sections for **Summary** , **Security standards**
    , **Insights** , and so on. It may take some time for the findings to get updated.
    So, wait for some time before proceeding with further steps.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该看到一个包含**摘要**、**安全标准**、**见解**等部分的界面。发现的更新可能需要一些时间。所以，在进行后续步骤之前，请稍等片刻。
- en: Click on **Security standards** from the left sidebar. If we are following on
    from *Step 2* , for the **AWS Foundational Security Best Practices v1.0.0** and
    **CIS AWS Foundations Benchmark v1.2.0** standards, we should see the **View results**
    and **Disable standard** options. For the rest of the standards that are not enabled,
    we should see the **Enable Standard** option. If we are not following on from
    *Step 2* , we should enable the **AWS Foundational Security Best Practices v1.0.0**
    and **CIS AWS Foundations Benchmark v1.2.0** standards using the **Enable Standard**
    option and wait for some time until we see the **Security score** for each standard.
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧边栏中的**安全标准**。如果我们是从*步骤 2*继续操作，针对**AWS Foundational Security Best Practices
    v1.0.0**和**CIS AWS Foundations Benchmark v1.2.0**标准，我们应该能看到**查看结果**和**禁用标准**选项。对于未启用的其他标准，我们应该看到**启用标准**选项。如果我们没有从*步骤
    2*继续操作，我们应该使用**启用标准**选项启用**AWS Foundational Security Best Practices v1.0.0**和**CIS
    AWS Foundations Benchmark v1.2.0**标准，并稍等片刻，直到看到每个标准的**安全得分**。
- en: Once the **Security** score is available for the **AWS Foundational Security
    Best Practices v1.0.0** , click on **View results** . We should see the **Security
    score** and **Failed controls** values such as the following, but the exact details
    could differ from account to account.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦**AWS Foundational Security Best Practices v1.0.0**的**安全得分**可用，点击**查看结果**。我们应该看到**安全得分**和**失败的控制项**值，如下所示，但具体细节可能因账户而异。
- en: '![Figure 8.13 – Viewing the results for a security standard](image/B21384_08_13.jpg)'
  id: totrans-275
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.13 – 查看安全标准的结果](image/B21384_08_13.jpg)'
- en: Figure 8.13 – Viewing the results for a security standard
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.13 – 查看安全标准的结果
- en: Click on **Insights** on the left sidebar. We should see a list of existing
    insights, which are saved filters that display related findings. We can either
    select one of these existing insights or create a new one by clicking on the **Create**
    **insight** button.
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧边栏中的**见解**。我们应该看到一个现有见解的列表，这些是已保存的过滤器，显示相关的发现。我们可以选择其中一个现有的见解，或通过点击**创建**
    **见解**按钮来创建一个新的见解。
- en: '![Figure 8.14 – Insights](image/B21384_08_14.jpg)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.14 – 见解](image/B21384_08_14.jpg)'
- en: Figure 8.14 – Insights
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.14 – 见解
- en: Click on **Findings** in the left sidebar to navigate to the **Findings** page.
    Here, you can view a list of findings from various service integrations. You can
    filter this list based on multiple criteria, such as the service that generated
    the finding or the severity of the finding.
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击**发现**，进入**发现**页面。在这里，您可以查看来自各种服务集成的发现列表。您可以根据多个标准过滤此列表，例如生成发现的服务或发现的严重性。
- en: '![Figure 8.15 – Findings](image/B21384_08_15.jpg)'
  id: totrans-281
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.15 – 发现](image/B21384_08_15.jpg)'
- en: Figure 8.15 – Findings
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.15 – 发现
- en: Click on **Integrations** from the left sidebar to go to the **Integrations**
    page, where we can see the list of integrations currently enabled and those that
    are yet to be enabled. For integrations that are already enabled, we can disable
    them from the **Integrations** page.
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击**集成**，进入**集成**页面，在这里我们可以看到当前启用的集成列表以及尚未启用的集成。对于已启用的集成，我们可以在**集成**页面禁用它们。
- en: '![Figure 8.16 – Integrations](image/B21384_08_16.jpg)'
  id: totrans-284
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.16 – 集成](image/B21384_08_16.jpg)'
- en: Figure 8.16 – Integrations
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.16 – 集成
- en: Click on **Usage** from the left sidebar to see the estimated usage and pricing,
    including **Usage during** **trial period** .
  id: totrans-286
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击**使用情况**，查看估算的使用情况和定价，包括**试用期间的使用情况**。
- en: Go to the **Configuration** from the left sidebar.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏进入**配置**。
- en: 'If central configuration is not enabled, we will see a link to **Start central
    configuration** along with a warning message as follows: **Local configuration
    gives you limited access to security settings for your organization, for new accounts
    only. For additional configuration options, switch to central configuration. You
    can now use configuration policies to configure Security Hub across multiple Regions,
    accounts, and organizational units (OUs). When you switch, configuration policies
    replace the limited configuration settings for new organization accounts. We recommend
    central configuration for** **account management** .'
  id: totrans-288
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果未启用中央配置，我们将看到一个链接**开始中央配置**，并显示以下警告信息：**本地配置仅限于新帐户，您对组织的安全设置的访问有限。如需更多配置选项，请切换到中央配置。切换后，配置策略将替代新组织帐户的有限配置设置。我们建议使用中央配置进行**帐户管理**。
- en: In the **Accounts** section on the **Configuration** page, we can add additional
    member accounts to share their findings with this account. An invitation will
    be sent to the member accounts, and they must accept the invitation.
  id: totrans-289
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**配置**页面的**帐户**部分，我们可以添加额外的成员帐户，与此帐户共享其发现。邀请将发送给成员帐户，他们必须接受邀请。
- en: Click on the **Custom actions** from the left sidebar to send selected insights
    and findings to Amazon EventBridge.
  id: totrans-290
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击**自定义操作**，将选定的洞察和发现发送到 Amazon EventBridge。
- en: Click on **Automations** from the left sidebar to update the Security Hub findings
    based on criteria that we define.
  id: totrans-291
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击**自动化**，根据我们定义的标准更新安全中心发现。
- en: Click on **Regions** in the left sidebar to view findings across multiple regions.
    To start aggregating findings, click on the **Configure finding aggregation**
    button to set an aggregation region and then link other regions to it for a consolidated
    view of your security findings.
  id: totrans-292
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧边栏点击**地区**，查看多个地区的发现。要开始汇总发现，点击**配置发现汇总**按钮，设置汇总地区，然后将其他地区链接到该地区，以便统一查看安全发现。
- en: We can also disable Security Hub by clicking on **General** from the left sidebar
    and clicking on **Disable AWS Security Hub** . However, it is always recommended
    to have Security Hub enabled for all regions if the applicable costs are not a
    constraint.
  id: totrans-293
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们还可以通过点击左侧边栏的**常规**，然后点击**禁用 AWS 安全中心**来禁用安全中心。但是，如果适用的费用不是限制因素，始终建议为所有地区启用安全中心。
- en: How it works...
  id: totrans-294
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: AWS Security Hub acts as a centralized platform for security monitoring and
    management within the AWS environment. To get started, activate the service in
    the AWS Management Console. Once enabled, configure Security Hub to gather findings
    from a range of AWS services such as Amazon GuardDuty, AWS Inspector, and Amazon
    Macie, along with third-party tools and custom integrations.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: AWS 安全中心作为 AWS 环境中安全监控和管理的集中平台。要开始使用，请在 AWS 管理控制台中激活该服务。启用后，配置安全中心以从多个 AWS 服务（如
    Amazon GuardDuty、AWS Inspector 和 Amazon Macie）收集发现，以及第三方工具和自定义集成。
- en: The service provides continuous monitoring for security issues, collecting and
    organizing findings on a unified dashboard. It prioritizes these findings based
    on their severity and impact, helping users to address the most critical issues
    first. Within the Security Hub console, users can investigate these findings to
    gain insights into potential security threats and vulnerabilities. Additionally,
    Security Hub supports automated responses through AWS Lambda integration, allowing
    users to automate remediation actions for detected security issues.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 该服务为安全问题提供持续监控，在统一的仪表板上收集和组织发现。它根据问题的严重性和影响优先排序，帮助用户首先解决最关键的问题。在 Security Hub
    控制台中，用户可以调查这些发现，以深入了解潜在的安全威胁和漏洞。此外，Security Hub 还通过与 AWS Lambda 集成支持自动响应，允许用户对检测到的安全问题自动执行修复措施。
- en: In summary, AWS Security Hub offers a comprehensive solution for managing security
    posture, compliance, and incident response, thereby streamlining security operations
    and enhancing overall protection within the AWS environment.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，AWS Security Hub 提供了一个全面的解决方案，用于管理安全态势、合规性和事件响应，从而简化了安全操作并增强了 AWS 环境中的整体保护。
- en: There’s more...
  id: totrans-298
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: 'Let’s quickly go through some important concepts around Security Hub and its
    related services:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速浏览一下与 Security Hub 及其相关服务相关的一些重要概念：
- en: Security Hub is a regional service. If cost is not a constraint, it is recommended
    to enable it in all regions.
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Security Hub 是一个区域性服务。如果成本不是问题，建议在所有区域启用它。
- en: Security Hub can integrate with third-party security tools such as Alert Logic,
    Armor, Atlassian Opsgenie, and more.
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Security Hub 可以与第三方安全工具集成，如 Alert Logic、Armor、Atlassian Opsgenie 等。
- en: We can archive security findings from the **Findings** page so that older ones
    won’t appear on the page.
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以从 **发现** 页面归档安全发现，以便旧的发现不会出现在页面上。
- en: The CIS provides security standards for different servers, applications, and
    cloud providers. For example, they provide a set of security standards that are
    specific to AWS security.
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CIS 为不同的服务器、应用程序和云提供商提供安全标准。例如，它们为 AWS 安全提供了一套特定的安全标准。
- en: 'CIS Benchmarks for AWS can be categorized into four categories: identity and
    access management, logging, monitoring, and networking.'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS 的 CIS 基准可以分为四类：身份与访问管理、日志记录、监控和网络。
- en: IAM Access Analyzer uses logic-based reasoning to analyze resource-based policies
    in our AWS environment to inform us which resources in our account are shared
    with external principals.
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IAM 访问分析器使用基于逻辑的推理分析我们 AWS 环境中的基于资源的策略，以告知我们账户中的哪些资源与外部主体共享。
- en: AWS Firewall Manager can be used to manage firewall rules across accounts and
    applications.
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS 防火墙管理器可用于跨账户和应用程序管理防火墙规则。
- en: Learning about and understanding the CIS security benchmark controls for AWS
    will provide us with a better sense of security while working with AWS infrastructure.
    These controls can also help us make better decisions at work and even during
    exams.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 学习和理解 AWS 的 CIS 安全基准控制，可以在处理 AWS 基础设施时为我们提供更强的安全感。这些控制措施还可以帮助我们在工作中做出更好的决策，甚至在考试时也能有所帮助。
- en: See also
  id: totrans-308
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Read more about AWS Security Hub at [https://www.cloudericks.com/blog/getting-started-with-aws-security-hub](https://www.cloudericks.com/blog/getting-started-with-aws-security-hub)
    .
  id: totrans-309
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解更多关于 AWS Security Hub 的信息，请访问 [https://www.cloudericks.com/blog/getting-started-with-aws-security-hub](https://www.cloudericks.com/blog/getting-started-with-aws-security-hub)。
- en: You can find the list of CIS security standards supported by Security Hub at
    [https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards.html](https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards.html)
    .
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以在 [https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards.html](https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards.html)
    查找 Security Hub 支持的 CIS 安全标准列表。
- en: Using IAM Access Analyzer to inspect unused access
  id: totrans-311
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 IAM 访问分析器检查未使用的访问权限
- en: In this recipe, we will demonstrate how to utilize IAM Access Analyzer to identify
    and manage unused IAM resources within our environment. By focusing on detecting
    unused roles, access keys, and other critical components, we ensure adherence
    to security best practices. Through the process of configuring the analyzer to
    scan for unused resources, and interpreting the findings it generates, we gain
    valuable insights into potential security risks. By addressing any identified
    unused resources, we mitigate the risk of unauthorized access or misuse, enhancing
    the overall security posture of our IAM environment.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 在本示例中，我们将展示如何利用 IAM 访问分析器来识别和管理环境中未使用的 IAM 资源。通过重点检测未使用的角色、访问密钥和其他关键组件，确保遵循安全最佳实践。通过配置分析器扫描未使用的资源，并解释其生成的结果，我们可以获得潜在安全风险的有价值见解。通过处理任何识别出的未使用资源，我们降低了未授权访问或滥用的风险，从而增强了
    IAM 环境的整体安全性。
- en: Getting ready
  id: totrans-313
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'We need the following to successfully complete this recipe:'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 成功完成此示例所需的条件：
- en: A working AWS account and a user, as described in the *Technical* *requirements*
    section.
  id: totrans-315
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个有效的 AWS 账户和一个用户，如*技术要求*部分所述。
- en: We need to have some IAM users and roles within our AWS account; we can create
    these by referring to the recipes in *Chapters 1* *and* *2* .
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们需要在 AWS 账户中有一些 IAM 用户和角色；可以通过参考*第 1 章* *和* *第 2 章*中的示例来创建这些。
- en: How to do it...
  id: totrans-317
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We can use IAM Analyzer to inspect unused access as follows:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以按如下方式使用 IAM 分析器检查未使用的访问权限：
- en: Navigate to the **IAM** service in the console.
  id: totrans-319
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到控制台中的**IAM**服务。
- en: Under **Access reports** , click on **Access Analyzer** .
  id: totrans-320
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**访问报告**下，点击**访问分析器**。
- en: Click on **Create analyzer** .
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建分析器**。
- en: In the **Analysis** section, we can see options for **External access analysis**
    and **Unused access analysis** . Select the **Unused access** **analysis** option.
  id: totrans-322
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**分析**部分，我们可以看到**外部访问分析**和**未使用的访问分析**选项。选择**未使用的访问** **分析**选项。
- en: '![Figure 8.17 – Configuring the Findings type](image/B21384_08_17.jpg)'
  id: totrans-323
  prefs: []
  type: TYPE_IMG
  zh: '![图 8.17 – 配置结果类型](image/B21384_08_17.jpg)'
- en: Figure 8.17 – Configuring the Findings type
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.17 – 配置结果类型
- en: In the **Analyzer details** section, leave the autogenerated **Name** for our
    Analyzer as-is. For **Zone of trust** , select **Current organization** .
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**分析器详情**部分，保持自动生成的**名称**不变。对于**信任区**，选择**当前组织**。
- en: Scroll down and click **Create analyzer** . Wait for some time for the findings
    to be populated.
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向下滚动并点击**创建分析器**。等待一段时间，直到结果被加载出来。
- en: Click on **Access Analyzer** in the left sidebar to see the **Findings overview**
    page that contains the findings summary.
  id: totrans-327
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧边栏点击**访问分析器**，以查看包含结果摘要的**结果概览**页面。
- en: Click on **Unused access** from the left sidebar. We should see findings related
    to unused access.
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧边栏中的**未使用的访问权限**。我们应该看到与未使用访问权限相关的结果。
- en: How it works...
  id: totrans-329
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Using IAM Analyzer to inspect unused access works by employing it as a security
    scanner for your IAM resources. It analyzes roles, access keys, and permissions
    across your environment. By examining how recently these resources were used,
    it identifies elements that haven’t been active for a specific period. This can
    indicate unnecessary access or forgotten configurations, potentially posing security
    vulnerabilities. With these insights, you can tighten access controls and improve
    the security posture of your IAM environment.
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 IAM 分析器检查未使用的访问权限，方法是将其作为安全扫描器来检查 IAM 资源。它分析整个环境中的角色、访问密钥和权限。通过检查这些资源最近是否被使用，它能够识别在特定期间内未被激活的元素。这可能表明不必要的访问权限或被遗忘的配置，可能会导致安全漏洞。通过这些见解，你可以加强访问控制并改善
    IAM 环境的安全性。
- en: There’s more...
  id: totrans-331
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: 'While identifying unused resources is a valuable capability, IAM Analyzer offers
    a broader range of functionalities to enhance your IAM security posture:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管识别未使用的资源是一项有价值的功能，但 IAM 分析器还提供了更广泛的功能，帮助增强你的 IAM 安全性。
- en: '**Verifying Permissions** : IAM Analyzer can validate policies against best
    practices and identify overly permissive settings that could grant unintended
    access.'
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**验证权限**：IAM 分析器可以根据最佳实践验证策略，并识别可能授予无意访问权限的过度宽松设置。'
- en: '**Monitoring External Sharing** : Keep track of resources shared with external
    entities outside your AWS account. This helps identify potential security risks
    associated with unintended access granted to external users or applications.'
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**监控外部共享**：跟踪与 AWS 账户外部实体共享的资源。这有助于识别与无意访问权限相关的潜在安全风险，可能是外部用户或应用程序的权限。'
- en: '**Custom Policy Checks** : Define your own security standards and leverage
    IAM Analyzer to validate IAM policies against these custom checks. This empowers
    you to enforce specific security requirements within your organization.'
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自定义策略检查**：定义你自己的安全标准，并利用IAM分析器根据这些自定义检查验证IAM策略。这使你能够在组织内强制执行特定的安全要求。'
- en: '**Automating Policy Generation** : Simplify policy creation by leveraging IAM
    Analyzer’s ability to generate IAM policies based on access activity logs from
    CloudTrail. This streamlines the process and helps ensure policies reflect actual
    usage patterns.'
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动化策略生成**：通过利用IAM分析器根据CloudTrail中的访问活动日志生成IAM策略，简化策略创建过程。这有助于确保策略反映实际的使用模式。'
- en: '**Continuous Monitoring** : IAM Analyzer is not a one-time scan; it provides
    ongoing monitoring of your IAM environment. This allows for the proactive identification
    of potential security issues as your IAM configuration evolves.'
  id: totrans-337
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**持续监控**：IAM分析器不是一次性的扫描工具；它提供对你的IAM环境的持续监控。这允许你在IAM配置变化时主动识别潜在的安全问题。'
- en: 'The steps to set up Amazon EventBridge to monitor our findings from Access
    Analyzer can be summarized as follows:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 设置Amazon EventBridge来监控我们从Access Analyzer获取的结果的步骤总结如下：
- en: Go to the **Amazon EventBridge** service in the console.
  id: totrans-339
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到控制台中的**Amazon EventBridge**服务。
- en: Click on **Rules** under **Buses** from the left sidebar.
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧边栏的**总线**下点击**规则**。
- en: Click on **Create rule** to go to the **Create** **rule** page.
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**创建规则**进入**创建规则**页面。
- en: On the **Define rule detail** page, provide a name and description for our rule.
    Leave the **Event bus** as **default** and **Rule type** as **Rule with an event
    pattern** and click on **Next** .
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**定义规则详细信息**页面，提供规则的名称和描述。保持**事件总线**为**默认**，并将**规则类型**设置为**带有事件模式的规则**，然后点击**下一步**。
- en: In the **Build event pattern** section, scroll down to **Event pattern** .
  id: totrans-343
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**构建事件模式**部分，向下滚动至**事件模式**。
- en: Set **Event source** to **AWS services** .
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**事件源**设置为**AWS服务**。
- en: Set **AWS service** to **Access Analyzer** .
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**AWS服务**设置为**Access Analyzer**。
- en: Set **Event Type** to **Access** **Analyzer Finding** .
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**事件类型**设置为**访问** **分析器查找**。
- en: Set **Event Type Specification 1** to **Any resource** **by ARN** .
  id: totrans-347
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**事件类型规格1**设置为**按ARN的任何资源**。
- en: Click on **Next** . Under **Targets** , Choose **SNS topic** from the dropdown
    under **Select** **a target** .
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。在**目标**下，从**选择目标**的下拉菜单中选择**SNS主题**。
- en: Select a topic. You can create an SNS topic by following the *Creating an SNS
    topic to send emails* recipe in [*Chapter 7*](B21384_07.xhtml#_idTextAnchor265)
    .
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个主题。你可以通过参考[**第7章**](B21384_07.xhtml#_idTextAnchor265)中的*创建SNS主题以发送电子邮件*食谱来创建SNS主题。
- en: Click on **Next** .
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**下一步**。
- en: Optionally, click **Add new tags** and click on **Next** .
  id: totrans-351
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选，点击**添加新标签**，然后点击**下一步**。
- en: Review the rule and click on **Create rule** .
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 审核规则后点击**创建规则**。
- en: See also
  id: totrans-353
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: Read about essential tools to Secure IAM at [https://www.cloudericks.com/blog/essential-tools-to-secure-iam](https://www.cloudericks.com/blog/essential-tools-to-secure-iam)
    .
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 阅读有关确保IAM安全的必要工具，详情请见[https://www.cloudericks.com/blog/essential-tools-to-secure-iam](https://www.cloudericks.com/blog/essential-tools-to-secure-iam)。
