- en: '12'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '12'
- en: Analyzing Compromised Cloud Productivity Suites
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分析被妥协的云生产力套件
- en: The reality is that most cloud-based security incidents within an organization
    will occur at the productivity suite level. As we discussed in [*Chapter 7*](part0026_split_000.html#_idTextAnchor137),
    Microsoft 365 and Google Workspace are the most popular SaaS-based platforms in
    the industry. Organizations rely on Microsoft 365 and Google Workspace for business
    applications and services such as email, storage, office applications, and much
    more. Through the rise in the adoption of SaaS-based email solutions through Microsoft
    365 and Google Workspace by corporations, these platforms have become a prime
    target for business email compromise attacks. Since these email accounts are integrally
    linked to other services within 365 and Workspace, such compromises also pose
    a risk to any additional service connected to the user’s account, amplifying the
    potential for broader security breaches and a larger impact.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 现实情况是，组织内部的大多数基于云的安全事件都发生在生产力套件层面。正如我们在 [*第7章*](part0026_split_000.html#_idTextAnchor137)中讨论的那样，Microsoft
    365 和 Google Workspace 是行业中最受欢迎的基于 SaaS 的平台。组织依赖 Microsoft 365 和 Google Workspace
    来处理业务应用程序和服务，如电子邮件、存储、办公应用程序等。随着越来越多的公司采用基于 SaaS 的电子邮件解决方案，Microsoft 365 和 Google
    Workspace 已成为企业邮箱诈骗攻击的主要目标。由于这些电子邮件账户与 365 和 Workspace 内的其他服务密切相关，因此这些妥协行为也会对与用户账户连接的任何其他服务构成风险，放大了更广泛的安全漏洞和更大影响的可能性。
- en: 'This chapter will dive into the details of compromised productivity suites,
    specifically Microsoft 365 and Google Workspace, from start to finish. We will
    discuss the following topics in this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将深入探讨被妥协的生产力套件，特别是 Microsoft 365 和 Google Workspace，从头到尾。我们将在本章中讨论以下主题：
- en: Business email compromise explained
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 企业邮箱诈骗解析
- en: Initial scoping and remediation steps
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 初步范围界定与修复步骤
- en: Microsoft 365 incident response
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft 365 事件响应
- en: Google Workspace incident response
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Google Workspace 事件响应
- en: Business email compromise explained
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 企业邮箱诈骗解析
- en: '**Business email compromise** (**BEC**) is a sophisticated type of cyber fraud
    targeting organizations through deceptive practices involving email communications.
    This threat exploits the reliance of businesses on email for corporate correspondence,
    manipulating trust and authority to execute some sort of unauthorized fund transfers,
    obtain sensitive information, or move laterally into the IT network.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '**企业邮箱诈骗**（**BEC**）是一种复杂的网络欺诈类型，通过涉及电子邮件通讯的欺骗行为，针对组织实施攻击。此类威胁利用企业依赖电子邮件进行公司通讯的特性，操纵信任和权威执行某些未经授权的资金转移、获取敏感信息或在IT网络中进行横向移动。'
- en: BEC attack phases
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BEC 攻击阶段
- en: 'The phases that attackers utilize to conduct BEC attacks are demonstrated in
    *Figure 12**.1*:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者利用的 BEC 攻击阶段在*图 12.1* 中展示：
- en: '![Figure 12.1 – BEC attack phases](img/00040.jpeg)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.1 – BEC 攻击阶段](img/00040.jpeg)'
- en: Figure 12.1 – BEC attack phases
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.1 – BEC 攻击阶段
- en: 'Having observed the stages outlined in the figure, let’s dive into each phase
    with a detailed breakdown:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在观察了图中列出的阶段后，我们将深入分析每个阶段，并进行详细分解：
- en: '**Reconnaissance**: In this phase, attackers meticulously study the victim
    organization’s hierarchy, communication patterns, and specific jargon used. If
    an attacker has access to an account already, they simply run searches within
    the email system to understand communication patterns and jargon at the organization.
    Otherwise, the attacker utilizes information that may be public about the company
    from various sources, such as LinkedIn and the victim organization’s website.
    Attackers may use publicly available information, social engineering tactics,
    or even previous data breaches to collect data. This reconnaissance phase allows
    them to craft convincing emails mimicking users from inside the organization and
    spoof or target specific accounts of interest.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**侦察**：在此阶段，攻击者仔细研究受害组织的层级结构、沟通模式以及使用的特定行话。如果攻击者已经访问了某个账户，他们只需在电子邮件系统内进行搜索，以了解该组织的沟通模式和行话。否则，攻击者会利用来自
    LinkedIn 或受害组织网站等各种来源的公开信息。攻击者可能会使用公开可得的信息、社会工程学策略，甚至以前的数据泄露来收集数据。这个侦察阶段使他们能够制作出模拟组织内部用户的可信邮件，并伪装或锁定特定的目标账户。'
- en: BEC attacks are typically not random mass mailings but are directed at specific
    individuals within an organization, such as those with authority over finances
    or access to confidential data. As an example, the CFO of an organization is commonly
    targeted as they not only have access to confidential financial information, but
    they have the authority to approve transactions at the organization.
  id: totrans-16
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: BEC攻击通常不是随机的大规模邮件发送，而是针对组织中的特定个人，如具有财务权限或可以访问机密数据的人。例如，组织的首席财务官（CFO）通常是攻击者的目标，因为他们不仅能访问机密的财务信息，还拥有批准交易的权限。
- en: '**Email spoofing or account takeover**: Attackers either spoof a legitimate
    email address or gain unauthorized access to a legitimate account, often through
    phishing attacks or exploiting weak security practices.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**电子邮件伪造或账户接管**：攻击者通过伪造合法的电子邮件地址或非法访问合法账户来发起攻击，通常是通过网络钓鱼攻击或利用薄弱的安全措施。'
- en: Attackers frequently create “fake” websites that appear to look the same as
    the login pages of popular productivity suites (Microsoft 365 or Google Workspace).
    They achieve this by manipulating HTML and CSS to replicate the styling of these
    legitimate sites. The domains of these fake sites are often slightly altered versions
    of the real ones, designed to appear as if they belong to the organization’s productivity
    suite tenant. For example, a fake domain for Microsoft 365 could be `microsoft365-login.com`
    instead of the legitimate `microsoft.com`, and for Google Workspace, it might
    be `googledocs-signin.com` instead of `google.com`. These fraudulent pages usually
    consist of forms designed to harvest and send back user credentials to the attackers.
    Unsuspecting users who enter their login details on these fake pages unintentionally
    provide attackers with access to their personal or corporate accounts, leading
    to account compromise.
  id: totrans-18
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 攻击者常常创建“假”网站，这些网站看起来与流行生产力套件（如Microsoft 365或Google Workspace）的登录页面相同。他们通过修改HTML和CSS，复制这些合法站点的样式来实现这一点。这些假网站的域名通常是对真实域名的轻微修改，旨在让它们看起来像是属于组织的生产力套件租户。例如，微软365的假域名可能是`microsoft365-login.com`，而不是合法的`microsoft.com`；Google
    Workspace的假域名可能是`googledocs-signin.com`，而不是`google.com`。这些欺诈页面通常包含设计用来收集并将用户凭证传送给攻击者的表单。未察觉的用户如果在这些假页面上输入登录信息，就无意中将他们的个人或企业账户的访问权限交给攻击者，从而导致账户被盗。
- en: If attackers cannot gain access to accounts in the organization, they typically
    purchase domains that appear to be very similar to the organization instead. As
    an example, instead of `ACME.com`, `AMCE.com` is purchased from domain registrars
    so that the attacker can also create email accounts sharing domains that closely
    resemble legitimate user emails at the victim organization. As an example, `Alice@AMCE.com`
    would be set up and used by attackers to mimic a legitimate user and account for
    Alice from ACME. Most users would not catch the subtle change in the domain from
    ACME to AMCE in their email correspondence.
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果攻击者无法访问组织中的账户，他们通常会购买看起来与组织名称非常相似的域名。例如，攻击者可以从域名注册商处购买`AMCE.com`，而不是`ACME.com`，从而创建共享这些域名的电子邮件账户，这些账户与受害组织中合法用户的电子邮件地址非常相似。举个例子，攻击者可能会设置并使用`Alice@AMCE.com`，以模拟来自ACME的合法用户和账户。大多数用户在电子邮件往来中不会注意到`ACME`和`AMCE`之间的微小差别。
- en: '**Preparation**: In this phase, the attacker prepares the tools and methods
    they will use to execute the attack. This could include crafting convincing phishing
    emails, creating fake invoices, or setting up bank accounts for receiving fraudulent
    payments. This is based on their objective and the type of BEC, which we will
    discuss in the next section.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**准备阶段**：在这个阶段，攻击者准备他们将用于执行攻击的工具和方法。这可能包括制作具有说服力的网络钓鱼邮件、创建假发票或设置银行账户以接收欺诈性付款。这一过程取决于他们的目标和攻击的BEC类型，我们将在下一部分讨论这一点。'
- en: '**Exploitation**: In this stage, the victim interacts with the email, leading
    to the attacker’s desired outcome. For BEC, this often means complying with the
    instructions in the email, such as transferring funds or providing confidential
    information.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**利用阶段**：在这个阶段，受害者与电子邮件进行互动，导致攻击者实现他们期望的结果。对于BEC攻击，这通常意味着按照邮件中的指示操作，比如转账或提供机密信息。'
- en: '**Malware installation (if applicable)**: While not always a part of BEC, in
    some cases, the attacker might use the opportunity to install malware on the victim’s
    system. This can be for long-term access, data exfiltration, or to facilitate
    further attacks. This is how attackers can pivot from the productivity suite account
    hosted and protected in the cloud to actual devices in the organization’s IT network.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**恶意软件安装（如果适用）**：虽然不一定是BEC的一部分，但在某些情况下，攻击者可能会利用这一机会在受害者系统上安装恶意软件。这可能是为了长期访问、数据外泄，或为了促进进一步的攻击。这就是攻击者如何从云端托管和保护的生产力套件账户转向实际设备并侵入组织IT网络。'
- en: '**Actions on objectives**: The ultimate goal of the attacker is realized in
    this stage. For BEC, this usually involves the unauthorized transfer of funds
    to the attacker’s account or the acquisition of sensitive information. The attacker’s
    objectives are achieved once they receive the funds or information they were seeking.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**目标行动**：攻击者的最终目标在这一阶段得以实现。对于BEC而言，通常涉及将资金未经授权地转移到攻击者的账户，或获取敏感信息。一旦攻击者获得了他们寻求的资金或信息，他们的目标就达成了。'
- en: '**Persistence and anti-forensics (if applicable)**: In sophisticated BEC schemes,
    attackers might try to maintain access to the victim’s systems for future attacks
    or to hide evidence of their activities. This might involve setting up auto-forwarding
    rules outside the network, deletion of email evidence, creating backdoors in terms
    of application consents, or using other techniques to conceal their presence.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**持久性和反取证（如果适用）**：在复杂的BEC（商业电子邮件攻击）方案中，攻击者可能会尝试保持对受害者系统的访问，以便进行未来的攻击或隐藏其活动的证据。这可能包括在网络外设置自动转发规则、删除电子邮件证据、通过应用程序许可创建后门，或使用其他技术来掩盖他们的存在。'
- en: Common types of BECs
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 常见的BEC类型
- en: 'Now that we’ve explored the various phases of a BEC attack, let’s discuss the
    common types of BECs that organizations frequently encounter:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经探讨了BEC攻击的各个阶段，接下来让我们讨论组织常遇到的BEC类型：
- en: '**Invoice fraud**: The scammer pretends to be a supplier or vendor of the target
    company, requesting payment for services or goods to a fraudulent account.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**发票欺诈**：骗子冒充目标公司的供应商或卖家，要求为服务或商品向一个虚假账户支付款项。'
- en: '**C-suite fraud**: Attackers pose as the company’s CEO or any high-ranking
    executive and send emails to employees, usually in the finance department, instructing
    them to transfer funds to an account controlled by the attacker.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高层管理人员欺诈**：攻击者冒充公司首席执行官或其他高层管理人员，向员工发送电子邮件，通常是财务部门的员工，指示他们将资金转账到攻击者控制的账户。'
- en: '**Attorney impersonation**: Attackers pose as a lawyer or legal representative
    involved with the company, often under the guise of urgent and confidential matters,
    to misdirect funds or gain sensitive information.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**律师冒充**：攻击者冒充公司相关律师或法律代表，通常以紧急和机密事务为幌子，误导资金或获取敏感信息。'
- en: '**Data theft**: Here, the objective is not necessarily immediate financial
    gain but the theft of sensitive data, which could be employee tax information,
    intellectual property, or customer data.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据盗窃**：这里的目标不一定是立即获得财务收益，而是盗取敏感数据，这些数据可能是员工的税务信息、知识产权或客户数据。'
- en: '**Account compromise**: An employee’s email account is hacked and then used
    to request payments from vendors listed in their email contacts.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**账户妥协**：员工的电子邮件账户被黑客入侵，之后被用来向其电子邮件联系人列表中的供应商请求付款。'
- en: '**Credentials harvesting**: An employee’s email account is hacked and then
    used to further harvest more credentials from outside the organization to trusted
    contracts and vendors.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**凭证收集**：员工的电子邮件账户被黑客入侵，之后被用来从公司外部进一步收集更多的凭证，如信任的合同和供应商。'
- en: '**Motive for attackers**: The primary motivation behind BEC attacks is financial
    gain. Attackers exploit the trust within business communication channels to divert
    funds or obtain sensitive information that can be monetized. Additionally, the
    data harvested from such attacks, such as credentials and employee personal information
    or intellectual property, can be sold on the dark web or used for further attacks,
    including repeat BEC attacks and ransomware. The sophisticated and targeted nature
    of these attacks often leads to a higher success rate and potentially greater
    financial rewards for the attackers, making BEC a lucrative form of cybercrime.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**攻击者的动机**：BEC攻击的主要动机是财务获利。攻击者利用商业通信渠道中的信任关系，转移资金或获取可变现的敏感信息。此外，从这些攻击中收集到的数据，如凭证、员工个人信息或知识产权，可以在暗网出售，或用于进一步的攻击，包括重复的BEC攻击和勒索病毒。由于这些攻击的复杂性和针对性，它们往往具有更高的成功率，并可能为攻击者带来更大的财务回报，使BEC成为一种有利可图的网络犯罪形式。'
- en: A deep understanding of the varied BEC attack types, from invoice fraud to data
    theft, is essential for effective defense against these sophisticated and financially
    motivated cyber threats. Identifying types of BEC allows both technical and business
    controls to prevent these incidents. For example, organizations can implement
    controls to verbally verify transaction approvals over a set amount to prevent
    invoice and C-suite fraud.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 深入了解各种BEC攻击类型，从发票欺诈到数据盗窃，对于有效防御这些复杂且具有财务动机的网络威胁至关重要。识别BEC攻击的类型可以让技术和业务控制措施共同防止这些事件的发生。例如，组织可以实施控制措施，通过口头验证超过特定金额的交易批准，以防止发票欺诈和高层管理人员欺诈。
- en: Initial scoping and response
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 初步范围界定和响应
- en: 'When responding to a BEC attack as an incident responder, the **initial scoping
    phase** is critical for understanding the breadth and depth of the incident. This
    phase involves gathering as much information as possible to assess the situation
    accurately. This initial scoping involves talking with the cloud productivity
    suite (Microsoft 365 or Google Workspace) IT administrators, organization general
    counsel, C-suite, and accounting staff to better understand the following, even
    before any technical forensic analysis:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在作为事件响应者应对BEC攻击时，**初步范围界定阶段**对于了解事件的广度和深度至关重要。这个阶段涉及尽可能多地收集信息，以便准确评估情况。初步范围界定包括与云生产力套件（Microsoft
    365或Google Workspace）的IT管理员、公司总法律顾问、高层管理人员和会计人员进行沟通，以便在进行任何技术取证分析之前，更好地了解以下内容：
- en: '**Timeline of the attack**: Understanding when the attack started is crucial.
    Ask when the first signs of compromise were noticed and at what point users noticed
    anything suspicious. This could include unusual email activity, reports of suspicious
    emails from within or outside the organization, or financial transactions that
    were flagged as anomalous. If attackers were successful in transferring any unauthorized
    funds, note these dates in the timeline.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**攻击时间线**：了解攻击开始的时间至关重要。询问何时首次发现安全漏洞的迹象，以及用户在何时注意到可疑活动。这可能包括异常的电子邮件活动、来自组织内外的可疑电子邮件报告，或被标记为异常的财务交易。如果攻击者成功转移了任何未经授权的资金，请在时间线上注明这些日期。'
- en: '**Extent of the compromise**: Determine which accounts have been compromised.
    This involves checking for signs of unauthorized access, such as login attempts
    from unfamiliar locations or devices, and changes in account settings or permissions
    that were not initiated by the account owners. If attackers were successful, IT
    administrators for the productivity suites would have already narrowed down on
    the accounts of interest. We will discuss how to determine evidence of compromise
    in the *Microsoft 365 incident response* and *Google Workspace incident* *response*
    sections.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**妥协的范围**：确定哪些账户已被妥协。这涉及检查是否存在未经授权访问的迹象，例如来自不熟悉位置或设备的登录尝试，以及账户设置或权限的变更，这些变更并非由账户所有者发起。如果攻击者成功入侵，生产力套件的IT管理员应已经缩小了受影响的账户范围。我们将在*Microsoft
    365事件响应*和*Google Workspace事件响应*部分讨论如何确定妥协的证据。'
- en: '**Attack vectors**: Investigate how the attackers gained access. Was it through
    phishing emails, credential stuffing, or exploiting security vulnerabilities?
    Understanding the attack vector is essential for preventing future breaches. In
    some instances, users can recall at what points they may have entered their credentials
    to a phishing site. Furthermore, have the organization and/or individual users
    suffered a data breach in the past? If so, their username and credentials could
    be circulating on the dark web. It is not uncommon for employees to use their
    corporate email addresses for personal services. If those personal services suffer
    a data breach, the employee’s corporate information may be exposed.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**攻击向量**：调查攻击者是如何获得访问权限的。是通过钓鱼邮件、凭证填充，还是利用安全漏洞？了解攻击向量对于防止未来的安全漏洞至关重要。在某些情况下，用户可能记得他们在什么时刻将凭证输入到钓鱼网站。此外，组织和/或个人用户过去是否遭受过数据泄露？如果是，用户名和凭证可能已经在暗网中流通。员工使用公司电子邮件地址进行个人服务并不罕见。如果这些个人服务遭遇数据泄露，员工的公司信息可能会暴露。'
- en: '**Data exfiltration**: Assess what information has been accessed or exfiltrated.
    This includes sensitive emails, attachments, and any data stored in the compromised
    accounts. Knowing the type of data exposed helps in understanding the potential
    impact of the breach.'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据外泄**：评估已被访问或外泄的信息。这包括敏感的电子邮件、附件以及任何存储在受损账户中的数据。了解暴露的数据类型有助于理解泄露的潜在影响。'
- en: '**Communication with affected parties**: Determine who has been affected by
    the breach, both internally and externally. This might include employees, customers,
    or business partners who have communicated with the compromised accounts.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与受影响方的沟通**：确定哪些人受到了泄露事件的影响，包括内部和外部人员。这可能包括员工、客户或与受损账户有过通信的业务合作伙伴。'
- en: '**Security measures in place**: Review the existing security measures. Were
    there any security protocols that were bypassed or ineffective? This could include
    multi-factor authentication, regular password changes, and employee training on
    recognizing phishing attempts.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**现有安全措施**：回顾现有的安全措施。是否有任何安全协议被绕过或无效？这可能包括多因素身份验证、定期更换密码和员工培训以识别钓鱼攻击。'
- en: '**Previous incidents**: Inquire if there have been previous similar incidents.
    Understanding past incidents can provide insights into potential weaknesses or
    repeated patterns of attacks. It has become much more common for repeat attacks,
    especially if attackers were successful in diverting funds in the past. They may
    see an organization as an easy repeat target.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**之前的事件**：询问是否有类似的历史事件。了解过去的事件可以为发现潜在的弱点或重复的攻击模式提供线索。重复攻击变得越来越常见，尤其是在攻击者曾经成功转移资金的情况下，他们可能会把一个组织视为容易重复攻击的目标。'
- en: '**Current response actions**: Check what actions have already been taken in
    response to the discovery of the attack. This can include changing passwords,
    disconnecting potentially compromised systems from the network, or notifying affected
    individuals.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**当前响应措施**：检查在发现攻击后已采取的措施。这可能包括更改密码、将可能受损的系统从网络中断开连接或通知受影响的个人。'
- en: '**Microsoft 365 access**: This is the most important step to actually kick
    off the response and investigation as an incident responder. You will require
    the organization’s Microsoft 365 administrator to create an account in their 365
    tenant with the following roles. For the most part, the accesses required to respond
    to a 365 compromise are as follows:'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Microsoft 365 访问权限**：这是作为事件响应者实际启动响应和调查的最重要步骤。您将需要组织的 Microsoft 365 管理员在他们的
    365 租户中创建一个具有以下角色的账户。大多数情况下，响应 Microsoft 365 入侵所需的访问权限如下：'
- en: 'Azure AD:'
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Azure AD：
- en: Global reader
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 全局读取者
- en: Security reader
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全读取者
- en: 'Exchange online admin, a custom role with the following permissions:'
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Exchange 在线管理员，一个自定义角色，具有以下权限：
- en: Mail recipients
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 邮件收件人
- en: Security group creation and memberships
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全组创建和成员资格
- en: View only audit log
  id: totrans-52
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仅查看审计日志
- en: View only configuration
  id: totrans-53
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仅查看配置
- en: View only recipients
  id: totrans-54
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仅查看收件人
- en: 'Microsoft Purview (compliance):'
  id: totrans-55
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft Purview（合规性）：
- en: Compliance administrator
  id: totrans-56
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 合规性管理员
- en: eDiscovery manager
  id: totrans-57
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: eDiscovery 管理员
- en: These role names are likely to change within the Microsoft ecosystem; however,
    the key here is that you will require some sort of global reader or security reader
    role to allow you to run searches in the audit logs.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 这些角色名称可能会在 Microsoft 生态系统中发生变化；然而，关键在于，您将需要某种全局读取者或安全读取者角色，以便在审计日志中进行搜索。
- en: The initial scoping phase sets the stage for effective incident response by
    providing a clear picture of the attack. Next, we will dive a bit deeper into
    triaging and forensics for Microsoft 365 and Google Workspace.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 初步范围界定阶段通过提供攻击的清晰概览，为有效的事件响应奠定了基础。接下来，我们将深入探讨微软 365 和 Google Workspace 的分流和取证工作。
- en: Remediation steps
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 修复步骤
- en: 'During the initial scoping of the incident, regardless of whether it’s Microsoft
    365 or Google Workspace, there are several steps that the organization can follow
    to ensure that the attacker is no longer in their environment prior to incident
    responders starting forensics. User interfaces and productivity suites change;
    however, the following steps are always relevant:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在事件的初步范围界定阶段，无论是微软 365 还是 Google Workspace，组织可以遵循一些步骤，确保攻击者在事件响应人员开始取证前已经被清除出环境。用户界面和生产力套件可能会发生变化；然而，以下步骤始终适用：
- en: Reset the passwords of any accounts that were impacted or are suspected to be
    compromised.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重置所有受到影响或疑似被泄露的账户密码。
- en: Enable **multi-factor authentication** (**MFA**) organization-wide or, at the
    very least, for privileged accounts.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用**多因素身份验证**（**MFA**）在整个组织中，或至少对于特权账户启用。
- en: Remove any suspicious automation (i.e., email forwarding rules outside of the
    domain) and any suspicious inbox rules set inside the mailbox. We will discuss
    this further in the upcoming section.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 移除任何可疑的自动化设置（例如，域外的电子邮件转发规则）以及邮箱中设置的可疑收件箱规则。我们将在接下来的章节中进一步讨论这一点。
- en: Remove compromised accounts from any privileged or elevated role at the organization.
    For example, compromised accounts belonging to IT administrators should temporarily
    have their accesses limited to prevent further unauthorized activities.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从任何特权或提升角色中移除被泄露的账户。例如，属于 IT 管理员的被泄露账户应暂时限制其访问权限，以防止进一步的未经授权活动。
- en: Despite any changes in productivity suites such as Microsoft 365 or Google Workspace,
    these high-level steps, including password resets and access limitations, are
    universally applicable and crucial for safeguarding against cyber threats in a
    productivity suite environment. The product’s UI and details may change; however,
    the steps remain the same.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管生产力套件如微软 365 或 Google Workspace 发生了变化，这些高层次的步骤，包括密码重置和访问限制，在保护生产力套件环境免受网络威胁方面具有普遍适用性且至关重要。产品的用户界面和细节可能会变化；然而，步骤始终不变。
- en: Microsoft 365 incident response
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 微软 365 事件响应
- en: After the initial scoping to understand the incident, the next step is to determine
    indicators of compromise and begin the threat hunt. This section delves into the
    tools and techniques that incident responders can employ to automate the log acquisition
    and analysis process, specifically to an organization that is utilizing Microsoft
    365 as their cloud productivity suite. A key focus is on utilizing Microsoft 365’s
    built-in security and compliance tools, such as Microsoft Purview, to rapidly
    gather logs and track suspicious activities.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在初步范围界定以了解事件后，下一步是确定泄露的指标并开始威胁狩猎。本节深入探讨了事件响应人员可以使用的工具和技术，来自动化日志采集和分析过程，特别是对于使用微软
    365 作为其云生产力套件的组织。一个关键的重点是利用微软 365 内建的安全和合规工具，如微软 Purview，快速收集日志并跟踪可疑活动。
- en: Tooling
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工具
- en: 'In [*Chapter 7*](part0026_split_000.html#_idTextAnchor137), we discussed the
    various auditing and compliance features in Microsoft 365, one of which was Microsoft
    unified audit logs. These logs provide a consolidated view of all Microsoft 365
    activity and are critical for investigating and understanding the extent of the
    compromise. Here’s how incident responders can leverage the audit log search GUI
    in Microsoft 365 for this purpose:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在[*第7章*](part0026_split_000.html#_idTextAnchor137)中，我们讨论了微软 365 中的各种审计和合规功能，其中之一是微软统一审计日志。这些日志提供了微软
    365 活动的汇总视图，对于调查和理解泄露的程度至关重要。以下是事件响应人员如何利用微软 365 中的审计日志搜索界面来实现这一目的：
- en: '**Accessing the audit log search**: The audit log search is accessible through
    Microsoft Purview. Incident responders need to navigate to the **Audit** section
    to begin.'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**访问审计日志搜索**：审计日志搜索可以通过微软 Purview 访问。事件响应人员需要导航到**审计**部分以开始。'
- en: '**Scoping the incident**: Before running a search, it’s crucial to complete
    the initial scoping of the incident, as we discussed in the previous section.
    This is because the initial scoping involves understanding the timeline of the
    incident, the suspected compromised accounts, and the nature of the activities
    that are of interest. This initial scoping helps in applying the right filters.
    Otherwise, incident responders will have to run general searches, which may take
    a while to execute and can be difficult to quickly analyze and triage afterward.'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**定义事件范围**：在运行搜索之前，必须完成事件的初步定义，如前一节所讨论的。这是因为初步定义涉及理解事件的时间线、怀疑被泄露的账户，以及感兴趣活动的性质。这一初步定义有助于应用正确的筛选器。否则，事件响应者将不得不运行一般搜索，这可能需要一段时间才能执行，并且在之后分析和分类时可能会很困难。'
- en: '**Apply filters**: The audit log search provides various filters to narrow
    down the search results:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**应用筛选器**：审计日志搜索提供多种筛选器，用于缩小搜索结果范围：'
- en: '**Date and time**: Specify the time frame for the incident'
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**日期和时间**：指定事件的时间范围'
- en: '**Activities**: Filter by specific activities, such as file accesses, user
    logins, and administrative actions'
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**活动**：按特定活动筛选，如文件访问、用户登录和管理操作'
- en: '**Users**: Focus the search on specific user accounts that are suspected to
    be compromised'
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户**：将搜索集中在怀疑被泄露的特定用户账户上'
- en: '**File, folder, and site**: Narrow down to specific files, folders, or SharePoint
    sites if relevant'
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件、文件夹和站点**：如果相关，可以缩小范围到特定的文件、文件夹或 SharePoint 站点'
- en: '**Running the search**: After applying the necessary filters, run the search.
    The GUI will display a list of events that match the criteria. Either classic
    or new searches can be used; however, note that classic searches will not save
    the history of the searches you conduct. Furthermore, classic searches are limited
    to only running concurrent search jobs.'
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**运行搜索**：应用必要的筛选器后，运行搜索。图形用户界面将显示与条件匹配的事件列表。可以使用经典搜索或新搜索；然而，需要注意的是，经典搜索不会保存你进行的搜索历史。此外，经典搜索仅限于运行并行搜索任务。'
- en: '**Exporting logs for detailed analysis**: For a more in-depth analysis, users
    can export the search results to a CSV file. This allows for additional analysis
    using external tools for archiving purposes. The exported data includes detailed
    information about each event, such as the source IP address, user agent, and the
    exact operations performed.'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**导出日志进行详细分析**：对于更深入的分析，用户可以将搜索结果导出为 CSV 文件。这可以通过外部工具进行额外的分析并用于归档。导出的数据包括有关每个事件的详细信息，如源
    IP 地址、用户代理和执行的具体操作。'
- en: Important note
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: Exporting results through the audit search user interface is limited to only
    10,0000 entries. As a result, it’s important to ensure that your search results
    are refined under 10,000 or search jobs are broken down into multiple batches
    to ensure all entries are exported.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 通过审计搜索用户界面导出的结果限制为仅 10,000 条。因此，确保搜索结果精炼至 10,000 条以内，或将搜索任务拆分成多个批次，以确保导出所有条目是很重要的。
- en: '**Utilizing external tools**: Once the logs are exported, incident responders
    can utilize various data analysis tools to sift through the data. Tools such as
    Excel, Power BI, or specialized forensic tools can be used to analyze patterns,
    create timelines, and correlate events across different logs.'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**利用外部工具**：日志导出后，事件响应者可以利用各种数据分析工具筛选数据。可以使用 Excel、Power BI 或专门的取证工具分析模式、创建时间线并关联不同日志中的事件。'
- en: '**Analyzing results**: Examine the results to identify any unusual or unauthorized
    activities. Look for patterns or anomalies that could indicate malicious behavior.
    We will discuss analysis further in the next section.'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**分析结果**：检查结果，识别任何异常或未授权的活动。寻找可能表明恶意行为的模式或异常。我们将在下一节进一步讨论分析。'
- en: Searching for and extracting 365 audit logs
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 搜索并导出 365 审计日志
- en: 'The following figures demonstrate how to run searches and extract the audit
    logs in CSV:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图示展示了如何运行搜索并导出 CSV 格式的审计日志：
- en: 'The following screenshot demonstrates the audit log search tab with available
    filters to further refine queries:'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以下截图展示了审计日志搜索标签页，并列出了可用的筛选器以进一步精炼查询：
- en: '![Figure 12.2 – Microsoft 365 Audit search log tab](img/00057.jpeg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.2 – Microsoft 365 审计搜索日志标签](img/00057.jpeg)'
- en: Figure 12.2 – Microsoft 365 Audit search log tab
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.2 – Microsoft 365 审计搜索日志标签
- en: 'Search jobs are created on execution and listed below the audit log filters,
    as demonstrated:'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 搜索任务在执行时创建，并列在审计日志筛选器下方，如下所示：
- en: '![Figure 12.3 – Audit log search jobs](img/00075.jpeg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.3 – 审计日志搜索作业](img/00075.jpeg)'
- en: Figure 12.3 – Audit log search jobs
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.3 – 审计日志搜索作业
- en: 'Once search jobs are completed, results are organized in a table, as shown:'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一旦搜索作业完成，结果将按表格形式组织，如下所示：
- en: '![Figure 12.4 – Audit log search results (UI)](img/00095.jpeg)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.4 – 审计日志搜索结果（UI）](img/00095.jpeg)'
- en: Figure 12.4 – Audit log search results (UI)
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.4 – 审计日志搜索结果（UI）
- en: 'The next figure is an example of successful login and failed login events:'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下一图展示了成功登录和失败登录事件的示例：
- en: '![Figure 12.5 – Audit log search results – login events](img/00116.jpeg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.5 – 审计日志搜索结果 – 登录事件](img/00116.jpeg)'
- en: Figure 12.5 – Audit log search results – login events
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.5 – 审计日志搜索结果 – 登录事件
- en: 'The following figure demonstrates an example of an event’s **Details** pane:'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下图展示了一个事件的**详细信息**窗格示例：
- en: '![Figure 12.6 – Audit log event details](img/00139.jpeg)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.6 – 审计日志事件详情](img/00139.jpeg)'
- en: Figure 12.6 – Audit log event details
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.6 – 审计日志事件详情
- en: 'All search results can be exported as a CSV file, as shown:'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有搜索结果可以导出为 CSV 文件，如下所示：
- en: '![Figure 12.7 – Audit log export process](img/00155.jpeg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.7 – 审计日志导出过程](img/00155.jpeg)'
- en: Figure 12.7 – Audit log export process
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.7 – 审计日志导出过程
- en: 'The resulting file is a CSV file; however, the majority of the fields will
    be stored in the `AuditData` column in the JSON format. The exported CSV is as
    follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的文件是一个 CSV 文件；然而，大多数字段将以 JSON 格式存储在 `AuditData` 列中。导出的 CSV 如下所示：
- en: '![Figure 12.8 – Audit log export (CSV)](img/00173.jpeg)'
  id: totrans-105
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.8 – 审计日志导出（CSV）](img/00173.jpeg)'
- en: Figure 12.8 – Audit log export (CSV)
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.8 – 审计日志导出（CSV）
- en: Extracting audit logs using PowerShell
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 PowerShell 提取审计日志
- en: 'The unified audit logs can also be programmatically extracted using PowerShell:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 统一审计日志也可以通过 PowerShell 程序化提取：
- en: Open PowerShell as an administrator and navigate to your folder of choosing;
    for example, `C:\Incident Response\`.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以管理员身份打开 PowerShell，并导航到您选择的文件夹；例如，`C:\Incident Response\`。
- en: 'Connect to the Microsoft 365 tenant with the following commands:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令连接到 Microsoft 365 租户：
- en: '[PRE0]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Define a log time range (modify as needed; here, we will start with 30 days):'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义日志时间范围（根据需要修改；在此，我们将从 30 天开始）：
- en: '[PRE1]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: $AuditLogs = Search-UnifiedAuditLog -StartDate $StartDate -EndDate $EndDate
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: $AuditLogs = Search-UnifiedAuditLog -StartDate $StartDate -EndDate $EndDate
- en: '[PRE2]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Export the log as a CSV:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将日志导出为 CSV：
- en: '[PRE3]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Release the 365 session (i.e., disconnect):'
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 释放 365 会话（即断开连接）：
- en: '[PRE4]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The resulting CSV will be very similar to the export generated through the user
    interface in *Figure 12**.8*.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的 CSV 将与通过用户界面导出的数据非常相似，如*图 12.8*所示。
- en: Utilizing Microsoft Power Query
  id: totrans-121
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 Microsoft Power Query
- en: Whether exported through the Purview user interface or programmatically, a large
    amount of the data and useful fields will be stored in JSON. As a result, incident
    responders must complete the additional step of parsing this data for it to be
    useful (or easily searchable). Incident responders can utilize a JSON parsing
    tool of their choice, but in this example, we will utilize Microsoft Power Query.
    Power Query can be employed to drill down into the bulk of JSON data. The process
    involves importing the CSV file into Excel and then using Power Query’s advanced
    data transformation capabilities to parse the JSON fields. This parsing translates
    the JSON data into a structured format that aligns with the traditional columns
    and rows of Excel. Users can expand the JSON fields into individual columns, making
    the data more accessible and easier to analyze. This transformation is crucial
    for incident responders who need to dissect and understand intricate details of
    user activities, security events, and system changes logged in the audit data
    column. By leveraging Microsoft’s Power Query, organizations can efficiently convert
    the complex JSON data into a more manageable and analyzable format.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 无论是通过 Purview 用户界面导出，还是通过编程方式导出，大部分数据和有用字段将以 JSON 格式存储。因此，事件响应人员必须完成额外的步骤，以解析这些数据使其可用（或易于搜索）。事件响应人员可以使用他们选择的
    JSON 解析工具，但在此示例中，我们将使用 Microsoft Power Query。Power Query 可用于深入分析大量的 JSON 数据。该过程涉及将
    CSV 文件导入 Excel，然后使用 Power Query 的高级数据转换功能解析 JSON 字段。此解析将 JSON 数据转换为与 Excel 的传统列和行对齐的结构化格式。用户可以将
    JSON 字段展开为单独的列，使数据更易于访问和分析。此转换对于需要深入剖析并理解审计数据列中记录的用户活动、安全事件和系统更改细节的事件响应人员至关重要。通过利用
    Microsoft 的 Power Query，组织可以有效地将复杂的 JSON 数据转换为更易管理和分析的格式。
- en: 'The steps to utilize Microsoft Power Query are as follows:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Microsoft Power Query 的步骤如下：
- en: 'Starting with the unified audit log CSV, our next step is to create a new workbook
    in Microsoft Excel:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从统一审计日志 CSV 开始，我们的下一步是在 Microsoft Excel 中创建一个新工作簿：
- en: '![Figure 12.9 – Audit log results to be transformed](img/00191.jpeg)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![图12.9 – 审计日志结果待转换](img/00191.jpeg)'
- en: Figure 12.9 – Audit log results to be transformed
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.9 – 审计日志结果待转换
- en: 'Create a new workbook:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新工作簿：
- en: '![Figure 12.10 – New Excel workbook](img/00010.jpeg)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
  zh: '![图12.10 – 新 Excel 工作簿](img/00010.jpeg)'
- en: Figure 12.10 – New Excel workbook
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.10 – 新 Excel 工作簿
- en: Next, you will need to navigate to the **Data** tab and click on **Get Data**
    | **From File** | **From Text/CSV**.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，您需要进入**数据**标签页，点击**获取数据** | **来自文件** | **来自文本/CSV**。
- en: '![Figure 12.11 – Importing the audit data export](img/00029.jpeg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![图12.11 – 导入审计数据导出](img/00029.jpeg)'
- en: Figure 12.11 – Importing the audit data export
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.11 – 导入审计数据导出
- en: Next, you will import the unified audit log CSV and click `AuditData` column,
    which contains the JSON. Note that Power Query is limited to the maximum number
    of rows filled to a worksheet (i.e., 1,048,576).
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，您将导入统一审计日志 CSV 并点击包含 JSON 的 `AuditData` 列。请注意，Power Query 有每个工作表最大行数限制（即
    1,048,576 行）。
- en: '![Figure 12.12 – Power Query options to load data](img/00047.jpeg)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![图12.12 – Power Query 加载数据选项](img/00047.jpeg)'
- en: Figure 12.12 – Power Query options to load data
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.12 – Power Query 加载数据选项
- en: 'Next, audit data is transformed using the **Transform Data** option. The results
    are shown in the next figure:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用**转换数据**选项转换审计数据。结果显示在下图中：
- en: '![Figure 12.13 – Power Query results](img/00063.jpeg)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![图12.13 – Power Query 结果](img/00063.jpeg)'
- en: Figure 12.13 – Power Query results
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.13 – Power Query 结果
- en: Next, right-click on the `AuditData` column and click on **Transform** | **JSON**.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，右键点击 `AuditData` 列并点击**转换** | **JSON**。
- en: '![Figure 12.14 – Transforming the JSON data column](img/00082.jpeg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![图12.14 – 转换 JSON 数据列](img/00082.jpeg)'
- en: Figure 12.14 – Transforming the JSON data column
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.14 – 转换 JSON 数据列
- en: 'As shown next, your JSON data has now been transformed into CSV columns (for
    example, `AuditData.ClientIP`):'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 如下所示，您的 JSON 数据已成功转换为 CSV 列（例如，`AuditData.ClientIP`）：
- en: '![Figure 12.15 – Resulting CSV column](img/00101.jpeg)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![图12.15 – 结果 CSV 列](img/00101.jpeg)'
- en: Figure 12.15 – Resulting CSV column
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.15 – 结果 CSV 列
- en: 'The following figure demonstrates the resulting data after the column has been
    transformed in Power Query:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了在 Power Query 中列转换后的数据结果：
- en: '![Figure 12.16 – Expanding the transformed column](img/00123.jpeg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![图12.16 – 展开转换后的列](img/00123.jpeg)'
- en: Figure 12.16 – Expanding the transformed column
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 图12.16 – 展开转换后的列
- en: The result is a CSV file with all your audit data in a friendly, readable format
    to utilize Excel (or the tool of your choice) for further analysis.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个 CSV 文件，其中包含您所有的审计数据，格式友好且易于阅读，您可以使用 Excel（或您选择的其他工具）进行进一步分析。
- en: Cloud forensics using HAWK
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 HAWK 进行云取证
- en: Incident responders can also utilize some open source tools based on the Microsoft
    365 API, such as HAWK (Github.com/T0pCyber/hawk).
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 事件响应人员还可以利用一些基于 Microsoft 365 API 的开源工具，如 HAWK（Github.com/T0pCyber/hawk）。
- en: '**HAWK** is a PowerShell-based tool for gathering information related to Microsoft
    365 compromises. It searches and parses out a lot of useful information specific
    to a 365 compromise from the 365 configuration and the audit logs, such as the
    creation of new inbox rules, consent grants, a list of all users with administrator
    access, and much more. This simplifies the incident response process, as incident
    responders can find all information in their respective CSV as opposed to navigating
    to configurations in 365 or extracting it manually through the audit logs.'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '**HAWK** 是一个基于 PowerShell 的工具，用于收集与 Microsoft 365 安全事件相关的信息。它从 365 配置和审计日志中搜索并解析出许多与
    365 安全事件相关的有用信息，如新收件箱规则的创建、授权批准、所有具有管理员访问权限的用户列表等。通过这种方式，事件响应人员可以在各自的 CSV 文件中找到所有信息，而无需进入
    365 配置或通过审计日志手动提取信息，这大大简化了事件响应过程。'
- en: Important Note
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: 'The HAWK tool can be found on GitHub:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: HAWK 工具可以在 GitHub 上找到：
- en: '[https://github.com/T0pCyber/hawk](https://github.com/T0pCyber/hawk)'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/T0pCyber/hawk](https://github.com/T0pCyber/hawk)'
- en: 'Here is the HAWK Module PowerShell Gallery download:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是 HAWK 模块 PowerShell Gallery 下载链接：
- en: '[https://www.powershellgallery.com/packages/HAWK/3.1.0](https://www.powershellgallery.com/packages/HAWK/3.1.0)'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://www.powershellgallery.com/packages/HAWK/3.1.0](https://www.powershellgallery.com/packages/HAWK/3.1.0)'
- en: 'Here is the HAWK documentation:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是 HAWK 文档：
- en: '[https://cloudforensicator.com/](https://cloudforensicator.com/)'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://cloudforensicator.com/](https://cloudforensicator.com/)'
- en: 'To run HAWK, you require PowerShell on your system with administrator rights
    and an internet connection:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行 HAWK，您的系统需要具备管理员权限的 PowerShell 和互联网连接：
- en: Open PowerShell as an administrator and navigate to the `C:\Incident Response\`
    folder using the `cd` command.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以管理员身份打开 PowerShell，并使用 `cd` 命令导航到 `C:\Incident Response\` 文件夹。
- en: 'Install the HAWK module:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装 HAWK 模块：
- en: '[PRE5]'
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Install and import the Microsoft 365 Exchange Online management module and
    the Microsoft 365 module:'
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装并导入 Microsoft 365 Exchange Online 管理模块和 Microsoft 365 模块：
- en: '[PRE6]'
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Log in to the impacted 365 tenant with the following commands and authenticate
    with your Microsoft 365 username and password:'
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令登录受影响的 365 租户，并使用你的 Microsoft 365 用户名和密码进行身份验证：
- en: '[PRE7]'
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Run the HAWK tool:'
  id: totrans-167
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 HAWK 工具：
- en: '[PRE8]'
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'An example of the resulting files is shown in the following figure:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 生成文件的示例如下所示：
- en: '![Figure 12.17 – HAWK results](img/00144.jpeg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.17 – HAWK 结果](img/00144.jpeg)'
- en: Figure 12.17 – HAWK results
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.17 – HAWK 结果
- en: As mentioned in HAWK’s GitHub, HAWK is designed to quickly get incident responders
    the data they need. It is not meant to complete the analysis for you. A full breakdown
    of all generated log files can be found on the HAWK documentation page.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 如 HAWK 的 GitHub 所述，HAWK 旨在快速为事件响应人员提供所需的数据。它并不意味着为您完成分析。所有生成的日志文件的完整分析可以在 HAWK
    文档页面找到。
- en: Analysis
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析
- en: The goal of our analysis is to identify any evidence of compromise. The very
    first piece of analysis to be conducted is determining evidence of unauthorized
    access. This is best determined by identifying login events by using the `Activity`
    or `Operation` column in the unified audit logs in Microsoft 365\. This column
    records the specific action that has been performed within the environment. In
    essence, it serves as a detailed ledger of activities, ranging from file access
    and sharing to administrative changes and login events. Each entry in the `Operation`
    column is tagged with a descriptive label that identifies the nature of the action,
    making it a valuable resource for incident responders.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 我们分析的目标是识别任何妥协的证据。进行的第一个分析步骤是确定未授权访问的证据。这最好通过使用 Microsoft 365 中统一审计日志的 `Activity`
    或 `Operation` 列来识别登录事件来确定。此列记录了在环境中执行的具体操作。本质上，它充当活动的详细账本，涵盖从文件访问和共享到管理更改和登录事件等各种操作。`Operation`
    列中的每个条目都附有描述性标签，用于标识操作的性质，因此它是事件响应人员的重要资源。
- en: Important note
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: All audited activities (i.e., operations) can be found in Microsoft’s documentation
    at [https://learn.microsoft.com/en-us/purview/audit-log-activities](https://learn.microsoft.com/en-us/purview/audit-log-activities).
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 所有审核活动（即操作）可以在 Microsoft 的文档中找到，网址为 [https://learn.microsoft.com/en-us/purview/audit-log-activities](https://learn.microsoft.com/en-us/purview/audit-log-activities)。
- en: The first step to determine compromise is filtering for `UserLoggedIn` events,
    which is essential for monitoring and investigating unauthorized access. By analyzing
    these events, incident responders can track when and how users log into the system,
    providing crucial insights into threat actor behavior.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 确定是否发生妥协的第一步是筛选 `UserLoggedIn` 事件，这是监控和调查未授权访问的关键。通过分析这些事件，事件响应人员可以跟踪用户何时以及如何登录系统，从而提供关于威胁行为者行为的重要洞察。
- en: For instance, an unusual pattern of login activities, such as logins at unusual
    hours or from unexpected locations, can be early indicators of unauthorized access.
    This will allow incident responders to determine any indicators related to the
    compromise, such as login user agent strings and IP addresses.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，异常的登录活动模式，如在不寻常的时间或从意外位置登录，可能是未授权访问的早期迹象。这将使事件响应人员能够确定与妥协相关的任何指示，例如登录用户代理字符串和
    IP 地址。
- en: 'The strongest indicator in terms of login activity will not be analyzing unusual
    login times but analyzing the location of IPs associated with the login events.
    This can be done by filtering the unified audit logs by the `UserLoggedIn` events
    and looking up the associated IP addresses (the `ClientIP` field in `AuditData`)
    with any bulk IP address lookup software (such as `ipinfo.io`). See *Figure 12**.18*
    and *Figure 12**.19* for an example of this:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 登录活动中的最强指示因素不是分析异常的登录时间，而是分析与登录事件相关的 IP 地址的位置。这可以通过筛选 Microsoft 365 中统一审计日志中的
    `UserLoggedIn` 事件，并使用任何批量 IP 地址查询软件（如 `ipinfo.io`）查找相关的 IP 地址（在 `AuditData` 中的
    `ClientIP` 字段）来完成。有关示例，请参见 *图 12.18* 和 *图 12.19*：
- en: '![Figure 12.18 – Client IP audit data](img/00161.jpeg)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.18 – 客户端 IP 审计数据](img/00161.jpeg)'
- en: Figure 12.18 – Client IP audit data
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.18 – 客户端 IP 审计数据
- en: These IPs can be copied to a lookup IP service that will give you the specific
    cities, regions, and countries associated with each IP. For example, looking up
    one of the IPs starting with `69` on IPinfo provides information stating that
    the user had logged in from an IP based in Minnesota, USA.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 这些 IP 可以复制到一个 IP 查询服务中，该服务会提供与每个 IP 相关的具体城市、地区和国家。例如，在 IPinfo 上查找以 `69` 开头的某个
    IP，会显示用户是从美国明尼苏达州的一个 IP 地址登录的。
- en: '![Figure 12.19 – IPInfo.io lookup results](img/00180.jpeg)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![Figure 12.19 – IPInfo.io 查询结果](img/00180.jpeg)'
- en: Figure 12.19 – IPInfo.io lookup results
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: Figure 12.19 – IPInfo.io 查询结果
- en: The geographical information can be exported from your geo IP lookup service
    of choice and compared against all users in your audit log. As an incident responder,
    your next step is to determine whether the geographic location aligns with the
    organization’s business operations or if the user was confirmed in the IP’s location
    on that date. If the user had not traveled to the location, the user account can
    be deemed compromised. Incident responders can also analyze other pieces of the
    IP information, such as VPN/proxy use, or see if the hosting provider does not
    align with the user’s normal (baseline) IP address.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 地理信息可以从您选择的地理 IP 查询服务中导出，并与审计日志中的所有用户进行比较。作为事件响应者，您的下一步是确定地理位置是否与组织的业务运营相符，或者用户是否在该日期确实位于该
    IP 的位置。如果用户没有前往该位置，则可以认为该用户账户已被泄露。事件响应者还可以分析其他 IP 信息，如 VPN/代理使用情况，或者查看托管提供商是否与用户的正常（基线）IP
    地址不符。
- en: 'Continuing from analyzing unusual login locations, another key threat-hunting
    task for incident responders is checking for changes in mailbox rules. **Mailbox
    rules** are automatic actions triggered by incoming emails. If attackers get into
    a user’s account, they can secretly make or change rules. These unauthorized rules
    might redirect emails to other accounts, delete specific messages, or manage phishing
    emails to avoid being caught. The key operations to focus on are as follows:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 延续分析异常登录位置的思路，事件响应者的另一个关键威胁猎杀任务是检查邮箱规则的变化。**邮箱规则**是由收到的邮件触发的自动操作。如果攻击者进入用户账户，他们可以悄悄创建或修改规则。这些未经授权的规则可能会将邮件转发到其他账户、删除特定邮件，或者管理钓鱼邮件以避免被捕获。需要关注的关键操作如下：
- en: '**New-InboxRule**: This operation is logged when a new mailbox rule is created.
    Incident responders should scrutinize any instance of this operation, paying close
    attention to rules that forward emails to external domains, automatically delete
    messages, or sort emails in a suspicious manner. A sudden increase in the creation
    of new rules, especially those with unusual criteria, should raise an alert.'
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**New-InboxRule**：当创建新的邮箱规则时，该操作会被记录。事件响应者应仔细审查任何此类操作实例，特别是关注那些将邮件转发到外部域、自动删除邮件或以可疑方式分类邮件的规则。新规则创建的突然增加，特别是那些具有不寻常条件的规则，应引起警惕。'
- en: '**Set-InboxRule**: This indicates modifications to existing mailbox rules.
    Alterations to established rules, especially those that change the rule’s action
    or condition, can be a sign of an attacker trying to manipulate email flow subtly.'
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Set-InboxRule**：表示对现有邮箱规则的修改。特别是那些更改规则动作或条件的修改，可能是攻击者试图巧妙操控邮件流的迹象。'
- en: '**Remove-InboxRule**: The deletion of mailbox rules is captured under this
    operation. While it might seem benign, the removal of certain rules, particularly
    security-related ones, can be a tactic used by attackers to reduce detection of
    their activities.'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Remove-InboxRule**：删除邮箱规则的操作会被记录在此操作中。虽然这看起来无害，但删除某些规则，特别是与安全相关的规则，可能是攻击者用来减少其活动被检测到的一种策略。'
- en: '**New-TransportRule and Set-TransportRule**: These operations are associated
    with the creation and modification of transport rules, which are more complex
    and can control email flow at the organizational level. Unauthorized changes here
    could have widespread implications.'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**New-TransportRule 和 Set-TransportRule**：这些操作与传输规则的创建和修改相关，传输规则更加复杂，可以在组织级别控制邮件流。这里的未经授权的更改可能会产生广泛的影响。'
- en: 'For example, the next screenshot is from a compromised 365 incident where threat
    actors had created a new inbox rule called `zz`. This inbox rule automatically
    deletes any emails that contain the following words in the subject line or body:
    “scam”, “fraud”, “phish”, and an email address that has been sanitized for privacy
    reasons. This is because the attacker is trying to cover their tracks such that
    any emails or warnings from others related to their objective, that is, to “scam”
    or “fraud” the organization out of money, will be automatically deleted, and as
    a result, the threat attacker can complete their attack unnoticed.'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，下一个截图来自一起Microsoft 365被攻破的事件，其中威胁行为者创建了一个名为`zz`的新收件箱规则。这个收件箱规则会自动删除任何在主题行或正文中包含以下词汇的电子邮件：“骗局”、“欺诈”、“网络钓鱼”，以及一个为了隐私原因已被清理的电子邮件地址。这是因为攻击者试图掩盖其行踪，使得任何与其目标相关的电子邮件或警告——也就是“骗局”或“欺诈”组织的钱财——都会被自动删除，从而威胁攻击者可以在不被察觉的情况下完成攻击。
- en: '![Figure 12.20 – Example malicious inbox rule](img/00199.jpeg)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.20 – 恶意收件箱规则示例](img/00199.jpeg)'
- en: Figure 12.20 – Example malicious inbox rule
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.20 – 恶意收件箱规则示例
- en: In addition to monitoring these specific operations, correlating this information
    with other login data, such as login locations and times, can provide a more comprehensive
    picture of the attacker’s activities. For example, the creation of a new inbox
    rule immediately following a login from an unusual geographic location can be
    a strong indicator of a compromised account.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 除了监控这些特定操作外，将这些信息与其他登录数据（例如登录地点和时间）进行关联，可以更全面地了解攻击者的活动。例如，从一个不寻常的地理位置登录后立即创建新的收件箱规则，可能是账户被攻破的有力迹象。
- en: 'When addressing the issue of data exfiltration in Microsoft 365 compromises,
    incident responders need to focus on specific operations within the audit logs
    that can indicate unauthorized data movement or access. Data exfiltration can
    occur in various ways, such as through Outlook synchronization, accessing data
    via a web browser, or other activities. Understanding these nuances is vital for
    identifying potential breaches:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理Microsoft 365泄露数据问题时，事件响应者需要关注审核日志中的特定操作，这些操作可能表明未经授权的数据移动或访问。数据外泄可以通过多种方式发生，比如通过Outlook同步、通过Web浏览器访问数据或其他活动。理解这些细节对于识别潜在的安全漏洞至关重要：
- en: '**Outlook client synchronization (via SyncFolderItems operation)**: This operation
    is logged when a user’s Outlook client syncs with the mailbox. Excessive or unusual
    sync activities, especially from unfamiliar devices or locations, can indicate
    that someone is trying to download a large amount of data. Comparing the volume
    and frequency of these sync operations against typical user behavior can reveal
    anomalies.'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Outlook客户端同步（通过SyncFolderItems操作）**：当用户的Outlook客户端与邮箱同步时，会记录此操作。过度或异常的同步活动，尤其是来自不熟悉的设备或位置，可能表明有人试图下载大量数据。将这些同步操作的数量和频率与典型用户行为进行比较，可以揭示异常。'
- en: '`MailItemsAccessed` events, especially from attacker IP addresses, suggests
    not only unauthorized access but that the threat actors viewed the contents of
    those mail items.'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`MailItemsAccessed`事件，尤其是来自攻击者IP地址的事件，不仅表明未经授权的访问，还表明威胁行为者查看了这些邮件项目的内容。'
- en: '`FileDownloaded`, `FileCopied`, `FileMoved`, and `FileDeleted` within SharePoint
    or OneDrive for Business are key indicators. These actions, particularly in high
    volumes or from atypical locations, can signal that someone is exfiltrating data.'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FileDownloaded`、`FileCopied`、`FileMoved`和`FileDeleted`在SharePoint或OneDrive
    for Business中的操作是关键指标。这些行为，尤其是在高频次或来自不寻常位置的情况下，可能表明有人正在进行数据外泄。'
- en: '**Email forwarding rules (New-InboxRule, Set-InboxRule)**: As with mailbox
    compromises, the creation or modification of inbox rules that automatically forward
    emails to external addresses can be a method of data exfiltration.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**电子邮件转发规则（New-InboxRule, Set-InboxRule）**：与邮箱被攻破类似，创建或修改自动将电子邮件转发到外部地址的收件箱规则可能是一种数据外泄的手段。'
- en: '**eDiscovery search and export operations (SearchQueryInitiated, SearchQueryPerformed,
    ExportStarted)**: These operations indicate that someone is performing searches
    and possibly exporting data from eDiscovery, which can be a sophisticated way
    of extracting large datasets for malicious purposes.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**eDiscovery搜索与导出操作（SearchQueryInitiated, SearchQueryPerformed, ExportStarted）**：这些操作表明有人正在进行搜索，可能还在导出eDiscovery中的数据，这可能是恶意提取大规模数据集的一种复杂方式。'
- en: '**Unusual sending patterns (Send and SendAs operations)**: A spike in email
    sending activities, especially those with large attachments or sent to external
    recipients, might indicate an attempt to exfiltrate data via email.'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**异常发送模式（发送和SendAs操作）**：电子邮件发送活动的激增，尤其是带有大附件或发送给外部收件人的邮件，可能表明试图通过电子邮件窃取数据。'
- en: Important note
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: All mailbox audited activities (i.e., operations) can be found in Microsoft’s
    documentation at [https://learn.microsoft.com/en-us/purview/audit-mailboxes](https://learn.microsoft.com/en-us/purview/audit-mailboxes).
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 所有邮箱审计活动（即操作）可以在微软的文档中找到，[https://learn.microsoft.com/en-us/purview/audit-mailboxes](https://learn.microsoft.com/en-us/purview/audit-mailboxes)。
- en: One of the key questions that organizations must answer during a productivity
    suite breach is whether data was exfiltrated by attackers. Analyzing the outlined
    operations will allow incident responders to better understand the scope of the
    incident from a data breach perspective.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在生产力套件发生泄露时，组织必须回答的一个关键问题是数据是否被攻击者窃取。通过分析列出的操作，事件响应人员可以更好地理解从数据泄露角度来看事件的范围。
- en: 'Incident responders should also consider reviewing the following valuable sources
    of information in the context of a 365 compromise:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 事件响应人员还应考虑在365环境遭到攻击时，审查以下有价值的信息来源：
- en: '**Impersonation rights**: These rights allow a user to perform actions on behalf
    of another user. Incident responders should check for unexpected or unauthorized
    assignments of impersonation rights. This can be done by reviewing the role assignments
    for each user.'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**冒充权限**：这些权限允许用户代表其他用户执行操作。事件响应人员应检查是否有任何意外或未经授权的冒充权限分配。这可以通过审查每个用户的角色分配来完成。'
- en: '**List of Azure Active Directory administrators**: Reviewing the current Azure
    **Active Directory** (**AD**) administrators is important. You can view this list
    in the Azure AD admin center. Look for any unfamiliar accounts or changes in administrator
    roles, as attackers can elevate privileges to gain wider access in a 365 compromise.'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure Active Directory管理员列表**：审查当前的Azure **Active Directory**（**AD**）管理员非常重要。你可以在Azure
    AD管理中心查看此列表。查找任何不熟悉的帐户或管理员角色的变化，因为攻击者可能通过提升权限来获得更广泛的访问权限，在365环境中进行攻击。'
- en: '**List of Azure AD users**: Incident responders should audit a list of all
    users in Azure AD. Pay special attention to newly created users, especially those
    with high privileges. Check this list through the Azure AD admin center. Unexpected
    user accounts can be a sign that an attacker has created backdoors.'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure AD用户列表**：事件响应人员应审计Azure AD中的所有用户列表。特别关注新创建的用户，尤其是拥有高权限的用户。通过Azure AD管理中心检查此列表。意外的用户帐户可能是攻击者创建后门的迹象。'
- en: '**Consent grants**: These are permissions granted to applications to access
    user data. Review the consent grants in the Azure AD admin center for any unusual
    or broad permissions granted to unknown or suspicious applications. Excessive
    permissions can be abused for data access and exfiltration.'
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**同意授权**：这些是授予应用程序访问用户数据的权限。请在Azure AD管理中心查看同意授权，检查是否有授予未知或可疑应用程序的异常或广泛权限。过多的权限可能会被滥用，用于数据访问和窃取。'
- en: '**eDiscovery roles**: Users with eDiscovery roles can search and export content
    from mailboxes and sites. Check who has been assigned these roles in Microsoft
    Purview. Though unlikely, unauthorized eDiscovery role assignments can indicate
    an attempt to illicitly access and export sensitive data.'
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**eDiscovery角色**：拥有eDiscovery角色的用户可以从邮箱和网站中搜索并导出内容。检查谁被分配了这些角色。虽然不太可能，未经授权的eDiscovery角色分配可能表明试图非法访问并导出敏感数据。'
- en: '**Exchange online administrators**: It’s important to regularly review who
    has administrative privileges in Exchange Online, as these accounts have significant
    control over email operations. Check for any unexpected changes or additions in
    the Exchange admin center.'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Exchange在线管理员**：定期审查谁拥有Exchange Online的管理员权限非常重要，因为这些帐户对电子邮件操作具有重要控制权。检查Exchange管理中心中的任何意外更改或添加。'
- en: '**Transport rules (mail flow)**: These are rules set up in Exchange Online
    to control mail flow. Review the transport rules for any that redirect or copy
    emails to external domains, which can be a method of data exfiltration.'
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**传输规则（邮件流）**：这是在Exchange Online中设置的控制邮件流的规则。审查传输规则，查看是否有任何将电子邮件重定向或复制到外部域的规则，这可能是数据窃取的方法。'
- en: All of these sources for analysis can be reviewed by the CSVs that are generated
    by the HAWK tool, as demonstrated in *Figure 12**.17*.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些分析来源可以通过HAWK工具生成的CSV文件进行查看，如*图12.17*所示。
- en: Google Workspace incident response
  id: totrans-214
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Google Workspace 事件响应
- en: After understanding the basics of an incident as we have discussed in the *Initial
    scoping and response* section, incident responders using Google Workspace face
    the challenge of identifying compromises and starting threat hunting. **Google
    Workspace**, unlike Microsoft 365, offers fewer tools for this purpose, focusing
    mainly on its audit and reporting features. These tools, while not as extensive,
    are crucial for collecting logs and spotting unusual activities. This means responders
    often need to supplement these tools with external resources and more hands-on
    analysis to effectively track and investigate potential security breaches in Google
    Workspace environments.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们已经讨论的*初步范围确定和响应*部分中，理解事件的基本情况之后，使用 Google Workspace 的事件响应人员面临着识别安全事件和启动威胁狩猎的挑战。与
    Microsoft 365 不同，**Google Workspace** 提供的工具较少，主要集中在审计和报告功能上。尽管这些工具没有那么全面，但对于收集日志和发现异常活动至关重要。这意味着响应人员通常需要结合外部资源和更深入的分析，才能有效追踪和调查
    Google Workspace 环境中的潜在安全漏洞。
- en: Tooling
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工具
- en: 'In a similar vein to our discussion on Microsoft 365, let’s explore how incident
    responders can leverage audit logs in Google Workspace to investigate and understand
    the extent of compromises:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 与我们在 Microsoft 365 上的讨论类似，让我们探讨事件响应人员如何利用 Google Workspace 中的审计日志来调查和了解安全事件的范围：
- en: '**Accessing the audit logs**: In Google Workspace, the audit logs are accessible
    through the Admin console. Incident responders can find these logs by navigating
    to the **Reports** section and then to the **Audit** subsection.'
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**访问审计日志**：在 Google Workspace 中，可以通过管理员控制台访问审计日志。事件响应人员可以通过导航到**报告**部分，然后进入**审计**子部分来查找这些日志。'
- en: As with Microsoft 365, the initial step involves understanding the incident’s
    timeline, identifying potentially compromised accounts, and determining the nature
    of suspicious activities. This understanding helps to apply the right filters
    in the audit logs, making the search more efficient and focused.
  id: totrans-219
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 与 Microsoft 365 一样，第一步是了解事件的时间线，识别可能被攻击的账户，并确定可疑活动的性质。这种理解有助于在审计日志中应用正确的过滤器，使搜索更加高效和专注。
- en: '**Applying filters in audit log search**: Google Workspace’s audit log search
    offers various filters to refine searches:'
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**在审计日志搜索中应用过滤器**：Google Workspace 的审计日志搜索提供了各种过滤器来细化搜索：'
- en: '**Date and time**: Set the specific time frame of interest'
  id: totrans-221
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**日期和时间**：设置特定的时间范围'
- en: '**Events**: Choose from a range of activities, such as email sent, file shared,
    admin activity, and more'
  id: totrans-222
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件**：从一系列活动中选择，如发送电子邮件、共享文件、管理员活动等'
- en: '**Users**: Focus on specific user accounts under suspicion'
  id: totrans-223
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**用户**：关注可疑的特定用户账户'
- en: '**Applications**: Filter by specific Google Workspace applications, such as
    Gmail, Drive, and Calendar, if relevant'
  id: totrans-224
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序**：如果相关，可按特定的 Google Workspace 应用程序进行过滤，例如 Gmail、Drive 和 Calendar'
- en: '**Running the search**: After setting the filters, run the search. The results
    will display a list of events that fit the criteria, which can then be reviewed
    for any suspicious activity.'
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**运行搜索**：设置过滤器后，运行搜索。结果将显示符合条件的事件列表，然后可以审查其中的可疑活动。'
- en: '**Exporting logs for analysis**: Google Workspace allows the exporting of search
    results for more detailed analysis. These exports can include comprehensive event
    information such as IP addresses, actions taken, and affected resources.'
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**导出日志以进行分析**：Google Workspace 允许导出搜索结果以便进行更详细的分析。这些导出内容可以包括全面的事件信息，如 IP 地址、采取的行动和受影响的资源。'
- en: '**Utilizing external tools for analysis**: Once exported, the logs can be further
    analyzed using tools such as Excel or other data analysis software. This step
    is crucial for spotting patterns, creating timelines, and correlating events across
    different logs.'
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**利用外部工具进行分析**：一旦导出，日志可以使用 Excel 或其他数据分析软件进一步分析。此步骤对于发现模式、创建时间线并关联不同日志中的事件至关重要。'
- en: '**Analyzing results**: Carefully examine the audit log entries for unusual
    or unauthorized activities. Look for anomalies or patterns that could suggest
    malicious behavior, such as mass file downloads, unusual login times, or unexpected
    external sharing of documents. This is further discussed in the upcoming *Analysis*
    section.'
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**分析结果**：仔细检查审计日志条目中是否有异常或未经授权的活动。寻找可能表明恶意行为的异常或模式，例如大规模下载文件、异常的登录时间或意外的外部文件共享。更多内容将在接下来的*分析*部分中讨论。'
- en: Important note
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Similar to Microsoft 365, exporting results from Google Workspace audit logs
    may have limitations in terms of the number of entries that one can export. It’s
    important to ensure that your search is precise enough to capture all relevant
    data without exceeding these limits (typically 100,000 entries).
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于 Microsoft 365，从 Google Workspace 审计日志导出结果可能在可导出的条目数量上有限制。重要的是确保你的搜索足够精确，以便捕捉到所有相关数据而不超过这些限制（通常为
    100,000 条记录）。
- en: Searching and extracting Google Workspace logs
  id: totrans-231
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 搜索并提取 Google Workspace 日志
- en: 'As discussed in [*Chapter 7*](part0026_split_000.html#_idTextAnchor137), Google
    Workspace provides a range of audit logs, each tailored to different applications
    and activities. Key logs include the following:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 正如在 [*第7章*](part0026_split_000.html#_idTextAnchor137) 中讨论的那样，Google Workspace
    提供了一系列审计日志，每种日志针对不同的应用和活动。主要日志包括以下内容：
- en: '**Admin activity logs**: Track administrative actions such as changes to settings
    or user management'
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**管理员活动日志**：跟踪管理员操作，如设置更改或用户管理'
- en: '**Login logs**: Monitor user sign-in attempts, successful or otherwise, which
    is crucial for identifying unauthorized access attempts'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**登录日志**：监控用户登录尝试，无论成功与否，这对于识别未经授权的访问尝试至关重要'
- en: '**Drive audit logs**: Essential for tracking file sharing and access within
    Google Drive'
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Drive 审计日志**：对于跟踪 Google Drive 中的文件共享和访问至关重要'
- en: '**Gmail logs**: Monitor for unusual email activities, such as mass deletions
    or forwarding rules'
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Gmail 日志**：监控异常的电子邮件活动，例如大规模删除或转发规则'
- en: 'To export the Google Workspace’s audit logs, incident responders can follow
    these steps:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 要导出 Google Workspace 的审计日志，事件响应者可以按照以下步骤操作：
- en: In the Google Workspace admin console (`admin.google.com`), go to **Reports**
    and then **Audit** **and Investigations.**
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Google Workspace 管理控制台（`admin.google.com`）中，进入 **报告**，然后选择 **审计** 和 **调查**。
- en: Choose the specific audit log (e.g., admin log events, user log events, and
    group log events).
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择特定的审计日志（例如，管理员日志事件、用户日志事件和组日志事件）。
- en: Apply the necessary filters and run the search.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用必要的过滤器并执行搜索。
- en: Once the results are displayed, use the **Download** or **Export** option to
    save the data for further analysis.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦结果显示出来，使用 **下载** 或 **导出** 选项保存数据以便进一步分析。
- en: The exported logs can be in the CSV format, making it easier to import into
    data analysis tools. When using tools such as Excel, responders can sort, filter,
    and use functions to analyze the data more effectively.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 导出的日志可以是 CSV 格式，便于导入数据分析工具。使用如 Excel 等工具时，响应者可以排序、筛选，并使用函数更有效地分析数据。
- en: 'The following figures demonstrate the steps to export the audit events. Start
    by navigating to the **Reporting** and then going to the **Audit and investigation**
    tab, as shown:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图示展示了导出审计事件的步骤。首先导航至 **报告**，然后进入 **审计与调查** 标签，如下所示：
- en: '![Figure 12.21 – Reporting tab](img/00016.jpeg)'
  id: totrans-244
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.21 – 报告标签页](img/00016.jpeg)'
- en: Figure 12.21 – Reporting tab
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.21 – 报告标签页
- en: 'The following screenshot demonstrates all available logs under the **Audit
    and investigation** tab in the Google Workspace administrative console:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 下图展示了在 Google Workspace 管理控制台中，**审计与调查**标签下所有可用的日志：
- en: '![Figure 12.22 – Audit and investigations](img/00035.jpeg)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.22 – 审计与调查](img/00035.jpeg)'
- en: Figure 12.22 – Audit and investigations
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.22 – 审计与调查
- en: 'Similar to Microsoft 365 audit log searches, filters can be set, as shown in
    this figure:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Microsoft 365 审计日志搜索类似，可以设置过滤器，如图所示：
- en: '![Figure 12.23 – User events](img/00052.jpeg)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.23 – 用户事件](img/00052.jpeg)'
- en: Figure 12.23 – User events
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.23 – 用户事件
- en: 'An example of the exported data is shown here:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 这里展示了导出数据的示例：
- en: '![Figure 12.24 – Exported user events](img/00070.jpeg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![图 12.24 – 导出的用户事件](img/00070.jpeg)'
- en: Figure 12.24 – Exported user events
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12.24 – 导出的用户事件
- en: Next, we will dive into the analysis portion of a Google Workspace compromise.
    A similar process to the Microsoft 365 analysis is to be followed for Google Workspace
    with a difference in audit logs and their syntax. The principles of verifying
    unusual logins remain the same.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将深入分析 Google Workspace 被攻击的部分。与 Microsoft 365 分析相似的过程也适用于 Google Workspace，但审计日志及其语法有所不同。验证异常登录的原则是相同的。
- en: Analysis
  id: totrans-256
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析
- en: 'An analysis of a compromised Google Workspace environment requires focusing
    on mainly user and admin events. Incident responders need to thoroughly investigate
    these logs to identify evidence of unauthorized access and other indicators of
    compromise, similar to Microsoft 365, but this time in the Google ecosystem:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 对被入侵的Google Workspace环境的分析需要主要关注用户和管理员事件。事件响应人员需要彻底调查这些日志，以识别未授权访问的证据和其他入侵指标，类似于Microsoft
    365，但这次是在Google生态系统中。
- en: '**Login audit log analysis (user** **log events)**:'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**登录审计日志分析（用户** **日志事件）**：'
- en: '**Key events**: Focus on **Successful login** and **Login failure** events.
    These indicate successful and unsuccessful login attempts.'
  id: totrans-259
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关键事件**：关注**成功登录**和**登录失败**事件。这些事件表明登录尝试的成功与失败。'
- en: '**Patterns to look for**: Repeated login failures followed by a success, particularly
    from varied IP addresses or geographic locations, could signal brute force attempts.'
  id: totrans-260
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**需要注意的模式**：重复的登录失败后接成功，特别是来自不同IP地址或地理位置的登录，可能表示暴力破解攻击。'
- en: '**IP and geolocation analysis**: Compare the IP addresses from the logs against
    the user’s typical login locations. Discrepancies in geolocation data can be a
    strong indicator of unauthorized access.'
  id: totrans-261
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IP和地理位置分析**：将日志中的IP地址与用户的典型登录位置进行比较。地理位置数据的差异可能是未授权访问的强烈指示。'
- en: '**Gmail (Email)** **log investigation**:'
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Gmail（邮件）** **日志调查**：'
- en: '**Critical events**: Look for **Email sent**, **Email read**, and **Email**
    **deleted** activities.'
  id: totrans-263
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关键事件**：查看**邮件发送**、**邮件阅读**和**邮件删除**活动。'
- en: '**Anomalies to detect**: High volumes of outbound emails to unknown addresses,
    bulk deletion of emails, or opening numerous emails in a short time frame can
    suggest account takeover. Furthermore, look into the creation and modification
    of any inbox rules, similar to what we discussed in the *Microsoft 365 incident*
    *response* section.'
  id: totrans-264
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**需要检测的异常**：大量发送邮件到未知地址、大量删除邮件或在短时间内打开大量邮件，可能表示账户被接管。此外，还需查看任何收件箱规则的创建和修改，类似于我们在*Microsoft
    365事件* *响应*部分中讨论的内容。'
- en: '**Admin activity** **log review**:'
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**管理员活动** **日志审查**：'
- en: '**Significant events**: Monitor **User creation**, **User role change**, and
    **Service** **settings changed**.'
  id: totrans-266
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**重要事件**：监控**用户创建**、**用户角色更改**和**服务** **设置更改**。'
- en: '**Red flags**: Unauthorized creation of new users, escalation of privileges,
    or alterations in security settings are critical areas of concern.'
  id: totrans-267
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**警示信号**：未授权创建新用户、权限提升或安全设置更改是需要重点关注的关键问题。'
- en: '**OAuth token** **activity monitoring**:'
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**OAuth令牌** **活动监控**：'
- en: '**Key events**: Track **Token granted** and **Token** **revoked** actions.'
  id: totrans-269
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关键事件**：跟踪**令牌授予**和**令牌撤销**操作。'
- en: '**Concerning observations**: The granting of tokens to unfamiliar third-party
    applications or an unusual pattern of token revocations can indicate that an attacker
    is trying to access data or services.'
  id: totrans-270
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关注观察**：向不熟悉的第三方应用授予令牌或令牌撤销的异常模式可能表明攻击者正在试图访问数据或服务。'
- en: '**Groups audit** **log examination**:'
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**组审计** **日志检查**：'
- en: '**Crucial events**: Monitor **Group member added** and **Group** **settings
    changed**.'
  id: totrans-272
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关键事件**：监控**组成员添加**和**组设置更改**。'
- en: '**Indicators of compromise**: An indicator is the addition of unknown members
    to critical groups or unauthorized changes in group settings, particularly in
    groups with access to sensitive information.'
  id: totrans-273
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**入侵指标**：一个指标是将未知成员添加到关键组中，或对组设置进行未经授权的更改，特别是在访问敏感信息的组中。'
- en: For each of these areas, incident responders should employ a context-driven
    approach. This involves looking beyond the mere occurrence of events to understanding
    their relevance in the broader context of user behavior and organizational norms.
    Analyzing the frequency, timing, and pattern deviations is crucial. We saw earlier
    in the *Microsoft 365 incident response* section how the login IPs can be looked
    up with an IP lookup service to better understand unauthorized access—the same
    process can be followed for Google Workspace.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这些领域，事件响应人员应采用基于上下文的方法。这意味着不仅要关注事件的发生，还要理解它们在用户行为和组织规范的更广泛背景下的相关性。分析事件的频率、时间和模式偏差至关重要。我们在*Microsoft
    365事件响应*部分中看到，如何通过IP查询服务查看登录IP以更好地理解未授权访问——同样的过程也可以应用于Google Workspace。
- en: Important note
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Google Workspace’s UI and syntax may change in the future, as these are active
    products being developed by their teams. As a result, some of the event names
    may change, but their principles are the same (for example, **Successful login**
    could change to **Login success** or vice versa).
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: Google Workspace的用户界面和语法未来可能会发生变化，因为这些是由其团队开发的活跃产品。因此，一些事件名称可能会发生变化，但其原理保持不变（例如，**成功登录**可能会改为**登录成功**，反之亦然）。
- en: Summary
  id: totrans-277
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this final chapter on analyzing compromised cloud productivity suites, we
    explored how to tackle security incidents in the two most popular cloud-based
    productivity suites, Microsoft 365 and Google Workspace. These platforms, crucial
    for emails, storage, and office applications, are frequently targeted in BEC attacks.
    BEC, a sophisticated form of cyber fraud, often involves attackers gaining unauthorized
    access through email spoofing or account takeovers, leading to broader security
    breaches.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章关于分析被妥协的云生产力套件中，我们探讨了如何应对在两个最流行的基于云的生产力套件——Microsoft 365和Google Workspace中的安全事件。这些平台在电子邮件、存储和办公应用程序中至关重要，经常成为BEC攻击的目标。BEC是一种复杂的网络欺诈形式，通常涉及攻击者通过电子邮件欺骗或账户接管获得未授权访问，从而导致更广泛的安全漏洞。
- en: The chapter provided a guide to understanding BEC, its phases, and attacker
    methods. It then outlined crucial steps for initial scoping and remediation, essential
    for effective incident response. For Microsoft 365, it focused on using tools
    such as unified audit logs and Microsoft Purview for log analysis. It also discussed
    an open source PowerShell-based tool, HAWK, for streamlined data collection.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 本章节提供了关于了解BEC、其各阶段和攻击者方法的指南。接着，概述了初步评估和修复的关键步骤，这是有效应对事件的关键。针对Microsoft 365，重点介绍了使用统一审计日志和Microsoft
    Purview进行日志分析的工具。还讨论了一个基于PowerShell的开源工具HAWK，用于简化数据收集。
- en: In contrast, Google Workspace incident response was discussed, with its more
    limited, yet vital, set of audit and reporting tools. The process involves using
    Google Workspace’s audit logs to identify suspicious activities. This chapter
    equipped you with the knowledge to effectively respond to incidents in both Microsoft
    365 and Google Workspace.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，讨论了Google Workspace的事件响应，其审计和报告工具虽然功能有限，但仍至关重要。该过程涉及使用Google Workspace的审计日志来识别可疑活动。本章为您提供了在Microsoft
    365和Google Workspace中有效应对事件的知识。
- en: Further reading
  id: totrans-281
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: '*Microsoft* *Purview*: [https://learn.microsoft.com/en-us/purview/](https://learn.microsoft.com/en-us/purview/)'
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Microsoft* *Purview*: [https://learn.microsoft.com/en-us/purview/](https://learn.microsoft.com/en-us/purview/)'
- en: '*What is a Business Email Compromise (**BEC)*—Microsoft: [https://www.microsoft.com/en-ca/security/business/security-101/what-is-business-email-compromise-bec](https://www.microsoft.com/en-ca/security/business/security-101/what-is-business-email-compromise-bec)'
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*什么是商务电子邮件欺诈（**BEC**）—微软*: [https://www.microsoft.com/en-ca/security/business/security-101/what-is-business-email-compromise-bec](https://www.microsoft.com/en-ca/security/business/security-101/what-is-business-email-compromise-bec)'
- en: '*Identify and secure compromised accounts*—Google Workspace: [https://support.google.com/a/topic/1355151?hl=en&ref_topic=1258984&sjid=10797876945924014941-NC](https://support.google.com/a/topic/1355151?hl=en&ref_topic=1258984&sjid=10797876945924014941-NC)'
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*识别并保护被妥协的账户*—Google Workspace: [https://support.google.com/a/topic/1355151?hl=en&ref_topic=1258984&sjid=10797876945924014941-NC](https://support.google.com/a/topic/1355151?hl=en&ref_topic=1258984&sjid=10797876945924014941-NC)'
