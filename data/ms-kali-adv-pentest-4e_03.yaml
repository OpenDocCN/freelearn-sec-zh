- en: '3'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '3'
- en: Active Reconnaissance of External and Internal Networks
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 外部和内部网络的主动侦察
- en: Active reconnaissance is the art of collecting information directly from a target.
    The purpose of this phase is to collect and weaponize information about the target
    to the greatest degree possible to facilitate the exploitation phase of the kill
    chain methodology. We saw in the last chapter how to perform passive reconnaissance
    using OSINT, which is almost undetectable and can yield a significant amount of
    information about the target organization and its users. This phase builds on
    the results obtained from OSINT and passive reconnaissance and emphasizes more
    focused probing to identify the path to, and the attack surface of, a target.
    In general, complex systems have a greater attack surface, and each surface may
    be exploited and then leveraged to support additional attacks.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 主动侦察是直接从目标收集信息的艺术。这个阶段的目的是尽可能多地收集并武器化有关目标的信息，以促进“杀伤链”方法论的利用阶段。在上一章中，我们讨论了如何使用OSINT进行被动侦察，这几乎是不可被察觉的，并且能提供关于目标组织及其用户的大量信息。这个阶段建立在OSINT和被动侦察获得的结果基础上，强调更加集中的探测，以识别通往目标的路径以及攻击面。一般而言，复杂系统具有更大的攻击面，而每个攻击面都可能被利用，从而支持更多的攻击。
- en: 'Although active reconnaissance produces more useful information, interactions
    with the target system may be logged, triggering alarms by protective devices,
    such as firewalls, **Intrusion Detection Systems** (**IDSes**), **Intrusion Prevention
    Systems** (**IPSes**), and **Endpoint Detection Response** (**EDR**) **systems**.
    As the usefulness of the data to the attacker increases, so does the risk of detection;
    this is shown in *Figure 3.1*:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管主动侦察能产生更有用的信息，但与目标系统的交互可能会被记录，从而触发保护设备（如防火墙、**入侵检测系统**（**IDSes**）、**入侵防御系统**（**IPSes**）和**终端检测响应**（**EDR**）**系统**）的警报。随着数据对攻击者的有用性增加，检测的风险也随之增加；这一点在*图
    3.1*中有所体现：
- en: '![](../Images/B17765_03_01.png)'
  id: totrans-4
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_01.png)'
- en: 'Figure 3.1: Usefulness of data and risk of detection for attackers'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.1：数据的有用性与攻击者检测风险
- en: 'To improve the effectiveness of active reconnaissance in providing detailed
    information, our focus will be on using the stealthiest techniques, as these will
    be the most difficult to detect. In this chapter, you will learn about the following:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高主动侦察提供详细信息的效果，我们的重点将放在使用最隐蔽的技术上，因为这些技术最难被检测到。在本章中，你将学习以下内容：
- en: Stealth scanning techniques
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隐蔽扫描技术
- en: External and internal infrastructure, host discovery, and enumeration
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 外部和内部基础设施、主机发现与枚举
- en: Comprehensive reconnaissance of applications, especially recon-ng
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对应用程序进行全面侦察，特别是 recon-ng
- en: Enumeration of internal hosts using DHCP
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用DHCP枚举内部主机
- en: Enumerating services within the SaaS applications
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在SaaS应用程序中枚举服务
- en: Useful Microsoft Windows commands during penetration testing
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 渗透测试中有用的微软Windows命令
- en: Taking advantage of default configurations
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用默认配置
- en: Enumeration of users using SNMP, SMB, and rpcclient
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SNMP、SMB和rpcclient进行用户枚举
- en: Stealth scanning techniques
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 隐蔽扫描技术
- en: The greatest risk of active reconnaissance is discovery by a target. Using the
    tester’s time and data stamps, the source IP address, and additional information,
    the target can identify the source of the incoming reconnaissance.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 主动侦察的最大风险是被目标发现。通过测试人员的时间和数据戳、源IP地址以及其他信息，目标可以识别侦察的来源。
- en: 'Therefore, stealth techniques are employed to minimize the chances of detection.
    When employing stealth to support reconnaissance, a tester mimicking the actions
    of a hacker will do the following:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，采用隐蔽技术来最小化被检测的可能性。在支持侦察时，模拟黑客行为的测试人员将执行以下操作：
- en: Camouflage tool signatures to avoid detection and thereby trigger an alarm
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 伪装工具签名以避免被检测，从而触发警报
- en: Hide the attack within legitimate traffic
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将攻击隐藏在合法流量中
- en: Modify the attack to hide the source and type of traffic
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 修改攻击以隐藏流量的来源和类型
- en: Make the attack invisible using non-standard traffic types or encryption
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用非标准流量类型或加密使攻击不可见
- en: 'Stealth scanning techniques can include some or all of the following:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 隐蔽扫描技术可以包括以下部分或全部内容：
- en: Adjusting source IP stack and tool identification settings
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整源IP栈和工具识别设置
- en: Modifying packet parameters (Nmap)
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 修改数据包参数（Nmap）
- en: Using proxies with anonymity networks (ProxyChains and the Tor network)
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用带有匿名网络的代理（ProxyChains和Tor网络）
- en: Adjusting source IP stack and tool identification settings
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调整源IP栈和工具识别设置
- en: Before the penetration tester (or the attacker) begins testing, we must ensure
    that all unnecessary services on Kali are disabled or turned off. This is to prevent
    detection. Say that the local DHCP daemon is enabled but is not required. It is
    possible for the DHCP to interact with the target system, which could then be
    logged and send alarms to the target’s administrators. Other services that require
    updating might establish network communication to the licensing server or bug
    reporting services, so it is better to disable all those services that are not
    required during the course of testing and enable only what is required to perform
    a given task.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试员（或攻击者）开始测试之前，我们必须确保Kali上所有不必要的服务都被禁用或关闭。这是为了防止被检测到。例如，本地的DHCP守护进程已启用但并不需要。DHCP有可能与目标系统交互，从而被记录并向目标管理员发送警报。其他需要更新的服务可能会与授权服务器或错误报告服务建立网络通信，因此最好在测试过程中禁用所有不需要的服务，只启用执行特定任务所必需的服务。
- en: Some commercial and open-source tools (for example, the Metasploit framework)
    tag their packets with an identifying sequence. Although this can be useful in
    a post-test analysis of a system’s event logs (where events initiated by a particular
    testing tool can be directly compared to a system’s event logs to determine how
    the network detected and responded to the attack), it can also trigger certain
    intrusion detection systems. Test your tools against a lab system to determine
    the packets that are tagged, and either change the tag or use the tool with caution.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 一些商业和开源工具（例如Metasploit框架）会在其数据包中标记一个标识序列。虽然这在测试后分析系统事件日志时非常有用（可以将由特定测试工具发起的事件与系统的事件日志直接比较，以确定网络如何检测和响应攻击），但它也可能触发某些入侵检测系统。在实验室系统中测试你的工具，确定哪些数据包被标记，并且可以选择更改标签或小心使用该工具。
- en: The easiest way to identify tagging is to apply the tool against a newly created
    virtual image as the target, and review system logs for the tool’s name. In addition,
    use Wireshark to capture traffic between the attacker and target virtual machines,
    and then search the **packet capture** (**pcap**) files for any keywords that
    can be attributed to the testing tool (name of the tool, vendor, license number,
    and so on).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 识别标记的最简单方法是将工具应用于新创建的虚拟镜像作为目标，并查看系统日志中的工具名称。此外，使用Wireshark捕获攻击者和目标虚拟机之间的流量，然后在**数据包捕获**（**pcap**）文件中搜索任何可以归因于测试工具的关键词（工具名称、供应商、许可证号等）。
- en: '`useragent` in the Metasploit framework can be changed by modifying the `http_form_field`
    option. From the `msfconsole` prompt, select the option to use `auxiliary/fuzzers/http/http_form_field`
    and then set a new `useragent` header, as shown in *Figure 3.2*:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过修改`http_form_field`选项来更改Metasploit框架中的`useragent`。在`msfconsole`提示符下，选择使用`auxiliary/fuzzers/http/http_form_field`选项，然后设置一个新的`useragent`头，如*图3.2*所示：
- en: '![](../Images/B17765_03_02.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_02.png)'
- en: 'Figure 3.2: Changing the User agent in the Metasploit auxiliary'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.2：在Metasploit辅助工具中更改User agent
- en: In this example, `useragent` was set to be Google’s indexing spider, `Googlebot-Image`.
    This is a common automated application that visits and indexes websites, and rarely
    attracts attention from the website’s owner.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，`useragent`被设置为Google的索引蜘蛛`Googlebot-Image`。这是一个常见的自动化应用程序，访问并索引网站，很少引起网站所有者的注意。
- en: 'Pentesters can also choose to use plugins such as Firefox’s user agent switcher:
    [https://addons.mozilla.org/en-GB/firefox/addon/uaswitcher/](https://addons.mozilla.org/en-GB/firefox/addon/uaswitcher/)'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员还可以选择使用插件，如Firefox的User agent切换器：[https://addons.mozilla.org/en-GB/firefox/addon/uaswitcher/](https://addons.mozilla.org/en-GB/firefox/addon/uaswitcher/)
- en: 'Another alternative is Chrome’s user agent switcher:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种选择是使用Chrome的User agent切换器：
- en: '[https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg](https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg)'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg](https://chrome.google.com/webstore/detail/user-agent-switcher-for-c/djflhoibgkdhkhhcedjiklpkjnoahfmg)'
- en: 'To identify legitimate `useragent` headers, refer to the examples at:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 要识别合法的`useragent`头，请参考以下示例：
- en: '[http://www.useragentstring.com/](http://www.useragentstring.com/)'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.useragentstring.com/](http://www.useragentstring.com/)'
- en: Modifying packet parameters
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 修改数据包参数
- en: The most common approach to active reconnaissance is to conduct a scan against
    the target, send defined packets to it, and then use the returned packets to gain
    information. The most popular tool of this type is **Network Mapper** (**Nmap**).
    To use Nmap effectively, it must be run with root-level privileges. This is typical
    of applications that manipulate packets, hence we will be using `sudo` for all
    Nmap queries.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 最常见的主动侦察方法是对目标进行扫描，向其发送特定数据包，然后利用返回的数据包获取信息。这类工具中最受欢迎的是**网络映射工具**（**Nmap**）。要有效使用Nmap，必须以root权限运行。这是操作数据包的应用程序的常规要求，因此我们将在所有Nmap查询中使用`sudo`。
- en: 'When attempting to minimize detection, some stealth techniques include the
    following:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在尝试减少被检测时，一些隐匿技术包括以下几种：
- en: Attackers approach the target with a goal in mind and send the minimum number
    of packets needed to determine the objective. For example, if you wish to confirm
    the presence of a web host, you first need to determine whether port `80` or `443`,
    the default ports for web-based services, are open.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击者带着明确的目标接近目标，并仅发送足够数量的数据包来确定目标。例如，如果你想确认一个Web主机的存在，你首先需要确定`80`或`443`端口（Web服务的默认端口）是否开放。
- en: Avoid scans that may connect with the target system and leak data. Do not ping
    the target or use **synchronize** (**SYN**) and non-conventional packet scans,
    such as **acknowledge** (**ACK**), **finished** (**FIN**), and **reset** (**RST**).
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免可能与目标系统建立连接并泄露数据的扫描。不要ping目标，或者使用**同步**（**SYN**）以及非常规数据包扫描，如**确认**（**ACK**）、**完成**（**FIN**）和**重置**（**RST**）。
- en: Randomize or spoof packet settings, such as the source IP and port address,
    and the MAC address.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机化或伪造数据包设置，例如源IP和端口地址，以及MAC地址。
- en: Adjust the timing to slow the arrival of packets at the target site.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整时间设置，减缓数据包到达目标站点的速度。
- en: Change the packet size by fragmenting packets or appending random data to confuse
    packet inspection devices.
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过分片数据包或附加随机数据改变数据包大小，以混淆数据包检查设备。
- en: 'As an example, if you want to conduct a stealthy scan and minimize detection,
    the following `nmap` command could be used:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 作为示例，如果你想进行隐匿扫描并尽量减少被检测，可以使用以下`nmap`命令：
- en: '[PRE0]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '*Table 3.1* details the previous command in detail:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '*表3.1* 详细说明了前述命令：'
- en: '| **Command** | **Rationale** |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| **命令** | **原理** |'
- en: '| --- | --- |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `--spoof-mac-Cisco` | This spoofs the MAC address to match a Cisco product.
    Replacing Cisco with 0 will create a completely random MAC address. |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| `--spoof-mac-Cisco` | 伪造MAC地址，使其与Cisco产品匹配。如果将Cisco替换为0，则会生成完全随机的MAC地址。 |'
- en: '| `--data-length 24` | This appends 24 random bytes to most packets that are
    sent. |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| `--data-length 24` | 这会将24个随机字节附加到大多数发送的数据包中。 |'
- en: '| `-T paranoid` | This sets the time to the slowest setting: paranoid. |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| `-T paranoid` | 将时间设置为最慢模式：paranoid。 |'
- en: '| `--max-hostgroup` | Limits the hosts that are scanned at any one time. |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| `--max-hostgroup` | 限制同时扫描的主机数量。 |'
- en: '| `--max-parallelism` | Limits the number of outstanding probes that are sent
    out. You can also use the `--scan-delay` option to set a pause between the probes;
    however, this option is not compatible with the `--max_parallelism` option. |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| `--max-parallelism` | 限制发送的未完成探测数。你还可以使用`--scan-delay`选项设置探测之间的暂停；然而，该选项与`--max_parallelism`选项不兼容。
    |'
- en: '| `-Pn` | This does not send a ping to identify active systems (as this can
    leak data). |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| `-Pn` | 不发送ping以识别活动系统（因为这可能泄露数据）。 |'
- en: '| `-n` | No DNS resolution: internal or external DNS servers are not actively
    queried by Nmap for DNS information. Such queries are frequently logged, so the
    query function should be disabled. |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| `-n` | 禁用DNS解析：Nmap不会主动查询内部或外部DNS服务器获取DNS信息。这类查询通常会被记录，因此应该禁用查询功能。 |'
- en: '| `-sS` | This conducts a stealth TCP SYN scan, which does not complete the
    TCP handshake. Other scan types (for example, null scans) can also be used; however,
    most of these will trigger detection devices. |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| `-sS` | 进行隐匿的TCP SYN扫描，这种扫描不会完成TCP三次握手。其他扫描类型（例如，空扫描）也可以使用；然而，大多数此类扫描会触发检测设备。
    |'
- en: '| `-sV` | This enables version detection. |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| `-sV` | 启用版本检测。 |'
- en: '| `-oA` | This outputs the results to all formats (XML, gnmap, and nmap). |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| `-oA` | 该选项将结果输出为所有格式（XML、gnmap和nmap）。 |'
- en: '| `-p T:1-1024` | This specifies the TCP ports to be scanned. |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| `-p T:1-1024` | 指定要扫描的TCP端口。 |'
- en: '| `--random-hosts` | This randomizes the target host order. |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| `--random-hosts` | 随机化目标主机顺序。 |'
- en: 'Table 3.1: Breakdown of the previous Nmap command'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 表3.1：对前述Nmap命令的详细解析
- en: Together, these options will create a very slow scan that hides the true identity
    of the source. However, if the packets are too unusual, complex modification may
    actually attract the attention of the target; therefore, many testers and attackers
    use anonymity networks to minimize detection.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这些选项将共同创建一个非常缓慢的扫描，以隐藏源的真实身份。然而，如果数据包过于异常，复杂的修改实际上可能会引起目标的注意；因此，许多测试者和攻击者使用匿名网络来最小化被检测的风险。
- en: 'Attackers can also utilize the decoy or zombie method by running the following
    commands: `-D` is the switch, and the decoy can be any IP address; `RND:10` is
    any set of 10 random IP addresses that purport to be the source of the attack.
    When we use the `–sI` switch in Nmap, the target should receive the alerts from
    a zombie IP on the target:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者还可以通过运行以下命令利用诱饵或僵尸方法：`-D` 是开关，诱饵可以是任何 IP 地址；`RND:10` 是一组 10 个随机 IP 地址，伪装成攻击源。当我们在
    Nmap 中使用 `–sI` 开关时，目标应该会接收到来自僵尸 IP 的警报：
- en: '[PRE1]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Using proxies with anonymity networks
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用代理与匿名网络
- en: In this section, we will be exploring the two important tools that are utilized
    by attackers to maintain anonymity on the network. We will be focusing on Tor
    and Privoxy in this section.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将探讨攻击者用来在网络上保持匿名的两个重要工具。我们将在本节中重点介绍 Tor 和 Privoxy。
- en: Tor ([www.torproject.org](http://www.torproject.org)) is an open source implementation
    of the third-generation onion routing that provides free access to an anonymous
    proxy network. Onion routing enables online anonymity by encrypting user traffic
    and then transmitting it through a series of onion routers. At each router, a
    layer of encryption is removed to obtain routing information, and the message
    is then transmitted to the next node. It has been likened to the process of gradually
    peeling an onion, hence the name. It protects against traffic analysis attacks
    by guarding the source and destination of a user’s IP traffic.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: Tor ([www.torproject.org](http://www.torproject.org)) 是一种开源的第三代洋葱路由实现，提供免费的匿名代理网络访问。洋葱路由通过加密用户流量并通过一系列洋葱路由器进行传输，从而实现在线匿名性。在每个路由器上，都会去除一层加密以获取路由信息，然后将消息传输到下一个节点。它被比作逐层剥洋葱的过程，因此得名。它通过保护用户
    IP 流量的源和目的地来防范流量分析攻击。
- en: In this example, Tor will be used with Privoxy, a noncaching web proxy that
    sits in the middle of an application that communicates with the internet and uses
    advanced filtering to ensure privacy and the removal of adverts, along with any
    potentially hostile data being sent to the tester.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，Tor 将与 Privoxy 一起使用，Privoxy 是一个不缓存的 Web 代理，位于与互联网通信的应用程序之间，并使用高级过滤确保隐私和去除广告，同时删除任何可能发送给测试者的潜在恶意数据。
- en: 'To install Tor, perform the following steps:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 Tor，请执行以下步骤：
- en: 'Issue the `apt-get update` and `apt-get upgrade` commands, and then use the
    following command:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行 `apt-get update` 和 `apt-get upgrade` 命令，然后使用以下命令：
- en: '[PRE2]'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Once Tor is installed, edit the `proxychains4.conf` file located in the `/etc`
    directory. This file dictates the number and order of proxies that the test system
    will use on the way to the Tor network. Proxy servers may be down, or they may
    be experiencing a heavy load (causing slow or latent connections); if this occurs,
    a defined or strict ProxyChain will fail due to an expected link being missing.
    Therefore, disable the use of `strict_chain` and enable `dynamic_chain`, which
    ensures that the connection will be routed, as shown in *Figure 3.3*:![](../Images/B17765_03_03.png)
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦安装了 Tor，请编辑位于 `/etc` 目录中的 `proxychains4.conf` 文件。该文件规定了测试系统在访问 Tor 网络时将使用的代理的数量和顺序。代理服务器可能宕机，或者可能出现过载（导致连接缓慢或延迟）；如果发生这种情况，严格的
    ProxyChain 将由于缺少预期链接而失败。因此，禁用 `strict_chain` 并启用 `dynamic_chain`，这样可以确保连接按照*图
    3.3*所示进行路由：![](../Images/B17765_03_03.png)
- en: 'Figure 3.3: Enabling the dynamic chain in Proxychains4.conf'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 3.3：在 Proxychains4.conf 中启用动态链
- en: Edit the `[ProxyList]` section to ensure that the `socks5` proxy is present,
    as shown in *Figure 3.4*:![](../Images/B17765_03_04.png)
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑 `[ProxyList]` 部分，确保 `socks5` 代理存在，如*图 3.4*所示：![](../Images/B17765_03_04.png)
- en: 'Figure 3.4: Adding the proxy list to the proxychains4.conf'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 3.4：将代理列表添加到 proxychains4.conf 中
- en: Open proxies can easily be found online (an example would be [https://www.proxynova.com/proxy-server-list/](https://www.proxynova.com/proxy-server-list/))
    and added to the `proxychains.conf` file. Testers can take advantage of this to
    further obfuscate their identity. For example, if there are reports that a certain
    country or block of IP addresses has been responsible for recent online attacks,
    look for open proxies from that location and add them to your list or a separate
    configuration file.
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 开放代理可以轻松地在线找到（例如 [https://www.proxynova.com/proxy-server-list/](https://www.proxynova.com/proxy-server-list/)），并添加到
    `proxychains.conf` 文件中。测试人员可以利用这一点进一步模糊自己的身份。例如，如果有报告指出某个国家或 IP 地址段近期对在线攻击负责，可以从该位置查找开放代理并将其添加到你的列表或单独的配置文件中。
- en: 'To start the Tor service from a terminal window, enter the following command:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要从终端窗口启动 Tor 服务，输入以下命令：
- en: '[PRE3]'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Verify that Tor has started by using the following command:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令验证 Tor 是否已启动：
- en: '[PRE4]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: It is important to verify that the Tor network is working and providing anonymous
    connectivity.
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 验证 Tor 网络是否正常工作并提供匿名连接非常重要。
- en: 'Verify your source IP address first. From a terminal, enter the following command:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先验证你的源 IP 地址。从终端输入以下命令：
- en: '[PRE5]'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This will start the Iceweasel browser and open it to a site that provides the
    source IP address connected with that web page.
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将启动 Iceweasel 浏览器并打开一个网站，提供与该网页连接的源 IP 地址。
- en: 'Note the IP address, and then invoke Tor routing using the following ProxyChains
    command:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意 IP 地址，然后使用以下 ProxyChains 命令调用 Tor 路由：
- en: '[PRE6]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'In this particular instance, the IP address was identified as `xx.xx.xx.xx`.
    A `whois` lookup of that IP address from a terminal window indicates that the
    transmission is now exiting from a Tor exit node, as shown in *Figure 3.5*:'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这个特定实例中，IP 地址被识别为 `xx.xx.xx.xx`。从终端窗口对该 IP 地址进行 `whois` 查询，表明传输现在是从一个 Tor 出口节点退出，如
    *图 3.5* 所示：
- en: '![](../Images/B17765_03_05.png)'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_05.png)'
- en: 'Figure 3.5: whois details of your randomly assigned IP address'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 3.5：你的随机分配的 IP 地址的 whois 详细信息
- en: You can also verify that Tor is functioning properly by accessing
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以通过访问来验证 Tor 是否正常工作
- en: '[https://check.torproject.org](https://check.torproject.org).'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://check.torproject.org](https://check.torproject.org)。'
- en: Although communications are now protected using the Tor network, it is possible
    for a DNS leak to occur, which occurs when your system makes a DNS request to
    provide your identity to an ISP. You can check for DNS leaks at [www.dnsleaktest.com](http://www.dnsleaktest.com).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管通信现在通过 Tor 网络得到保护，但仍然可能发生 DNS 泄漏，这种情况发生在系统进行 DNS 请求时，可能会泄露你的身份给 ISP。你可以在 [www.dnsleaktest.com](http://www.dnsleaktest.com)
    上检查 DNS 泄漏。
- en: 'Most command lines can be run from the console using `proxychains` to access
    the Tor network. When using Tor, some considerations to be kept in mind are as
    follows:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数命令行可以通过 `proxychains` 从控制台运行，以访问 Tor 网络。在使用 Tor 时，需要注意以下几点：
- en: Tor provides an anonymizing service, but it does not guarantee privacy. Owners
    of the exit nodes are able to sniff traffic and may be able to access user credentials.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tor 提供匿名服务，但不保证隐私。出口节点的拥有者能够嗅探流量，并可能能够访问用户凭证。
- en: Vulnerabilities in the Tor browser bundle have reportedly been used by law enforcement
    to exploit systems and acquire user information.
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 据报道，Tor 浏览器包中的漏洞已被执法机关用来攻击系统并获取用户信息。
- en: ProxyChains do not handle **User Datagram Protocol** (**UDP**) traffic.
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ProxyChains 不处理**用户数据报协议**（**UDP**）流量。
- en: Some applications and services cannot run over this environment—in particular,
    Metasploit and Nmap may break. The stealth SYN scan of Nmap breaks out of ProxyChains
    and the connect scan is invoked instead; this can leak information to the target.
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 某些应用程序和服务无法在这种环境中运行——尤其是 Metasploit 和 Nmap 可能会出现问题。Nmap 的隐蔽 SYN 扫描会突破 ProxyChains，改为使用连接扫描，这可能会泄露信息给目标。
- en: Some browser applications (Flash/ActiveX or HTML5) can be used to obtain your
    IP address.
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些浏览器应用程序（如 Flash/ActiveX 或 HTML5）可以用来获取你的 IP 地址。
- en: Attackers can also use random chaining. With this option, ProxyChains will randomly
    choose IP addresses from our list (local Ethernet IP, for example, `127.0.0.1`,
    `192.168.x.x` or `172.16.x.x`) and use them to create our ProxyChain. This means
    that each time we use ProxyChains, the chain of proxies will look different to
    the target, making it harder to track our traffic from its source.
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击者还可以使用随机链接。使用此选项时，ProxyChains 会从我们的列表中随机选择 IP 地址（例如本地以太网 IP，`127.0.0.1`，`192.168.x.x`
    或 `172.16.x.x`）并用它们来创建我们的 ProxyChain。这意味着每次使用 ProxyChains 时，代理链对目标看起来都不同，从而使追踪我们流量的来源变得更加困难。
- en: To do so, in a similar fashion, edit the `/etc/proxychains4.conf` file and comment
    out `dynamic chains` and uncomment `random_chain`, since we can only use one of
    these options at a time.
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为此，以类似的方式编辑 `/etc/proxychains4.conf` 文件，注释掉 `dynamic chains` 并取消注释 `random_chain`，因为我们一次只能使用其中一个选项。
- en: In addition, attackers can uncomment the line with `chain_len`, which will then
    determine the number of IP address in the chain while creating a random proxy
    chain.
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此外，攻击者可以取消注释 `chain_len` 所在的行，这样在创建随机代理链时，链中的 IP 地址数量将由其决定。
- en: This technique can be engaged by attackers to establish a qualified anonymity
    and then remain anonymous over the network.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可以使用此技术来建立合格的匿名性，并在网络上保持匿名。
- en: DNS reconnaissance and route mapping
  id: totrans-106
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DNS 侦察与路由映射
- en: Once a tester has identified the targets that have an online presence and contain
    items of interest, the next step is to identify the IP addresses and routes to
    the target. DNS reconnaissance is concerned with identifying who owns a particular
    domain or series of IP addresses (the sort of information gained with `whois`,
    although this has been completely changed with the **General Data Protection Regulation**
    (**GDPR**) enforcement across Europe from May 2018). The DNS information defines
    the actual domain names and IP addresses assigned to the target, and the route
    between the penetration tester—or the attacker—and the final target.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦测试者识别出具有在线存在并包含感兴趣项目的目标，下一步是识别目标的 IP 地址和路由。DNS 侦察关注的是识别谁拥有某个特定域名或一系列 IP 地址（这类信息可以通过
    `whois` 获得，尽管自 2018 年 5 月起，**通用数据保护条例**（**GDPR**）在欧洲生效后，这一过程已发生完全变化）。DNS 信息定义了分配给目标的实际域名和
    IP 地址，以及渗透测试者或攻击者与最终目标之间的路由。
- en: This information gathering is semi-active, as some of the information is available
    from freely available open sources such as [dnsdumpster.com](http://dnsdumpster.com),
    while other information is available from third parties such as DNS registrars.
    Although the registrar may collect IP addresses and data concerning requests made
    by the attacker, it is rarely provided to the end target. The information that
    could be directly monitored by the target, such as DNS server logs, is seldom
    reviewed or retained.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 这一信息收集是半主动的，因为有些信息来自如 [dnsdumpster.com](http://dnsdumpster.com) 等公开的免费开放源，而其他信息则来自第三方，如
    DNS 注册商。尽管注册商可能会收集与攻击者请求相关的 IP 地址和数据，但通常不会提供给最终目标。目标可以直接监控的信息，如 DNS 服务器日志，通常不会被审查或保留。
- en: Because the information needed can be queried using a defined systematic and
    methodical approach, its collection can be automated.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 由于所需的信息可以通过定义的系统化和有条理的方法查询，因此其收集可以实现自动化。
- en: Note that DNS information may contain stale or incorrect entries. To minimize
    inaccurate information, query different source servers and use different tools
    to cross-validate results. Review results and manually verify any suspect findings.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，DNS 信息可能包含过时或不准确的条目。为减少不准确信息的出现，可以查询不同的源服务器并使用不同的工具进行交叉验证。审查结果并手动验证任何可疑的发现。
- en: The whois command (post GDPR)
  id: totrans-111
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: whois 命令（GDPR 后）
- en: 'The `whois` command used to be the first step in identifying an IP address
    for many years until GDPR came into force. Formerly, the `whois` command was used
    to query databases that store information on the registered users of an internet
    resource, such as a domain name or IP address. Depending on the database that
    is queried, the response to a `whois` request will provide names, physical addresses,
    phone numbers, and email addresses (useful in facilitating social engineering
    attacks), as well as IP addresses and DNS server names. After May 25, 2018, there
    are no registrant details provided; however, attackers can understand which `whois`
    server responds, and it retrieves domain data that includes availability, ownership,
    creation, expiration details, and name servers. *Figure 3.6* shows the `whois`
    command run against the domain of `facebook.com`:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '`whois` 命令曾是识别 IP 地址的第一步，持续了多年，直到 GDPR 生效为止。以前，`whois` 命令用于查询存储互联网资源注册用户信息的数据库，如域名或
    IP 地址。根据查询的数据库，`whois` 请求的响应将提供名称、物理地址、电话号码和电子邮件地址（有助于社交工程攻击），以及 IP 地址和 DNS 服务器名称。2018年5月25日后，不再提供注册人详细信息；然而，攻击者仍可以了解哪个
    `whois` 服务器响应，并且它会检索包括可用性、所有权、创建、到期详细信息和名称服务器在内的域名数据。*图 3.6* 显示了对 `facebook.com`
    域运行 `whois` 命令的情况：'
- en: '![](../Images/B17765_03_06.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_06.png)'
- en: 'Figure 3.6: whois details on the facebook.com domain that includes Name Server
    details'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.6：包含名称服务器详细信息的 facebook.com 域的 whois 信息
- en: Employing comprehensive reconnaissance applications
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用全面的侦察应用程序
- en: Although Kali contains multiple tools to facilitate reconnaissance, many of
    the tools contain features that overlap, and importing data from one tool into
    another is usually a complex manual process. Most testers select a subset of tools
    and invoke them with a script.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 Kali 包含多种工具来辅助侦察，但许多工具的功能重叠，并且将一个工具中的数据导入到另一个工具通常是一个复杂的手动过程。大多数测试人员选择一组子集工具，并通过脚本调用它们。
- en: Comprehensive tools focused on reconnaissance were originally command-line tools
    with a defined set of functions; one of the most commonly used was the **Deep
    Magic Information Gathering Tool** (**DMitry**). DMitry could perform `whois`
    lookups, retrieve [netcraft.com](http://netcraft.com) information, search for
    sub-domains and email addresses, and perform TCP scans. Unfortunately, it wasn’t
    extensible beyond these functions.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 专注于侦察的综合工具最初是命令行工具，具有一组定义的功能；其中最常用的是 **深度魔法信息收集工具**（**DMitry**）。DMitry 可以执行
    `whois` 查找，检索 [netcraft.com](http://netcraft.com) 信息，搜索子域和电子邮件地址，并执行 TCP 扫描。不幸的是，它在这些功能之外不可扩展。
- en: '*Figure 3.7* provides details on running DMitry on [www.cyberhia.com](http://www.cyberhia.com).
    The following command can be used to enumerate the reverse DNS to IP lookup, Whois,
    subdomain, email address, and open port details:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3.7* 提供了运行 DMitry 对 [www.cyberhia.com](http://www.cyberhia.com) 的详细信息。可以使用以下命令来枚举反向
    DNS 到 IP 查找、Whois、子域、电子邮件地址和开放端口详细信息：'
- en: '[PRE7]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](../Images/B17765_03_07.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_07.png)'
- en: 'Figure 3.7: Running DMitry to extract domain and whois information'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.7：运行 DMitry 提取域和 whois 信息
- en: Note that some information produced here might belong to a hosting company that
    provides DNS protection. An example is if our target is hosting the name servers
    from Cloudflare or AWS **Content Delivery Network** (**CDN**).
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，此处生成的一些信息可能属于提供 DNS 保护的托管公司。例如，如果我们的目标托管来自 Cloudflare 或 AWS **内容分发网络**（**CDN**）的名称服务器。
- en: Recent advances have created comprehensive framework applications that combine
    passive and active reconnaissance. In the following section, we will be looking
    more at recon-ng.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 最近的进展促成了综合框架应用程序的出现，这些应用程序结合了被动和主动侦察。在接下来的部分，我们将更多地了解 recon-ng。
- en: The recon-ng framework
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: recon-ng 框架
- en: The recon-ng framework is an open-source framework for conducting reconnaissance
    (passive and active) that has recently added a complete new marketplace for plugins.
    The framework is similar to Metasploit and the **Social Engineer Toolkit** (**SET**);
    recon-ng uses a very modular framework. Each module is a customized command interpreter,
    preconfigured to perform a specific task.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: recon-ng 框架是一个开源框架，用于进行侦察（被动和主动），最近新增了一个完整的插件市场。该框架类似于 Metasploit 和 **Social
    Engineer Toolkit**（**SET**）；recon-ng 使用一个非常模块化的框架。每个模块都是一个定制的命令解释器，预配置用于执行特定任务。
- en: The recon-ng framework and its modules are written in Python, allowing penetration
    testers to easily build or alter modules to facilitate testing. The recon-ng tool
    also leverages third-party APIs to conduct some assessments; this additional flexibility
    means that some activities undertaken by recon-ng may be tracked by those parties.
    Users can specify a custom `useragent` string or proxy requests to minimize alerting
    the target network.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: recon-ng框架及其模块是用Python编写的，使得渗透测试人员可以轻松构建或修改模块以促进测试。recon-ng工具还利用第三方API进行某些评估；这种额外的灵活性意味着recon-ng执行的一些活动可能会被这些第三方追踪。用户可以指定自定义`useragent`字符串或代理请求，以最小化对目标网络的警觉。
- en: recon-ng is installed by default in newer versions of Kali. All data collected
    by recon-ng is placed in a database, allowing you to create various reports against
    the stored data. The user can select one of the report modules to automatically
    create either a CVS report or an HTML report.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在Kali的较新版本中，recon-ng默认已安装。recon-ng收集的所有数据都将存储在数据库中，允许你根据存储的数据创建各种报告。用户可以选择其中一个报告模块，自动生成CSV报告或HTML报告。
- en: 'To start the application, enter `recon-ng` at the prompt; to view the available
    modules, type `marketplace search` at the `recon-ng>` prompt, as shown in *Figure
    3.8*:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动应用程序，请在提示符下输入`recon-ng`；要查看可用模块，请在`recon-ng>`提示符下输入`marketplace search`，如*图3.8*所示：
- en: '![](../Images/B17765_03_08.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_08.png)'
- en: 'Figure 3.8: Marketplace search in recon-ng for all available modules'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.8：在recon-ng中进行市场搜索以查找所有可用模块
- en: To install any module, we will simply run `marketplace install modulename`,
    and to load a specific module, type `modules load` followed by the name of the
    module. Pressing the *Tab* key while typing will autocomplete the command. If
    the module has a unique name, you can type in the unique part of the name, and
    the module will be loaded without entering the full path.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装任何模块，我们只需运行`marketplace install modulename`，要加载特定模块，输入`modules load`后跟模块名。在输入时按*Tab*键会自动完成命令。如果模块有唯一的名称，你可以只输入名称的唯一部分，模块将被加载，而无需输入完整路径。
- en: 'Entering `info` will provide you with information on how the module works and
    where to obtain API keys if required. Once the module is loaded, use the `options
    set` command to set the options, and then enter `run` to execute, as shown in
    *Figure 3.9*:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 输入`info`将为你提供有关模块如何工作以及如何获取API密钥的信息（如果需要）。模块加载后，使用`options set`命令设置选项，然后输入`run`执行，如*图3.9*所示：
- en: '![](../Images/B17765_03_09.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_09.png)'
- en: 'Figure 3.9: Loading the hackertarget module and setting the source as www.packtpub.com'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.9：加载hackertarget模块并将源设置为www.packtpub.com
- en: 'In general, testers rely on recon-ng to do the following:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 一般而言，测试人员依赖recon-ng进行以下操作：
- en: Harvest hosts and contacts using multiple sources, such as haveibeenpwned, mangle,
    mailtester, censys, and shodan.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用多个来源（如 haveibeenpwned、mangle、mailtester、censys 和 shodan）收集主机和联系人信息。
- en: Identify geographical locations of hosts and individuals using Flickr, Shodan,
    geocode, YouTube, and Twitter.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Flickr、Shodan、geocode、YouTube和Twitter识别主机和个人的地理位置。
- en: Identify host information using `netcraft` and related modules.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`netcraft`和相关模块识别主机信息。
- en: Identify account and password information that has previously been compromised
    and leaked onto the internet (the `pwnedlist` modules within the domains-credentials
    – `domain_ispwned`, `account_creds, domain_creds,` `leak_lookup`, and `leaks_dump`).
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别以前已被泄露并暴露在互联网上的账户和密码信息（`pwnedlist`模块位于domains-credentials中——`domain_ispwned`、`account_creds`、`domain_creds`、`leak_lookup`
    和 `leaks_dump`）。
- en: IPv4
  id: totrans-140
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: IPv4
- en: 'The **Internet Protocol** (**IP**) address is a unique number used to identify
    devices that are connected to a private network or the public internet. Today,
    the internet is largely based on version 4, known as IPv4\. Kali includes several
    tools to facilitate DNS reconnaissance, as given in *Table 3.2*:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '**互联网协议**（**IP**）地址是用于标识连接到私人网络或公共互联网的设备的唯一编号。如今，互联网主要基于版本4，即IPv4。Kali包含若干工具以促进DNS侦察，如*表3.2*所示：'
- en: '| **Application** | **Description** |'
  id: totrans-142
  prefs: []
  type: TYPE_TB
  zh: '| **应用程序** | **描述** |'
- en: '| `dnsenum`, `dnsmap`, and `dnsrecon` | These are comprehensive DNS scanners—DNS
    record enumeration (A, MX, TXT, SOA, wildcard, and so on), subdomain brute-force
    attacks, Google lookup, reverse lookup, zone transfer, and zone walking. dsnrecon
    is usually the first choice—it is highly reliable, results are well parsed, and
    data can be directly imported into the Metasploit framework. |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '| `dnsenum`、`dnsmap` 和 `dnsrecon` | 这些是全面的 DNS 扫描工具——DNS 记录枚举（A、MX、TXT、SOA、通配符等）、子域名暴力攻击、Google
    查找、反向查找、区域传输和区域遍历。`dnsrecon` 通常是首选——它非常可靠，结果解析良好，数据可以直接导入到 Metasploit 框架中。 |'
- en: '| `dnswalk` | This DNS debugger checks specified domains for internal consistency
    and accuracy (this is not installed by default in the newer versions of Kali;
    hence, you have to run apt-get install dnswalk). |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '| `dnswalk` | 该 DNS 调试器检查指定域的内部一致性和准确性（在 Kali 的新版本中未默认安装，因此需要运行 `apt-get install
    dnswalk`）。 |'
- en: '| `fierce` | This locates non-contiguous IP space and hostnames against specified
    domains by attempting zone transfers and then attempting brute-force attacks to
    gain DNS information. |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| `fierce` | 该工具通过尝试区域传输并进行暴力破解攻击，定位与指定域名不相邻的 IP 空间和主机名，从而获得 DNS 信息。 |'
- en: 'Table 3.2: Tools in Kali to facilitate DNS reconnaissance'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 表 3.2：Kali 中用于帮助 DNS 勘探的工具
- en: During testing, most investigators run `fierce` to confirm that all possible
    targets have been identified, and then run at least two comprehensive tools (for
    example, `dnsenum` and `dnsrecon`) to generate the maximum amount of data and
    provide a degree of cross-validation.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在测试过程中，大多数调查人员首先运行 `fierce` 以确认已识别出所有可能的目标，然后运行至少两种全面的工具（例如 `dnsenum` 和 `dnsrecon`）以生成最大量的数据，并提供一定程度的交叉验证。
- en: 'In *Figure 3.10*, `dnsrecon` has been used to generate a standard DNS record
    search, and a search that is specific for SRV records. An excerpt of the results
    is shown for each case:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *图 3.10* 中，`dnsrecon` 被用于生成标准 DNS 记录搜索，以及特定于 SRV 记录的搜索。每种情况下的结果摘录如下：
- en: '![](../Images/B17765_03_10.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_10.png)'
- en: 'Figure 3.10: Running the dnsrecon tool on www.packtpub.com'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.10：在 www.packtpub.com 上运行 dnsrecon 工具
- en: '`dnsrecon` allows the penetration tester to obtain the SOA record, **Name Servers**
    (**NS**), **mail exchanger** (**MX**) hosts, servers sending emails using **Sender
    Policy Framework** (**SPF**), and the IP address ranges in use.'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '`dnsrecon` 允许渗透测试人员获取 SOA 记录、**名称服务器**（**NS**）、**邮件交换器**（**MX**）主机、使用 **发送者策略框架**（**SPF**）发送电子邮件的服务器，以及使用中的
    IP 地址范围。'
- en: IPv6
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: IPv6
- en: Although IPv4 seems to permit a large address space, freely available IP addresses
    were exhausted several years ago, forcing the employment of NAT to increase the
    number of available addresses. A more permanent solution has been found in the
    adoption of an improved IP addressing scheme, IPv6\. Although it constitutes less
    than five percent of internet addresses, its usage is increasing, and penetration
    testers must be prepared to address the differences between IPv4 and IPv6.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管 IPv4 看似提供了大规模的地址空间，但几年前，免费的 IP 地址已被用尽，迫使人们使用 NAT 技术来增加可用地址的数量。一个更为永久的解决方案是在采用改进的
    IP 地址方案 IPv6 后得以实现。尽管它只占互联网地址的不到 5%，但其使用率在不断增加，渗透测试人员必须做好应对 IPv4 和 IPv6 之间差异的准备。
- en: In IPv6, the source and destination addresses are 128-bits in length, yielding
    2,128 possible addresses—that is 340 undecillion addresses!
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在 IPv6 中，源地址和目标地址的长度为 128 位，共有 2^128 个可能的地址——即 340 无穷大个地址！
- en: The increased size of the addressable address space presents some problems to
    penetration testers, particularly when using scanners that step through the available
    address space looking for live servers. However, some features of the IPv6 protocol
    have simplified discovery, especially the use of ICMPv6 to identify active link-local
    addresses.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 地址空间增大的问题给渗透测试人员带来了一些困扰，尤其是在使用扫描器逐步扫描可用地址空间寻找存活的服务器时。然而，IPv6 协议的一些特性简化了发现过程，特别是使用
    ICMPv6 来识别活动的链路本地地址。
- en: 'It is important to consider IPv6 when conducting initial scans for the following
    reasons:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行初步扫描时，考虑到以下原因，IPv6 是非常重要的：
- en: There is uneven support for IPv6 functionality in testing tools, so the tester
    must ensure that each tool is validated to determine its performance and accuracy
    in IPv4, IPv6, and mixed networks.
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试工具对 IPv6 功能的支持不均，因此测试人员必须确保验证每个工具，以确定其在 IPv4、IPv6 和混合网络中的性能和准确性。
- en: Because IPv6 is a relatively new protocol, the target network may contain misconfigurations
    that leak important data; the tester must be prepared to recognize and use this
    information.
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于 IPv6 是一种相对较新的协议，目标网络可能包含泄露重要数据的配置错误；测试人员必须准备好识别并利用这些信息。
- en: Older network controls (firewalls, IDS, and IPS) may not detect IPv6\. In such
    cases, penetration testers can use IPv6 tunnels to maintain covert communications
    with the network and exfiltrate the undetected data.
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 旧的网络控制设备（如防火墙、IDS 和 IPS）可能无法检测到 IPv6。在这种情况下，渗透测试人员可以使用 IPv6 隧道来与网络保持隐蔽通信，并将未被检测到的数据外泄。
- en: Using IPv6-specific tools
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用专门的 IPv6 工具
- en: 'Kali includes several tools developed to take advantage of IPv6 (most comprehensive
    scanners, such as Nmap, now support IPv6), some of which are detailed here. Tools
    that are particular to IPv6 were largely derived from the **THC-IPv6 Attack Toolkit**.
    This tool can be installed by running the following:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: Kali 包含了若干开发的工具，旨在利用 IPv6（大多数全面的扫描器，如 Nmap，现在都支持 IPv6），其中一些工具在此进行了详细介绍。特定于 IPv6
    的工具主要来源于 **THC-IPv6 攻击工具包**。可以通过运行以下命令来安装该工具：
- en: '[PRE8]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '*Table 3.3* provides a list of tools that are utilized for the reconnaissance
    of IPv6:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '*表 3.3* 提供了用于 IPv6 侦察的工具列表：'
- en: '| **Application** | **Description** |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| **应用** | **描述** |'
- en: '| `atk6-dnsdict6` | Enumerates sub-domains to obtain IPv4 and IPv6 addresses
    (if present) using a brute-force search based on a supplied dictionary file or
    its own internal list |'
  id: totrans-165
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-dnsdict6` | 使用基于字典文件或自身内部列表的暴力搜索枚举子域名，以获取 IPv4 和 IPv6 地址（如果存在） |'
- en: '| `atk6-dnsrevenum6` | Performs reverse DNS enumeration given an IPv6 address
    |'
  id: totrans-166
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-dnsrevenum6` | 根据 IPv6 地址执行反向 DNS 枚举 |'
- en: '| `atk6-covert_send6` | Sends the content of a file covertly to the target
    |'
  id: totrans-167
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-covert_send6` | 将文件内容隐蔽地发送到目标 |'
- en: '| `atk6-covert_send6d` | Writes covertly received content to a file |'
  id: totrans-168
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-covert_send6d` | 将隐蔽接收到的内容写入文件 |'
- en: '| `atk6-denial6` | Performs various denial-of-service attacks on a target |'
  id: totrans-169
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-denial6` | 对目标执行各种拒绝服务攻击 |'
- en: '| `atk6-detect-new-ip6` | Detects new IPv6 addresses joining the local network
    |'
  id: totrans-170
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-detect-new-ip6` | 检测加入本地网络的新 IPv6 地址 |'
- en: '| `atk6-detect_sniffer6` | Tests whether systems on the local LAN are sniffing
    |'
  id: totrans-171
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-detect_sniffer6` | 测试本地局域网内的系统是否正在嗅探 |'
- en: '| `atk6-exploit6` | Performs exploits of various CVE-known IPv6 vulnerabilities
    on the destination |'
  id: totrans-172
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-exploit6` | 对目标执行已知的 IPv6 漏洞（CVE）的利用 |'
- en: '| `atk6-fake_dhcps6` | Fake DHCPv6 server |'
  id: totrans-173
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-fake_dhcps6` | 假冒 DHCPv6 服务器 |'
- en: 'Table 3.3: Tools used in Kali to assess IPv6'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 表 3.3：Kali 中用于评估 IPv6 的工具
- en: 'Metasploit can also be utilized for IPv6 host discovery. The `auxiliary/scanner/discovery/ipv6_multicast_ping`
    module will discover all of the IPv6-enabled machines with the physical (MAC)
    address, as shown in *Figure 3.11*:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit 也可以用于 IPv6 主机发现。`auxiliary/scanner/discovery/ipv6_multicast_ping`
    模块将发现所有启用 IPv6 的机器及其物理（MAC）地址，如 *图 3.11* 所示：
- en: '![](../Images/B17765_03_11.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_11.png)'
- en: 'Figure 3.11: Discovery of IPv6 devices on the network using the Metasploit
    ipv6 scanner'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.11：使用 Metasploit ipv6 扫描器发现网络中的 IPv6 设备
- en: 'The `sudo atk6-alive6` IPv6 suite will discover live addresses in the same
    segment, as shown in *Figure 3.12*:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`sudo atk6-alive6` IPv6 套件将发现同一段网络中的活动地址，如 *图 3.12* 所示：'
- en: '![](../Images/B17765_03_12.png)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_12.png)'
- en: 'Figure 3.12: Discovery of IPv6 live devices on the network using atk6-alive6'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.12：使用 atk6-alive6 发现网络中的 IPv6 活跃设备
- en: Mapping the route to the target
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 映射到目标的路径
- en: Route mapping was originally used as a diagnostic tool that allows you to view
    the route that an IP packet follows, from one host to the next.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 路径映射最初作为诊断工具，允许您查看一个 IP 数据包从一个主机到另一个主机的路径。
- en: Using the **Time To Live** (**TTL**) field in an IP packet, each hop from one
    point to the next elicits an `ICMPTIME_EXCEEDED` message from the receiving router,
    decrementing the value in the `TTL` field by `1`.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用 IP 数据包中的 **生存时间**（**TTL**）字段，每经过一个节点，接收路由器会返回一个 `ICMPTIME_EXCEEDED` 消息，并将
    `TTL` 字段中的值减少 `1`。
- en: 'The packets count the number of hops and the route taken. From an attacker’s
    or penetration tester’s perspective, the `traceroute` data yields the following
    important data:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 数据包计算跳数和路径。对于攻击者或渗透测试人员来说，`traceroute` 数据提供了以下重要信息：
- en: The exact path between the attacker and the target
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击者和目标之间的确切路径
- en: Hints pertaining to the network’s external topology
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与网络外部拓扑相关的提示
- en: Identification of accessing control devices (firewalls and packet-filtering
    routers) that may be filtering attack traffic
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确认访问控制设备（防火墙和数据包过滤路由器）是否在过滤攻击流量
- en: If the network is misconfigured, it may be possible to identify internal addressing
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果网络配置错误，可能会识别出内部地址
- en: Using a web-based traceroute ([www.traceroute.org](http://www.traceroute.org)),
    it is possible to trace various geographic origin sites to the target network.
    These types of scans will frequently identify more than one different network
    connecting to the target, which is information that could be missed by conducting
    only a single traceroute command from a location close to the target. Web-based
    traceroute may also identify multi-homed hosts that connect two or more networks.
    These hosts are an important target for attackers because they drastically increase
    the attack surface leading to the target.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 使用基于网页的 traceroute（[www.traceroute.org](http://www.traceroute.org)），可以追踪到各种不同地理位置的源站点到目标网络。这种类型的扫描通常会发现多个不同的网络连接到目标，这些信息在仅从接近目标的地点执行单个
    traceroute 命令时可能会被遗漏。基于网页的 traceroute 还可能识别出连接两个或多个网络的多宿主主机。这些主机是攻击者的重要目标，因为它们大大增加了通向目标的攻击面。
- en: In Kali, `traceroute` is a command-line program that uses ICMP packets to map
    the route; in Windows, the program is `tracert`.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Kali 中，`traceroute` 是一个使用 ICMP 数据包来绘制路由的命令行程序；在 Windows 中，该程序是 `tracert`。
- en: 'If you launch `traceroute` from Kali, you will likely see most hops filtered
    (the data is shown as: `* * *`). For example, `traceroute` from the author’s present
    location to [www.packtpub.com](http://www.packtpub.com) would yield the output
    shown in *Figure 3.13*:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 如果从 Kali 启动 `traceroute`，你很可能会看到大多数跳数被过滤（数据以 `* * *` 显示）。例如，从作者当前所在的位置进行 `traceroute`
    到 [www.packtpub.com](http://www.packtpub.com) 时，输出将显示为 *图 3.13* 所示：
- en: '![](../Images/B17765_03_13.png)'
  id: totrans-192
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_13.png)'
- en: 'Figure 3.13: Traceroute on www.packtpub.com'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.13：对 www.packtpub.com 进行的 traceroute 路由跟踪
- en: 'If the same request was run using `tracert` from the Windows command line,
    however, we would see the output shown in *Figure 3.14*:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用 Windows 命令行中的 `tracert` 运行相同的请求，我们将看到如 *图 3.14* 所示的输出：
- en: '![](../Images/B17765_03_14.png)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_14.png)'
- en: 'Figure 3.14: Traceroute to www.packtpub.com using Windows tracert utility'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.14：使用 Windows tracert 工具对 www.packtpub.com 进行 traceroute 路由跟踪
- en: Not only do we get the complete path, but we can also see that [www.google.com](http://www.google.com)
    is resolving to a slightly different IP address, indicating that load balancers
    are in effect (you can confirm this by using Kali’s `lbd` script; however, this
    activity may be logged by the target site).
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不仅可以获得完整的路径，还可以看到 [www.google.com](http://www.google.com) 解析到一个略微不同的 IP 地址，表明负载均衡器正在生效（你可以通过使用
    Kali 的 `lbd` 脚本来确认这一点；不过，这一活动可能会被目标网站记录）。
- en: 'The reason for the different path data is that, by default, `traceroute` uses
    UDP datagrams, while Windows `tracert` utility uses ICMP echo request (ICMP type
    8). Therefore, when completing `traceroute` using Kali tools, it is important
    to use multiple protocols in order to obtain the most complete path, and to bypass
    packet-filtering devices. Kali provides a set of tools for completing route traces,
    as detailed in *Table 3.4*:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 路径数据的不同原因在于，`traceroute` 默认使用 UDP 数据报，而 Windows 的 `tracert` 工具则使用 ICMP 回显请求（ICMP
    类型 8）。因此，在使用 Kali 工具完成 `traceroute` 时，重要的是使用多种协议来获取最完整的路径，并绕过数据包过滤设备。Kali 提供了一组完成路由跟踪的工具，详见
    *表 3.4*：
- en: '| **Application** | **Description** |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
  zh: '| **应用程序** | **描述** |'
- en: '| `hping3` | This is a TCP/IP packet assembler and analyzer. This supports
    TCP, UDP, ICMP, and raw-IP and uses a ping-like interface. |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| `hping3` | 这是一个 TCP/IP 数据包组装和分析工具。它支持 TCP、UDP、ICMP 和原始 IP，并采用类似于 ping 的界面。
    |'
- en: '| `intrace` | Newer versions of Kali do not have this tool pre-installed, so
    testers will have to run apt install intrace in the terminal to obtain it. This
    tool enables users to enumerate IP hops by exploiting existing TCP connections,
    both initiated from the local system or network, or from local hosts. This makes
    it very useful for bypassing external filters such as firewalls. intrace is a
    replacement for the less reliable 0trace program. |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
  zh: '| `intrace` | Kali 的较新版本没有预装此工具，因此测试者需要在终端运行 `apt install intrace` 来获取它。这个工具通过利用现有的
    TCP 连接（无论是从本地系统或网络发起的，还是来自本地主机）来枚举 IP 路由跳数。它对于绕过外部过滤器（如防火墙）非常有用。intrace 是一个替代不太可靠的
    0trace 程序的工具。 |'
- en: '| `atk6-trace6` | This is a traceroute program that uses ICMP6. |'
  id: totrans-202
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-trace6` | 这是一个使用 ICMP6 协议的 traceroute 程序。 |'
- en: 'Table 3.4: Kali tools that can be used for the completion of trace routes'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 表3.4：可用于完成trace routes的Kali工具
- en: '`hping3` is one of the most useful tools because of the control it gives over
    the packet type, source packet, and destination packet. For example, Google does
    not allow ping requests. However, it is possible to ping the server if you send
    the packet as a TCP SYN request.'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '`hping3`是最有用的工具之一，因为它可以控制数据包类型、源数据包和目标数据包。例如，Google不允许ping请求。然而，如果将数据包作为TCP
    SYN请求发送，仍然可以ping服务器。'
- en: 'In the following example, the tester attempts to ping the target domain from
    the command line. No data is returned; the target domain is clearly blocking ICMP-based
    `ping` commands. However, the next command invokes `hping3`, instructing it to
    do the following:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下示例中，测试者尝试从命令行ping目标域。没有返回数据；目标域显然正在阻止基于ICMP的`ping`命令。然而，下一条命令调用`hping3`，并指示它执行以下操作：
- en: Send a ping-like command to the target domain using TCP with the SYN flag set
    (`-S`)
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用设置了SYN标志的TCP发送类似ping的命令到目标域（`-S`）
- en: Direct the packet to port 80; legitimate requests of this type are rarely blocked
    (`- p 80`)
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将数据包定向到80端口；此类合法请求很少被阻止（`- p 80`）
- en: Set a count of sending three packets to the target (`-c 3`)
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置发送三个数据包到目标的计数（`-c 3`）
- en: 'To execute the previous steps, use the commands shown in *Figure 3.15*:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 执行前述步骤时，使用*图3.15*所示的命令：
- en: '![](../Images/B17765_03_15.png)'
  id: totrans-210
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_15.png)'
- en: 'Figure 3.15: Running hping3 on the target via port 80'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.15：通过80端口运行hping3测试目标
- en: The `hping3` command successfully identifies that the target is online and provides
    some basic routing information.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '`hping3`命令成功识别目标在线，并提供一些基本的路由信息。'
- en: Identifying the external network infrastructure
  id: totrans-213
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 识别外部网络基础设施
- en: 'Once the tester’s identity is protected, identifying the devices on the internet-accessible
    portion of the network is the next critical step in scanning a network. Attackers
    and penetration testers use this information to do the following:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦测试者的身份得到保护，下一步关键的是识别网络中可访问互联网部分的设备。攻击者和渗透测试人员使用这些信息执行以下操作：
- en: Identify devices that may confuse (load balancers) or eliminate (firewalls and
    packet inspection devices) test results
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别可能干扰（负载均衡器）或消除（防火墙和数据包检查设备）测试结果的设备
- en: Identify devices with known vulnerabilities
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别具有已知漏洞的设备
- en: Identify the requirement for continuing to implement stealthy scans
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别继续实施隐秘扫描的需求
- en: Gain an understanding of the target’s focus on secure architecture and security
    in general
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解目标在安全架构和一般安全方面的关注点
- en: '`traceroute` provides basic information on packet filtering abilities; some
    other applications on Kali include the following:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: '`traceroute`提供有关数据包过滤能力的基本信息；Kali中的其他一些应用程序包括：'
- en: '**Lbd**: Uses two DNS and HTTP-based techniques to detect load balancers (shown
    in *Figure 3.16*)'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Lbd**：使用两种基于DNS和HTTP的技术来检测负载均衡器（如*图3.16*所示）'
- en: '**Nmap**: Detects devices and determines the operating systems and version'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Nmap**：检测设备并确定操作系统及版本'
- en: '**Shodan**: Web-based search engine that identifies devices connected to the
    internet, including those with default passwords, known misconfigurations, and
    vulnerabilities'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Shodan**：基于Web的搜索引擎，识别连接到互联网的设备，包括那些具有默认密码、已知错误配置和漏洞的设备'
- en: '**censys.io** and **spyze**: Similar to the Shodan search that has already
    scanned the entire internet, with certificate details, technology information,
    misconfiguration, and known vulnerabilities.'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**censys.io**和**spyze**：类似于已经扫描整个互联网的Shodan搜索，提供证书详细信息、技术信息、错误配置和已知漏洞。'
- en: '*Figure 3.16* shows the results obtained on running the `lbd` script against
    a target domain; as you can see, the target uses both `DNS-Loadbalancing` and
    `HTTP-Loadbalancing` on its site. From a penetration tester’s perspective, this
    information could be used to explain why spurious results are obtained, as the
    load balancer shifts a particular tool’s activity from one server to another.
    *Figure 3.16* also displays the HTTP load balancing:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '*图3.16*显示了在对目标域运行`lbd`脚本时获得的结果；如你所见，目标在其网站上使用了`DNS-Loadbalancing`和`HTTP-Loadbalancing`。从渗透测试人员的角度来看，这些信息可以用来解释为什么获得了虚假结果，因为负载均衡器将特定工具的活动从一个服务器转移到另一个服务器。*图3.16*还显示了HTTP负载均衡：'
- en: '![](../Images/B17765_03_16.png)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_16.png)'
- en: 'Figure 3.16: Running lbd to detect the load balancers'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.16：运行lbd检测负载均衡器
- en: Mapping beyond the firewall
  id: totrans-227
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙之外的映射
- en: 'Attackers normally start network debugging using the `traceroute` utility,
    which attempts to map all of the hosts on a route to a specific destination host
    or system. Once the target is reached, the `TTL` field will be `0`, while the
    target will discard the datagram and generate an ICMP time exceeded packet back
    to its originator. A regular `traceroute` will be similar to that shown in *Figure
    3.17*:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者通常使用`traceroute`工具开始网络调试，`traceroute`尝试映射到特定目标主机或系统的路由中的所有主机。一旦目标被到达，`TTL`字段将为`0`，而目标将丢弃数据报并生成ICMP超时包返回给源主机。常规的`traceroute`与*图
    3.17*所示类似：
- en: '![](../Images/B17765_03_17.png)Figure 3.17: Running traceroute to identify
    packet filtering devices'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '![](../Images/B17765_03_17.png)图 3.17：运行traceroute识别数据包过滤设备'
- en: As you see from the preceding example, we cannot go beyond a particular IP,
    which most probably means that there is a packet filtering device at hop `3`.
    Attackers would dig a little bit deeper to understand what is deployed on that
    IP.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 正如从前面的示例中看到的那样，我们无法超越特定的IP，这很可能意味着在跳数`3`处存在一个数据包过滤设备。攻击者会进一步挖掘，以了解该IP上部署了什么。
- en: Deploying the default UDP datagram option will increase the port number every
    time it sends a UDP datagram. Hence, attackers will start pointing to a port number
    to reach the final target destination.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 部署默认的UDP数据报选项时，每次发送UDP数据报时都会增加端口号。因此，攻击者将开始指向一个端口号，以便到达最终目标位置。
- en: IDS/IPS identification
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: IDS/IPS识别
- en: Penetration testers can utilize `nmap` and `WAFW00F` to identify whether there
    are any detection or prevention mechanisms put in place, such as an **Intrusion
    Detection System** (**IDS**), **Intrusion Prevention System** (**IPS**), or a
    **Web Application Firewall** (**WAF**).
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员可以使用`nmap`和`WAFW00F`来识别是否存在检测或防御机制，如**入侵检测系统**（**IDS**）、**入侵防御系统**（**IPS**）或**Web应用程序防火墙**（**WAF**）。
- en: 'Another tool that attackers utilize during active reconnaissance is `WAFW00F`;
    this tool is preinstalled in the latest version of Kali Linux. It is used to identify
    and fingerprint the WAF products. It also provides a list of well-known WAFs.
    The version of the WAF in use can be extracted by adding the `-l` switch to the
    command (for example, `wafw00f -l`). *Figure 3.18* shows the exact WAF running
    behind a web application:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者在主动侦察过程中使用的另一个工具是`WAFW00F`；该工具在最新版本的Kali Linux中已预装。它用于识别和指纹识别WAF产品，并提供已知WAF的列表。可以通过向命令添加`-l`开关来提取正在使用的WAF版本（例如，`wafw00f
    -l`）。*图 3.18* 显示了运行在Web应用程序背后的具体WAF：
- en: '![Graphical user interface  Description automatically generated](../Images/B17765_03_18.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![图形用户界面  自动生成的描述](../Images/B17765_03_18.png)'
- en: 'Figure 3.18: Running wafw00f to fingerprint a web application firewall'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.18：运行wafw00f指纹识别Web应用程序防火墙
- en: Enumerating hosts
  id: totrans-237
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 主机枚举
- en: Host enumeration is the process of gaining specific particulars regarding a
    defined host. It is not enough to know that a server or wireless access point
    is present; instead, we need to expand the attack surface by identifying open
    ports, the base operating system, services that are running, and supporting applications.
    This is highly intrusive and, unless care is taken, such activity will be detected
    and logged by the target organization.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 主机枚举是获取有关特定主机详细信息的过程。仅知道服务器或无线接入点的存在是不够的；相反，我们需要通过识别开放端口、基础操作系统、正在运行的服务以及支持的应用程序来扩展攻击面。这是高度侵入性的，除非小心处理，否则这种活动会被目标组织检测到并记录。
- en: Live host discovery
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活跃主机发现
- en: The first step is to run network ping sweeps against a target address space
    and look for responses that indicate that a particular target is live and capable
    of responding. Historically, pinging is referred to as the use of ICMP; however,
    TCP, UDP, ICMP, and ARP traffic can also be used to identify live hosts.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是对目标地址空间进行网络ping扫描，并查找指示特定目标处于活动状态并能够响应的响应。历史上，ping通常指的是使用ICMP；然而，TCP、UDP、ICMP和ARP流量也可以用于识别活动主机。
- en: 'Various scanners can be run from remote locations across the internet to identify
    live hosts. Although the primary scanner is Nmap, Kali provides several other
    applications that are also useful, as shown in *Table 3.5*:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 各种扫描器可以通过互联网的远程位置运行，以识别活动主机。虽然主要的扫描器是Nmap，Kali还提供了其他一些有用的应用程序，如*表 3.5*所示：
- en: '| **Application** | **Description** |'
  id: totrans-242
  prefs: []
  type: TYPE_TB
  zh: '| **应用程序** | **描述** |'
- en: '| `atk6-alive6` and `atk6-detect-new-ip6` | This is for IPv6 host detection.
    `Atk6-detect-new-ip6` runs on a scripted basis and identifies new IPv6 devices
    when added. |'
  id: totrans-243
  prefs: []
  type: TYPE_TB
  zh: '| `atk6-alive6` 和 `atk6-detect-new-ip6` | 这是用于 IPv6 主机检测的工具。`Atk6-detect-new-ip6`
    以脚本方式运行，当新 IPv6 设备被添加时，会自动识别。|'
- en: '| `dnmap` and `nmap` | `nmap` is the standard network enumeration tool. `dnmap`
    is a distributed client-server implementation of the Nmap scanner. PBNJ (a suite
    of tools to monitor changes on a network over time) stores Nmap results in a database
    and then conducts historical analyses to identify new hosts. |'
  id: totrans-244
  prefs: []
  type: TYPE_TB
  zh: '| `dnmap` 和 `nmap` | `nmap` 是标准的网络枚举工具。`dnmap` 是 Nmap 扫描器的分布式客户端-服务器实现。PBNJ（一个用于监控网络上变化的工具套件）将
    Nmap 结果存储在数据库中，并进行历史分析，以识别新主机。|'
- en: '| `fping`, `hping2`, `hping3`, and `nping` | These are packet crafters that
    respond to targets in various ways to identify live hosts. |'
  id: totrans-245
  prefs: []
  type: TYPE_TB
  zh: '| `fping`、`hping2`、`hping3` 和 `nping` | 这些是数据包构造工具，它们通过不同的方式响应目标，帮助识别在线主机。|'
- en: 'Table 3.5: Tools used to discover live hosts in Kali Linux'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 表 3.5：在 Kali Linux 中用于发现在线主机的工具
- en: To the penetration tester or attacker, the data returned from live host discovery
    will identify the targets for attack.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 对于渗透测试员或攻击者来说，从在线主机发现中返回的数据将确定攻击目标。
- en: It is good practice to run multiple host discovery scans while conducting a
    penetration test, as certain devices may be time-dependent. During one penetration
    test, it was discovered that the system administrator set up a server to play
    games after regular business hours. Because it was not an approved business system,
    the administrator didn’t follow the normal process for securing the server; multiple
    vulnerable services were present, and it hadn’t received the necessary security
    patches. Testers were able to compromise this server and gain access to the underlying
    corporate network using vulnerabilities in the administrator’s server that was
    used to play games.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行渗透测试时，最好运行多个主机发现扫描，因为某些设备可能是时间敏感的。在一次渗透测试中，发现系统管理员在正常工作时间结束后设置了一台服务器用于玩游戏。由于这不是一个经过批准的业务系统，管理员没有按照正常流程为服务器提供安全保护；服务器上有多个易受攻击的服务，且未安装必要的安全补丁。测试人员通过利用管理员用于玩游戏的服务器中的漏洞，成功攻破了该服务器并获得了访问底层企业网络的权限。
- en: Port, operating system, and service discovery
  id: totrans-249
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 端口、操作系统和服务发现
- en: Kali provides several different tools useful for identifying open ports, operating
    systems, and installed services on remote hosts. The majority of these functions
    can be completed using Nmap. Although we will focus on examples using Nmap, the
    underlying principles apply to the other tools as well.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: Kali 提供了几种不同的工具，适用于识别远程主机上开放的端口、操作系统和已安装的服务。大多数功能可以通过 Nmap 完成。虽然我们会重点介绍使用 Nmap
    的示例，但其基本原理同样适用于其他工具。
- en: Port scanning
  id: totrans-251
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 端口扫描
- en: Port scanning is the process of connecting to TCP and UDP ports to determine
    what services and applications are running on the target device. In TCP/IP, there
    are 65,535 ports each for both TCP and UDP on any computer. Some ports are known
    to be associated with particular services (for instance, TCP 20 and 21 are the
    usual ports for the **File Transfer Protocol** (**FTP**) service).
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 端口扫描是连接到 TCP 和 UDP 端口的过程，用来确定目标设备上正在运行的服务和应用程序。在 TCP/IP 中，每台计算机有 65,535 个端口，分别用于
    TCP 和 UDP。有些端口已知与特定服务相关联（例如，TCP 20 和 21 是 **文件传输协议** (**FTP**) 服务的常用端口）。
- en: The first 1,024 are the well-known ports, and most defined services run over
    ports in this range; accepted services and ports are maintained by IANA ([http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml](http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)).
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 前 1,024 个端口是众所周知的端口，大多数定义的服务都在这个范围内运行；已接受的服务和端口由 IANA 维护（[http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml](http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)）。
- en: Although there are accepted ports for particular services, such as port `80`
    for web-based traffic, services can be directed to use any port. This option is
    frequently used to hide particular services, especially if the service is known
    to be vulnerable to attack. However, if attackers complete a port scan and do
    not find an expected service, or find it using an unusual port, they will be prompted
    to investigate further.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然某些服务有预定义的端口，例如 `80` 端口用于网页流量，但服务可以被配置为使用任何端口。这个选项常常用于隐藏特定服务，特别是当服务已知易受攻击时。然而，如果攻击者完成端口扫描后没有发现预期的服务，或者发现服务使用了不常见的端口，他们将会被促使进一步调查。
- en: The universal port mapping tool, Nmap, relies on active stack fingerprinting.
    Specially crafted packets are sent to the target system, and the response of the
    OS to those packets allows Nmap to identify the OS. In order for Nmap to work,
    at least one listening port must be open, and the operating system must be known
    and fingerprinted, with a copy of that fingerprint stored in the local database.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 通用端口映射工具Nmap依赖于主动栈指纹识别。特制的数据包被发送到目标系统，操作系统对这些数据包的响应使Nmap能够识别操作系统。为了使Nmap工作，必须至少有一个监听端口是开放的，并且操作系统必须已知并进行指纹识别，且该指纹的副本已存储在本地数据库中。
- en: 'Using Nmap for port discovery is very noisy; it will be detected and logged
    by network security devices. Some points to remember are the following:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Nmap进行端口发现时会产生大量噪声；它将被网络安全设备检测到并记录下来。需要记住的几点如下：
- en: Attackers and penetration testers focused on stealth will only test the ports
    that impact the kill chain they are following to their specific target. If they
    are launching an attack that exploits vulnerabilities in a web server, they will
    search for targets with accessible ports `80` and `443` or ports `8080` and `8443`.
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 聚焦于隐蔽性的攻击者和渗透测试人员只会测试那些影响他们所追踪的目标的**杀伤链**的端口。如果他们正在发起一个利用web服务器漏洞的攻击，他们会寻找具有可访问端口`80`和`443`，或端口`8080`和`8443`的目标。
- en: Most port scanners have default lists of ports that are scanned to ensure that
    you know what is on that list and what has been omitted. Consider both TCP and
    UDP ports.
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 大多数端口扫描器都有默认的端口列表，扫描这些端口以确保你知道列表中有哪些端口，以及哪些端口被遗漏了。需要考虑TCP和UDP端口。
- en: Successful scanning requires a deep knowledge of TCP/IP and related protocols,
    networking, and how particular tools work. For example, SCTP is an increasingly
    common protocol on networks, but it is rarely tested on corporate networks.
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成功的扫描需要对TCP/IP及相关协议、网络以及特定工具如何工作的深刻理解。例如，SCTP是一个越来越常见的网络协议，但在公司网络中很少进行测试。
- en: Port scanning, even when done slowly, can impact a network. Some older network
    equipment and equipment from specific vendors will lock when receiving or transmitting
    a port scan, hence turning a scan into a denial-of-service attack.
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 即使是慢速进行的端口扫描，也可能会影响网络。一些旧的网络设备和来自特定厂商的设备在接收或传输端口扫描时会被锁定，从而将扫描变成拒绝服务攻击。
- en: Tools used to scan a port, particularly Nmap, are being extended with regard
    to functionalities. They can also be used to detect vulnerabilities and exploit
    simple security holes.
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于扫描端口的工具，特别是Nmap，正在扩展其功能。它们还可以用于检测漏洞并利用一些简单的安全漏洞。
- en: Writing your own port scanner using netcat
  id: totrans-262
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用netcat编写你自己的端口扫描器
- en: 'While attackers utilize the proxying application and Tor network, it is also
    possible to write their own custom network port scanner. The following one-line
    command can be utilized during penetration testing to identify the list of open
    ports just by using netcat, as shown in *Figure 3.19*:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 当攻击者利用代理应用和Tor网络时，也可以编写自己的自定义网络端口扫描器。以下的一行命令可以在渗透测试中使用，仅通过使用netcat就能识别开放端口的列表，如*图
    3.19*所示：
- en: '[PRE9]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](../Images/B17765_03_19.png)'
  id: totrans-265
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_19.png)'
- en: 'Figure 3.19: Running a one-line Bash script to do port scanning'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.19：运行一行 Bash 脚本进行端口扫描
- en: 'The same script can be modified for more targeted attacks on a single IP, as
    follows:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 相同的脚本可以修改为针对单一IP的更具针对性的攻击，如下所示：
- en: '[PRE10]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The chances of getting alerted in any intrusion detection system using custom
    port scanners are high compared to other port scanners.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 使用自定义端口扫描器时，任何入侵检测系统被警报的可能性都比使用其他端口扫描器时要高。
- en: Fingerprinting the operating system
  id: totrans-270
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作系统指纹识别
- en: 'Determining the OS of a remote system is conducted using two types of scans:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 确定远程系统操作系统的方法是通过两种类型的扫描来完成的：
- en: '**Active fingerprinting**: The attacker sends normal and malformed packets
    to the target and records its response pattern, referred to as the fingerprint.
    By comparing the fingerprint to a local database, the operating system can be
    determined.'
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主动指纹识别**：攻击者向目标发送正常和畸形的数据包，并记录其响应模式，这称为指纹。通过将指纹与本地数据库进行比对，可以确定操作系统。'
- en: '**Passive fingerprinting**: The attacker sniffs—or records—and analyzes the
    packet stream to determine the characteristics of the packets.'
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**被动指纹识别**：攻击者嗅探或记录并分析数据包流，以确定数据包的特征。'
- en: 'Active fingerprinting is faster and more accurate than passive fingerprinting;
    in Kali, the primary active tool is Nmap. The Nmap tool injects packets into the
    target network and analyzes the response that it receives. In *Figure 3.20*, the
    `-O` flag commands Nmap to determine the operating system:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 主动指纹识别比被动指纹识别更快、更准确；在Kali中，主要的主动工具是Nmap。Nmap工具向目标网络注入数据包，并分析其接收到的响应。在*图3.20*中，`-O`标志命令Nmap确定操作系统：
- en: '[PRE11]'
  id: totrans-275
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](../Images/B17765_03_20.png)'
  id: totrans-276
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_20.png)'
- en: 'Figure 3.20: Nmap scan to identify the operating system of the target'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 图3.20：Nmap扫描以识别目标的操作系统
- en: Note that it is simple for the target system to hide the true operating system.
    Since fingerprinting software relies on packet setting, such as time-to-live or
    the initial window’s size, changes to these values or other user-configurable
    settings can change the tool results. Some organizations actively change these
    values to make the final stages of reconnaissance more difficult.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，目标系统隐藏真实操作系统是相对简单的。由于指纹识别软件依赖于数据包设置，如生存时间或初始窗口大小，改变这些值或其他用户可配置的设置会改变工具的结果。一些组织会主动更改这些值，以使侦察的最终阶段更加困难。
- en: Determining active services
  id: totrans-279
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确定活动服务
- en: 'The final goal of the enumeration portion of reconnaissance is to identify
    the services and applications that are operational on the target system. If possible,
    the attacker will want to know the service type, vendor, and version to facilitate
    the identification of any vulnerability. The following are some of the techniques
    used to determine active services:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察阶段的最终目标是识别目标系统上运行的服务和应用程序。如果可能，攻击者将希望知道服务类型、供应商和版本，以便更容易识别潜在的漏洞。以下是一些用于确定活动服务的技术：
- en: '**Identify default ports and services**: If the remote system is identified
    as having a Microsoft operating system with port `80` open (the WWW service),
    an attacker may assume that a default installation of Microsoft IIS is installed.
    Additional testing will be used to verify this assumption (using Nmap).'
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**识别默认端口和服务**：如果远程系统被识别为运行Microsoft操作系统，并且端口`80`（WWW服务）处于开放状态，攻击者可能会假设已安装了默认的Microsoft
    IIS。将使用额外的测试来验证这一假设（使用Nmap）。'
- en: '**Banner grabbing**: This is done using tools such as amap, netcat, Nmap, and
    Telnet.'
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**横幅抓取**：这通常使用如amap、netcat、Nmap和Telnet等工具进行。'
- en: '**Review default web pages**: Some applications install with default administration,
    error, or other pages. If attackers access these, they will provide guidance on
    installed applications that may be vulnerable to attack. In *Figure 3.21*, the
    attacker can easily identify the version of Microsoft IIS that has been installed
    on the target system.'
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**检查默认网页**：某些应用程序会安装默认的管理、错误或其他页面。如果攻击者访问这些页面，它们将提供关于已安装应用程序的信息，这些应用程序可能存在安全漏洞。在*图3.21*中，攻击者可以轻松识别出目标系统上已安装的Microsoft
    IIS版本。'
- en: '**Review source code**: Poorly configured web-based applications may respond
    to certain HTTP requests such as `HEAD` or `OPTIONS` with a response that includes
    the web server software version, and, possibly, the base operating system or the
    scripting environment in use. In *Figure 3.21*, `netcat` is launched from the
    command line and is used to send raw `HEAD` packets to a particular website. This
    request generates a success message (`200 OK`); however, it also identifies that
    the server is running Microsoft IIS 7.5 and powered by ASP.NET:'
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**查看源代码**：配置不当的基于Web的应用程序可能会对某些HTTP请求（如`HEAD`或`OPTIONS`）作出响应，这些响应中可能包含Web服务器的软件版本，甚至可能包括基本操作系统或使用的脚本环境。在*图3.21*中，`netcat`从命令行启动，用于向特定网站发送原始的`HEAD`数据包。该请求生成了成功消息（`200
    OK`）；然而，它也识别出服务器正在运行Microsoft IIS 7.5，并且由ASP.NET驱动：'
- en: '[PRE12]'
  id: totrans-285
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](../Images/B17765_03_21.png)'
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_21.png)'
- en: 'Figure 3.21: Using netcat to grab the banner of a target'
  id: totrans-287
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图3.21：使用netcat抓取目标的横幅
- en: Large-scale scanning
  id: totrans-288
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 大规模扫描
- en: In the case of testing bigger organizations with multiple class B/C IP ranges,
    large-scale scanning is engaged. For example, with a global company, often, a
    number of IP blocks exist as part of external internet facing. As mentioned earlier
    in *Chapter 2*, *Open-Source Intelligence and Passive Reconnaissance*, attackers
    do not have time limitations to scan, but penetration testers do. Pentesters can
    engage multiple tools to perform the activity; Masscan is one such tool that would
    be engaged to scan large-scale IP blocks to quickly analyze the live hosts in
    the target network. Masscan is installed in Kali by default.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 在测试较大的组织时，通常会涉及多个类 B/C IP 范围的大规模扫描。例如，对于全球性公司，通常存在多个 IP 块作为外部面向互联网的部分。如*第二章*《开源情报与被动侦察》中所述，攻击者进行扫描时没有时间限制，而渗透测试人员有时间限制。渗透测试人员可以使用多种工具执行该活动；Masscan
    是其中之一，可用于扫描大规模的 IP 块，快速分析目标网络中的活动主机。Masscan 在 Kali 中是默认安装的。
- en: 'The biggest advantage of Masscan is the randomization of hosts, ports, speed,
    flexibility, and compatibility. *Figure 3.22* provides a Class C scanning network
    within a few seconds to complete and identify the available HTTP service on port
    `80` and services running on the target hosts:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: Masscan 的最大优势在于主机、端口、速度的随机化，灵活性和兼容性。*图 3.22*展示了一个类 C 网络的扫描，几秒钟内即可完成，并识别出目标主机上端口
    `80` 上可用的 HTTP 服务：
- en: '![](../Images/B17765_03_22.png)Figure 3.22: Running masscan on the class-c
    IP range to discover TCP open port 80'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: '![](../Images/B17765_03_22.png)图 3.22：在类 C IP 范围内运行 masscan 以发现 TCP 开放端口 80'
- en: DHCP information
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP 信息
- en: The **Dynamic Host Configuration Protocol** (**DHCP**) is a service that dynamically
    assigns an IP address to the hosts on the network. This protocol operates at the
    MAC sub-layer of the Data Link layer of the TCP/IP protocol stack. Upon the selection
    of auto-configuration, a broadcast query will be sent to the DHCP servers and
    when a response is received from the DHCP server, a broadcast query is sent by
    the client to the DHCP server requesting required information. The server will
    now assign an IP address to the system, along with other configuration parameters
    such as the subnet mask, DNS, and the default gateway.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: '**动态主机配置协议**（**DHCP**）是一项动态分配 IP 地址给网络主机的服务。此协议在 TCP/IP 协议栈的数据链路层的 MAC 子层中运行。选择自动配置时，会向
    DHCP 服务器发送广播查询，当 DHCP 服务器响应时，客户端会向 DHCP 服务器发送广播查询请求所需的信息。服务器将为系统分配一个 IP 地址，并提供其他配置参数，如子网掩码、DNS
    和默认网关。'
- en: 'Sniffing is a great way of collecting passive information once connected to
    a network. Attackers can start this by running the Wireshark utility and will
    be able to see a lot of broadcast traffic, as shown in *Figure 3.23*:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 嗅探是一种非常有效的被动信息收集方法，一旦连接到网络，攻击者可以通过运行 Wireshark 工具开始嗅探，看到大量广播流量，如*图 3.23*所示：
- en: '![](../Images/B17765_03_23.png)Figure 3.23: Broadcast network traffic in Wireshark'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: '![](../Images/B17765_03_23.png)图 3.23：Wireshark 中的广播网络流量'
- en: We will now see traffic on **DNS**, **NBNS**, **BROWSER**, and other protocols
    that might potentially reveal hostnames, **VLAN** information, domains, and active
    subnets in the network. We will be discussing more attacks specific to sniffing
    in *Chapter 11*, *Action on the Objective and Lateral Movement*.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在会看到 **DNS**、**NBNS**、**BROWSER** 及其他可能揭示主机名、**VLAN** 信息、域名和活动子网的协议流量。我们将在*第
    11 章*《目标行动与横向移动》中讨论更多与嗅探相关的攻击。
- en: Identification and enumeration of internal network hosts
  id: totrans-297
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 内部网络主机的识别与枚举
- en: 'If the attacker’s system is already configured with the DHCP, it will provide
    some information that is very useful to map the internal network. The DHCP information
    can be obtained by typing `ifconfig` in the Kali terminal, as shown in *Figure
    3.24*; you should be able to see the information detailed:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击者的系统已经配置了 DHCP，它将提供一些非常有用的信息，有助于映射内部网络。可以通过在 Kali 终端中输入 `ifconfig` 来获取 DHCP
    信息，如*图 3.24*所示；你应该能够看到详细的信息：
- en: '![](../Images/B17765_03_24.png)'
  id: totrans-299
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_24.png)'
- en: 'Figure 3.24: Ifconfig details on the Ethernet adapters'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.24：以太网适配器的 ifconfig 详细信息
- en: '`inet`: The IP information obtained by the DHCP server should provide us with
    at least one active subnet, which can be utilized to identify the list of live
    systems and services through different scanning techniques.'
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`inet`：DHCP 服务器提供的 IP 信息应至少为我们提供一个活动子网，可以通过不同的扫描技术来识别活动系统和服务的列表。'
- en: '`netmask`: This information can be utilized to calculate the subnet ranges.
    From the previous screenshot, we have `255.255.255.0`, which means `CIDR` is `/24`,
    and we can probably expect 255 hosts on the same subnet.'
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`子网掩码`：此信息可用于计算子网范围。从前面的截图来看，我们有 `255.255.255.0`，这意味着 `CIDR` 是 `/24`，我们可以大致预期在同一子网中有
    255 个主机。 |'
- en: '**Default gateway**: The IP information of the gateway will provide the opportunity
    to ping other similar gateway IPs. For example, if your default gateway IP is
    10.10.10.1, by using ping scans, attackers may be able to enumerate other similar
    IP addresses, such as 10.10.20.1 and 10.10.20.1.'
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**默认网关**：网关的 IP 信息提供了 ping 其他类似网关 IP 的机会。例如，如果默认网关的 IP 是 10.10.10.1，通过 ping
    扫描，攻击者可能能够枚举其他相似的 IP 地址，如 10.10.20.1 和 10.10.20.1。 |'
- en: '**Other IP address**: DNS information can be obtained by accessing the `/etc/resolv.conf`
    file. The IP addresses in this file are commonly addressed in all of the subnets,
    and domain information will also be automatically added during the DHCP process,
    which will also be available in the same file.'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**其他 IP 地址**：DNS 信息可以通过访问 `/etc/resolv.conf` 文件获得。该文件中的 IP 地址通常会在所有子网中使用，并且在
    DHCP 过程中，域信息也会自动添加到该文件中。 |'
- en: Native MS Windows commands
  id: totrans-305
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 本地 MS Windows 命令
- en: '*Table 3.6* provides a list of useful commands during a penetration test or
    Red Team exercise, even when only having physical access to the system or having
    a remote shell to communicate to the target. This is not an exhaustive list, however:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '*表 3.6* 提供了一份渗透测试或红队演练中有用命令的清单，即使只有物理访问权限或具有远程 Shell 与目标系统进行通信时也能使用。然而，这并不是一个详尽的列表：'
- en: '| **Command** | **Sample** | **Description** |'
  id: totrans-307
  prefs: []
  type: TYPE_TB
  zh: '| **命令** | **示例** | **描述** |'
- en: '| `nslookup` | `nslookup``Server nameserever.google.com``Set type=any``ls -d
    anydomain.com` | `nslookup` is used to query the DNS. The sample command does
    DNS zone transfer using `nslookup`. |'
  id: totrans-308
  prefs: []
  type: TYPE_TB
  zh: '| `nslookup` | `nslookup``Server nameserever.google.com``Set type=any``ls -d
    anydomain.com` | `nslookup` 用于查询 DNS。示例命令展示了如何使用 `nslookup` 进行 DNS 区域传输。 |'
- en: '| `net view` | `net view` | This displays a list of computers/domains and other
    shared resources. |'
  id: totrans-309
  prefs: []
  type: TYPE_TB
  zh: '| `net view` | `net view` | 该命令显示计算机/域和其他共享资源的列表。 |'
- en: '| `net share` | `net share list="c:"` | This manages the shared resources and
    displays all information about the shared resources on the local system. |'
  id: totrans-310
  prefs: []
  type: TYPE_TB
  zh: '| `net share` | `net share list="c:"` | 该命令用于管理共享资源，并显示本地系统上所有共享资源的相关信息。 |'
- en: '| `net use` | `net use \\[targetIP] [password] /u:[user]``net use \\[targetIP]\[sharename]
    [password] /u:[user]` | This connects to any system on the same network; it can
    also be used to retrieve a list of network connections. |'
  id: totrans-311
  prefs: []
  type: TYPE_TB
  zh: '| `net use` | `net use \\[targetIP] [password] /u:[user]``net use \\[targetIP]\[sharename]
    [password] /u:[user]` | 该命令用于连接同一网络上的任何系统，也可用于检索网络连接列表。 |'
- en: '| `net user` | `net user [UserName [Password &#124; *] [options]] [/domain]``net
    user [UserName {Password &#124; *} /add [options] [/domain]]``net user [UserName
    [/delete] [/domain]]` | This displays information regarding users and performs
    activities related to user accounts. |'
  id: totrans-312
  prefs: []
  type: TYPE_TB
  zh: '| `net user` | `net user [UserName [Password &#124; *] [options]] [/domain]``net
    user [UserName {Password &#124; *} /add [options] [/domain]]``net user [UserName
    [/delete] [/domain]]` | 该命令显示与用户相关的信息，并执行与用户帐户相关的活动。 |'
- en: '| `arp` | `arp /a``arp /a /n 10.0.0.99``arp /s 10.0.0.80 00-AA-00-4F-2A-9C`
    | This displays and modifies any entries in the ARP cache. |'
  id: totrans-313
  prefs: []
  type: TYPE_TB
  zh: '| `arp` | `arp /a``arp /a /n 10.0.0.99``arp /s 10.0.0.80 00-AA-00-4F-2A-9C`
    | 该命令显示并修改 ARP 缓存中的条目。 |'
- en: '| `route` | `route print``route print 10.*``route add 0.0.0.0 mask 0.0.0.0
    192.168.12.1``route delete 10.*` | Similar to ARP, `route` can be utilized to
    understand the local IP routing and modify this information. |'
  id: totrans-314
  prefs: []
  type: TYPE_TB
  zh: '| `route` | `route print``route print 10.*``route add 0.0.0.0 mask 0.0.0.0
    192.168.12.1``route delete 10.*` | 类似于 ARP，`route` 可用于了解本地 IP 路由并修改这些信息。 |'
- en: '| `netstat` | `netstat -n -o` | This displays all active TCP connections and
    ports on the local system; that is to say, connections that are listening, established,
    and waiting on the network adapter IP address. |'
  id: totrans-315
  prefs: []
  type: TYPE_TB
  zh: '| `netstat` | `netstat -n -o` | 该命令显示本地系统上所有活动的 TCP 连接和端口；即显示监听中的连接、已建立连接和在网络适配器
    IP 地址上等待的连接。 |'
- en: '| `nbtstat` | `nbtstat /R``nbtstat /S 5``nbtstat /a Ip` | This displays NETBIOS
    information, normally utilized to identify a particular MAC address of an IP,
    which can be utilized in MAC spoof attacks. |'
  id: totrans-316
  prefs: []
  type: TYPE_TB
  zh: '| `nbtstat` | `nbtstat /R``nbtstat /S 5``nbtstat /a Ip` | 该命令显示 NETBIOS 信息，通常用于识别某个
    IP 的 MAC 地址，这可用于 MAC 欺骗攻击。 |'
- en: '| `wmic` | `wmic process get caption,executablepath,commandline``netsh wlan
    show profile "profilename" key=clear` | `wmic` is utilized for all typical diagnostics
    an attacker can perform; for example, a system’s Wi-Fi password can be extracted
    in a single command. |'
  id: totrans-317
  prefs: []
  type: TYPE_TB
  zh: '| `wmic` | `wmic process get caption,executablepath,commandline``netsh wlan
    show profile "profilename" key=clear` | `wmic` 被用于攻击者执行所有典型诊断；例如，系统的 Wi-Fi 密码可以通过一条命令提取。
    |'
- en: '| `reg` | `reg save HKLM\Security sec.hive reg save HKLM\System sys.hive reg
    save HKLM\SAM sam.hive reg add [\\TargetIPaddr\] [RegDomain][ \Key ]``reg export
    [RegDomain]\[Key] [FileName]reg import [FileName ]``reg query [\\TargetIPaddr\]
    [RegDomain]\[ Key ] /v [Valuename!]` | The `reg` command is used by most attackers
    to save registry hives to perform offline password attacks. |'
  id: totrans-318
  prefs: []
  type: TYPE_TB
  zh: '| `reg` | `reg save HKLM\Security sec.hive reg save HKLM\System sys.hive reg
    save HKLM\SAM sam.hive reg add [\\TargetIPaddr\] [RegDomain][ \Key ]``reg export
    [RegDomain]\[Key] [FileName]reg import [FileName ]``reg query [\\TargetIPaddr\]
    [RegDomain]\[ Key ] /v [Valuename!]` | `reg` 命令被大多数攻击者用于保存注册表配置单元，以进行离线密码攻击。 |'
- en: '| `for` | `for /L %i in (1,1,10) do echo %ii && ping -n 5 IP``for /F %i in
    (password.lst) do @echo %i& @net use \\[targetIP] %i /u:[Username] 2>nul&& pause
    && echo [Username] :%i>>done.txt` | The `for` loop can be utilized in Windows
    to create a port scanner or enumeration of accounts. |'
  id: totrans-319
  prefs: []
  type: TYPE_TB
  zh: '| `for` | `for /L %i in (1,1,10) do echo %ii && ping -n 5 IP``for /F %i in
    (password.lst) do @echo %i& @net use \\[targetIP] %i /u:[用户名] 2>nul&& pause &&
    echo [用户名] :%i>>done.txt` | `for` 循环可以在 Windows 中用于创建端口扫描器或枚举账户。 |'
- en: 'Table 3.6: Useful Windows commands during penetration testing activity'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 表 3.6：渗透测试活动中的常用 Windows 命令
- en: ARP broadcasting
  id: totrans-321
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ARP 广播
- en: During internal network active reconnaissance, the entire local network can
    be scanned using `nmap` (`nmap -v -sn IPrange`) to sniff the ARP broadcasts. In
    addition, Kali has `arp-scan` (`arp-scan IP range`) to identify a list of hosts
    that are alive on the same network.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 在内部网络主动侦察过程中，可以使用 `nmap`（`nmap -v -sn IPrange`）扫描整个本地网络并嗅探 ARP 广播。此外，Kali 也有
    `arp-scan`（`arp-scan IP range`）来识别同一网络上存活的主机列表。
- en: '*Figure 3.25* is a screenshot of Wireshark that provides the traffic generated
    at the target when `arp-scan` is run against the entire subnet. This is considered
    to be a non-stealthy scan:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3.25* 是 Wireshark 的截图，展示了在对整个子网运行 `arp-scan` 时生成的目标流量。这被认为是一种非隐蔽扫描：'
- en: '![](../Images/B17765_03_25.png)'
  id: totrans-324
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_25.png)'
- en: 'Figure 3.25: ARP scanning network traffic on Wireshark'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.25：在 Wireshark 上进行 ARP 扫描的网络流量
- en: Ping sweep
  id: totrans-326
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Ping 扫描
- en: 'A ping sweep is the process of pinging an entire range of network IP addresses
    or individual IPs to find out whether they are alive and responding. An attacker’s
    first step in any large-scale scanning is to enumerate all of the hosts that are
    responding. Penetration testers can leverage `fping` or `nmap`, or even write
    custom Bash scripts to carry out the activity:'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: Ping 扫描是对整个网络 IP 地址范围或单个 IP 进行 ping 测试的过程，用来检查它们是否存活并做出响应。攻击者在进行大规模扫描时的第一步是枚举所有有响应的主机。渗透测试人员可以利用
    `fping` 或 `nmap`，甚至编写自定义的 Bash 脚本来执行该活动：
- en: '[PRE13]'
  id: totrans-328
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Sometimes, attackers can encounter a roadblock during the ping sweep due to
    a firewall that blocks all of the ICMP traffic. In the case of an ICMP block,
    we can utilize the following command to identify alive hosts by specifying a list
    of port numbers during the ping sweep:'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，攻击者在进行 ping 扫描时可能会遇到障碍，因为防火墙会阻止所有 ICMP 流量。在 ICMP 被阻止的情况下，我们可以利用以下命令，通过在 ping
    扫描时指定端口号列表来识别存活的主机：
- en: '[PRE14]'
  id: totrans-330
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '*Figure 3.26* shows all of the live hosts that were discovered using the `fping`
    tool:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3.26* 显示了使用 `fping` 工具发现的所有存活主机：'
- en: '![](../Images/B17765_03_26.png)'
  id: totrans-332
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_26.png)'
- en: 'Figure 3.26: Output of gping on the class-c IP range'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.26：在类 C IP 范围上使用 gping 的输出
- en: Using scripts to combine masscan and nmap scans
  id: totrans-334
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用脚本结合 masscan 和 nmap 扫描
- en: 'The speed and reliability of `masscan` and `nmap` to enumerate in detail is
    a great combination to use in our goal-based penetration testing strategy. In
    this section, we will write a piece of script that can save time and provide more
    accurate results than those that can be used during exploitation while identifying
    the right vulnerabilities:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: '`masscan` 和 `nmap` 在详细枚举方面的速度和可靠性是我们目标导向渗透测试策略中非常有效的组合。在本节中，我们将编写一段脚本，它能够节省时间并提供比在利用漏洞时使用的工具更准确的结果：'
- en: '[PRE15]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Now, save the file into `anyname.sh` and then `chmod +x anyname.sh`. Next, run
    `./anyname.sh fileincludesipranges`.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，将文件保存为 `anyname.sh`，然后执行 `chmod +x anyname.sh`。接下来，运行 `./anyname.sh fileincludesipranges`。
- en: 'Upon executing the preceding script, you should be able to see the following,
    as shown in *Figure 3.27*:'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 执行前面的脚本后，你应该能够看到以下内容，如 *图 3.27* 所示：
- en: '![](../Images/B17765_03_27.png)'
  id: totrans-339
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_27.png)'
- en: 'Figure 3.27: Running our custom script in Kali to scan the network'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.27：在 Kali 上运行我们自定义的脚本扫描网络
- en: Taking advantage of SNMP
  id: totrans-341
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 利用 SNMP
- en: '**SNMP**, **Simple Network Management Protocol**, is traditionally used to
    collect information about the configuration of network devices such as printers,
    hubs, switches, routers on internet protocol, and servers. Attackers can potentially
    take advantage of SNMP that runs on UDP port `161` (by default) when it is poorly
    configured or left out, with the default configuration having a default community
    string.'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: '**SNMP**，即 **简单网络管理协议**，传统上用于收集网络设备的配置信息，如打印机、集线器、交换机、路由器及互联网协议上的服务器。攻击者可能会利用
    SNMP（默认在 UDP 端口 `161` 上运行），特别是当 SNMP 配置不当或被忽视时，默认配置使用默认的社区字符串。'
- en: 'SNMP was first introduced in 1987: version 1 had plain text passwords in transit;
    version 2c had improved performance, but still plain text passwords; and now the
    latest version 3 encrypts all of the traffic with message integrity. There are
    two types of community strings utilized in all versions of SNMP:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: SNMP 首次引入于 1987 年：版本 1 在传输过程中使用明文密码；版本 2c 提高了性能，但仍使用明文密码；而最新的版本 3 则对所有流量进行了加密，并确保消息完整性。所有版本的
    SNMP 都使用两种类型的社区字符串：
- en: '**Public**: Community string is used for read-only access'
  id: totrans-344
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Public**：社区字符串用于只读访问'
- en: '**Private**: Community string is used for both read and write access'
  id: totrans-345
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Private**：社区字符串用于读写访问'
- en: The thing that attackers would look for is any identified network device on
    the internet and find out whether a public community string is enabled so that
    they can pull out all of the information specific to the network and draw a topology
    around it to create more focused attacks. These issues arise since, most of the
    time, IP-based **Access Control Lists** (**ACLs**) are often not implemented,
    or not used at all.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者会寻找的是互联网中任何已识别的网络设备，并检查是否启用了公共社区字符串，以便提取与网络相关的所有信息并绘制拓扑结构，从而进行更有针对性的攻击。这些问题的产生通常是因为基于
    IP 的 **访问控制列表** (**ACLs**) 通常未被实施或根本未使用。
- en: 'Kali Linux provides multiple tools to perform the SNMP enumeration; attackers
    can utilize snmpwalk or onesixtyone to understand the complete information SNMP
    steps, as shown in *Figure 3.28*:'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux 提供了多种工具来执行 SNMP 枚举；攻击者可以利用 snmpwalk 或 onesixtyone 来了解完整的 SNMP 步骤，如
    *图 3.28* 所示：
- en: '[PRE16]'
  id: totrans-348
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![A picture containing text  Description automatically generated](../Images/B17765_03_28.png)'
  id: totrans-349
  prefs: []
  type: TYPE_IMG
  zh: '![一张包含文本的图片  描述自动生成](../Images/B17765_03_28.png)'
- en: 'Figure 3.28: snmpwalk output on a device with a public community string'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.28：具有公共社区字符串的设备上的 snmpwalk 输出
- en: Attackers can also utilize Metasploit to perform SNMP enumeration, by using
    the `/auxiliary/scanner/snmp/snmpenum` module as shown in *Figure 3.29*.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者还可以利用 Metasploit 通过使用 `/auxiliary/scanner/snmp/snmpenum` 模块进行 SNMP 枚举，如 *图
    3.29* 所示。
- en: 'Some systems have SNMP installed, but that is completely ignored by the system
    administrators:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 有些系统安装了 SNMP，但系统管理员完全忽视了这一点：
- en: '![](../Images/B17765_03_29.png)'
  id: totrans-353
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_29.png)'
- en: 'Figure 3.29: SNMP enumeration using Metasploit through the SNMP protocol'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.29：通过 SNMP 协议使用 Metasploit 进行 SNMP 枚举
- en: 'Attackers will also be able to extract all of the user accounts by using account
    enumeration modules within Metasploit, as shown in *Figure 3.30*:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者还可以通过 Metasploit 内的账户枚举模块提取所有用户账户，如 *图 3.30* 所示：
- en: '![](../Images/B17765_03_30.png)'
  id: totrans-356
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_30.png)'
- en: 'Figure 3.30: Account enumeration using Metasploit through the SNMP protocol'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.30：通过 SNMP 协议使用 Metasploit 进行账户枚举
- en: Windows account information via SMB sessions
  id: totrans-358
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通过 SMB 会话获取的 Windows 账户信息
- en: 'Traditionally, during internal network scanning, it is very likely that attackers
    exploit the internal **Server Message Block** (**SMB**) sessions that are most
    commonly used. In the case of external exploitation, attackers can engage `nmap`
    to perform the enumeration, but this scenario is very rare. The following `nmap`
    command will enumerate all of the remote users on the Windows machine. This information
    normally creates lots of entry points, much like brute force and password guessing
    attacks in later stages:'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，在内部网络扫描期间，攻击者很可能利用最常用的内部 **服务器消息块** (**SMB**) 会话。在外部利用的情况下，攻击者可以使用 `nmap`
    进行枚举，但这种场景非常罕见。以下 `nmap` 命令将枚举 Windows 机器上的所有远程用户。这些信息通常会创建许多入口点，就像后期的暴力破解和密码猜测攻击一样：
- en: '[PRE17]'
  id: totrans-360
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Attackers may also utilize the Metasploit module, `auxiliary/scanner/smb/smb_enumusers`,
    to perform the activity. *Figure 3.31* shows the successful enumeration of users
    on a Windows system running `Metasploitable3`:'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者还可以利用 Metasploit 模块 `auxiliary/scanner/smb/smb_enumusers` 执行该活动。*图 3.31*
    显示了在运行 `Metasploitable3` 的 Windows 系统上成功枚举用户：
- en: '![](../Images/B17765_03_31.png)'
  id: totrans-362
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_31.png)'
- en: 'Figure 3.31: Enumeration of users in Metasploit using the SMB protocol'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.31：使用 SMB 协议在 Metasploit 中枚举用户
- en: This can be achieved either by having a valid password guess to the system or
    by brute-forcing the SMB logins.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 这可以通过具有有效的密码猜测来实现，或者通过暴力破解 SMB 登录。
- en: Locating network shares
  id: totrans-365
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 定位网络共享
- en: 'One of the oldest attacks that penetration testers these days forget about
    is the NETBIOS null session, which will allow them to enumerate all of the network
    shares:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员如今经常忽略的最古老攻击之一是 NETBIOS 空会话，它可以让他们枚举所有网络共享：
- en: '[PRE18]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '`enum4linux` can also be utilized in a similar way to `enum.exe`, formerly
    from BindView, which has now been taken over by Symantec; this tool is normally
    used for enumerating information from Windows and Samba systems:'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: '`enum4linux` 也可以像 `enum.exe` 一样使用，`enum.exe` 曾是 BindView 的一部分，现已由 Symantec
    接管；该工具通常用于从 Windows 和 Samba 系统中枚举信息：'
- en: '[PRE19]'
  id: totrans-369
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The options are the following (such as `enum`):'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 选项如下（如 `enum`）：
- en: '`-U`: Get user list'
  id: totrans-371
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-U`：获取用户列表'
- en: '`-M`: Get machine list'
  id: totrans-372
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-M`：获取机器列表'
- en: '`-S`: Get share list'
  id: totrans-373
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-S`：获取共享列表'
- en: '`-P`: Get password policy information'
  id: totrans-374
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-P`：获取密码策略信息'
- en: '`-G`: Get group and member list'
  id: totrans-375
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-G`：获取组和成员列表'
- en: '`-d`: Be detailed; applies to `-U` and `-S`'
  id: totrans-376
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-d`：详细信息；适用于 `-U` 和 `-S`'
- en: '`-u user`: Specify the username to use (default `""`)'
  id: totrans-377
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-u user`：指定要使用的用户名（默认为 `""`）'
- en: '`-p pass`: Specify the password to use (default `""`)'
  id: totrans-378
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-p pass`：指定要使用的密码（默认为 `""`）'
- en: 'This tool is more aggressive in scanning and identifying the list of domains
    along with the domain SID, as shown in *Figure 3.32*:'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具在扫描和识别域列表以及域 SID 方面更具攻击性，如 *图 3.32* 所示：
- en: '![](../Images/B17765_03_32.png)'
  id: totrans-380
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_32.png)'
- en: 'Figure 3.32: Enumerating the domain controller using enum4linux'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.32：使用 enum4linux 枚举域控制器
- en: Reconnaissance of active directory domain servers
  id: totrans-382
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 主动目录域服务器侦察
- en: Often during an internal penetration testing activity, penetration testers will
    be provided with a username and password. In real-world scenarios, the attackers
    are inside the network, and an attack scenario would be what they could do with
    normal user access and how they elevate the privileges to compromise the enterprise
    domain.
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 在内部渗透测试活动中，渗透测试人员通常会被提供用户名和密码。在实际场景中，攻击者已进入网络，攻击场景将是他们能够利用正常用户权限做什么，以及如何提升权限来危及企业域。
- en: 'Kali Linux provides `rpcclient` installed by default, which can be utilized
    to perform more active reconnaissance on an active directory environment. This
    tool provides multiple options to extract all of the details about the domain
    and other networking services, which we will be exploring in *Chapter 10*, *Exploitation*.
    One of the system internal tools, ADExplorer, can also be utilized to perform
    the AD enumeration. *Figure 3.33* shows the enumeration of lists of domains, users,
    and groups:'
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux 默认安装了 `rpcclient`，可以用来对活动目录环境进行更积极的侦察。该工具提供了多个选项来提取域和其他网络服务的所有详细信息，我们将在
    *第 10 章*，*利用* 中进行探索。系统内部工具之一 ADExplorer 也可以用来执行 AD 枚举。*图 3.33* 展示了域、用户和组的枚举：
- en: '![](../Images/B17765_03_33.png)'
  id: totrans-385
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_33.png)'
- en: 'Figure 3.33: Enumeration of domain and account details using rpcclient with
    valid credentials'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.33：使用有效凭据通过 rpcclient 枚举域和账户详细信息
- en: Enumerating the Microsoft Azure environment
  id: totrans-387
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 枚举 Microsoft Azure 环境
- en: During the pandemic, many organizations transformed themselves to be better
    integrated with cloud platforms, especially when there was a critical vulnerability
    on Microsoft Exchange Server that was released. In this section, we will discuss
    the various techniques utilized to perform information gathering from the Azure
    environment using Kali Linux.
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 在疫情期间，许多组织进行了转型，以更好地与云平台集成，特别是在 Microsoft Exchange Server 发布关键漏洞时。在本节中，我们将讨论使用
    Kali Linux 从 Azure 环境中进行信息收集的各种技术。
- en: 'To interact with the Azure services, we will first need the client to be downloaded.
    This can be achieved by running the following commands in the terminal:'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 要与 Azure 服务交互，我们首先需要下载客户端。可以通过在终端中运行以下命令来实现：
- en: '[PRE20]'
  id: totrans-390
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Upon successful installation of `azure-cli`, we should be able to log in using
    the `az` client from our Kali Linux by running `az login`; if there are no subscriptions,
    attackers can choose to log in without any subscription by adding `--no-subscriptions`,
    as shown in *Figure 3.34*:'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 成功安装 `azure-cli` 后，我们应该能够通过运行 `az login` 在 Kali Linux 中使用 `az` 客户端登录；如果没有订阅，攻击者可以通过添加
    `--no-subscriptions` 来选择在没有订阅的情况下登录，如 *图 3.34* 所示：
- en: '![](../Images/B17765_03_34.png)'
  id: totrans-392
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_03_34.png)'
- en: 'Figure 3.34: Logging in to a Microsoft 365 Azure account'
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.34：登录 Microsoft 365 Azure 账户
- en: 'Once logged in with a Microsoft 365 account, you should be able to successfully
    receive the cloud details; if the account has subscriptions, they will be displayed
    as shown in *Figure 3.35*:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦使用 Microsoft 365 账户登录，您应该能够成功接收云详情；如果该账户有订阅，它们将显示在 *图 3.35* 中：
- en: '![A screenshot of a computer  Description automatically generated with medium
    confidence](../Images/B17765_03_35.png)'
  id: totrans-395
  prefs: []
  type: TYPE_IMG
  zh: '![计算机截图，描述已自动生成，信心中等](../Images/B17765_03_35.png)'
- en: 'Figure 3.35: Portal details of the Azure that the user is authorized to view'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.35：用户有权查看的 Azure 门户详情
- en: '*Table 3.7* provides some of the useful commands that come in handy during
    the enumeration of Microsoft Azure cloud services:'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: '*表 3.7* 提供了一些在枚举 Microsoft Azure 云服务时非常有用的命令：'
- en: '| **Command** | **Example** | **Description** |'
  id: totrans-398
  prefs: []
  type: TYPE_TB
  zh: '| **命令** | **示例** | **描述** |'
- en: '| `az ad user list` | `az ad user list --output=table --query=''[].{Created:createdDateTime,UPN:userPrincipalName,Name:displayName,Title:jobTitle,Department:department,Email:mail,UserId:mailNickname,Phone:telephoneNumber,Mobile:mobile,Enabled:accountEnabled}''``az
    ad user list --output=json --query=''[].{Created:createdDateTime,UPN:userPrincipalName,Name:displayName,Title:jobTitle,Department:department,Email:mail,UserId:mailNickname,Phone:telephoneNumber,Mobile:mobile,Enabled:accountEnabled}''
    --upn=''<upn>''` | This command will provide a list of all users who are connected
    to this Azure AD |'
  id: totrans-399
  prefs: []
  type: TYPE_TB
  zh: '| `az ad user list` | `az ad user list --output=table --query=''[].{Created:createdDateTime,UPN:userPrincipalName,Name:displayName,Title:jobTitle,Department:department,Email:mail,UserId:mailNickname,Phone:telephoneNumber,Mobile:mobile,Enabled:accountEnabled}''``az
    ad user list --output=json --query=''[].{Created:createdDateTime,UPN:userPrincipalName,Name:displayName,Title:jobTitle,Department:department,Email:mail,UserId:mailNickname,Phone:telephoneNumber,Mobile:mobile,Enabled:accountEnabled}''
    --upn=''<upn>''` | 该命令将提供所有连接到此 Azure AD 的用户列表 |'
- en: '| `az ad group list` | `az ad group list --output=json --query=''[].{Group:displayName,Description:description}''`
    | This will provide a full list of groups associated with the tenant |'
  id: totrans-400
  prefs: []
  type: TYPE_TB
  zh: '| `az ad group list` | `az ad group list --output=json --query=''[].{Group:displayName,Description:description}''`
    | 该命令将提供与租户关联的所有组的完整列表 |'
- en: '| `az ad group member list` | `az ad group member list --output=json --query=''[].{Created:createdDateTime,UPN:userPrincipalName,Name:displayName,Title:jobTitle,Department:department,Email:mail,UserId:mailNickname,Phone:telephoneNumber,Mobile:mobile,Enabled:accountEnabled}''
    --group=''<group name>''` | This will provide a full list of members in a given
    group |'
  id: totrans-401
  prefs: []
  type: TYPE_TB
  zh: '| `az ad group member list` | `az ad group member list --output=json --query=''[].{Created:createdDateTime,UPN:userPrincipalName,Name:displayName,Title:jobTitle,Department:department,Email:mail,UserId:mailNickname,Phone:telephoneNumber,Mobile:mobile,Enabled:accountEnabled}''
    --group=''<group name>''` | 该命令将提供指定组的完整成员列表 |'
- en: '| `az ad app list` | `az ad app list --output=table --query=''[].{Name:displayName,URL:homepage}''``az
    ad app list --output=json --identifier-uri=''<uri>''` | This will provide us with
    a list of applications that are available within the Azure AD |'
  id: totrans-402
  prefs: []
  type: TYPE_TB
  zh: '| `az ad app list` | `az ad app list --output=table --query=''[].{Name:displayName,URL:homepage}''``az
    ad app list --output=json --identifier-uri=''<uri>''` | 该命令将提供我们在 Azure AD 中可用的应用程序列表
    |'
- en: '| `az ad sp list` | `az ad sp list --output=table --query=''[].{Name:displayName,Enabled:accountEnabled,URL:homepage,Publisher:publisherName,MetadataURL:samlMetadataUrl}''`
    | This will provide us with the service principal account details |'
  id: totrans-403
  prefs: []
  type: TYPE_TB
  zh: '| `az ad sp list` | `az ad sp list --output=table --query=''[].{Name:displayName,Enabled:accountEnabled,URL:homepage,Publisher:publisherName,MetadataURL:samlMetadataUrl}''`
    | 这将提供我们服务主体账户的详细信息 |'
- en: 'Table 3.7: Commands to be used in the enumeration of Microsoft Azure cloud
    services'
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 表 3.7：用于枚举 Microsoft Azure 云服务的命令
- en: Using comprehensive tools (Legion)
  id: totrans-405
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用综合工具（Legion）
- en: 'The former security tool Sparta is no longer available in the latest version
    of Kali, but it has been complemented by another comprehensive tool called Legion,
    which is the same fork as Sparta. This tool can help to speed up the penetration
    tester’s goal of compromising a system that combines multiple tools, such as Nmap,
    and several other scripts and tools. This is a semi-automated tool that can be
    very handy when attackers wish to perform focused information gathering, based
    on the ports and services:'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 以前的安全工具 Sparta 在 Kali 的最新版本中已不可用，但它被另一个名为 Legion 的综合工具所取代，后者与 Sparta 是同一个分支。这个工具可以帮助渗透测试人员加速实现系统攻破的目标，它结合了多个工具，如
    Nmap 和其他几个脚本与工具。它是一个半自动化工具，非常适合攻击者在进行基于端口和服务的集中信息收集时使用：
- en: '`Hosts`: This will list down all the targets that are set by the pentesters'
  id: totrans-407
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`主机`: 这将列出渗透测试人员设置的所有目标'
- en: '`Services`: This is a list of services that need to be run during the automatic
    run; for example, if you configure to run Nmap and when port `80` is identified,
    it will automatically take the screenshot'
  id: totrans-408
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`服务`: 这是在自动运行过程中需要运行的服务列表；例如，如果配置为运行 Nmap，并且识别到端口 `80`，它将自动截图'
- en: '`Tools`: This will include all the tools that were run on a specific port,
    along with its relevant output'
  id: totrans-409
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`工具`: 这将包括在特定端口上运行的所有工具及其相关输出'
- en: '*Figure 3.36* shows Legion in action against a local subnet. By default, Legion
    performs an `nmap` full port scan, and also runs the respective Nmap scripts based
    on the services identified on the port and takes a screenshot, where possible:'
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3.36* 显示了 Legion 在对本地子网执行操作时的表现。默认情况下，Legion 执行 `nmap` 完整端口扫描，并根据端口上识别的服务运行相应的
    Nmap 脚本，并尽可能截图：'
- en: '![Graphical user interface, text  Description automatically generated](../Images/B17765_03_36.png)'
  id: totrans-411
  prefs: []
  type: TYPE_IMG
  zh: '![图形用户界面，文本描述自动生成](../Images/B17765_03_36.png)'
- en: 'Figure 3.36: Port scanning output in Legion'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.36：Legion 中的端口扫描输出
- en: Using machine learning for reconnaissance
  id: totrans-413
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用机器学习进行侦察
- en: Machine learning has become a vital technology in cybersecurity. It is the art
    of using data and algorithms to imitate the way we learn as humans. Machine learning
    is a branch of artificial intelligence. In this section, we will explore the GyoiThon
    tool, which you can leverage during large-scale pentesting or red team activities.
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习已成为网络安全中的关键技术。它是使用数据和算法模仿人类学习方式的艺术。机器学习是人工智能的一个分支。在本节中，我们将探讨 GyoiThon 工具，你可以在大规模渗透测试或红队活动中利用它。
- en: 'There are four types of machine learning algorithms:'
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 机器学习算法有四种类型：
- en: 'Supervised: These learning algorithms are provided with a set of known data
    (labeled) that includes the desired output. The goal of this type of learning
    is for the algorithm to achieve a high level of accuracy by learning from patterns
    in the data to make predictions.'
  id: totrans-416
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有监督：这些学习算法提供了一组已知的数据（带标签），其中包括期望的输出。这种学习的目标是使算法通过学习数据中的模式，从而实现高准确度并进行预测。
- en: 'Unsupervised: These learning algorithms are trained with unlabeled data or
    datasets that do not include the desired output. The algorithm tries to interpret
    and organize the datasets.'
  id: totrans-417
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无监督：这些学习算法在没有标签的数据或不包含期望输出的数据集上进行训练。算法尝试解释和组织数据集。
- en: 'Semi-supervised: This is a mix of the preceding types.'
  id: totrans-418
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 半监督：这是前述几种类型的混合形式。
- en: 'Reinforcement learning: These algorithms are based on regimented learning processes,
    where the algorithm is provided with a clear set of actions, factors, and desired
    outcomes. Most of the time, it is a trial-and-error method to explore different
    possibilities and options to determine which is best.'
  id: totrans-419
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 强化学习：这些算法基于有规律的学习过程，其中算法提供一组明确的动作、因素和期望结果。大多数时候，这是一种通过试错法探索不同可能性和选项，以确定哪种方法最优。
- en: 'GyoiThon by gyoisamurai is a pentest tool based on the Naïve Bayes (supervised)
    deep learning method (deep learning is a subset of machine learning) and is written
    in Python 3\. It includes a software analysis engine, vulnerability identification
    engine, and report generation engine. To install the GyoiThon on our Kali Linux
    machine, run the following commands in the terminal:'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: GyoiThon由gyoisamurai开发，是一个基于朴素贝叶斯（监督）深度学习方法（深度学习是机器学习的一个子集）的渗透测试工具，使用Python
    3编写。它包括一个软件分析引擎、漏洞识别引擎和报告生成引擎。要在Kali Linux机器上安装GyoiThon，请在终端中运行以下命令：
- en: '[PRE21]'
  id: totrans-421
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Once the requirements are installed, run `sudo python3 gyoithon.py -h` from
    the terminal, you should see all the options, as seen in *Figure 3.37*:'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完要求后，使用终端运行`sudo python3 gyoithon.py -h`，你应该能够看到所有选项，如*图 3.37*所示：
- en: '![Text  Description automatically generated](../Images/B17765_03_37.png)'
  id: totrans-423
  prefs: []
  type: TYPE_IMG
  zh: '![文本描述自动生成](../Images/B17765_03_37.png)'
- en: 'Figure 3.37: Successfully running the GyoiThon tool'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.37：成功运行GyoiThon工具
- en: 'Before beginning the reconnaissance activity, you can edit the configuration
    file `config.ini` and enter the proxy details (if any), such as Censys and DomainTools
    API details. All the target information can be entered in the `host.txt` file,
    which is located in the same folder where the tool was cloned. The format to enter
    the target details is protocol (`http` or `https`), domain (`cyberhia.com`), port
    (`80` or `443`), and the root (`/` or `/admin/`). An example of using `host.txt`
    to perform reconnaissance on `cyberhia.com` is:'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始侦察活动之前，你可以编辑配置文件`config.ini`并输入代理详细信息（如果有），例如Censys和DomainTools的API信息。所有目标信息可以输入到`host.txt`文件中，该文件位于工具克隆的同一文件夹中。输入目标详细信息的格式为：协议（`http`或`https`）、域名（`cyberhia.com`）、端口（`80`或`443`）、根路径（`/`或`/admin/`）。使用`host.txt`对`cyberhia.com`进行侦察的示例如下：
- en: '[PRE22]'
  id: totrans-426
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Finally, you can run `sudo python3 gyoithon.py` from the terminal. The software
    engine within the tool should be able to grab the banner using normal web access
    using the deep learning base and signature. *Figure 3.38* shows a successful reconnaissance
    output on the target:'
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你可以在终端中运行`sudo python3 gyoithon.py`。工具中的软件引擎应该能够使用深度学习基础和签名通过正常的Web访问抓取横幅。*图
    3.38*显示了对目标的成功侦察输出：
- en: '![Text  Description automatically generated](../Images/B17765_03_38.png)'
  id: totrans-428
  prefs: []
  type: TYPE_IMG
  zh: '![文本描述自动生成](../Images/B17765_03_38.png)'
- en: 'Figure 3.38: Performing reconnaissance using GyoiThon'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3.38：使用GyoiThon进行侦察
- en: 'Other features you can leverage with this tool include:'
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以利用此工具的其他功能包括：
- en: Scanning for cloud services and exploring relevant (**Fully Qualified Domain
    Names (FQDNs**))
  id: totrans-431
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描云服务并探索相关的（**完全合格域名（FQDN）**）
- en: Performing custom Google searches and exploring the default paths based on the
    product version
  id: totrans-432
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行自定义Google搜索并基于产品版本探索默认路径
- en: Performing port scanning on targets
  id: totrans-433
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对目标进行端口扫描
- en: Executing the exploit module using Metasploit
  id: totrans-434
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Metasploit执行漏洞模块
- en: As it’s a supervised learning algorithm, you should be able to determine the
    input and output with the data fed into the algorithm. In this case, every time
    the scan is performed, the data will be labeled and the algorithm trained, which
    will reduce false positives significantly. For example, if the target has hundreds
    of domains, this can be very handy to automate the server banner grabbing and
    list all the vulnerabilities using the vulnerability detection engine to prepare
    for the exploitation.
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 由于它是一个监督学习算法，你应该能够根据输入到算法中的数据来确定输入和输出。在这种情况下，每次扫描执行时，数据将被标记，并且算法会进行训练，这将显著减少误报。例如，如果目标有数百个域名，这对于自动化服务器横幅抓取并使用漏洞检测引擎列出所有漏洞以准备利用非常有用。
- en: Summary
  id: totrans-436
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: Attackers might face a very real chance of their activities being identified,
    which puts them at risk of exposure to a target. However, we have now seen the
    different techniques that can be employed during active reconnaissance to mitigate
    such a risk. Attackers must ensure that there is a balance against the need to
    map a network, find open ports and services, and determine the operating system
    and applications that are installed.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可能面临其活动被识别的实际风险，这使他们面临暴露于目标的风险。然而，我们现在已经看到了在主动侦察过程中可以采用的不同技术，以减少这种风险。攻击者必须确保在需要绘制网络图、寻找开放端口和服务，以及确定安装的操作系统和应用程序之间保持平衡。
- en: The real challenge for attackers is to adopt stealthy scanning techniques to
    reduce the risk of triggering an alert.
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者面临的真正挑战是采用隐蔽的扫描技术，以降低触发警报的风险。
- en: Manual approaches are normally used to create slow scans; however, this approach
    may not always be effective. Therefore, attackers take advantage of tools such
    as the Tor network and various proxy applications to hide their identities.
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 手动方法通常用于创建缓慢的扫描；然而，这种方法并不总是有效。因此，攻击者利用像Tor网络和各种代理应用程序这样的工具来隐藏他们的身份。
- en: Additionally, we explored how to perform reconnaissance using machine learning
    using the GyoiThon tool, which can significantly reduce your manual efforts.
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们还探讨了如何使用GyoiThon工具通过机器学习执行侦察，这可以显著减少你的手动工作量。
- en: In the next chapter, we will explore more techniques and procedures that aid
    in vulnerability assessments, and how to utilize the scanners to identify the
    vulnerabilities that can be utilized as the potential candidates for the exploitation
    to move forward in achieving the objective.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨更多有助于漏洞评估的技术和流程，以及如何利用扫描器识别可作为潜在攻击目标的漏洞，以便推动目标的实现。
