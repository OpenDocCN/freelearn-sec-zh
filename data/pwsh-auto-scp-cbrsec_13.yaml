- en: '13'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '13'
- en: What Else? – Further Mitigations and Resources
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有什么？——更多的缓解措施和资源
- en: In this book, we have looked at many topics and techniques that help you mitigate
    risks in your environment when it comes to PowerShell. But of course, there are
    many more things that you can do to secure your environment – many directly related
    to PowerShell, but also others that are not directly related but help you secure
    PowerShell.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们已经探讨了许多有助于在PowerShell环境中减少风险的主题和技术。但当然，你可以做更多事情来保障环境安全——许多直接与PowerShell相关，也有一些与PowerShell不直接相关但有助于提高PowerShell安全性。
- en: 'In this chapter, we won’t deep dive into every mitigation; instead, I will
    provide an overview of what other mitigations exist so that you can explore each
    on your own. We will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们不会深入讨论每个缓解措施；相反，我将概述其他缓解措施，以便你可以自行探索每一个。我们将涵盖以下主题：
- en: Secure scripting
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全脚本编写
- en: Exploring Desired State Configuration
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索期望的状态配置
- en: Hardening systems and environment
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 强化系统和环境
- en: Attack detection – Endpoint Detection and Response
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击检测 – 端点检测与响应
- en: Technical requirements
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To make the most out of this chapter, ensure that you have the following:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 为了充分利用本章内容，确保你具备以下条件：
- en: PowerShell 7.3 and above
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PowerShell 7.3及以上版本
- en: Installed Visual Studio Code
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 已安装Visual Studio Code
- en: 'Access to the GitHub repository for this chapter: [https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/tree/master/Chapter13](https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/tree/master/Chapter13)'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本章的GitHub仓库访问链接：[https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/tree/master/Chapter13](https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/tree/master/Chapter13)
- en: Secure scripting
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安全脚本编写
- en: If you are leveraging self-written scripts in your environment, secure scripting
    is indispensable. If your scripts can be manipulated, it doesn’t matter (most
    of the time) what other security mechanisms you have implemented.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在环境中使用自编写的脚本，安全脚本编写是不可或缺的。如果你的脚本可以被篡改，那么无论你实施了什么其他安全机制（大多数情况下）都没有意义。
- en: 'Be aware that your scripts can be hacked, and malicious code can be injected.
    In these cases, you must do the following:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，你的脚本可能会被黑客攻击，恶意代码可能会被注入。在这种情况下，你必须执行以下操作：
- en: Always validate input
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 始终验证输入
- en: Have your code reviewed when developing scripts
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发脚本时进行代码审查
- en: Secure the script’s location and access
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保脚本的存储位置和访问权限安全
- en: 'Adopt a secure coding standard, such as the *OWASP Secure Coding Practices
    – Quick Reference* *Guide*: [https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/](https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 采用安全编码标准，例如*OWASP安全编码实践 – 快速参考* *指南*：[https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/](https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/)
- en: )
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: Additionally, two neat PowerShell modules come in handy when developing your
    own PowerShell scripts that you should know about – **PSScriptAnalyzer** and **InjectionHunter**.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有两个非常实用的PowerShell模块，当你开发自己的PowerShell脚本时应该了解它们——**PSScriptAnalyzer**和**InjectionHunter**。
- en: PSScriptAnalyzer
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: PSScriptAnalyzer
- en: '**PSScriptAnalyzer** is a tool that statically checks code for PowerShell scripts
    and modules. It checks against predefined rules and returns all findings, along
    with recommendations on how to improve your potential code defects.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**PSScriptAnalyzer**是一个静态检查PowerShell脚本和模块代码的工具。它会根据预定义的规则进行检查，并返回所有问题以及如何改进潜在代码缺陷的建议。'
- en: Using **PSScriptAnalyzer** to verify your code helps you to maintain higher
    code quality and avoid common issues. It is not necessarily a tool to check the
    security of your code (although it provides security checks such as **Avoid using
    Invoke-Expression**), but a tool to check whether you applied PowerShell best
    practices.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**PSScriptAnalyzer**验证代码有助于保持较高的代码质量，避免常见问题。它不一定是用来检查代码安全性的工具（尽管它提供了一些安全检查，如**避免使用Invoke-Expression**），但它是一个检查你是否应用了PowerShell最佳实践的工具。
- en: It can be installed from PowerShell Gallery using **Install-Module PSScriptAnalyzer**.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过PowerShell Gallery使用**Install-Module PSScriptAnalyzer**进行安装。
- en: Once installed, it provides the **Get-ScriptAnalyzerRule**, **Invoke-Formatter**,
    and **Invoke-ScriptAnalyzer** cmdlets.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 安装后，它提供了**Get-ScriptAnalyzerRule**、**Invoke-Formatter**和**Invoke-ScriptAnalyzer**
    cmdlet。
- en: For our use case, we will only look into **Invoke-ScriptAnalyzer**, but make
    sure you check out the entire module on your own to improve your PowerShell scripts
    and modules.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的使用案例，我们将只关注**Invoke-ScriptAnalyzer**，但请确保你自己查看整个模块，以提升你的 PowerShell 脚本和模块。
- en: 'Use **Invoke-ScriptAnalyzer**, followed by **-Path** and the path to the script,
    to have your code checked, as shown in the following screenshot:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**Invoke-ScriptAnalyzer**，然后使用**-Path**和脚本路径，来检查你的代码，如下截图所示：
- en: '![Figure 13.1 – Invoking ScriptAnalyzer](image/B16679_13_001.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.1 – 调用 ScriptAnalyzer](image/B16679_13_001.jpg)'
- en: Figure 13.1 – Invoking ScriptAnalyzer
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.1 – 调用 ScriptAnalyzer
- en: When nothing else is specified, **PSScriptAnalyzer** checks against its own
    set of rules. But you can also specify your own custom rules by using the **-CustomRulePath**
    and **-****RecurseCustomRulePath** parameters.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 当没有指定其他内容时，**PSScriptAnalyzer**会根据其自身的规则集进行检查。但你也可以通过使用**-CustomRulePath**和**-RecurseCustomRulePath**参数来指定你自己的自定义规则。
- en: If you’re using Visual Studio Code with the *PowerShell* extension to write
    PowerShell scripts, **PSScriptAnalyzer** is enabled by default. Here, your code
    will be automatically checked and you will be provided with warnings for any potential
    issues while writing your code.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在 Visual Studio Code 中使用*PowerShell*扩展来编写 PowerShell 脚本，**PSScriptAnalyzer**会默认启用。在这种情况下，你的代码会被自动检查，并且在编写代码时会提供任何潜在问题的警告。
- en: InjectionHunter
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: InjectionHunter
- en: '**InjectionHunter** is a module, written by Lee Holmes, that helps you detect
    ways to inject code into your very own PowerShell script. It can be downloaded
    from **PowerShell** **Gallery**: [https://www.powershellgallery.com/packages/InjectionHunter/1.0.0](https://www.powershellgallery.com/packages/InjectionHunter/1.0.0
    )'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**InjectionHunter**是由 Lee Holmes 编写的一个模块，它帮助你检测如何将代码注入到你自己的 PowerShell 脚本中。可以从**PowerShell**
    **Gallery**下载：[https://www.powershellgallery.com/packages/InjectionHunter/1.0.0](https://www.powershellgallery.com/packages/InjectionHunter/1.0.0)'
- en: Install it by using **Install-Module InjectionHunter**.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**Install-Module InjectionHunter**命令安装它。
- en: '**InjectionHunter** relies on **ScriptAnalyzer.Generic.DiagnosticRecord** as
    its output type and uses custom detection rules, so **PSScriptAnalyzer** also
    needs to be installed.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '**InjectionHunter**依赖于**ScriptAnalyzer.Generic.DiagnosticRecord**作为其输出类型，并使用自定义的检测规则，因此也需要安装**PSScriptAnalyzer**。'
- en: '**InjectionHunter** comes with eight different functions, all of which can
    help you find out whether your code is vulnerable to various scenarios. These
    are **Measure-AddType**, **Measure-CommandInjection**, **Measure-DangerousMethod**,
    **Measure-ForeachObjectInjection**, **Measure-InvokeExpression**, **Measure-MethodInjection**,
    **Measure-PropertyInjection**, and **Measure-UnsafeEscaping**.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**InjectionHunter**包含八个不同的函数，所有这些函数都可以帮助你找出代码是否容易受到各种攻击的影响。这些函数包括**Measure-AddType**、**Measure-CommandInjection**、**Measure-DangerousMethod**、**Measure-ForeachObjectInjection**、**Measure-InvokeExpression**、**Measure-MethodInjection**、**Measure-PropertyInjection**和**Measure-UnsafeEscaping**。'
- en: The **InjectionHunter** functions are used to create a new **PSScriptAnalyzer**
    plugin that can detect potential injection attacks in PowerShell scripts. These
    functions are designed to accept **-ScriptBlockAst** as a parameter, which represents
    the **Abstract Syntax Tree** (**AST**) of the script. The AST groups tokens into
    structures and is a deliberate way to parse and analyze data with PowerShell.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**InjectionHunter**的函数用于创建一个新的**PSScriptAnalyzer**插件，能够检测 PowerShell 脚本中潜在的注入攻击。这些函数设计为接受**-ScriptBlockAst**参数，它代表脚本的**抽象语法树**（**AST**）。AST将标记分组为结构，是解析和分析
    PowerShell 数据的有意方式。'
- en: 'The following example demonstrates how to use **PSScriptAnalyzer** to call
    the **InjectionHunter** rules:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例演示了如何使用**PSScriptAnalyzer**调用**InjectionHunter**规则：
- en: '[PRE0]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The following screenshot shows what it looks like to call **InjectionHunter**
    rules from **PSScriptAnalyzer**:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了从**PSScriptAnalyzer**调用**InjectionHunter**规则的界面：
- en: '![Figure 13.2 – Calling the InjectionHunter rules from PSScriptAnalyzer](image/B16679_13_002.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.2 – 从 PSScriptAnalyzer 调用 InjectionHunter 规则](image/B16679_13_002.jpg)'
- en: Figure 13.2 – Calling the InjectionHunter rules from PSScriptAnalyzer
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.2 – 从 PSScriptAnalyzer 调用 InjectionHunter 规则
- en: '**InjectionHunter** was not intended for direct use in analyzing scripts. However,
    you can use its functions to develop a custom **PSScriptAnalyzer** plugin that
    can detect injection attacks in your PowerShell scripts.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '**InjectionHunter**并不是用于直接分析脚本的。然而，你可以利用它的功能开发一个自定义的**PSScriptAnalyzer**插件，用于检测你
    PowerShell 脚本中的注入攻击。'
- en: 'But wouldn’t it be cool to immediately know whether you were implementing a
    potential injection risk while writing your scripts? Lee Holmes and the PowerShell
    team have you covered. The following blog article explains how this can be achieved
    when using Visual Studio Code to edit scripts: [https://devblogs.microsoft.com/powershell/powershell-injection-hunter-security-auditing-for-powershell-scripts/](https://devblogs.microsoft.com/powershell/powershell-injection-hunter-security-auditing-for-powershell-scripts/).'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，如果你在编写脚本时能立即知道是否存在潜在的注入风险，那该多酷？Lee Holmes和PowerShell团队为你提供了解决方案。以下博客文章解释了如何在使用Visual
    Studio Code编辑脚本时实现这一点：[https://devblogs.microsoft.com/powershell/powershell-injection-hunter-security-auditing-for-powershell-scripts/](https://devblogs.microsoft.com/powershell/powershell-injection-hunter-security-auditing-for-powershell-scripts/)。
- en: Exploring Desired State Configuration
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索所需状态配置
- en: PowerShell **Desired State Configuration** (**DSC**) is a feature that enables
    you to manage your servers using PowerShell configuration as code.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell **所需状态配置**（**DSC**）是一个功能，允许你使用PowerShell配置作为代码来管理服务器。
- en: 'At the time of writing, the following versions of DSC are available that you
    can use for deployment: **DSC 1.1**, **DSC 2.0**, and **DSC 3.0**.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 截至目前，以下版本的DSC可用于部署：**DSC 1.1**、**DSC 2.0**和**DSC 3.0**。
- en: While DSC 1.1 was included in Windows PowerShell 5.1, in DSC 2.0, which must
    run DSC on PowerShell 7.2 and above, **PSDesiredStateConfiguration** is no longer
    included in the PowerShell package. This enables the DSC creators to develop DSC
    independently of PowerShell and enables users to upgrade DSC without the need
    to upgrade PowerShell as well.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然DSC 1.1包含在Windows PowerShell 5.1中，但在DSC 2.0中，必须在PowerShell 7.2及以上版本上运行DSC，**PSDesiredStateConfiguration**不再包含在PowerShell包中。这使得DSC的创建者能够独立于PowerShell开发DSC，并允许用户升级DSC而无需同时升级PowerShell。
- en: '**DSC 1.1**'
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**DSC 1.1**'
- en: DSC 1.1 is included in Windows and updated through Windows Management Framework.
    It runs in Windows PowerShell 5.1\. This is the go-to version if Azure Automanage
    Machine Configuration is not in use.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: DSC 1.1包含在Windows中，并通过Windows管理框架进行更新。它运行在Windows PowerShell 5.1中。如果没有使用Azure
    Automanage Machine Configuration，这是推荐的版本。
- en: Remediation
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复
- en: 'DSC 1.1 has two configuration modes:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: DSC 1.1有两种配置模式：
- en: '**Push**: The configuration is pushed manually'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**推送**：配置手动推送'
- en: '**Pull**: The nodes are configured to pull their configuration frequently from
    the pull server'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**拉取**：节点被配置为从拉取服务器频繁拉取其配置'
- en: One huge advance of DSC in pull mode is that your configuration, once specified,
    is self-healing. This means you configure your nodes using code and set up your
    configuration. Once activated, you can configure your configuration so that it’s
    frequently pulled from your nodes. This means that if someone were to change the
    local configuration of a server or endpoint configured with DSC, the configuration
    would be changed back after the next pull.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: DSC在拉取模式中的一个巨大进步是，一旦指定了配置，配置会自我修复。这意味着你可以使用代码配置节点并设置配置。一旦激活，你可以配置你的配置，使其频繁地从节点中拉取。这意味着，如果有人更改了配置了DSC的服务器或终端的本地配置，下一次拉取时配置会被恢复。
- en: Pull mode is a more complex configuration, but in the end, it is easier to maintain
    and helps you keep your devices more secure than using push mode. When using this
    mode, systems remediate themselves.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 拉取模式是一种更复杂的配置方式，但最终它比推送模式更易于维护，并且有助于提升设备安全性。在使用此模式时，系统会自动进行修复。
- en: If you’re interested in using DSC for central administration, it’s worth noting
    that signed configurations make DSC an even more secure form of remote policy
    management. Signed configurations ensure that only authorized changes are applied
    to a system. Without a valid signature, a configuration cannot be applied.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有兴趣使用DSC进行集中管理，需要注意的是，签名配置使得DSC成为一种更加安全的远程策略管理方式。签名配置确保只有授权的更改才能应用到系统中。没有有效签名的配置无法被应用。
- en: This can be particularly valuable in protecting against attacks that compromise
    central management channels, such as GPO. With signed configurations in DSC and
    tight control over your signing infrastructure, attackers cannot use compromised
    channels to deliver ransomware company-wide, for example.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这在保护免受攻击特别有价值，尤其是那些危及中央管理通道的攻击，比如GPO。通过DSC中的签名配置和对签名基础设施的严格控制，攻击者无法利用被攻破的通道进行大规模的勒索软件传播。
- en: 'You can learn more about the DSC module and configuration signing by visiting
    the following documentation page: [https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/wmf/whats-new/dsc-improvements?#dsc-module-and-configuration-signing-validations](https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/wmf/whats-new/dsc-improvements?#dsc-module-and-configuration-signing-validations).'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过访问以下文档页面了解更多关于DSC模块和配置签名的信息：[https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/wmf/whats-new/dsc-improvements?#dsc-module-and-configuration-signing-validations](https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/wmf/whats-new/dsc-improvements?#dsc-module-and-configuration-signing-validations)。
- en: 'DSC is quite extensive, but there’s a lot of documentation, including quick
    starts and tutorials, that can help you get started: [https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-1.1](https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-1.1).'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: DSC内容非常广泛，但有很多文档，包括快速入门和教程，可以帮助你开始使用：[https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-1.1](https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-1.1)。
- en: '**DSC 2.0**'
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**DSC 2.0**'
- en: DSC 2.0 is supported for PowerShell 7.2 and above. While the original DSC platform
    was built on top of WMI for Windows, newer versions were decoupled from that model.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: DSC 2.0支持PowerShell 7.2及以上版本。虽然原始的DSC平台是建立在WMI之上，但较新版本已经脱离了这个模型。
- en: 'It can be deployed using PSGallery by running the following command:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过运行以下命令使用PSGallery进行部署：
- en: '[PRE1]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: DSC version 2.0 should only be used if Azure Automanage Machine Configuration
    is in use. Although the **Invoke-DscResource** cmdlet is still available with
    this version, you should only use it for testing purposes and rely on Azure Automanage
    Machine Configuration instead.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 只有在使用Azure Automanage机器配置时，才能使用DSC 2.0版本。尽管**Invoke-DscResource** cmdlet在此版本中仍然可用，但你应该仅用于测试目的，而应依赖于Azure
    Automanage机器配置。
- en: Remediation
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 修复
- en: Thanks to Azure Automanage Machine Configuration, you don’t need to set up a
    pull server as you must with DSC 1.1 since Azure Automanage Machine Configuration
    deals with this responsibility for you.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 由于Azure Automanage机器配置的帮助，你不需要像DSC 1.1那样设置拉取服务器，因为Azure Automanage机器配置会为你处理这个责任。
- en: 'There are three different machine configuration assignment types that you can
    choose from:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 有三种不同的机器配置分配类型可供选择：
- en: '**Audit**: Only report; don’t change anything.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Audit**: 仅报告；不做任何更改。'
- en: '**ApplyAndMonitor**: Apply the configuration once, but if the configuration
    is changed, only report and don’t remediate until it’s triggered manually.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ApplyAndMonitor**: 一次性应用配置，但如果配置发生更改，则仅报告，不进行修复，直到手动触发。'
- en: '**ApplyAndAutoCorrect**: Apply the configuration permanently. Once a change
    is made, the machine remediates at the next evaluation.'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ApplyAndAutoCorrect**: 永久应用配置。一旦做出更改，机器将在下次评估时进行修复。'
- en: '**ApplyAndAutoCorrect** is a great option that is similar to the pull configuration
    mode in DSC 1.1; it helps your systems become more secure as they remediate changes
    by themselves.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '**ApplyAndAutoCorrect**是一个很好的选项，类似于DSC 1.1中的拉取配置模式；它帮助你的系统变得更安全，因为它们可以自我修复更改。'
- en: 'Check out the following link to learn more about DSC 2.0: [https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-2.0](https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-2.0)**.**'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 请查看以下链接了解更多关于DSC 2.0的信息：[https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-2.0](https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-2.0)**。**
- en: '**DSC 3.0**'
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**DSC 3.0**'
- en: DSC 3.0 is a preview release that is still under development as of April 2023.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: DSC 3.0是一个预览版本，截至2023年4月仍在开发中。
- en: 'This version supports cross-platform features and is supported by Azure Automanage
    Machine Configuration in Azure Policy. It can be installed with PSGallery by using
    the following command:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 该版本支持跨平台特性，并且由Azure Automanage机器配置在Azure策略中支持。可以通过使用以下命令从PSGallery安装：
- en: '[PRE2]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: For DSC 3.0, the remediation options are the same as for DSC 2.0.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 对于DSC 3.0，修复选项与DSC 2.0相同。
- en: 'You can find out more about DSC 3.0 by reading the official documentation:
    [https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-3.0](https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-3.0).'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 通过阅读官方文档，你可以了解更多关于DSC 3.0的信息：[https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-3.0](https://learn.microsoft.com/en-us/powershell/dsc/overview?view=dsc-3.0)。
- en: Configuration
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置
- en: To get started with DSC, you need a DSC configuration, which you can compile
    into a **.mof** file. Often, you will want to cover a scenario that has already
    been predefined as a resource and tweak it to your use case; in this case, you
    also want to include a predefined resource in your configuration.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用 DSC，你需要一个 DSC 配置，并将其编译成 **.mof** 文件。通常，你会想要覆盖一个已经预定义为资源的场景，并根据你的用例对其进行调整；在这种情况下，你还希望在配置中包含一个预定义的资源。
- en: DSC resources
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: DSC 资源
- en: 'Before creating your own DSC resources, always check whether there is already
    a resource that fits your use case; there’s a multitude of existing resources
    that you can find on GitHub or PowerShell Gallery. Once you have found the right
    DSC resource for your use case, you can install it using **PowerShellGet**:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建自己的 DSC 资源之前，始终检查是否已经有适合你用例的资源；在 GitHub 或 PowerShell Gallery 上有大量现成的资源可供使用。一旦找到适合你用例的
    DSC 资源，你可以使用 **PowerShellGet** 安装它：
- en: '**> Install-Module -****Name AuditPolicyDSC**'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '**> Install-Module -****Name AuditPolicyDSC**'
- en: In this example, the **AuditPolicyDSC** resource would be installed, which helps
    you configure and manage the advanced audit policy on Windows machines.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，**AuditPolicyDSC** 资源将被安装，它帮助你在 Windows 机器上配置和管理高级审核策略。
- en: 'The following example shows a configuration that imports the **AuditPolicyDsc**
    resource and then uses it to ensure that all successful logons are being audited
    on the host, on which this configuration will be applied, via the equivalent advanced
    audit policy setting:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例展示了一个配置，它导入 **AuditPolicyDsc** 资源，并使用它确保所有成功的登录事件都在将应用此配置的主机上进行审核，通过相应的高级审核策略设置：
- en: '[PRE3]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We must save this code in a file named **AuditLogon.ps1** under **C:\temp\**
    to dot source it:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须将此代码保存为名为 **AuditLogon.ps1** 的文件，并将其存放在 **C:\temp\** 目录下以便 dot 来源：
- en: '[PRE4]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The following screenshot shows how the file is being compiled into a **.****mof**
    file:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了该文件如何被编译成 **.****mof** 文件：
- en: '![Figure 13.3 – Compiling your DSC configuration into a .mof file](image/B16679_13_003.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.3 – 将你的 DSC 配置编译成 .mof 文件](image/B16679_13_003.jpg)'
- en: Figure 13.3 – Compiling your DSC configuration into a .mof file
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.3 – 将你的 DSC 配置编译成 .mof 文件
- en: 'Depending on the setup and the DSC version that you are running, you can now
    use this file to apply your DSC configuration to the system of your choice. Please
    refer to the official documentation for more information:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 根据你所运行的设置和 DSC 版本，现在可以使用此文件将 DSC 配置应用到你选择的系统上。更多信息请参考官方文档：
- en: 'DSC 1.1: [https://learn.microsoft.com/en-us/powershell/dsc/configurations/write-compile-apply-configuration?view=dsc-1.1](https://learn.microsoft.com/en-us/powershell/dsc/configurations/write-compile-apply-configuration?view=dsc-1.1'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'DSC 1.1: [https://learn.microsoft.com/en-us/powershell/dsc/configurations/write-compile-apply-configuration?view=dsc-1.1](https://learn.microsoft.com/en-us/powershell/dsc/configurations/write-compile-apply-configuration?view=dsc-1.1)'
- en: )
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: 'DSC 2.0: [https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-2.0](https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-2.0'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'DSC 2.0: [https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-2.0](https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-2.0)'
- en: )
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: 'DSC 3.0: [https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-3.0](https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-3.0'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'DSC 3.0: [https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-3.0](https://learn.microsoft.com/en-us/powershell/dsc/concepts/configurations?view=dsc-3.0)'
- en: )
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: Hardening systems and environments
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加强系统和环境的安全
- en: In the end, you can harden PowerShell as much as you like; if the systems on
    which PowerShell is running are not protected, adversaries will make use of that
    if they have the chance. Therefore, it is important to also look at how you can
    harden the security of your infrastructure.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 最终，你可以根据需要加强 PowerShell 的安全性；但如果运行 PowerShell 的系统没有得到保护，攻击者一旦有机会，必定会加以利用。因此，检查如何加强你的基础设施安全同样非常重要。
- en: Security baselines
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安全基线
- en: 'A great start to hardening your Windows systems – regardless of the server,
    domain controller, or client – are the so-called security baselines provided by
    Microsoft. These security baselines are part of Microsoft’s **Security Compliance
    Toolkit** (**SCT**) 1.0, which can be downloaded from here: https://www.microsoft.com/en-us/download/details.aspx?id=55319.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 加强 Windows 系统安全的一个良好开端——无论是服务器、域控制器还是客户端——就是微软提供的所谓安全基线。这些安全基线是微软 **安全合规工具包**
    (**SCT**) 1.0 的一部分，可以从这里下载：https://www.microsoft.com/en-us/download/details.aspx?id=55319。
- en: Please be careful when applying security baselines!
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在应用安全基线时请务必小心！
- en: You should never just apply a security baseline to a running production system.
    Before applying it, carefully audit your settings and evaluate them. Then, work
    on a plan to enroll your changes. Many settings are included that could break
    the functioning of your systems if they are not carefully planned for and enrolled.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 你绝不应该仅仅将安全基线应用于正在运行的生产系统。在应用之前，仔细审计你的设置并进行评估。然后，制定一个计划来实施你的更改。许多设置可能会导致系统功能中断，如果没有精心规划和实施，可能会出现问题。
- en: When you download SCT, you will see that there are many files within it that
    you can download. Most of the files are the actual baselines (most baseline packages
    end with **Security Baseline.zip**).
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 当你下载SCT时，你会看到其中有许多可以下载的文件。大多数文件实际上是基线文件（大多数基线包以**Security Baseline.zip**结尾）。
- en: But helpful tools are also included, including **LGPO**, **SetObjectSecurity**,
    and **Policy Analyzer**.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 但也包括一些有用的工具，包括**LGPO**、**SetObjectSecurity**和**Policy Analyzer**。
- en: '**LGPO**: This tool can be used to perform local Group Policy Object (GPO)
    operations. You can use this tool to import settings into a local Group Policy,
    export a local Group Policy, parse a **registry.pol** file in **LGPO text** format,
    build a **registry.pol** file from **LGPO text**, and enable Group Policy client-side
    extensions for local policy processing. Since it’s a command-line tool, LGPO can
    be used to automate local GPO operations.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**LGPO**：这个工具可以用来执行本地组策略对象（GPO）操作。你可以使用这个工具将设置导入本地组策略，导出本地组策略，解析**registry.pol**文件（**LGPO文本格式**），从**LGPO文本**构建**registry.pol**文件，并启用组策略客户端扩展进行本地策略处理。由于它是一个命令行工具，LGPO可以用来自动化本地GPO操作。'
- en: '**SetObjectSecurity**: Using **SetObjectSecurity**, you can set the security
    descriptor for any type of Windows securable object – be it files, registry hives,
    event logs, and many more.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SetObjectSecurity**：使用**SetObjectSecurity**，你可以为任何类型的Windows可安全对象设置安全描述符——无论是文件、注册表项、事件日志等等。'
- en: '**Policy Analyzer**: Policy Analyzer is a tool for comparing baselines and
    GPOs, but not only exported GPOs – you can also compare a GPO with your local
    policy. It can highlight differences between the policies, as well as help you
    spot redundancies.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Policy Analyzer**：Policy Analyzer是一个用于比较基线和GPO的工具，但不仅限于导出的GPO——你也可以将GPO与本地策略进行比较。它可以突出显示策略之间的差异，并帮助你发现冗余。'
- en: All three tools are standalone, which means that you don’t need to install them
    to use them.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 这三个工具都是独立的，这意味着你无需安装它们即可使用。
- en: You can use **PolicyAnalyzer** to check the current state of your machines.
    Download **PolicyAnalyzer** and the security baseline that you want to use to
    check your systems against. In our example, I used the *Windows Server 2022 Security
    Baseline* as my example baseline.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用**PolicyAnalyzer**检查机器的当前状态。下载**PolicyAnalyzer**和你想要使用的安全基线，用于检查你的系统。在我们的示例中，我使用了*Windows
    Server 2022 安全基线*作为示例基线。
- en: We looked into the **SCT** in [*Chapter 4*](B16679_04_Final_PD.xhtml#_idTextAnchor090),
    *Detection – Auditing and Monitoring*, when we talked about auditing recommendations
    and EventList. There, we learned that security baselines contain auditing recommendations.
    But they also contain some system settings recommendations, such as the Lan Manager
    authentication level (**LmCompatibilityLevel**), which you can use to deny insecure
    authentication mechanisms in your domain. Please be extremely careful and audit
    which authentication protocols are used before applying this setting to the recommended
    one.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[*第4章*](B16679_04_Final_PD.xhtml#_idTextAnchor090)的*检测—审计和监控*部分讨论了**SCT**，当时我们提到了审计建议和EventList。在那里，我们了解到安全基线包含审计建议。但它们还包含一些系统设置建议，如Lan
    Manager认证级别（**LmCompatibilityLevel**），你可以用它来拒绝域中的不安全认证机制。请务必小心，在应用此设置为推荐的设置之前，审计使用的认证协议。
- en: 'Before you can work with baselines, you will need to extract them. The following
    code snippet shows how you can use PowerShell to extract them:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在你开始使用基线之前，你需要先提取它们。以下代码片段展示了如何使用PowerShell提取基线：
- en: '[PRE5]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: While the **$baselineZipPath** variable leads to the path where the baseline
    ZIP file is located, the **$baselineDirPath** variable points to the folder into
    which the baselines should be extracted. If the **$baselineDirPath** folder is
    not available yet, the folder will be created. The archive can be extracted using
    the **Expand-Archive** cmdlet.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '**$baselineZipPath** 变量指向基准 ZIP 文件所在的路径，而 **$baselineDirPath** 变量指向应提取基准文件的文件夹。如果
    **$baselineDirPath** 文件夹尚不存在，将会创建该文件夹。可以使用 **Expand-Archive** cmdlet 解压归档文件。'
- en: 'After extracting a security baseline, you will find the five following folders
    in the ZIP file, as shown in the following screenshot:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 解压安全基准后，你会在 ZIP 文件中找到以下五个文件夹，如下图所示：
- en: '![Figure 13.4 – Contents of a security baseline](image/B16679_13_004.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.4 – 安全基准的内容](image/B16679_13_004.jpg)'
- en: Figure 13.4 – Contents of a security baseline
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.4 – 安全基准的内容
- en: The actual baselines reside in the **GPOs** folder. You can use the files in
    there to import the baselines for testing purposes on a test system or to add
    them to Policy Analyzer.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 实际的基准文件位于 **GPOs** 文件夹中。你可以使用其中的文件在测试系统上导入基准进行测试，或者将它们添加到策略分析器中。
- en: 'When initially executing Policy Analyzer, you will see its starting interface,
    which looks as follows:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 初次执行策略分析器时，你将看到其启动界面，如下所示：
- en: '![Figure 13.5 – Policy Analyzer](image/B16679_13_005.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.5 – 策略分析器](image/B16679_13_005.jpg)'
- en: Figure 13.5 – Policy Analyzer
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.5 – 策略分析器
- en: To get started, click on **Add …** to add a new baseline to compare. Navigate
    to the GPOs folder within the selected baseline and select it. Since many baseline
    files are included that you won’t want to add, you need to remove all the unnecessary
    ones by selecting them in the **Policy File Importer** view and removing them
    by using the *Delete* key on your keyboard.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始使用，点击 **添加...** 来添加一个新的基准进行比较。导航到所选基准的 GPOs 文件夹并选择它。由于包含了许多你不需要添加的基准文件，因此你需要通过在
    **策略文件导入器** 视图中选择它们，然后使用键盘上的 *删除* 键将它们删除。
- en: 'In this example, I want to investigate a domain controller, so I deleted every
    other baseline except for the domain controller ones, as shown in the following
    screenshot:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我想调查一个域控制器，所以我删除了除域控制器相关基准之外的所有其他基准，如下图所示：
- en: '![Figure 13.6 – Importing domain controller security baselines](image/B16679_13_006.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.6 – 导入域控制器安全基准](image/B16679_13_006.jpg)'
- en: Figure 13.6 – Importing domain controller security baselines
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.6 – 导入域控制器安全基准
- en: Once all the necessary baselines are in the **Policy File Importer** view, click
    on **Import...** to import them. Before they are imported, you will be prompted
    to enter a name and save the policy. In this example, I have called the policy
    **2022_DC**.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦所有必要的基准文件都在 **策略文件导入器** 视图中，点击 **导入...** 以导入它们。在导入之前，你将被提示输入名称并保存策略。在本示例中，我将策略命名为
    **2022_DC**。
- en: 'Once the baselines have been imported, you can either add another baseline
    or exported GPO to compare their settings (using **View / Compare**). Alternatively,
    you can also compare a baseline with the effective state of the current system
    (using **Compare to** **Effective State**):'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦基准被导入，你可以选择添加另一个基准或导出的 GPO 来比较它们的设置（使用 **查看 / 比较**）。或者，你也可以将基准与当前系统的有效状态进行比较（使用
    **与有效状态比较**）：
- en: '![Figure 13.7 – The imported 2022_DC policy within Policy Analyzer](image/B16679_13_007.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.7 – 在策略分析器中导入的 2022_DC 策略](image/B16679_13_007.jpg)'
- en: Figure 13.7 – The imported 2022_DC policy within Policy Analyzer
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.7 – 在策略分析器中导入的 2022_DC 策略
- en: 'In our example, I have selected the **2022_DC** policy and compared the **DC01**
    demo environment’s domain controller with the effective state. A new window will
    appear so that you can investigate all the recommended and effective settings:
    if a setting remains white, then it matches, while if a setting is marked in gray,
    it’s not been configured or has been left empty. Finally, if a setting is marked
    in yellow, that means that there’s a conflict and there’s a setting mismatch:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的示例中，我选择了 **2022_DC** 策略，并将 **DC01** 演示环境的域控制器与有效状态进行了比较。此时将弹出一个新窗口，你可以在其中查看所有推荐和有效的设置：如果某个设置保持白色，表示它匹配；如果某个设置标记为灰色，表示它未配置或为空；最后，如果某个设置标记为黄色，则表示存在冲突，设置不匹配：
- en: '![Figure 13.8 – Comparing settings with Policy Analyzer](image/B16679_13_008.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.8 – 与策略分析器比较设置](image/B16679_13_008.jpg)'
- en: Figure 13.8 – Comparing settings with Policy Analyzer
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.8 – 与策略分析器比较设置
- en: By doing this, you can check whether the recommendation reflects the current
    state of your configuration and what you need to configure if it doesn’t match
    yet. Again – please do not just apply the recommendations without evaluating what
    these changes mean for your environment.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这样做，你可以检查推荐的配置是否反映了当前的配置状态，以及如果不匹配，你需要配置什么。再强调一次——请不要在没有评估这些变化对你的环境意味着什么的情况下直接应用这些推荐。
- en: There are not only security baselines for domain controllers but also for member
    servers and clients, as well as for settings for other areas.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 不仅有用于域控制器的安全基准，还有用于成员服务器、客户端的基准，以及其他领域设置的基准。
- en: It is also possible to use PowerShell to interact with those baselines. Every
    baseline is an exported GPO that you can parse. The **gpreport.xml** file contains
    every setting that was configured in this GPO. So, if we import the **gpreport.xml**
    file of a security baseline as a PowerShell object, we can query all the settings
    available while referring to the XML syntax.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以使用PowerShell与这些基准进行交互。每个基准都是一个导出的GPO，你可以解析它。**gpreport.xml**文件包含了在此GPO中配置的每个设置。因此，如果我们将安全基准的**gpreport.xml**文件作为PowerShell对象导入，我们可以在引用XML语法时查询所有可用的设置。
- en: 'The following **Import-Baseline** function helps you with this task:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 以下的**Import-Baseline**函数可以帮助你完成这个任务：
- en: '[PRE6]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: It looks for the first **gpreport.xml** file in the specified folder recursively
    and returns its settings as an XML object.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 它会在指定的文件夹中递归查找第一个**gpreport.xml**文件，并将其设置返回为XML对象。
- en: 'For example, if you want to access the recommended audit settings of the *Windows
    10 22H2 – Computer,* baseline, we would first import it into the **$Baseline**
    variable, as shown in this code snippet:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你想访问*Windows 10 22H2 – Computer*基准的推荐审核设置，我们首先将其导入到**$Baseline**变量中，如下代码片段所示：
- en: '[PRE7]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now, all XML nodes are available and can be queried using the **$Baseline**
    variable. First, let’s check the name of the baseline to make sure that we imported
    the right one:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，所有的XML节点都可以通过**$Baseline**变量进行查询。首先，让我们检查基准的名称，确保我们导入了正确的基准：
- en: '[PRE8]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Next, we want to access the audit settings, which are located under the **Computer.ExtensionData.Extension.AuditSetting**
    node:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们要访问审核设置，它们位于**Computer.ExtensionData.Extension.AuditSetting**节点下：
- en: '[PRE9]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'As shown in the following screenshot, you can see every recommended audit setting
    and its value – that is, the output of the command:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，你可以看到每个推荐的审核设置及其值——即命令的输出：
- en: '![Figure 13.9 – Querying the audit setting XML nodes of the baseline](image/B16679_13_009.jpg)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.9 – 查询基准的审核设置XML节点](image/B16679_13_009.jpg)'
- en: Figure 13.9 – Querying the audit setting XML nodes of the baseline
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.9 – 查询基准的审核设置XML节点
- en: Here, you can see **SettingValue**, which indicates whether it is recommended
    to audit for **Success** (**1**), **Failure** (**2**), or for both **Success and
    Failure** (**3**). **0** would indicate that there it is explicitly not recommended
    to audit this setting (that is, *audit setting disabled*) – a value that you will
    never find in the security baselines distributed by Microsoft.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，你可以看到**SettingValue**，它表示是否建议审核**成功**（**1**）、**失败**（**2**），或是同时审核**成功和失败**（**3**）。**0**表示明确不推荐审核该设置（即*审核设置已禁用*）——这是你在微软发布的安全基准中永远找不到的值。
- en: With this, you can now query all imported XML nodes that were configured in
    this GPO.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 通过此操作，你现在可以查询在这个GPO中配置的所有导入的XML节点。
- en: Another great tool that can help you monitor your security settings for compliance
    using **DSC** is the **BaselineManagement** module. With its help, you can convert
    baselines as well as Group Policies into DSC configuration scripts (**.ps1**)
    and **.mof** files, which you can use to monitor the compliance of your systems.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个可以帮助你监控安全设置以确保合规性的好工具是**DSC**的**BaselineManagement**模块。借助它，你可以将基准以及组策略转换为DSC配置脚本（**.ps1**）和**.mof**文件，并可以用这些文件来监控系统的合规性。
- en: 'You can find more information on how to set this up in the GPO DSC quick start
    documentation: [https://learn.microsoft.com/en-us/powershell/dsc/quickstarts/gpo-quickstart](https://learn.microsoft.com/en-us/powershell/dsc/quickstarts/gpo-quickstart).'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在GPO DSC快速入门文档中找到更多关于如何设置的信息：[https://learn.microsoft.com/en-us/powershell/dsc/quickstarts/gpo-quickstart](https://learn.microsoft.com/en-us/powershell/dsc/quickstarts/gpo-quickstart)。
- en: Applying security updates and patch compliance monitoring
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 应用安全更新和补丁合规性监控
- en: During my work as Premier Field Engineer at Microsoft, I performed a lot of
    security assessments for companies and organizations of all sizes, all around
    the world. One of the most critical, but also most common, findings in those security
    assessments was missing updates. Believe it or not, but of all the organizations
    I assessed, in perhaps 2% of the assessments, I found that all updates were installed.
    For all other assessments, at least one critical update was missing.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在我担任微软首席现场工程师期间，我为世界各地的公司和组织进行了大量的安全评估。那些安全评估中，最关键也最常见的问题之一就是缺少更新。信不信由你，在我评估的所有组织中，只有大约
    2% 的评估中，发现所有更新都已安装。在所有其他评估中，至少缺少一个关键更新。
- en: 'In addition to other attack vectors, such as social engineering and abusing
    legitimate admin capabilities, missing updates are a common reason for systems
    being breached: if a security update was released, this means that a vulnerability
    was fixed and that knowledge about this vulnerability exists publicly. Adversaries
    can even reverse-engineer the released patch to find out what exactly was fixed.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 除了其他攻击方式，如社交工程学和滥用合法管理员权限，缺少更新是系统被攻破的常见原因：如果发布了安全更新，这意味着一个漏洞已被修复，并且关于该漏洞的知识是公开的。对手甚至可以逆向工程已发布的补丁，以了解具体修复了什么。
- en: This means that as soon as an update is released, it is only a race against
    time before adversaries will have an exploit ready. And if a system is missing
    a patch, it will be vulnerable in no time.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着，一旦发布了更新，时间就是对抗的关键，对手很快就能准备好利用漏洞。如果系统缺少补丁，它很快就会变得脆弱。
- en: So, apply security updates as soon as possible. Establish a plan to test and
    install your updates as soon as possible after a release and prioritize this properly.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，尽早应用安全更新。制定一个计划，在发布后尽快测试并安装更新，并正确优先处理。
- en: It is not enough to just install updates – you also need to verify whether all
    needed updates are installed regularly.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 仅仅安装更新是不够的——你还需要定期验证是否已安装所有所需的更新。
- en: Checking for updates
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 检查更新
- en: Many organizations use WSUS and/or SCCM to deploy and monitor security updates.
    Although it’s a great method to deploy them, it is not enough for checking that
    all required updates were installed. Therefore, if you have only relied on WSUS
    or SSCM so far, you need to set up another mechanism to check whether all the
    relevant updates have been installed.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 许多组织使用 WSUS 和/或 SCCM 来部署和监控安全更新。尽管这是一种很好的部署方法，但仅凭此方法不足以检查所有必要的更新是否已安装。因此，如果你至今仅依赖于
    WSUS 或 SSCM，你需要设置另一种机制来检查是否所有相关更新都已安装。
- en: Often, organizations only deploy Windows Security updates and forget about other
    products. But there are so many tools that are installed on servers worldwide
    that come with Microsoft Visual C++ or other programs. Once installed, they are
    never updated, even though critical vulnerabilities exist, which leaves a hole
    in the infrastructure for adversaries to exploit.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 许多组织通常只部署 Windows 安全更新，忽略了其他产品。但全球各地的服务器上安装了许多带有 Microsoft Visual C++ 或其他程序的工具。一旦安装，这些工具就不会再进行更新，尽管存在严重漏洞，这使得基础设施暴露于对手的攻击。
- en: For earlier Windows versions, checking whether all relevant updates were installed
    could be achieved by using **Microsoft Baseline Security Analyzer** (**MBSA**)
    and the **WSUS offline catalog** known as **wsusscn2.cab**. But since MBSA got
    deprecated and is no longer developed, there are new ways to scan for patch compliance.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 对于早期的 Windows 版本，检查是否安装了所有相关更新可以通过使用**Microsoft 基线安全分析工具**（**MBSA**）和**WSUS
    离线目录**（即**wsusscn2.cab**）来实现。但由于 MBSA 已被弃用且不再开发，现在有新的方式可以扫描补丁合规性。
- en: 'One option is to use the PowerShell **Scan-UpdatesOffline.ps1** script, which
    is available in PowerShell Gallery: [https://www.powershellgallery.com/packages/Scan-UpdatesOffline/1.0.](https://www.powershellgallery.com/packages/Scan-UpdatesOffline/1.0)'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 一种选择是使用 PowerShell 的**Scan-UpdatesOffline.ps1**脚本，该脚本可在 PowerShell Gallery 中找到：[https://www.powershellgallery.com/packages/Scan-UpdatesOffline/1.0](https://www.powershellgallery.com/packages/Scan-UpdatesOffline/1.0)
- en: 'You can install the script using **Install-Script**:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用**Install-Script**安装该脚本：
- en: '[PRE10]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Before running the script, download the latest **wsusscn2.cab** file from [http://go.microsoft.com/fwlink/?linkid=74689](http://go.microsoft.com/fwlink/?linkid=74689)
    and save it under **C:\temp\wsusscn2.cab**:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行脚本之前，从[http://go.microsoft.com/fwlink/?linkid=74689](http://go.microsoft.com/fwlink/?linkid=74689)下载最新的**wsusscn2.cab**文件，并将其保存至**C:\temp\wsusscn2.cab**：
- en: '[PRE11]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: It is important to note that this specific path is hardcoded into the **Scan-UpdatesOffline**
    script, so make sure that the **wsusscn2.cab** file is in the right location before
    running this script.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的是，特定路径已硬编码到**Scan-UpdatesOffline**脚本中，因此在运行该脚本之前，确保**wsusscn2.cab**文件位于正确位置。
- en: 'Once everything is in place, you can start the scan using **Scan-UpdatesOffline.ps1**,
    as shown in the following screenshot:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦一切就绪，您可以开始使用**Scan-UpdatesOffline.ps1**进行扫描，如下图所示：
- en: '![Figure 13.10 – Scanning for missing updates](image/B16679_13_010.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![图 13.10 – 扫描缺失的更新](image/B16679_13_010.jpg)'
- en: Figure 13.10 – Scanning for missing updates
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13.10 – 扫描缺失的更新
- en: Now, you can use this script to create regular checks to ensure the latest updates
    are installed on your servers and clients. Make sure you always download the latest
    **wsusscn2.cab** file before scanning.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以使用此脚本进行定期检查，确保您的服务器和客户端安装了最新的更新。在扫描之前，请确保始终下载最新的**wsusscn2.cab**文件。
- en: Since you can only use this method to check for Windows and Microsoft product
    updates, make sure you also keep an inventory of all available software in your
    organization and monitor patch compliance.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 由于此方法仅适用于检查 Windows 和 Microsoft 产品更新，因此请确保同时维护组织内所有可用软件的清单，并监控补丁合规性。
- en: Avoiding lateral movement
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 避免横向移动
- en: Lateral movement is a technique that attackers use to dive deeper into a network
    to compromise endpoints, servers, and identities.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 横向移动是攻击者用来深入网络、破坏终端、服务器和身份的技术。
- en: Once an adversary has managed to compromise a device within an organization,
    they try to gather more credentials and identities to use them to move laterally
    and compromise the entire network.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦攻击者成功入侵了组织内的某个设备，他们会试图获取更多凭证和身份信息，利用这些信息横向移动并入侵整个网络。
- en: 'To detect lateral movement, organizations can use PowerShell to monitor remote
    logon event logs, specifically event ID *4624*. This event ID provides information
    on successful logons, including the logon’s type, process, and authentication
    package. For example, to get all events with event ID *4624* that have a logon
    type of 3 (network logon) from the last 7 days, you can use the following code
    snippet:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 为了检测横向移动，组织可以使用 PowerShell 监控远程登录事件日志，特别是事件 ID *4624*。该事件 ID 提供了有关成功登录的信息，包括登录类型、进程和身份验证包。例如，要获取过去
    7 天内所有登录类型为 3（网络登录）的事件 ID *4624*，可以使用以下代码片段：
- en: '[PRE12]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Logon type 3 indicates that the logon attempt was made over the network. This
    can happen, for example, when a user connects to a network share or when a process
    running on one computer accesses resources on another computer.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 登录类型 3 表示该登录尝试是通过网络进行的。例如，当用户连接到网络共享或某个计算机上运行的进程访问另一个计算机上的资源时，可能会发生此情况。
- en: By monitoring logon-type-3 events, organizations can detect attempts by an attacker
    to access network resources from a compromised system, which can be an early sign
    of lateral movement within the network. Depending on your network, it makes sense
    to fine-grain this example and adjust it to your needs.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 通过监控登录类型为 3 的事件，组织可以检测攻击者尝试从被攻破的系统访问网络资源的行为，这可能是网络内横向移动的早期迹象。根据您的网络情况，可以细化此示例并根据需求调整。
- en: Please refer to [*Chapter 4*](B16679_04_Final_PD.xhtml#_idTextAnchor090), *Detection
    – Auditing and Monitoring*, to learn more about how to leverage the different
    event logs for detecting malicious activities.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考[*第 4 章*](B16679_04_Final_PD.xhtml#_idTextAnchor090)，*检测 – 审计与监控*，了解如何利用不同的事件日志来检测恶意活动。
- en: 'You should abide by the following guidelines to avoid lateral movement as much
    as possible:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 您应遵循以下指南，尽量避免横向移动：
- en: Enforce unique passwords for workstations and servers by using **Local Administrator
    Password** **Solution** (**LAPS**)
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过使用**本地管理员密码解决方案**（**LAPS**），强制为工作站和服务器设置唯一密码
- en: Implement a **Red Forest** for Active Directory administrators, also called
    **Enhanced Security Administrative** **Environment (ESAE)**
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为 Active Directory 管理员实施**红树林**（**Red Forest**），也称为**增强安全管理环境**（**Enhanced Security
    Administrative Environment，ESAE**）
- en: Implement a tiering model and have your administrators use **Privileged Access
    Workstations** (**PAWs**) for their administrative tasks
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实施分层模型，并让管理员使用**特权访问工作站**（**PAWs**）处理管理任务
- en: Restrict logins and maintain proper credential hygiene
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 限制登录并保持适当的凭证管理
- en: Have updates installed as soon as possible
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尽快安装更新
- en: Audit your identity relations by using tools such as BloodHound or SharpHound
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用如 BloodHound 或 SharpHound 等工具审计你的身份关系
- en: Of course, this is not a 100% guarantee that attackers will not be able to move
    laterally, but it already covers a lot and will keep attackers busy for some time.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这不能百分百保证攻击者无法横向移动，但已经涵盖了很多内容，并且会让攻击者忙上一段时间。
- en: Multi-factor authentication for elevation
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 提升权限的多因素认证
- en: '**Multi-Factor Authentication** (**MFA**) always adds another layer of security
    to your administrative accounts. Of course, people can be tricked into allowing
    authentication, but with MFA, it is so much harder for adversaries to steal and
    abuse identities.'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '**多因素认证**（**MFA**）总是为你的管理员账户增加了另一层安全性。当然，人们可能会被欺骗以允许身份验证，但有了 MFA，攻击者窃取并滥用身份的难度大大增加。'
- en: 'There are many options that you can use for MFA. Depending on your scenario,
    you can leverage the following:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用很多不同的 MFA 选项。根据你的具体情况，你可以使用以下工具：
- en: Smartcard authentication
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 智能卡认证
- en: Windows Hello
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Hello
- en: OAuth hardware tokens
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OAuth 硬件令牌
- en: OAuth software tokens
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OAuth 软件令牌
- en: Fido2 security keys
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Fido2 安全密钥
- en: Biometrics
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生物识别技术
- en: SMS or voice calls
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 短信或语音电话
- en: An authenticator application (for example, Microsoft Authenticator)
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个身份验证应用程序（例如 Microsoft Authenticator）
- en: Time-bound privileges (Just-in-Time administration)
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时限性权限（即时管理）
- en: A great option for following the principles of least privilege is to implement
    time-bound privileges, also known as **Just-in-Time administration**. Using this
    approach, no administrators have any rights by default.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 遵循最小权限原则的一个好方法是实施时限性权限，也称为 **即时管理**。采用这种方法，管理员默认没有任何权限。
- en: Once they request privilege elevation, a timestamp is bound to their privileges.
    Once the specified time has run out, the privileges don’t apply any longer.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦他们请求权限提升，系统会将时间戳绑定到他们的权限上。一旦指定时间到期，权限就不再有效。
- en: If an account is compromised, the adversary can’t do any harm since the rights
    of the account were not requested by the administrator. Usually, the elevation
    request comes with MFA.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个账户被攻破，攻击者无法造成任何危害，因为该账户的权限并未由管理员请求。通常，提升请求会伴随 MFA 验证。
- en: Moreover, **privileged identity management** (**PIM**) and **privileged access
    management** (**PAM**) solutions can be used to automate the process of granting
    and revoking time-bound privileges. These solutions provide a centralized platform
    for managing and monitoring privileged access across an organization.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，**特权身份管理**（**PIM**）和 **特权访问管理**（**PAM**）解决方案可用于自动化授予和撤销时限性权限的过程。这些解决方案提供了一个集中平台，用于管理和监控整个组织的特权访问。
- en: They can also offer additional security measures, such as approval workflows,
    audit trails, and session recordings to ensure accountability and compliance.
    Implementing PIM and PAM solutions can greatly enhance the security of time-bound
    privileges and reduce the risk of unauthorized access to critical systems and
    data.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 它们还可以提供额外的安全措施，例如审批工作流、审计跟踪和会话记录，以确保问责制和合规性。实施 PIM 和 PAM 解决方案可以大大增强时限性权限的安全性，并减少对关键系统和数据的未经授权访问的风险。
- en: Attack detection – Endpoint Detection and Response
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 攻击检测 – 端点检测与响应
- en: Another really important point is to have a product in place to detect attacks
    and react to them. There are many great products out there that can help you with
    this task. Make sure that the product of your choice also supports PowerShell
    and helps you detect suspicious commands that were launched via PowerShell and
    other command-line tools.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个非常重要的点是必须有一个产品来检测攻击并做出反应。市面上有很多优秀的产品可以帮助你完成这项任务。确保你选择的产品也支持 PowerShell，并帮助你检测通过
    PowerShell 和其他命令行工具发起的可疑命令。
- en: Microsoft’s solution, for example, is called Microsoft Defender for Endpoint.
    But other vendors provide similar solutions.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，微软的解决方案称为 Microsoft Defender for Endpoint。但其他厂商也提供类似的解决方案。
- en: Enabling free features from Microsoft Defender for Endpoint
  id: totrans-212
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启用 Microsoft Defender for Endpoint 的免费功能
- en: 'Even if you do not use Microsoft Defender for Endpoint, various features are
    free to use without any subscription:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 即使你没有使用 Microsoft Defender for Endpoint，许多功能也可以免费使用，无需任何订阅：
- en: Hardware-based isolation/Application Guard
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 硬件隔离/应用保护
- en: Attack surface reduction rules
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击面缩减规则
- en: Controlled folder access
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 受控文件夹访问
- en: Removable storage protection
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可移动存储保护
- en: Network protection
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络保护
- en: Exploit Guard
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞防护
- en: Windows Defender Firewall with advanced security
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows Defender 防火墙与高级安全性
- en: 'Many of these features can even be used while Microsoft Defender is disabled.
    Check out the ASR capabilities to learn more about these features: [https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/overview-attack-surface-reduction?view=o365-worldwide#configure-attack-surface-reduction-capabilities](https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/overview-attack-surface-reduction?view=o365-worldwide#configure-attack-surface-reduction-capabilities).'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 许多这些功能甚至可以在 Microsoft Defender 禁用的情况下使用。了解 ASR 功能，深入了解这些特性：[https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/overview-attack-surface-reduction?view=o365-worldwide#configure-attack-surface-reduction-capabilities](https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/overview-attack-surface-reduction?view=o365-worldwide#configure-attack-surface-reduction-capabilities)。
- en: Summary
  id: totrans-222
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter sums up this book on PowerShell security. It was not meant to provide
    deep technical information, but rather an outlook of what else can be done to
    improve the security of your network. With this, you have a good overview of what
    to do next and what to look up.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 本章总结了关于 PowerShell 安全性的内容。它并不旨在提供深入的技术信息，而是为了概述可以采取哪些措施来提高网络安全性。通过这些内容，你可以对接下来的工作有一个清晰的了解，并知道需要查阅哪些资料。
- en: You got some insights into secure scripting and what tools you can use to improve
    your scripting security. You also learned what DSC is and how to get started.
    And last but not least, you also got insights into hardening your systems.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 你已获得一些有关安全脚本编写的见解，并了解了可以使用哪些工具来提高脚本的安全性。你还了解了 DSC 以及如何入门。最后，你还了解了如何加强系统的安全性。
- en: I hope you enjoyed this book and could make the most of it. Happy scripting!
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 希望你喜欢本书，并能充分利用它。祝你脚本编写愉快！
- en: Further reading
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'If you want to explore some of the topics that were mentioned in this chapter,
    take a look at these resources:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想深入了解本章提到的一些主题，可以查看以下资源：
- en: '**LAPS**'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: '**LAPS**'
- en: 'LAPS: [https://www.microsoft.com/en-us/download/details.aspx?id=46899](https://www.microsoft.com/en-us/download/details.aspx?id=46899)'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LAPS：[https://www.microsoft.com/en-us/download/details.aspx?id=46899](https://www.microsoft.com/en-us/download/details.aspx?id=46899)
- en: '**PSScriptAnalyzer**'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '**PSScriptAnalyzer**'
- en: 'PSScriptAnalyzer on GitHub: [https://github.com/PowerShell/PSScriptAnalyzer](https://github.com/PowerShell/PSScriptAnalyzer)'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GitHub 上的 PSScriptAnalyzer：[https://github.com/PowerShell/PSScriptAnalyzer](https://github.com/PowerShell/PSScriptAnalyzer)
- en: 'PSScriptAnalyzer reference: [https://learn.microsoft.com/en-us/powershell/module/psscriptanalyzer/?view=ps-modules](https://learn.microsoft.com/en-us/powershell/module/psscriptanalyzer/?view=ps-modules'
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PSScriptAnalyzer 参考：[https://learn.microsoft.com/en-us/powershell/module/psscriptanalyzer/?view=ps-modules](https://learn.microsoft.com/en-us/powershell/module/psscriptanalyzer/?view=ps-modules)
- en: )
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: 'PSScriptAnalyzer module overview: [https://learn.microsoft.com/en-us/powershell/utility-modules/psscriptanalyzer/overview?view=ps-modules](https://learn.microsoft.com/en-us/powershell/utility-modules/psscriptanalyzer/overview?view=ps-modules'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PSScriptAnalyzer 模块概述：[https://learn.microsoft.com/en-us/powershell/utility-modules/psscriptanalyzer/overview?view=ps-modules](https://learn.microsoft.com/en-us/powershell/utility-modules/psscriptanalyzer/overview?view=ps-modules)
- en: )
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: )
- en: '**Security baselines** **and SCT**'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '**安全基准** **和 SCT**'
- en: 'Microsoft SCT 1.0 – How to use it: [https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/security-compliance-toolkit-10](https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/security-compliance-toolkit-10)'
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microsoft SCT 1.0 – 如何使用它：[https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/security-compliance-toolkit-10](https://learn.microsoft.com/en-us/windows/security/operating-system-security/device-management/windows-security-configuration-framework/security-compliance-toolkit-10)
- en: '**LGPO.exe** – Local Group Policy Object Utility, v1.0: [https://techcommunity.microsoft.com/t5/microsoft-security-baselines/lgpo-exe-local-group-policy-object-utility-v1-0/ba-p/701045](https://techcommunity.microsoft.com/t5/microsoft-security-baselines/lgpo-exe-local-group-policy-object-utility-v1-0/ba-p/701045)'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**LGPO.exe** – 本地组策略对象工具，v1.0：[https://techcommunity.microsoft.com/t5/microsoft-security-baselines/lgpo-exe-local-group-policy-object-utility-v1-0/ba-p/701045](https://techcommunity.microsoft.com/t5/microsoft-security-baselines/lgpo-exe-local-group-policy-object-utility-v1-0/ba-p/701045)'
- en: 'New and Updated Security Tools: [https://techcommunity.microsoft.com/t5/microsoft-security-baselines/new-amp-updated-security-tools/ba-p/1631613](https://techcommunity.microsoft.com/t5/microsoft-security-baselines/new-amp-updated-security-tools/ba-p/1631613)'
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 新版和更新的安全工具：[https://techcommunity.microsoft.com/t5/microsoft-security-baselines/new-amp-updated-security-tools/ba-p/1631613](https://techcommunity.microsoft.com/t5/microsoft-security-baselines/new-amp-updated-security-tools/ba-p/1631613)
- en: '**Security Updates**'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: '**安全更新**'
- en: 'A new version of the Windows Update offline scan file, **wsusscn2.cab**, is
    available for advanced users: [https://support.microsoft.com/en-us/topic/a-new-version-of-the-windows-update-offline-scan-file-wsusscn2-cab-is-available-for-advanced-users-fe433f4d-44f4-28e3-88c5-5b22329c0a08](https://support.microsoft.com/en-us/topic/a-new-version-of-the-windows-update-offline-scan-file-wsusscn2-cab-is-available-for-advanced-users-fe433f4d-44f4-28e3-88c5-5b22329c0a08)'
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个新的 Windows 更新离线扫描文件 **wsusscn2.cab** 已经为高级用户提供：[https://support.microsoft.com/en-us/topic/a-new-version-of-the-windows-update-offline-scan-file-wsusscn2-cab-is-available-for-advanced-users-fe433f4d-44f4-28e3-88c5-5b22329c0a08](https://support.microsoft.com/en-us/topic/a-new-version-of-the-windows-update-offline-scan-file-wsusscn2-cab-is-available-for-advanced-users-fe433f4d-44f4-28e3-88c5-5b22329c0a08)
- en: 'Detailed information for developers who use the Windows Update offline scan
    file can be found here: [https://support.microsoft.com/en-us/topic/detailed-information-for-developers-who-use-the-windows-update-offline-scan-file-51db1d9e-038b-0b15-16e7-149aba45f295](https://support.microsoft.com/en-us/topic/detailed-information-for-developers-who-use-the-windows-update-offline-scan-file-51db1d9e-038b-0b15-16e7-149aba45f295)'
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Windows 更新离线扫描文件的开发者可以在这里找到详细信息：[https://support.microsoft.com/en-us/topic/detailed-information-for-developers-who-use-the-windows-update-offline-scan-file-51db1d9e-038b-0b15-16e7-149aba45f295](https://support.microsoft.com/en-us/topic/detailed-information-for-developers-who-use-the-windows-update-offline-scan-file-51db1d9e-038b-0b15-16e7-149aba45f295)
- en: 'What is Microsoft Baseline Security Analyzer and its uses?: [https://learn.microsoft.com/en-us/windows/security/threat-protection/mbsa-removal-and-guidance](https://learn.microsoft.com/en-us/windows/security/threat-protection/mbsa-removal-and-guidance)'
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 什么是 Microsoft 基准安全分析器及其用途？：[https://learn.microsoft.com/en-us/windows/security/threat-protection/mbsa-removal-and-guidance](https://learn.microsoft.com/en-us/windows/security/threat-protection/mbsa-removal-and-guidance)
- en: '**VBS**'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '**VBS**'
- en: 'Virtualization-based security: [https://learn.microsoft.com/en-us/windows-hardware/design/device-experiences/oem-vbs](https://learn.microsoft.com/en-us/windows-hardware/design/device-experiences/oem-vbs)'
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于虚拟化的安全性：[https://learn.microsoft.com/en-us/windows-hardware/design/device-experiences/oem-vbs](https://learn.microsoft.com/en-us/windows-hardware/design/device-experiences/oem-vbs)
- en: 'You can also find all the links mentioned in this chapter in the GitHub repository
    for [*Chapter 13*](B16679_13_Final_PD.xhtml#_idTextAnchor341) – there’s no need
    to manually type in every link: [https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/blob/master/Chapter13/Links.md](https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/blob/master/Chapter13/Links.md).'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以在本章的 GitHub 仓库中找到所有提到的链接，[*第 13 章*](B16679_13_Final_PD.xhtml#_idTextAnchor341)
    – 无需手动输入每个链接：[https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/blob/master/Chapter13/Links.md](https://github.com/PacktPublishing/PowerShell-Automation-and-Scripting-for-Cybersecurity/blob/master/Chapter13/Links.md)。
