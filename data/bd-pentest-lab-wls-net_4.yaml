- en: Chapter 4. Designing Application Lab Components
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第四章：设计应用实验室组件
- en: 'In the previous chapter, we prepared a network "basis" for the lab in two options:
    hardware and virtual. Now, it is time to fill the lab network with application-level
    functional components such as web servers and database servers. Those components
    are needed to build a lab network that has most of the capabilities of a real
    enterprise network to let a penetration tester practice the most common and "must-know"
    cases and techniques.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们为实验室准备了两种选择的网络“基础”：硬件和虚拟。现在，是时候为实验室网络填充应用层功能组件，如 Web 服务器和数据库服务器。这些组件对于构建一个具备大多数真实企业网络能力的实验室网络至关重要，以便渗透测试人员能够练习最常见且“必须掌握”的案例和技术。
- en: Usually, applications and network services are the main goal for attackers and
    the main target of their attacks. Such components are usually used to process
    and store financial and private data, trade secrets, and other sensitive confidential
    data. They are often used to manage other network components and accounts, thus
    controlling the access to network resources. Some of them can provide various
    customer services and are therefore one of the key profit or reputation systems
    for a commercial company, so-called business-critical systems (or application/services).
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，应用程序和网络服务是攻击者的主要目标，也是他们攻击的主要对象。这些组件通常用于处理和存储财务和私人数据、商业机密以及其他敏感的机密数据。它们通常用于管理其他网络组件和账户，从而控制对网络资源的访问。有些还可以提供各种客户服务，因此它们是商业公司关键的利润或声誉系统，通常被称为业务关键系统（或应用程序/服务）。
- en: Needless to say, companies place high emphasis on protecting such systems and
    services and often tend to get another third-party opinion, ordering penetration
    tests and other information security consultancy services.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 不用多说，企业非常重视保护这些系统和服务，并且通常会寻求第三方意见，委托进行渗透测试和其他信息安全咨询服务。
- en: That is why you have to be well-prepared to meet at least some of the popular
    network services and we will see how to reach that goal in this chapter.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你必须做好充分的准备，至少要了解一些常见的网络服务，我们将在本章中学习如何实现这一目标。
- en: 'This chapter covers the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖以下内容：
- en: Planning services
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务规划
- en: Creating virtual servers and workstations
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建虚拟服务器和工作站
- en: Installing and configuring domain services
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装和配置域服务
- en: Installing a certification authority
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装证书认证机构
- en: Installing a remote management service
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装远程管理服务
- en: Installing an e-mail service
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装电子邮件服务
- en: Installing vulnerable network services
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装易受攻击的网络服务
- en: Installing web applications
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 Web 应用程序
- en: Planning services
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 服务规划
- en: As usual, before you start building something, it should be planned and all
    prerequisites should be fulfilled.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 一如既往，在你开始构建任何东西之前，应该进行规划，并确保所有前提条件都得到满足。
- en: In the current topic, we are going to define which server will host which services
    and applications. We are going to try to host several applications and services
    at one server, because most of us are limited with computing resources and server
    hardware, remember?
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在当前主题中，我们将定义哪些服务器将托管哪些服务和应用程序。我们将尝试在一台服务器上托管多个应用程序和服务，因为大多数人都受到计算资源和服务器硬件的限制，记得吗？
- en: So, depending on your capabilities and budget, you can use relatively powerful
    servers to host several relatively powerful VMs or you can use SOHO computers
    to host VMs with limited RAM and CPUs.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，根据你的能力和预算，你可以使用相对强大的服务器来托管几个相对强大的虚拟机，或者你可以使用 SOHO 计算机来托管内存和 CPU 限制的虚拟机。
- en: Tip
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Lab environment flexibility**'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '**实验室环境灵活性**'
- en: It is worth reminding that it depends on your own needs and preferences which
    hosts to include in your lab and which ones to omit. We just want to show the
    most useful options of installing lab components, but it is totally up to you
    what exactly to use and what to do not use.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 值得提醒的是，选择哪些主机包括在你的实验室中，哪些主机不包括，取决于你的需求和偏好。我们只想展示安装实验室组件的最有用选项，但具体使用什么、使用哪些并不使用，完全由你决定。
- en: A good thing about using virtual machines is that you do not have to keep all
    the servers turned on at the same time. For most of your lab tasks, you do not
    even need to turn on your network devices. In most cases, it is enough to just
    turn one VM on and keep everything else suspended.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 使用虚拟机的一个好处是，你不必同时开启所有服务器。对于大多数实验室任务，你甚至不需要打开你的网络设备。在大多数情况下，只需打开一台虚拟机，保持其他虚拟机挂起即可。
- en: As we have already decided in the previous chapters, the IP range for our server
    subnet is 10.0.0.0/24 and the IP address 10.0.0.1 is already assigned to the core
    router's subinterface. Workstations will get their dynamic IP addresses from the
    router via DHCP, so we don't need to plan their address space now, except the
    admin workstation which has the IP address 10.1.0.30.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在前面的章节中已经决定的那样，我们的服务器子网的IP范围是10.0.0.0/24，IP地址10.0.0.1已经分配给了核心路由器的子接口。工作站将通过DHCP从路由器获取动态IP地址，因此现在不需要为它们规划地址空间，除了管理员工作站，它的IP地址是10.1.0.30。
- en: 'Keeping all that in mind, let''s draw another table to summarize what and on
    which IP addresses we are going to install:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 牢记这一点，让我们绘制另一个表格，总结一下我们将要安装的内容以及其对应的IP地址：
- en: '| IP address | OS | Apps and services | Remarks |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| IP 地址 | 操作系统 | 应用与服务 | 备注 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| 10.0.0.2 | Windows Server 2008 | Directory services | AD, e-mail server,
    certification authority, SSH |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| 10.0.0.2 | Windows Server 2008 | 目录服务 | AD, 电子邮件服务器, 认证机构, SSH |'
- en: '| 10.0.0.3 | Linux | Metasploitable 2 | Vulnerable network services |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| 10.0.0.3 | Linux | Metasploitable 2 | 漏洞网络服务 |'
- en: '| 10.0.0.4 | CentOS | vulnVoIP | Vulnerable VoIP service |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| 10.0.0.4 | CentOS | vulnVoIP | 漏洞VoIP服务 |'
- en: '| 10.0.0.5 | Ubuntu Server | Web application server | Liferay Portal CE,OWASP
    WebGoat,DVWA |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| 10.0.0.5 | Ubuntu Server | Web 应用服务器 | Liferay Portal CE, OWASP WebGoat,
    DVWA |'
- en: You can always get back to this table to quickly refresh the server subnet's
    layout in your memory.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以随时查看这个表格，快速刷新你对服务器子网布局的记忆。
- en: Tip
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Back up your lab systems**'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**备份你的实验室系统**'
- en: Do not forget to make snapshots of your VMs after finishing installations. There
    is a big probability of unintentionally breaking something during further hacking
    exercises and it is good to have a backup image which you can quickly restore—a
    snapshot in case of VM.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，不要忘记对你的虚拟机进行快照。因为在进一步的黑客练习过程中，很有可能会无意间破坏某些东西，拥有一个可以快速恢复的备份镜像（虚拟机快照）是非常有用的。
- en: You will also probably want to have several snapshots of some VMs having various
    configurations or security levels to be able to quickly switch between them according
    to your current lab tasks.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还希望为一些虚拟机创建多个快照，保存不同配置或安全级别的版本，以便根据当前的实验室任务快速切换。
- en: Creating virtual servers and workstations
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建虚拟服务器和工作站
- en: Now we know which services and servers we want to have, but before we install
    them, let's quickly review how we can create VMs and connect them to our lab network.
    We will use Oracle VirtualBox virtualization software for that purpose, because
    it is free and powerful at the same time.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经知道了需要哪些服务和服务器，但在安装它们之前，我们先快速回顾一下如何创建虚拟机并将其连接到我们的实验室网络。我们将使用Oracle VirtualBox虚拟化软件来实现这一目标，因为它既免费又强大。
- en: VirtualBox overview and installation
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: VirtualBox概述与安装
- en: As we said earlier, we will use Oracle VM VirtualBox as the virtualization platform
    for hosts. VirtualBox is a powerful, feature-rich, high-performance virtualization
    solution for enterprise as well as home use. VirtualBox is freely available as
    open source software under the terms of the GNU **General Public License** (**GPL**)
    Version 2.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们之前所说，我们将使用Oracle VM VirtualBox作为主机的虚拟化平台。VirtualBox是一款强大、功能丰富、高性能的虚拟化解决方案，适用于企业和家庭使用。VirtualBox作为开源软件，遵循GNU
    **通用公共许可证**（**GPL**）第2版的条款免费提供。
- en: Tip
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: You can always refer to the official VirtualBox documentation to get more information
    ([https://www.virtualbox.org/wiki/Documentation](https://www.virtualbox.org/wiki/Documentation)).
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以随时参考官方的VirtualBox文档以获取更多信息（[https://www.virtualbox.org/wiki/Documentation](https://www.virtualbox.org/wiki/Documentation)）。
- en: VirtualBox can be launched on different operating systems and supports a large
    number of guest operating systems including but not limited to Windows and Linux.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: VirtualBox可以在不同的操作系统上启动，并支持大量的来宾操作系统，包括但不限于Windows和Linux。
- en: Support for images of hard drives **VMDK** (**VMware**) and **VHD** (**Microsoft
    Virtual PC**) is able to create and use portable virtual hosts. But most importantly,
    VirtualBox supports snapshots, which greatly facilitates the work in our test
    infrastructure. So, that fact makes VirtualBox the best choice for our purpose.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 支持硬盘镜像格式**VMDK**（**VMware**）和**VHD**（**Microsoft Virtual PC**）能够创建和使用便捷的虚拟主机。但最重要的是，VirtualBox支持快照功能，这极大地方便了我们在测试基础设施中的工作。因此，这一特点使得VirtualBox成为我们目标的最佳选择。
- en: Firstly, we need to get the distribution packet of VirtualBox. We can download
    it from the [https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)
    website. Choose the binaries packet for your platform and just click on the link.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要获取 VirtualBox 的安装包。我们可以从[https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)网站下载。选择适合你平台的二进制包，然后点击链接下载。
- en: After downloading, execute the obtained file. The installation process is simple
    and does not require specific manipulations.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 下载完成后，执行获取的文件。安装过程简单，无需特殊操作。
- en: After starting the VirtualBox application, you will see the Virtual Machine
    management interface window. This interface is pretty straightforward and does
    not require further explanation.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 启动 VirtualBox 应用程序后，你将看到虚拟机管理界面的窗口。这个界面非常直观，不需要进一步解释。
- en: '![VirtualBox overview and installation](../images/00023.jpeg)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![VirtualBox 概述和安装](../images/00023.jpeg)'
- en: The Oracle VM VirtualBox management interface
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: Oracle VM VirtualBox 管理界面
- en: Creating virtual machines
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建虚拟机
- en: For creating a new virtual machine, we need to click on the **New** button in
    main toolbar of the management interface and the **Create Virtual Machine** wizard
    will start. In the window that opens, we need to set the name of the new virtual
    machine and select the template based on the version of the operating system.
    Once a template is selected, choose the default answers for the following questions
    (such as the location of the virtual machine files and its characteristics). After
    the wizard is done, we should set the installation image of the operating system.
    Click on the **Start** button on the main toolbar to start our new virtual machine.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 为了创建新的虚拟机，我们需要点击管理界面主工具栏上的**新建**按钮，**创建虚拟机**向导将启动。在打开的窗口中，我们需要设置新虚拟机的名称，并根据操作系统的版本选择模板。选择模板后，选择以下问题的默认答案（如虚拟机文件的位置及其特性）。向导完成后，我们应该设置操作系统的安装镜像。点击主工具栏上的**启动**按钮来启动我们的新虚拟机。
- en: You can get an image of the operating system on the Microsoft Corporation site.
    For example, for our laboratory, we used Microsoft Windows Server 2008 R2 Evaluation
    as a Windows server operating system. You can download this on [https://www.microsoft.com/en-US/download/details.aspx?id=11093](https://www.microsoft.com/en-US/download/details.aspx?id=11093).
    Of course, you can use your own (purchased earlier) operating system installation
    images.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在微软公司网站上获取操作系统镜像。例如，在我们的实验室中，我们使用了 Microsoft Windows Server 2008 R2 Evaluation
    作为 Windows 服务器操作系统。你可以在[https://www.microsoft.com/en-US/download/details.aspx?id=11093](https://www.microsoft.com/en-US/download/details.aspx?id=11093)下载。当然，你也可以使用自己（之前购买的）操作系统安装镜像。
- en: After starting the virtual machine, a new window will open where you can see
    the screen of our virtual machine and menu options to manage the virtual machine.
    Here, we can interact with the virtual machine like a normal application using
    the keyboard and mouse.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 启动虚拟机后，会打开一个新窗口，在这里你可以看到虚拟机的屏幕以及管理虚拟机的菜单选项。在这里，我们可以像使用普通应用程序一样，通过键盘和鼠标与虚拟机进行交互。
- en: As a regular computer, the virtual machine on startup will attempt to find a
    bootable media and try to boot from it. If we set the image of the installation
    image of the operating system, then the process of the new operating system installation
    will start.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 就像普通计算机一样，虚拟机在启动时会尝试寻找可引导的介质并从中启动。如果我们设置了操作系统的安装镜像，那么新的操作系统安装过程将会开始。
- en: 'The process of installing an operating system is simple, and we will not describe
    it here. Now, we need to install two types of OS: server and workstation. In our
    case, we install Microsoft Windows Server 2008 R2 and Microsoft Windows 7 Professional
    for the demo purposes, but we recommend you to install several various Windows
    versions: the latest ones and a couple of the old ones (not to learn the basics
    of network attacks, but to stay up-to-date).'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 安装操作系统的过程非常简单，这里不再详细描述。现在，我们需要安装两种类型的操作系统：服务器版和工作站版。在我们的案例中，我们安装了 Microsoft
    Windows Server 2008 R2 和 Microsoft Windows 7 专业版用于演示，但我们建议你安装几种不同版本的 Windows：最新的几个版本以及一些较老的版本（不是为了学习网络攻击的基础知识，而是为了保持最新）。
- en: 'After installation of the OS, we should configure basic settings like language
    and regional settings, time, and time zone. In case of virtual machines, the basic
    settings also include the installation of an additional package: **VirtualBox
    Guest Additions**.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 安装操作系统后，我们应该配置基本设置，如语言和区域设置、时间和时区。在虚拟机的情况下，基本设置还包括安装额外的软件包：**VirtualBox 客户附加组件**。
- en: VirtualBox Guest Additions ([https://www.virtualbox.org/manual/ch04.html](https://www.virtualbox.org/manual/ch04.html))
    is a set of software installed in the guest operating system and expands its ability
    to interact with the system and the virtualization host system. For example, after
    you install the special driver *virtual video*, it is possible to change the desktop
    resolution of the guest OS in an arbitrary manner after the window size VirtualBox,
    which is running the virtual machine.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '[VirtualBox 客户附加组件](https://www.virtualbox.org/manual/ch04.html)是安装在客户操作系统中的一组软件，扩展了其与系统和虚拟化主机系统交互的能力。例如，在安装特殊驱动程序
    *虚拟视频* 后，可以在运行虚拟机的 VirtualBox 窗口大小之后任意更改客户操作系统的桌面分辨率。'
- en: When our first Windows server and Windows workstation are installed, we should
    shut down the virtual machines and save them (take snapshots). We will continue
    to use them as templates for quick deployment of new instances.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 安装第一个 Windows 服务器和 Windows 工作站后，我们应该关闭虚拟机并保存它们（拍摄快照）。我们将继续使用它们作为快速部署新实例的模板。
- en: Configuring network settings of lab components
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置实验组件的网络设置
- en: The last action that we need to do with our virtual machines is configuring
    network adapters for the virtual machines. We have two main approaches that depend
    on implementation of our network infrastructure (based on hardware network devices
    and based on virtual network infrastructure).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要为虚拟机配置网络适配器的最后一个操作。我们有两种主要方法，这取决于我们网络基础设施的实现方式（基于硬件网络设备和基于虚拟网络基础设施）。
- en: 'In case of network infrastructure based on hardware devices, we need to set
    the network adapter in bridged mode and our virtual machine will interact with
    the outer world via a hardware Ethernet port of the host computer. For this, we
    go to the **Network** tab of the virtual machine settings. The virtual machine
    should be in **Shutdown** state at this moment. Select the **Bridged Adapter**
    item in the **Attached to** combo box. From the **Name** combo box, select your
    network adapter. It is connected to the core switch. In our case, it looks like
    the following screenshot:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 对于基于硬件设备的网络基础设施，我们需要将网络适配器设置为桥接模式，我们的虚拟机将通过主机计算机的硬件以太网端口与外界交互。为此，我们转到虚拟机设置的
    **网络** 选项卡。此时，虚拟机应处于 **关机** 状态。在 **连接到** 组合框中选择 **桥接适配器** 项目。从 **名称** 组合框中选择您的网络适配器。它连接到核心交换机。在我们的情况下，看起来像以下的截图：
- en: '![Configuring network settings of lab components](../images/00024.jpeg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![配置实验组件的网络设置](../images/00024.jpeg)'
- en: The network interface settings of a virtual machine
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机的网络接口设置
- en: 'In case of virtual network infrastructure based on GNS3, we need to perform
    the following steps for each virtual machine:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 对于基于 GNS3 的虚拟网络基础设施，我们需要为每台虚拟机执行以下步骤：
- en: Start GNS3 and go to the **VirtualBox VMs** settings tab. We had briefly described
    it in [Chapter 3](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 3. Configuring Networking Lab Components"), *Configuring Networking Lab
    Components*, so you should remember. Anyway, this can be achieved by navigating
    to **Edit** | **Preferences**. In the window that opens, select **VirtualBox VMs**.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 GNS3 并转到 **VirtualBox VMs** 设置选项卡。我们在[第 3 章](part0024_split_000.html#MSDG1-3ecab517ca6e4afbb3c20ab15f7b4d82
    "Chapter 3. Configuring Networking Lab Components")中简要描述过它，*配置网络实验室组件*，所以你应该记得。无论如何，可以通过导航到
    **编辑** | **首选项** 来实现这一点。在打开的窗口中，选择 **VirtualBox VMs**。
- en: 'In the **VirtualBox VM Templates** section, we have a list of virtual machines
    (if you access this tab the first time, it should be clean) and three management
    buttons: **New**, **Edit**, and **Delete**.'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **VirtualBox VM 模板** 部分，我们有一个虚拟机列表（如果您首次访问此选项卡，应该是干净的）和三个管理按钮：**新建**、**编辑**
    和 **删除**。
- en: By pressing the **New** button, it will start a wizard to add a new virtual
    machine. In first window, it asks about which existing virtual machine we would
    like to connect to our virtual network infrastructure.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过按下 **新建** 按钮，将启动向导以添加新的虚拟机。在第一个窗口中，它会询问我们想要连接到我们虚拟网络基础设施的现有虚拟机。
- en: After a virtual machine is selected, GNS3 will automatically create new *linked*
    clone of the virtual machine with special network parameters, for example, we
    have following network settings in our case:![Configuring network settings of
    lab components](../images/00025.jpeg)
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择虚拟机后，GNS3将自动创建一个新的*链接*克隆虚拟机，并使用特殊的网络参数。例如，在我们的案例中，网络设置如下：![配置实验组件的网络设置](../images/00025.jpeg)
- en: Network interface settings of the virtual machine
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 虚拟机的网络接口设置
- en: Installing and configuring domain services
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和配置域服务
- en: 'As the next step, let''s install and configure the core of any Windows-based
    corporate network: the domain and its services.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步，让我们安装并配置任何基于Windows的企业网络的核心：域及其服务。
- en: Creating a domain
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建域
- en: In the next step, we create a domain and its services based on Microsoft Active
    Directory. It will provide the central services for managing application levels
    of our infrastructure (managing users and computers, name service, and so on).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，我们将创建一个基于Microsoft Active Directory的域及其服务。它将提供管理我们基础设施应用层的中央服务（管理用户和计算机、命名服务等）。
- en: First, we create a new virtual machine by cloning our Windows server template
    in VirtualBox. For this, we just need to select **Clone…** from the context menu
    of the virtual machine list of the VirtualBox management interface. In the wizard,
    we should check the option **Reinitialize the MAC address of all network cards**
    in the first window and select the **Full clone** option in the second window
    of the wizard.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们通过在VirtualBox中克隆我们的Windows服务器模板来创建一个新的虚拟机。为此，我们只需要在VirtualBox管理界面的虚拟机列表中选择**克隆...**，然后在向导中，在第一个窗口勾选**重新初始化所有网络适配器的MAC地址**选项，并在第二个窗口选择**完全克隆**选项。
- en: 'After cloning, start the new virtual machine. So, the clean operating system
    is running and we have a basic configuration. For creating a domain, we need to
    configure the domain controller on this virtual server. For this, we should perform
    the following steps:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 克隆后，启动新的虚拟机。此时，操作系统已安装并运行，且具有基本配置。为了创建域，我们需要在此虚拟服务器上配置域控制器。为此，我们应该执行以下步骤：
- en: In the **Initial Configuration Tasks** page, we need to set the computer name.
    We choose the name **DC**. It is short and clear.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**初始配置任务**页面中，我们需要设置计算机名称。我们选择名称**DC**，简短且明确。
- en: 'Next, we should set the IP configuration of the server network adapter. We
    need to use a static IP address, because this server would be the domain controller
    as well as the DNS server. We should choose the IP address from the previously
    defined address space. Now, our configuration for the IP of the domain controller
    is as follows:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们应该设置服务器网络适配器的IP配置。我们需要使用静态IP地址，因为该服务器将既是域控制器又是DNS服务器。我们应该选择之前定义的地址空间中的IP地址。现在，我们的域控制器IP配置如下：
- en: '| Parameter | Value |'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 参数 | 值 |'
- en: '| --- | --- |'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| IP address | 10.0.0.2 |'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| IP 地址 | 10.0.0.2 |'
- en: '| Net mask | 255.255.255.0 |'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 网络掩码 | 255.255.255.0 |'
- en: '| Gateway | 10.0.0.1 |'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 网关 | 10.0.0.1 |'
- en: '| DNS | 10.0.0.2 |'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| DNS | 10.0.0.2 |'
- en: Next, we should define the **Active Directory Domain Controller** role for our
    server. So, go to **Server Manager** and select **Roles** from the left-hand side
    panel. And next, click on the link **Add Roles** in the right-hand side panel.
    In the opened window **Before You Begin**, we should click on the **Next** button.
    In the next window, check the **Active Directory Domain Services** item.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们应为服务器定义**Active Directory 域控制器**角色。所以，进入**服务器管理器**，在左侧面板中选择**角色**，然后点击右侧面板中的**添加角色**链接。在弹出的**开始之前**窗口中，我们应该点击**下一步**按钮。在接下来的窗口中，勾选**Active
    Directory 域服务**项。
- en: In this page, you can also check additional roles to add to our server and install
    additional features, or you can do this later because now we do not need it.
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此页面中，你还可以勾选附加角色以添加到我们的服务器，并安装其他功能，或者你也可以稍后再进行，因为现在我们不需要它。
- en: It should be noted that Active Directory requires the DNS server, but now we
    do not add this role. Later in the domain installation process, this role will
    be added automatically.
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 应该注意的是，Active Directory需要DNS服务器，但现在我们并未添加此角色。在域安装过程中，此角色将自动添加。
- en: The second main step of creating the domain controller is executing the `dcpromo`
    utility. Now, go to the **Start** menu and type `dcpromo` in the **Run** textbox.
    You will find it in the list. Click on **dcpromo**.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建域控制器的第二个主要步骤是执行`dcpromo`工具。现在，进入**开始**菜单，在**运行**文本框中输入`dcpromo`。你会在列表中找到它，点击**dcpromo**。
- en: As a result, we run the wizard **Welcome to the Active Directory Domain Service
    Installation Wizard**. We do not need advanced options in this scenario, so just
    click on the **Next** button.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 结果，我们运行了**欢迎使用Active Directory域服务安装向导**。在这个场景下，我们不需要高级选项，因此只需点击**下一步**按钮。
- en: In the **Operating System Compatibility** page, the wizard warned us that our
    NT and non-Microsoft SMB customers will experience problems with some of the cryptographic
    algorithm used in Windows Server 2008 R2\. We have no such problems in our test
    environment, so just click on the **Next** button.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**操作系统兼容性**页面中，向导警告我们，使用NT和非Microsoft SMB客户端的用户会遇到Windows Server 2008 R2中某些加密算法的问题。在我们的测试环境中没有此类问题，因此只需点击**下一步**按钮。
- en: In the **Choose a Deployment Configuration** page, we should select **Create
    a new domain in a new forest**. We do this for the simple reason that it is a
    new domain in a new forest.
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**选择部署配置**页面中，我们应选择**在新森林中创建新域**。我们这么做的原因很简单，因为这是一个新森林中的新域。
- en: In the **Name the Forest Root Domain** page, we should enter the domain name
    in the **FQDN of the root domain in the forest** textbox. In our case, we call
    the `lab.local` domain. You can name your domain as you like; but if you use a
    name that is already in use on the Internet (a name that has already been registered),
    then you may have a problem with names. Click on the **Next** button.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**命名森林根域**页面中，我们应在**森林根域的FQDN**文本框中输入域名。在我们的例子中，我们将域命名为`lab.local`。你可以根据自己的喜好命名域名；但是如果你使用一个已经在互联网上注册的名称，可能会遇到名称冲突的问题。点击**下一步**按钮。
- en: In the **Set Forest Functional Level** page, select the **Windows Server 2008
    R2** option. Click on **Next**.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**设置森林功能级别**页面中，选择**Windows Server 2008 R2**选项。点击**下一步**。
- en: 'In the **Additional Domain Controller Options** page, we have only one choice:
    DNS server. The Global catalog option is selected and is not an option for selection;
    as long as it is the only DC in the domain, so it must be a global catalog server.
    The option domain controller read-only permission is not checked, since it is
    necessary to have other non-RODCs on the network to enable this option. Let''s
    select the DNS server option and click on the **Next** button.'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**附加域控制器选项**页面中，我们只有一个选择：DNS服务器。全局目录选项已选中，并且不能取消选择；只要它是域中唯一的DC，它就必须是全局目录服务器。域控制器只读权限选项未勾选，因为要启用此选项，网络上必须有其他非RODC。我们选择DNS服务器选项，并点击**下一步**按钮。
- en: A dialog box appears saying that it is impossible to create a delegation for
    this DNS server, because the authoritative parent zone can not be found or does
    not use the Windows DNS server. The reason is that this is the first DC network.
    So, we just click on the **Yes** button to continue.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 出现一个对话框，提示无法为此DNS服务器创建委派，因为找不到授权的父区域或该区域没有使用Windows DNS服务器。原因是这是第一个DC网络。因此，我们只需点击**是**按钮继续。
- en: In the next page, let's leave paths to the database, log files, and SYSVOL by
    default, and click on the **Next** button.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页面中，我们将数据库、日志文件和SYSVOL的路径保持为默认值，然后点击**下一步**按钮。
- en: In the **Directory Service Restore Mode Administrator Password** page, let's
    enter a strong password in the **Password** and **Confirm password** text fields.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**目录服务恢复模式管理员密码**页面中，我们需要在**密码**和**确认密码**文本框中输入一个强密码。
- en: Now, let's check the information on the page **Summary** and click on the **Next**
    button for installing Active Directory. The installation process takes several
    minutes. After installing, we should reboot our server.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们检查**摘要**页面上的信息，并点击**下一步**按钮以安装Active Directory。安装过程需要几分钟。安装完成后，我们应该重启服务器。
- en: Finally, the installation is complete after you log in. It should be noted that
    the DNS service was installed during the installation of Active Directory, so
    we do not need to worry about it. Now, we have ready the domain controller and
    the `lab.local` domain.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在你登录后，安装完成。需要注意的是，在安装Active Directory时，DNS服务已经安装，因此我们无需担心它。现在，我们已经准备好了域控制器和`lab.local`域。
- en: Creating users
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建用户
- en: 'Now, let''s create user accounts in our domain. In Active Directory, it''s
    a very simple process. The method of user creating based on the use of the snap-in
    **Active Directory Users and Computers** is the most convenient, because it uses
    a graphical user interface and wizard. The disadvantage of this method is that
    when you create a user account, you cannot set most of the account attributes
    when you create a user account, and you have to add them by additionally editing
    the created account. In order to create a user account, follow these steps:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们在域中创建用户账户。在 Active Directory 中，这是一个非常简单的过程。基于使用**Active Directory 用户和计算机**管理单元的用户创建方法是最便捷的，因为它采用图形用户界面和向导。该方法的缺点是，在创建用户账户时，无法设置大部分账户属性，必须通过额外编辑已创建的账户来添加它们。要创建用户账户，请按照以下步骤操作：
- en: Open the snap-in **Active Directory - Users and Computers**. You can do this
    by navigating to **Start** | **Administrative Tools** | **Active Directory - Users
    and Computers**. You can also use the key combination *Win* + *R* to open the
    dialog **Run** and enter the `dsa.msc` command to execute.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开**Active Directory - 用户和计算机**管理单元。你可以通过导航到**开始** | **管理工具** | **Active Directory
    - 用户和计算机**来完成此操作。你也可以使用快捷键*Win* + *R* 打开**运行**对话框，并输入`dsa.msc`命令执行。
- en: In the tree, expand your domain and go to the folder **Users**. Right-click
    on it and from the context menu, go to **New** | **User**. It will start a wizard.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在树形结构中，展开你的域并进入**用户**文件夹。右键点击它，从右键菜单中选择**新建** | **用户**。这将启动向导。
- en: In the dialog box **New Object - User**, enter the information about creating
    the user (first name, last name, and logon name). Click on the **Next** button.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**新建对象 - 用户**对话框中，输入有关创建用户的信息（名字、姓氏和登录名）。然后点击**下一步**按钮。
- en: In the next page of the wizard, you have to enter the initial password in the
    **Password** field and re-enter it in the **Confirm** textbox. In addition, you
    can also set the basic parameters of the password policy.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在向导的下一页面中，你需要在**密码**字段中输入初始密码，并在**确认密码**文本框中重新输入。除此之外，你还可以设置密码策略的基本参数。
- en: In the last page of the wizard, you will see a summary of the parameters you
    entered. If information is entered correctly, click on the **Finish** button to
    create a user account and complete the wizard.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在向导的最后一页，你将看到你输入的参数摘要。如果信息输入正确，点击**完成**按钮以创建用户账户并完成向导。
- en: After the user account is created, you can find it in the user account list
    in the right-hand side panel. By clicking on the **Preferences** item in the context
    menu of the user account, you can configure all the attributes of the user account.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用户账户创建完成后，你可以在右侧面板的用户账户列表中找到它。通过右键点击该用户账户中的**首选项**项，你可以配置该用户账户的所有属性。
- en: So, now you can create several user accounts.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以创建多个用户账户。
- en: Adding hosts to the domain
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将主机加入域
- en: Now, we have to create several workstations including the admin one. For this
    purpose, let's create new virtual machines by cloning our Windows workstation
    template in VirtualBox. For this, as in case of the Windows server template, we
    just need to select the **Clone…** item from the context menu of the virtual machine
    list of the VirtualBox management interface. In the wizard, we should check the
    **Reinitialize the MAC address of all network cards** option in the first window
    and select the **Full clone** option in the second window.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要创建多个工作站，包括管理员工作站。为此，让我们通过克隆 Windows 工作站模板，在 VirtualBox 中创建新的虚拟机。就像在 Windows
    服务器模板的情况下，我们只需从 VirtualBox 管理界面的虚拟机列表的右键菜单中选择**克隆…**选项。在向导中，我们应在第一个窗口中勾选**重新初始化所有网络卡的
    MAC 地址**选项，并在第二个窗口中选择**完整克隆**选项。
- en: After cloning and starting our new virtual machine, let's join it to the domain.
    It would give us the possibility to use all advantages of a domain, such as centralized
    management, group policies, and much more.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在克隆并启动我们的新虚拟机后，让我们将其加入域中。这样可以让我们享受域的所有优势，比如集中管理、组策略等等。
- en: 'Before joining the computer to the domain, let''s make sure that the following
    prerequisites are met:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在将计算机加入域之前，让我们确保满足以下前提条件：
- en: The network adapter of our virtual workstation is working and has the right
    IP address. The operating system settings for the network adapter of our workstation
    is set to DHCP.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们的虚拟工作站的网络适配器正在正常工作，并且已分配正确的 IP 地址。我们的工作站的网络适配器操作系统设置为 DHCP。
- en: Virtual workstations have "network visibility" to the domain controller. We
    can check this by a ping utility based on ICMP requests.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 虚拟工作站可以“网络可见”域控制器。我们可以通过基于ICMP请求的ping工具来检查这一点。
- en: '[PRE0]'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: On a virtual workstation, you are logged on as the local administrator.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在虚拟工作站上，您以本地管理员身份登录。
- en: 'Next, let''s perform the following steps:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，让我们执行以下步骤：
- en: Open **System Properties** by clicking on **Start**, then right-click on **Computer**
    and click on the **Properties** item from the context menu.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击**开始**，然后右键点击**计算机**，在右键菜单中点击**属性**，打开**系统属性**。
- en: In the **Computer name, domain, and workgroup settings** section, click on the
    **Change settings** link.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**计算机名称、域和工作组设置**部分，点击**更改设置**链接。
- en: In the **Computer Name** tab, click on the **Change** button.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**计算机名称**标签页中，点击**更改**按钮。
- en: In the **Computer name** textbox, enter the hostname of our workstation.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**计算机名称**文本框中，输入我们工作站的主机名。
- en: In the **Member of** section, check the **Domain** radio button and enter the
    name of the domain to which you want to connect. In our case, it's `lab.local`.![Adding
    hosts to the domain](../images/00026.jpeg)
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**成员身份**部分，勾选**域**单选按钮，并输入您想要连接的域名称。在我们的例子中，它是`lab.local`。![将主机添加到域](../images/00026.jpeg)
- en: Join workstation to domain
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将工作站加入域
- en: After clicking on the **OK** button, you will be prompted to enter your domain
    administrator name and password.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**确定**按钮后，系统会提示您输入域管理员的用户名和密码。
- en: After successfully joining the computer to the domain, you will be prompted
    to reboot. To finish you should do so.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在成功将计算机加入域后，系统会提示您重启。为了完成该过程，您应进行重启。
- en: Install the admin workstation in the same way, but do not forget that the VM's
    network interface should be in a bridge mode with the static IP address 10.0.1.30
    and it should be connected to the appropriate switch port. Do not forget to create
    an administrative user account on the domain controller and log it in on the admin's
    workstation.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 按照相同的方式安装管理员工作站，但不要忘记虚拟机的网络接口应设置为桥接模式，静态IP地址为10.0.1.30，并且应连接到适当的交换机端口。不要忘记在域控制器上创建一个管理员用户账户，并在管理员工作站上登录该账户。
- en: Certification authority services
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 认证机构服务
- en: In any modern organization, there is an important security subsystem called
    **cryptography**. This subsystem provides important properties of information
    security such as confidentiality, integrity, and authenticity. All three of these
    are needed in secure transport, management, and access. Cryptography and security
    mechanisms built on it are a vast topic and out of the scope of our book. But
    we are going to briefly demonstrate how to create a certificate system based on
    OpenSSL.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何现代化的组织中，都有一个重要的安全子系统叫做**加密学**。这个子系统提供了信息安全的重要属性，如机密性、完整性和真实性。所有这三项属性在安全传输、管理和访问中都是必需的。加密学以及基于它的安全机制是一个庞大的话题，超出了我们书籍的范围。但我们将简要演示如何基于OpenSSL创建证书系统。
- en: OpenSSL is a free software utility. You can download a binary copy to run on
    your Windows installation from [https://www.openssl.org/community/binaries.html](https://www.openssl.org/community/binaries.html).
    OpenSSL is all you need to create your own private certificate authority.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: OpenSSL是一个免费的软件工具。您可以从[https://www.openssl.org/community/binaries.html](https://www.openssl.org/community/binaries.html)下载Windows版本的二进制文件。OpenSSL是创建您自己的私有证书机构所需的全部工具。
- en: So, download this software and extract in a folder on one of your servers. In
    our case, we use `C:\OpenSSL\` directory on our domain controller (`dc.lab.local`).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，下载此软件并在您的服务器之一的文件夹中解压。在我们的例子中，我们在域控制器（`dc.lab.local`）上的`C:\OpenSSL\`目录中使用它。
- en: 'The process for creating our own certificate authority is pretty straightforward:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 创建我们自己的证书机构的过程相当简单：
- en: Create a private key.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建私钥。
- en: Self sign.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 自签名。
- en: Install a root CA on workstations.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在工作站上安装根CA。
- en: 'Once we do that, every service that we used can be protected by a certificate
    created with the following steps:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦完成这些操作，我们所使用的每个服务都可以通过以下步骤创建的证书来进行保护：
- en: Create a certificate.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建证书。
- en: Sign the certificate with a root CA key.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用根CA密钥签署证书。
- en: Creating a root certificate
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建根证书
- en: 'First, we need to generate a root key which will be used further in a root
    certificate. It can be done with the following command:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要生成一个根密钥，它将用于后续的根证书。可以使用以下命令来完成此操作：
- en: '[PRE1]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Here:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这里：
- en: '`2048`: This is our key length in bits'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`2048`：这是我们的密钥长度，单位为位'
- en: '`rootCA.key`: This is a filename of our root key'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`rootCA.key`：这是我们的根密钥文件名'
- en: 'After that, we execute a second command for creating a self-signed root certificate:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们执行第二个命令来创建一个自签名的根证书：
- en: '[PRE2]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Here:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 这里：
- en: '`rootCA.key`: This is our secret key of CA'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`rootCA.key`：这是我们的CA私钥'
- en: '`1200`: This is the validity period of our certificate in days (1,200 days
    approximately equals 3 years)'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`1200`：这是我们的证书有效期，以天为单位（1,200天大约等于3年）'
- en: 'Here, we are asked a few questions; you can answer them as you like:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们会被问到几个问题，你可以根据自己的喜好回答：
- en: '[PRE3]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'After these manipulations, we have two files:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在这些操作之后，我们得到了两个文件：
- en: '`rootCA.crt`: A public key for installation on servers or workstations and
    also for public distribution'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`rootCA.crt`：用于安装在服务器或工作站上的公钥，也可供公开分发'
- en: '`rootCA.key`: A private key, which should be in secret'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`rootCA.key`：私钥，应保密'
- en: Now, we can create certificates for our services and install a root certificate
    to our workstations.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以为我们的服务创建证书，并将根证书安装到我们的工作站中。
- en: Creating a working certificate
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建工作证书
- en: 'So, let''s create a certificate (for example, for some web service) signed
    by our CA. This process is pretty simple:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，让我们创建一个由我们的CA签名的证书（例如，为某个Web服务）。这个过程相当简单：
- en: 'Generate a key:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成密钥：
- en: '[PRE4]'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Create the certificate signing request:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建证书签名请求：
- en: '[PRE5]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Here, it is important to specify the name of the server: domain or IP (in our
    case, `web.lab.local`):'
  id: totrans-158
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这里，指定服务器的名称非常重要：域名或IP（在我们的例子中是`web.lab.local`）：
- en: '[PRE6]'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We should sign a certificate request by our root certificate:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们应该使用我们的根证书签署证书请求：
- en: '[PRE7]'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Installing a root certificate
  id: totrans-162
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装根证书
- en: Now, we can install a root certificate into our servers and workstations. For
    this, we will need to install the root certificate into trusted host certificate
    repositories. Some browsers use the default operating system repository. For instance,
    in Windows, both Internet Explorer and Chrome use the default certificate management.
    They both take you to the same place, the Windows certificate repository. So,
    we can open Internet Explorer and go to **Internet Options** | **Content** | **Certificates**.
    Now, we can install the root CA certificate under the **Trusted Root Certificate
    Authorities** tab. However, Windows Firefox has its own certificate repository,
    so if you use IE or Chrome as well as Firefox, you will have to install the root
    certificate into both the Windows repository and the Firefox repository.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以在我们的服务器和工作站中安装根证书。为此，我们需要将根证书安装到受信任的主机证书存储库中。一些浏览器使用默认的操作系统存储库。例如，在Windows中，Internet
    Explorer和Chrome都使用默认的证书管理。它们都会把你带到同一个地方——Windows证书存储库。所以，我们可以打开Internet Explorer，进入**Internet选项**
    | **内容** | **证书**。现在，我们可以将根CA证书安装在**受信任的根证书颁发机构**标签下。然而，Windows上的Firefox有自己的证书存储库，所以如果你同时使用IE或Chrome以及Firefox，你将需要将根证书安装到Windows存储库和Firefox存储库中。
- en: Note
  id: totrans-164
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A good manual about building CAs based on OpenSSL is located at [https://jamielinux.com/docs/openssl-certificate-authority/index.html](https://jamielinux.com/docs/openssl-certificate-authority/index.html).
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 有关基于OpenSSL构建CA的好手册，见于[https://jamielinux.com/docs/openssl-certificate-authority/index.html](https://jamielinux.com/docs/openssl-certificate-authority/index.html)。
- en: Installing a remote management service
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装远程管理服务
- en: Now that we have prepared servers and the ability to create security certificates,
    let's look at the possibility of installing a secure remote management service
    for our servers. The best solution for this purpose is SSH.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好服务器，并且具备了创建安全证书的能力，让我们来看一下为我们的服务器安装安全远程管理服务的可能性。为此，最好的解决方案是SSH。
- en: '**SSH** (short for **Secure Shell**) is a network application layer protocol
    that allows remotely managing operating systems and the tunneling of TCP connections
    (for example, to transfer files). It has similar functionality as telnet or rlogin,
    but unlike them, it encrypts all traffic, including transmitted passwords. SSH
    clients and SSH servers are available for most network operating systems.'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '**SSH**（即**安全外壳**的缩写）是一个网络应用层协议，允许远程管理操作系统并进行TCP连接的隧道传输（例如，传输文件）。它具有类似于telnet或rlogin的功能，但与它们不同的是，它对所有流量进行加密，包括传输的密码。大多数网络操作系统都提供SSH客户端和SSH服务器。'
- en: While SSH is built-in in all Linux server distributions, Windows does not have
    it by default and we would like to install it in order to make our lab more complicated,
    which is always good for attack practicing.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然SSH在所有Linux服务器发行版中都是内置的，但Windows默认没有SSH，因此我们希望安装它，以便使我们的实验环境更加复杂，这对于攻击练习来说总是好的。
- en: There are several solutions in the software market, but in our laboratory we
    are using freeSSHd. Like its name says, freeSSHd is a free, simple implementation
    of an SSH server that provides full functionality of SSH protocol.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 市场上有多个软件解决方案，但在我们的实验室中我们使用的是freeSSHd。顾名思义，freeSSHd是一个免费的、简单的SSH服务器实现，提供了SSH协议的完整功能。
- en: 'The installation packet can be found on the website [http://www.freesshd.com/?ctt=download](http://www.freesshd.com/?ctt=download).
    After downloading and installing freeSSHd, we can start freeSSHd as a normal application
    or as a Windows service. In the management application, we can set up the main
    parameters:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 安装包可以在网站[http://www.freesshd.com/?ctt=download](http://www.freesshd.com/?ctt=download)找到。下载并安装freeSSHd后，我们可以像正常应用程序一样启动freeSSHd，或者作为Windows服务启动。在管理应用程序中，我们可以设置主要参数：
- en: Start or stop SSH server
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 启动或停止SSH服务器
- en: Select encryption cipher
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择将使用的加密算法
- en: Traffic tunneling parameters
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 流量隧道参数
- en: Manage host restrictions
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理主机限制
- en: Setup interface and port number which will be used
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置将使用的接口和端口号
- en: Setup command shell that will be used
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置将使用的命令行
- en: Select encryption key that will be used (this is the most important one)
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择将使用的加密密钥（这是最重要的一项）
- en: All parameters are intuitive, so we will not be consider them in detail. But
    we will consider user management as the most important part of it at the moment.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 所有参数都很直观，因此我们不会详细讨论它们。但是，我们会将用户管理作为当前最重要的部分来考虑。
- en: 'In the **Users** tab we have three buttons: **New**, **Edit**, and **Remove**.
    Click on **New** and the **User properties** window appears. Here, we should choose
    the authorization method. We have three options:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在**用户**标签页中，我们有三个按钮：**新建**、**编辑**和**删除**。点击**新建**，会弹出**用户属性**窗口。在这里，我们需要选择授权方法。我们有三个选项：
- en: '**NT authentications** (Use functionality of the operating system)'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**NT身份验证**（使用操作系统的功能）'
- en: '**Password stored as SHA1 hash** (Use built-in functionality of freeSSHd)'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**密码以SHA1哈希形式存储**（使用freeSSHd的内建功能）'
- en: '**Public key (SSH only)**'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**公钥（仅限SSH）**'
- en: Since we have a domain and we can use domain user authentication procedures,
    let's select **NT authentication**. We need to specify the domain name in the
    **Domain** textbox; in our case, it is `lab.local`. In the **Login** textbox,
    we should enter the username of the existing domain user. After all of this, let's
    set up rights which will be granted to this user by checking the appropriate fields
    in the **User can use** section (shell, file transfers, and traffic tunneling).
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们有一个域，并且可以使用域用户身份验证程序，因此选择**NT身份验证**。我们需要在**域**文本框中指定域名；在我们的案例中，它是`lab.local`。在**登录**文本框中，我们应该输入现有域用户的用户名。完成这些后，选择在**用户可以使用**部分中将授予该用户的权限（命令行、文件传输和流量隧道）。
- en: After the user account is created and the service is started, we can try to
    connect to our management service on a remote server.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在用户账户创建并且服务启动后，我们可以尝试连接到远程服务器上的管理服务。
- en: Note
  id: totrans-186
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Windows servers are usually managed using native Windows solutions like Remote
    Desktop, but in our case we want to have a complicated and vulnerable instance.
    Thus, we add excessive functions and software.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: Windows服务器通常通过原生的Windows解决方案如远程桌面来管理，但在我们的案例中，我们希望拥有一个复杂且脆弱的实例。因此，我们添加了过多的功能和软件。
- en: Corporative e-mail service
  id: totrans-188
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 企业电子邮件服务
- en: In our lab, we simulate a small organization and the base of IT services of
    any organization information infrastructure is the ability to exchange information
    between users. Usually, the interaction between users is organized on the basis
    of e-mail, which has become the de facto standard. So, we cannot miss the e-mail
    service. As a solution to organize e-mail, we will consider free software hMailServer.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的实验室中，我们模拟了一个小型组织，而任何组织信息基础设施的IT服务基础是用户之间信息交换的能力。通常，用户之间的互动是基于电子邮件进行的，而电子邮件已成为事实上的标准。因此，我们不能忽视电子邮件服务。为了解决电子邮件问题，我们将考虑使用免费的hMailServer软件。
- en: hMailServer is a free e-mail server for the Windows platform. It runs as a Windows
    service and includes administration and backup tools. It supports mail protocols
    IMAP, POP3, and SMTP. To store the settings and indexes hMailServer uses a database
    such as MySQL, MS SQL, or PostgreSQL, e-mail messages are stored on the hard drive
    in the MIME format.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: hMailServer是一个适用于Windows平台的免费电子邮件服务器。它作为Windows服务运行，并包括管理和备份工具。它支持IMAP、POP3和SMTP邮件协议。为了存储设置和索引，hMailServer使用如MySQL、MS
    SQL或PostgreSQL的数据库，电子邮件消息以MIME格式存储在硬盘中。
- en: hMailServer supports all the basic functions, such as multi-domain, aliases,
    and mailing lists. User authentication can be performed using the local user database
    or through Active Directory.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: hMailServer 支持所有基本功能，例如多域、别名和邮件列表。用户身份验证可以通过本地用户数据库或通过 Active Directory 来执行。
- en: Well, let's start to install hMailServer, but before we start we need to configure
    our DNS server.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 好了，让我们开始安装 hMailServer，但在开始之前，我们需要配置我们的 DNS 服务器。
- en: Configuring a DNS server
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 DNS 服务器
- en: To be able to receive e-mails, we must set up MX records for our domain. The
    MX records are entries in the DNS server that tells other computers on the net
    which computer (hostname) is hosting the e-mail service for our domain.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够接收电子邮件，我们必须为我们的域设置 MX 记录。MX 记录是 DNS 服务器中的条目，它告诉网络上的其他计算机哪个计算机（主机名）正在为我们的域托管电子邮件服务。
- en: We can do this in the DNS management snap-in of our domain controller, which
    serves as our additional DNS server. So, let's interact with the domain controller
    and start the **DNS** snap-in by selecting the **DNS** item in the **Administrative
    Tools** folder of the **Start** menu.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以在域控制器的 DNS 管理插件中执行此操作，域控制器作为我们的附加 DNS 服务器。因此，让我们与域控制器进行交互，通过在 **开始** 菜单的
    **管理工具** 文件夹中选择 **DNS** 项来启动 **DNS** 插件。
- en: In the DNS tree on the left-hand side panel of the opened snap-in, expand the
    **Forward Lookup Zones** item corresponding to our domain controller (DC). Now,
    select the item that's our domain (`lab.local`). In the right-hand side panel,
    we can see a list of DNS records that exist at this moment. Now, we should check
    for the existing DNS A-record of the server on which we will install hMailServer.
    If such a record does not exist, let's add it. Right-click to open the context
    menu and select **New Host (A or AAAA)…** for creating a DNS A-record. In the
    opened window, we have to enter the name of our mail server and its IP address
    that will be pointed by the name. Then, click on the **Add Host** button.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在打开的插件的左侧面板中的 DNS 树中，展开与我们域控制器（DC）对应的 **Forward Lookup Zones** 项。现在，选择我们域（`lab.local`）的项。在右侧面板中，我们可以看到当前存在的
    DNS 记录列表。现在，我们应该检查将要安装 hMailServer 的服务器的 DNS A 记录。如果不存在这样的记录，让我们添加一个。右键单击打开上下文菜单，并选择
    **新建主机（A 或 AAAA）…** 来创建 DNS A 记录。在打开的窗口中，我们需要输入邮件服务器的名称及其将由名称指向的 IP 地址。然后，点击 **添加主机**
    按钮。
- en: 'In our case, we deploy the mail server on the domain controller host, so our
    option looks like this:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的例子中，我们将邮件服务器部署在域控制器主机上，因此我们的选项看起来是这样的：
- en: '| Name | FQDN | IP address |'
  id: totrans-198
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | FQDN | IP 地址 |'
- en: '| --- | --- | --- |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `mail` | `mail.lab.local` | 10.0.0.2 |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| `mail` | `mail.lab.local` | 10.0.0.2 |'
- en: After creating the DNS A-record of the mail server or if A-record already exists,
    we should add MX-record. We can to do this like we added A-record, but select
    the **New Mail Exchanger (MX)…** item instead of **New Host (A or AAAA)…**. In
    the window that opens, we should leave the **Host or child domain** textbox blank
    and enter the name of our mail server (in our case `mail.lab.local`) in the **FQDN
    of mail server** textbox.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建了邮件服务器的 DNS A 记录后，或者如果 A 记录已经存在，我们应该添加 MX 记录。我们可以像添加 A 记录一样执行此操作，但选择 **新建邮件交换器（MX）…**
    项，而不是 **新建主机（A 或 AAAA）…**。在打开的窗口中，我们应该将 **主机或子域** 文本框留空，并在 **邮件服务器的 FQDN** 文本框中输入我们的邮件服务器名称（在我们这个例子中是
    `mail.lab.local`）。
- en: 'The result will be something like this:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 结果会像这样：
- en: '![Configuring a DNS server](../images/00027.jpeg)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![配置 DNS 服务器](../images/00027.jpeg)'
- en: DNS zone contents
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: DNS 区域内容
- en: Installing and configuring hMailServer
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装和配置 hMailServer
- en: So it is time to install hMailServer. The latest version can be downloaded from
    the website ([https://www.hmailserver.com/download](https://www.hmailserver.com/download)).
    The installation process is simple. Run through the installation wizard and it
    should not cause problems. At the end of the installation, the existing wizard
    will prompt for an administrator password.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是安装 hMailServer 的时候了。可以从网站下载最新版本（[https://www.hmailserver.com/download](https://www.hmailserver.com/download)）。安装过程简单。按照安装向导进行操作，不应该出现问题。安装结束时，现有的向导会提示输入管理员密码。
- en: 'Start hMailServer Administrator (management console) and create a new connection
    to localhost. After hMailServer Administrator is launched and the connection to
    a server is established, configure our mail server for our domain (`lab.local`).
    It takes a bit of time and consists of the following basic steps:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 启动 hMailServer 管理员（管理控制台），并创建一个到本地主机的连接。在启动 hMailServer 管理员并与服务器建立连接后，配置我们的邮件服务器以适应我们的域（`lab.local`）。这需要一些时间，并包括以下基本步骤：
- en: In the **Domains** tab, click on the **Add** button. In the page that opens,
    enter the name of our domain (`lab.local`) in the **Domain** textbox and click
    on the **Save** button. A new domain will be added.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**域**选项卡中，点击**添加**按钮。在打开的页面中，在**域**文本框中输入我们的域名（`lab.local`），然后点击**保存**按钮。新的域将被添加。
- en: Let's click on the **Accounts** subitem of the domain tree and click on the
    **Add** button on the right-hand side panel (account's page).
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击域树的**账户**子项，并在右侧面板（账户页面）上点击**添加**按钮。
- en: In the page that opens, go to the **Active Directory** tab, we should check
    the **Active Directory account** option and enter the domain and user name of
    the existing domain user for whom we create the mail account. In the **General**
    tab, we should enter the address of the mailbox for the current account in the
    **Address** textbox.
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在打开的页面中，进入**Active Directory**选项卡，我们应检查**Active Directory账户**选项，并输入我们为现有域用户创建邮件账户时的域名和用户名。在**常规**选项卡中，我们应在**地址**文本框中输入当前账户的邮箱地址。
- en: Click on the **Save** button.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**按钮。
- en: Now on the list of accounts, we have ready sample user mail boxes:![Installing
    and configuring hMailServer](../images/00028.jpeg)
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在账户列表中，我们有现成的示例用户邮箱：![安装和配置hMailServer](../images/00028.jpeg)
- en: Mail accounts list
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 邮件账户列表
- en: Go to **Settings** | **Protocols** | **SMTP** | **Delivery of email** and in
    the hostname setting, enter the hostname of our server (`mail.lab.local`).
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**设置** | **协议** | **SMTP** | **邮件投递**，在主机名设置中输入我们的服务器主机名（`mail.lab.local`）。
- en: Now, we have a working mail server ready and we can use configured mail client
    software for sending and receiving mail messages.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们有了一个工作邮件服务器，可以使用配置好的邮件客户端软件发送和接收邮件。
- en: 'Next, you should walk through the mail server settings for creating hardening
    configuration. You can do, for example, the following:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您应该完成邮件服务器设置以创建硬化配置。例如，您可以执行以下操作：
- en: Change standard ports of SMTP, POP3, and IMAP protocols and set connection security
    for using SSL/TLS based on the security certificate, which can be created on our
    certification authority (described earlier)
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改SMTP、POP3和IMAP协议的标准端口，并根据安全证书设置使用SSL/TLS的连接安全性，这些证书可以在我们的认证机构（前面已描述）上创建。
- en: Set to use only TLSv1.2
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置为仅使用TLSv1.2
- en: Create a backup copy
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建备份副本
- en: Configure a built-in anti-spam subsystem
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置内置的反垃圾邮件子系统
- en: Note
  id: totrans-221
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: More information about hMailServer is available at [https://www.hmailserver.com/documentation/latest/?page=overview](https://www.hmailserver.com/documentation/latest/?page=overview).
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 有关hMailServer的更多信息，请访问[https://www.hmailserver.com/documentation/latest/?page=overview](https://www.hmailserver.com/documentation/latest/?page=overview)。
- en: Now that we have created a working instance of a mail server, other possibilities
    can be explored.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经创建了一个可用的邮件服务器实例，可以进一步探索其他可能性。
- en: Installing vulnerable services
  id: totrans-224
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装易受攻击的服务
- en: The easiest way to prepare most of the servers and network services that you
    will need for your penetration testing trainings is to download preconfigured
    VM images intentionally left vulnerable (vulnerable virtual machines). Such vulnerable
    VMs are the best way to get instances prepared for practicing various attacks
    but save your time on downloading and installing everything on your own.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 准备大多数服务器和网络服务以供渗透测试培训使用的最简单方法是下载故意留下漏洞的预配置虚拟机镜像（易受攻击的虚拟机）。这些易受攻击的虚拟机是为练习各种攻击而准备实例的最佳方式，同时节省了自行下载和安装所有内容的时间。
- en: Tip
  id: totrans-226
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Staying safe with preinstalled VM images**'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '**使用预安装的虚拟机镜像保持安全**'
- en: You probably know any sources of preinstalled VM images than those which we
    have mentioned in this chapter and you probably would like to use them for downloading
    and using certain images in your lab. But be careful and check whether the sources
    are trusted enough before using them to obtain an image, as there is a big risk
    that untrusted sources can distribute potentially dangerous images containing
    malware. Such images can pose high security risks not only for your lab, but also
    for the network your lab is connected to.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能知道比本章中提到的其他预安装虚拟机镜像的来源，并且你可能希望在实验室中下载并使用它们。然而，要小心，并在使用它们获取镜像之前检查这些来源是否足够可信，因为不可信的来源可能会分发含有恶意软件的潜在危险镜像。这些镜像不仅对您的实验室构成高安全风险，也可能对您的实验室连接的网络造成威胁。
- en: Let's include the most useful and well-known of them into our lab network.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将最有用和最著名的其中一些纳入我们的实验室网络。
- en: Installing web applications
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装Web应用程序
- en: Nowadays when a lot of businesses are going online or at least have to be present
    on the Web, penetration testers mostly deal with web applications rather than
    with infrastructure pentests. Therefore, it is essential for a penetration tester
    to acquire web application hacking skills and improve them constantly.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，许多企业正在上线或至少需要在 Web 上存在，渗透测试人员主要处理的是 Web 应用程序，而不是基础架构渗透测试。因此，渗透测试人员掌握 Web
    应用程序攻击技能并不断提升至关重要。
- en: Tip
  id: totrans-232
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**Working with limited computing resources**'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: '**使用有限的计算资源**'
- en: If you experience a lack of computing power for creating other virtual servers,
    you can install all web applications on the same server. Alternatively, you can
    install some of them on the "attacker's machine" or the penetration testing machine
    that you are going to use for hacking.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在创建其他虚拟服务器时遇到计算能力不足的问题，可以将所有 Web 应用程序安装在同一台服务器上。或者，您可以将其中一些安装在“攻击者机器”或用于黑客攻击的渗透测试机器上。
- en: We will use a **LAMP** (**Linux, Apache, and MySQL*PHP**) server based on Ubuntu
    Server 14.03.4 LTS to install web applications. But if you prefer to use Windows
    for some reason, you can use XAMPP—an Apache distribution containing MySQL, PHP,
    and Perl.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用基于 Ubuntu Server 14.03.4 LTS 的 **LAMP**（**Linux, Apache 和 MySQL*PHP**）服务器安装
    Web 应用程序。但如果出于某种原因您更喜欢使用 Windows，则可以使用 XAMPP —— 这是一个包含 MySQL、PHP 和 Perl 的 Apache
    发行版。
- en: Preparing a web server
  id: totrans-236
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备一个 Web 服务器
- en: 'We will install all our lab web applications on the same web server under Ubuntu
    Server 14.0.3.4 LTS in a NAT mode without connecting the VM to our lab network
    yet. Then, we will change the network interface mode and settings according to
    our lab network settings. The steps are as follows:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在 Ubuntu Server 14.0.3.4 LTS 下的同一个 Web 服务器上安装所有实验 Web 应用程序，处于 NAT 模式，暂不连接
    VM 到实验室网络。接下来，我们将根据实验室网络设置更改网络接口模式和设置。步骤如下：
- en: As a first step, download the latest Ubuntu Server `.iso` installation image
    from the official website.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，从官方网站下载最新的 Ubuntu Server `.iso` 安装镜像。
- en: Create a new 64-bit Ubuntu-based VirtualBox VM with 1024 MB RAM and a dynamically
    allocated hard drive.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的 64 位 Ubuntu 虚拟机，分配 1024 MB RAM 和一个动态分配的硬盘。
- en: Insert the installation image into the VM's CD/DVD drive and start the VM.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将安装镜像插入 VM 的 CD/DVD 驱动器并启动 VM。
- en: Install the Ubuntu Server by answering the installation dialog questions. The
    process is quite straightforward until you are asked which services to install
    (don't forget the account password that you provided during the installation).![Preparing
    a web server](../images/00029.jpeg)
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过回答安装对话框中的问题安装 Ubuntu 服务器。这个过程非常简单，直到要求选择要安装的服务（不要忘记安装过程中提供的帐户密码）。![准备一个 Web
    服务器](../images/00029.jpeg)
- en: Services installation dialog
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 服务安装对话框
- en: Chose OpenSSH and LAMP servers and continue the installation.
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 OpenSSH 和 LAMP 服务器，然后继续安装。
- en: Enter a MySQL root password when asked and be sure you don't forget it—you will
    need it later.
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在询问时输入 MySQL root 密码，并确保不要忘记 —— 以后会用到。
- en: Reboot the VM and log in under the account created during the installation.
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新启动虚拟机，并使用安装过程中创建的帐户登录。
- en: Now, we need to configure the correct networking settings in order to be able
    to access the Internet for software installation and at the same time have a static
    IP to access web applications.
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在，我们需要配置正确的网络设置，以便能够访问 Internet 进行软件安装，同时具有静态 IP 以访问 Web 应用程序。
- en: Set up the VM's network interface in a bridge mode and select the physical interface
    to which the virtual one should be bridged.
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在桥接模式下设置 VM 的网络接口，并选择要将虚拟接口桥接到的物理接口。
- en: 'First, we need to switch the Network Manager service into the manually starting
    mode so that it does not reset our networking settings after every reboot. Run
    the following commands to do it:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，我们需要将 Network Manager 服务切换到手动启动模式，这样它在每次重启后不会重置我们的网络设置。运行以下命令来完成此操作：
- en: '[PRE8]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Now, let''s set the new network settings by editing the file `/etc/network/interfaces`.
    Change or add the following settings for the interface `eth0`:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，通过编辑文件 `/etc/network/interfaces` 来设置新的网络设置。为 `eth0` 接口更改或添加以下设置：
- en: '[PRE9]'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Restart the networking service with the following command or just reboot the
    VM to apply the changes and check the interface settings with the `ifconfig` command:'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令重新启动网络服务，或者直接重新启动 VM 以应用更改，并使用 `ifconfig` 命令检查接口设置：
- en: '[PRE10]'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: You should be able to plug in a network cable and access the Internet.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该能够插入网络电缆并访问 Internet。
- en: Alternatively, you can use a NAT mode to download all the necessary software
    and then switch the VM to a host-only network mode, which allows the host machine
    and other guest machines access to your current one. You can use the VM in this
    mode as a standalone web server for direct web application attacks and perform
    the four networking configuration steps listed in the preceding list when you
    want to connect the VM to your lab network.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你可以使用 NAT 模式下载所有必要的软件，然后将虚拟机切换到主机专用网络模式，这样主机和其他客户机就可以访问你的当前虚拟机。在此模式下，你可以将虚拟机作为独立的
    Web 服务器，用于直接的 Web 应用程序攻击，并在需要将虚拟机连接到实验室网络时执行前面列表中的四个网络配置步骤。
- en: 'Let''s install the necessary prerequisites:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们安装必要的先决条件：
- en: 'We need Java 6 or higher for our web applications to work. Check if it is installed
    with the command `java -version` and use `apt-get` to install it if not. We are
    installing OpenJDK 7:'
  id: totrans-257
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要 Java 6 或更高版本才能让 Web 应用程序正常工作。使用命令 `java -version` 检查是否已安装，如果没有，请使用 `apt-get`
    安装它。我们正在安装 OpenJDK 7：
- en: '[PRE11]'
  id: totrans-258
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'You will also need the `unzip` utility installed in order to unpack the web
    application''s archives, so let''s install it first:'
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你还需要安装 `unzip` 工具，以便解压 Web 应用程序的档案文件，所以我们先安装它：
- en: '[PRE12]'
  id: totrans-260
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: At this point, our web server is ready for installing web applications.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我们的 Web 服务器已准备好安装 Web 应用程序。
- en: WebGoat
  id: totrans-262
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: WebGoat
- en: The OWASP project WebGoat ([https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project](https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project))
    is one the most known vulnerable web applications for learning purposes. The coolest
    thing about WebGoat is that it not only offers you some vulnerabilities for exploitation,
    but also involves you in the fixing process offering to change the application's
    source code. It is extremely helpful for developing really useful effective vulnerability
    fix recommendations when a penetration tester has not much of a web development
    background.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: OWASP 项目 WebGoat ([https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project](https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project))
    是最知名的用于学习目的的漏洞 Web 应用程序之一。WebGoat 最酷的地方在于，它不仅提供了一些漏洞供你利用，还让你参与修复过程，提供修改应用程序源代码的机会。这对那些没有太多
    Web 开发背景的渗透测试人员来说，极其有助于开发出真正有效的漏洞修复建议。
- en: WebGoat is distributed as a web application package rather than a VM image and
    you need to have a prepared server first in order to be able to run it.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: WebGoat 是作为 Web 应用程序包而非虚拟机镜像分发的，你需要先准备好服务器才能运行它。
- en: 'As we have already prepared a server, let''s get the WebGoat application running:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们已经准备好服务器，让我们开始运行 WebGoat 应用程序：
- en: 'Download the web application package from GitHub. You can do it with the `wget`
    utility, but check if you are downloading the latest version:'
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 GitHub 下载 Web 应用程序包。你可以使用 `wget` 工具进行下载，但请确认你下载的是最新版本：
- en: '[PRE13]'
  id: totrans-267
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Run the web application:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行 Web 应用程序：
- en: '[PRE14]'
  id: totrans-269
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Check if the app works by opening the browser on another machine and navigate
    to `http://10.0.0.5:8080/WebGoat` (the URI is case sensitive).
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在另一台机器上打开浏览器并访问 `http://10.0.0.5:8080/WebGoat` 来检查应用程序是否正常工作（URI 是区分大小写的）。
- en: '![WebGoat](../images/00030.jpeg)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![WebGoat](../images/00030.jpeg)'
- en: WebGoat login screen
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: WebGoat 登录界面
- en: DVWA
  id: totrans-273
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DVWA
- en: Another example of a useful web application for penetration testing training
    is **Damn Vulnerable Web Application** ([http://www.dvwa.co.uk](http://www.dvwa.co.uk))
    written in PHP and using MySQL. It contains all the vulnerabilities from the OWASP
    top-10 list and allows us to use the web application in three security levels
    corresponding to different pentesting skill levels.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个用于渗透测试训练的有用 Web 应用程序示例是 **Damn Vulnerable Web Application** ([http://www.dvwa.co.uk](http://www.dvwa.co.uk))，它是用
    PHP 编写并使用 MySQL 的。它包含 OWASP Top 10 列表中的所有漏洞，并允许我们在三个安全级别下使用该 Web 应用程序，分别对应不同的渗透测试技能水平。
- en: 'Let''s see how to install and run DVWA:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何安装和运行 DVWA：
- en: 'Log in and change the current directory to the Apache''s default directory:'
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录并将当前目录更改为 Apache 的默认目录：
- en: '[PRE15]'
  id: totrans-277
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Download the application''s archive and unpack it:'
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载应用程序的档案并解压：
- en: '[PRE16]'
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now, we need to configure a MySQL connection. Open the file `DVWA-1.0.8/config/config.inc.php`
    in an editor and find the following line:'
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们需要配置 MySQL 连接。用编辑器打开文件 `DVWA-1.0.8/config/config.inc.php` 并找到以下行：
- en: '[PRE17]'
  id: totrans-281
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Change `p@ssw0rd` to the MySQL root password that you set during the server
    installation process and save the file.
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `p@ssw0rd` 更改为你在服务器安装过程中设置的 MySQL 根密码，并保存文件。
- en: 'Change the DVWA directory''s name (in convenience consideration) and permissions:'
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更改 DVWA 目录的名称（考虑到便捷性）和权限：
- en: '[PRE18]'
  id: totrans-284
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Log in into MySQL and create a database for DVWA:'
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录 MySQL 并为 DVWA 创建一个数据库：
- en: '[PRE19]'
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Now, you need to navigate from another machine's browser to the DVWA setup interface
    (we use the server's IP 10.0.0.5 assuming you have already set the static networking
    settings) `http://10.0.0.5/dvwa/setup.php` and click on the **Create/Reset Database**
    button.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，您需要从另一台机器的浏览器导航到 DVWA 设置界面（我们使用服务器的 IP 10.0.0.5，假设您已经设置了静态网络设置）`http://10.0.0.5/dvwa/setup.php`，然后单击**创建/重置数据库**按钮。
- en: You can now navigate to `http://10.0.0.5/dvwa/login.php`, log in with the default
    credentials `admin:password`, and use the application.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以导航到 `http://10.0.0.5/dvwa/login.php`，使用默认凭据 `admin:password` 登录，并使用该应用程序。
- en: '![DVWA](../images/00031.jpeg)'
  id: totrans-289
  prefs: []
  type: TYPE_IMG
  zh: '![DVWA](../images/00031.jpeg)'
- en: DVWA is ready to be hacked
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: DVWA 已准备好被黑客攻击
- en: Liferay Portal
  id: totrans-291
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Liferay 门户
- en: One of the web applications that we frequently meet during penetration tests
    is Liferay Portal. It is an open source, portlet-based enterprise **Content Management
    System** (**CMS**) that can be customized to fulfill various business needs. Liferay
    Portal is written in Java and is used for both intranet and external web portals.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试中经常遇到的 Web 应用程序之一是 Liferay 门户。它是一个基于开源、基于 Portlet 的企业**内容管理系统**（**CMS**），可以根据各种业务需求进行定制。Liferay
    门户是用 Java 编写的，用于企业内部网和外部 Web 门户。
- en: Its popularity on the market means that you probably will meet it if you conduct
    commercial penetration tests for your customers and you probably want to know
    in advance how to approach it in the context of hacking. What is especially cool
    with Liferay in our current context is that there is not only a commercial, but
    also a community version of the portal available.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 它在市场上的受欢迎程度意味着，如果您为客户进行商业渗透测试，很可能会遇到它，并且您可能希望提前了解如何在黑客环境中处理它。在我们当前的情况下，Liferay
    特别酷的地方是，不仅有商业版本，还有社区版本的门户可用。
- en: The **Community edition** (**CE**) is distributed for free and you can download
    it at Liferay's website [http://www.liferay.com](http://www.liferay.com) without
    a registration. Since we need it for learning and research purposes, you will
    not have any legal or licensing problems.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: '**社区版**（**CE**）是免费分发的，您可以在 Liferay 的网站[http://www.liferay.com](http://www.liferay.com)上下载，无需注册。由于我们需要用于学习和研究目的，您不会遇到任何法律或许可问题。'
- en: We are going to install Liferay Portal CE on a server under the Ubuntu Server
    14 operating system, and it is easier to prepare a server first and then download
    Liferay directly to a VM.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在 Ubuntu Server 14 操作系统下的服务器上安装 Liferay 门户 CE，最好先准备好服务器，然后直接将 Liferay 下载到虚拟机中。
- en: 'Let''s list the steps you need to make in order to get your working server
    with a running Liferay Portal:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们列出您需要采取的步骤，以便获得运行 Liferay 门户的工作服务器：
- en: Download a zip-archive of the community edition from the official Liferay website
    ([http://www.liferay.com/de/downloads/liferay-portal/available-releases](http://www.liferay.com/de/downloads/liferay-portal/available-releases)).
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从官方 Liferay 网站（[http://www.liferay.com/de/downloads/liferay-portal/available-releases](http://www.liferay.com/de/downloads/liferay-portal/available-releases)）下载社区版的
    zip 存档。
- en: Unpack the archive to the `/srv/` directory.
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将存档解压缩到 `/srv/` 目录。
- en: 'Start Tomcat with the following command (putting the correct version numbers):'
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令启动 Tomcat（放置正确的版本号）：
- en: '[PRE20]'
  id: totrans-300
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Wait for a minute or two, depending on the hardware of the VM.
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据虚拟机的硬件等待一两分钟。
- en: 'To check if the application started successfully and is reachable from other
    hosts, run the following command and check if the application listens on 0.0.0.0
    (all interfaces):'
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要检查应用程序是否成功启动并且可以从其他主机访问，请运行以下命令并检查应用程序是否在 0.0.0.0（所有接口）上监听：
- en: '[PRE21]'
  id: totrans-303
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![Liferay Portal](../images/00032.jpeg)'
  id: totrans-304
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![Liferay 门户](../images/00032.jpeg)'
- en: Listening web server
  id: totrans-305
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 监听 Web 服务器
- en: Open a browser on another machine and navigate to `http://10.0.0.5:8080`. You
    should see the basic configuration dialog:![Liferay Portal](../images/00033.jpeg)
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在另一台机器上的浏览器中打开，并导航到 `http://10.0.0.5:8080`。您应该看到基本配置对话框：![Liferay 门户](../images/00033.jpeg)
- en: Liferay basic configuration page
  id: totrans-307
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Liferay 基本配置页面
- en: You can change the values if you want, but do not uncheck the **Add Sample Data**
    checkbox because it will be useful when you research the portal.
  id: totrans-308
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您愿意，可以更改值，但不要取消选中**添加示例数据**复选框，因为在研究门户时它会很有用。
- en: Click on **Finish configuration** and wait for a while until the installation
    process is finished.
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击**完成配置**，等待一段时间，直到安装过程完成。
- en: Then, navigate to the portal and read and accept the user agreement.
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，导航到门户并阅读并接受用户协议。
- en: Now Liferay Portal is installed and ready to use in our lab. You can already
    start playing around with the portal in order to understand how it works, review
    the portal's internal structure and configs, and so on.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 现在 Liferay Portal 已经安装并准备好在我们的实验室中使用。你可以开始探索这个门户，了解它是如何工作的，检查门户的内部结构和配置，等等。
- en: The portal is already filled with some sample data, but you can go further and
    create an account at Liferay's Marketplace ([https://www.liferay.com/marketplace/](https://www.liferay.com/marketplace/))
    to download and install other web applications to your portal.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 门户已经填充了一些示例数据，但你可以进一步创建一个 Liferay Marketplace 的帐户 ([https://www.liferay.com/marketplace/](https://www.liferay.com/marketplace/))，以便下载并安装其他
    Web 应用到你的门户。
- en: Metasploitable
  id: totrans-313
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Metasploitable
- en: Most of the popular vulnerable VM images are created to practice web application
    penetration testing, but there are VMs that are targeted more on the system and
    network software level, let's say classic hacking. They are very convenient for
    learning and practicing software and OS exploitation, fuzzing, bruteforcing, tunneling,
    privilege escalation, and so on.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数流行的漏洞虚拟机镜像是为练习 Web 应用渗透测试而创建的，但也有一些虚拟机更多地针对系统和网络软件层面，比如经典的黑客攻击。它们非常适合学习和练习软件与操作系统漏洞利用、模糊测试、暴力破解、隧道技术、权限提升等。
- en: One such VM is Metasploitable 2 (basically, the newer and extended version of
    its ancestor Metasploitable) provided by a well-known IT security company Rapid7
    and we are going to add it to our lab environment.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 其中一台虚拟机是 Metasploitable 2（基本上是其前身 Metasploitable 的更新和扩展版本），由著名的 IT 安全公司 Rapid7
    提供，我们将把它添加到我们的实验环境中。
- en: 'Let''s quote the official description of Metasploitable 2 ([https://community.rapid7.com/docs/DOC-1875](https://community.rapid7.com/docs/DOC-1875)):'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们引用 Metasploitable 2 的官方描述 ([https://community.rapid7.com/docs/DOC-1875](https://community.rapid7.com/docs/DOC-1875))：
- en: '"The Metasploitable virtual machine is an intentionally vulnerable version
    of Ubuntu Linux designed for testing security tools and demonstrating common vulnerabilities.
    Version 2 of this virtual machine is available for download and ships with even
    more vulnerabilities than the original image. This virtual machine is compatible
    with VMWare, VirtualBox, and other common virtualization platforms."'
  id: totrans-317
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “Metasploitable 虚拟机是一个故意脆弱的 Ubuntu Linux 版本，旨在测试安全工具并展示常见漏洞。该虚拟机的第二个版本可供下载，并且比原始镜像包含更多的漏洞。此虚拟机兼容
    VMWare、VirtualBox 以及其他常见的虚拟化平台。”
- en: As we understand, Metasploitable was created mainly for learning the popular
    hacking framework Metasploit Framework, but it also fits in a far bigger range
    of various penetration testing learning tasks.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 据我们了解，Metasploitable 主要是为了学习流行的黑客框架 Metasploit Framework 而创建的，但它也适用于更广泛的渗透测试学习任务。
- en: 'By default, Metasploitable 2 contains the following preinstalled network services:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Metasploitable 2 包含以下预安装的网络服务：
- en: FTP
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FTP
- en: SSH
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH
- en: Telnet
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Telnet
- en: SMTP
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMTP
- en: Web server
  id: totrans-324
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Web 服务器
- en: rlogin
  id: totrans-325
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: rlogin
- en: NFS
  id: totrans-326
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NFS
- en: MySQL
  id: totrans-327
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MySQL
- en: PostgreSQL
  id: totrans-328
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PostgreSQL
- en: VNC
  id: totrans-329
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VNC
- en: Backdoors
  id: totrans-330
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 后门
- en: 'The following attack techniques can be practiced with the listed services:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 以下攻击技术可以通过列出的服务进行练习：
- en: Information gathering
  id: totrans-332
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 信息收集
- en: Scanning
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描
- en: Buffer and stack overflow exploitation
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缓冲区和栈溢出漏洞利用
- en: Password guessing / bruteforcing
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码猜测 / 暴力破解
- en: Fuzzing
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 模糊测试
- en: Exploit development
  id: totrans-337
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞开发
- en: SMTP redirection
  id: totrans-338
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMTP 重定向
- en: Man-in-the-middle
  id: totrans-339
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 中间人攻击
- en: Privilege escalation
  id: totrans-340
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 权限提升
- en: 'The installation process of Metasploitable 2 is pretty straightforward as well
    as for the most of the preinstalled intentionally vulnerable VM images:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploitable 2 的安装过程非常简单，像大多数预安装的故意脆弱的虚拟机镜像一样：
- en: First, unpack the Metasploitable 2 `.zip` archive to the directory where you
    keep your lab VMs.
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，将 Metasploitable 2 `.zip` 压缩包解压到你保存实验室虚拟机的目录中。
- en: Then, create a 32-bit Ubuntu Linux VM with 512 MB RAM and network interface
    in a bridge mode, and chose the existing virtual disk from the Metasploitable
    2 directory (`Metasploitable.vmdk`) when VirtualBox asks you about creating a
    virtual disk.
  id: totrans-343
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，创建一个 32 位的 Ubuntu Linux 虚拟机，内存为 512 MB，并在桥接模式下配置网络接口，当 VirtualBox 提示你创建虚拟磁盘时，选择
    Metasploitable 2 目录中的现有虚拟磁盘（`Metasploitable.vmdk`）。
- en: Start the VM and log in with the default credentials `msfadmin:msfadmin`.
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机，并使用默认凭证`msfadmin:msfadmin`登录。
- en: Set your networking settings similar to what we have done on our Liferay Ubuntu
    Server, but use the correct IP address 10.0.0.3.
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将你的网络设置配置与我们在 Liferay Ubuntu 服务器上所做的类似，但请使用正确的 IP 地址 10.0.0.3。
- en: Note
  id: totrans-346
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Practicing direct attacks**'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: '**直接攻击练习**'
- en: 'If you want to practice direct attacks with Metasploitable 2, you can switch
    the VM''s network interface into the host-only network mode and hack it from a
    VM running on the same host machine. You can find a tutorial on how to do it at
    the following link: [https://community.rapid7.com/message/4137](https://community.rapid7.com/message/4137).'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想与Metasploitable 2进行直接攻击练习，你可以将虚拟机的网络接口切换到仅主机网络模式，然后从在同一主机上运行的虚拟机进行攻击。你可以在以下链接中找到相关教程：[https://community.rapid7.com/message/4137](https://community.rapid7.com/message/4137)。
- en: At this point, Metasploitable 2 is ready to receive your evil packets, have
    fun!
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 到此为止，Metasploitable 2已经准备好接收你的恶意数据包，祝你玩得开心！
- en: Vulnerable VoIP server
  id: totrans-350
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 漏洞VoIP服务器
- en: With the spread of IP networks and technologies, it became very common to have
    enterprise IP-based telephone networks and it means that you will meet those systems
    from time to time as a part of a scope infrastructure penetration testing project
    or as a separate VoIP pentest project if you are going to work on commercial projects.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 随着IP网络和技术的普及，企业基于IP的电话网络变得非常常见，这意味着如果你从事商业项目的渗透测试工作，你将时不时遇到这些系统，可能作为基础设施渗透测试项目的一部分，或者作为一个单独的VoIP渗透测试项目。
- en: In turn, it means that you would like to be well prepared for such systems and
    try to research and attack it in your lab.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 反过来，这意味着你希望为这些系统做好充分准备，并尝试在实验室中进行研究和攻击。
- en: Luckily for us, there is a preinstalled image of a vulnerable VoIP server based
    on CentOS and Asterisk called **vulnVoIP**.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 对我们来说幸运的是，已经有一个基于CentOS和Asterisk的漏洞VoIP服务器镜像，名为**vulnVoIP**。
- en: The official description and the download link can be found at the [http://www.rebootuser.com](http://www.rebootuser.com)
    under the **HackLAB** section. It is a bit old now, but it's still good for understanding
    how the technology and its hacks work.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 官方描述和下载链接可以在[http://www.rebootuser.com](http://www.rebootuser.com)的**HackLAB**部分找到。现在这个链接有些旧了，但仍然有助于理解该技术及其攻击方式。
- en: vulnVoIP is distributed as a VMware image, so you can install a free VMware
    Player software or probably you have a VMware license if you built your lab in
    an enterprise environment and you can run the image as is.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: vulnVoIP以VMware镜像的形式分发，因此你可以安装免费的VMware Player软件，或者如果你在企业环境中搭建了实验室，可能已经拥有VMware许可证，可以直接运行镜像。
- en: '![Vulnerable VoIP server](../images/00034.jpeg)'
  id: totrans-356
  prefs: []
  type: TYPE_IMG
  zh: '![漏洞VoIP服务器](../images/00034.jpeg)'
- en: Web interface on vulnVoIP
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: vulnVoIP的Web界面
- en: 'If you prefer VirtualBox, you can perform the following simple steps:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你更喜欢使用VirtualBox，你可以执行以下简单步骤：
- en: Unpack the `.7zip` vulnVoIP archive.
  id: totrans-359
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解压`.7zip`格式的vulnVoIP压缩包。
- en: Create a new 32-bit Linux-based VM. Give it a name and 512 MB RAM.
  id: totrans-360
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的32位Linux虚拟机。为其命名并分配512 MB的内存。
- en: When asked about a hard disk, choose the `vulnVoIP.vmdk` virtual disk file from
    the unpacked vulnVoIP directory.
  id: totrans-361
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在询问硬盘时，选择从解压后的vulnVoIP目录中选择`vulnVoIP.vmdk`虚拟磁盘文件。
- en: The developer of vulnVoIP doesn't supply a root password with the image and
    offers to hack the system in order to get the root access. So, we will not deprive
    you of a good lesson and let you acquire root access as it is supposed by the
    vulnVoIP author.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: vulnVoIP的开发者没有提供root密码，并且提供了破解系统以获取root访问权限的建议。因此，我们不会剥夺你一个很好的教训，按照vulnVoIP开发者的建议，让你获取root权限。
- en: After getting the root access, you can set the static IP 10.0.04 and connect
    vulnVoIP to the rest of your lab network.
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 获得root权限后，你可以设置静态IP为10.0.04，并将vulnVoIP连接到你的实验室网络的其余部分。
- en: Summary
  id: totrans-364
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, you saw how to fill your lab with the useful components that
    actually bring sense to the whole story of building a lab network. We installed
    the common services that you are most likely to meet in the scope of a commercial
    penetration testing project and the ones you most probably would like to be able
    to hack.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你了解了如何通过安装有用的组件来构建你的实验室，这些组件实际上使得搭建实验室网络的整个过程变得有意义。我们安装了在商业渗透测试项目中最有可能遇到的常见服务，以及你最有可能想要破解的那些服务。
- en: If you need to practice some specific skills, you can and should extend your
    lab by installing and configuring additional specific network services or applications
    according to your requirements.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要练习一些特定的技能，你可以并且应该通过根据你的需求安装和配置额外的特定网络服务或应用程序来扩展你的实验室。
- en: 'You can find, for example, a lot of preinstalled VM images at the following
    websites:'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你可以在以下网站找到许多预装的虚拟机镜像：
- en: '[http://virtualboxes.org/](http://virtualboxes.org/)'
  id: totrans-368
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[http://virtualboxes.org/](http://virtualboxes.org/)'
- en: '[https://virtualboximages.com/](https://virtualboximages.com/)'
  id: totrans-369
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://virtualboximages.com/](https://virtualboximages.com/)'
- en: In the next chapter, we will see how to leverage your lab level by installing
    and configuring security solutions.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何通过安装和配置安全解决方案来提升你的实验室水平。
