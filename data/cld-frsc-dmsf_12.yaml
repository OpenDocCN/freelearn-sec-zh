- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Common Attack Vectors and TTPs
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 常见攻击向量和 TTP
- en: As organizations increasingly rely on cloud infrastructures, security teams
    and incident responders find themselves confronting some unique vulnerabilities
    and attack patterns in the cloud. Attackers capitalize on these vulnerabilities
    and employ **Tactics, Techniques, and Procedures** (**TTPs**) that are sometimes
    tailored specifically to cloud environments.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 随着组织日益依赖云基础设施，安全团队和事件响应人员发现自己面临云中一些独特的漏洞和攻击模式。攻击者利用这些漏洞，并使用有时特别针对云环境定制的 **战术、技术和程序**
    (**TTPs**)。
- en: This chapter dives deep into these common attack vectors in the cloud, offering
    insights to empower and refine our response strategies in the face of ever-evolving
    threats. Misconfigured virtual machine instances and storage buckets, unprotected
    API endpoints, and inadequate authentication protocols are just a few of the vulnerabilities
    that threat actors target. To exploit these weaknesses, attackers employ TTPs
    ranging from privilege escalation and server-side request forgery to zero-day
    exploits tailored for cloud infrastructures. Grasping these specific threats is
    indispensable for cloud security and effective incident response.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章深入探讨云中的这些常见攻击向量，提供了有助于提升和完善我们应对日益演变的威胁的响应策略的见解。配置错误的虚拟机实例和存储桶、未保护的 API 端点以及不充分的身份验证协议仅仅是威胁行为者所针对的一些漏洞。为了利用这些弱点，攻击者使用从权限提升和服务器端请求伪造到针对云基础设施量身定制的零日漏洞等多种
    TTP。理解这些特定的威胁对于云安全和有效的事件响应至关重要。
- en: 'Specifically, we will discuss the following topics in this chapter:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 具体而言，本章将讨论以下主题：
- en: MITRE ATT&CK framework
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MITRE ATT&CK 框架
- en: Forensic triage collections
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 取证初步收集
- en: Host-based forensics
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主机基础的取证
- en: Misconfigured virtual machine instances
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置错误的虚拟机实例
- en: Misconfigured storage buckets
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置错误的存储桶
- en: Cloud administrator portal breach
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 云管理员门户漏洞
- en: Attack vectors and TTPs in the cloud, for the most part, echo those in on-premises
    environments. However, the decentralized nature of the cloud introduces distinct
    vulnerabilities. Misconfigured virtual machine instances can expose entire virtual
    environments, while improperly secured storage buckets can become gateways for
    data breaches. The cloud’s accessibility brings forth issues such as weak authentication
    mechanisms, which can lead to unauthorized access. While the core principles of
    cybersecurity remain consistent, these cloud-centric issues demand specialized
    attention and understanding.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 云中的攻击向量和 TTP 在大多数情况下与本地环境中的攻击向量和 TTP 相似。然而，云的去中心化特性引入了独特的漏洞。配置错误的虚拟机实例可能暴露整个虚拟环境，而未妥善保护的存储桶可能成为数据泄露的入口。云的可访问性带来了诸如身份验证机制薄弱等问题，这可能导致未经授权的访问。虽然网络安全的核心原则保持一致，但这些以云为中心的问题需要特别的关注和理解。
- en: Important note
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: We’ll look at common attack vectors and TTPs for cloud productivity suites in
    more detail in [*Chapter 12*](part0032_split_000.html#_idTextAnchor227).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[*第12章*](part0032_split_000.html#_idTextAnchor227)中更详细地讨论云生产力套件的常见攻击向量和TTP（战术、技术和程序）。
- en: MITRE ATT&CK framework
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: MITRE ATT&CK 框架
- en: The MITRE ATT&CK framework is a knowledge base of attacker tactics and techniques
    based on real-world observations from security researchers. It’s a tool that’s
    used by security teams to better understand attack behavior and to improve defense
    and response strategies. In the context of cloud environments, the MITRE ATT&CK
    framework outlines specific techniques that adversaries use against **cloud service
    providers** (**CSPs**) such as AWS, Azure, and GCP.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: MITRE ATT&CK 框架是一个基于安全研究人员的实际观察构建的攻击者战术和技术的知识库。它是安全团队用来更好地理解攻击行为，并改进防御和响应策略的工具。在云环境的背景下，MITRE
    ATT&CK 框架列出了对 **云服务提供商** (**CSPs**) 如 AWS、Azure 和 GCP 等进行攻击时对手使用的特定技术。
- en: The MITRE ATT&CK framework is particularly useful for cloud forensics because
    it allows responders to anticipate attacker behavior and plan their forensic investigations
    accordingly. By aligning with this framework, organizations can identify gaps
    in their defensive posture and better understand how to detect, respond to, and
    mitigate cloud-specific threats.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: MITRE ATT&CK 框架对于云取证特别有用，因为它使响应人员能够预见攻击者的行为，并据此规划他们的取证调查。通过与此框架对齐，组织可以识别其防御态势中的空白，更好地了解如何检测、响应和缓解特定于云的威胁。
- en: 'Within the scope of cloud infrastructures, the MITRE ATT&CK framework provides
    a matrix of known attacker TTPs, which includes, but is not limited to, the following:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在云基础设施范围内，MITRE ATT&CK框架提供了一张已知攻击者TTP（战术、技术和程序）矩阵，其中包括但不限于以下内容：
- en: '**Initial access**: Techniques that use various entry vectors to gain a foothold
    within a cloud environment. For example, Exploit Public-Facing Application (T1190)
    could be linked to vulnerabilities in web applications hosted in the cloud.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**初始访问**：通过各种入口向量进入云环境的技术。例如，利用公共应用程序漏洞（T1190）可能与云中托管的Web应用程序的漏洞相关。'
- en: '**Execution**: The execution phase encompasses techniques that result in adversary-controlled
    code running on a local or remote system. This could involve Server Software Component
    (T1505), where an attacker might execute code through a web server plugin.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**执行**：执行阶段包括导致对手控制的代码在本地或远程系统上运行的技术。这可能涉及服务器软件组件（T1505），其中攻击者可能通过Web服务器插件执行代码。'
- en: '**Persistence**: In the cloud, attackers often exploit features to remain logged
    in to an environment, as seen in Create Cloud Instance (T1578), where an adversary
    creates a new instance within an existing account to maintain their operations.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**持久性**：在云中，攻击者通常利用某些功能保持在环境中的登录状态，例如在创建云实例（T1578）中，攻击者会在现有帐户中创建一个新实例以维持其操作。'
- en: '**Privilege escalation**: Techniques that allow an adversary to gain higher-level
    permissions on a system or network. An example is Abuse Elevation Control Mechanism
    (T1548), which could involve an attacker taking advantage of overly permissive
    **Identity and Access Management** (**IAM**) roles.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**特权升级**：允许对手在系统或网络中获得更高权限的技术。例如，滥用提升控制机制（T1548）可能涉及攻击者利用过度宽松的**身份和访问管理**（**IAM**）角色。'
- en: '**Defense evasion**: This involves techniques that adversaries use to avoid
    detection throughout their compromise. Techniques such as Disabling Security Tools
    (T1562) might be used to switch off monitoring and logging capabilities in the
    cloud.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**防御规避**：这涉及对手使用的技术，以避免在整个入侵过程中被检测到。诸如禁用安全工具（T1562）之类的技术，可能用于关闭云中的监控和日志记录功能。'
- en: 'To further illustrate how the MITRE ATT&CK framework fits within a cloud attack
    scenario, consider the following example:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进一步说明MITRE ATT&CK框架如何适用于云攻击场景，考虑以下示例：
- en: '**Misconfiguration and Unauthorized Access (T1580)**: As discussed later in
    this chapter, attackers often take advantage of misconfigurations in cloud storage
    services such as AWS S3 buckets or Azure Blob Storage. By enumerating these services
    and exploiting open permissions, attackers can read, modify, or delete sensitive
    data stored in these resources.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**配置错误和未授权访问（T1580）**：正如本章后面讨论的那样，攻击者通常会利用云存储服务中的配置错误，例如AWS S3桶或Azure Blob存储。通过枚举这些服务并利用开放权限，攻击者可以读取、修改或删除存储在这些资源中的敏感数据。'
- en: By incorporating the MITRE ATT&CK framework into cloud security practices, organizations
    can more effectively structure their response to incidents and align their forensic
    efforts with industry-standard nomenclature and tactics. Doing so not only enhances
    the incident response plan but also aligns with global best practices, helping
    to ensure a more resilient defense against cloud-based attacks.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将MITRE ATT&CK框架融入云安全实践中，组织可以更有效地构建应对事件的策略，并使其取证工作与行业标准的命名法和战术保持一致。这样做不仅增强了事件响应计划，还与全球最佳实践接轨，帮助确保对云攻击的防御更加坚韧。
- en: 'Incident responders will likely have to map all forensic findings to MITRE
    numbers in an easy tabular format for defense teams to better understand how an
    attack occurred in their environment. As an example, the following table demonstrates
    a sample MITRE ATT&CK table for a hypothetical cloud compromise:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 事件响应人员可能需要将所有取证结果映射到MITRE编号，并以易于理解的表格形式呈现，帮助防御团队更好地了解攻击是如何在其环境中发生的。例如，以下表格展示了一个假设云被攻破的MITRE
    ATT&CK表格示例：
- en: '| **MITRE ATT&CK** **Technique Number** | **Technique Name** | **Description**
    |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| **MITRE ATT&CK** **技术编号** | **技术名称** | **描述** |'
- en: '| --- | --- | --- |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| **T1190** | Exploit Public-Facing Application | Attacking a server or service
    that is accessible from the internet to gain access. For example, attackers could
    target specific web applications or services exposed to the internet, such as
    a web portal or API gateway hosted in the cloud. The focus is often on exploiting
    vulnerabilities in web modules or application code to gain unauthorized access
    to underlying cloud resources or sensitive data. |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| **T1190** | 利用面向公众的应用程序 | 攻击可以从互联网访问的服务器或服务，以获得访问权限。例如，攻击者可能会针对暴露在互联网上的特定Web应用程序或服务，如托管在云中的Web门户或API网关。重点通常是利用Web模块或应用程序代码中的漏洞，获得对底层云资源或敏感数据的未授权访问。
    |'
- en: '| **T1136.003** | Use of Service Principal | Creating or compromising cloud
    identities to maintain access to cloud resources. This could involve creating
    or hijacking cloud identity services, such as Azure AD service principals or AWS
    IAM roles. Attackers may establish fake identities or compromise existing ones
    to gain persistent access to cloud resources, enabling them to access or manipulate
    workloads and services. |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| **T1136.003** | 使用服务主体 | 创建或破坏云身份以维持对云资源的访问。可能涉及创建或劫持云身份服务，例如Azure AD服务主体或AWS
    IAM角色。攻击者可能创建虚假身份或破坏现有身份，以获得持久的云资源访问权限，从而能够访问或操控工作负载和服务。 |'
- en: '| **T1580** | Cloud Infrastructure Discovery | Scanning for information about
    cloud services and assets to plan further attacks. Attackers typically conduct
    reconnaissance on cloud environments, targeting specific cloud services such as
    AWS EC2 or Azure Virtual Machines. They scan for exposed APIs, unsecured storage
    buckets, or misconfigured cloud resources to identify potential entry points or
    valuable data. |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| **T1580** | 云基础设施发现 | 扫描云服务和资产的信息，以规划进一步的攻击。攻击者通常会对云环境进行侦察，针对特定的云服务，如AWS
    EC2或Azure虚拟机。他们会扫描暴露的API、不安全的存储桶或配置错误的云资源，以识别潜在的入口点或有价值的数据。 |'
- en: '| **T1078** | Valid Accounts | Using stolen account credentials to gain unauthorized
    access to cloud systems. |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| **T1078** | 有效账户 | 使用被盗账户凭证访问云系统，获取未授权访问权限。 |'
- en: '| **T1090** | Proxy | Utilizing intermediary systems to disguise the origin
    of malicious traffic. Attackers use intermediary cloud-based services or virtual
    machines as proxies to conceal their origin. This technique may involve spinning
    up cloud instances to route malicious traffic, making it harder to trace back
    to the source. |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| **T1090** | 代理 | 利用中介系统掩盖恶意流量的来源。攻击者使用基于云的中介服务或虚拟机作为代理，隐藏其来源。这种技术可能涉及启动云实例来转发恶意流量，使其更难追溯到源头。
    |'
- en: '| **T1526** | Cloud Service Dashboard | Gaining access to cloud service management
    interfaces for control or reconnaissance. By gaining access to cloud management
    interfaces, such as the AWS management console or the Azure portal, attackers
    can monitor and control cloud resources. This might involve tracking workloads,
    modifying configurations, or gaining insights into security controls. |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| **T1526** | 云服务仪表板 | 访问云服务管理界面进行控制或侦察。通过访问云管理界面，例如AWS管理控制台或Azure门户，攻击者可以监控和控制云资源。这可能涉及跟踪工作负载、修改配置或获得有关安全控制的见解。
    |'
- en: '| **T1548.004** | Cloud Service Abuse | Exploiting cloud services or resources
    to support malicious operations. |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| **T1548.004** | 云服务滥用 | 利用云服务或资源来支持恶意操作。 |'
- en: '| **T1562.007** | Disable or Modify Cloud Firewall | Modifying or disabling
    cloud-based firewalls to allow malicious traffic or block security responses.
    Attackers modify or disable cloud-based firewalls, such as AWS WAF or Azure Firewall,
    to permit malicious traffic or impede security responses. This could involve changing
    rules to allow access to specific ports or services, or disabling protective measures
    around critical cloud assets. |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| **T1562.007** | 禁用或修改云防火墙 | 修改或禁用基于云的防火墙，以允许恶意流量或阻止安全响应。攻击者修改或禁用基于云的防火墙，如AWS
    WAF或Azure防火墙，以允许恶意流量或阻碍安全响应。这可能涉及更改规则以允许访问特定端口或服务，或禁用关键云资产的保护措施。 |'
- en: '| **T1578** | Modify Cloud Compute Infrastructure | Making changes to cloud
    compute services such as instances and virtual machines to establish persistence
    or escalate privileges, as well as making unauthorized alterations to cloud compute
    services, such as modifying virtual machine configurations or injecting malicious
    code into containerized applications. This technique aims to establish persistence,
    escalate privileges, or create backdoors in cloud environments. |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| **T1578** | 修改云计算基础设施 | 对云计算服务（如实例和虚拟机）进行更改，以建立持久性或提升特权，并对云计算服务进行未经授权的修改，如修改虚拟机配置或向容器化应用程序注入恶意代码。此技术旨在建立持久性、提升特权或在云环境中创建后门。
    |'
- en: '| **T1583** | Acquire Infrastructure: Cloud Accounts | Purchasing or otherwise
    obtaining cloud accounts for malicious purposes. |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| **T1583** | 获取基础设施：云账户 | 购买或以其他方式获取云账户以用于恶意目的。 |'
- en: '| **T1608.001** | Stage Data for Exfiltration: Cloud Storage | Placing stolen
    data in cloud storage services in preparation for exfiltration, as well as placing
    stolen or illicitly obtained data in cloud storage services, such as Amazon S3
    buckets or Azure Blob Storage, in preparation for exfiltration. This step often
    precedes large-scale data breaches or data theft operations, leveraging the cloud
    for staging and dissemination of compromised data. |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| **T1608.001** | 数据外泄阶段：云存储 | 将被盗数据放入云存储服务以准备外泄，以及将被盗或非法获取的数据放入云存储服务，如 Amazon
    S3 存储桶或 Azure Blob 存储，以准备外泄。这个步骤通常在大规模数据泄露或数据盗窃操作之前进行，利用云服务进行妥协数据的暂存和传播。 |'
- en: Table 9.1 – Example of an incident MITRE ATT&CK table
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 表 9.1 – 事件 MITRE ATT&CK 表示例
- en: Important note
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 重要说明
- en: 'All attacker TTPs can be mapped to the appropriate number under the ATT&CK
    framework. This can be found on the MITRE organization’s site: [https://attack.mitre.org/](https://attack.mitre.org/).'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 所有攻击者的 TTP（战术、技术和程序）都可以在 ATT&CK 框架中映射到相应的编号。可以在 MITRE 组织网站找到：[https://attack.mitre.org/](https://attack.mitre.org/)。
- en: Forensic triage collections
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 法医筛查数据收集
- en: One of the biggest pain points incident responders will face is data acquisition
    at the individual host level, especially when it pertains to operating system
    artifacts. CSPs such as Azure, AWS, and GCP offer various logging mechanisms to
    aid in monitoring and auditing actions on their resources. However, these logs
    often capture activities related to the infrastructure or services utilized. By
    default, they do not capture the granular details of user activities or system
    operations at the operating system level (except for cloud ecosystem-connected
    EDR agents such as Microsoft Defender for Endpoint). Even in a cyber incident
    that involves cloud resources, the reality is that most of an incident’s **indicators
    of compromise** (**IoCs**) will come from host-level artifacts.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 事件响应者面临的最大痛点之一是个体主机级别的数据获取，尤其是当涉及到操作系统的相关痕迹时。像 Azure、AWS 和 GCP 这样的云服务平台（CSPs）提供了各种日志机制，帮助监控和审计其资源上的操作。然而，这些日志通常只捕获与基础设施或服务相关的活动。默认情况下，它们不会捕获与用户活动或操作系统级别的系统操作相关的细节（除非使用连接到云生态系统的
    EDR 代理，如 Microsoft Defender for Endpoint）。即使是在涉及云资源的网络事件中，实际情况是，大多数事件的**妥协指示符**（**IoCs**）将来自主机级别的痕迹。
- en: As we have seen throughout this book, cloud log sources primarily focus on the
    cloud resources’ interactions. This means detailed host-level activities, such
    as specific Windows Event Logs, file modifications, memory operations, and user
    command executions are not captured (that is, accessible from the cloud) by default.
    The exception to this is if host artifacts and logs have been set to be forwarded
    to cloud services such as AWS CloudWatch or an Azure Log Analytics workspace.
    Most likely, incident responders will be responding to an incident that will require
    capturing all forensic artifacts at the host level (that is, the virtual machine
    instance hosted in the cloud environment). The operating system artifacts offer
    a more detailed picture of what happened on a virtual machine instance and piecing
    together the analysis of multiple virtual machines will allow incident responders
    to understand the extent to which their cloud infrastructure was impacted by the
    incident.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在本书中所看到的，云日志源主要关注云资源的交互。这意味着像特定的Windows事件日志、文件修改、内存操作和用户命令执行等详细的主机级活动，默认情况下并不会被捕获（即无法从云中访问）。唯一的例外是，如果主机文物和日志已被设置为转发到如AWS
    CloudWatch或Azure Log Analytics工作区等云服务中。很可能，事件响应者会遇到一个需要捕获所有主机级取证文物的事件（即托管在云环境中的虚拟机实例）。操作系统文物提供了虚拟机实例上发生的事件的更详细画面，通过分析多个虚拟机实例，可以帮助事件响应者理解其云基础设施在事件中受影响的程度。
- en: 'These artifacts can include the following:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 这些文物可能包括以下内容：
- en: '**Filesystem metadata**: Details about file creation, modification, or deletion'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件系统元数据**：有关文件创建、修改或删除的详细信息'
- en: '**Memory artifacts**: Information about running processes, network connections,
    and loaded modules'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内存文物**：有关正在运行的进程、网络连接和加载模块的信息'
- en: '**Registry artifacts (for Windows)**: Details about installed applications,
    user activities, and system configurations'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**注册表文物（适用于Windows）**：关于已安装应用程序、用户活动和系统配置的详细信息'
- en: '**Shell histories (for Linux)**: Command execution histories, which can provide
    insights into user activities'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Shell历史记录（适用于Linux）**：命令执行历史记录，可以提供用户活动的线索'
- en: '**Application logs**: Specific applications might generate logs that haven’t
    been captured or aggregated by the CSP'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序日志**：特定的应用程序可能会生成日志，但这些日志未被CSP捕获或汇总'
- en: The absence of these artifacts from the CSP makes it crucial to use tools such
    as **Kroll Artifact Parser and Extractor** (**KAPE**, [https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape](https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape))
    or **Collect Your Logs Remotely** (**CyLR**) for triage and forensic analysis.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这些文物在CSP中缺失，因此必须使用像**Kroll Artifact Parser and Extractor**（**KAPE**，[https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape](https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape))或**Collect
    Your Logs Remotely**（**CyLR**）这样的工具进行分类和取证分析。
- en: KAPE and CyLR are both free triage tools that collect and process forensically
    relevant artifacts swiftly. They are highly customizable and enable incident responders
    to target specific artifacts based on the nature of the cyber incident. They are
    lightweight and do not require much computational power to be run on a system.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: KAPE和CyLR都是免费的分类工具，能够快速收集和处理取证相关文物。它们具有高度可定制性，使事件响应者能够根据网络事件的性质有针对性地捕获特定文物。它们轻量级，不需要太多计算能力即可在系统上运行。
- en: Important note
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: KAPE requires an enterprise license when used on a third-party network and/or
    as part of a paid engagement. It is free for any local, state, federal, or international
    government agency, as well as educational and research uses.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: KAPE在用于第三方网络和/或作为付费合作的一部分时需要企业许可证。对于任何地方、州、联邦或国际政府机构，以及教育和研究用途，KAPE是免费的。
- en: You can download KAPE and find its usage instructions at [https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape/](https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape/).
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在[https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape/](https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape/)下载KAPE并查找其使用说明。
- en: You can download CyLR and find its usage instructions on GitHub at [https://github.com/orlikoski/CyLR/](https://github.com/orlikoski/CyLR/).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以下载CyLR并在GitHub上找到其使用说明，地址为[https://github.com/orlikoski/CyLR/](https://github.com/orlikoski/CyLR/)。
- en: Host-based forensics
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于主机的法医
- en: In the context of the cloud, a host refers to a virtual or physical machine
    that runs user applications and serves as an endpoint for user and application
    activities. It can be an individual server, a virtual machine, or a container,
    depending on the specific cloud model being utilized. While in traditional on-premises
    scenarios, a host would often refer to a tangible physical server or machine,
    in the cloud, hosts can be ephemeral and rapidly spun up or down based on the
    demand and requirements.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在云环境中，主机指的是运行用户应用程序并作为用户和应用程序活动终端的虚拟或物理机器。它可以是单个服务器、虚拟机或容器，具体取决于所使用的云模型。在传统的本地环境中，主机通常指的是有形的物理服务器或机器，但在云中，主机可能是临时的，并会根据需求和要求快速创建或销毁。
- en: Important note
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: In this chapter, we will concentrate on Windows-based systems. Linux systems
    will have different host-based artifacts that can be collected and analyzed.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将集中讨论基于Windows的系统。Linux系统将具有不同的主机相关文物，可以进行收集和分析。
- en: Host-based forensics in the cloud focuses on retrieving and analyzing data from
    these individual hosts or endpoints, aiming to identify signs of intrusions, lateral
    movements, malicious code executions, and other TTPs. Given that a host is the
    primary point of execution for applications and often the entry or pivot point
    for attackers, it is a rich source of forensic data.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 基于主机的云法医聚焦于从这些单独的主机或终端获取并分析数据，旨在识别入侵迹象、横向移动、恶意代码执行和其他TTP（战术、技术和程序）。由于主机是应用程序执行的主要点，并且通常是攻击者的入口或枢纽点，因此它是一个丰富的法医数据来源。
- en: 'Several artifacts in the Windows operating system can provide a wealth of information
    regarding activities on a host:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: Windows操作系统中的几个文物可以提供关于主机上活动的大量信息：
- en: '**Prefetch**: This is used to speed up the Windows boot process and application
    startup times. By examining prefetch files, incident responders can determine
    which programs were executed on a host and when.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**预取**：这用于加速Windows启动过程和应用程序启动时间。通过检查预取文件，事件响应者可以确定主机上执行了哪些程序以及何时执行。'
- en: '**AmCache**: AmCache contains information about executed applications and can
    provide insights into program execution and user activities.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AmCache**：AmCache包含有关已执行应用程序的信息，可以提供有关程序执行和用户活动的见解。'
- en: '**ShimCache**: Also known as Application Compatibility Cache, ShimCache contains
    a list of recently executed applications. It is valuable for understanding what
    ran on a system, especially after a system reboot, as some other artifacts might
    be purged.'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ShimCache**：也称为应用程序兼容性缓存，ShimCache包含最近执行的应用程序列表。它对于了解系统上运行了什么，特别是在系统重启后，因为一些其他文物可能已经被清除，非常有价值。'
- en: '**Windows Event Logs**: These logs, especially the security, system, and application
    logs, can offer a plethora of information about security-related events, system
    startups, shutdowns, application crashes, and more. They are critical for identifying
    patterns related to potential security incidents.'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Windows事件日志**：这些日志，尤其是安全、系统和应用程序日志，可以提供关于安全相关事件、系统启动、关机、应用程序崩溃等的大量信息。它们对识别与潜在安全事件相关的模式至关重要。'
- en: Many more artifacts can be analyzed, but these are the most useful from an incident
    responder’s point of view. We will utilize these artifacts to analyze common intrusions
    on cloud resources discussed throughout this chapter.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 还有许多其他文物可以进行分析，但从事件响应者的角度来看，这些是最有用的。我们将利用这些文物分析本章中讨论的云资源上的常见入侵。
- en: Important note
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Prefetch, AmCache, ShimCache, and Windows Event Logs are some of the many artifacts
    collected by KAPE and CyLR.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 预取、AmCache、ShimCache和Windows事件日志是KAPE和CyLR收集的众多文物之一。
- en: 'The process of analyzing host-based logs can be broken down into the following
    steps:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 分析基于主机的日志过程可以分解为以下几个步骤：
- en: '**Log collection**: Gather the data from the target host. This is the initial
    step where all the necessary entries are extracted for analysis. These logs are
    also captured when generating forensic triage packages.'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**日志收集**：收集目标主机的数据。这是提取所有必要条目以供分析的初步步骤。这些日志在生成法医筛查包时也会被捕获。'
- en: '**Data preparation**: Utilize a parsing tool to convert the raw data into a
    readable and analyzable format.'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**数据准备**：使用解析工具将原始数据转换为可读和可分析的格式。'
- en: '**Analysis and correlation**: This considers key aspects such as user activity,
    file paths, execution flags, file modification times, and file sizes/attributes
    for any anomalies or red flags. Cross-reference log data with other forensic artifacts
    to contextualize findings within the broader scope of the investigation.'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**分析与关联**：这包括考虑用户活动、文件路径、执行标志、文件修改时间以及文件大小/属性等关键方面，以识别任何异常或警示信号。将日志数据与其他取证物证交叉引用，以便在更广泛的调查范围内将发现进行背景化。'
- en: '**Outcome**: Document the analysis results, identifying any potential indicators
    of compromise. Based on the findings, determine the appropriate response actions,
    which could include further detailed investigation, system remediation, or initiating
    security protocols to prevent future breaches.'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**结果**：记录分析结果，识别任何潜在的入侵指示。根据发现，确定适当的响应措施，这可能包括进一步的详细调查、系统修复或启动安全协议以防止未来的安全漏洞。'
- en: 'These steps can be visualized in the following process map:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 这些步骤可以通过以下流程图来可视化：
- en: '![Figure 9.1 – Host-based forensic analysis process](img/00166.jpeg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.1 – 基于主机的取证分析过程](img/00166.jpeg)'
- en: Figure 9.1 – Host-based forensic analysis process
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.1 – 基于主机的取证分析过程
- en: Evidence of intrusion
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 入侵证据
- en: Determining evidence of execution is often a crucial initial step in ascertaining
    evidence of intrusion on a host system. Threat actors, in their pursuit of system
    compromise and subsequent exploitation, frequently seek to execute unauthorized
    applications, particularly malware, to establish a foothold or gain elevated privileges.
    The unauthorized execution of these applications can serve as clear indicators
    of a breach or intrusion.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 确定执行证据通常是确定主机系统入侵证据的关键初步步骤。在寻求系统妥协和随后的利用过程中，威胁行为者经常试图执行未经授权的应用程序，特别是恶意软件，以建立立足点或获取提升的权限。这些应用程序的未经授权执行可以作为泄露或入侵的明确指示。
- en: To pinpoint such unauthorized executions, incident responders rely on certain
    intrinsic artifacts, such as Prefetch, AmCache, and ShimCache. These artifacts
    store data about executed programs, offering invaluable insights into the history
    of application runs. By meticulously analyzing these artifacts, professionals
    can discern any discrepancies or anomalies pointing to unauthorized executions,
    thus revealing potential evidence of system intrusion by malicious actors. The
    focus is not just on identifying malware but also on understanding the breadth
    and depth of any intrusion, allowing for a more comprehensive security response.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确定这种未经授权的执行，事件响应者依赖于某些内在的物证，如 Prefetch、AmCache 和 ShimCache。这些物证存储有关已执行程序的数据，为应用程序执行历史提供了宝贵的见解。通过细致分析这些物证，专业人员可以发现任何指向未经授权执行的差异或异常，从而揭示潜在的恶意行为者入侵系统的证据。关注点不仅仅在于识别恶意软件，还在于理解入侵的广度和深度，从而能够采取更全面的安全响应。
- en: In 2013, a large American retailer experienced a significant data breach where
    attackers stole credit card and personal information from millions of customers.
    In this incident, forensic artifacts such as Prefetch, AmCache, ShimCache, and
    Windows Event Logs were integral to the investigation. Prefetch files likely provided
    insights into the execution of malware and hacking tools used by the attackers,
    revealing patterns of malicious activity. AmCache entries, detailing executed
    programs, could have helped in identifying unauthorized binaries associated with
    the breach. ShimCache might have offered additional evidence of malicious executable
    runs, which would have been useful for understanding the malware’s compatibility
    strategies across the retailer’s systems. Windows Event Logs, which record a wide
    range of system activities, were crucial in reconstructing the breach’s timeline,
    including login attempts, system changes, and network activities. These artifacts,
    when combined, enabled investigators to piece together the attackers’ movements,
    ascertain the methods used in the breach, and comprehend the full extent of the
    intrusion, thus playing a pivotal role in unraveling one of the most significant
    cyberattacks in the retail sector.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 2013年，一家大型美国零售商遭遇了重大数据泄露事件，攻击者窃取了数百万客户的信用卡和个人信息。在这一事件中，取证数据如预取文件、AmCache、ShimCache
    和 Windows 事件日志在调查中起到了至关重要的作用。预取文件可能提供了有关恶意软件和攻击者使用的黑客工具执行情况的洞察，揭示了恶意活动的模式。AmCache
    条目记录了已执行的程序，可能有助于识别与泄露事件相关的未经授权的二进制文件。ShimCache 可能提供了恶意可执行文件运行的额外证据，这对于理解恶意软件在零售商系统中的兼容性策略非常有帮助。Windows
    事件日志记录了广泛的系统活动，对于重建泄露事件的时间线至关重要，包括登录尝试、系统更改和网络活动。这些数据结合起来，帮助调查人员拼凑出攻击者的行动轨迹，确认泄露事件中使用的方法，并全面理解入侵的范围，从而在揭示零售业最重大网络攻击之一中发挥了关键作用。
- en: Prefetch analysis
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 预取分析
- en: Prefetching is an optimization technique that’s employed by the Windows operating
    system to expedite the startup of applications. It achieves this by predicting
    which files an application will need and loading them into memory pre-emptively.
    After an application’s initial execution, the system populates the `Prefetch`
    directory with a corresponding `.pf` file. These files can be found in the `C:\Windows\Prefetch`
    directory on a standard Windows installation. The directory will contain files
    with the `.pf` extension, each named after the executable it corresponds to. For
    instance, if you have run `notepad.exe`, you might find a corresponding `NOTEPAD.EXE.pf`
    file in the `Prefetch` directory.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 预取是一个优化技术，由 Windows 操作系统用于加速应用程序的启动。它通过预测应用程序将需要哪些文件，并提前将其加载到内存中来实现这一点。在应用程序的首次执行后，系统会将相应的
    `.pf` 文件填充到 `Prefetch` 目录中。这些文件可以在标准 Windows 安装的 `C:\Windows\Prefetch` 目录中找到。该目录将包含以
    `.pf` 扩展名结尾的文件，每个文件的名称与其对应的可执行文件相同。例如，如果你运行了 `notepad.exe`，你可能会在 `Prefetch` 目录中找到一个名为
    `NOTEPAD.EXE.pf` 的文件。
- en: Analyzing these prefetch files provides insights into the applications that
    have been run on the system, making them valuable for both performance diagnostics
    and forensic investigations. These files are generated based on observations made
    by the cache manager, which keeps track of all the files and directories an application
    references during its run. Consequently, these `.pf` files become invaluable containers
    of historical data regarding application execution.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 分析这些预取文件能够提供有关系统上运行过的应用程序的信息，这使得它们在性能诊断和取证调查中都具有重要价值。这些文件是由缓存管理器生成的，缓存管理器跟踪应用程序在运行过程中引用的所有文件和目录。因此，这些
    `.pf` 文件成为了关于应用程序执行的历史数据的重要容器。
- en: 'Forensic importance of prefetch files:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 预取文件的取证重要性：
- en: '`.pf` file records both the initial execution date and the last executed date
    for the respective application. These timestamps are crucial during forensic investigations
    as they can help trace back when a potentially malicious application was first
    introduced and subsequently run on a system.'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`.pf` 文件记录了相应应用程序的初次执行日期和最后执行日期。这些时间戳在取证调查中至关重要，因为它们有助于追溯潜在恶意应用程序首次引入并在系统上执行的时间。'
- en: '`.pf` file itself can also provide forensic clues. While the creation date
    often aligns with the first execution of the application, the modification date
    typically corresponds with the last execution date. By comparing these dates,
    investigators can ascertain the consistency and frequency of an application’s
    usage.'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`.pf` 文件本身也可以提供取证线索。虽然创建日期通常与应用程序首次执行的时间相符，但修改日期通常与最后一次执行日期相对应。通过比较这些日期，调查人员可以确定应用程序使用的连贯性和频率。'
- en: One of the most popular open source tools for prefetch analysis is **PECmd**,
    which is written and maintained by Eric Zimmerman. This tool parses prefetch files
    and provides detailed output, including file paths, timestamps, run counts, and
    more. Another common (but licensed) tool to parse prefetch files is Magnet AXIOM.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 最受欢迎的开源 Prefetch 分析工具之一是 **PECmd**，它由 Eric Zimmerman 编写和维护。该工具解析 Prefetch 文件，并提供详细的输出，包括文件路径、时间戳、运行次数等。另一个常用的（但有许可要求的）Prefetch
    文件解析工具是 Magnet AXIOM。
- en: Important note
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You can download PECmd and find its usage details at [https://github.com/EricZimmerman/PECmd](https://github.com/EricZimmerman/PECmd).
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以下载 PECmd，并在[https://github.com/EricZimmerman/PECmd](https://github.com/EricZimmerman/PECmd)找到其使用详情。
- en: 'Imagine a scenario where a suspicious file named `malicious.exe` was executed
    on a Windows-based virtual machine instance that is being hosted on an organization’s
    cloud tenant. Upon retrieving the corresponding prefetch file (perhaps from one
    of the triage tools we discussed earlier), `MALICIOUS.EXE.pf`, and analyzing it
    with PECmd, the output might resemble something like this:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 假设有一个名为 `malicious.exe` 的可疑文件在组织的云租户上托管的 Windows 虚拟机实例中被执行。获取相应的 Prefetch 文件（可能来自我们之前讨论的某个初步检查工具），`MALICIOUS.EXE.pf`，并用
    PECmd 分析后，输出可能如下所示：
- en: '[PRE0]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The output provided by PECmd after analyzing a prefetch file such as `MALICIOUS.EXE.pf`
    is a rich source of forensic data. PECmd decodes the information stored within
    the prefetch file and presents it in a human-readable format, which includes a
    timestamp of the first and last time the application was run, the total number
    of times it was executed, and the files that were accessed during execution.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 在分析 Prefetch 文件（例如 `MALICIOUS.EXE.pf`）后，PECmd 提供的输出是一个丰富的取证数据源。PECmd 解码存储在 Prefetch
    文件中的信息，并以易于阅读的格式呈现，包括应用程序首次和最后一次运行的时间戳、执行的总次数以及执行过程中访问的文件。
- en: 'Here are some attacker TTPs to look out for when analyzing prefetch output:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在分析 Prefetch 输出时，以下是一些攻击者的 TTPs（战术、技术和程序）需要注意：
- en: '**Time stamping**: Prefetch files contain timestamps indicating the last time
    a particular application was run. This can help investigators correlate application
    execution times with other events on the system.'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**时间戳**：Prefetch 文件包含时间戳，表示特定应用程序上次运行的时间。这有助于调查人员将应用程序执行时间与系统上的其他事件进行关联。'
- en: '**Application frequency**: By examining the run count within a prefetch file,
    analysts can determine how often an application is executed. Unusual frequencies
    can signal anomalous or malicious activity.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序频率**：通过检查 Prefetch 文件中的运行计数，分析人员可以确定应用程序的执行频率。不寻常的频率可能表明存在异常或恶意活动。'
- en: '**Volume information**: Prefetch files also store details about the volume
    from which an application was executed. This can be useful to trace back to potentially
    malicious external devices or volumes.'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**卷信息**：Prefetch 文件还会存储关于应用程序执行来源卷的详细信息。这对于追溯潜在的恶意外部设备或卷非常有用。'
- en: '**Application source path**: Identifying where an application was executed
    (for example, from a USB device or a specific directory) can help in piecing together
    an attacker’s movement or actions on a host.'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序源路径**：识别应用程序执行的位置（例如，来自 USB 设备或特定目录）可以帮助拼凑出攻击者在主机上的行动或移动路径。'
- en: '**File and directory references**: Prefetch files list other files and directories
    that were accessed during the application’s startup. This can highlight any dependent
    or associated files, which might also be malicious or compromised.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件和目录引用**：Prefetch 文件列出了在应用程序启动过程中访问的其他文件和目录。这可以突出任何依赖或关联的文件，这些文件可能也是恶意或已被攻破的。'
- en: Prefetch files, though designed as a performance optimization feature, have
    cemented themselves as indispensable artifacts for incident responders.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: Prefetch 文件，尽管设计上是为了性能优化，但它们已经成为事故响应人员不可或缺的取证工具。
- en: AmCache analysis
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: AmCache 分析
- en: AmCache, akin to prefetch, is a forensic artifact unique to Windows systems,
    particularly Windows 8 and above. The `AmCache.hve` file is a Windows registry
    hive that primarily serves the Windows Application Experience program, a feature
    aimed at ensuring software compatibility. Typically located at `C:\Windows\AppCompat\Programs\Amcache.hve`,
    this hive logs detailed metadata about executed applications, as well as information
    about connected hardware such as USB devices. While its primary function is software
    compatibility, the rich data it holds makes it an indispensable tool in forensic
    investigations.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: AmCache类似于Prefetch，是Windows系统（特别是Windows 8及以上版本）特有的取证遗留物。`AmCache.hve`文件是一个Windows注册表hive，主要服务于Windows应用程序体验程序，这是一个旨在确保软件兼容性的功能。通常位于`C:\Windows\AppCompat\Programs\Amcache.hve`，该hive记录了执行过的应用程序的详细元数据，以及关于连接硬件的信息，例如USB设备。虽然它的主要功能是软件兼容性，但它所包含的丰富数据使其成为取证调查中不可或缺的工具。
- en: 'Here''s its forensic importance:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 它的取证重要性如下：
- en: '**Binary metadata**: AmCache contains comprehensive metadata about executed
    binaries, such as the file path, last modification time, creation time, SHA-1
    hash, and more. This helps forensic analysts trace the origin and history of executable
    files on the system.'
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**二进制元数据**：AmCache包含了关于执行二进制文件的详细元数据，如文件路径、最后修改时间、创建时间、SHA-1哈希等。这帮助取证分析师追溯系统中可执行文件的来源和历史。'
- en: '**Hardware footprints**: The hive also maintains records of plugged-in hardware
    devices, potentially allowing investigators to trace the insertion of malicious
    USB devices or external storage.'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**硬件痕迹**：该hive还记录了插入的硬件设备，可能帮助调查人员追踪恶意USB设备或外部存储设备的插入时间。'
- en: '**Correlation with execution**: By analyzing AmCache, forensic experts can
    correlate binary metadata with execution traces from other artifacts, offering
    a cohesive timeline of system activities.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与执行的关联**：通过分析AmCache，取证专家可以将二进制元数据与其他证据中的执行痕迹进行关联，从而提供系统活动的完整时间线。'
- en: One of the go-to tools for AmCache parsing is AmcacheParser, which is also part
    of Eric Zimmerman’s suite of forensic tools. Like PECmd, it’s open source and
    offers thorough parsing of the `AmCache.hve` file. Another licensed tool that
    offers robust AmCache parsing capabilities is Magnet AXIOM.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 解析AmCache的常用工具之一是AmcacheParser，它也是Eric Zimmerman的取证工具套件的一部分。像PECmd一样，它是开源的，并提供了对`AmCache.hve`文件的详细解析。另一个提供强大AmCache解析功能的授权工具是Magnet
    AXIOM。
- en: Important note
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You can download AmcacheParser and find its usage details at [https://github.com/EricZimmerman/AmcacheParser](https://github.com/EricZimmerman/AmcacheParser).
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在[https://github.com/EricZimmerman/AmcacheParser](https://github.com/EricZimmerman/AmcacheParser)下载AmcacheParser并查看其使用说明。
- en: 'Imagine the execution of a malicious file named `malicious_mansoor.exe` on
    a Windows virtual machine hosted on a cloud. On obtaining the `AmCache.hve` file
    and parsing it with AmcacheParser, the output might look something like this:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 假设在云端托管的Windows虚拟机上执行了一个名为`malicious_mansoor.exe`的恶意文件。当获取`AmCache.hve`文件并用AmcacheParser解析时，输出可能会类似于以下内容：
- en: '[PRE1]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Here are some key TTPs to look for when analyzing AmCache:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是分析AmCache时需要注意的一些关键TTP：
- en: '**Binary hashes**: SHA-1 hashes in AmCache provide an opportunity to match
    known malicious hashes from threat intelligence feeds'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**二进制哈希**：AmCache中的SHA-1哈希提供了一个机会，用于与威胁情报源中的已知恶意哈希进行匹配。'
- en: '**File paths**: Unusual or suspicious file paths, especially ones located in
    temporary or uncommon directories, can hint toward malicious activities'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件路径**：不寻常或可疑的文件路径，尤其是位于临时文件夹或不常见目录中的路径，可能暗示着恶意活动。'
- en: '**File creation and modification**: Timestamps can be correlated with other
    system events to map out an attacker’s actions'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件创建与修改**：时间戳可以与其他系统事件相关联，从而描绘出攻击者的行为。'
- en: '**Associated files**: Like Prefetch, AmCache also provides references to files
    related to an executable, assisting in mapping out potentially malicious dependencies'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**关联文件**：像Prefetch一样，AmCache也提供了与可执行文件相关联的文件引用，有助于绘制出潜在的恶意依赖关系。'
- en: AmCache hive, although created for compatibility, holds significant forensic
    potential. Alongside Prefetch, AmCache has proven its worth as a goldmine of information
    for incident response and digital forensics.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: AmCache hives虽然是为了兼容性而创建的，但却具有重要的取证潜力。与Prefetch一起，AmCache已经证明了它在事件响应和数字取证中的重要价值。
- en: ShimCache analysis
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ShimCache分析
- en: ShimCache, formally known as Application Compatibility Cache, is a component
    of the Windows operating system that’s designed to allow backward compatibility
    for applications designed for older versions of Windows. When Windows executes
    a program, it checks ShimCache to determine whether the application requires any
    “shims” or compatibility fixes to run correctly. ShimCache, in doing so, maintains
    a list of executables that have been run on the system, making it an invaluable
    resource for digital forensic analysts. The ShimCache information is stored within
    the Windows registry at `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session
    Manager\AppCompatibility\AppCompatCache`.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: ShimCache，正式名称为应用兼容性缓存，是 Windows 操作系统的一部分，旨在允许为旧版本 Windows 设计的应用程序提供向后兼容性。当
    Windows 执行一个程序时，它会检查 ShimCache 以确定该应用程序是否需要任何“修补程序”或兼容性修复才能正确运行。ShimCache 在此过程中会保持一个已在系统上运行的可执行文件列表，这使其成为数字取证分析师的重要资源。ShimCache
    信息存储在 Windows 注册表中，路径为 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session
    Manager\AppCompatibility\AppCompatCache`。
- en: 'Here''s its forensic importance:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 这是它的取证重要性：
- en: '**Execution history**: ShimCache maintains a list of the most recently executed
    applications, aiding forensic analysts in tracing which executables ran on the
    system. This list includes the file path, last modification time, and file size.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**执行历史**：ShimCache 维护着最近执行的应用程序列表，帮助取证分析师追踪哪些可执行文件曾在系统上运行。此列表包括文件路径、最后修改时间和文件大小。'
- en: '**Persistence mechanism detection**: Malware often leverages various persistence
    mechanisms. Observing recurring entries in ShimCache for uncommon or suspicious
    paths can hint toward such persistence mechanisms.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**持久性机制检测**：恶意软件通常会利用各种持久性机制。观察 ShimCache 中不常见或可疑路径的重复条目，可以提示存在此类持久性机制。'
- en: '**Correlation with other artifacts**: Like AmCache, data from ShimCache can
    be cross-referenced with other forensic artifacts to provide a holistic view of
    the system’s execution history and potential incidents.'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与其他证据的关联**：类似于 AmCache，ShimCache 中的数据可以与其他取证证据交叉参考，从而提供系统执行历史和潜在事件的全面视图。'
- en: A popular tool for extracting and parsing ShimCache entries is ShimCacheParser,
    also part of Eric Zimmerman’s suite of forensic tools. It provides a structured
    output of the ShimCache entries, facilitating quick forensic analysis.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 提取和解析 ShimCache 条目的流行工具是 ShimCacheParser，它也是 Eric Zimmerman 的取证工具套件的一部分。它提供了
    ShimCache 条目的结构化输出，方便快速的取证分析。
- en: Important note
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You can download ShimCacheParser and find its usage details at [https://github.com/mandiant/ShimCacheParser](https://github.com/mandiant/ShimCacheParser).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以下载 ShimCacheParser，并在 [https://github.com/mandiant/ShimCacheParser](https://github.com/mandiant/ShimCacheParser)
    查找其使用详情。
- en: 'Consider a scenario where a malicious file named `malicious_mansoor.exe` is
    found on a Windows system. By extracting the ShimCache data and analyzing it using
    ShimCacheParser, the output might resemble the following:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 假设在 Windows 系统中发现了一个名为 `malicious_mansoor.exe` 的恶意文件。通过提取 ShimCache 数据并使用 ShimCacheParser
    进行分析，输出结果可能如下所示：
- en: '[PRE2]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Based on this output, incident responders and forensic experts could say with
    high confidence that the malicious file was executed and at what point the malicious
    binary, `malicious_mansoor.exe`, may have been created or last changed on the
    filesystem.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 根据此输出，事件响应者和取证专家可以高度确认恶意文件已经被执行，并能够推断恶意二进制文件 `malicious_mansoor.exe` 可能是在文件系统中何时创建或最后一次更改的。
- en: 'Here are some key TTPs to look for when analyzing ShimCache:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是分析 ShimCache 时需要注意的一些关键 TTPs：
- en: '**File paths**: The presence of executables from uncommon or suspicious directories
    in ShimCache is often a red flag.'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件路径**：ShimCache 中出现来自不常见或可疑目录的可执行文件通常是一个警示信号。'
- en: '**Execution flag**: While ShimCache logs executables, not all are necessarily
    executed. The execution flag distinguishes between mere presence and actual execution.'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**执行标记**：虽然 ShimCache 记录了可执行文件，但并非所有文件都必然被执行。执行标记区分了仅存在与实际执行之间的差异。'
- en: '**File modification time**: Anomalies in file modification times, especially
    if they correlate with known intrusion events, can be of significance.'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件修改时间**：文件修改时间的异常，特别是如果它们与已知的入侵事件相关联，可能具有重要意义。'
- en: '**File size and attributes**: Any deviations in file size or attributes from
    known good baselines can hint at potential tampering or malicious replacements.'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**文件大小和属性**：文件大小或属性偏离已知的正常基线可能暗示潜在的篡改或恶意替换。'
- en: ShimCache, which was designed for application compatibility, has evolved into
    an essential forensic artifact. Paired with other artifacts such as Prefetch and
    AmCache, ShimCache offers invaluable insights into system activities, aiding in
    thorough incident response and investigations.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: ShimCache是为应用程序兼容性而设计的，已经发展成为一个重要的取证工件。与Prefetch和AmCache等其他工件配对使用，ShimCache提供了对系统活动的宝贵见解，有助于彻底的事件响应和调查。
- en: Windows Event Logs
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Windows事件日志
- en: Windows Event Logs is a centralized system logging facility, inherent to Microsoft
    Windows systems. It provides detailed records of systems, security, applications,
    and other events. Whether it’s tracking user activity, diagnosing system issues,
    monitoring security incidents, or ensuring regulatory compliance, Event Logs play
    a crucial role.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: Windows事件日志是微软Windows系统固有的集中式系统日志记录设施。它提供了系统、安全、应用程序和其他事件的详细记录。无论是跟踪用户活动、诊断系统问题、监视安全事件还是确保合规性，事件日志都发挥着至关重要的作用。
- en: 'Here is the location:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是位置：
- en: '`C:\Windows\System32\winevt\Logs`'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`C:\Windows\System32\winevt\Logs`'
- en: '`C:\Windows\System32\winevt\Logs`'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`C:\Windows\System32\winevt\Logs`'
- en: 'Here are some important Windows Event Logs:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一些重要的Windows事件日志：
- en: '**Security logs**: Capture security-related events such as logons, logoffs,
    object access, account management, and more'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全日志**：捕获与安全相关的事件，如登录、注销、对象访问、账户管理等'
- en: '**System logs**: Reflect system components’ activities, including drivers and
    services, capturing alerts on system failures, resource depletion, or other system-wide
    occurrences'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**系统日志**：反映系统组件的活动，包括驱动程序和服务，捕获系统故障、资源耗尽或其他系统范围事件的警报'
- en: '**Application logs**: Register application events, errors, warnings, and informational
    messages from installed applications and services'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用程序日志**：记录安装的应用程序和服务的应用程序事件、错误、警告和信息消息'
- en: '**PowerShell logs**: Specifically record activities related to PowerShell commands,
    scripts, and modules'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PowerShell日志**：专门记录与PowerShell命令、脚本和模块相关的活动'
- en: '**Terminal services (RDP)**: Pertain to **Remote Desktop Protocol** (**RDP**)
    sessions, capturing login successes and failures, disconnections, and other RDP-specific
    happenings'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**终端服务（RDP）**：涉及**远程桌面协议**（**RDP**）会话，捕获登录成功和失败、断开连接以及其他RDP特定事件'
- en: 'Here''s the forensic importance:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是取证的重要性：
- en: '**Security logs**:'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**安全日志**：'
- en: '**Account logins**: Reveal when an account was authenticated'
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**账户登录**：显示账户何时被验证'
- en: '**Event ID 4624**: A successful logon'
  id: totrans-151
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4624**：成功登录'
- en: '**Event ID 4625**: An account failed to log in'
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4625**：账户登录失败'
- en: '**Account management**: Show when user accounts or groups are created, changed,
    or deleted:'
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**账户管理**：显示用户账户或组何时被创建、更改或删除：'
- en: '**Event ID 4720**: A user account was created'
  id: totrans-154
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4720**：用户账户已创建'
- en: '**Privilege use**: Indicate the use of special privileges'
  id: totrans-155
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**权限使用**：指示特权的使用'
- en: '**Event ID 4672**: Special privileges assigned to a new logon'
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4672**：为新登录分配特权'
- en: '**Object access**: Detail when specific objects (files, directories) were accessed'
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**对象访问**：详细说明何时访问特定对象（文件、目录）'
- en: '**Event ID 4663**: An attempt was made to access an object'
  id: totrans-158
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4663**：尝试访问对象'
- en: '**Terminal** **services (RDP)**:'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**终端** **服务（RDP）**：'
- en: '**Event ID 4778**: A session was reconnected to a window station'
  id: totrans-160
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4778**：会话重新连接到窗口站'
- en: '**Event ID 4779**: A session was disconnected from a window station'
  id: totrans-161
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4779**：会话从窗口站断开连接'
- en: '**PowerShell logs**:'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PowerShell日志**：'
- en: '**Event ID 4103**: Indicate that a PowerShell command or script block was executed'
  id: totrans-163
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4103**：指示已执行PowerShell命令或脚本块'
- en: '**Lateral movement**:'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**横向移动**：'
- en: '**Event ID 5140**: A network share was accessed'
  id: totrans-165
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 5140**：已访问网络共享'
- en: '**Event ID 5145**: A network share object was checked to see whether an object
    can be granted the desired access'
  id: totrans-166
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 5145**：检查网络共享对象以查看是否可以授予所需访问权限'
- en: '**Persistence via** **scheduled tasks**:'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**通过计划任务实现持久性**：'
- en: '**Event ID 4698**: A scheduled task was created'
  id: totrans-168
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4698**：已创建计划任务'
- en: '**Process/code execution**:'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**进程/代码执行**：'
- en: '**Event ID 4688**: A new process has been created'
  id: totrans-170
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件 ID 4688**：已创建新进程'
- en: To analyze Event Logs, you can use evtxECmd, an open source tool by Eric Zimmerman
    that provides extensive parsing capabilities.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 要分析事件日志，您可以使用Eric Zimmerman开发的开源工具evtxECmd，该工具提供了广泛的解析功能。
- en: Important note
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You can download evtxECmd and find its usage details at [https://github.com/EricZimmerman/evtx](https://github.com/EricZimmerman/evtx).
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在[https://github.com/EricZimmerman/evtx](https://github.com/EricZimmerman/evtx)下载evtxECmd并找到其使用详细信息。
- en: 'Here’s a quick example of how you might determine which accounts have logged
    in to a host:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个快速示例，说明如何确定哪些账户已登录到主机：
- en: '[PRE3]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The output will be a CSV file with parsed Security Event Logs and columns corresponding
    to the fields:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 输出将是一个包含解析的安全事件日志和对应字段的列的 CSV 文件：
- en: '![Figure 9.2 – Example of parsed security Event Logs (out.csv)](img/00005.jpeg)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![图 9.2 – 解析的安全事件日志示例（out.csv）](img/00005.jpeg)'
- en: Figure 9.2 – Example of parsed security Event Logs (out.csv)
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9.2 – 解析的安全事件日志示例（out.csv）
- en: 'Here are some key TTPs to look for when analyzing Windows Event Logs:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在分析 Windows 事件日志时，以下是一些关键的TTPs要注意：
- en: '**Account enumeration**: A high volume of failed login attempts, especially
    with various usernames, can indicate account enumeration attempts. Look for multiple
    events with event ID 4625.'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**账户枚举**：大量的登录失败尝试，特别是使用各种用户名，可能表明账户枚举尝试。查找具有事件 ID 4625 的多个事件。'
- en: '**Suspicious RDP activity**: Frequent remote logins, especially during odd
    hours, can signal malicious activity. Event ID 4778 and event ID 4779 can assist.'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可疑的 RDP 活动**：频繁的远程登录，特别是在奇怪的时间，可能表明恶意活动。事件 ID 4778 和事件 ID 4779 可以提供帮助。'
- en: '**Lateral movement**: A surge in network share access logs from unfamiliar
    systems may indicate lateral movement. Focus on event ID 5140 and event ID 5145.'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**横向移动**：从陌生系统访问网络共享日志的激增可能表明横向移动。关注事件 ID 5140 和事件 ID 5145。'
- en: '**Unusual PowerShell execution**: The execution of unexpected or rarely used
    PowerShell commands, tracked via event ID 4103, can hint at potential malicious
    activity.'
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**异常的 PowerShell 执行**：执行意外或很少使用的 PowerShell 命令，通过事件 ID 4103 跟踪，可能暗示潜在的恶意活动。'
- en: '**Task scheduling for persistence**: Event ID 4698 indicates task scheduling.
    If a task is scheduled repeatedly, especially from unfamiliar sources or at high
    frequencies, it can signal a persistence mechanism.'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**任务调度以实现持久性**：事件 ID 4698 指示任务调度。如果任务反复调度，特别是来自陌生来源或频率很高，可能表明存在持久性机制。'
- en: '**Code execution outside norms**: Anomalies in process creation events, especially
    from uncommon directories or unknown binaries, can be a red flag. Use event ID
    4688 for this.'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**代码执行异常**：进程创建事件中的异常，特别是来自不常见目录或未知二进制文件的，可能是一个警示信号。使用事件 ID 4688 进行检查。'
- en: Windows Event Logs are incredibly rich data sources that can provide a detailed
    view of nearly all activities on a system. Coupled with the right tools and an
    understanding of key events and indicators, they’re indispensable in any serious
    forensic investigation or incident response.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 事件日志是非常丰富的数据源，可以提供系统上几乎所有活动的详细视图。结合合适的工具和对关键事件和指标的理解，它们在任何严肃的取证调查或事件响应中都是不可或缺的。
- en: Analyzing memory dumps
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分析内存转储
- en: Memory dump forensics involves analyzing a snapshot of a system’s volatile memory.
    It can reveal a treasure trove of evidence about a system’s state at the time
    of the snapshot, from running processes to open network connections, in-memory
    artifacts, and even encryption keys or malware payloads that haven’t been written
    to disk.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 内存转储取证涉及分析系统易失性内存的快照。它可以揭示关于系统在快照时刻的状态的大量证据，从运行中的进程到打开的网络连接，内存中的工件，甚至未写入磁盘的加密密钥或恶意软件载荷。
- en: 'There are three types of memory dumps:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 有三种类型的内存转储：
- en: '**Full memory dump**: Captures the entire contents of physical memory (RAM)'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**完整内存转储**：捕获物理内存（RAM）的全部内容'
- en: '**Kernel memory dump**: Contains only the kernel-mode read/write pages'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内核内存转储**：仅包含内核模式的读/写页面'
- en: '**Small memory dump**: Records the smallest set of useful data, making it faster
    to save and easier to manage'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**小内存转储**：记录最小一组有用数据，使其更快保存和更容易管理'
- en: Typically, memory dumps are first saved to the host’s local disk, a choice driven
    by the speed and reliability of local storage, especially given the potentially
    large size of dump files. This is particularly relevant for full memory dumps,
    which capture the entire contents of physical memory (RAM) and thus are directly
    proportional in size to the amount of RAM in the system. For example, a system
    with 16 GB of RAM will result in a full memory dump of approximately the same
    size, necessitating substantial storage space.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，内存转储首先保存在主机的本地磁盘上，这是出于本地存储的速度和可靠性考虑，尤其是考虑到转储文件可能很大的情况。这对于完整内存转储尤为重要，因为完整内存转储捕获了物理内存（RAM）的全部内容，因此与系统中的
    RAM 量成正比。例如，一个拥有 16 GB RAM 的系统将导致大致相同大小的完整内存转储，需要大量的存储空间。
- en: Kernel memory dumps, containing only kernel-mode read/write pages, are smaller
    as they exclude user-mode applications and processes. Their size depends on the
    kernel footprint, usually much less than the total RAM but still sizeable. On
    the other hand, small memory dumps are significantly smaller, often just a few
    MBs, recording only the most essential data. They are quicker to save and manage,
    though they offer less comprehensive information.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 内核内存转储仅包含内核模式的读/写页面，因此它们较小，因为它们排除了用户模式的应用程序和进程。其大小取决于内核占用的内存，通常远小于总内存，但仍然相当可观。另一方面，小型内存转储显著更小，通常只有几MB，只记录最关键的数据。它们更快保存和管理，尽管提供的信息较为有限。
- en: 'Here''s the forensic importance:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 这是法医重要性：
- en: '**Active processes**: List all the processes running on the system, providing
    a real-time view of what was happening when the dump was taken.'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**活动进程**：列出系统上运行的所有进程，提供转储时的实时视图。'
- en: '**Network connections**: Determine which remote systems the machine was communicating
    with.'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络连接**：确定该机器与哪些远程系统通信。'
- en: '**Loaded modules**: Identify all drivers and dynamic link libraries (DLLs)
    loaded into memory. This can reveal injected DLLs or rootkits.'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**加载的模块**：识别加载到内存中的所有驱动程序和动态链接库（DLL）。这可以揭示被注入的DLL或根套件（rootkits）。'
- en: '**Decrypted data**: Sensitive data that might be encrypted on disk (e.g., passwords,
    encryption keys) can be found unencrypted in memory.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**解密数据**：可能在磁盘上加密的敏感数据（如密码、加密密钥）可以在内存中以未加密形式出现。'
- en: '**Malware artifacts**: Discover remnants of malware that might reside solely
    in memory and avoid being written to the filesystem.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**恶意软件痕迹**：发现可能仅存在于内存中的恶意软件残留物，这些恶意软件不会被写入文件系统。'
- en: 'Threat actors increasingly leverage techniques such as fileless malware, which
    operates entirely in memory, to evade traditional file-based detection methods.
    This makes memory forensics an essential component of incident response, especially
    in cases where not all evidence of compromise is written to the filesystem or
    captured in artifacts such as Prefetch, AmCache, ShimCache, and Event Logs. The
    importance of memory dump analysis depends on the nature of the compromise: for
    sophisticated attacks, especially those employing **advanced persistent threats**
    (**APTs**), memory analysis is often indispensable for uncovering the full extent
    of the compromise and the techniques used by the attackers. The caveat with memory
    forensics is that because they are run on the memory allocated by the RAM and
    not on the filesystem (and therefore the hard drive), they are cleared if the
    device is powered off.'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 威胁行为者越来越多地利用如无文件恶意软件等技术，这些恶意软件完全在内存中运行，从而避开传统的基于文件的检测方法。这使得内存取证成为事件响应的关键组成部分，尤其是在不是所有的妥协证据都写入文件系统或捕获到如Prefetch、AmCache、ShimCache和事件日志等痕迹的情况下。内存转储分析的重要性取决于妥协的性质：对于复杂的攻击，尤其是使用**高级持续性威胁**（**APT**）的攻击，内存分析通常是揭示妥协程度及攻击者使用技术的关键。内存取证的一个警告是，由于它们运行在由RAM分配的内存中，而不是文件系统（因此也不是硬盘上），如果设备断电，这些数据将被清除。
- en: The open source tool **Volatility** is a popular choice for memory dump forensics.
    It offers extensive plugin support, making it adaptable for various incident response
    tasks.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 开源工具**Volatility**是内存转储取证中的热门选择。它提供广泛的插件支持，使其适应各种事件响应任务。
- en: Important note
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: You can download Volatility and find its usage details at [https://www.volatilityfoundation.org/releases](https://www.volatilityfoundation.org/releases).
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以下载Volatility并在[https://www.volatilityfoundation.org/releases](https://www.volatilityfoundation.org/releases)查看其使用详情。
- en: 'Let’s look at a sample analysis using Volatility:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看一个使用Volatility的示例分析：
- en: 'Identify the image profile:'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 识别映像配置文件：
- en: '[PRE4]'
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This will suggest suitable profiles for further analysis – for example, if there
    are profiles for Windows 10 architectures.
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将为进一步分析建议合适的配置文件——例如，如果有Windows 10架构的配置文件。
- en: 'List the processes:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 列出进程：
- en: '[PRE5]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This displays active processes. Look for unusual or unexpected processes.
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这将显示活动进程。请查找不寻常或意外的进程。
- en: 'View network connections:'
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查看网络连接：
- en: '[PRE6]'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Review the established connections for any suspicious activity.
  id: totrans-214
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 审查已建立的连接是否有任何可疑活动。
- en: 'Here are the key TTPs to look for when analyzing memory dumps:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是分析内存转储时需要注意的关键TTP（战术、技术和程序）：
- en: '**Process injection**: Unusual child processes or unexpected parent-child process
    relationships can indicate process injection.'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**进程注入**：不寻常的子进程或意外的父子进程关系可能表示进程注入。'
- en: '**Hidden processes**: Malware often tries to hide its processes. Detecting
    these can point to rootkit activity or evasion techniques.'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**隐藏的进程**：恶意软件通常会尝试隐藏其进程。检测这些进程可以指示 rootkit 活动或规避技术。'
- en: '**Unexpected network connections**: Look out for those, especially to known
    malicious IPs or unfamiliar foreign addresses.'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**意外的网络连接**：留意这些连接，特别是那些指向已知恶意 IP 或不熟悉的外国地址的连接。'
- en: '**Hooks**: Some malware types use hooks to intercept system calls. Detecting
    these can be indicative of rootkits or certain types of spyware.'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**钩子**：某些类型的恶意软件使用钩子来拦截系统调用。检测这些钩子可能表明存在 rootkit 或某些类型的间谍软件。'
- en: '**Strings analysis**: Extracting and analyzing strings from a memory dump can
    reveal paths, commands, URLs, and other malware indicators.'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**字符串分析**：从内存转储中提取并分析字符串可以揭示路径、命令、URL 和其他恶意软件指示符。'
- en: '**In-memory file extraction**: Extracting files that exist only in memory can
    unveil malicious payloads that avoid the filesystem or any artifacts that were
    deleted from the disk but linger in memory.'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**内存中的文件提取**：提取仅存在于内存中的文件可以揭示恶意负载，这些负载避免了文件系统或任何已从磁盘删除但仍在内存中存在的工件。'
- en: Memory dump forensics offers unique insights that aren’t always obtainable from
    disk-based forensics. This form of analysis can be crucial, especially when dealing
    with advanced threats that use in-memory evasion or reside solely in volatile
    memory. Proper tools and a keen eye for anomalies make memory forensics a formidable
    weapon in the arsenal of every incident responder.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 内存转储取证提供了从基于磁盘的取证中无法获得的独特见解。这种分析形式对于处理使用内存规避或仅存在于易失性内存中的高级威胁尤其重要。正确的工具和对异常的敏锐观察使得内存取证成为每个事件响应者手中的强大武器。
- en: Misconfigured virtual machine instances
  id: totrans-223
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置错误的虚拟机实例
- en: One of the prevalent entry points for attackers in cloud environments is through
    misconfigured virtual machine instances. The beauty of the cloud is how rapid
    the deployment of VMs can be. However, the downside of this is that configurations
    may be overlooked or improperly set. Such oversights grant threat actors unintended
    access or provide them with information to further their intrusions. Let’s look
    at some common misconfigurations.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 云环境中攻击者常见的入侵点之一是通过配置错误的虚拟机实例。云的优点在于虚拟机部署的快速性。然而，这也带来了缺点，即配置可能被忽视或设置不当。此类疏忽会无意间为威胁行为者提供访问权限，或提供进一步入侵的信息。我们来看看一些常见的配置错误。
- en: Unnecessary ports left open
  id: totrans-225
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 不必要的端口保持打开状态
- en: Open ports function as communication endpoints for virtual machines. Each port
    allows a specific type of communication, such as HTTP traffic on port `80`. However,
    leaving unused or unnecessary ports open expands the potential attack surface.
    An attacker can exploit open ports by identifying vulnerabilities associated with
    the services listening on these ports. It’s essential to ensure that only required
    ports are open and accessible.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 打开的端口作为虚拟机的通信端点。每个端口允许特定类型的通信，例如端口 `80` 上的 HTTP 流量。然而，保持不必要或未使用的端口开放会扩大潜在的攻击面。攻击者可以通过识别与这些端口上服务相关的漏洞来利用开放端口。确保只有必需的端口开放和可访问是至关重要的。
- en: 'Here are some indicators to look for:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些需要留意的指标：
- en: '**Host** **level (Windows)**:'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主机** **级别（Windows）**：'
- en: Windows event ID 5156 (Windows Filtering Platform has permitted a connection)
    can be monitored to detect allowed network connections
  id: totrans-229
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 事件 ID 5156（Windows 过滤平台已允许连接）可以被监控，用于检测已允许的网络连接
- en: Windows event ID 5157 (Windows Filtering Platform has blocked a connection)
    can alert to blocked connection attempts
  id: totrans-230
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 事件 ID 5157（Windows 过滤平台已阻止连接）可以提醒用户连接尝试已被阻止
- en: '**CSP**:'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CSP**：'
- en: '**AWS**: VPC Flow Logs, as discussed previously, can be used to observe the
    traffic that is reaching the virtual machine'
  id: totrans-232
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS**：如前所述，VPC 流日志可用于观察到达虚拟机的流量'
- en: '**Azure**: NSG Flow Logs, as discussed previously, can offer insights into
    network traffic targeting the virtual machines'
  id: totrans-233
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure**：如前所述，NSG 流日志可以提供有关针对虚拟机的网络流量的洞察'
- en: Default credentials left unchanged
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 默认凭证未更改
- en: Virtual machines often come with default administrator credentials for initial
    setup and access. While this is convenient for deployment, leaving these default
    credentials unchanged poses a significant security risk. Attackers are well aware
    of default credentials for many systems and can easily gain unauthorized access
    if they aren’t updated.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机通常在初始设置和访问时带有默认管理员凭据。虽然这在部署时很方便，但如果不更改这些默认凭据，会带来巨大的安全风险。攻击者很清楚许多系统的默认凭据，如果不进行更新，他们可以轻松获得未经授权的访问权限。
- en: 'Here’s an indicator to look for:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个需要关注的指示器：
- en: '**Host level (Windows)**: Windows event ID 4625 (an account failed to log on)
    can be monitored to detect and respond to failed login attempts.'
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主机级别（Windows）：** Windows事件ID 4625（账户登录失败）可以用于监控并响应失败的登录尝试。'
- en: Outdated or unpatched software
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 过时或未打补丁的软件
- en: Regularly updating and patching software and operating systems is a fundamental
    security practice. Over time, vulnerabilities in software are discovered, and
    patches are released to address them. Running outdated or unpatched software exposes
    the virtual machine to known vulnerabilities, creating opportunities for exploitation
    by attackers who target these weaknesses.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 定期更新和打补丁软件及操作系统是基本的安全实践。随着时间的推移，软件中的漏洞会被发现，并发布补丁来修复它们。运行过时或未打补丁的软件会暴露虚拟机于已知漏洞之下，为攻击者利用这些漏洞创造了机会。
- en: 'Here are some indicators to look for:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些需要关注的指示器：
- en: '**Host** **level (Windows)**:'
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主机级别（Windows）：**'
- en: Windows event ID 4375 (Windows Installer updated an installed product) can provide
    insights into patch installations and software updates
  id: totrans-242
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows事件ID 4375（Windows安装程序更新已安装的产品）可以提供补丁安装和软件更新的洞察
- en: Software inventories and/or vulnerability scans using tools such as Nessus
  id: totrans-243
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Nessus等工具进行软件清单和/或漏洞扫描
- en: '**CSP**:'
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CSP：**'
- en: '**AWS**: AWS Systems Manager Patch Manager can be utilized for automated patching
    based on set policies.'
  id: totrans-245
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS：** AWS Systems Manager Patch Manager可以根据设定的策略进行自动化补丁管理。'
- en: '**Azure**: Azure Security Center highlights unpatched virtual machines and
    recommends relevant security patches.'
  id: totrans-246
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure：** Azure安全中心突出显示未打补丁的虚拟机，并建议相关的安全补丁。'
- en: '**GCP:** GCP’s operating system patch management service, Patch, allows for
    the scheduling and automation of patch deployment across virtual machine instances
    in Google Cloud. It provides features for patch compliance reporting and configuration
    of patch rollout schedules, ensuring that virtual machines are updated with the
    latest security patches.'
  id: totrans-247
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**GCP：** GCP的操作系统补丁管理服务Patch允许在Google Cloud中的虚拟机实例之间调度和自动化补丁部署。它提供了补丁合规性报告和补丁发布计划的配置功能，确保虚拟机更新到最新的安全补丁。'
- en: Publicly exposed sensitive data (or metadata)
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 公开暴露的敏感数据（或元数据）
- en: 'Data exposure is a critical issue, especially when sensitive or personal data
    is involved. Whether due to incorrect access controls, oversight, or misconfigured
    settings, public exposure of sensitive data can lead to data breaches, reputational
    damage, and potential regulatory repercussions. Ensuring strict access controls
    and regular audits is imperative to prevent unintentional data exposure. Let’s
    take a closer look:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 数据暴露是一个关键问题，尤其是在涉及敏感或个人数据时。无论是由于访问控制不当、疏忽还是配置错误，敏感数据的公开暴露都可能导致数据泄露、声誉损害以及潜在的监管后果。确保严格的访问控制和定期审核对于防止无意的数据暴露至关重要。让我们仔细看看：
- en: '**Host** **level (Windows)**:'
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主机级别（Windows）：**'
- en: Windows event ID 4663 (an attempt was made to access an object) can be monitored
    to detect unusual or unexpected access attempts to sensitive files
  id: totrans-251
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows事件ID 4663（尝试访问对象）可以用于监控异常或意外的敏感文件访问尝试
- en: Application logs at the software application level
  id: totrans-252
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在软件应用程序级别的应用程序日志
- en: '**CSP**:'
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CSP：**'
- en: '**AWS**: Amazon has additional services that are designed to discover, classify,
    and safeguard sensitive data within AWS S3 – for example, Amazon Macie.'
  id: totrans-254
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS：** 亚马逊提供了额外的服务，旨在发现、分类和保护AWS S3中的敏感数据——例如，Amazon Macie。'
- en: '**Azure**: Azure storage logging through Azure Monitor helps monitor and analyze
    requests made to storage resources, ensuring only authorized access.'
  id: totrans-255
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure：** 通过Azure Monitor的Azure存储日志可以帮助监控和分析对存储资源的请求，确保只有授权访问。'
- en: '**GCP**: GCP’s Sensitive Data Protection suite of services helps in discovering
    and classifying sensitive data across GCP services. Google Cloud Storage also
    offers detailed logging and monitoring capabilities through Cloud Audit Logs,
    allowing requests to storage resources to be tracked and analyzed.'
  id: totrans-256
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**GCP**：GCP的敏感数据保护服务套件有助于发现并分类GCP服务中的敏感数据。Google Cloud Storage还通过Cloud Audit
    Logs提供详细的日志记录和监控功能，允许跟踪和分析对存储资源的请求。'
- en: By understanding these areas of misconfiguration and by actively monitoring
    for the associated indicators, organizations can greatly enhance their virtual
    machine security posture in the cloud.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 通过了解这些配置错误领域并积极监控相关指示，组织可以大大增强其云中虚拟机的安全态势。
- en: Misconfigured storage buckets
  id: totrans-258
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置错误的存储桶
- en: Misconfigured storage buckets have emerged as a significant vulnerability in
    cloud environments. Cloud storage solutions, such as Amazon’s S3 buckets or Azure
    Blob Storage, are often set up with ease and speed in mind. However, without rigorous
    security configurations, they can inadvertently become publicly accessible or
    easily breached. Such misconfigurations expose sensitive data, leading to potential
    data leaks and compromising organizational integrity. Let’s look at some common
    misconfigurations that may allow unauthorized access.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 配置错误的存储桶已成为云环境中的一个重大漏洞。像Amazon的S3存储桶或Azure Blob存储这样的云存储解决方案通常以简便和快速为设计目标。然而，如果没有严格的安全配置，它们可能会无意中变得公开可访问或容易被攻破。此类配置错误会暴露敏感数据，导致潜在的数据泄漏，并危害组织的完整性。让我们来看一些可能允许未经授权访问的常见配置错误。
- en: Public permissions
  id: totrans-260
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 公共权限
- en: Storage resources are typically created with a default private setting, ensuring
    that only properly authenticated and authorized entities can access the stored
    data. However, sometimes, these permissions are altered, either for convenience
    or by mistake, leading to unintentional public exposure.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 存储资源通常以默认的私有设置创建，确保只有经过适当认证和授权的实体可以访问存储的数据。然而，有时为了方便或因误操作，这些权限可能会被更改，导致无意中的公开曝光。
- en: 'Here are some indicators to look for:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是需要注意的一些指示：
- en: '**AWS**:'
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**AWS**：'
- en: Navigate to the Amazon S3 console. Check the **Access** column for each bucket.
    If any of them are labeled as **Public**, then there’s potential exposure.
  id: totrans-264
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进入Amazon S3控制台，检查每个存储桶的**访问**列。如果有任何存储桶标记为**公开**，则可能存在曝光风险。
- en: 'The AWS CLI can be used as follows:'
  id: totrans-265
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以按如下方式使用AWS CLI：
- en: '[PRE7]'
  id: totrans-266
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'If `Grantee: Group` has a URI of `http://acs.amazonaws.com/groups/global/AllUsers`,
    then the bucket has public permissions.'
  id: totrans-267
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '如果`Grantee: Group`的URI为`http://acs.amazonaws.com/groups/global/AllUsers`，则该存储桶具有公共权限。'
- en: '**Azure**:'
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure**：'
- en: In the Azure portal, under **Blob Service** | **Containers**, check the **Public
    Access Level** property of each container.
  id: totrans-269
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Azure门户中，导航至**Blob服务** | **容器**，检查每个容器的**公共访问级别**属性。
- en: 'We can use the Azure CLI as follows:'
  id: totrans-270
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以按如下方式使用Azure CLI：
- en: '[PRE8]'
  id: totrans-271
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: If the output is `Blob` or `Container`, there’s public accessibility.
  id: totrans-272
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果输出为`Blob`或`Container`，则表示具有公共访问权限。
- en: Exposed API keys or credentials
  id: totrans-273
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 曝露的API密钥或凭据
- en: Storage buckets sometimes mistakenly contain sensitive files that hold API keys,
    credentials, or other secrets. If an attacker gains access to these, they could
    compromise systems or data associated with those keys.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 存储桶有时错误地包含敏感文件，这些文件可能包含API密钥、凭据或其他机密。如果攻击者获取这些文件，他们可能会危及与这些密钥相关的系统或数据。
- en: 'Here are some indicators to look for:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是需要注意的一些指示：
- en: '`*.pem`, `*.json`, `credentials`, `keys`, and so on within your S3 buckets.'
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在你的S3存储桶中，查找`*.pem`、`*.json`、`credentials`、`keys`等文件。
- en: 'You can use the following AWS CLI sample to list all the files in a bucket:'
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以使用以下AWS CLI示例列出存储桶中的所有文件：
- en: '[PRE9]'
  id: totrans-278
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You can use the following Azure CLI sample to list blobs in a container:'
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以使用以下Azure CLI示例列出容器中的Blob：
- en: '[PRE10]'
  id: totrans-280
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Improper use of IAM policies
  id: totrans-281
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IAM策略的错误使用
- en: IAM controls who or what can perform actions on specific resources. Improper
    IAM configurations could give users or roles more access than they need, violating
    the principle of least privilege.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: IAM控制谁或什么可以在特定资源上执行操作。不当的IAM配置可能会给予用户或角色超过其所需的权限，从而违反最小权限原则。
- en: 'Here are some indicators to look for:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是需要注意的一些指示：
- en: '`s3:*` actions on `s3:::YOUR_BUCKET_NAME/*`.'
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`s3:*`操作针对`s3:::YOUR_BUCKET_NAME/*`。'
- en: 'You can use the following AWS CLI sample to list policies for a user:'
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以使用以下AWS CLI示例列出用户的策略：
- en: '[PRE11]'
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '**Azure**:'
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure**：'
- en: Review **role-based access control** (**RBAC**) assignments on the storage account.
    Ensure there are no overly permissive roles such as Owner or Contributor assigned
    to identities that don’t need them.
  id: totrans-288
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审查存储帐户的**基于角色的访问控制**（**RBAC**）分配。确保没有将如“所有者”或“贡献者”等权限过高的角色分配给不需要这些角色的身份。
- en: 'You can use the following Azure CLI sample to list role assignments for a storage
    account:'
  id: totrans-289
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以使用以下 Azure CLI 示例列出存储帐户的角色分配：
- en: '[PRE12]'
  id: totrans-290
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: By regularly reviewing and ensuring the correct configurations of storage buckets
    and associated permissions, organizations can reduce the risk of data exposure
    and potential compromises.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 通过定期检查并确保存储桶和相关权限的正确配置，组织可以降低数据暴露和潜在泄露的风险。
- en: Cloud administrator portal breach
  id: totrans-292
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 云管理员门户被攻破
- en: 'Gaining access to the cloud administrator portal is akin to handing over the
    keys to the entire cloud kingdom. An attacker with such access can not only view
    sensitive data but can manipulate configurations, delete crucial resources, and
    potentially incur huge costs by spawning large amounts of resources. Let’s take
    a closer look at what attacks can be performed:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 获取对云管理员门户的访问权限就像是把整个云王国的钥匙交给了攻击者。拥有此类访问权限的攻击者不仅可以查看敏感数据，还可以修改配置、删除关键资源，并通过启动大量资源来可能引发巨额费用。让我们来仔细看看可能执行的攻击：
- en: '**Brute-force attacks**: Attackers use software to try as many combinations
    as possible to gain access'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**暴力破解攻击**：攻击者使用软件尝试尽可能多的组合以获取访问权限'
- en: '**Indicator**: Multiple failed login attempts from the same IP address in a
    short period'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**指示器**：来自同一 IP 地址的多个失败登录尝试，且时间间隔很短'
- en: '**Credential stuffing**: Attackers use previously breached usernames and passwords'
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**凭证填充攻击**：攻击者使用以前泄露的用户名和密码'
- en: '**Indicator**: Login attempts with multiple usernames from the same IP address'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**指示器**：来自同一 IP 地址的多个用户名的登录尝试'
- en: '**Phishing attacks**: Attackers deceive users into providing their login credentials'
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**钓鱼攻击**：攻击者欺骗用户提供其登录凭证'
- en: '**Indicator**: Users accessing cloud portals from unfamiliar referrer URLs
    or logging in from unfamiliar locations'
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**指示器**：用户通过不熟悉的引荐 URL 访问云门户或从不熟悉的地点登录'
- en: '**Token theft**: Attackers steal authentication tokens or session cookies.'
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**令牌窃取**：攻击者窃取身份验证令牌或会话 cookies。'
- en: '**Indicator**: Unusual user agent strings or unexpected locations paired with
    familiar user accounts'
  id: totrans-301
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**指示器**：异常的用户代理字符串或与熟悉的用户帐户配对的意外位置'
- en: 'AWS detections:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: AWS 检测：
- en: '`eventName` such as `ConsoleLogin` paired with `errorMessage` such as `Failed
    authentication` for failed logins'
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`eventName` 如 `ConsoleLogin` 与 `errorMessage` 如 `Failed authentication` 结合显示失败的登录尝试'
- en: Multiple `sourceIPAddresses` for the same `userIdentity` in a short period might
    suggest suspicious activity
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同一 `userIdentity` 在短时间内有多个 `sourceIPAddresses` 可能表示可疑活动
- en: AWS management console sign-in URL redirection, which can be an indicator of
    phishing attempts
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AWS 管理控制台登录 URL 重定向，这可能是钓鱼攻击的指示器
- en: '`UnauthorizedAccess:IAMUser`/`ConsoleLogin`, which indicates suspicious console
    logins.'
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UnauthorizedAccess:IAMUser`/`ConsoleLogin`，这表明可疑的控制台登录。'
- en: 'Azure detections:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: Azure 检测：
- en: '**Azure activity log**: Provides incident responders with insight into operations
    that were performed on resources. Search for the following:'
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure 活动日志**：为事件响应者提供对在资源上执行的操作的洞察。请查找以下内容：'
- en: Activities with a status of **Failed** linked with **Sign-in** operations
  id: totrans-309
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与**登录**操作关联的状态为**失败**的活动
- en: Unusual IP addresses or regions associated with successful sign-ins
  id: totrans-310
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与成功登录关联的异常 IP 地址或地区
- en: '**Azure AD sign-ins**: This provides incident responders with access to the
    sign-in activity within the tenant. Look for the following:'
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Azure AD 登录**：这为事件响应者提供了租户内登录活动的访问权限。请查找以下内容：'
- en: Multiple failed sign-in attempts
  id: totrans-312
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多次失败的登录尝试
- en: Sign-in attempts from unfamiliar locations or unusual devices
  id: totrans-313
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自不熟悉的地点或异常设备的登录尝试
- en: By understanding the TTPs and regularly monitoring the relevant logs, incident
    responders and defenders can detect and potentially prevent breaches due to weak
    authentication in cloud environments. Even though secure multi-factor authentication
    has become more common, the cybersecurity landscape is fast evolving and new threats
    may emerge that may require incident responders to respond to complete administrator
    portal takeovers.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 通过了解 TTPs（战术、技术和程序）并定期监控相关日志，事件响应者和防御者可以检测并可能防止由于云环境中的弱身份验证引发的安全漏洞。即使安全的多因素身份验证已变得更加普及，网络安全领域也在快速发展，新的威胁可能会出现，可能需要事件响应者应对完整的管理员门户接管。
- en: Summary
  id: totrans-315
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, you learned about the challenges and risks that come with cloud
    security. We discussed how cloud environments, despite their advantages, have
    unique security issues. From misconfigured virtual machine instances to unprotected
    storage buckets, we highlighted the areas where mistakes can happen and how they
    can be exploited by attackers.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章中，你了解了云安全所面临的挑战和风险。我们讨论了尽管云环境有其优势，但也存在独特的安全问题。从配置错误的虚拟机实例到未保护的存储桶，我们强调了可能发生错误的领域，以及这些错误如何被攻击者利用。
- en: You’ve also gained insights into host-based forensics, diving into key indicators
    such as prefetch, AmCache, ShimCache, Windows Event Logs, and memory dumps. We
    touched on the importance of securing virtual machines, covering open ports, default
    credentials, and outdated software. Storage bucket configurations and their potential
    pitfalls were also discussed. Lastly, we delved into the crucial topic of authentication,
    emphasizing the serious outcomes of a cloud administrator portal breach.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 你还了解了基于主机的取证，深入探讨了关键指标，如预取（prefetch）、AmCache、ShimCache、Windows事件日志和内存转储。我们提到了确保虚拟机安全的重要性，涵盖了开放端口、默认凭证和过时的软件。还讨论了存储桶配置及其潜在的风险。最后，我们深入探讨了身份验证这一关键话题，强调了云管理员门户被突破所可能带来的严重后果。
- en: As we transition to the next chapter on cloud evidence acquisition, we’ll focus
    on collecting evidence in cloud environments.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们过渡到下一章关于云证据采集的内容时，我们将重点关注在云环境中收集证据。
- en: Further reading
  id: totrans-319
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'The MITRE ATT&CK matrix for cloud-based techniques: [https://attack.mitre.org/matrices/enterprise/cloud/](https://attack.mitre.org/matrices/enterprise/cloud/).'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: MITRE ATT&CK矩阵：面向云的技术：[https://attack.mitre.org/matrices/enterprise/cloud/](https://attack.mitre.org/matrices/enterprise/cloud/).
