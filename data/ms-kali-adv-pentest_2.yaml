- en: Part 1. *The Attacker's Kill Chain*
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第1部分. *攻击者的Kill链*
- en: '*[Starting with Kali Linux](ch01.html "Chapter 1. Starting with Kali Linux")*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*[从Kali Linux开始](ch01.html "第1章. 从Kali Linux开始")*'
- en: '*[Identifying the Target – Passive Reconnaissance](ch02.html "Chapter 2. Identifying
    the Target – Passive Reconnaissance")*'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '*[识别目标-被动侦察](ch02.html "第2章. 识别目标-被动侦察")*'
- en: '*[Active Reconnaissance and Vulnerability Scanning](ch03.html "Chapter 3. Active
    Reconnaissance and Vulnerability Scanning")*'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '*[主动侦察和漏洞扫描](ch03.html "第3章. 主动侦察和漏洞扫描")*'
- en: '*[Exploit](ch04.html "Chapter 4. Exploit")*'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '*[利用](ch04.html "第4章. 利用")*'
- en: '*[Post Exploit – Action on the Objective](ch05.html "Chapter 5. Post Exploit
    – Action on the Objective")*'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '*[后期利用-对目标的行动](ch05.html "第5章. 后期利用-对目标的行动")*'
- en: '*[Post Exploit – Persistence](ch06.html "Chapter 6. Post Exploit – Persistence")*'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '*[后期利用-持久性](ch06.html "第6章. 后期利用-持久性")*'
- en: Chapter 1. Starting with Kali Linux
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第1章. 从Kali Linux开始
- en: 'Kali Linux (Kali) is the successor to the BackTrack penetration testing platform
    which is generally regarded as the de facto standard package of tools used to
    facilitate penetration testing to secure data and voice networks. This chapter
    provides an introduction to Kali, and focuses on customizing Kali to support some
    advanced aspects of penetration testing. By the end of this chapter, you will
    have learned:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux（Kali）是BackTrack渗透测试平台的继任者，通常被认为是用于保护数据和语音网络的渗透测试的事实标准工具包。本章介绍了Kali，并侧重于定制Kali以支持渗透测试的一些高级方面。通过本章的学习，您将学到：
- en: An overview of Kali
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali概述
- en: Configuring network services and secure communications
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置网络服务和安全通信
- en: Updating Kali
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新Kali
- en: Customizing Kali
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定制Kali
- en: Extending Kali's functionality with third-party applications
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用第三方应用程序扩展Kali的功能
- en: Effective management of penetration tests
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有效管理渗透测试
- en: Kali Linux
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Kali Linux
- en: '**BackTrack** (**BT**), ([www.offensive-security.com](http://www.offensive-security.com))
    was released to provide an extensive variety of penetration testing and defensive
    tools that were perfect for auditors and network administrators interested in
    assessing and securing their networks. The same tools were used by both authorized
    and unauthorized (hackers) penetration testers.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '**BackTrack**（BT）（[www.offensive-security.com](http://www.offensive-security.com)）发布，提供了广泛的渗透测试和防御工具，非常适合对网络进行评估和保护的审计员和网络管理员。授权和未经授权（黑客）渗透测试人员都使用相同的工具。'
- en: The final version of BackTrack, BT 5r3, was released in August 2012\. Based
    on the Ubuntu Linux platform, it was widely adopted and supported by the security
    community. Unfortunately, its file architecture made it difficult to manage the
    array of tools and their accompanying dependencies.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: BackTrack的最终版本BT 5r3于2012年8月发布。基于Ubuntu Linux平台，它被安全社区广泛采用和支持。不幸的是，它的文件架构使得难以管理各种工具及其相关依赖。
- en: In BackTrack, all of the tools used for penetration testing were placed in the
    `/pentest` directory. Subfolders such as `/web` or `/database` helped to further
    define the location of tools. Finding and executing tools within this hierarchy
    could be counterintuitive. For example, is sqlninja, which identifies an SQL injection,
    a web vulnerability assessment tool, a web exploit tool, or a database exploit
    tool?
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在BackTrack中，用于渗透测试的所有工具都放在/pentest目录中。子文件夹如/web或/database有助于进一步定义工具的位置。在这种层次结构中查找和执行工具可能是不直观的。例如，用于识别SQL注入的sqlninja是Web漏洞评估工具、Web利用工具还是数据库利用工具？
- en: In March 2013, BackTrack was superseded by Kali Linux, which uses a new platform
    architecture based on the Debian GNU/Linux operating system.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 2013年3月，BackTrack被Kali Linux取代，后者使用基于Debian GNU/Linux操作系统的新平台架构。
- en: Debian adheres to the **Filesystem Hierarchy Standard** (**FHS**), which is
    a significant advantage over BackTrack. Instead of needing to navigate through
    the /pentest tree, you can call a tool from anywhere on the system because applications
    are included in the system path.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Debian遵循文件系统层次结构标准（FHS），这是与BackTrack相比的一个重要优势。不需要在/pentest树中导航，因为应用程序包含在系统路径中，可以从系统的任何位置调用工具。
- en: 'Other features of Kali include the following:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Kali的其他特性包括：
- en: Support for multiple desktop environments such as Gnome, KDE, LXDE, and XFCE,
    and provides multilingual support.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持多个桌面环境，如Gnome、KDE、LXDE和XFCE，并提供多语言支持。
- en: Debian-compliant tools are synchronized with the Debian repositories at least
    four times daily, making it easier to update packages and apply security fixes.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 符合Debian的工具至少每天同步四次，这样更容易更新软件包并应用安全补丁。
- en: Support for ISO customizations, allowing users to build their own versions of
    Kali. The bootstrap function also performs enterprise-wide network installs that
    can be automated using pre-seed files.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持ISO定制，允许用户构建自己的Kali版本。引导功能还可以执行企业范围的网络安装，可以使用预先配置文件进行自动化。
- en: '**ARMEL** and **ARMHF** support allows Kali to be installed on devices such
    as Raspberry Pi, ODROID-U2/-X2, and the Samsung Chromebook.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ARMEL和ARMHF支持使得Kali可以安装在树莓派、ODROID-U2/-X2和三星Chromebook等设备上。
- en: Over 300 penetration testing data forensics and defensive tools are included.
    They provide extensive wireless support with kernel patches to permit the packet
    injection required by some wireless attacks.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包括300多个渗透测试数据取证和防御工具。它们提供了广泛的无线支持，通过内核补丁允许一些无线攻击所需的数据包注入。
- en: Kali remains an open source project that is free. Most importantly, it is well
    supported by an active online community.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali仍然是一个免费的开源项目。最重要的是，它得到了活跃的在线社区的支持。
- en: Throughout this book, we'll be using a VMware **virtual machine** (**VM**) of
    64-bit Kali (refer to [Appendix](apa.html "Appendix A. Installing Kali Linux"),
    *Installing Kali Linux* for instructions on installing Kali).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们将使用64位Kali的VMware虚拟机（参见[附录](apa.html "附录A. 安装Kali Linux")，*安装Kali Linux*中有有关安装Kali的说明）。
- en: A VM is used because it makes it easy to rapidly execute certain applications
    in other operating systems, such as Microsoft Windows. In addition, a VM can be
    archived with the results from a penetration test, allowing the archive to be
    reviewed to determine if a particular vulnerability would have been detected with
    the toolset that was used for testing.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 使用VM是因为它可以轻松地在其他操作系统中快速执行某些应用程序，比如Microsoft Windows。此外，可以使用VM存档进行渗透测试的结果，以便审查存档，以确定特定漏洞是否会被用于测试的工具集检测到。
- en: 'When Kali is launched, the user will be taken to the default desktop GUI with
    a menu bar at the top and a few simple icons. By selecting the menu item **Applications**,
    and then **Kali Linux**, the user will gain access to a menu system that contains
    the **Top 10 Security Tools** as well as a series of folders, organized in the
    general order that would be followed during a penetration test, as shown in the
    following screenshot:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 启动Kali时，用户将进入默认的桌面GUI，顶部有一个菜单栏和一些简单的图标。通过选择菜单项**应用程序**，然后**Kali Linux**，用户将获得一个包含**前10个安全工具**以及一系列文件夹的菜单系统，这些文件夹按照渗透测试中的一般顺序进行组织，如下截图所示：
- en: '![Kali Linux](img/3121OS_01_01.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![Kali Linux](img/3121OS_01_01.jpg)'
- en: Note
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The menu will be familiar to users of BT 5r3\. However, there are some changes,
    which include simplified access to network services and communications.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 该菜单对于BT 5r3的用户来说是熟悉的。然而，有一些变化，包括简化了对网络服务和通信的访问。
- en: Configuring network services and secure communications
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置网络服务和安全通信
- en: The first step in being able to use Kali is to ensure that it has connectivity
    to either a wired or wireless network to support updates and customization.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Kali的第一步是确保它能够连接到有线或无线网络，以支持更新和定制。
- en: 'You may need to obtain an IP address by **DHCP** (**Dynamic Host Configuration
    Protocol**), or assign one statically. First, confirm your IP address using the
    `ifconfig` command from a terminal window, as shown in the following screenshot:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能需要通过**DHCP**（**动态主机配置协议**）获取IP地址，或者静态分配一个IP地址。首先，使用终端窗口中的`ifconfig`命令确认您的IP地址，如下截图所示：
- en: '![Configuring network services and secure communications](img/3121OS_01_02_New.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![配置网络服务和安全通信](img/3121OS_01_02_New.jpg)'
- en: In this particular case, the VM has been assigned an IP address of `192.168.204.132`.
    If an IP address was not obtained, an address can be assigned by DHCP using the
    command `dhclient eth0` (or other available interfaces, which will depend on the
    specific configuration of the system being used).
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种特殊情况下，VM被分配了IP地址`192.168.204.132`。如果没有获得IP地址，可以使用命令`dhclient eth0`（或其他可用接口，这将取决于所使用系统的具体配置）通过DHCP分配地址。
- en: 'If a static IP address is used, additional information may be required. For
    example, you can assign a static IP of `192.168.204.128` as follows:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用静态IP地址，可能需要额外的信息。例如，您可以分配静态IP`192.168.204.128`如下：
- en: '[PRE0]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Enter a terminal window and enter the following command:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 输入终端窗口并输入以下命令：
- en: '[PRE1]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Changes made to IP settings are nonpersistent, and will be lost when Kali is
    rebooted. To make the changes permanent, you will need to edit the `/etc/network/interfaces`
    file, as shown in the following screenshot:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 对IP设置的更改是非持久的，在Kali重新启动时将丢失。要使更改永久生效，您需要编辑`/etc/network/interfaces`文件，如下截图所示：
- en: '![Configuring network services and secure communications](img/3121OS_01_03.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![配置网络服务和安全通信](img/3121OS_01_03.jpg)'
- en: 'By default, Kali does not start with the DHCP service enabled. Doing so announces
    the new IP address on the network, and this may alert administrators about the
    presence of the tester. For some test cases, this may not be an issue, and it
    may be advantageous to have certain services start automatically during boot up.
    This can be achieved by entering the following commands:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Kali不会启用DHCP服务。这样做会在网络上宣布新的IP地址，这可能会提醒管理员有测试者的存在。对于某些测试案例，这可能不是一个问题，而且在启动时自动启动某些服务可能是有利的。可以通过输入以下命令来实现这一点：
- en: '[PRE2]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Kali installs with network services that can be started or stopped as required,
    including DHCP, HTTP, SSH, TFTP, and the VNC server. These services are usually
    invoked from the command line, however, some are accessible from the Kali menu.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: Kali安装了可以根据需要启动或停止的网络服务，包括DHCP、HTTP、SSH、TFTP和VNC服务器。这些服务通常是从命令行调用的，但是有些可以从Kali菜单中访问。
- en: Adjusting network proxy settings
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调整网络代理设置
- en: Users located behind an authenticated or unauthenticated proxy connection must
    modify `bash.bashrc` and `apt.conf`. Both files are located in the `/root/etc`
    directory.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 位于经过身份验证或未经身份验证的代理连接后的用户必须修改`bash.bashrc`和`apt.conf`。这两个文件位于`/root/etc`目录中。
- en: 'Edit the `bash.bashrc` file, as shown in the following screenshot, use a text
    editor to add the following lines to the bottom of the `bash.bashrc` file:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑`bash.bashrc`文件，如下截图所示，使用文本编辑器将以下行添加到`bash.bashrc`文件的底部：
- en: '[PRE3]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![Adjusting network proxy settings](img/3121OS_01_05.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![调整网络代理设置](img/3121OS_01_05.jpg)'
- en: Replace `proxyIP` and `port` with your proxy IP address and port number respectively,
    and replace the username and password with your authentication username and password.
    If there's no need to authenticate, write only the part following the `@` symbol.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用你的代理IP地址和端口号分别替换`proxyIP`和`port`，用你的认证用户名和密码替换用户名和密码。如果不需要进行身份验证，只需写`@`符号后面的部分。
- en: In the same directory, create the `apt.conf` file and enter the following command
    lines, as shown in the following screenshot:![Adjusting network proxy settings](img/3121OS_01_06.jpg)
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在同一目录中，创建`apt.conf`文件并输入以下命令行，如下截图所示：![调整网络代理设置](img/3121OS_01_06.jpg)
- en: Save and close the file. Log out and then log in to activate the new settings.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并关闭文件。注销然后重新登录以激活新设置。
- en: Securing communications with Secure Shell
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用安全外壳保护通信
- en: To minimize detection by a target network during testing, Kali does not enable
    any externally-listening network services. Some services, such as **Secure Shell**
    (**SSH**), are already installed. However, they must be enabled prior to use.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在测试期间最大程度地减少目标网络的检测，Kali不会启用任何外部监听网络服务。一些服务，如**安全外壳**（**SSH**），已经安装。但是，在使用之前必须启用它们。
- en: Kali comes preconfigured with default SSH keys. Before starting the SSH service,
    it's a good idea to disable the default keys and generate a unique keyset for
    use.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: Kali预先配置了默认的SSH密钥。在启动SSH服务之前，最好禁用默认密钥并生成用于使用的唯一密钥集。
- en: 'Move the default SSH keys to a backup folder, and then generate a new SSH keyset
    using the following command:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 将默认的SSH密钥移动到备份文件夹，然后使用以下命令生成新的SSH密钥集：
- en: '[PRE4]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The process of moving the original keys and generating the new keyset is shown
    in the following screenshot.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 将原始密钥移动并生成新密钥集的过程如下截图所示。
- en: '![Securing communications with Secure Shell](img/3121OS_01_07.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![使用安全外壳保护通信](img/3121OS_01_07.jpg)'
- en: To verify that the newly generated keys are unique, calculate their `md5sum`
    hash values, and compare with the original keys as shown in the following screenshot.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证新生成的密钥是否唯一，请计算它们的`md5sum`哈希值，并与原始密钥进行比较，如下截图所示。
- en: '![Securing communications with Secure Shell](img/3121OS_01_08.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![使用安全外壳保护通信](img/3121OS_01_08.jpg)'
- en: To start the SSH service using the menu, select **Applications** | **Kali Linux**
    | **System Services** | **SSHD** | **SSHD Start**.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用菜单启动SSH服务，请选择**应用程序** | **Kali Linux** | **系统服务** | **SSHD** | **SSHD启动**。
- en: 'To start SSH from the command line, use the command line shown in the following
    screenshot:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 要从命令行启动SSH，请使用以下截图中显示的命令行：
- en: '![Securing communications with Secure Shell](img/3121OS_01_09.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![使用安全外壳保护通信](img/3121OS_01_09.jpg)'
- en: 'To verify that SSH is running, perform a `netstat` query, as shown in the following
    screenshot:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证SSH是否正在运行，请执行`netstat`查询，如下截图所示：
- en: '![Securing communications with Secure Shell](img/3121OS_01_10.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![使用安全外壳保护通信](img/3121OS_01_10.jpg)'
- en: 'The SSH daemon is listening on port 22 in the previous example. To stop SSH,
    use the following command:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一个示例中，SSH守护程序正在端口22上监听。要停止SSH，请使用以下命令：
- en: '[PRE5]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Updating Kali Linux
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更新Kali Linux
- en: Kali must be patched regularly to ensure that the base operating system and
    applications are up-to-date and that security patches have been applied.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 必须定期修补Kali，以确保基本操作系统和应用程序是最新的，并且已应用安全补丁。
- en: The Debian package management system
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Debian软件包管理系统
- en: Debian's package management system relies on discrete bundled applications called
    **packages**. Packages can be installed or removed by the user to customize the
    environment, and support tasks such as penetration testing. They can also extend
    the functionality of Kali, supporting tasks, such as communications (Skype, instant
    messaging, and secure e-mails) or documentation (OpenOffice and Microsoft Office
    running under Wine).
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: Debian的软件包管理系统依赖于称为**软件包**的离散捆绑应用程序。用户可以安装或删除软件包以定制环境，并支持诸如渗透测试之类的任务。它们还可以扩展Kali的功能，支持通信（Skype、即时通讯和安全电子邮件）或文档（在Wine下运行的OpenOffice和Microsoft
    Office）等任务。
- en: Packages are stored in repositories and are downloaded to the system user to
    ensure the integrity of the package.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 软件包存储在存储库中，并下载到系统用户以确保软件包的完整性。
- en: Packages and repositories
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 软件包和存储库
- en: By default, Kali uses only the official Kali repositories. It is possible that
    an incomplete installation process may not add the repositories to the correct
    `sources.list` file, or that you may wish to extend the available repositories
    when new applications are added.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Kali仅使用官方Kali存储库。可能由于安装过程不完整而未将存储库添加到正确的`sources.list`文件中，或者您可能希望在添加新应用程序时扩展可用的存储库。
- en: Updating the `source.list` file can be done from the command line (`echo deb
    http://http.kali.org/kiali kali main contrib non-free >> /etc/apt/sources.list`),
    or by using a text editor.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过命令行（`echo deb http://http.kali.org/kiali kali main contrib non-free >> /etc/apt/sources.list`）或使用文本编辑器来更新`source.list`文件。
- en: 'The default package repositories that should be present in `/etc/apt/sources.list`
    are listed as follows; if not present, edit the sources.list file to include them:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 应该存在于`/etc/apt/sources.list`中的默认软件包存储库如下所示；如果不存在，请编辑sources.list文件以包括它们：
- en: '[PRE6]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Not every Kali tool is presently maintained in the official tool repositories.
    If you choose to update a tool manually, it is possible that you will overwrite
    existing packaged files and break dependencies. Therefore, some tools that have
    not been officially moved to Debian repositories, such as the `aircrack-ng`, `dnsrecon`,
    `sqlmap`, `beef-xss`, and Social Engineering Toolkit (se-toolkit), are maintained
    in the Bleeding Edge repository. This repository may also be added to `sources.list`
    using the following command line:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有Kali工具都目前在官方工具存储库中维护。如果选择手动更新工具，则可能会覆盖现有的打包文件并破坏依赖关系。因此，一些尚未正式移至Debian存储库的工具，如`aircrack-ng`、`dnsrecon`、`sqlmap`、`beef-xss`和社会工程工具包（se-toolkit），都在Bleeding
    Edge存储库中维护。可以使用以下命令将此存储库添加到`sources.list`中：
- en: '[PRE7]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Dpkg
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Dpkg
- en: Dpkg is Debian's package management system. This command-line application is
    used to install, remove, and query packages. In general, `dpkg` performs actions
    on individual packages.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: Dpkg是Debian的软件包管理系统。这个命令行应用程序用于安装、删除和查询软件包。一般来说，`dpkg`对单个软件包执行操作。
- en: Tip
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '`dpkg` is particularly useful in compiling a list of installed applications
    in Kali using the command `dpkg -l > list.txt`. If you want to know if a specific
    tool is installed, use `dpkg -l | grep <tool name>`.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '`dpkg`在Kali中编译已安装应用程序列表时特别有用，使用命令`dpkg -l > list.txt`。如果要知道特定工具是否已安装，请使用`dpkg
    -l | grep <tool name>`。'
- en: The following screenshot shows an excerpt of the returned data when dpkg -l
    is invoked, providing a list of all applications installed on the Kali distribution;
    this is particularly useful in identifying applications that may only be accessible
    directly from the command line.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 以下屏幕截图显示了调用dpkg -l时返回数据的摘录，提供了Kali发行版上安装的所有应用程序的列表；这在识别可能仅可以直接从命令行访问的应用程序方面特别有用。
- en: '![Dpkg](img/3121OS_01_11.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![Dpkg](img/3121OS_01_11.jpg)'
- en: Using Advanced Packaging Tools
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用高级打包工具
- en: '**Advanced Packaging Tools** (**APT**), extend the functionalities of `dkpg`
    by searching repositories and installing or upgrading packages along with all
    the required dependencies. The APT can also be used to upgrade a complete distribution.'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**高级打包工具**（**APT**）通过搜索存储库并安装或升级软件包以及所有所需的依赖项，扩展了`dkpg`的功能。 APT还可以用于升级完整的发行版。'
- en: 'The most common `apt` commands are as follows:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 最常见的`apt`命令如下：
- en: '`apt-get update`: This is used to resynchronize the local package index files
    with their source as defined in `/etc/apt/sources.list`. The `update` command
    should always be used first, before performing an `upgrade` or `dist-upgrade`.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`apt-get update`：用于将本地软件包索引文件与`/etc/apt/sources.list`中定义的源重新同步。在执行`upgrade`或`dist-upgrade`之前，应始终首先使用`update`命令。'
- en: '`apt-get upgrade`: This is used to install the newest versions of all packages
    installed on the system using `/etc/apt/sources.list`. Packages that are installed
    on Kali with new versions available are upgraded. The upgrade command will not
    change or delete packages that are not being upgraded, and it will not install
    packages that are not already present.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`apt-get upgrade`：用于安装系统上已安装的所有软件包的最新版本，使用`/etc/apt/sources.list`。在Kali上安装了新版本的软件包将被升级。升级命令不会更改或删除未升级的软件包，并且不会安装尚未存在的软件包。'
- en: '`apt-get dist-upgrade`: This upgrades all packages currently installed on the
    system and their dependencies. It also removes obsolete packages from the system.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`apt-get dist-upgrade`：这将升级系统上当前安装的所有软件包及其依赖项。它还会从系统中删除过时的软件包。'
- en: The `apt-get` command can also be used to show a full description of a package
    and identify its dependencies (`apt-cache show <package name>`) or remove a package
    (`apt-get remove <package name>`).
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '`apt-get`命令还可用于显示软件包的完整描述并识别其依赖项（`apt-cache show <package name>`）或删除软件包（`apt-get
    remove <package name>`）。'
- en: Note
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Run the `apt-get update` command and the `upgrade` command at start-up to ensure
    your session is using the most up-to-date tools. The easiest way to do this is
    to create an `update.sh` script that includes the following command line:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动时运行`apt-get update`命令和`upgrade`命令，以确保会话使用最新的工具。最简单的方法是创建一个包含以下命令行的`update.sh`脚本：
- en: '[PRE8]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Some applications are not upgraded by the `apt-get` command. For example, the
    local copy of the `exploit-db` archive must be manually upgraded. Create a script
    named `update.sh` and add the following commands to it, to automate the update
    process:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 某些应用程序不会被`apt-get`命令升级。例如，`exploit-db`存档的本地副本必须手动升级。创建一个名为`update.sh`的脚本，并将以下命令添加到其中，以自动化更新过程：
- en: '[PRE9]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Configuring and customizing Kali Linux
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置和自定义Kali Linux
- en: Kali is a framework that is used to complete a penetration test. However, the
    tester should never feel tied to the tools that have been installed by default,
    or by the look and feel of the Kali desktop. By customizing BackTrack, a tester
    can increase the security of client data that is being collected, and make it
    easier to do a penetration test.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: Kali是一个用于完成渗透测试的框架。但是，测试人员不应该感到受限于默认安装的工具，或者受限于Kali桌面的外观和感觉。通过自定义BackTrack，测试人员可以增加正在收集的客户数据的安全性，并使渗透测试变得更加容易。
- en: 'Common customizations made to Kali include:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 对Kali进行的常见自定义包括：
- en: Resetting the root password
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重置root密码
- en: Adding a non-root user
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加非root用户
- en: Speeding up Kali operations
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 加快Kali操作
- en: Sharing folders with MS Windows
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与MS Windows共享文件夹
- en: Creating encrypted folders
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建加密文件夹
- en: Resetting the root password
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重置root密码
- en: 'To change a user password, use the following command:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要更改用户密码，请使用以下命令：
- en: '[PRE10]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'You will then be prompted to enter a new password, as shown in the following
    screenshot:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将提示输入新密码，如下图所示：
- en: '![Resetting the root password](img/3121OS_01_12.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![重置root密码](img/3121OS_01_12.jpg)'
- en: Adding a non-root user
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加非root用户
- en: Many of the applications provided in Kali must run with root-level privileges
    in order to function. Root-level privileges do possess a certain amount of risk,
    for example, miskeying a command or using the wrong command can cause applications
    to fail or even damage the system being tested. In some cases, it is preferable
    to test with user-level privileges. In fact, some applications force the use of
    lower-privilege accounts.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: Kali中提供的许多应用程序必须以root级别权限运行才能正常工作。 root级别权限确实存在一定的风险，例如，输入错误的命令或使用错误的命令可能会导致应用程序失败，甚至损坏正在测试的系统。在某些情况下，最好使用用户级别权限进行测试。实际上，有些应用程序强制使用较低权限的帐户。
- en: 'To create a non-root user, you can simply use the command `adduser` from the
    terminal and follow the instructions that appear, as shown in the following screenshot:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建非root用户，只需从终端使用`adduser`命令并按照出现的说明进行操作，如下图所示：
- en: '![Adding a non-root user](img/3121OS_01_13.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![添加非root用户](img/3121OS_01_13.jpg)'
- en: Speeding up Kali operations
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 加快Kali操作
- en: 'Several tools can be used to optimize and speed up Kali operations:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种工具可用于优化和加快Kali操作：
- en: 'When using a virtual machine, install the VM''s software drive package: Guest
    Additions (VirtualBox) or VMware Tools (VMware).'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在使用虚拟机时，安装VM的软件驱动程序包：Guest Additions（VirtualBox）或VMware Tools（VMware）。
- en: When creating a virtual machine, select a fixed disk size instead of one that
    is dynamically allocated. It is faster to add files to a fixed disk, and there
    is less file fragmentation.
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在创建虚拟机时，选择固定的磁盘大小，而不是动态分配的磁盘大小。向固定磁盘添加文件更快，文件碎片更少。
- en: The preload application (`apt-get install preload`) identifies a user's most
    commonly used programs and preloads binaries and dependencies into memory to provide
    faster access. It works automatically after the first restart following installation.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: preload应用程序（`apt-get install preload`）识别用户最常用的程序，并预加载二进制文件和依赖项到内存中，以提供更快的访问。安装后第一次重启后会自动运行。
- en: BleachBit (`apt-get install bleachbit`) frees disk space and improves privacy
    by freeing the cache, deleting cookies, clearing Internet history, shredding temporary
    files, deleting logs, and discarding other unnecessary files. Advanced features
    include shredding files to prevent recovery and wiping free disk space to hide
    traces of files that have not been fully deleted.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BleachBit（`apt-get install bleachbit`）通过释放缓存，删除cookie，清除互联网历史记录，销毁临时文件，删除日志和丢弃其他不必要的文件来释放磁盘空间并提高隐私。高级功能包括销毁文件以防止恢复和擦除空闲磁盘空间以隐藏未完全删除的文件的痕迹。
- en: By default, Kali does not show all applications that are present in the start-up
    menu. Each application that is installed during the boot-up process slows the
    system data, and may impact memory use and system performance. Install **Boot
    Up Manager** (**BUM**) to disable unnecessary services and applications that are
    enabled during the boot up (`apt-get install bum`), as shown in the following
    screenshot:![Speeding up Kali operations](img/3121OS_01_14.jpg)
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认情况下，Kali不显示启动菜单中存在的所有应用程序。在启动过程中安装的每个应用程序都会减慢系统数据，并可能影响内存使用和系统性能。安装**启动管理器**（**BUM**）以禁用在启动期间启用的不必要的服务和应用程序（`apt-get
    install bum`），如下图所示：![加速Kali操作](img/3121OS_01_14.jpg）
- en: Add `gnome-do` (`apt-get install gnome-do`) to launch applications directly
    from the keyboard. To configure `gnome-do`, select it from the **Applications**
    | **Accessories** menu. Once launched, select the **Preferences** menu, activate
    the **Quiet Launch** function, and select a launch command (for example, *Ctrl*
    + *Shift*). Clear any existing commands, and then enter the command line to be
    executed when the launch keys are selected.
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加`gnome-do`（`apt-get install gnome-do`）以直接从键盘启动应用程序。要配置`gnome-do`，从**应用程序**
    | **附件**菜单中选择它。启动后，选择**首选项**菜单，激活**静默启动**功能，并选择启动命令（例如，*Ctrl* + *Shift*）。清除任何现有命令，然后输入在选择启动键时要执行的命令行。
- en: Rather than launching directly from the keyboard, it is possible to write specific
    scripts that launch complex operations.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 可以编写特定脚本来启动复杂的操作，而不是直接从键盘启动。
- en: Sharing folders with Microsoft Windows
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 与Microsoft Windows共享文件夹
- en: The Kali toolset has the flexibility to share results with applications residing
    on different operating systems, especially Microsoft Windows. The most effective
    way to share data is to create a folder that is accessible from the host operating
    system as well as the Kali Linux VM guest.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: Kali工具集具有与驻留在不同操作系统上的应用程序共享结果的灵活性，特别是Microsoft Windows。共享数据的最有效方式是创建一个可以从主机操作系统和Kali
    Linux VM客户端访问的文件夹。
- en: When data is placed in a shared folder from either the host or the VM, it is
    immediately available via the shared folder to all systems that access that shared
    folder.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 当数据从主机或虚拟机放入共享文件夹时，它将立即通过共享文件夹对所有访问该共享文件夹的系统可用。
- en: 'To create a shared folder, perform the following steps:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建共享文件夹，请执行以下步骤：
- en: Create a folder on the host operating system. In this example, it will be called
    `Kali_Share`.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机操作系统上创建一个文件夹。在本例中，它将被称为`Kali_Share`。
- en: Right-click on the folder and select the **Sharing** tab. From this menu, select
    **Share**.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键单击文件夹，选择**共享**选项卡。从此菜单中，选择**共享**。
- en: Ensure that the file is shared with **Everyone**, and that **Permission Level**
    for this share is set to **Read / Write**.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保文件与**所有人**共享，并且此共享的**权限级别**设置为**读/写**。
- en: If you have not already done so, install the appropriate tools onto BackTrack.
    For example, when using VMware, install the VMware tools (refer to [Appendix](apa.html
    "Appendix A. Installing Kali Linux"), *Installing Kali Linux*).
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果尚未这样做，请在BackTrack上安装适当的工具。例如，使用VMware时，请安装VMware工具（参见[附录](apa.html "附录 A.
    安装Kali Linux")，*安装Kali Linux*）。
- en: When the installation is complete, go to the VMware menu and select **Virtual
    Machine Setting**. Find the menu that enables **Shared Folders** and select **Always
    Enabled**. Create a path to the shared folder that is present on the host operating
    system, as shown in the following screenshot:![Sharing folders with Microsoft
    Windows](img/3121OS_01_15.jpg)
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，转到VMware菜单，选择**虚拟机设置**。找到启用**共享文件夹**的菜单，并选择**始终启用**。创建一个路径到主机操作系统上存在的共享文件夹，如下图所示：![与Microsoft
    Windows共享文件夹](img/3121OS_01_15.jpg)
- en: Note
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Although VirtualBox uses different menu titles, the process is the same.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟机使用不同的菜单标题，但流程是一样的。
- en: Open the file browser on the Kali desktop. The shared folder will be visible
    in the `mnt` folder (it might be placed in a sub-folder, `hgfs`).
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Kali桌面上打开文件浏览器。共享文件夹将显示在`mnt`文件夹中（可能放在子文件夹`hgfs`中）。
- en: Drag the folder onto the Kali desktop to create a link to the real folder.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将文件夹拖到Kali桌面上，以创建到真实文件夹的链接。
- en: Everything placed in the folder will be accessible in the folder of the same
    name on the host operating system, and vice versa.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 放入文件夹的所有内容将在主机操作系统上同名的文件夹中可访问，反之亦然。
- en: The shared folder, which will contain sensitive data from a penetration test,
    must be encrypted to protect the client's network and reduce the tester's liability
    should the data ever be lost or stolen.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 共享文件夹中将包含来自渗透测试的敏感数据，必须加密以保护客户的网络，并减少测试人员的责任，如果数据丢失或被盗。
- en: Creating an encrypted folder with TrueCrypt
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用TrueCrypt创建加密文件夹
- en: During a penetration test, you will have access to sensitive client information,
    including exploitable vulnerabilities and copies of successfully breached data.
    It is the tester's legal and moral responsibility to ensure that this information
    in his care is secured at all times. The best means of meeting this responsibility
    is to ensure that all client information is encrypted during storage and transmission.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试期间，您将可以访问敏感的客户信息，包括可利用的漏洞和成功突破的数据副本。测试人员的法律和道德责任是确保他所掌握的这些信息始终得到保护。满足这一责任的最佳方式是确保所有客户信息在存储和传输过程中都进行加密。
- en: 'To install TrueCrypt on BackTrack, complete the following steps:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 要在BackTrack上安装TrueCrypt，请完成以下步骤：
- en: In the **Applications** menu, select **Accessories** | **TrueCrypt**.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**应用程序**菜单中，选择**附件** | **TrueCrypt**。
- en: To create an encrypted folder, open the application. You will be presented with
    the main menu, as shown in the following screenshot:![Creating an encrypted folder
    with TrueCrypt](img/3121OS_01_16.jpg)
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建加密文件夹，请打开应用程序。您将看到主菜单，如下截图所示：![使用TrueCrypt创建加密文件夹](img/3121OS_01_16.jpg)
- en: On the main menu, select the **Create** **Volume** button. This will launch
    the **TrueCrypt Volume** **Creation Wizard**, as shown in the following screenshot:![Creating
    an encrypted folder with TrueCrypt](img/3121OS_01_17.jpg)
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主菜单中，选择**创建** **卷**按钮。这将启动**TrueCrypt卷** **创建向导**，如下截图所示：![使用TrueCrypt创建加密文件夹](img/3121OS_01_17.jpg)
- en: Select **Create an encrypted file container**, and then click on **Next**.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**创建加密文件容器**，然后点击**下一步**。
- en: The next screen will prompt for **Volume Type**, select **Standard TrueCrypt
    volume**, and click on **Next**.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕将提示**卷类型**，选择**标准TrueCrypt卷**，然后点击**下一步**。
- en: On the **Volume** **Location** screen, select **Select File**. You will be asked
    to **Specify a New TrueCrypt Volume** by providing a **Name**, and indicating
    that it will save in the folder specified, as shown in the following screenshot:![Creating
    an encrypted folder with TrueCrypt](img/3121OS_01_18.jpg)
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**卷** **位置**屏幕上，选择**选择文件**。您将被要求通过提供**名称**并指示它将保存在指定文件夹中来**指定新的TrueCrypt卷**，如下截图所示：![使用TrueCrypt创建加密文件夹](img/3121OS_01_18.jpg)
- en: Chose a filename. Do not choose a filename related to the client being tested,
    or which indicates that sensitive material is present in the directory. Use a
    number or code word to represent the client, and a generic title for results.
    Save the file on the desktop, then click on **Next**.
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个文件名。不要选择与正在测试的客户相关的文件名，或者表明目录中存在敏感材料的文件名。使用一个数字或代码词来代表客户，以及一个通用的标题来表示结果。将文件保存在桌面上，然后点击**下一步**。
- en: The next screen will provide you with **Encryption Options**. Select **Encryption
    Algorithm** from the drop-down menu. There are several choices, but for regular
    purposes, **AES** (the default 256-bit key) will suffice. You will also select
    a **Hash Algorithm** from the drop-down menu (the default, **RIPEMD-160**, should
    be sufficient). After your choices are complete, click on the **Next** button,
    as shown in the following screenshot:![Creating an encrypted folder with TrueCrypt](img/3121OS_01_19.jpg)
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕将为您提供**加密选项**。从下拉菜单中选择**加密算法**。有几种选择，但对于常规目的，**AES**（默认的256位密钥）就足够了。您还将从下拉菜单中选择**哈希算法**（默认情况下，**RIPEMD-160**应该足够）。选择完成后，点击**下一步**按钮，如下截图所示：![使用TrueCrypt创建加密文件夹](img/3121OS_01_19.jpg)
- en: You will now be prompted for **Volume Size**. You should have a minimum size
    of approximately 500 MB, but this may vary depending on the testing regime. Click
    on **Next**.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在将提示您输入**卷大小**。最小大小应该约为500 MB，但这可能会根据测试方案而有所不同。点击**下一步**。
- en: The **Volume Password** should be selected according to the rules provided for
    strong passwords. Select and confirm the password, then click on **Next**, as
    shown in the following screenshot:![Creating an encrypted folder with TrueCrypt](img/3121OS_01_20.jpg)
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应根据强密码的规则选择**卷密码**。选择并确认密码，然后点击**下一步**，如下截图所示：![使用TrueCrypt创建加密文件夹](img/3121OS_01_20.jpg)
- en: The next screen allows you to select **Format Options**. For **Filesystem Options**
    select **FAT** from the drop-down menu. Click on **Next**.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕允许您选择**格式选项**。对于**文件系统选项**，从下拉菜单中选择**FAT**。点击**下一步**。
- en: The next screen, **Volume** **Format**, creates a random key for the encrypted
    filesystem. The key is based on mouse movements, and you will be prompted to move
    the mouse over the window for a long period to ensure the randomness (cryptographic
    strength) of the encryption keys. When done, click on **Format** to create the
    TrueCrypt volume.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下一个屏幕**卷** **格式**，为加密文件系统创建一个随机密钥。密钥基于鼠标移动，并且您将被提示在窗口上移动鼠标一段时间以确保加密密钥的随机性（密码学强度）。完成后，点击**格式化**以创建TrueCrypt卷。
- en: The final volume has been created. It will appear as an icon on the desktop.
    The volume is encrypted, and it can be copied to an external storage device or
    moved to the host system and remain encrypted.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最终的卷已经创建。它将显示为桌面上的图标。该卷已加密，可以复制到外部存储设备或移动到主机系统并保持加密状态。
- en: 'To use the encrypted volume, you must first choose a **Slot** to manage the
    encrypted folder in the main **TrueCrypt** menu. When this is done, use the **Select
    File** button to select the name of the encrypted file. In this case, we''ll use
    a previously made file called `pentest` located on the desktop, as shown in the
    following screenshot:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用加密卷，您必须首先选择主**TrueCrypt**菜单中管理加密文件夹的**插槽**。完成后，使用**选择文件**按钮选择加密文件的名称。在这种情况下，我们将使用桌面上以前创建的名为`pentest`的文件，如下截图所示：
- en: '![Creating an encrypted folder with TrueCrypt](img/3121OS_01_21.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![使用TrueCrypt创建加密文件夹](img/3121OS_01_21.jpg)'
- en: 'Click on the **Mount** button. At this point, you will be prompted for the
    password, as shown in the following screenshot:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**挂载**按钮。此时，将提示您输入密码，如下截图所示：
- en: '![Creating an encrypted folder with TrueCrypt](img/3121OS_01_22.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![使用TrueCrypt创建加密文件夹](img/3121OS_01_22.jpg)'
- en: 'When the correct password is entered, you will see the **Slot 1** details change
    to reflect the encrypted folder''s properties, and a new icon called `truerypt1`
    will be displayed on the desktop, will be displayed on the desktop, as shown in
    the following screenshot:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 输入正确的密码后，您将看到**Slot 1**的详细信息会发生变化，以反映加密文件夹的属性，并且在桌面上会显示一个名为`truecrypt1`的新图标，如下面的屏幕截图所示：
- en: '![Creating an encrypted folder with TrueCrypt](img/3121OS_01_23.jpg)'
  id: totrans-164
  prefs: []
  type: TYPE_IMG
  zh: '![使用TrueCrypt创建加密文件夹](img/3121OS_01_23.jpg)'
- en: If you double-click on the **truecrypt1** icon, you will be taken to a **File
    Browser** view.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您双击**truecrypt1**图标，您将进入**文件浏览器**视图。
- en: At this point, it will act as a regular directory, and you can use the folder
    to store all of the test-related information. When you work with the contents
    of the folder, and wish to ensure that all data is encrypted, select **Dismount**
    on the main menu. The folder will revert to an encrypted state.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，它将作为一个常规目录，您可以使用该文件夹来存储所有与测试相关的信息。当您使用文件夹的内容，并希望确保所有数据都是加密的时候，在主菜单上选择**卸载**。文件夹将恢复到加密状态。
- en: Managing third-party applications
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理第三方应用程序
- en: Although Kali comes preloaded with several hundred applications, it is likely
    that you will need to install additional applications to effectively test specific
    environments (such as industrial systems), add new cutting edge tools, or ensure
    that your *favorite* tools are installed. Kali makes it easy to locate, install,
    and manage these tools.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Kali预装了几百个应用程序，但您可能需要安装其他应用程序来有效地测试特定环境（如工业系统），添加新的尖端工具，或确保您安装了*最喜欢*的工具。Kali使得定位、安装和管理这些工具变得容易。
- en: Installing third-party applications
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装第三方应用程序
- en: 'There are multiple ways to install third party applications: using the `apt-get`
    command, accessing a GitHub repository, and directly installing the application.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 安装第三方应用程序有多种方法：使用`apt-get`命令，访问GitHub存储库，直接安装应用程序。
- en: All tools should be installed from the Kali Linux repository using the `apt-get
    install` command. The `install` command can be executed from the command line
    in a terminal window, or the user may select a graphical package management tool.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 所有工具都应该使用`apt-get install`命令从Kali Linux存储库安装。`install`命令可以在终端窗口的命令行中执行，或者用户可以选择一个图形化的软件包管理工具。
- en: 'Recommended third-party applications include:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 推荐的第三方应用程序包括：
- en: '`apt-file`: This is a command-line tool to search within packages of the APT
    packaging system. It allows you to list contents of a package without installing
    or fetching it.'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`apt-file`：这是一个命令行工具，用于在APT包装系统的软件包中搜索。它允许您列出软件包的内容，而无需安装或获取它。'
- en: '`gnome-tweak-tool`: This allows users to change themes and rapidly configure
    desktop options.'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`gnome-tweak-tool`：这允许用户更改主题并快速配置桌面选项。'
- en: '`instanbul`: This is a desktop screen recorder that allows you to make a movie
    of desktop activities.'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`instanbul`：这是一个桌面屏幕录制工具，允许您制作桌面活动的电影。'
- en: '`openoffice`: This is an open source office productivity suite that assists
    in documentation.'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`openoffice`：这是一个开源的办公生产力套件，用于文档编制。'
- en: '`scrub`: This is a secure deletion (anti-forensic) tool that securely deletes
    data to comply with stringent government standards using various overwrite patterns.'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`scrub`：这是一个安全删除（反取证）工具，可以使用各种覆盖模式安全删除数据，以符合严格的政府标准。'
- en: '`shutter`: This is a screenshot tool that captures images of a desktop, open
    window, or a selection.'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`shutter`：这是一个截图工具，可以捕捉桌面、打开窗口或选择的图像。'
- en: '`team viewer`: This supports remote access and remote administration. It also
    allows testers to place a pre-configured computer (a dropbox) on the target network
    and control testing from a remote location.'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`team viewer`：这支持远程访问和远程管理。它还允许测试人员将预先配置的计算机（一个dropbox）放在目标网络上，并从远程位置控制测试。'
- en: '`terminator`: This is a replacement for the Linux terminal window that allows
    horizontal scrolling—no more wrapped text!'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`terminator`：这是Linux终端窗口的替代品，允许水平滚动 - 不再有换行文本！'
- en: Tools that are not present in a Debian repository and are accessible using `apt-get
    install` can still be installed on Kali. However, the user must accept that manual
    installs are not coordinated with repositories, and they may break dependencies
    causing applications to fail.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 不在Debian存储库中的工具，可以通过`apt-get install`访问，仍然可以安装在Kali上。但是，用户必须接受手动安装与存储库不协调，并且可能会破坏依赖关系，导致应用程序失败。
- en: Some tools use the GitHub online repository for software development projects.
    Many developers favor this open repository due to the flexibility of the Git revision
    system as well as the social-media aspects of the software sites. One tool that
    we will be using is `recon-ng`, a web reconnaissance framework.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 一些工具使用GitHub在线存储库进行软件开发项目。许多开发人员青睐这个开放存储库，因为Git修订系统的灵活性以及软件站点的社交媒体方面。我们将使用的一个工具是`recon-ng`，一个网络侦察框架。
- en: 'To clone the current version of `recon-ng` from the GitHub repository, use
    the following command line:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 要从GitHub存储库克隆当前版本的`recon-ng`，请使用以下命令行：
- en: '[PRE11]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Finally, some applications must be manually installed. For example, to restore
    the asynchronous port scanner Unicornscan, can back to Kali, you must:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，一些应用程序必须手动安装。例如，要恢复异步端口扫描程序Unicornscan，可以返回到Kali，您必须：
- en: 'Ensure the dependencies are first present: `apt-get install flex`'
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保首先存在依赖项：`apt-get install flex`
- en: Download the latest version of Unicornscan ([www.unicornscan.org](http://www.unicornscan.org)
    – the current version is unicornscan-0.4.7-2)
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下载Unicornscan的最新版本（[www.unicornscan.org](http://www.unicornscan.org) - 当前版本是unicornscan-0.4.7-2）
- en: 'Extract the contents of the file to a new directory: `tar jxf unicornscan-0.4.7-2.tar.bz2`'
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将文件内容提取到一个新目录：`tar jxf unicornscan-0.4.7-2.tar.bz2`
- en: 'Change to the directory containing Unicornscan: `cd unicornscan-0.4.7/`'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 切换到包含Unicornscan的目录：`cd unicornscan-0.4.7/`
- en: 'Compile the source code: `./configure CFLAGS=-D_GNU_SOURCE && make && make
    install`'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编译源代码：`./configure CFLAGS=-D_GNU_SOURCE && make && make install`
- en: The exact dependencies and make install process will vary for each application,
    so you will need to refer to the developer's `README` file to ensure correct installation
    and configuration of these applications.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 确切的依赖关系和安装过程将因应用程序而异，因此您需要参考开发者的`README`文件，以确保正确安装和配置这些应用程序。
- en: Running third-party applications with non-root privileges
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 以非root权限运行第三方应用程序
- en: Kali Linux is intended to support penetration testing. Most of the tools require
    root-level access, which is why access to the toolset and data is protected with
    passwords and encryption.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux旨在支持渗透测试。大多数工具需要root级别访问权限，这就是为什么工具集和数据的访问受到密码和加密保护的原因。
- en: However, some third-party tools are not meant to run with root-level privileges.
    Tools such as web browsers may be compromised, and giving an attacker access to
    root privileges can have a significant security impact.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，一些第三方工具并不意味着以root级别权限运行。诸如web浏览器之类的工具可能会受到损害，并且给攻击者访问root权限可能会产生重大的安全影响。
- en: If root access is not required, tools should follow the principle of least privilege
    and run as non-root users.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不需要root访问权限，工具应该遵循最小特权原则，并作为非root用户运行。
- en: To run an application that normally runs as a non-root user, log on to Kali
    using a root account. Kali should be configured with a non-root account. In this
    example, we will use the `noroot` account previously created with the `adduser`
    command.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行通常作为非root用户运行的应用程序，请使用root帐户登录Kali。Kali应该配置为使用非root帐户。在本例中，我们将使用之前使用`adduser`命令创建的`noroot`帐户。
- en: 'Perform the following steps to run the web browser Iceweasel as non-root:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 运行web浏览器Iceweasel作为非root用户执行以下步骤：
- en: Create a non-root user account. In this example, we will use `noroot`.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个非root用户帐户。在本例中，我们将使用`noroot`。
- en: We will use `sux`, which is a wrapper application that transfers credentials
    from a privileged user to a target non-root user. Download and install `sux` using
    the `apt-get install` command.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用`sux`，这是一个包装应用程序，它将凭据从特权用户传输到目标非root用户。使用`apt-get install`命令下载和安装`sux`。
- en: Start the web browser, and then minimize it.
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动web浏览器，然后将其最小化。
- en: 'Enter the command line: `ps aux |grep iceweasel`. As you can see, Iceweasel
    is running with root privileges.'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入命令行：`ps aux |grep iceweasel`。如您所见，Iceweasel正在以root权限运行。
- en: Close Iceweasel, and relaunch using the command `sux - noroot iceweasel`, as
    shown in the following screenshot:![Running third-party applications with non-root
    privileges](img/3121OS_01_24.jpg)
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭Iceweasel，并使用命令`sux - noroot iceweasel`重新启动，如下面的屏幕截图所示：![以非root权限运行第三方应用程序](img/3121OS_01_24.jpg)
- en: If you examine the Iceweasel title bar, shown in the following screenshot, you
    will see that it was invoked as the user `noroot`, an account that did not have
    administrator privileges.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您检查Iceweasel标题栏，如下面的屏幕截图所示，您将看到它被调用为用户`noroot`，这是一个没有管理员特权的帐户。
- en: '![Running third-party applications with non-root privileges](img/3121OS_01_25.jpg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![以非root权限运行第三方应用程序](img/3121OS_01_25.jpg)'
- en: 'You can also confirm that Iceweasel is running under the `noroot` account by
    examining the open processes, as shown in the following screenshot:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以通过检查打开的进程来确认Iceweasel是否在`noroot`帐户下运行，如下面的屏幕截图所示：
- en: '![Running third-party applications with non-root privileges](img/3121OS_01_26.jpg)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![以非root权限运行第三方应用程序](img/3121OS_01_26.jpg)'
- en: Effective management of penetration tests
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 渗透测试的有效管理
- en: One of the most difficult aspects of penetration testing is remembering to test
    all of the relevant parts of the network or system target, or trying to remember
    if the target was actually tested, after the testing has been completed.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试中最困难的部分之一是记住测试网络或系统目标的所有相关部分，或者在测试完成后尝试记住目标是否实际上已经被测试过。
- en: BT 5r3 emphasized the use of management tools such as Draedis and MagicTree.
    These tools facilitate group testing by providing a central repository for test
    data. In addition, they usually provide some framework so that testers know where
    they are within a testing methodology, and what tests remain to be completed.
    Tools of this nature are excellent in coordinating defined group activities during
    a vulnerability assessment or penetration test.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: BT 5r3强调使用管理工具，如Draedis和MagicTree。这些工具通过提供测试数据的中央存储库来促进组测试。此外，它们通常提供一些框架，以便测试人员知道他们在测试方法论中的位置，以及还有哪些测试尚未完成。这类工具在协调漏洞评估或渗透测试期间定义的组活动方面非常出色。
- en: These tools remain in the **Applications** | **Kali Linux** | **Reporting Tools**
    | **Evidence Management** menu.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 这些工具保留在**应用程序** | **Kali Linux** | **报告工具** | **证据管理**菜单中。
- en: But what about complex penetration tests where the methodology may be more fluid
    as it adapts to the network target?
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 但是对于复杂的渗透测试，方法可能更加灵活，因为它适应网络目标呢？
- en: Some testers use keyloggers or Wireshark during testing to record keystrokes
    and packet traffic generated during the test. This data can be especially useful
    if the testing is causing a network or application outage, because replaying and
    analyzing the packets sent can identify which packet tools impacted the network.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 一些测试人员在测试期间使用键盘记录器或Wireshark来记录测试期间生成的按键和数据包流量。如果测试导致网络或应用程序中断，这些数据可能特别有用，因为重放和分析发送的数据包可以确定哪些数据包工具影响了网络。
- en: Kali Linux includes several tools that are more suited to making rapid notes
    and serving as a repository of rapidly added cut-and-paste data, including KeepNote
    and the Zim desktop wiki.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux包括几个工具，更适合快速记录笔记并作为快速添加剪切和粘贴数据的存储库，包括KeepNote和Zim桌面wiki。
- en: Testers not only need to perform tests and collect data, they also need to be
    able to provide their findings to the client. This can be difficult, as some results
    are transient—a test demonstrates a finding at one point in time, and then something
    is changed on the target system, and future testing fails to demonstrate the exploitable
    vulnerability, even though it's possible for it to re-emerge.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 测试人员不仅需要执行测试和收集数据，还需要能够向客户提供他们的发现。这可能很困难，因为一些结果是瞬时的——测试在某个时间点显示了一个发现，然后目标系统上的某些内容发生了变化，未来的测试未能显示可利用的漏洞，尽管它可能会重新出现。
- en: The other challenge with positive results is that they need to be demonstrated
    to a client in a way that's understandable.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 积极结果的另一个挑战是需要以客户能理解的方式展示给客户。
- en: The golden rule is to always grab a screenshot of any positive, or potential,
    finding. Use a tool such as Shutter to capture images from the desktop.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 黄金法则是始终抓取任何积极或潜在发现的屏幕截图。使用Shutter等工具从桌面捕获图像。
- en: By default, Kali is configured with **CutyCapt**, which is a cross-platform
    command-line utility that captures a web page and creates a variety of image types,
    including PDF, PS, PNG, JPEG, TIFF, GIF, and BMP.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Kali配置了**CutyCapt**，这是一个跨平台命令行实用程序，可以捕获网页并创建各种图像类型，包括PDF、PS、PNG、JPEG、TIFF、GIF和BMP。
- en: 'For example, to create an image of a specific size from the Google search page,
    enter the following from a command-line prompt:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要从Google搜索页面创建特定大小的图像，请在命令行提示符中输入以下内容：
- en: '[PRE12]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'On execution, an image of the size specified in the previous command is displayed,
    as shown in the following screenshot:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行时，将显示在上一个命令中指定大小的图像，如下面的屏幕截图所示：
- en: '![Effective management of penetration tests](img/3121OS_01_27.jpg)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![有效的渗透测试管理](img/3121OS_01_27.jpg)'
- en: CutyCapt is especially useful when demonstrating the presence of web-based vulnerabilities
    such as cross-site scripting.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: CutyCapt在演示基于Web的漏洞（如跨站脚本）存在时特别有用。
- en: Static images can be very useful, however, a video of an exploit that compromises
    a target network and shows the actions of an attacker as they compromise sensitive
    data is a very compelling tool. The instanbul screen recorder creates a video
    of an "exploit in progress," which allows the exploit to be replayed for training
    purposes, or to demonstrate the vulnerability to the client.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 静态图像可能非常有用，但是一个利用漏洞的视频，显示攻击者在攻击目标网络并显示他们获取敏感数据的行为，是一个非常有说服力的工具。instanbul屏幕录像机创建了一个“正在进行的利用”视频，允许对利用进行重放以进行培训，或向客户展示漏洞。
- en: Summary
  id: totrans-224
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we examined Kali, a collection of tools widely used by legitimate
    penetration testers and hackers to assess the security of data systems and networks.
    We emphasized Kali as a virtual machine, allowing both the host operating system
    and the VM guest to support testing.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们研究了Kali，这是一个被合法的渗透测试人员和黑客广泛使用来评估数据系统和网络安全性的工具集。我们强调Kali是一个虚拟机，允许主机操作系统和VM客户端都支持测试。
- en: Kali is a repository of tools, and one of the challenges in using it is ensuring
    that the tools are up-to-date. We reviewed the Debian packet management system,
    and how updates could be initiated from both the command line and from GUI applications.
    Most importantly, we learned how to customize Kali to increase the security of
    our tools and the data that they collect. We are working to achieve the goal of
    making tools support our process, instead of the other way around!
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: Kali是一个工具库，使用它的一个挑战是确保工具是最新的。我们审查了Debian数据包管理系统，以及如何从命令行和GUI应用程序启动更新。最重要的是，我们学会了如何定制Kali以增加我们工具和它们收集的数据的安全性。我们正在努力实现使工具支持我们的流程的目标，而不是相反！
- en: In the next chapter, we will learn how to effectively use **Open Source Intelligence**
    (**OSINT**) to identify the vulnerable attack surfaces of our target and create
    customized username:password lists to facilitate social engineering attacks and
    other exploits.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何有效地使用**开源情报**（**OSINT**）来识别我们目标的易受攻击的表面，并创建定制的用户名:密码列表，以便进行社会工程攻击和其他利用。
- en: Chapter 2. Identifying the Target – Passive Reconnaissance
  id: totrans-228
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第2章。识别目标-被动侦察
- en: Reconnaissance is the first step of the kill chain when conducting a penetration
    test or an attack against a network or server target. An attacker will typically
    dedicate up to seventy-five percent of the overall work effort for a penetration
    test to reconnaissance, as it is this phase that allows the target to be defined,
    mapped, and explored for the vulnerabilities that will eventually lead to exploitation.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察是进行渗透测试或对网络或服务器目标进行攻击时的杀伤链的第一步。攻击者通常会将渗透测试的整体工作量的高达75%用于侦察，因为正是这个阶段允许定义、映射和探索漏洞，最终导致利用。
- en: 'There are two types of reconnaissance: **passive reconnaissance**, and **active
    reconnaissance**.'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种类型的侦察：**被动侦察**和**主动侦察**。
- en: Generally, passive reconnaissance is concerned with analyzing information that
    is openly available, usually from the target itself or public sources online.
    On accessing this information, the tester or attacker does not interact with the
    target in an unusual manner—requests and activities will not be logged, or will
    not be traced directly to the tester. Therefore, passive reconnaissance is conducted
    first to minimize the direct contact that may signal an impending attack or to
    identify the attacker.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，被动侦察涉及分析公开可用的信息，通常来自目标本身或在线公共来源。在访问这些信息时，测试人员或攻击者不会以异常的方式与目标进行交互——请求和活动不会被记录，或者不会直接追踪到测试人员。因此，首先进行被动侦察以最小化可能会发出即将发动攻击的信号或识别攻击者的直接接触。
- en: 'In this chapter, you will learn the principles and practices of passive reconnaissance,
    which include the following:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习被动侦察的原则和实践，包括以下内容：
- en: Basic principles of reconnaissance
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 侦察的基本原则
- en: '**Open-source intelligence** (**OSINT**)'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开源情报**（**OSINT**）'
- en: DNS reconnaissance and route mapping, including issues with IPv4 and IPv6
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS侦察和路由映射，包括IPv4和IPv6的问题
- en: Obtaining user information
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取用户信息
- en: Profiling users for password lists
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为密码列表创建用户档案
- en: Active reconnaissance, which involves direct interaction with the target, will
    be covered in [Chapter 3](ch03.html "Chapter 3. Active Reconnaissance and Vulnerability
    Scanning"), *Active Reconnaissance and Vulnerability Scanning*.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 直接与目标进行互动的主动侦察将在[第3章](ch03.html "第3章。主动侦察和漏洞扫描")中进行介绍，*主动侦察和漏洞扫描*。
- en: Basic principles of reconnaissance
  id: totrans-239
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 侦察的基本原则
- en: Reconnaissance, or recon, is the first step of the kill chain when conducting
    a penetration test or attack against a data target. This is conducted in before
    the actual test or attack of a target network. The findings will give a direction
    to where additional reconnaissance may be required, or the vulnerabilities to
    attack during the exploitation phase.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察，或者recon，在对数据目标进行渗透测试或攻击时是杀伤链的第一步。这是在实际测试或攻击目标网络之前进行的。调查结果将指导需要进行额外侦察的方向，或者在利用阶段攻击的漏洞。
- en: Reconnaissance activities are segmented on a gradient of interactivity with
    the target network or device.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察活动在与目标网络或设备的互动程度梯度上进行分段。
- en: '![Basic principles of reconnaissance](img/3121OS_02_01.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![侦察的基本原则](img/3121OS_02_01.jpg)'
- en: Passive reconnaissance does not involve direct interaction with the target network.
    The attacker's source IP address and activities are not logged (for example, a
    Google search for the target's e-mail addresses). It is difficult, if not impossible,
    for the target to differentiate passive reconnaissance from normal business activities.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 被动侦察不涉及与目标网络的直接互动。攻击者的源IP地址和活动不会被记录（例如，对目标电子邮件地址进行谷歌搜索）。目标很难，甚至不可能将被动侦察与正常业务活动区分开来。
- en: In general, passive reconnaissance focuses on the business and regulatory environment,
    the company, and the employees. Information of this type is available on the Internet
    or other public sources, and is sometimes referred to as open source intelligence,
    or OSINT.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，被动侦察侧重于商业和监管环境、公司和员工。这类信息可以在互联网或其他公共来源获取，有时被称为开源情报，或者OSINT。
- en: Passive reconnaissance also involves the normal interactions that occur when
    an attacker interacts with the target in an expected manner. For example, an attacker
    will log on to the corporate website, view various pages, and download documents
    for further study. These interactions are expected user activities, and are rarely
    detected as a prelude to an attack on the target.
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 被动侦察还涉及攻击者以预期方式与目标进行的正常互动。例如，攻击者将登录企业网站，查看各种页面，并下载文件以供进一步研究。这些互动是预期的用户活动，很少被检测为对目标进行攻击的前兆。
- en: Active reconnaissance involves direct queries or other interactions (for example,
    port scanning of the target network) that can trigger system alarms or allow the
    target to capture the attacker's IP address and activities. This information could
    be used to identify and arrest an attacker, or during legal proceedings. Because
    active reconnaissance requires additional techniques for the tester to remain
    undetected, it will be covered in [Chapter 3](ch03.html "Chapter 3. Active Reconnaissance
    and Vulnerability Scanning"), *Active Reconnaissance and Vulnerability Scanning*.
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主动侦察涉及直接查询或其他互动（例如，对目标网络进行端口扫描），可能会触发系统警报或允许目标捕获攻击者的IP地址和活动。这些信息可以用于识别和逮捕攻击者，或者在法律诉讼中使用。因为主动侦察需要测试人员采取额外的技术来保持不被发现，所以将在[第3章](ch03.html
    "第3章。主动侦察和漏洞扫描")中进行介绍，*主动侦察和漏洞扫描*。
- en: Penetration testers or attackers generally follow a process of structured information
    gathering, moving from a broad scope (the business and regulatory environments)
    to the very specific (user account data).
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员或攻击者通常遵循结构化信息收集的过程，从广泛范围（商业和监管环境）到非常具体（用户帐户数据）。
- en: To be effective, testers should know exactly what they are looking for and how
    the data will be used before collection starts. Using passive reconnaissance and
    limiting the amount of data collected minimizes the risks of being detected by
    the target.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 为了有效，测试人员在收集开始之前应该清楚知道他们在寻找什么以及数据将如何使用。使用被动侦察并限制收集的数据量可以最大程度地减少被目标发现的风险。
- en: Open Source intelligence
  id: totrans-249
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 开源情报
- en: Generally, the first step in a penetration test or an attack is the collection
    of open-source intelligence, or OSINT.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，渗透测试或攻击的第一步是收集开源情报，或者OSINT。
- en: OSINT is information collected from public sources, particularly the Internet.
    The amount of available information is considerable—most intelligence and military
    organizations are actively engaged in OSINT activities to collect information
    about their targets, and to guard against data leakage about them.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: OSINT是从公共来源，特别是互联网上收集的信息。可用信息的数量是相当可观的——大多数情报和军事组织都在积极从事OSINT活动，以收集有关他们的目标的信息，并防范有关他们的数据泄漏。
- en: The process of OSINT collection and analysis is complex and could constitute
    its own book; therefore, we will cover only the essential highlights.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: OSINT收集和分析的过程是复杂的，可能构成一本书；因此，我们只会涵盖基本要点。
- en: Tip
  id: totrans-253
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The US Army manual ATP 2-22.9 ([http://www.fas.org/irp/doddir/army/atp2-22-9.pdf](http://www.fas.org/irp/doddir/army/atp2-22-9.pdf))
    and the NATO OSINT manual ([http://information-retrieval.info/docs/NATO-OSINT.html](http://information-retrieval.info/docs/NATO-OSINT.html))
    are both available online, and provide excellent technical reviews of how to gather
    and assess OSINT.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 美国陆军手册ATP 2-22.9（[http://www.fas.org/irp/doddir/army/atp2-22-9.pdf](http://www.fas.org/irp/doddir/army/atp2-22-9.pdf)）和北约OSINT手册（[http://information-retrieval.info/docs/NATO-OSINT.html](http://information-retrieval.info/docs/NATO-OSINT.html)）都可以在线获取，并提供了如何收集和评估OSINT的出色技术评论。
- en: The information that is targeted for collection is dependent on the initial
    goal of the penetration test. For example, if testers wants to access financial
    data, they will need the names and biographical information of relevant employees
    (CFO, accounts receivable and payable, and so on), their usernames, and passwords.
    If the route of an attack involves social engineering, they may supplement this
    information with details that give credibility to the requests for information.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 针对收集的信息取决于渗透测试的初始目标。例如，如果测试人员想要访问财务数据，他们将需要相关员工（CFO、应收和应付账款等）的姓名和生物信息，他们的用户名和密码。如果攻击的途径涉及社会工程，他们可能会补充这些信息，以使信息请求更加可信。
- en: 'OSINT gathering usually starts with a review of the target''s official online
    presence (website, blogs, social-media pages, and third-party data repositories
    such as public financial records). Information of interest includes the following:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: OSINT收集通常从审查目标的官方在线存在开始（网站、博客、社交媒体页面和第三方数据存储库，如公共财务记录）。感兴趣的信息包括以下内容：
- en: Geographical locations of offices, especially remote or satellite offices that
    share corporate information but may lack stringent security controls.
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 办公室的地理位置，特别是共享企业信息但可能缺乏严格安全控制的远程或卫星办公室。
- en: An overview of the parent company and any subsidiary companies, especially any
    new companies acquired by mergers or acquisitions (these companies are frequently
    not as secure as the parent company).
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 母公司和任何子公司的概述，特别是通过合并或收购获得的任何新公司（这些公司通常没有母公司安全）。
- en: Employee names and contact information, especially names, e-mail addresses,
    and phone numbers.
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 员工姓名和联系信息，特别是姓名、电子邮件地址和电话号码。
- en: Clues about the corporate culture and language; this will facilitate social
    engineering attacks.
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关企业文化和语言的线索；这将有助于社会工程攻击。
- en: Business partners or vendors that may connect into the target's network.
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可能连接到目标网络的商业伙伴或供应商。
- en: Technologies in use. For example, if the target issues a press release about
    adopting new devices or software, the attacker will review the vendor's website
    for bug reports, known or suspected vulnerabilities, and details that could be
    used to facilitate various attacks.
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用的技术。例如，如果目标发布了关于采用新设备或软件的新闻稿，攻击者将会查看供应商的网站，寻找漏洞报告、已知或疑似的漏洞，以及可能用于促成各种攻击的详细信息。
- en: 'Other online information sources used by the attacker may include the following:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可能使用的其他在线信息来源包括以下内容：
- en: Search engines such as Google and Bing. Historically, these searches are highly
    manual; the attacker enters search terms that are specific for information of
    interest; for example, the search term "company name" + password filetype:xls
    may identify an Excel spreadsheet that contains employee passwords. These search
    terms are referred to as **google dorks** ([www.exploit-db.com/google-dorks/](http://www.exploit-db.com/google-dorks/)).
    Most search engines have since released APIs to facilitate automated lookups,
    making tools such as **Maltego** particularly effective.
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 谷歌和必应等搜索引擎。从历史上看，这些搜索是高度手动的；攻击者输入特定于感兴趣信息的搜索词；例如，搜索词“公司名称”+密码 filetype:xls 可能会识别出包含员工密码的Excel电子表格。这些搜索词被称为**谷歌dorks**（[www.exploit-db.com/google-dorks/](http://www.exploit-db.com/google-dorks/)）。大多数搜索引擎已经发布了API以便进行自动查找，使得诸如**Maltego**之类的工具特别有效。
- en: Tip
  id: totrans-265
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: One of the most effective search engines is **Yandex** ([www.yandex.com](http://www.yandex.com)).
    This Russian language search engine, the fourth-largest search engine in the world,
    allows users to search in several languages, including English. It also supports
    very granular search expressions, making it more effective than Google when searching
    for specific information.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 最有效的搜索引擎之一是**Yandex**（[www.yandex.com](http://www.yandex.com)）。这家俄语搜索引擎是世界第四大搜索引擎，允许用户用多种语言进行搜索，包括英语。它还支持非常精细的搜索表达式，使其在搜索特定信息时比谷歌更有效。
- en: 'Other online sources that should be searched include:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 其他应该搜索的在线来源包括：
- en: Government, financial, or other regulatory sites that provide information on
    mergers and acquisitions, names of key persons, and supporting data
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供有关合并和收购、关键人员姓名和支持数据的政府、金融或其他监管网站。
- en: Usenet newsgroups, particularly postings from the target's employees looking
    for help with particular technologies
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Usenet新闻组，特别是目标员工寻求特定技术帮助的帖子
- en: LinkedIn, Jigsaw, and other websites that provide employee information
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供员工信息的LinkedIn、Jigsaw和其他网站
- en: Job search websites, especially ones for technical positions that provide a
    list of the technologies and services that must be supported by a successful applicant
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 求职网站，特别是提供成功申请者必须支持的技术和服务列表的技术职位
- en: Historic or cached content, retrieved by search engines (cache:url in Google,
    or WayBack Machine at [www.archive.org](http://www.archive.org))
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过搜索引擎检索的历史或缓存内容（在Google中的cache:url，或在[www.archive.org](http://www.archive.org)的WayBack
    Machine）
- en: Country- and language-specific social and business related sites (refer to [http://searchenginecolossus.com](http://searchenginecolossus.com))
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 特定国家和语言的社交和业务相关网站（参考[http://searchenginecolossus.com](http://searchenginecolossus.com)）
- en: Sites that aggregate and compare results from multiple search engines, such
    as Zuula ([www.zuula.com](http://www.zuula.com))
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 聚合和比较多个搜索引擎结果的网站，如Zuula（[www.zuula.com](http://www.zuula.com)）
- en: Corporate and employee blogs, as well as personal blogs of key employees
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 企业和员工博客，以及关键员工的个人博客
- en: Social networks (LinkedIn, Facebook, and Twitter)
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 社交网络（LinkedIn、Facebook和Twitter）
- en: Sites that provide lookups of DNS, route, and server information, especially,
    DNSstuff ([www.dnsstuff.com](http://www.dnsstuff.com)), ServerSniff ([www.serversniff.net](http://www.serversniff.net)),
    Netcraft ([www.netcraft.com](http://www.netcraft.com)), and [myIPneighbors.com](http://myIPneighbors.com)
  id: totrans-277
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供DNS、路由和服务器信息查找的网站，特别是DNSstuff（[www.dnsstuff.com](http://www.dnsstuff.com)）、ServerSniff（[www.serversniff.net](http://www.serversniff.net)）、Netcraft（[www.netcraft.com](http://www.netcraft.com)）和[myIPneighbors.com](http://myIPneighbors.com)
- en: Shodan ([www.shodanHQ.com](http://www.shodanHQ.com)), sometimes referred to
    as the "hacker's Google"; Shodan lists Internet-accessible devices and allows
    the tester to search for devices with known vulnerabilities
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Shodan（[www.shodanHQ.com](http://www.shodanHQ.com)），有时被称为“黑客的谷歌”；Shodan列出了可通过互联网访问的设备，并允许测试人员搜索已知漏洞的设备
- en: Password dumpsites (pastebin, search using `site:pastebin.com "targetURL"`)
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码转储站点（pastebin，使用`site:pastebin.com "targetURL"`进行搜索）
- en: Managing findings can be difficult; however, Kali comes with KeepNote, which
    supports the rapid import and management of different types of data.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 管理发现可能很困难；然而，Kali配备了KeepNote，支持快速导入和管理不同类型的数据。
- en: DNS reconnaissance and route mapping
  id: totrans-281
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DNS侦察和路由映射
- en: Once a tester has identified the targets that have an online presence and contain
    items of interest, the next step is to identify the IP addresses and routes to
    the target.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦测试人员确定了具有在线存在并包含感兴趣项目的目标，下一步就是确定目标的IP地址和路由。
- en: DNS reconnaissance is concerned with identifying who owns a particular domain
    or series of IP addresses (`whois`-type information), the DNS information defining
    the actual domain names and IP addresses assigned to the target, and the route
    between the penetration tester or the attacker and the final target.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: DNS侦察涉及确定谁拥有特定的域或一系列IP地址（`whois`类型的信息），定义实际域名和IP地址分配给目标的DNS信息，以及穿透测试人员或攻击者与最终目标之间的路由。
- en: This information gathering is semi-active—some of the information is available
    from freely available open sources, while other information is available from
    third parties such as DNS registrars. Although the registrar may collect IP addresses
    and data concerning requests made by the attacker, it is rarely provided to the
    end target. The information that could be directly monitored by the target, such
    as DNS server logs, is almost never reviewed or retained.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 这种信息收集是半主动的——一些信息来自免费开放的来源，而其他信息来自DNS注册商等第三方。尽管注册商可能收集攻击者的IP地址和请求相关的数据，但很少提供给最终目标。目标可以直接监控的信息，例如DNS服务器日志，几乎从不被审查或保留。
- en: Because the information needed can be queried using a defined systematic and
    methodical approach, its collection can be automated.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 因为所需的信息可以使用定义的系统化和有条理的方法查询，所以可以自动收集这些信息。
- en: Tip
  id: totrans-286
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Note that DNS information may contain stale or incorrect entries. To minimize
    inaccurate information, query different source servers and use different tools
    to cross-validate results. Review results, and manually verify any suspect findings.
    Use a script to automate the collection of this information. The script should
    create a folder for the penetration test, and then a series of folders for each
    application being run. After the script executes each command, pipe the results
    directly to the specific holding folder.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，DNS信息可能包含过时或不正确的条目。为了最小化不准确的信息，查询不同的源服务器并使用不同的工具来交叉验证结果。审查结果，并手动验证任何可疑的发现。使用脚本自动收集这些信息。脚本应该为渗透测试创建一个文件夹，然后为每个运行的应用程序创建一系列文件夹。在脚本执行每个命令后，将结果直接传送到特定的保存文件夹。
- en: WHOIS
  id: totrans-288
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: WHOIS
- en: The first step in researching the IP address space is to identify the addresses
    that are assigned to the target site. This is usually accomplished by using the
    `whois` command, which allows people to query databases that store information
    on the registered users of an Internet resource, such as a domain name or IP address.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 研究IP地址空间的第一步是确定分配给目标站点的地址。通常使用`whois`命令来完成这一步，该命令允许人们查询存储有关互联网资源的注册用户信息的数据库，例如域名或IP地址。
- en: Depending on the database that is queried, the response to a `whois` request
    will provide names, physical addresses, phone numbers, and e-mail addresses (useful
    in facilitating social engineering attacks), as well as IP addresses and DNS server
    names.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 根据查询的数据库，对`whois`请求的响应将提供姓名、地址、电话号码和电子邮件地址（有助于促进社会工程攻击），以及IP地址和DNS服务器名称。
- en: 'An attacker can use information from a `whois` query to:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可以使用“whois”查询的信息来：
- en: Support a social engineering attack against the location or persons identified
    in the query
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持对查询中确定的位置或人员进行社会工程攻击
- en: Identify a location for a physical attack
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定进行物理攻击的位置
- en: Identify phone numbers that can be used for a **war dialing** attack, or to
    conduct a social engineering attack
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别可用于**战争拨号**攻击的电话号码，或进行社会工程攻击
- en: Conduct recursive searches to locate other domains hosted on the same server
    as the target or operated by the same user; if they are insecure, an attacker
    can exploit them to gain administrative access to the server, and then compromise
    the target server
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进行递归搜索，以查找与目标托管在同一服务器上或由同一用户操作的其他域；如果它们不安全，攻击者可以利用它们来获得对服务器的管理访问权限，然后妥协目标服务器
- en: In cases where the domain is due to expire, an attacker can attempt to seize
    the domain, and create a look-alike website to compromise visitors who think they
    are on the original website
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在域名即将到期的情况下，攻击者可以尝试夺取该域名，并创建一个类似的网站来妥协那些认为自己在原始网站上的访问者
- en: An attacker will use the authoritative DNS servers, which are the records for
    lookups of that domain, to facilitate DNS reconnaissance
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击者将使用权威DNS服务器，这些服务器是用于查找该域的记录，以促进DNS侦察
- en: Note that there is an increase in the usage of third parties to shield this
    data, and some domains, such as `.gov` and `.mil`, may not be accessible to the
    public domain. Requests to these domains are usually logged. There are several
    online lists available that describe domains and IP addresses assigned for government
    use; most tools accept options for "no contact" addresses, and government domains
    should be entered into these fields to avoid the wrong type of attention!
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，第三方用于保护这些数据的使用增加了，并且一些域，如`.gov`和`.mil`，可能无法访问公共域。对这些域的请求通常会被记录。有几个在线列表可用于描述分配给政府使用的域和IP地址；大多数工具接受“无联系”地址的选项，并且政府域应该输入这些字段以避免错误类型的关注！
- en: 'The easiest way to issue a `whois` query is from the command line. The following
    screenshot shows the `whois` command run against the domain of Digital Defence:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 发出`whois`查询的最简单方法是从命令行。以下屏幕截图显示了对Digital Defence域运行的`whois`命令：
- en: '![WHOIS](img/3121OS_02_02.jpg)'
  id: totrans-300
  prefs: []
  type: TYPE_IMG
  zh: '![WHOIS](img/3121OS_02_02.jpg)'
- en: The returned `whois` record contains geographical information, names, and contact
    information—all of which can be used to facilitate a social engineering attack.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 返回的`whois`记录包含地理信息、名称和联系信息，所有这些都可以用来促进社会工程攻击。
- en: There are several websites that automate `whois` lookup enquiries, and attackers
    can use these sites to insert a step between the target and themselves; however,
    the site doing the lookup may log the requester's IP address.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 有几个网站可以自动化`whois`查询，攻击者可以使用这些网站在目标和自己之间插入一步；然而，进行查询的网站可能会记录请求者的IP地址。
- en: DNS reconnaissance
  id: totrans-303
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DNS侦察
- en: The **Domain Name System** (**DNS**), is a distributed database that resolves
    names ([www.digitaldefence.ca](http://www.digitaldefence.ca)) to its IP addresses
    (`192.150.2.140`).
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '**域名系统**（**DNS**）是一个分布式数据库，将名称（[www.digitaldefence.ca](http://www.digitaldefence.ca)）解析为其IP地址（`192.150.2.140`）。'
- en: 'Attackers use the DNS information in the following ways:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者使用DNS信息的以下方式：
- en: Using brute-force attacks, allows attackers to identify new domain names associated
    with the target.
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用暴力攻击，允许攻击者识别与目标相关的新域名。
- en: If the DNS server is configured to permit a zone transfer to any requester,
    it will provide hostnames and IP addresses of Internet-accessible systems, making
    it easier to identify potential targets. If the target does not segregate public
    (external) DNS information from private (internal) DNS information, a zone transfer
    might disclose the hostnames and IP addresses of internal devices. (Note that
    most IDS and IPS systems will trigger an alarm if a zone transfer request is triggered).
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果DNS服务器配置为允许任何请求者进行区域传输，它将提供互联网可访问系统的主机名和IP地址，从而更容易识别潜在目标。如果目标没有将公共（外部）DNS信息与私有（内部）DNS信息分开，区域传输可能会公开内部设备的主机名和IP地址。（请注意，如果触发区域传输请求，大多数IDS和IPS系统将触发警报）。
- en: Finding services that may be vulnerable (for example, FTP) or are otherwise
    interesting (remote administration panels and remote access).
  id: totrans-308
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查找可能容易受攻击（例如FTP）或其他有趣的服务（远程管理面板和远程访问）。
- en: Finding misconfigured and/or unpatched servers (`dbase.test.target.com`).
  id: totrans-309
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查找配置错误和/或未打补丁的服务器（`dbase.test.target.com`）。
- en: '**Service records** (**SRV**), provide information on service, transport, port,
    and order of importance for services. This can allow an attacker to deduce the
    software.'
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务记录**（**SRV**）提供有关服务、传输、端口和服务重要性顺序的信息。这可以让攻击者推断出软件。'
- en: '**DomainKeys Identified Mail** (**DKIM**) and **Sender Policy Framework** (**SPF**)
    records are used to control spam e-mails. If these records are identified, the
    attacker knows that:'
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**DomainKeys Identified Mail**（**DKIM**）和**Sender Policy Framework**（**SPF**）记录用于控制垃圾邮件。如果识别出这些记录，攻击者会知道：'
- en: They are more security conscious than most organizations.
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们比大多数组织更注重安全。
- en: This may impact phishing and other social engineering attacks.
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 这可能会影响网络钓鱼和其他社会工程攻击。
- en: Both Windows and Unix support basic command-line tools such as **nslookup**,
    and Unix systems support additional command-line options such as `dig`. Unfortunately,
    these commands usually interrogate one server at a time, and require interactive
    responses to be effective.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: Windows和Unix都支持基本的命令行工具，如**nslookup**，而Unix系统支持额外的命令行选项，如`dig`。不幸的是，这些命令通常一次只询问一个服务器，并且需要交互式响应才能有效。
- en: Kali features several tools designed to iteratively query DNS information for
    a particular target. The selected tool must accommodate the Internet Protocol
    version that is used for communications with the target—IPv4 or IPv6.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: Kali具有几个旨在迭代地查询特定目标的DNS信息的工具。所选工具必须适应与目标进行通信的互联网协议版本——IPv4或IPv6。
- en: IPv4
  id: totrans-316
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: IPv4
- en: 'The IP, or Internet Protocol address, is a unique number used to identify devices
    that are connected to a private network or the public Internet. Today, the Internet
    is largely based on version 4, IPv4\. Kali includes several tools to facilitate
    DNS reconnaissance, as given in the following table:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: IP地址，或者互联网协议地址，是用来识别连接到私人网络或公共互联网的设备的唯一数字。今天，互联网主要基于版本4，即IPv4。Kali包括几个工具来促进DNS侦察，如下表所示：
- en: '| Application | Description |'
  id: totrans-318
  prefs: []
  type: TYPE_TB
  zh: '| 应用 | 描述 |'
- en: '| --- | --- |'
  id: totrans-319
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `dnsenum`, `dnsmap`, and `dnsrecon` | These are comprehensive DNS scanners—DNS
    record enumeration (A, MX, TXT, SOA, wildcard, and so on), subdomain brute-force
    attacks, Google lookup, reverse lookup, zone transfer, and zone walking. `dsnrecon`
    is usually the first choice—it is highly reliable, results are well parsed, and
    data can be directly imported into the Metasploit Framework. |'
  id: totrans-320
  prefs: []
  type: TYPE_TB
  zh: '| `dnsenum`，`dnsmap`和`dnsrecon` | 这些是全面的DNS扫描器——DNS记录枚举（A，MX，TXT，SOA，通配符等），子域暴力攻击，Google查找，反向查找，区域传输和区域遍历。`dsnrecon`通常是第一选择——它非常可靠，结果被很好地解析，并且数据可以直接导入Metasploit框架。'
- en: '| `dnstracer` | This determines where a given Domain Name System gets its information
    from, and follows the chain of DNS servers back to the servers which know the
    data. |'
  id: totrans-321
  prefs: []
  type: TYPE_TB
  zh: '| `dnstracer` | 这确定给定域名系统从哪里获取其信息，并跟随DNS服务器链返回到知道数据的服务器。'
- en: '| `dnswalk` | This DNS debugger checks specified domains for internal consistency
    and accuracy. |'
  id: totrans-322
  prefs: []
  type: TYPE_TB
  zh: '| `dnswalk` | 这个DNS调试器检查指定的域名的内部一致性和准确性。 |'
- en: '| `fierce` | This locates non-contiguous IP space and hostnames against specified
    domains by attempting zone transfers, and then attempting brute-force attacks
    to gain DNS information. |'
  id: totrans-323
  prefs: []
  type: TYPE_TB
  zh: '| `fierce` | 通过尝试区域传输，然后尝试暴力攻击以获取DNS信息，来定位指定域名的非连续IP空间和主机名。 |'
- en: During testing, most investigators run `fierce` to confirm that all possible
    targets have been identified, and then run at least two comprehensive tools (for
    example, `dnsenum` and `dnsrecon`) to generate the maximum amount of data and
    provide a degree of cross validation.
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 在测试过程中，大多数调查员运行`fierce`来确认已经识别出所有可能的目标，然后运行至少两个综合工具（例如`dnsenum`和`dnsrecon`）来生成最大量的数据，并提供一定程度的交叉验证。
- en: In the following screenshot, `dnsrecon` is used to generate a standard DNS record
    search, and a search that is specific for SRV records. An excerpt of the results
    is shown for each case.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，`dnsrecon`用于生成标准的DNS记录搜索，以及特定于SRV记录的搜索。每种情况下都显示了部分结果。
- en: '![IPv4](img/3121OS_02_03.jpg)'
  id: totrans-326
  prefs: []
  type: TYPE_IMG
  zh: '![IPv4](img/3121OS_02_03.jpg)'
- en: '`DNSrecon` allows the penetration tester to obtain the SOA record, **name servers**
    (**NS**), **mail exchanger** (MX) hosts, servers sending e-mails using **Sender
    Policy Framework** (SPF), and the IP address ranges in use.'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: '`DNSrecon`允许渗透测试人员获取SOA记录、**域名服务器**（**NS**）、使用**发件人策略框架**（SPF）发送电子邮件的服务器，以及正在使用的IP地址范围。'
- en: IPv6
  id: totrans-328
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: IPv6
- en: Although IPv4 seems to permit a large address space, freely available IP addresses
    were exhausted several years ago, forcing the employment of NAT and DHCP to increase
    the number of available addresses. A more permanent solution has been found in
    the adoption of an improved IP addressing scheme, IPv6\. Although it constitutes
    less than five percent of Internet addresses, its usage is increasing, and penetration
    testers must be prepared to address the differences between IPv4 and IPv6.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管IPv4似乎允许一个大的地址空间，但几年前已经耗尽了可用的IP地址，迫使采用NAT和DHCP来增加可用地址的数量。在IPv6的改进IP地址方案的采用中找到了一个更为永久的解决方案。尽管它只占互联网地址的不到五分之一，但它的使用率正在增加，渗透测试人员必须准备好应对IPv4和IPv6之间的差异。
- en: In IPv6, the source and destination addresses are 128 bits in length, yielding
    2128 possible addresses, that is, 340 undecillion addresses!
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 在IPv6中，源地址和目的地址的长度为128位，可以产生2128个可能的地址，也就是340个不可思议的地址！
- en: The increased size of the addressable address space presents some problems to
    penetration testers, particularly when using scanners that step through the available
    address space looking for live servers. However, some features of the IPv6 protocol
    have simplified discovery, especially the use of ICMPv6 to identify active link-local
    addresses.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 可寻址地址空间的增加大小给渗透测试人员带来了一些问题，特别是在使用扫描器遍历可用地址空间寻找活动服务器时。然而，IPv6协议的一些特性已经简化了发现，特别是使用ICMPv6来识别活动的链路本地地址。
- en: 'It is important to consider IPv6 when conducting initial scans for the following
    reasons:'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行初始扫描时考虑IPv6是很重要的，原因如下：
- en: There is uneven support for IPv6 functionality in testing tools, so the tester
    must ensure that each tool is validated to determine its performance and accuracy
    in IPv4, IPv6, and mixed networks.
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试工具对IPv6功能的支持不均衡，因此测试人员必须确保每个工具都经过验证，以确定其在IPv4、IPv6和混合网络中的性能和准确性。
- en: Because IPv6 is a relatively new protocol, the target network may contain misconfigurations
    that leak important data; the tester must be prepared to recognize and use this
    information.
  id: totrans-334
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 因为IPv6是一个相对较新的协议，目标网络可能包含泄露重要数据的错误配置；测试人员必须准备好识别和利用这些信息。
- en: Older network controls (firewalls, IDS, and IPS) may not detect IPv6\. In such
    cases, penetration testers can use IPv6 tunnels to maintain covert communications
    with the network, and exfiltrate the data undetected.
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 旧的网络控制（防火墙、IDS和IPS）可能无法检测到IPv6。在这种情况下，渗透测试人员可以使用IPv6隧道来与网络保持隐蔽通信，并且无法被检测到地泄露数据。
- en: Kali includes several tools developed to take advantage of IPv6 (most comprehensive
    scanners, such as `nmap`, now support IPv6), some of which are as follows; tools
    that are particular to IPv6 were largely derived from the THC-IPv6 Attack Toolkit.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: Kali包括几个专门用于利用IPv6的工具（大多数综合扫描器，如`nmap`，现在支持IPv6），其中一些如下；专门用于IPv6的工具主要源自THC-IPv6攻击工具包。
- en: '| Application | Description |'
  id: totrans-337
  prefs: []
  type: TYPE_TB
  zh: '| 应用 | 描述 |'
- en: '| --- | --- |'
  id: totrans-338
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `dnsdict6` | Enumerates subdomains to obtain IPv4 and IPv6 addresses (if
    present) using a brute force search based on a supplied dictionary file or its
    own internal list. |'
  id: totrans-339
  prefs: []
  type: TYPE_TB
  zh: '| `dnsdict6` | 使用基于提供的字典文件或其自己的内部列表的暴力搜索，列举子域以获取IPv4和IPv6地址（如果存在）。 |'
- en: '| `dnsrevenum6` | Performs reverse DNS enumeration given an IPv6 address. |'
  id: totrans-340
  prefs: []
  type: TYPE_TB
  zh: '| `dnsrevenum6` | 给定IPv6地址，执行反向DNS枚举。 |'
- en: 'The execution of the `dnsdict6` command is shown in the following screenshot:'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的屏幕截图显示了`dnsdict6`命令的执行：
- en: '![IPv6](img/3121OS_02_04.jpg)'
  id: totrans-342
  prefs: []
  type: TYPE_IMG
  zh: '![IPv6](img/3121OS_02_04.jpg)'
- en: Mapping the route to the target
  id: totrans-343
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 映射到目标的路线
- en: Route mapping was originally used as a diagnostic tool that allows you to view
    the route that an IP packet follows from one host to the next. Using the **time
    to live** (**TTL**) field in an IP packet, each *hop* from one point to the next
    elicits an **ICMP TIME_EXCEEDED** message from the receiving router, decrementing
    the value in the TTL field by 1\. The packets count the number of hops and the
    route taken.
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: '路由映射最初是作为一种诊断工具使用的，它允许您查看IP数据包从一个主机到下一个主机的路径。使用IP数据包中的**生存时间**（**TTL**）字段，从一个点到下一个点的每个*跳*都会从接收路由器那里引发一个**ICMP
    TIME_EXCEEDED**消息，将TTL字段中的值减少1。数据包计算跳数和路径。 '
- en: 'From an attacker''s, or penetration tester''s perspective, the `traceroute`
    data yields the following important data:'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 从攻击者或渗透测试人员的角度来看，`traceroute`数据提供了以下重要数据：
- en: The exact path between the attacker and the target
  id: totrans-346
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击者和目标之间的确切路径
- en: Hints pertaining to the network's external topology
  id: totrans-347
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有关网络外部拓扑的提示
- en: Identification of accessing control devices (firewalls and packet-filtering
    routers) that may be filtering attack traffic
  id: totrans-348
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别访问控制设备（防火墙和数据包过滤路由器）可能正在过滤攻击流量
- en: If the network is misconfigured, it may be possible to identify internal addressing
  id: totrans-349
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果网络配置错误，可能会识别内部寻址
- en: Tip
  id: totrans-350
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Using a web-based `traceroute` ([www.traceroute.org](http://www.traceroute.org)),
    it is possible to trace various geographic origin sites to the target network.
    These types of scans will frequently identify more than one different network
    connecting to the target, which is information that could be missed by conducting
    only a single `traceroute` from a location close to the target. Web-based `traceroute`
    may also identify multihomed hosts which connect two or more networks together.
    These hosts are an important target for attackers, because they drastically increase
    the attack surface leading to the target.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 使用基于Web的`traceroute`（[www.traceroute.org](http://www.traceroute.org)），可以追踪各种地理起源站点到目标网络。这些类型的扫描通常会识别连接到目标的多个不同网络，这是仅从靠近目标的位置进行单个`traceroute`可能会错过的信息。基于Web的`traceroute`还可以识别连接两个或更多网络的多宿主机。这些主机是攻击者的重要目标，因为它们大大增加了导致目标的攻击面。
- en: In Kali, `traceroute` is a command-line program that uses ICMP packets to map
    the route; in Windows, the program is `tracert`.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 在Kali中，`traceroute`是一个使用ICMP数据包映射路由的命令行程序；在Windows中，该程序是`tracert`。
- en: 'If you launch `traceroute` from Kali, it is likely that you will see most hops
    filtered (data is shown as * * *). For example, `traceroute` from the author''s
    present location to [www.google.com](http://www.google.com) would yield the following:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您从Kali启动`traceroute`，很可能会看到大多数跳数被过滤（数据显示为* * *）。例如，从作者目前的位置到[www.google.com](http://www.google.com)的`traceroute`将产生以下结果：
- en: '![Mapping the route to the target](img/3121OS_02_05.jpg)'
  id: totrans-354
  prefs: []
  type: TYPE_IMG
  zh: '![映射到目标的路由](img/3121OS_02_05.jpg)'
- en: 'However, if the same request was run using `tracert` from the Windows command
    line, we would see the following:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果使用Windows命令行运行`tracert`相同的请求，我们会看到以下内容：
- en: '![Mapping the route to the target](img/3121OS_02_06.jpg)'
  id: totrans-356
  prefs: []
  type: TYPE_IMG
  zh: '![映射到目标的路由](img/3121OS_02_06.jpg)'
- en: Not only do we get the complete path, but we can also see that [www.google.com](http://www.google.com)
    is resolving to a slightly different IP address, indicating that load balancers
    are in effect (you can confirm this using Kali's `lbd` script; however, this activity
    may be logged by the target site).
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不仅可以获得完整的路径，还可以看到[www.google.com](http://www.google.com)解析为稍有不同的IP地址，表明负载均衡器正在生效（您可以使用Kali的`lbd`脚本来确认这一点；但是，这种活动可能会被目标站点记录）。
- en: The reason for the different path data is that, by default, `traceroute` used
    UDP datagrams while Windows `tracert` uses ICMP echo request (ICMP type 8). Therefore,
    when completing a `traceroute` using Kali tools, it is important to use multiple
    protocols in order to obtain the most complete path, and to bypass packet-filtering
    devices.
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 不同路径数据的原因是，默认情况下，`traceroute`使用UDP数据包，而Windows的`tracert`使用ICMP echo请求（ICMP类型8）。因此，使用Kali工具完成`traceroute`时，重要的是使用多个协议以获得最完整的路径，并绕过数据包过滤设备。
- en: 'Kali provides the following tools for completing route traces:'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 'Kali提供以下工具来完成路由跟踪： '
- en: '| Application | Description |'
  id: totrans-360
  prefs: []
  type: TYPE_TB
  zh: '| 应用程序 | 描述 |'
- en: '| --- | --- |'
  id: totrans-361
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `hping3` | This is a TCP/IP packet assembler and analyzer. This supports
    TCP, UDP, ICMP, and raw-IP and uses a ping-like interface. |'
  id: totrans-362
  prefs: []
  type: TYPE_TB
  zh: '| `hping3` | 这是一个TCP/IP数据包组装器和分析器。它支持TCP、UDP、ICMP和原始IP，并使用类似ping的界面。|'
- en: '| `intrace` | This enables users to enumerate IP hops by exploiting existing
    TCP connections, both initiated from the local system or network, or from local
    hosts. This makes it very useful for bypassing external filters such as firewalls.
    `intrace` is a replacement for the less reliable 0trace program. |'
  id: totrans-363
  prefs: []
  type: TYPE_TB
  zh: '| `intrace` | 这使用户能够通过利用现有的TCP连接枚举IP跳数，这些连接可以来自本地系统或网络，也可以来自本地主机。这使得它非常有用，可以绕过外部过滤器，如防火墙。`intrace`是不太可靠的0trace程序的替代品。|'
- en: '| `trace6` | This is a `traceroute` program that uses ICMP6. |'
  id: totrans-364
  prefs: []
  type: TYPE_TB
  zh: '| `trace6` | 这是一个使用ICMP6的`traceroute`程序。|'
- en: '`hping3` is one of the most useful tools due to the control it gives over packet
    type, source packet, and destination packet. For example, Google does not allow
    ping requests. However, it is possible to ping the server if you send the packet
    as a TCP SYN request.'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: '`hping3`是最有用的工具之一，因为它可以控制数据包类型、源数据包和目标数据包。例如，谷歌不允许ping请求。但是，如果将数据包发送为TCP SYN请求，则可以ping服务器。'
- en: 'In the following example, the tester attempts to ping Google from the command
    line. The returned data identifies that [www.google.com](http://www.google.com)
    is an unknown host; Google is clearly blocking ICMP-based ping commands. However,
    the next command invokes `hping3`, instructing it to do the following:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的示例中，测试人员尝试从命令行ping谷歌。返回的数据表明[www.google.com](http://www.google.com)是一个未知的主机；谷歌显然正在阻止基于ICMP的ping命令。然而，下一个命令调用`hping3`，指示它执行以下操作：
- en: Send a ping-like command to Google using TCP with the SYN flag set (`-S`).
  id: totrans-367
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用设置了SYN标志的TCP向谷歌发送类似ping的命令（`-S`）。
- en: Direct the packet to port 80; legitimate requests of this type are rarely blocked
    (`- p 80`).
  id: totrans-368
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将数据包定向到端口80；这种类型的合法请求很少被阻止（`- p 80`）。
- en: Set a count of sending three packets to the target (`-c 3`).
  id: totrans-369
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置发送三个数据包到目标的计数（`-c 3`）。
- en: 'To execute the previous steps, use the commands as shown in the following screenshot:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行前面的步骤，请使用以下截图中显示的命令：
- en: '![Mapping the route to the target](img/3121OS_02_07.jpg)'
  id: totrans-371
  prefs: []
  type: TYPE_IMG
  zh: '![映射到目标的路由](img/3121OS_02_07.jpg)'
- en: The `hping3` command successfully identifies that the target is online, and
    provides some basic routing information.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: '`hping3`命令成功识别目标在线，并提供一些基本的路由信息。'
- en: Obtaining user information
  id: totrans-373
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取用户信息
- en: Many penetration testers gather user names and e-mail addresses, as this information
    is frequently used to log on to targeted systems.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 许多渗透测试人员收集用户名称和电子邮件地址，因为这些信息经常用于登录到目标系统。
- en: The most commonly employed tool is the web browser, which is used to manually
    search the target organization's website as well as third-party sites such as
    LinkedIn or Jigsaw.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 最常用的工具是网络浏览器，用于手动搜索目标组织的网站以及 LinkedIn 或 Jigsaw 等第三方网站。
- en: Some automated tools included with Kali can supplement the manual searches.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: Kali 中包含的一些自动化工具可以补充手动搜索。
- en: Tip
  id: totrans-377
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: E-mail addresses of former employees can still be of use. When conducting social
    engineering attacks, directing information requests to a former employee usually
    results in a redirect that gives the attacker the "credibility" of having dealt
    with the previous employee. In addition, many organizations do not properly terminate
    employee accounts, and it is possible that these credentials may still give access
    to the target system.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 前员工的电子邮件地址仍然可能有用。在进行社会工程攻击时，将信息请求引导到前员工通常会导致重定向，使攻击者获得与之前员工打交道的“可信度”。此外，许多组织未能正确终止员工帐户，这些凭据可能仍然可以访问目标系统。
- en: Gathering names and e-mail addresses
  id: totrans-379
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 收集姓名和电子邮件地址
- en: The `theharvester` tool is a Python script that searches through popular search
    engines and other sites for e-mail addresses, hosts, and subdomains.
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: '`theharvester` 工具是一个 Python 脚本，通过流行的搜索引擎和其他网站搜索电子邮件地址、主机和子域。'
- en: 'Using `theharvester` is relatively simple as there are only a few command switches
    to set. The options available are:'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `theharvester` 相对简单，因为只有几个命令开关需要设置。可用的选项包括：
- en: '`-d`: This identifies the domain to be searched; usually the domain or target''s
    website.'
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-d`：这标识要搜索的域；通常是域或目标网站。'
- en: '`- b`: This identifies the source for extracting the data; it must be one of
    the following:'
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`- b`：这标识提取数据的来源；必须是以下之一：'
- en: Bing, BingAPI, Google, Google-Profiles, Jigsaw, LinkedIn, People123, PGP, or
    All
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 必应、BingAPI、谷歌、谷歌-配置文件、Jigsaw、LinkedIn、People123、PGP 或全部
- en: '`- l`: This limit option instructs `theharvester` to only harvest data from
    a specified number of returned search results.'
  id: totrans-385
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`- l`：此限制选项指示 `theharvester` 仅从返回的搜索结果中收集指定数量的数据。'
- en: '`-f`: This option is used to save the final results to an HTML and an XML file.
    If this option is omitted, the results will be displayed on the screen and not
    saved.'
  id: totrans-386
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`-f`：此选项用于将最终结果保存到 HTML 和 XML 文件中。如果省略此选项，结果将显示在屏幕上而不保存。'
- en: 'The following screenshot shows the results of a simple search of the Google
    indexes for the domain [digitaldefence.ca](http://digitaldefence.ca):'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了对 [digitaldefence.ca](http://digitaldefence.ca) 域的谷歌索引进行简单搜索的结果：
- en: '![Gathering names and e-mail addresses](img/3121OS_02_08.jpg)'
  id: totrans-388
  prefs: []
  type: TYPE_IMG
  zh: '![收集姓名和电子邮件地址](img/3121OS_02_08.jpg)'
- en: Gathering document metadata
  id: totrans-389
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 收集文档元数据
- en: 'Document metadata refers to the information that is appended to documents so
    that applications can manage them during the creation and storage processes. Examples
    of metadata typically attached to documents include the following:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 文档元数据是指附加到文档中的信息，以便应用程序在创建和存储过程中对其进行管理。通常附加到文档的元数据示例包括以下内容：
- en: The company or person who owns the application used to create the document
  id: totrans-391
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建文档的计算机网络上的位置
- en: The name of the document's author
  id: totrans-392
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文档的作者姓名
- en: The time and date that the document was created
  id: totrans-393
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文档创建的时间和日期
- en: The date when the file was last printed or modified; in some cases, it will
    identify who made the modifications
  id: totrans-394
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文件最后打印或修改的日期；在某些情况下，它将确定谁进行了修改
- en: The location on the computer network where the document was created
  id: totrans-395
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建文档的计算机网络上的位置
- en: Some files, especially those created by cameras or mobile devices, may include
    geographic tags that identify where the image was created
  id: totrans-396
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 某些文件，特别是由相机或移动设备创建的文件，可能包含地理标记，用于标识图像创建的位置
- en: Metadata is not immediately visible to the end user, so most documents are published
    with the metadata intact. Unfortunately, this data leakage can reveal information
    that can be used by a tester or attacker to facilitate an attack. At a minimum,
    testers and attackers can harvest user names by comparing them to data in documents;
    they can identify persons associated with particular data types, such as annual
    financial reports or strategic planning.
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 元数据对最终用户不是立即可见的，因此大多数文档都以元数据完整的形式发布。不幸的是，这种数据泄漏可能会透露出可以被测试人员或攻击者用来促成攻击的信息。至少，测试人员和攻击者可以通过将其与文档中的数据进行比较来收集用户名；他们可以识别与特定数据类型相关联的人，例如年度财务报告或战略规划。
- en: As mobile devices become more common, the risks associated with geographical
    metadata have increased. Attackers look for locations (cottages, hotels, and restaurants
    that are frequently visited) as sites that may allow them to launch attacks against
    users who have let their guard down outside the corporate perimeter. For example,
    if an employee of the target organization regularly posts pictures to a social
    media website while waiting for a commuter train, an attacker may target that
    employee for a physical attack (theft of the mobile device), wireless attack,
    or even peek over the victim's shoulder to note the username and password.
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 随着移动设备变得更加普遍，与地理元数据相关的风险也在增加。攻击者寻找经常访问的地点（度假屋、酒店和餐馆），这些地点可能使他们能够针对在公司边界之外放松警惕的用户发动攻击。例如，如果目标组织的员工经常在社交媒体网站上发布等待通勤火车的照片，攻击者可能会针对该员工进行实体攻击（盗窃移动设备）、无线攻击，甚至偷看受害者的用户名和密码。
- en: 'On Kali, the tool `Metagoofil` performs a Google search to identify and download
    a target website''s documents (doc, docx, pdf, pptx, xls, and xlsx) and extract
    usernames, a software version, path storage names, and a server, or workstation
    names, as shown in the following screenshot:'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Kali 上，工具 `Metagoofil` 执行谷歌搜索，以识别并下载目标网站的文档（doc、docx、pdf、pptx、xls 和 xlsx），并提取用户名、软件版本、路径存储名称以及服务器或工作站名称，如下图所示：
- en: '![Gathering document metadata](img/3121OS_02_11.jpg)'
  id: totrans-400
  prefs: []
  type: TYPE_IMG
  zh: '![收集文档元数据](img/3121OS_02_11.jpg)'
- en: '`Metagoofil` downloads the specified number of documents to a temporary folder,
    and extracts and organizes the relevant metadata. It also performs this function
    against files that have previously been downloaded and are now stored locally.'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: '`Metagoofil`将指定数量的文档下载到临时文件夹，并提取和整理相关的元数据。它还针对先前下载并现在存储在本地的文件执行此功能。'
- en: 'One of the first returns of `Metagoofil` is a list of the users that are found.
    The following is a screenshot of a truncated list:'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: '`Metagoofil`的第一个返回之一是找到的用户列表。以下是一个截断列表的截图：'
- en: '![Gathering document metadata](img/3121OS_02_12.jpg)'
  id: totrans-403
  prefs: []
  type: TYPE_IMG
  zh: '![收集文档元数据](img/3121OS_02_12.jpg)'
- en: '`Metagoofil` also identifies servers and pathnames of the documents. If certain
    documents of interest are localized with a particular user (for example, drafts
    of financial reports found on an administrative assistant''s workstation), that
    system can be targeted later during testing, as shown in the following screenshot:'
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: '`Metagoofil`还识别文档的服务器和路径名。如果某些感兴趣的文档是与特定用户定位的（例如，在行政助理的工作站上找到的财务报告草稿），那么该系统可以在测试期间稍后被定位为目标，如下图所示：'
- en: '![Gathering document metadata](img/3121OS_02_13.jpg)'
  id: totrans-405
  prefs: []
  type: TYPE_IMG
  zh: '![收集文档元数据](img/3121OS_02_13.jpg)'
- en: Profiling users for password lists
  id: totrans-406
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为密码列表对用户进行个人资料分析
- en: So far, you have learned to use passive reconnaissance to collect names and
    biographical information for users of the target being tested; this is the same
    process used by hackers. The next step is to use this information to create password
    lists specific to the users and the target.
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您已经学会了使用被动侦察来收集目标测试用户的姓名和生物信息；这是黑客使用的相同过程。下一步是使用这些信息来创建特定于用户和目标的密码列表。
- en: Lists of commonly used passwords are available for download, and are stored
    locally on Kali in the `/usr/share/wordlists` directory. These lists reflect the
    choices of a large population of users, and it can be time consuming for an application
    to attempt to use each possible password before moving on to the next password
    in the queue.
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 常用密码列表可供下载，并存储在Kali的`/usr/share/wordlists`目录中。这些列表反映了大量用户的选择，对于应用程序在移动到队列中的下一个密码之前尝试使用每个可能的密码可能需要很长时间。
- en: 'Fortunately, **Common User Password Profiler** (**CUPP**) allows the tester
    to generate a `wordlist` that is specific to a particular user. CUPP was present
    on Backtrack 5r3; however, it will have to be downloaded for use on Kali. To obtain
    CUPP, enter the following command:'
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，**常用用户密码分析器**（**CUPP**）允许测试人员生成特定于特定用户的`wordlist`。CUPP在Backtrack 5r3上存在；但是，在Kali上使用时需要下载。要获取CUPP，请输入以下命令：
- en: '[PRE13]'
  id: totrans-410
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This will download CUPP to the local directory.
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 这将下载CUPP到本地目录。
- en: 'CUPP is a Python script, and can be simply invoked from the CUPP directory
    by entering the following command:'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: CUPP是一个Python脚本，可以通过在CUPP目录中输入以下命令来简单地调用：
- en: '[PRE14]'
  id: totrans-413
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'This will launch CUPP in the interactive mode, which prompts the user for specific
    elements of information to use in creating `wordlist`. An example is shown in
    the following screenshot:'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 这将在交互模式下启动CUPP，提示用户使用特定信息元素来创建`wordlist`。以下是一个示例截图：
- en: '![Profiling users for password lists](img/3121OS_02_14.jpg)'
  id: totrans-415
  prefs: []
  type: TYPE_IMG
  zh: '![为密码列表对用户进行个人资料分析](img/3121OS_02_14.jpg)'
- en: When the interactive mode has completed creating `wordlist`, it is placed in
    the CUPP directory.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 当交互模式完成创建`wordlist`时，它将放置在CUPP目录中。
- en: Summary
  id: totrans-417
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: The first real step in the attack process or kill chain is to conduct reconnaissance
    to identify the target and potential attack routes. Passive reconnaissance assesses
    data that is publicly available. This is a stealthy assessment—the IP address
    or activities of the attacker are almost indistinguishable from normal access.
    Nevertheless, this information can be critical when conducting social engineering
    attacks, or facilitating other attack types.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击过程或杀链的第一步是进行侦察，以识别目标和潜在的攻击路径。被动侦察评估公开可用的数据。这是一种隐秘的评估——攻击者的IP地址或活动几乎无法与正常访问区分开。然而，当进行社会工程攻击或促进其他攻击类型时，这些信息可能是至关重要的。
- en: In the next chapter, we will assess the types of reconnaissance that are more
    active. Although these techniques produce more information, there is an increased
    risk of detection. Therefore, the emphasis will be on advanced stealth techniques.
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将评估更积极的侦察类型。尽管这些技术产生了更多的信息，但检测风险增加了。因此，重点将放在高级隐身技术上。
- en: Chapter 3. Active Reconnaissance and Vulnerability Scanning
  id: totrans-420
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第3章。积极侦察和漏洞扫描
- en: The objective of the reconnaissance phase is to gather as much information about
    the target as possible in order to facilitate the exploitation phase of the kill
    chain.
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察阶段的目标是尽可能多地收集有关目标的信息，以便促进杀链的利用阶段。
- en: We have seen how passive reconnaissance, which is almost undetectable, can yield
    a significant amount of information about the target organization and its users.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经看到，几乎不可检测的被动侦察可以为目标组织及其用户提供大量信息。
- en: Active reconnaissance builds on the results of open-source intelligence and
    passive reconnaissance, and focuses on using probes to identify the path to the
    target and the exposed *attack surface* of the target. In general, complex systems
    have a greater attack surface, and each surface may be exploited and then leveraged
    to support additional attacks.
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 主动侦察建立在开源情报和被动侦察的结果之上，重点是使用探针来识别目标的路径和目标的暴露*攻击面*。一般来说，复杂的系统具有更大的攻击面，每个攻击面都可能被利用，然后被用来支持额外的攻击。
- en: 'Although active reconnaissance produces more information, and more useful information,
    interactions with the target system may be logged, triggering alarms by protective
    devices, such as firewalls and intrusion detection systems. As the usefulness
    of the data to the attacker increases, so does the risk of detection; this is
    shown in the following diagram:'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管主动侦察可以产生更多信息，更有用的信息，但与目标系统的交互可能会被记录，从而触发防护设备（如防火墙和入侵检测系统）的警报。随着数据对攻击者的有用性增加，被发现的风险也会增加；这在下图中有所体现：
- en: '![Active Reconnaissance and Vulnerability Scanning](img/3121OS_03_01.jpg)'
  id: totrans-425
  prefs: []
  type: TYPE_IMG
  zh: '![主动侦察和漏洞扫描](img/3121OS_03_01.jpg)'
- en: To improve the effectiveness of active reconnaissance in providing detailed
    information, our focus will be on using stealthy, or difficult to detect, techniques.
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高主动侦察在提供详细信息方面的效果，我们的重点将放在使用隐秘或难以检测的技术上。
- en: 'In this chapter, you will learn:'
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习：
- en: Stealth scanning strategies
  id: totrans-428
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 隐身扫描策略
- en: Network infrastructure, host discovery, and enumeration
  id: totrans-429
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络基础设施、主机发现和枚举
- en: Comprehensive reconnaissance applications, especially `recon-ng`
  id: totrans-430
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 全面的侦察应用，特别是`recon-ng`
- en: Targeted vulnerability scanning
  id: totrans-431
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有针对性的漏洞扫描
- en: Stealth scanning strategies
  id: totrans-432
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 隐身扫描策略
- en: The greatest risk of active reconnaissance is the discovery by the target. Using
    the tester's time and data stamps, the source IP address, and additional information,
    the target can identify the source of the incoming reconnaissance. Therefore,
    stealth techniques are employed to minimize the chances of detection.
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: 主动侦察的最大风险是被目标发现。使用测试人员的时间和数据戳、源IP地址和其他信息，目标可以确定传入侦察的来源。因此，采用隐身技术以最小化被发现的机会。
- en: 'When employing stealth to support reconnaissance, a tester mimicking the actions
    of a hacker will do the following:'
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用隐身支持侦察时，模拟黑客行为的测试人员将执行以下操作：
- en: Camouflage tool signatures to avoid detection and triggering an alarm
  id: totrans-435
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 伪装工具签名以避免被检测和触发警报
- en: Hide the attack within legitimate traffic
  id: totrans-436
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在合法流量中隐藏攻击
- en: Modify the attack to hide the source and type of traffic
  id: totrans-437
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 修改攻击以隐藏流量的来源和类型
- en: Make the attack invisible using nonstandard traffic types or encryption
  id: totrans-438
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用非标准流量类型或加密使攻击不可见
- en: 'Stealth scanning techniques can include some or all of the following:'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 隐身扫描技术可以包括以下一些或全部内容：
- en: Adjusting source IP stack and tool identification settings
  id: totrans-440
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整源IP堆栈和工具识别设置
- en: Modifying packet parameters (`nmap`)
  id: totrans-441
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 修改数据包参数（`nmap`）
- en: Using proxies with anonymity networks (ProxyChains and Tor network)
  id: totrans-442
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用匿名网络的代理（ProxyChains和Tor网络）
- en: Adjusting source IP stack and tool identification settings
  id: totrans-443
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调整源IP堆栈和工具识别设置
- en: Before the penetration tester (or the attacker) begins testing, it must ensure
    that all unnecessary services on Kali are disabled or turned off.
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 在渗透测试人员（或攻击者）开始测试之前，必须确保Kali上的所有不必要的服务都已禁用或关闭。
- en: For example, if the local DHCP daemon is enabled and is not required, it is
    possible for the DHCP to interact with the target system, which could be logged
    and send alarms to the target's administrators.
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果本地DHCP守护程序已启用且不需要，则可能会导致DHCP与目标系统交互，这可能会被记录并发送警报给目标的管理员。
- en: 'Most testers also disable IPv6 from running on the testing system. This will
    stop IPv6 from announcing your presence on the target network and ensure that
    all traffic is first routed through an IPv4 socks proxy. Disabling IPv6 can be
    accomplished by editing the `/etc/sysctl.conf` file to include the following lines:'
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数测试人员还会禁用在测试系统上运行的IPv6。这将阻止IPv6在目标网络上宣布您的存在，并确保所有流量首先通过IPv4代理路由。禁用IPv6可以通过编辑`/etc/sysctl.conf`文件来实现，其中包括以下行：
- en: '[PRE15]'
  id: totrans-447
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Some commercial and open source tools (for example, the Metasploit Framework)
    tag their packets with an identifying sequence. Although this can be useful in
    post-test analysis of a system's event logs (where events initiated by a particular
    testing tool can be directly compared to a system's event logs to determine how
    the network detected and responded to the attack), it can also trigger certain
    intrusion detection systems. Test your tools against a lab system to determine
    the packets that are tagged, and either change the tag, or use the tool with caution.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 一些商业和开源工具（例如Metasploit Framework）会对其数据包进行标记。尽管这在系统事件日志的后期分析中可能会有用（可以直接将特定测试工具发起的事件与系统事件日志进行比较，以确定网络如何检测和响应攻击），但也可能触发某些入侵检测系统。测试您的工具以确定哪些数据包被标记，并更改标记，或谨慎使用该工具。
- en: The easiest way to identify tagging is to apply the tool against a newly-created
    virtual image as the target, and review system logs for the tool's name. In addition,
    use Wireshark to capture traffic between the attacker and target virtual machines,
    and then search the **packet capture** (**pcap**) files for the any keywords that
    can be attributed to the testing tool (name of the tool, vendor, license number,
    and so on).
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 识别标记的最简单方法是将工具应用于新创建的虚拟镜像作为目标，并查看工具名称的系统日志。此外，使用Wireshark捕获攻击者和目标虚拟机之间的流量，然后搜索**数据包捕获**（**pcap**）文件以查找可以归因于测试工具的任何关键字（工具名称、供应商、许可证号等）。
- en: 'The `UserAgent` in the Metasploit Framework can be changed by modifying the
    `http_form_field` option. From the msfconsole prompt, select the option to use
    `auxiliary/fuzzers/http/http_form_field`, and then set a new useragent, as shown
    in the following screenshot:'
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit Framework中的`UserAgent`可以通过修改`http_form_field`选项来更改。从msfconsole提示符中，选择使用`auxiliary/fuzzers/http/http_form_field`选项，然后设置一个新的用户代理，如下图所示：
- en: '![Adjusting source IP stack and tool identification settings](img/3121OS_03_02.jpg)'
  id: totrans-451
  prefs: []
  type: TYPE_IMG
  zh: '![调整源IP堆栈和工具识别设置](img/3121OS_03_02.jpg)'
- en: In this example, `UserAgent` was set to be Google's indexing spider, the Googlebot.
    This is a common automated application that visits and indexes websites, and rarely
    attracts attention by the website's owner.
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，`UserAgent` 被设置为Google的索引蜘蛛，Googlebot。这是一个常见的自动应用程序，用于访问和索引网站，并且很少会引起网站所有者的注意。
- en: Note
  id: totrans-453
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: To identify legitimate `UserAgents`, refer to the examples at [www.useragentstring.com](http://www.useragentstring.com).
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: 要识别合法的`UserAgents`，请参考[www.useragentstring.com](http://www.useragentstring.com)上的示例。
- en: Modifying packet parameters
  id: totrans-455
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 修改数据包参数
- en: The most common approach to active reconnaissance is to conduct a scan against
    the target—send defined packets to the target, and then use the returned packets
    to gain information. The most popular tool of this type is **Network Mapper**
    (**n** **map**).
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: 主动侦察的最常见方法是对目标进行扫描——向目标发送定义的数据包，然后使用返回的数据包获取信息。这种类型的最流行工具是**网络映射器**（**nmap**）。
- en: To use `nmap` effectively, it must be run with root-level privileges. This is
    typical of applications that manipulate packets, which is why Kali defaults to
    root at the time of startup.
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 要有效使用`nmap`，必须以root级别权限运行。这是操纵数据包的应用程序的典型特征，这也是为什么Kali在启动时默认为root的原因。
- en: 'When attempting to minimize detection, some stealth techniques to avoid detection
    and subsequent alarms include the following:'
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 在尝试最小化检测时，一些隐秘技术以避免检测和随后的警报包括以下内容：
- en: Identify the goal of the scan before testing and send the minimum number of
    packets needed to determine the objective. For example, if you wish to confirm
    the presence of a web host, you first need to determine if `port 80` , the default
    port for web-based services, is open.
  id: totrans-459
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在测试之前确定扫描的目标，并发送最少数量的数据包以确定目标。例如，如果您希望确认Web主机的存在，首先需要确定端口80是否开放，这是用于基于Web的服务的默认端口。
- en: Avoid scans that may connect with the target system and leak data. Do not ping
    the target or use synchronize (SYN) and nonconventional packet scans, such as
    acknowledge (ACK), finished (FIN), and reset (RST) packets.
  id: totrans-460
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 避免可能连接到目标系统并泄露数据的扫描。不要对目标进行ping操作，也不要使用同步（SYN）和非常规数据包扫描，如确认（ACK）、完成（FIN）和重置（RST）数据包。
- en: Randomize or spoof packet settings, such as the source IP and port address,
    and the MAC address.
  id: totrans-461
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机化或欺骗数据包设置，如源IP和端口地址以及MAC地址。
- en: Adjust the timing to slow the arrival of packets at the target site.
  id: totrans-462
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整时间以减慢数据包到达目标站点的速度。
- en: Change the packet size by fragmenting packets or appending random data to confuse
    packet inspection devices.
  id: totrans-463
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过对数据包进行分片或附加随机数据来改变数据包大小，以混淆数据包检查设备。
- en: 'For example, if you want to conduct a stealthy scan and minimize detection,
    the following `nmap` command could be used:'
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您想进行隐秘扫描并最小化检测，可以使用以下`nmap`命令：
- en: '[PRE16]'
  id: totrans-465
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The following table explains the previous command in detail:'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格详细解释了上一个命令：
- en: '| Command | Rationale |'
  id: totrans-467
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 原因 |'
- en: '| --- | --- |'
  id: totrans-468
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `--spoof-mac-Cisco` | Spoofs the MAC address to match a Cisco product. Replacing
    `Cisco` with `0` will create a completely random MAC address. |'
  id: totrans-469
  prefs: []
  type: TYPE_TB
  zh: '| `--spoof-mac-Cisco` | 伪装MAC地址以匹配思科产品。将`Cisco`替换为`0`将创建一个完全随机的MAC地址。'
- en: '| `--data-length 24` | Appends twenty-four random bytes to most packets that
    are sent. |'
  id: totrans-470
  prefs: []
  type: TYPE_TB
  zh: '| `--data-length 24` | 在发送的大多数数据包中附加二十四个随机字节。'
- en: '| `-T paranoid` | Sets the time to the slowest setting—`paranoid`. |'
  id: totrans-471
  prefs: []
  type: TYPE_TB
  zh: '| `-T paranoid` | 将时间设置为最慢的设置——`paranoid`。'
- en: '| `-- max-hostgroup` | Limits the hosts that are scanned at a time. |'
  id: totrans-472
  prefs: []
  type: TYPE_TB
  zh: '| `-- max-hostgroup` | 限制同时扫描的主机数量。'
- en: '| `-- max-parallelism` | Limits the number of outstanding probes that are sent
    out. You can also use the `--scan-delay` option to set a pause between the probes;
    however, this option is not compatible with the `--max_parallelism` option. |'
  id: totrans-473
  prefs: []
  type: TYPE_TB
  zh: '| `-- max-parallelism` | 限制发送的未完成探测的数量。您还可以使用`--scan-delay`选项设置探测之间的暂停；但是，此选项与`--max_parallelism`选项不兼容。'
- en: '| `-PN` | Does not ping to identify active systems (this can leak data). |'
  id: totrans-474
  prefs: []
  type: TYPE_TB
  zh: '| `-PN` | 不进行ping以识别活动系统（这可能会泄需数据）。'
- en: '| `-f` | Fragments the packets; this will frequently fool low-end and improperly
    configured IDs. |'
  id: totrans-475
  prefs: []
  type: TYPE_TB
  zh: '| `-f` | 对数据包进行分片；这通常会欺骗低端和配置不当的IDS。'
- en: '| `-D 10.1.20.5, RND:5,ME` | Creates decoy scans to run simultaneously with
    the attacker''s scans; hides the actual attack. |'
  id: totrans-476
  prefs: []
  type: TYPE_TB
  zh: '| `-D 10.1.20.5, RND:5,ME` | 创建伪装扫描，与攻击者的扫描同时运行；隐藏实际攻击。'
- en: '| `-n` | No DNS resolution; internal or external DNS servers are not actively
    queried by nmap for DNS information. Such queries are frequently logged, so the
    query function should be disabled. |'
  id: totrans-477
  prefs: []
  type: TYPE_TB
  zh: '| `-n` | 不进行DNS解析；nmap不会主动查询内部或外部DNS服务器以获取DNS信息。此类查询经常被记录，因此应禁用查询功能。 |'
- en: '| `-sS` | Conducts a stealth TCP SYN scan, which does not complete the TCP
    handshake. Other scan types (for example, Null scans) can also be used; however,
    most of these will trigger detection devices. |'
  id: totrans-478
  prefs: []
  type: TYPE_TB
  zh: '| `-sS` | 进行隐秘的TCP SYN扫描，不完成TCP握手。也可以使用其他扫描类型（例如Null扫描）；然而，这些大多数会触发检测设备。'
- en: '| `-sV` | Enables version detection. |'
  id: totrans-479
  prefs: []
  type: TYPE_TB
  zh: '| `-sV` | 启用版本检测。 |'
- en: '| `-oA /desktop/pentest/nmap` | Outputs the results to all formats (normal,
    greppable, and XML). |'
  id: totrans-480
  prefs: []
  type: TYPE_TB
  zh: '| `-oA /desktop/pentest/nmap` | 输出结果到所有格式（普通、可搜索和XML）。'
- en: '| `-p T:1-1024` | Specifies the TCP ports to be scanned. |'
  id: totrans-481
  prefs: []
  type: TYPE_TB
  zh: '| `-p T:1-1024` | 指定要扫描的TCP端口。 |'
- en: '| `-- random-hosts` | Randomizes the target host order. |'
  id: totrans-482
  prefs: []
  type: TYPE_TB
  zh: '| `-- random-hosts` | 随机化目标主机顺序。'
- en: Together, these options will create a very slow scan that hides the true identity
    of the source. However, if the packets are too unusual, complex modification may
    actually attract the attention of the target; therefore, many testers and attackers
    use anonymity networks to minimize detection.
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 这些选项将创建一个隐藏源真实身份的非常缓慢的扫描。然而，如果数据包太不寻常，复杂的修改实际上可能会引起目标的注意；因此，许多测试人员和攻击者使用匿名网络来最小化检测。
- en: Using proxies with anonymity networks (Tor and Privoxy)
  id: totrans-484
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用匿名网络（Tor和Privoxy）的代理
- en: '**Tor** ([www.torproject.org](http://www.torproject.org)) is an open source
    implementation of the third generation onion routing that provides free access
    to an anonymous proxy network. Onion routing enables online anonymity by encrypting
    user traffic and then transmitting it through a series of onion routers. At each
    router, a layer of encryption is removed to obtain routing information, and the
    message is then transmitted to the next node. It has been likened to the process
    of gradually peeling an onion, hence the name. It protects against traffic analysis
    attacks by guarding the source and destination of a user''s IP traffic.'
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: '**Tor** ([www.torproject.org](http://www.torproject.org))是第三代洋葱路由的开源实现，提供免费访问匿名代理网络。洋葱路由通过加密用户流量然后通过一系列洋葱路由器传输来实现在线匿名。在每个路由器处，会移除一层加密以获取路由信息，然后将消息传输到下一个节点。它被比喻为逐渐剥离洋葱的过程，因此得名。它通过保护用户IP流量的源和目的地来防范流量分析攻击。'
- en: In this example, Tor will be used with Privoxy, a noncaching web proxy that
    *sits* in the middle of an application that communicates with the Internet, and
    uses advanced filtering to ensure privacy and remove ads and potentially hostile
    data being sent to the tester.
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，Tor将与Privoxy一起使用，Privoxy是一个非缓存的Web代理，*位于*与互联网通信的应用程序中间，并使用高级过滤来确保隐私并删除发送给测试人员的广告和潜在的敌对数据。
- en: 'To install Tor, perform the following steps:'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装Tor，请执行以下步骤：
- en: 'Issue the `apt-get update` and `apt-get upgrade` commands, and then use the
    following command:'
  id: totrans-488
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发出`apt-get update`和`apt-get upgrade`命令，然后使用以下命令：
- en: '[PRE17]'
  id: totrans-489
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Once Tor is installed, edit the `Proxychains.conf` file located in the `/etc`
    directory.
  id: totrans-490
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装Tor后，编辑位于`/etc`目录中的`Proxychains.conf`文件。
- en: 'This file dictates the number and order of proxies that the test system will
    use on the way to the Tor network. proxy servers may be down, or they may be experiencing
    a heavy load (causing slow or latent connections); if this occurs, a defined or
    strict proxychain will fail because an expected link is missing. Therefore, disable
    the use of `strict_chains` and enable `dynamic_chains`, which ensures that the
    connection will be routed, as shown in the following screenshot:'
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
  zh: 该文件规定了测试系统在通往Tor网络的途中将使用的代理的数量和顺序。代理服务器可能宕机，或者可能正在经历严重负载（导致连接缓慢或延迟）；如果发生这种情况，定义或严格的proxychain将失败，因为缺少预期的链接。因此，禁用`strict_chains`的使用，并启用`dynamic_chains`，以确保连接将被路由，如下面的屏幕截图所示：
- en: '![Using proxies with anonymity networks (Tor and Privoxy)](img/3121OS_03_03.jpg)'
  id: totrans-492
  prefs: []
  type: TYPE_IMG
  zh: '![使用匿名网络（Tor和Privoxy）的代理](img/3121OS_03_03.jpg)'
- en: Next, edit the `[ProxyList]` section to ensure that the `socks5` proxy is present,
    as shown in the following screenshot:![Using proxies with anonymity networks (Tor
    and Privoxy)](img/3121OS_03_04.jpg)
  id: totrans-493
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，编辑`[ProxyList]`部分，确保`socks5`代理存在，如下面的屏幕截图所示：![使用匿名网络（Tor和Privoxy）的代理](img/3121OS_03_04.jpg)
- en: Open proxies can be easily found online and added to the `proxychains` file.
    Testers can take advantage of this to further obfuscate their identity. For example,
    if there are reports that a certain country or block of IP addresses has been
    responsible for recent online attacks, look for open proxies from that location
    and add them to your list, or a separate configuration file.
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在网上轻松找到开放代理并将其添加到`proxychains`文件中。测试人员可以利用这一点进一步混淆他们的身份。例如，如果有报告称某个国家或一系列IP地址最近负责在线攻击，可以在该位置寻找开放代理并将其添加到您的列表或单独的配置文件中。
- en: 'To start the Tor service from a terminal window, enter the following command:'
  id: totrans-495
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要从终端窗口启动Tor服务，请输入以下命令：
- en: '[PRE18]'
  id: totrans-496
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Verify that Tor has started by using the following command:'
  id: totrans-497
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令验证Tor是否已启动：
- en: '[PRE19]'
  id: totrans-498
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'It is important to verify that the Tor network is working and providing anonymous
    connectivity. Verify your source IP address first. From a terminal, enter the
    following command:'
  id: totrans-499
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证Tor网络是否正常工作并提供匿名连接非常重要。首先验证您的源IP地址。从终端输入以下命令：
- en: '[PRE20]'
  id: totrans-500
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'This will start the Iceweasel browser and open it to a site that provides the
    source IP address connected with that web page. Note the IP address, and then
    invoke Tor routing using the following `proxychains` command:'
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 这将启动Iceweasel浏览器，并打开一个网站，该网站提供与该网页连接的源IP地址。注意IP地址，然后使用以下`proxychains`命令调用Tor路由：
- en: '[PRE21]'
  id: totrans-502
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'In this particular instance, the IP address was identified as `96.47.226.60`.
    A `whois` lookup of that IP address from a terminal window indicates that the
    transmission is now exiting from a Tor exit node, as shown in the following screenshot:'
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种特定情况下，IP地址被识别为`96.47.226.60`。从终端窗口对该IP地址进行`whois`查找表明，传输现在正在从Tor出口节点退出，如下面的屏幕截图所示：
- en: '![Using proxies with anonymity networks (Tor and Privoxy)](img/3121OS_03_05.jpg)'
  id: totrans-504
  prefs: []
  type: TYPE_IMG
  zh: '![使用匿名网络（Tor和Privoxy）的代理](img/3121OS_03_05.jpg)'
- en: You can also verify that Tor is functioning properly by accessing [https://check.torproject.org](https://check.torproject.org).
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以通过访问[https://check.torproject.org](https://check.torproject.org)来验证Tor是否正常运行。
- en: Although communications are now protected using the Tor network, it is possible
    for a DNS leak, which occurs when your system makes a DNS request to provide your
    identity to an ISP. You can check for DNS leaks at [www.dnsleaktest.com](http://www.dnsleaktest.com).
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管通信现在受到Tor网络的保护，但可能会发生DNS泄漏，当您的系统发出DNS请求以向ISP提供您的身份时就会发生。您可以在[www.dnsleaktest.com](http://www.dnsleaktest.com)上检查DNS泄漏。
- en: When you test for a DNS leak, Kali's configuration of proxychains responds with
    a default source IP address of a **Level 3 Communications** server located in
    the **United States**, as shown in the following screenshot. This provides additional
    protection for the tester's identity.
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 当您测试DNS泄漏时，Kali的proxychains配置会以**美国**的**Level 3 Communications**服务器的默认源IP地址作出响应，如下面的屏幕截图所示。这为测试人员的身份提供了额外的保护。
- en: '![Using proxies with anonymity networks (Tor and Privoxy)](img/3121OS_03_06.jpg)'
  id: totrans-508
  prefs: []
  type: TYPE_IMG
  zh: '![使用匿名网络（Tor和Privoxy）的代理](img/3121OS_03_06.jpg)'
- en: Most command lines can be run from the console using `proxychains` to access
    the Tor network.
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数命令行可以使用`proxychains`从控制台运行以访问Tor网络。
- en: 'When using Tor, some considerations to be kept in mind are as follows:'
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Tor时，需要牢记以下一些考虑事项：
- en: Tor provides an anonymizing service, but it does not guarantee privacy. Owners
    of the exit nodes are able to sniff traffic, and reportedly may be able to access
    user credentials.
  id: totrans-511
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tor提供了匿名服务，但并不保证隐私。出口节点的所有者能够嗅探流量，并据报道可能能够访问用户凭据。
- en: Vulnerabilities in the Tor Browser Bundle have reportedly been used by law enforcement
    to exploit systems and gain user information.
  id: totrans-512
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 据报道，Tor浏览器捆绑包中的漏洞曾被执法部门用来利用系统并获取用户信息。
- en: ProxyChains does not handle UDP traffic.
  id: totrans-513
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ProxyChains无法处理UDP流量。
- en: Some applications and services cannot run over this environment—in particular,
    Metasploit and `nmap` may break. The stealth SYN scan of `nmap` breaks out of
    proxychains and the connect scan is invoked instead; this can leak information
    to the target.
  id: totrans-514
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些应用程序和服务无法在这种环境下运行，特别是Metasploit和`nmap`可能会出错。`nmap`的隐秘SYN扫描会打破proxychains，并且会调用连接扫描；这可能会向目标泄露信息。
- en: Some browser applications (ActiveX, Adobe's PDF applications, Flash, Java, RealPlay,
    and QuickTime) can be used to obtain your IP address.
  id: totrans-515
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些浏览器应用程序（ActiveX、Adobe的PDF应用程序、Flash、Java、RealPlay和QuickTime）可以用来获取您的IP地址。
- en: Ensure that you clear and block cookies before browsing.
  id: totrans-516
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保在浏览之前清除和阻止cookie。
- en: Tip
  id: totrans-517
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The Tor-Buddy script allows you to control how frequently the Tor IP address
    is refreshed, automatically making it more difficult to identify the user's information
    ([http://sourceforge.net/projects/linuxscripts/files/Tor-Buddy/](http://sourceforge.net/projects/linuxscripts/files/Tor-Buddy/)).
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: Tor-Buddy脚本允许您控制Tor IP地址刷新的频率，自动使识别用户信息更加困难（[http://sourceforge.net/projects/linuxscripts/files/Tor-Buddy/](http://sourceforge.net/projects/linuxscripts/files/Tor-Buddy/)）。
- en: Identifying the network infrastructure
  id: totrans-519
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 识别网络基础设施
- en: Once the tester's identity is protected, identifying the devices on the Internet-accessible
    portion of the network is the next critical first step in scanning a network.
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦测试人员的身份得到保护，识别互联网可访问部分网络上的设备是扫描网络的下一个关键的第一步。
- en: 'Attackers and penetration testers use this information to do the following:'
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者和渗透测试人员利用这些信息进行以下操作：
- en: Identify devices that may confuse (load balancers) or eliminate (firewalls and
    packet inspection devices) test results
  id: totrans-522
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别可能混淆（负载均衡器）或消除（防火墙和数据包检查设备）测试结果的设备
- en: Identify devices with known vulnerabilities
  id: totrans-523
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别已知漏洞的设备
- en: Identify the requirement for continuing to implement *stealthy* scans
  id: totrans-524
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别继续实施*隐秘*扫描的要求
- en: Gain an understanding of the target's focus on secure architecture and on security
    in general
  id: totrans-525
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 了解目标对安全架构和安全性的关注
- en: '`traceroute` provides basic information on packet filtering abilities; some
    other applications on Kali include the following:'
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: '`traceroute`提供有关数据包过滤能力的基本信息；Kali上的其他一些应用程序包括以下内容：'
- en: '| Application | Description |'
  id: totrans-527
  prefs: []
  type: TYPE_TB
  zh: '| 应用 | 描述 |'
- en: '| --- | --- |'
  id: totrans-528
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| lbd | Uses two DNS- and HTTP-based techniques to detect load balancers (shown
    in the following screenshot) |'
  id: totrans-529
  prefs: []
  type: TYPE_TB
  zh: '| lbd | 使用两种基于DNS和HTTP的技术来检测负载均衡器（如下图所示） |'
- en: '| miranda.py | Identifies universal plug-and-play and UPNP devices |'
  id: totrans-530
  prefs: []
  type: TYPE_TB
  zh: '| miranda.py | 识别通用即插即用和UPNP设备 |'
- en: '| `nmap` | Detects devices and determines the operating systems and their version
    |'
  id: totrans-531
  prefs: []
  type: TYPE_TB
  zh: '| `nmap` | 检测设备并确定其操作系统及版本 |'
- en: '| SHODAN | Web-based search engine that identifies devices connected to the
    Internet, including those with default passwords, known misconfigurations, and
    vulnerabilities |'
  id: totrans-532
  prefs: []
  type: TYPE_TB
  zh: '| SHODAN | 基于Web的搜索引擎，可识别连接到互联网的设备，包括具有默认密码、已知配置错误和漏洞的设备 |'
- en: The following screenshot shows the results obtained on running the `lbd` script
    against Google; as you can see, Google uses both `DNS-Loadbalancing` as well as
    `HTTP-Loadbalancing` on its site. From a penetration tester's perspective, this
    information could be used to explain why spurious results are obtained, as the
    load balancer shifts a particular tool's activity from one server to another.
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
  zh: 以下屏幕截图显示了针对Google运行`lbd`脚本所获得的结果；正如您所看到的，Google在其网站上既使用了`DNS负载平衡`，也使用了`HTTP负载平衡`。从渗透测试人员的角度来看，这些信息可以用来解释为什么会得到虚假的结果，因为负载均衡器将特定工具的活动从一个服务器转移到另一个服务器。
- en: '![Identifying the network infrastructure](img/3121OS_03_07.jpg)'
  id: totrans-534
  prefs: []
  type: TYPE_IMG
  zh: '![识别网络基础设施](img/3121OS_03_07.jpg)'
- en: Enumerating hosts
  id: totrans-535
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 枚举主机
- en: Host enumeration is the process of gaining specific particulars regarding a
    defined host. It is not enough to know that a server or wireless access point
    is present; instead, we need to expand the attack surface by identifying open
    ports, the base operating system, services that are running, and supporting applications.
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: 主机枚举是获取有关特定主机的具体细节的过程。仅仅知道服务器或无线接入点存在是不够的；相反，我们需要通过识别开放端口、基本操作系统、正在运行的服务和支持应用程序来扩大攻击面。
- en: This is highly intrusive and unless care is taken, the active reconnaissance
    will be detected and logged by the target organization.
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: 这是非常侵入性的，除非小心，主动侦察将被目标组织检测并记录。
- en: Live host discovery
  id: totrans-538
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 活动主机发现
- en: The first step is to run network ping sweeps against a target address space
    and look for responses that indicate that a particular target is live and capable
    of responding. Historically, pinging referred to the use of ICMP; however, TCP,
    UDP, ICMP, and ARP traffic can also be used to identify live hosts.
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是对目标地址空间运行网络ping扫描，并寻找指示特定目标是活动的并且能够响应的响应。在历史上，ping是指使用ICMP；然而，TCP、UDP、ICMP和ARP流量也可以用来识别活动主机。
- en: 'Various scanners can be run from remote locations across the Internet to identify
    live hosts. Although the primary scanner is `nmap`, Kali provides several other
    applications that are also useful, as shown in the following table:'
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
  zh: 可以从互联网的远程位置运行各种扫描程序，以识别活动主机。尽管主要扫描程序是`nmap`，但Kali还提供了其他几个同样有用的应用程序，如下表所示：
- en: '| Application | Description |'
  id: totrans-541
  prefs: []
  type: TYPE_TB
  zh: '| 应用 | 描述 |'
- en: '| --- | --- |'
  id: totrans-542
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `alive6` and `detect-new-ip6` | IPv6 host detection. `detect-new-ip6` runs
    on a scripted basis and identifies new IPv6 devices when added. |'
  id: totrans-543
  prefs: []
  type: TYPE_TB
  zh: '| `alive6` 和 `detect-new-ip6` | IPv6主机检测。`detect-new-ip6`定期运行并在添加新的IPv6设备时进行识别。|'
- en: '| `dnmap` and `nmap` | `nmap` is the standard network enumeration tool.`dnmap`
    is a distributed client-server implementation of the `nmap` scanner.PBNJ stores
    `nmap` results in a database, and then conducts historical analyses to identify
    new hosts. |'
  id: totrans-544
  prefs: []
  type: TYPE_TB
  zh: '| `dnmap`和`nmap` | `nmap`是标准的网络枚举工具。`dnmap`是`nmap`扫描器的分布式客户端-服务器实现。PBNJ将`nmap`结果存储在数据库中，然后进行历史分析以识别新主机。|'
- en: '| `fping`, `hping2`, `hping3`, and `nping` | Packet crafters that respond to
    targets in various ways to identify live hosts |'
  id: totrans-545
  prefs: []
  type: TYPE_TB
  zh: '| `fping`、`hping2`、`hping3`和`nping` | 响应目标以不同方式识别活动主机的数据包生成器 |'
- en: To the penetration tester or attacker, the data returned from live host discovery
    will identify the targets for attack.
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 对于渗透测试人员或攻击者来说，从活动主机发现返回的数据将确定攻击目标。
- en: Tip
  id: totrans-547
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Run multiple host discovery scans while conducting a penetration test. Certain
    devices may be time dependent. During one penetration test, it was discovered
    that the system administrator set up a game server after regular business hours.
    Because it was not an approved business system, the administrator did not follow
    the normal process for securing the server; multiple vulnerable services were
    present, and it had not received necessary security patches. Testers were able
    to compromise the game server and gain access to the underlying corporate network
    using vulnerabilities in the administrator's game server.
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行渗透测试时运行多个主机发现扫描。某些设备可能是时间相关的。在一次渗透测试中，发现系统管理员在正常工作时间之后设置了一个游戏服务器。因为它不是一个经过批准的业务系统，管理员没有按照正常的流程来保护服务器；存在多个易受攻击的服务，并且没有接收到必要的安全补丁。测试人员能够攻破游戏服务器并利用管理员游戏服务器中的漏洞访问底层企业网络。
- en: Port, operating system, and service discovery
  id: totrans-549
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 端口、操作系统和服务发现
- en: Kali provides several different tools useful for identifying open ports, operating
    systems, and installed services on remote hosts. The majority of these functions
    can be completed using `nmap`. Although we will focus on examples using `nmap`,
    the underlying principles apply to the other tools as well.
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: Kali提供了几种有用于识别远程主机上开放端口、操作系统和已安装服务的不同工具。大多数这些功能可以使用`nmap`完成。虽然我们将重点关注使用`nmap`的示例，但基本原则也适用于其他工具。
- en: Port scanning
  id: totrans-551
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 端口扫描
- en: Port scanning is the process of connecting to TCP and UDP ports to determine
    what services and applications are running on the target device. There are 65,535
    ports each for both TCP and UDP on each system. Some ports are known to be associated
    with particular services (TCP 20 and 21 are the usual ports for the **file transfer
    protocol** service (**FTP**)). The first 1,024 are the well-known ports, and most
    defined services run over ports in this range; accepted services and ports are
    maintained by IANA ([http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml](http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)).
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 端口扫描是连接到TCP和UDP端口以确定目标设备上运行的服务和应用程序的过程。每个系统上TCP和UDP都有65,535个端口。一些端口已知与特定服务相关联（TCP
    20和21是**文件传输协议**服务（**FTP**）的通常端口）。前1024个是众所周知的端口，大多数定义的服务都在这个范围内运行；接受的服务和端口由IANA维护（[http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml](http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)）。
- en: Tip
  id: totrans-553
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Although there are accepted ports for particular services, such as port 80 for
    web-based traffic, services can be directed to use *any* port. This option is
    frequently used to hide particular services, particularly if the service is known
    to be vulnerable to attack. However, if attackers complete a port scan and do
    not find an expected service, or find it using an unusual port, they will be prompted
    to investigate further.
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管特定服务有接受的端口，比如端口80用于基于网络的流量，服务可以被指定使用*任何*端口。这个选项经常被用来隐藏特定服务，特别是如果该服务已知容易受到攻击。然而，如果攻击者完成了端口扫描却没有找到预期的服务，或者发现它使用了不寻常的端口，他们将被促使进一步调查。
- en: The universal port mapping tool, `nmap`, relies on active stack fingerprinting.
    Specially crafted packets are sent to the target system, and the response of the
    OS to those packets allows `nmap` to identify the OS. In order for `nmap` to work,
    at least one listening port must be open, and the operating system must be known
    and fingerprinted, with a copy of that fingerprint in the local database.
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
  zh: 通用端口映射工具`nmap`依赖于主动堆栈指纹识别。特制的数据包被发送到目标系统，操作系统对这些数据包的响应允许`nmap`识别操作系统。为了让`nmap`工作，至少一个监听端口必须是开放的，并且操作系统必须是已知的并且有指纹，该指纹的副本在本地数据库中。
- en: 'Using `nmap` for port discovery is very *noisy*—it will be detected and logged
    by network security devices. Some points to remember are as follows:'
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`nmap`进行端口发现非常*嘈杂*——它将被网络安全设备检测并记录。需要记住的一些要点如下：
- en: Attackers and penetration testers focused on stealth will test only the ports
    that impact the kill chain they are following to their specific target. If they
    are launching an attack that exploits vulnerabilities in a web server, they will
    search for targets with `port 80` or `port 8080` accessible.
  id: totrans-557
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 专注于隐秘的攻击者和渗透测试人员只会测试对他们特定目标的杀伤链产生影响的端口。如果他们发起的攻击利用了Web服务器的漏洞，他们将寻找可访问`端口80`或`端口8080`的目标。
- en: Most port scanners have default lists of ports that are scanned—ensure that
    you know what is on that list and what has been omitted. Consider both TCP and
    UDP ports.
  id: totrans-558
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 大多数端口扫描器都有默认的端口列表进行扫描——确保你知道列表上有什么，以及有什么被省略了。考虑TCP和UDP端口。
- en: Successful scanning requires a deep knowledge of TCP/IP and related protocols,
    networking, and how particular tools work. For example, SCTP is an increasingly
    common protocol on networks, but it is rarely tested on corporate networks.
  id: totrans-559
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 成功的扫描需要对TCP/IP和相关协议、网络以及特定工具的工作原理有深入的了解。例如，SCTP是网络上越来越常见的协议，但在企业网络上很少被测试。
- en: Port scanning, even when done slowly, can impact a network. Some older network
    equipment and equipment from specific vendors will lock when receiving or transmitting
    a port scan, thus turning a scan into a denial of service attack.
  id: totrans-560
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口扫描，即使速度较慢，也会对网络产生影响。一些较旧的网络设备和特定厂商的设备在接收或传输端口扫描时会被锁定，从而将扫描变成拒绝服务攻击。
- en: Tools used to scan a port, particularly `nmap`, are being extended with regards
    to functionalities. They can also be used to detect vulnerabilities and exploit
    simple security holes.
  id: totrans-561
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于扫描端口的工具，特别是`nmap`，正在扩展功能。它们还可以用于检测漏洞并利用简单的安全漏洞。
- en: Fingerprinting the operating system
  id: totrans-562
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 指纹识别操作系统
- en: 'Determining the operating system of a remote system is conducted using two
    types of scans:'
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
  zh: 确定远程系统的操作系统使用两种类型的扫描：
- en: '**Active fingerprinting**: The attacker sends normal and malformed packets
    to the target and records its response pattern, referred to as the *fingerprint*.
    By comparing the fingerprint to a local database, the operating system can be
    determined.'
  id: totrans-564
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主动指纹识别**：攻击者向目标发送正常和畸形的数据包，并记录其响应模式，称为*指纹*。通过将指纹与本地数据库进行比较，可以确定操作系统。'
- en: '**Passive fingerprinting**: The attacker *sniffs*, or records and analyses
    the packet stream to determine the characteristics of the packets.'
  id: totrans-565
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 被动指纹识别：攻击者*嗅探*，或记录和分析数据包流以确定数据包的特征。
- en: Active fingerprinting is faster and more accurate than passive fingerprinting.
    In Kali, the two primary active tools are `nmap` and `xprobe2`.
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: 主动指纹识别比被动指纹识别更快更准确。在Kali中，两个主要的主动工具是`nmap`和`xprobe2`。
- en: The `nmap` tool injects packets into the target network and analyses the response
    that it receives. In the following screenshot, the `-O` flag commands `nmap` to
    determine the operating system. Because it injects the packet into the target,
    the accuracy of the determination of the operating system by `nmap` is based on
    the number of open ports. It is usually effective at differentiating Windows from
    Unix systems, but it may not provide very specific information, such as differentiating
    between various Unix kernels. The following screenshot shows results from an `nmap`
    scan of a Windows system. Only a few ports on the target system are available
    for testing, so it cannot differentiate between Windows 7 enterprise and Windows
    XP sp3
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
  zh: '`nmap`工具向目标网络注入数据包并分析其接收到的响应。在下面的屏幕截图中，`-O`标志命令`nmap`确定操作系统。因为它向目标注入数据包，所以`nmap`对操作系统的确定的准确性取决于开放端口的数量。它通常有效地区分Windows和Unix系统，但可能不提供非常具体的信息，比如区分各种Unix内核。下面的屏幕截图显示了对Windows系统进行`nmap`扫描的结果。目标系统上只有少数端口可用于测试，因此无法区分Windows
    7企业版和Windows XP sp3。'
- en: '![Fingerprinting the operating system](img/3121OS_03_08.jpg)'
  id: totrans-568
  prefs: []
  type: TYPE_IMG
  zh: '![指纹识别操作系统](img/3121OS_03_08.jpg)'
- en: A related program, `xprobe2`, uses different TCP, UDP, and ICMP packets to bypass
    firewalls and avoid detection by IDS/IPS systems. `xprobe2` also uses fuzzy pattern
    matching—the operating system is not identified as definitely being one type;
    instead, it is assigned the probability of being one of several possible variants.
    As you can see in the following screenshot, this allows the tester to test vulnerabilities
    that are specific to the operating system variants; this specificity increases
    the chances of success and minimizes the risks that can occur when an exploit
    is attempted with the wrong tool.
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: 相关程序`xprobe2`使用不同的TCP、UDP和ICMP数据包来绕过防火墙，并避免被IDS/IPS系统检测到。`xprobe2`还使用模糊模式匹配——操作系统不被确定为某一类型；而是被分配为可能是几种可能的变体之一的概率。正如您在下面的屏幕截图中所看到的，这使测试人员能够测试特定于操作系统变体的漏洞；这种特异性增加了成功的机会，并最大程度地减少了在尝试使用错误的工具进行利用时可能发生的风险。
- en: '![Fingerprinting the operating system](img/3121OS_03_09.jpg)'
  id: totrans-570
  prefs: []
  type: TYPE_IMG
  zh: '![指纹识别操作系统](img/3121OS_03_09.jpg)'
- en: Note that it is simple for the target system to hide the true operating system.
    Since fingerprinting software relies on packet setting, such as time-to-live or
    the initial windows size, changes to these values or other user-configurable settings
    can change the tool results. Some organizations actively change these values to
    make the final stages of reconnaissance more difficult.
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，目标系统很容易隐藏真实的操作系统。由于指纹识别软件依赖于数据包设置，如生存时间或初始窗口大小，对这些值或其他用户可配置的设置的更改可能会改变工具的结果。一些组织积极改变这些值，以使侦察的最后阶段更加困难。
- en: Determining active services
  id: totrans-572
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确定活动服务
- en: The final goal of the enumeration portion of reconnaissance is to identify the
    services and applications that are operational on the target system. If possible,
    the attacker would want to know the service type, vendor, and version to facilitate
    the identification of any vulnerability.
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察的枚举部分的最终目标是确定目标系统上正在运行的服务和应用程序。如果可能的话，攻击者希望知道服务类型、供应商和版本，以便于识别任何漏洞。
- en: 'The following are some of the several techniques used to determine active services:'
  id: totrans-574
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是用于确定活动服务的一些技术：
- en: '**Identify default ports and services**: If the remote system is identified
    as having a Microsoft operating system with `port 80` open (the WWW service),
    an attacker may assume that a default installation of Microsoft IIS is installed.
    Additional testing will be used to verify this assumption (`nmap`).'
  id: totrans-575
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**识别默认端口和服务**：如果远程系统被识别为具有Microsoft操作系统并且开放了`端口80`（WWW服务），攻击者可能会假定安装了默认的Microsoft
    IIS。将使用其他测试来验证这一假设（`nmap`）。'
- en: '**Banner grabbing**: This is done using tools such as amap, netcat, `nmap`,
    and Telnet.'
  id: totrans-576
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**横幅抓取**：使用amap、netcat、`nmap`和Telnet等工具进行。'
- en: '**Review default web pages**: Some applications install with default administration,
    error, or other pages. If attackers access these, they will provide guidance on
    installed applications that may be vulnerable to attack. In the following screenshot,
    the attacker can easily identify the version of Apache Tomcat that has been installed
    on the target system.![Determining active services](img/3121OS_03_10.jpg)'
  id: totrans-577
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**审查默认网页**：一些应用程序安装了默认的管理、错误或其他页面。如果攻击者访问这些页面，它们将提供有关可能易受攻击的已安装应用程序的指导。在下面的屏幕截图中，攻击者可以轻松地识别已安装在目标系统上的Apache
    Tomcat的版本。![确定活动服务](img/3121OS_03_10.jpg)'
- en: '**Review source code**: Poorly configured web-based applications may respond
    to certain HTTP requests such as `HEAD` or `OPTIONS` with a response that includes
    the web server software version, and possibly, the base operating system or the
    scripting environment in use. In the following screenshot, netcat is launched
    from the command line and used to send raw `HEAD` packets to a particular website.
    This request generates an error message (**404 not found**); however, it also
    identifies that the server is running Microsoft IIS, Version 7.5.![Determining
    active services](img/3121OS_03_11.jpg)'
  id: totrans-578
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**审查源代码**：配置不良的基于Web的应用程序可能会对某些HTTP请求（如`HEAD`或`OPTIONS`）做出响应，其中包括Web服务器软件版本，可能还包括基本操作系统或正在使用的脚本环境。在下面的屏幕截图中，netcat从命令行启动，并用于向特定网站发送原始`HEAD`数据包。这个请求生成了一个错误消息（**404未找到**）；然而，它也确定了服务器正在运行Microsoft
    IIS，版本7.5。![确定活动服务](img/3121OS_03_11.jpg)'
- en: Employing comprehensive reconnaissance applications
  id: totrans-579
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用全面的侦察应用程序
- en: Although Kali contains multiple tools to facilitate reconnaissance, many of
    the tools contain features that overlap, and importing data from one tool into
    another is usually a complex manual process. Most testers select a subset of tools
    and invoke them with a script.
  id: totrans-580
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Kali包含多个工具来促进侦察，但许多工具具有重叠的功能，并且从一个工具导入数据到另一个工具通常是一个复杂的手动过程。大多数测试人员选择一部分工具，并使用脚本调用它们。
- en: Comprehensive tools focused on reconnaissance were originally command-line tools
    with a defined set of functions; one of the most commonly used was **Deepmagic
    Information Gathering Too**l (**DMitry**). DMitry could perform `whois` lookups,
    retrieve netcraft.com information, search for subdomains and e-mail addresses,
    and perform TCP scans. Unfortunately, it was not extensible beyond these functions.
  id: totrans-581
  prefs: []
  type: TYPE_NORMAL
  zh: 最初是具有一组定义功能的命令行工具的综合工具，其中最常用的是**Deepmagic信息收集工具**（**DMitry**）。DMitry可以执行`whois`查找、检索netcraft.com信息、搜索子域和电子邮件地址，并执行TCP扫描。不幸的是，它在这些功能之外无法扩展。
- en: Recent advances have created comprehensive framework applications that combine
    passive and active reconnaissance; we'll review `nmap`, `recon-ng`, and `maltego`.
  id: totrans-582
  prefs: []
  type: TYPE_NORMAL
  zh: 最近的进展已经创造了综合的框架应用程序，结合了被动和主动侦察；我们将审查`nmap`，`recon-ng`和`maltego`。
- en: nmap
  id: totrans-583
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: nmap
- en: Traditionally, `nmap` was perceived as a simple mapping tool that provided data
    on host and port availability, as well as some additional data such as the probable
    operating system of target devices.
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，`nmap`被认为是一个简单的映射工具，提供有关主机和端口可用性的数据，以及一些其他数据，如目标设备的可能操作系统。
- en: The **Nmap Scripting Engine** (**NSE**) has transformed `nmap` into a tool that
    can conduct passive and active reconnaissance, and even perform basic vulnerability
    scanning (a full list of scripts is available at [http://nmap.org/nsedoc/](http://nmap.org/nsedoc/)).
  id: totrans-585
  prefs: []
  type: TYPE_NORMAL
  zh: '**Nmap脚本引擎**（**NSE**）已将`nmap`转变为一个可以进行被动和主动侦察，甚至进行基本漏洞扫描的工具（完整的脚本列表可在[http://nmap.org/nsedoc/](http://nmap.org/nsedoc/)找到）。'
- en: 'Because scripts are written in the Lua scripting language, it is easy for the
    penetration testing community to modify and release scripts. Presently, scripted
    functions include the following:'
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: 因为脚本是用Lua脚本语言编写的，所以渗透测试社区很容易修改和发布脚本。目前，脚本化功能包括以下内容：
- en: Reconnaissance of IPv4 and IPv6 DNS data
  id: totrans-587
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IPv4和IPv6 DNS数据的侦察
- en: Identifying the presence of web application firewalls, IDS, IPS, and other protective
    controls
  id: totrans-588
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别Web应用程序防火墙、IDS、IPS和其他防护控制的存在
- en: Testing the firewall rulesets (via firewalk) and attempting to bypass the firewall
  id: totrans-589
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试防火墙规则集（通过firewalk）并尝试绕过防火墙
- en: Harvesting user names from target and online sites
  id: totrans-590
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从目标和在线站点收集用户名
- en: Brute-force guessing of passwords against a variety of services and applications
  id: totrans-591
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 针对各种服务和应用程序进行密码暴力破解
- en: Crawling the target network to identify network shares
  id: totrans-592
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 爬取目标网络以识别网络共享
- en: Extracting of EXIF metadata from images in a defined website
  id: totrans-593
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从指定网站的图像中提取EXIF元数据
- en: Geographical localization of IP addresses
  id: totrans-594
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IP地址的地理定位
- en: Conducting network attacks such as IPv6 packet flooding
  id: totrans-595
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进行网络攻击，如IPv6数据包洪泛
- en: Vulnerability scanning, including fuzzing and SQL injection testing
  id: totrans-596
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞扫描，包括模糊测试和SQL注入测试
- en: As you can see, the ability to script `nmap` activities using an extensible
    language such as Lua has increased the importance of this tool.
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所看到的，使用Lua等可扩展语言对`nmap`活动进行脚本编写的能力增加了这个工具的重要性。
- en: A useful script is Marc Ruef's **vulscan** ([http://www.computec.ch/mruef/software/nmap_nse_vulscan-1.0.tar.gz](http://www.computec.ch/mruef/software/nmap_nse_vulscan-1.0.tar.gz)),
    which combines the fingerprinting feature of `nmap` (using the `–sV` flag) with
    lookups against major vulnerabilities, such as MITRE, OSVDB, and SecurityFocus.
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: 一个有用的脚本是Marc Ruef的**vulscan**（[http://www.computec.ch/mruef/software/nmap_nse_vulscan-1.0.tar.gz](http://www.computec.ch/mruef/software/nmap_nse_vulscan-1.0.tar.gz)），它结合了`nmap`的指纹特性（使用`-sV`标志）与对主要漏洞的查找，如MITRE、OSVDB和SecurityFocus。
- en: Once you have downloaded the script package, untar the file and move the script
    files to `usr/share/nmap/scripts`.
  id: totrans-599
  prefs: []
  type: TYPE_NORMAL
  zh: 下载脚本包后，解压文件并将脚本文件移动到`usr/share/nmap/scripts`。
- en: 'To invoke one of the scripts from the command line, use the `--script` flag,
    and then identify the script name. One script that is frequently used is `nmap`''s
    general vulnerability scanner, launched using the following command:'
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: 要从命令行调用其中一个脚本，请使用`--script`标志，然后识别脚本名称。经常使用的一个脚本是`nmap`的通用漏洞扫描程序，使用以下命令启动：
- en: '[PRE22]'
  id: totrans-601
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'In this particular case, the vulnerability scan did not identify any vulnerabilities
    with known exploits, as shown in the following screenshot:'
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种特殊情况下，漏洞扫描未发现任何已知漏洞的漏洞，如下面的屏幕截图所示：
- en: '![nmap](img/3121OS_03_12.jpg)'
  id: totrans-603
  prefs: []
  type: TYPE_IMG
  zh: '![nmap](img/3121OS_03_12.jpg)'
- en: Tip
  id: totrans-604
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: A must-have script is the SpiderLabs script to screenshot web services. It requires
    the **wkhtmltoimage** tool to be downloaded ([http://wkhtmltopdf.googlecode.com](http://wkhtmltopdf.googlecode.com))
    and placed in the `/usr/local/bin` folder. The screenshot script itself should
    then be downloaded ([https://github.com/SpiderLabs/Nmap-Tools/blob/master/NSE/http-screenshot.nse](https://github.com/SpiderLabs/Nmap-Tools/blob/master/NSE/http-screenshot.nse))
    and placed in `/usr/local/share/nmap/scripts`. When invoked, this script produces
    a visual record of all the identified web services, making it easier to select
    a target for testing later.
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
  zh: 必备脚本是SpiderLabs脚本，用于截取网络服务的屏幕截图。它需要下载**wkhtmltoimage**工具（[http://wkhtmltopdf.googlecode.com](http://wkhtmltopdf.googlecode.com)）并放置在`/usr/local/bin`文件夹中。然后应下载屏幕截图脚本本身（[https://github.com/SpiderLabs/Nmap-Tools/blob/master/NSE/http-screenshot.nse](https://github.com/SpiderLabs/Nmap-Tools/blob/master/NSE/http-screenshot.nse)）并放置在`/usr/local/share/nmap/scripts`中。当调用时，此脚本会生成所有已识别的网络服务的视觉记录，从而更容易选择以后进行测试的目标。
- en: The recon-ng framework
  id: totrans-606
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: recon-ng框架
- en: The `recon-ng` framework is an open source framework for conducting reconnaissance
    (passive and active).
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: '`recon-ng`框架是用于进行侦察（被动和主动）的开源框架。'
- en: Like the Metasploit Framework and Social Engineer Toolkit, `recon-ng` uses a
    modular framework. Each module is a customized *cmd* interpreter, preconfigured
    to perform a specific task.
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
  zh: 与Metasploit Framework和Social Engineer Toolkit一样，`recon-ng`使用模块化框架。每个模块都是一个定制的*cmd*解释器，预先配置以执行特定任务。
- en: The `recon-ng` framework and its modules are written in Python, allowing penetration
    testers to easily build or alter modules to facilitate testing.
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: '`recon-ng`框架及其模块均以Python编写，允许渗透测试人员轻松构建或更改模块以便进行测试。'
- en: The `recon-ng` tool leverages third-party APIs to conduct some assessments;
    this additional flexibility means that some activities undertaken by `recon-ng`
    may be tracked by those parties. Users can specify a custom `UserAgent` string
    or proxy requests to minimize alerting the target network.
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: '`recon-ng`工具利用第三方API进行一些评估；这种额外的灵活性意味着`recon-ng`进行的一些活动可能会被这些方面跟踪。用户可以指定自定义的`UserAgent`字符串或代理请求以最小化警报目标网络。'
- en: All data collected by `recon-ng` is placed in a database, allowing you to create
    various reports against the stored data. The user can select one of the report
    modules to automatically create either a CVS report, or an HTML report.
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: '`recon-ng`收集的所有数据都存储在数据库中，允许您针对存储的数据创建各种报告。用户可以选择报告模块之一自动生成CVS报告或HTML报告。'
- en: 'To use recon, perform the following steps:'
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用recon，执行以下步骤：
- en: 'If `recon-ng` is not installed on your version of Kali, use the following command:'
  id: totrans-613
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的Kali版本上没有安装`recon-ng`，请使用以下命令：
- en: '[PRE23]'
  id: totrans-614
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: To start the application, enter `recon-ng` at the prompt as shown in the following
    screenshot. The start screen will indicate the number of modules present, and
    the help command will show the commands available for navigation.![The recon-ng
    framework](img/3121OS_03_13.jpg)
  id: totrans-615
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要启动应用程序，请在提示符下输入`recon-ng`，如下面的屏幕截图所示。启动屏幕将指示模块的数量，并且帮助命令将显示可用于导航的命令。![The recon-ng
    framework](img/3121OS_03_13.jpg)
- en: To show the available modules, type `show` at the `recon-ng>` prompt. To load
    a specific module, type `load` followed by the name of the module. Hitting the
    tab key while typing will autocomplete the command. If the module has a unique
    name, you can type in the unique part of the name, and the module will be loaded
    without entering the full path.
  id: totrans-616
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要显示可用的模块，请在`recon-ng>`提示符下键入`show`。要加载特定模块，请键入`load`，然后输入模块的名称。在输入时按Tab键将自动完成命令。如果模块有唯一的名称，您可以输入名称的唯一部分，模块将加载而无需输入完整路径。
- en: Entering `info`, as shown in the following screenshot, will provide you with
    information on how the module works, and where to obtain API keys if required.
  id: totrans-617
  prefs: []
  type: TYPE_NORMAL
  zh: 输入`info`，如下面的屏幕截图所示，将为您提供有关模块如何工作以及如何获取API密钥（如果需要）的信息。
- en: '![The recon-ng framework](img/3121OS_03_14.jpg)'
  id: totrans-618
  prefs: []
  type: TYPE_IMG
  zh: '![The recon-ng framework](img/3121OS_03_14.jpg)'
- en: Once the module is loaded, use the `set` command to set the options, and then
    enter `run` to execute, as shown in the following screenshot:![The recon-ng framework](img/3121OS_03_15.jpg)
  id: totrans-619
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载模块后，使用`set`命令设置选项，然后输入`run`执行，如下面的屏幕截图所示：![The recon-ng framework](img/3121OS_03_15.jpg)
- en: 'In general, testers rely on `recon-ng` to do the following:'
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，测试人员依赖`recon-ng`来执行以下操作：
- en: Harvest contacts using `whois`, `jigsaw`, `linkedin`, and `twitter` (use the
    mangle module to extract and present e-mail data)
  id: totrans-621
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`whois`，`jigsaw`，`linkedin`和`twitter`收集联系人（使用mangle模块提取和呈现电子邮件数据）
- en: Identify hosts
  id: totrans-622
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别主机
- en: Identify geographical locations of hosts and individuals using `hostop`, `ipinfodb`,
    `maxmind`, `uniapple`, and `wigle`
  id: totrans-623
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`hostop`，`ipinfodb`，`maxmind`，`uniapple`和`wigle`识别主机和个人的地理位置
- en: Identify host information using netcraft and related modules
  id: totrans-624
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用netcraft和相关模块识别主机信息
- en: Identify account and password information that has previously been compromised
    and leaked onto the Internet (the `pwnedlist` modules, `wascompanyhacked`, `xssed`,
    and `punkspider`)
  id: totrans-625
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 识别先前已经泄露到互联网上的帐户和密码信息（`pwnedlist`模块，`wascompanyhacked`，`xssed`和`punkspider`）
- en: Maltego
  id: totrans-626
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Maltego
- en: '**Maltego** ([www.paterva.com](http://www.paterva.com)) is an open source intelligence
    and forensics application. The community version included with Kali sets limits
    on the size of searches; however, it is an excellent tool for visualizing relationships
    among data that use data mining and link analysis.'
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
  zh: '**Maltego** ([www.paterva.com](http://www.paterva.com))是一款开源情报和取证应用程序。Kali附带的社区版本对搜索的大小设置了限制；但是，它是一款用于可视化数据关系的优秀工具，使用数据挖掘和链接分析。'
- en: Maltego allows you to enumerate personal information, linking a particular person
    with a company, e-mail addresses, websites, social networking groups, and phone
    numbers. It also facilitates passive and active reconnaissance of `whois` information,
    domain names, DNS information, IP addresses, and netblocks.
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
  zh: Maltego允许您枚举个人信息，将特定人员与公司、电子邮件地址、网站、社交网络组和电话号码联系起来。它还促进了`whois`信息、域名、DNS信息、IP地址和网络块的被动和主动侦察。
- en: To open the application, enter `maltego` as a command prompt. The first time
    you open it, you will be required to register and verify your e-mail address with
    Paterva.
  id: totrans-629
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要打开应用程序，请输入`maltego`作为命令提示符。第一次打开时，您需要注册并验证您的电子邮件地址与Paterva。
- en: Once you have completed registration and updating of transforms, you will be
    presented with a multipaned GUI that allows you to examine the connections between
    various data objects, as shown in the following screenshot:![Maltego](img/3121OS_03_16.jpg)
  id: totrans-630
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成注册和转换更新后，您将看到一个多面板的GUI，允许您检查各种数据对象之间的连接，如下面的屏幕截图所示：![Maltego](img/3121OS_03_16.jpg)
- en: Maltego relies on a series of transforms or modules that are stored in a palette
    on the left-hand side of the application. Transforms are selected by picking them
    from the column on the left and then dragging them into the centre of the application.
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
  zh: Maltego依赖于存储在应用程序左侧调色板中的一系列转换或模块。通过从左侧列中选择它们，然后将它们拖到应用程序中心来选择转换。
- en: By default, the icon may be called **pantera.com** when initially selected;
    however, you can use the data manipulation areas in the right-hand column to rename
    and change data.
  id: totrans-632
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，初始选择时图标可能被称为**pantera.com**；但是，您可以使用右侧列中的数据操作区域来重命名和更改数据。
- en: 'Several different transforms exist in the community edition; these are sorted
    into several groups such as **Devices**, **Infrastructure**, **Personal**, **Locations**,
    **Penetration Testing**, and **Social Network**, as shown in the following screenshot:'
  id: totrans-633
  prefs: []
  type: TYPE_NORMAL
  zh: 社区版中存在几种不同的转换；这些被分成几个组，如**设备**，**基础设施**，**个人**，**位置**，**渗透测试**和**社交网络**，如下面的屏幕截图所示：
- en: '![Maltego](img/3121OS_03_17.jpg)'
  id: totrans-634
  prefs: []
  type: TYPE_IMG
  zh: '![Maltego](img/3121OS_03_17.jpg)'
- en: Drag the appropriate transform onto the work sheet and right-click to reveal
    the transformations that will be completed against that transform's identity.
    Keep in mind that if you select the **All** option, processing will take a significant
    amount of time.
  id: totrans-635
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将适当的转换拖到工作表上，右键单击以显示将针对该转换身份完成的转换。请记住，如果选择**全部**选项，处理将需要大量时间。
- en: The ability to analyze relationships is particularly useful in performing social
    engineering attacks. For example, if the target's website contains multiple links
    to another website, an attacker could use this relationship for a phishing attack.
  id: totrans-636
  prefs: []
  type: TYPE_NORMAL
  zh: 分析关系的能力在执行社会工程攻击时特别有用。例如，如果目标网站包含多个链接到另一个网站，攻击者可以利用这种关系进行钓鱼攻击。
- en: Vulnerability scanning
  id: totrans-637
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 漏洞扫描
- en: Vulnerability scanning employs automated processes and applications to identify
    vulnerabilities in a network, system, operating system, or application that may
    be exploitable.
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
  zh: 漏洞扫描利用自动化流程和应用程序来识别网络、系统、操作系统或应用程序中可能存在的漏洞。
- en: When performed correctly, a vulnerability scan delivers an inventory of devices
    (both authorized and *rogue* devices), known vulnerabilities that have been actively
    scanned for, and usually a confirmation of how compliant the devices are with
    various policies and regulations.
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
  zh: 当漏洞扫描正确执行时，它会提供设备清单（经授权和*流氓*设备），已经主动扫描的已知漏洞，通常还会确认设备在各种政策和法规方面的合规性。
- en: 'Unfortunately, vulnerability scans are *loud*—they deliver multiple packets
    that are easily detected by most network controls and make stealth almost impossible
    to achieve. They also suffer from the following additional limitations:'
  id: totrans-640
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，漏洞扫描是*喧闹的*——它们会传递多个数据包，大多数网络控制都很容易检测到，并且几乎不可能实现隐身。它们还存在以下额外的限制：
- en: For the most part, vulnerability scanners are signature based—they can only
    detect known vulnerabilities, and only if there is an existing recognition signature
    that the scanner can apply to the target. To a penetration tester, the most effective
    scanners are open source and allow the tester to rapidly modify code to detect
    new vulnerabilities.
  id: totrans-641
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在大多数情况下，漏洞扫描仪是基于签名的——它们只能检测已知的漏洞，只有在扫描仪可以应用于目标的现有识别签名时才能检测到。对于渗透测试人员来说，最有效的扫描仪是开源的，并允许测试人员快速修改代码以检测新的漏洞。
- en: Scanners produce large volumes of output, frequently containing false-positive
    results that can lead a tester astray; in particular, networks with different
    operating systems can produce false-positives with a rate as high as seventy percent.
  id: totrans-642
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描仪产生大量输出，经常包含可能误导测试人员的假阳性结果；特别是，具有不同操作系统的网络可能会产生高达七十％的假阳性。
- en: Scanners may have a negative impact on the network—they can create network latency
    or cause the failure of some devices (refer to the Network Scanning Watch List
    at [www.digininja.org](http://www.digininja.org), for devices known to fail as
    a result of vulnerability testing).
  id: totrans-643
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 扫描仪可能对网络产生负面影响——它们可能会导致网络延迟或导致某些设备的故障（请参阅[www.digininja.org](http://www.digininja.org)上的网络扫描观察列表，了解因漏洞测试而导致故障的设备）。
- en: In certain jurisdictions, scanning is considered as *hacking*, and may constitute
    an illegal act.
  id: totrans-644
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在某些司法管辖区，扫描被视为*黑客行为*，可能构成非法行为。
- en: There are multiple commercial and open source products that perform vulnerability
    scans. In Kali, scanning tools can be found in the **Vulnerability Analysis**
    submenu, as well as the **Web Vulnerability Scanners** menu; however, the primary
    vulnerability scanner is **Open Vulnerability Assessment System** (**OpenVAS**).
  id: totrans-645
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种商业和开源产品可以执行漏洞扫描。在Kali中，扫描工具可以在**漏洞分析**子菜单以及**Web漏洞扫描仪**菜单中找到；然而，主要的漏洞扫描仪是**开放漏洞评估系统**（**OpenVAS**）。
- en: Kali supports the installation of additional scanners. If it is decided to sacrifice
    stealth for completeness during testing, always employ at least two different
    scanners to minimize false-positive results. Recommended scanners include Nexpose
    ([www.rapid7.com](http://www.rapid7.com)) and the venerable Nessus ([www.nessus.org](http://www.nessus.org)).
  id: totrans-646
  prefs: []
  type: TYPE_NORMAL
  zh: Kali支持安装额外的扫描仪。如果决定在测试期间牺牲隐蔽性以获得完整性，始终使用至少两种不同的扫描仪来最小化误报结果。推荐的扫描仪包括Nexpose（[www.rapid7.com](http://www.rapid7.com)）和著名的Nessus（[www.nessus.org](http://www.nessus.org)）。
- en: Summary
  id: totrans-647
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: During active reconnaissance, the attackers face a very real chance of their
    activities being identified, putting them at risk. This must be balanced against
    the need to map a network, find open ports, and determine the operating system
    and applications that are installed.
  id: totrans-648
  prefs: []
  type: TYPE_NORMAL
  zh: 在主动侦察期间，攻击者面临着他们的活动被识别的真实机会，使他们面临风险。这必须与绘制网络、查找开放端口以及确定安装的操作系统和应用程序的需求进行平衡。
- en: To reduce risks, attackers must adopt stealthy scanning techniques. Manual approaches
    are used to create slow scans; however, this approach is not always effective.
    Therefore, attackers take advantage of tools such as the Tor network and various
    proxying applications to hide their identity.
  id: totrans-649
  prefs: []
  type: TYPE_NORMAL
  zh: 为了降低风险，攻击者必须采用隐蔽的扫描技术。手动方法用于创建缓慢的扫描；然而，这种方法并不总是有效的。因此，攻击者利用Tor网络和各种代理应用程序来隐藏他们的身份。
- en: In the next chapter, we will focus on analyzing the data from the reconnaissance
    stages and from other sources, and using it to plan and execute a remote exploit
    against a target network or system. We will review various attack techniques and
    tools and focus on how to ensure that the exploit cannot be detected by normal
    means. We will also examine remote exploitation as a continuous process—once you
    have compromised one target, how to leverage that success to pivot to new targets.
  id: totrans-650
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将专注于分析侦察阶段和其他来源的数据，并将其用于计划和执行针对目标网络或系统的远程利用。我们将审查各种攻击技术和工具，并专注于如何确保利用不能被正常手段检测到。我们还将研究远程利用作为一个持续的过程——一旦您成功地攻击了一个目标，如何利用这一成功来转移到新的目标。
- en: Chapter 4. Exploit
  id: totrans-651
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第4章。利用
- en: The goal of passive and active reconnaissance is to identify the exploitable
    security flaws that are most likely to support the tester's or attacker's objective
    (denial of service, theft, or modification of data). The exploit phase of the
    kill chain focuses on creating the access to achieve the objective—either stopping
    the access to a target by creating a denial of service or the more common approach
    of establishing persistent access to the target from the attacker.
  id: totrans-652
  prefs: []
  type: TYPE_NORMAL
  zh: 被动和主动侦察的目标是识别最有可能支持测试人员或攻击者目标（拒绝服务、窃取或修改数据）的可利用安全漏洞。杀链的利用阶段侧重于创建实现目标的访问——要么通过创建拒绝服务来停止对目标的访问，要么通过建立对目标的持久访问来实现更常见的方法。
- en: 'The penetration tester must be concerned with the following aspects of the
    exploit phase:'
  id: totrans-653
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员必须关注利用阶段的以下方面：
- en: Was the target fully characterized? If the attacker does not understand the
    network and host architecture of the target, the attack will fail and there will
    be an increased risk of detection.
  id: totrans-654
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 目标是否被充分描述？如果攻击者不了解目标的网络和主机架构，攻击将失败，并且被发现的风险会增加。
- en: Is the exploit well known, with defined actions on the target system? An uncharacterized
    exploit could have unintended consequences when employed and the resulting damage
    could have a negative impact on the testing process. Testers should validate all
    exploits in a known setting prior to use.
  id: totrans-655
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用是否广为人知，在目标系统上有明确定义的行动？未经描述的利用在使用时可能会产生意想不到的后果，造成的损害可能对测试过程产生负面影响。测试人员应在已知环境中验证所有利用。
- en: Is the exploit being conducted from a remote location or is it local on the
    target system? A remote exploit is safer for the attacker because the chances
    of being positively identified are lesser; however, a local exploit gives the
    attacker more control over the exploit's action and reduces the possibility of
    detection.
  id: totrans-656
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用是从远程位置进行还是在目标系统上本地进行？远程利用对攻击者更安全，因为被积极识别的机会较小；然而，本地利用给予攻击者更多对利用行动的控制，并减少了被发现的可能性。
- en: What are the required post-exploit activities? If the attacker needs to exfiltrate
    data from the target, then the exploit must support establishing an interactive
    connection.
  id: totrans-657
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 什么是所需的后利用活动？如果攻击者需要从目标中窃取数据，那么利用必须支持建立交互连接。
- en: Is persistent access to the compromised system required, or is the compromise
    going to be short term? This will drive the requirement for a stealthy approach.
  id: totrans-658
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是否需要对受损系统进行持久访问，还是妥协将是短期的？这将驱动对隐蔽方法的要求。
- en: Thousands of exploitable vulnerabilities have been identified, and most are
    associated with at least one proof-of-concept code or technique to allow the system
    to be compromised. Nevertheless, the underlying principles that govern success
    are the same across networks, operating systems, and applications.
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: 已经确定了数千个可利用的漏洞，大多数与至少一个概念验证代码或技术相关，允许系统被攻破。然而，支配成功的基本原则在网络、操作系统和应用程序中是相同的。
- en: 'In this chapter you will learn:'
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学到：
- en: Threat modeling
  id: totrans-661
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 威胁建模
- en: Using online and local vulnerability resources
  id: totrans-662
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用在线和本地漏洞资源
- en: Exploiting a remote target using the Metasploit Framework
  id: totrans-663
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Metasploit框架对远程目标进行利用
- en: Exploiting multiple targets with Armitage
  id: totrans-664
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Armitage利用多个目标
- en: Bypassing IDs and antivirus detection
  id: totrans-665
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绕过ID和防病毒检测
- en: Threat modeling
  id: totrans-666
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 威胁建模
- en: The passive and active reconnaissance phases map the target network and system
    and identify vulnerabilities that may be exploitable to achieve the attacker's
    objective. During this stage of the attacker's kill chain, there is a strong bias
    for action—testers want to immediately launch exploits and demonstrate that they
    can compromise the target. However, an unplanned attack may not be the most effective
    means of achieving the object, and it may sacrifice the stealth that is needed
    to achieve the objective of the attack.
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: 被动和主动侦察阶段绘制目标网络和系统，并确定可能可利用以实现攻击者目标的漏洞。在攻击者的杀伤链的这个阶段，行动有很强的偏见——测试人员希望立即发动攻击并证明他们可以威胁目标。然而，未经计划的攻击可能不是实现目标的最有效手段，并且可能会牺牲实现攻击目标所需的隐秘性。
- en: Penetration testers have adopted (formally or informally) a process known as
    threat modeling, which was originally developed by network planners to develop
    defensive countermeasures against an attack.
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员已经采用（正式或非正式）一种称为威胁建模的过程，最初是由网络规划者开发的，用于制定防御性对策来对抗攻击。
- en: 'Penetration testers and attackers have turned the defensive threat modeling
    methodology on its head to improve the success of an attack. Offensive threat
    modeling is a formal approach that combines the results of reconnaissance and
    research to develop an attack strategy. An attacker has to consider the available
    targets and identify the type of targets listed as follows:'
  id: totrans-669
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员和攻击者已经将防御性威胁建模方法学颠倒过来，以提高攻击的成功率。进攻性威胁建模是一种正式的方法，它结合了侦察和研究的结果，以制定攻击策略。攻击者必须考虑可用的目标，并确定以下列出的目标类型：
- en: '**Primary targets**: These targets when compromised, these targets will immediately
    support the objective.'
  id: totrans-670
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主要目标**：这些目标一旦受到威胁，就会立即支持目标。'
- en: '**Secondary targets**: These targets may provide information (security controls,
    password and logging policies, and local and domain administrator names and passwords)
    to support an attack or allow access to a primary target.'
  id: totrans-671
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**次要目标**：这些目标可能提供信息（安全控制、密码和日志策略，以及本地和域管理员的名称和密码）以支持攻击或允许访问主要目标。'
- en: '**Tertiary targets**: These targets may be unrelated to the testing or attack
    objective, but are relatively easy to compromise and may provide information or
    a distraction from the actual attack.'
  id: totrans-672
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**第三目标**：这些目标可能与测试或攻击目标无关，但相对容易受到威胁，可能提供信息或分散注意力，使攻击的实际目标。'
- en: For each target type, the tester has to determine the approach to be used. A
    single vulnerability can be attacked using stealth techniques or multiple targets
    can be attacked using a volume of attacks in order to rapidly exploit a target.
    If a large-scale attack is implemented, the noise in the defender's control devices
    will frequently cause them to minimize logging on the router and firewall or even
    fully disable them.
  id: totrans-673
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每种目标类型，测试人员必须确定要使用的方法。可以使用隐身技术攻击单个漏洞，也可以使用大量攻击来攻击多个目标，以快速利用目标。如果实施大规模攻击，防御者控制设备中的噪音通常会导致他们最小化路由器和防火墙上的日志记录，甚至完全禁用它们。
- en: 'The approach to be used will guide the selection of the exploit. Generally,
    attackers follow an attack tree methodology when creating a threat model, as shown
    in the following diagram:'
  id: totrans-674
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用的方法将指导利用的选择。通常，攻击者在创建威胁模型时遵循攻击树方法论，如下图所示：
- en: '![Threat modeling](img/3121OS_04_01.jpg)'
  id: totrans-675
  prefs: []
  type: TYPE_IMG
  zh: '![威胁建模](img/3121OS_04_01.jpg)'
- en: The attack tree approach allows the tester to easily visualize the attack options
    that are available and the alternative options that can be employed if a selected
    attack is not successful. Once an attack tree has been generated, the next step
    of the exploit phase is to identify the exploits that may be used to compromise
    vulnerabilities in the target.
  id: totrans-676
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击树方法允许测试人员轻松地可视化可用的攻击选项以及如果选择的攻击不成功可以采用的替代选项。生成攻击树后，利用阶段的下一步是确定可能用于攻击目标中的漏洞的利用。
- en: Using online and local vulnerability resources
  id: totrans-677
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用在线和本地漏洞资源
- en: Together, passive and active reconnaissance identifies the *attack surface*
    of the target, that is, the total number of points that can be assessed for vulnerabilities.
    A server with just an operating system installed can only be exploited if there
    are vulnerabilities in that particular operating system; however, the number of
    potential vulnerabilities increases with each application that is installed.
  id: totrans-678
  prefs: []
  type: TYPE_NORMAL
  zh: 被动和主动侦察共同确定了目标的*攻击面*，即可以评估漏洞的总点数。只安装操作系统的服务器只有在该特定操作系统中存在漏洞时才能被利用；然而，每安装一个应用程序，潜在漏洞的数量就会增加。
- en: Penetration testers and attackers must find the particular exploits that will
    compromise known and suspected vulnerabilities. The first place to start the search
    is at vendor sites; most hardware and application vendors release information
    about vulnerabilities when they release patches and upgrades. If an exploit for
    a particular weakness is known, most vendors will highlight this to their customers.
    Although their intent is to allow customers to test for the presence of the vulnerability
    themselves, attackers and penetration testers will take advantage of this information
    as well.
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员和攻击者必须找到可能会危及已知和疑似漏洞的特定利用。开始搜索的第一个地方是供应商网站；大多数硬件和应用程序供应商在发布补丁和升级时会发布有关漏洞的信息。如果已知某个弱点的利用，大多数供应商都会向其客户强调这一点。尽管他们的意图是允许客户自行测试漏洞的存在，但攻击者和渗透测试人员也会利用这些信息。
- en: 'Other online sites that collect, analyze, and share information about vulnerabilities
    are as follows:'
  id: totrans-680
  prefs: []
  type: TYPE_NORMAL
  zh: 收集、分析和共享有关漏洞的其他在线站点如下：
- en: The National Vulnerability Database that consolidates all public vulnerability
    data released by the US Government available at [http://web.nvd.nist.gov/view/vuln/search](http://web.nvd.nist.gov/view/vuln/search)
  id: totrans-681
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 美国政府发布的所有公共漏洞数据的国家漏洞数据库可在[http://web.nvd.nist.gov/view/vuln/search](http://web.nvd.nist.gov/view/vuln/search)上找到。
- en: Secunia available at [http://secunia.com/community/](http://secunia.com/community/)
  id: totrans-682
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Secunia可在[http://secunia.com/community/](http://secunia.com/community/)上找到。
- en: '**Open Source Vulnerability Database Project** (**OSVDP**) available at [http://www.osvdb.org/search/advsearch](http://www.osvdb.org/search/advsearch)'
  id: totrans-683
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**开放源代码漏洞数据库项目**（**OSVDP**）可在[http://www.osvdb.org/search/advsearch](http://www.osvdb.org/search/advsearch)上找到。'
- en: Packetstorm security available at [http://packetstormsecurity.com/](http://packetstormsecurity.com/)
  id: totrans-684
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Packetstorm security可在[http://packetstormsecurity.com/](http://packetstormsecurity.com/)上找到。
- en: SecurityFocus available at [http://www.securityfocus.com/vulnerabilities](http://www.securityfocus.com/vulnerabilities)
  id: totrans-685
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SecurityFocus可在[http://www.securityfocus.com/vulnerabilities](http://www.securityfocus.com/vulnerabilities)上找到。
- en: Inj3ct0r available at [http://1337day.com/](http://1337day.com/)
  id: totrans-686
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Inj3ct0r可在[http://1337day.com/](http://1337day.com/)上找到。
- en: The Exploit Database maintained by Offensive Security available at [http://www.db-exploit.com](http://www.db-exploit.com)
  id: totrans-687
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Offensive Security维护的Exploit Database可在[http://www.db-exploit.com](http://www.db-exploit.com)上找到。
- en: 'The exploit database is also copied locally to Kali and it can be found in
    the `/usr/share/exploitdb` directory. Before using it, make sure that it has been
    updated using the following command:'
  id: totrans-688
  prefs: []
  type: TYPE_NORMAL
  zh: 漏洞数据库也被复制到Kali本地，并且可以在`/usr/share/exploitdb`目录中找到。在使用之前，请确保已使用以下命令进行更新：
- en: '[PRE24]'
  id: totrans-689
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'To search the local copy of `exploitdb`, open a terminal window and enter `searchsploit`
    and the desired search term(s) in the command prompt. This will invoke a script
    that searches a database file (`.csv`) that contains a list of all exploits. The
    search will return a description of known vulnerabilities as well as the path
    to a relevant exploit. The exploit can be extracted, compiled, and run against
    specific vulnerabilities. Take a look at the following screenshot, which shows
    the description of the vulnerabilities:'
  id: totrans-690
  prefs: []
  type: TYPE_NORMAL
  zh: 要搜索`exploitdb`的本地副本，请打开终端窗口并在命令提示符中输入`searchsploit`和所需的搜索词。这将调用一个脚本，该脚本搜索包含所有漏洞利用程序列表的数据库文件（`.csv`）。搜索将返回已知漏洞的描述以及相关漏洞利用程序的路径。漏洞利用程序可以被提取、编译并针对特定漏洞运行。请看下图，显示了漏洞的描述：
- en: '![Using online and local vulnerability resources](img/3121OS_04_02.jpg)'
  id: totrans-691
  prefs: []
  type: TYPE_IMG
  zh: '![使用在线和本地漏洞资源](img/3121OS_04_02.jpg)'
- en: Tip
  id: totrans-692
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: The search script scans for each line in the CSV file from left to right, so
    the order of the search terms is important—a search for `oracle 10g` will return
    several exploits, but `10g oracle` will not return any. Also, the script is weirdly
    case sensitive; although you are instructed to use lower case characters in the
    search term, a search for `Bulletproof FTP` returns no hits, but `bulletproof
    FTP` returns seven hits, and `bulletproof ftp` returns no hits. More effective
    searches of the CSV file can be conducted using the `grep` command or a search
    tool such as KWrite (`apt-get install kwrite`).
  id: totrans-693
  prefs: []
  type: TYPE_NORMAL
  zh: 搜索脚本会从左到右扫描CSV文件的每一行，因此搜索词的顺序很重要——搜索`oracle 10g`将返回几种漏洞利用程序，但`10g oracle`将不会返回任何结果。此外，该脚本对大小写敏感；尽管您被指示在搜索词中使用小写字符，但搜索`Bulletproof
    FTP`不会返回任何结果，但`bulletproof FTP`会返回七个结果，而`bulletproof ftp`不会返回任何结果。可以使用`grep`命令或类似KWrite（`apt-get
    install kwrite`）的搜索工具更有效地搜索CSV文件。
- en: A search of the local database may identify several possible exploits with a
    description and a path listing; however, these will have to be customized to your
    environment, and then compiled prior to use. Copy the exploit to the `/tmp` directory
    (the given path does not take into account that the `/windows/remote` directory
    resides in the `/platforms` directory).
  id: totrans-694
  prefs: []
  type: TYPE_NORMAL
  zh: 本地数据库搜索可能会识别出几种可能的漏洞利用程序，并附有描述和路径列表；但是，这些都必须根据您的环境进行定制，然后再进行编译。将漏洞利用程序复制到`/tmp`目录（给定的路径没有考虑到`/windows/remote`目录位于`/platforms`目录中）。
- en: 'Exploits presented as scripts such as Perl, Ruby, and PHP are relatively easy
    to implement. For example, if the target is a Microsoft II 6.0 server that may
    be vulnerable to a WebDAV remote authentication bypass, copy the exploit to the
    root directory and then execute as a standard Perl script, as shown in the following
    screenshot:'
  id: totrans-695
  prefs: []
  type: TYPE_NORMAL
  zh: 以Perl、Ruby和PHP等脚本形式呈现的漏洞利用程序相对容易实现。例如，如果目标是可能对WebDAV远程身份验证绕过存在漏洞的Microsoft II
    6.0服务器，请将漏洞利用程序复制到根目录，然后作为标准Perl脚本执行，如下图所示：
- en: '![Using online and local vulnerability resources](img/3121OS_04_03.jpg)'
  id: totrans-696
  prefs: []
  type: TYPE_IMG
  zh: '![使用在线和本地漏洞资源](img/3121OS_04_03.jpg)'
- en: 'Many of the exploits are available as source code that must be compiled before
    use. For example, a search for RPC-specific vulnerabilities identifies several
    possible exploits. An excerpt is shown in the following screenshot:'
  id: totrans-697
  prefs: []
  type: TYPE_NORMAL
  zh: 许多漏洞利用程序都是以源代码形式提供的，必须在使用之前进行编译。例如，搜索RPC特定漏洞可能会识别出几种可能的漏洞利用程序。以下是摘录的一部分：
- en: '![Using online and local vulnerability resources](img/3121OS_04_04.jpg)'
  id: totrans-698
  prefs: []
  type: TYPE_IMG
  zh: '![使用在线和本地漏洞资源](img/3121OS_04_04.jpg)'
- en: 'The RPC DCOM vulnerability identified as `76.c` is known from practice to be
    relatively stable. So, we will use it as an example. To compile this exploit,
    copy it from the storage directory to the `/tmp` directory. In that location,
    compile using GCC with the command as follows:'
  id: totrans-699
  prefs: []
  type: TYPE_NORMAL
  zh: '`76.c`标识的RPC DCOM漏洞据实践所知相对稳定。因此，我们将以此为例。要编译此漏洞利用程序，请将其从存储目录复制到`/tmp`目录。在该位置，使用以下命令使用GCC进行编译：'
- en: '[PRE25]'
  id: totrans-700
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'This will use the GNU Compiler Collection application to compile `76.c` to
    a file with the output (`-o`) name of `76.exe`, as shown in the following screenshot:'
  id: totrans-701
  prefs: []
  type: TYPE_NORMAL
  zh: 这将使用GNU编译器集合应用程序将`76.c`编译为一个名为`76.exe`的文件，如下图所示：
- en: '![Using online and local vulnerability resources](img/3121OS_04_05.jpg)'
  id: totrans-702
  prefs: []
  type: TYPE_IMG
  zh: '![使用在线和本地漏洞资源](img/3121OS_04_05.jpg)'
- en: 'When you invoke the application against the target, you must call the executable
    (which is not stored in the `/tmp` directory) using a symbolic link as follows:'
  id: totrans-703
  prefs: []
  type: TYPE_NORMAL
  zh: 当您针对目标调用应用程序时，必须使用符号链接调用可执行文件（不存储在`/tmp`目录中），如下所示：
- en: '[PRE26]'
  id: totrans-704
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The source code for this exploit is well documented and the required parameters
    are clear at the execution, as shown in the following screenshot:'
  id: totrans-705
  prefs: []
  type: TYPE_NORMAL
  zh: 这个漏洞的源代码有很好的文档记录，并且在执行时所需的参数清晰明了，如下面的截图所示：
- en: '![Using online and local vulnerability resources](img/3121OS_04_06.jpg)'
  id: totrans-706
  prefs: []
  type: TYPE_IMG
  zh: '![使用在线和本地漏洞资源](img/3121OS_04_06.jpg)'
- en: 'Unfortunately, not all exploits from exploit database and other public sources
    compiled as readily as `76.c`. There are several issues that make the use of such
    exploits problematic, even dangerous, for penetration testers listed as follows:'
  id: totrans-707
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，并非所有来自漏洞数据库和其他公共来源的漏洞利用都像`76.c`那样容易编译。以下列出了一些问题，这些问题使得使用这些漏洞利用变得棘手，甚至对渗透测试人员来说是危险的：
- en: Deliberate errors or incomplete source code are commonly encountered as experienced
    developers attempt to keep exploits away from inexperienced users, especially
    beginners who are trying to compromise systems without knowing the risks that
    go with their actions.
  id: totrans-708
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 故意的错误或不完整的源代码经常会遇到，因为经验丰富的开发人员试图让那些不熟悉的用户，尤其是试图在不了解风险的情况下破坏系统的初学者远离漏洞利用。
- en: Exploits are not always sufficiently documented; after all, there is no standard
    that governs the creation and use of code intended to be used to compromise a
    data system. As a result, they can be difficult to use, particularly for testers
    who lack expertise in application development.
  id: totrans-709
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞利用并不总是有足够的文档记录；毕竟，没有标准来规范旨在用于破坏数据系统的代码的创建和使用。因此，它们可能难以使用，特别是对于缺乏应用开发专业知识的测试人员来说。
- en: Inconsistent behaviors due to changing environments (new patches applied to
    the target system and language variations in the target application) may require
    significant alterations to the source code; again, this may require a skilled
    developer.
  id: totrans-710
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于环境的变化（目标系统应用新的补丁和目标应用程序的语言变化）导致的不一致行为可能需要对源代码进行重大修改；同样，这可能需要一个熟练的开发人员。
- en: There is always the risk of freely available code containing malicious functionalities.
    A penetration tester may think that he is conducting a **proof of concept** (**POC**)
    exercise and will be unaware that the exploit has also created a backdoor in the
    application being tested that could be used by the developer.
  id: totrans-711
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 总是有免费可用的代码包含恶意功能的风险。渗透测试人员可能认为自己正在进行**概念验证**（**POC**）练习，并且不知道漏洞利用还在被测试的应用程序中创建了一个后门，这个后门可以被开发人员利用。
- en: To ensure consistent results and create a community of coders who follow consistent
    practices, several exploit frameworks have been developed. The most popular exploitation
    framework is the Metasploit Framework.
  id: totrans-712
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保一致的结果并创建一个遵循一致实践的编码社区，已经开发了几个漏洞利用框架。最流行的利用框架是Metasploit Framework。
- en: The Metasploit Framework
  id: totrans-713
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Metasploit Framework
- en: The **Metasploit Framework** (**MSF**) is an open source tool designed to facilitate
    penetration testing. Written in the Ruby programming language, it uses a modular
    approach to facilitating exploits. This makes it easier to develop and code exploits,
    and it also allows for complex attacks to be easily implemented.
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
  zh: '**Metasploit Framework**（**MSF**）是一个旨在促进渗透测试的开源工具。它使用Ruby编程语言编写，采用模块化方法来促进漏洞利用。这使得开发和编写漏洞利用变得更容易，也允许复杂的攻击得以轻松实施。'
- en: 'MSF can present multiple interfaces to the backend modules that control exploitation
    (console, CLI, and web). We will use the console interface for its speed, because
    it presents the attack commands, and it has the required configuration parameters
    in an easy-to-understand interface. To access this interface, enter `msfconsole`
    in a command prompt or select it from a drop-down menu such as **Top 10 Security
    Tools**. The following screenshot shows the splash screen when the application
    launches:'
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
  zh: MSF可以向控制利用的后端模块提供多个接口（控制台、CLI和Web）。我们将使用控制台接口，因为它速度快，可以显示攻击命令，并且具有易于理解的配置参数界面。要访问此界面，请在命令提示符中输入`msfconsole`，或者从下拉菜单中选择它，例如**Top
    10 Security Tools**。下面的截图显示了应用程序启动时的启动画面：
- en: '![The Metasploit Framework](img/3121OS_04_07.jpg)'
  id: totrans-716
  prefs: []
  type: TYPE_IMG
  zh: '![Metasploit Framework](img/3121OS_04_07.jpg)'
- en: 'The MSF consists of modules that are combined to affect an exploit. The modules
    and their specific functions are as follows:'
  id: totrans-717
  prefs: []
  type: TYPE_NORMAL
  zh: MSF由模块组成，这些模块结合起来影响漏洞利用。模块及其特定功能如下：
- en: '**Exploits**: The code fragments that target specific vulnerabilities. Active
    exploits will exploit a specific target, run until completed, and then exit (for
    example, a buffer overflow). Passive exploits wait for incoming hosts, such as
    web browsers or FTP clients, and exploit them when they connect.'
  id: totrans-718
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**漏洞利用**：针对特定漏洞的代码片段。主动利用将利用特定目标，运行直到完成，然后退出（例如，缓冲区溢出）。被动利用等待传入主机，例如Web浏览器或FTP客户端，并在连接时利用它们。'
- en: '**Payloads**: These are the malicious code that implement commands immediately
    following a successful exploitation.'
  id: totrans-719
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**有效载荷**：这些是在成功利用后立即执行命令的恶意代码。'
- en: '**Auxiliary modules**: These modules do not establish or directly support access
    between the tester and the target system; instead, they perform related functions
    such as scanning, fuzzing, or sniffing that support the exploitation phase.'
  id: totrans-720
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**辅助模块**：这些模块不建立或直接支持测试人员和目标系统之间的访问；相反，它们执行支持利用阶段的扫描、模糊测试或嗅探等相关功能。'
- en: '**Post modules**: Following a successful attack, these modules run on compromised
    targets to gather useful data and pivot the attacker deeper into the target network.
    We will learn more about the post modules in [Chapter 5](ch05.html "Chapter 5. Post
    Exploit – Action on the Objective"), *Post Exploit – Action on the Objective*.'
  id: totrans-721
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**后置模块**：在成功攻击后，这些模块在受损目标上运行，收集有用的数据，并将攻击者深入到目标网络中。我们将在[第5章](ch05.html "第5章。目标上的后期利用
    - 行动")中了解更多关于后置模块的信息，*目标上的后期利用 - 行动*。'
- en: '**Encoders**: When exploits must bypass antivirus defenses, these modules encode
    the payload so that it cannot be detected using signature matching techniques.'
  id: totrans-722
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**编码器**：当漏洞利用必须绕过防病毒防御时，这些模块对有效载荷进行编码，以便它不能被检测到使用签名匹配技术。'
- en: '**No operations** (**NOPs**): These are used to facilitate buffer overflows
    during attacks.'
  id: totrans-723
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**无操作**（**NOPs**）：这些用于在攻击期间促进缓冲区溢出。'
- en: 'These modules are used together to conduct reconnaissance and launch attacks
    against targets. The steps for exploiting a target system using MSF can be summarized
    as follows:'
  id: totrans-724
  prefs: []
  type: TYPE_NORMAL
  zh: 这些模块一起用于进行侦察并对目标发动攻击。使用MSF对目标系统进行利用的步骤可以总结如下：
- en: Choose and configure an exploit (the code that compromises a specific vulnerability
    on the target system).
  id: totrans-725
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择并配置利用（对目标系统上特定漏洞的代码进行利用）。
- en: Check the target system to determine if it is susceptible to attack by the exploit.
    This step is optional and is usually omitted to minimize the detection.
  id: totrans-726
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查目标系统以确定其是否容易受到利用的攻击。这一步是可选的，通常会被省略以最小化检测。
- en: Choose and configure the payload (the code that will be executed on the target
    system following a successful exploitation. For example, a reverse shell from
    the compromised system back to the source).
  id: totrans-727
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择并配置有效载荷（在成功利用后将在目标系统上执行的代码。例如，从受损系统到源系统的反向shell）。
- en: Choose an encoding technique to bypass detection controls (IDs/IPs or antivirus
    software).
  id: totrans-728
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一种编码技术来绕过检测控制（IDS/IP或防病毒软件）。
- en: Execute the exploit.
  id: totrans-729
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行利用。
- en: The next example represents a simple attack against the target Linux-based operating
    system Metasploitable2\. It is available online at [http://sourceforge.net/projects/metasploitable/files/Metasploitable2](http://sourceforge.net/projects/metasploitable/files/Metasploitable2).
    Metasploitable2 was designed to be vulnerable to attack, and it contains known
    and characterized vulnerabilities that provide a standard platform for training
    and for validating exploit tools.
  id: totrans-730
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个示例代表了针对目标Linux操作系统Metasploitable2的简单攻击。它可以在[http://sourceforge.net/projects/metasploitable/files/Metasploitable2](http://sourceforge.net/projects/metasploitable/files/Metasploitable2)上找到。Metasploitable2被设计成易受攻击，并且包含已知和特征化的漏洞，为培训和验证利用工具提供了一个标准平台。
- en: 'When installed as a virtual machine (covered in [Appendix](apa.html "Appendix A. Installing
    Kali Linux"), *Installing Kali Linux*), Metasploitable can be scanned using `nmap`,
    which identifies open ports and associated applications. An excerpt of the `nmap`
    scan is shown in the following screenshot:'
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
  zh: 当作为虚拟机安装（在[附录](apa.html "附录 A. 安装Kali Linux")中介绍，*安装Kali Linux*），Metasploitable可以使用`nmap`进行扫描，以识别开放端口和相关应用程序。以下截图显示了`nmap`扫描的摘录：
- en: '![The Metasploit Framework](img/3121OS_04_08.jpg)'
  id: totrans-732
  prefs: []
  type: TYPE_IMG
  zh: '![Metasploit框架](img/3121OS_04_08.jpg)'
- en: 'Several applications were identified by `nmap` in the preceding example. As
    a tester, we should investigate each one for any known vulnerabilities. One of
    the first places to start is, Metasploit''s own collection of exploits. This can
    be searched from the following command line using:'
  id: totrans-733
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，`nmap`识别了几个应用程序。作为测试人员，我们应该调查每个应用程序是否存在已知的漏洞。其中一个最好的起点是Metasploit自己的利用集合。可以使用以下命令行搜索：
- en: '[PRE27]'
  id: totrans-734
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'The returned exploits for the samba service are listed and each of them is
    assigned a relative ranking of how successful they are at achieving an exploit.
    The following screenshot shows an excerpt of the available samba exploits:'
  id: totrans-735
  prefs: []
  type: TYPE_NORMAL
  zh: 返回的samba服务利用被列出，并且每个利用都被分配了一个相对的排名，用于表示它们在实现利用时的成功程度。以下截图显示了可用的samba利用的摘录：
- en: '![The Metasploit Framework](img/3121OS_04_09_New.jpg)'
  id: totrans-736
  prefs: []
  type: TYPE_IMG
  zh: '![Metasploit框架](img/3121OS_04_09_New.jpg)'
- en: The `exploit/multi/samba/usermap_script` exploit was selected for use in the
    remainder of this example because it is ranked as excellent. This ranking was
    determined by the Metasploit development team and identifies how reliably the
    exploit works for a skilled tester against a stable target system. In real life,
    multiple variables (tester skills, protective devices on the network, and modifications
    to the operating system and hosted applications) can work together to significantly
    alter the reliability of the exploit.
  id: totrans-737
  prefs: []
  type: TYPE_NORMAL
  zh: '`exploit/multi/samba/usermap_script`利用被选中用于本示例的其余部分，因为它被评为优秀。这个排名是由Metasploit开发团队确定的，用于表示利用在对稳定目标系统的熟练测试人员手中的可靠程度。在现实生活中，多个变量（测试人员技能、网络上的保护设备以及操作系统和托管应用程序的修改）可以共同工作，从而显著改变利用的可靠性。'
- en: 'Additional information pertaining to that exploit was obtained using the following
    `info` command:'
  id: totrans-738
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下`info`命令获取有关该利用的其他信息：
- en: '[PRE28]'
  id: totrans-739
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'The returned information includes references as well as the information shown
    in the following screenshot:'
  id: totrans-740
  prefs: []
  type: TYPE_NORMAL
  zh: 返回的信息包括参考资料以及以下截图中显示的信息：
- en: '![The Metasploit Framework](img/3121OS_04_10.jpg)'
  id: totrans-741
  prefs: []
  type: TYPE_IMG
  zh: '![Metasploit框架](img/3121OS_04_10.jpg)'
- en: 'To instruct Metasploit that we will attack the target with this exploit, we
    issue the following command:'
  id: totrans-742
  prefs: []
  type: TYPE_NORMAL
  zh: 为了指示Metasploit我们将使用这个利用来攻击目标，我们发出以下命令：
- en: '[PRE29]'
  id: totrans-743
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Metasploit changes the command prompt from `msf>` to `msf exploit (usermap_script)
    >`.
  id: totrans-744
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit将命令提示符从`msf>`更改为`msf exploit (usermap_script) >`。
- en: 'Metasploit prompts the tester to select the payload (a reverse shell from the
    compromised system back to the attacker) and sets the other variables listed as
    follows:'
  id: totrans-745
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit提示测试人员选择有效载荷（从受损系统到攻击者的反向shell），并设置以下列出的其他变量：
- en: '**Remote host** (**RHOST**): This is the IP address of the system being attacked'
  id: totrans-746
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程主机**（**RHOST**）：这是被攻击系统的IP地址'
- en: '**Remote port** (**RPORT**): This is the port number that is used for the exploit'
  id: totrans-747
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程端口**（**RPORT**）：这是用于利用的端口号'
- en: '**Local host** (**LHOST**): This is the IP address of the system used to launch
    the attack'
  id: totrans-748
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**本地主机**（**LHOST**）：这是用于发动攻击的系统的IP地址'
- en: The attack is launched by entering the `exploit` command at the prompt after
    all variables have been set. Metasploit initiates the attack and confirms that
    a reverse shell is present by indicating `command shell 1 opened` and giving the
    IP addresses that originate and terminate the reverse shell.
  id: totrans-749
  prefs: []
  type: TYPE_NORMAL
  zh: 在设置了所有变量之后，在提示符下输入`exploit`命令启动攻击。Metasploit启动攻击，并通过指示`command shell 1 opened`并给出发起和终止反向shell的IP地址来确认反向shell的存在。
- en: 'To verify that a shell is present, the tester can issue queries for the hostname,
    username (`uname -a`), and `whoami` to confirm that the results are specific to
    the target system that is located at a remote location. Take a look at the following
    screenshot:'
  id: totrans-750
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证是否存在shell，测试人员可以查询主机名、用户名（`uname -a`）和`whoami`，以确认结果是特定于位于远程位置的目标系统。看一下下面的截图：
- en: '![The Metasploit Framework](img/3121OS_04_11.jpg)'
  id: totrans-751
  prefs: []
  type: TYPE_IMG
  zh: '![Metasploit框架](img/3121OS_04_11.jpg)'
- en: When a system is compromised to this extent, it is ready for the post-exploitation
    activities ( see [Chapter 5](ch05.html "Chapter 5. Post Exploit – Action on the
    Objective"), *Post Exploit – Action on the Objective* and [Chapter 6](ch06.html
    "Chapter 6. Post Exploit – Persistence"), *Post Exploit – Persistence*). To add
    new exploits to Metasploit, in Ruby script (`.rb`) or Python (`.py`), place them
    in the hidden `.msf4` folder located in your home directory, and then reload `msfconsole`.
  id: totrans-752
  prefs: []
  type: TYPE_NORMAL
  zh: 当系统受到这种程度的威胁时，它已经准备好进行后利用活动（参见[第5章](ch05.html "第5章。目标上的后利用-目标上的行动")，*目标上的后利用-目标上的行动*和[第6章](ch06.html
    "第6章。后利用-持久性")，*后利用-持久性*）。要向Metasploit添加新的利用，在Ruby脚本（`.rb`）或Python（`.py`）中，将它们放在位于您的主目录中的隐藏`.msf4`文件夹中，然后重新加载`msfconsole`。
- en: Exploiting a vulnerable application
  id: totrans-753
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 利用易受攻击的应用程序
- en: The Metasploit Framework is equally effective against vulnerabilities in the
    operating system as well as third-party applications. In this example, we'll exploit
    a buffer overflow vulnerability that was identified in Chasys Draw IES (Version
    4.10.01). The vulnerability exists in the `ReadFile` function, which is used to
    store user-provided data in an insecure way. Exploitation results in arbitrary
    code execution under the context of the user.
  id: totrans-754
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit框架对操作系统和第三方应用程序中的漏洞同样有效。在这个例子中，我们将利用Chasys Draw IES（版本4.10.01）中发现的缓冲区溢出漏洞。该漏洞存在于`ReadFile`函数中，该函数用于以不安全的方式存储用户提供的数据。利用结果是在用户的上下文中执行任意代码。
- en: To initiate the attack, the tester needs to generate a specially crafted BMP
    file and then get the victim to open that file in the Chasys application. When
    this occurs, it will compromise the base operating system (effective against Windows
    XP SP3 and Windows 7 SP1).
  id: totrans-755
  prefs: []
  type: TYPE_NORMAL
  zh: 要发起攻击，测试人员需要生成一个特制的BMP文件，然后让受害者在Chasys应用程序中打开该文件。当这种情况发生时，它将危害基本操作系统（对Windows
    XP SP3和Windows 7 SP1有效）。
- en: 'The first step is to open `msfconsole` and set Metasploit to use `exploit/windows/fileformat/chasys_draw_ies_bof`,
    as shown in the following screenshot:'
  id: totrans-756
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是打开`msfconsole`并设置Metasploit使用`exploit/windows/fileformat/chasys_draw_ies_bof`，如下截图所示：
- en: '![Exploiting a vulnerable application](img/3121OS_04_12.jpg)'
  id: totrans-757
  prefs: []
  type: TYPE_IMG
  zh: '![利用易受攻击的应用程序](img/3121OS_04_12.jpg)'
- en: Again, the exploit is a relatively simple exploit. It requires the tester to
    set a reverse shell (`reverse_tcp`) from the compromised system back to the tester's
    system, the **Local Host** (**LHOST**).
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，利用是一个相对简单的利用。测试人员需要从受损系统设置一个反向shell（`reverse_tcp`）到测试人员的系统，**本地主机**（**LHOST**）。
- en: When the exploit is completed, it creates the specially-crafted BMP file, which
    is stored with the default name of `msf.bmp`. To entice the target to open the
    file and avoid a default name that may be detected by some devices, it is best
    to change the filename to something that is more relevant to the intended target.
  id: totrans-759
  prefs: []
  type: TYPE_NORMAL
  zh: 当利用完成时，它会创建一个特制的BMP文件，存储为默认名称`msf.bmp`。为了诱使目标打开文件并避免一些设备可能检测到的默认名称，最好将文件名更改为与预期目标更相关的内容。
- en: 'The next step is to open a new instance of `msfconsole`, and set up a *listener*
    for the incoming reverse TCP shell that will originate from the target when it
    is compromised. A simple listener is shown in the following screenshot:'
  id: totrans-760
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是打开一个新的`msfconsole`实例，并为从目标发起的反向TCP shell设置一个*监听器*。下面的截图显示了一个简单的监听器：
- en: '![Exploiting a vulnerable application](img/3121OS_04_13.jpg)'
  id: totrans-761
  prefs: []
  type: TYPE_IMG
  zh: '![利用易受攻击的应用程序](img/3121OS_04_13.jpg)'
- en: 'Once the victim opens the crafted BMP image file in the vulnerable application,
    a `meterpreter` session is opened between the two systems. The `msf` prompt is
    replaced by the `meterpreter` prompt and the tester can effectively access the
    remote system with a command shell. One of the first steps after the compromise
    is to verify that you are on the target system; as you can see in the following
    screenshot, the `sysinfo` command identifies the computer name and operating system,
    verifying a successful attack:'
  id: totrans-762
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦受害者在易受攻击的应用程序中打开精心制作的BMP图像文件，两个系统之间就会打开一个`meterpreter`会话。`msf`提示符被`meterpreter`提示符替换，测试人员可以有效地通过命令行访问远程系统。妥协后的第一步是验证您是否在目标系统上；如下截图所示，`sysinfo`命令识别计算机名称和操作系统，验证了成功的攻击：
- en: '![Exploiting a vulnerable application](img/3121OS_04_14_New.jpg)'
  id: totrans-763
  prefs: []
  type: TYPE_IMG
  zh: '![利用易受攻击的应用程序](img/3121OS_04_14_New.jpg)'
- en: Exploiting multiple targets with Armitage
  id: totrans-764
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Armitage利用多个目标
- en: Armitage is frequently overlooked by penetration testers who eschew its GUI
    interface in favor of the traditional command-line input of the Metasploit console.
    However, it possesses Metasploit's functionality while giving visibility to its
    many possible options, making it a good alternative in complex testing environments.
    Unlike Metasploit, it also allows you to test multiple targets at the same time—up
    to 512 targets at once.
  id: totrans-765
  prefs: []
  type: TYPE_NORMAL
  zh: Armitage经常被渗透测试人员忽视，他们放弃了其图形用户界面，转而使用传统的Metasploit控制台命令行输入。然而，它具有Metasploit的功能，同时还可以看到其许多可能的选项，使其成为复杂测试环境中的一个很好的选择。与Metasploit不同的是，它还允许您同时测试多个目标——最多可同时测试512个目标。
- en: 'To start Armitage, ensure that the database and Metasploit services are started
    using the following command:'
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动Armitage，请确保使用以下命令启动数据库和Metasploit服务：
- en: '[PRE30]'
  id: totrans-767
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: After that step, enter `armitage` over the command prompt to execute the command.
    Armitage does not always execute cleanly and it may require the launch steps to
    be repeated to ensure that it is functioning correctly.
  id: totrans-768
  prefs: []
  type: TYPE_NORMAL
  zh: 在完成这一步之后，在命令提示符下输入`armitage`来执行该命令。Armitage并不总是执行得很干净，可能需要重复启动步骤以确保其正常运行。
- en: To discover available targets, you can manually add a host by providing its
    IP address or select an `nmap` scan from the **Hosts** tab on the menu bar. Armitage
    can also enumerate targets using MSF auxiliary commands or DNS enumeration.
  id: totrans-769
  prefs: []
  type: TYPE_NORMAL
  zh: 要发现可用的目标，您可以通过提供其IP地址手动添加主机，或者从菜单栏的**主机**选项卡中选择`nmap`扫描。Armitage还可以使用MSF辅助命令或DNS枚举枚举目标。
- en: 'Armitage can also import host data from the following files: Acunetix, amap,
    AppScan, Burp proxy, Foundstone, Microsoft Baseline Security Analyzer, Nessus
    NBE and XML files, NetSparker, NeXpose, nmap, OpenVas, Qualys, and Retina. The
    initial Armitage start-screen is shown in the following screenshot:'
  id: totrans-770
  prefs: []
  type: TYPE_NORMAL
  zh: Armitage还可以从以下文件导入主机数据：Acunetix、amap、AppScan、Burp代理、Foundstone、Microsoft基线安全分析器、Nessus
    NBE和XML文件、NetSparker、NeXpose、nmap、OpenVas、Qualys和Retina。初始的Armitage启动屏幕如下截图所示：
- en: '![Exploiting multiple targets with Armitage](img/3121OS_04_15.jpg)'
  id: totrans-771
  prefs: []
  type: TYPE_IMG
  zh: '![使用Armitage攻击多个目标](img/3121OS_04_15.jpg)'
- en: 'Armitage allows you to set a host label by selecting a host using a right-click,
    and then going to the **Host** menu and selecting the **Set Label…** function.
    This allows you to flag a particular address or identify it by a common name,
    which is helpful when using team-based testing. This process is shown in the following
    screenshot:'
  id: totrans-772
  prefs: []
  type: TYPE_NORMAL
  zh: Armitage允许您通过右键选择主机，然后转到**主机**菜单并选择**设置标签...**功能来设置主机标签。这允许您标记特定的地址或通过常用名称标识它，在团队测试时非常有帮助。这个过程在下面的截图中显示：
- en: '![Exploiting multiple targets with Armitage](img/3121OS_04_16.jpg)'
  id: totrans-773
  prefs: []
  type: TYPE_IMG
  zh: '![使用Armitage攻击多个目标](img/3121OS_04_16.jpg)'
- en: Armitage also supports dynamic workspaces—a filtered view of the network based
    on network criteria, operating system, open ports and services, and labels. For
    example, you may test a network and identify several servers that do not appear
    to be patched to the extent of the remainder of the network. These can be highlighted
    by giving them a label and then placing them in a priority workspace.
  id: totrans-774
  prefs: []
  type: TYPE_NORMAL
  zh: Armitage还支持动态工作区-基于网络标准、操作系统、开放端口和服务以及标签的网络的过滤视图。例如，您可以测试一个网络，并识别出几台似乎没有像网络的其余部分那样打补丁的服务器。这些可以通过给它们贴上标签然后将它们放在优先工作区中来突出显示。
- en: Once you have identified the target systems that are present on a network, you
    can select specific modules to implement as part of the exploitation process.
    You can also use the **Attacks** option in the menu bar to find attacks.
  id: totrans-775
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您确定了网络上存在的目标系统，您可以选择特定的模块作为利用过程的一部分来实施。您还可以使用菜单栏中的**攻击**选项来查找攻击。
- en: To exploit a host, select it with a right-click, navigate to the **Attack**
    item, and choose an exploit (make sure that the operating system is set for the
    correct host; this does not always happen automatically).
  id: totrans-776
  prefs: []
  type: TYPE_NORMAL
  zh: 要利用主机，请右键单击选择它，导航到**攻击**项目，并选择一个漏洞利用（确保操作系统设置正确的主机；这并不总是自动发生）。
- en: One interesting option is **Hail Mary**, located under the **Attacks** option.
    By selecting this function, all identified systems are automatically subjected
    to exploits to achieve the greatest number of possible compromises. This is a
    very noisy attack and should therefore be used as a test choice of the last resort.
    It is also an excellent way to determine if an intrusion detection system is implemented
    and configured properly!
  id: totrans-777
  prefs: []
  type: TYPE_NORMAL
  zh: 一个有趣的选项是**Hail Mary**，位于**攻击**选项下。通过选择此功能，所有识别的系统都会自动受到攻击，以实现可能的最大数量的妥协。这是一个非常喧闹的攻击，因此应该作为最后的测试选择。这也是确定入侵检测系统是否实施和配置正确的绝佳方式！
- en: 'A system that is compromised shows up as an icon with a red border with electrical
    sparks. In the next screenshot, two test systems have been compromised and there
    are four active sessions in place between these systems and the tester. The `Active
    Sessions` panel indicates the connections and identifies what exploit was used
    to compromise the target. Take a look at the following screenshot that represents
    the different options:'
  id: totrans-778
  prefs: []
  type: TYPE_NORMAL
  zh: 被入侵的系统显示为带有红色边框和电火花的图标。在下一个截图中，两个测试系统已被入侵，并且在这些系统和测试人员之间有四个活动会话。`活动会话`面板显示连接并标识用于入侵目标的漏洞利用。请查看以下截图，表示不同的选项：
- en: '![Exploiting multiple targets with Armitage](img/3121OS_04_17.jpg)'
  id: totrans-779
  prefs: []
  type: TYPE_IMG
  zh: '![使用Armitage攻击多个目标](img/3121OS_04_17.jpg)'
- en: Tip
  id: totrans-780
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: During a penetration test that was conducted, the **Hail Mary** option identified
    two exploitable vulnerabilities with the target and initiated two active sessions.
    Manual testing with the same target eventually identified eight exploitable vulnerabilities,
    with multiple communications channels between the compromised system and the tester.
    Real-world tests of this type reinforce the advantages and weaknesses of automated
    tools during the penetration testing process.
  id: totrans-781
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行的渗透测试中，**Hail Mary**选项识别了目标的两个可利用漏洞，并启动了两个活动会话。对同一目标的手动测试最终识别出了八个可利用漏洞，并在被入侵系统和测试人员之间建立了多个通信渠道。这种类型的真实测试加强了渗透测试过程中自动化工具的优势和劣势。
- en: Team testing with Armitage
  id: totrans-782
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Armitage进行团队测试
- en: 'Armitage is more than a GUI frontend for the Metasploit Framework; it is a
    scriptable penetration testing tool that allows a team to use a single instance
    of the Metasploit Framework so that the GUI displays the following functions:'
  id: totrans-783
  prefs: []
  type: TYPE_NORMAL
  zh: Armitage不仅是Metasploit Framework的GUI前端；它是一个可编写脚本的渗透测试工具，允许团队使用Metasploit Framework的单个实例，以便GUI显示以下功能：
- en: It uses the same session, allowing one tester to oversee the process, identify
    findings of interest, and control the direction of testing.
  id: totrans-784
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它使用相同的会话，允许一个测试人员监督过程，识别感兴趣的发现，并控制测试的方向。
- en: It runs scripts to automate testing tasks.
  id: totrans-785
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它运行脚本来自动化测试任务。
- en: It shares downloaded files such as password files. This allows one team member
    to focus on password cracking, while other team members continue the exploitation
    phase.
  id: totrans-786
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它共享下载的文件，如密码文件。这使得一个团队成员可以专注于破解密码，而其他团队成员继续利用阶段。
- en: It communicates using a shared event log.
  id: totrans-787
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它使用共享事件日志进行通信。
- en: 'To take advantage of the team configuration, ensure that Armitage is not already
    running and then invoke the `teamserver` script from a console prompt in the `Armitage`
    directory, usually `/usr/share/armitage`, as follows:'
  id: totrans-788
  prefs: []
  type: TYPE_NORMAL
  zh: 为了利用团队配置，请确保Armitage尚未运行，然后从`Armitage`目录中的控制台提示中调用`teamserver`脚本，通常位于`/usr/share/armitage`，如下所示：
- en: '[PRE31]'
  id: totrans-789
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Ensure that the IP address is correct, as it is not verified by Armitage, and
    that all team members can access the host on port `55553`. When you start the
    Armitage team server, it communicates with team members using an SSL certificate;
    team members should verify that the SHA-1 hash of the certificate matches the
    server's SSL certificate.
  id: totrans-790
  prefs: []
  type: TYPE_NORMAL
  zh: 确保IP地址正确，因为Armitage不会验证它，并且所有团队成员都可以在端口`55553`上访问主机。当您启动Armitage团队服务器时，它将使用SSL证书与团队成员进行通信；团队成员应验证证书的SHA-1哈希是否与服务器的SSL证书匹配。
- en: Do not connect to `127.0.0.1` when the `teamserver` script is running, as Armitage
    uses that IP address to connect and determine whether it should use SSL (`teamserver`
    or a remote address) or non-SSL (`localhost` or `msfrpcd`). To connect Armitage
    to `teamserver` locally, use the external IP address in the **Host** field.
  id: totrans-791
  prefs: []
  type: TYPE_NORMAL
  zh: 当`teamserver`脚本正在运行时，不要连接到`127.0.0.1`，因为Armitage使用该IP地址进行连接并确定是否应该使用SSL（`teamserver`或远程地址）或非SSL（`localhost`或`msfrpcd`）。要将Armitage连接到本地的`teamserver`，请在**Host**字段中使用外部IP地址。
- en: Users can open one or more command shells, browse files, download data, and
    take screenshots. Shell sessions are automatically locked when in use, and then
    unlocked. However, some meterpreter scripts may fail to function over time.
  id: totrans-792
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可以打开一个或多个命令行窗口，浏览文件，下载数据并截图。当使用时，Shell会自动锁定，然后解锁。但是，一些meterpreter脚本可能会随着时间的推移而无法正常运行。
- en: To communicate as a team, the **View** option in the menu opens the shared event
    log. You can make entries onto the log as you would if you were using IRC or some
    other chat room, and the log keeps a permanent record of all comments.
  id: totrans-793
  prefs: []
  type: TYPE_NORMAL
  zh: 为了作为团队进行沟通，菜单中的**View**选项打开了共享事件日志。您可以像使用IRC或其他聊天室一样在日志中进行记录，并且日志会保留所有评论的永久记录。
- en: Scripting the Armitage attack
  id: totrans-794
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 编写Armitage攻击脚本
- en: Armitage includes the Cortana scripting language, which is based on Sleep, an
    extensible language that resembles Perl. Cortana scripts may define keyboard shortcuts,
    insert menus, and create unique user interfaces.
  id: totrans-795
  prefs: []
  type: TYPE_NORMAL
  zh: Armitage包括基于Sleep的Cortana脚本语言，这是一种类似Perl的可扩展语言。Cortana脚本可以定义键盘快捷键、插入菜单并创建独特的用户界面。
- en: Scripts may be run as standalone entities (which requires that the Armitage
    team server be active) or directly from Armitage. To load an existing script,
    select **Armitage** in the main menu bar, and then select **Scripts**. A tabbed
    view will open and a button will give you the option to load a script.
  id: totrans-796
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本可以作为独立实体运行（需要Armitage团队服务器处于活动状态）或直接从Armitage运行。要加载现有脚本，请在主菜单栏中选择**Armitage**，然后选择**Scripts**。将打开一个带有选项卡的视图，并且一个按钮将给您加载脚本的选项。
- en: 'Armitage also provides a scripting environment which is invoked from the **View
    | Script Console** tab of the menu, as seen in the following screenshot:'
  id: totrans-797
  prefs: []
  type: TYPE_NORMAL
  zh: 阿米特奇还提供了一个脚本环境，可以从菜单的**View | Script Console**选项卡中调用，如下面的屏幕截图所示：
- en: '![Scripting the Armitage attack](img/3121OS_04_18.jpg)'
  id: totrans-798
  prefs: []
  type: TYPE_IMG
  zh: '![编写Armitage攻击脚本](img/3121OS_04_18.jpg)'
- en: 'A sample script to fully scan target systems using the Metasploit Framework
    could be written as `scanner.cna`. Whenever a new host is added (`host_add`),
    the MSF port scanner will scan for a defined list of TCP ports and for available
    UDP ports. Take a look at the following code snippet, which shows the scanner
    script:'
  id: totrans-799
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Metasploit Framework完全扫描目标系统的示例脚本可以编写为`scanner.cna`。每当添加新主机（`host_add`）时，MSF端口扫描器将扫描一组定义的TCP端口和可用的UDP端口。看一下下面的代码片段，显示了扫描器脚本：
- en: '[PRE32]'
  id: totrans-800
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Because Cortana has extensive hooks into the Metasploit Framework, scripts can
    be used to automatically launch exploits, conduct post-exploitation activities,
    such as tracking user activity, and facilitate multiuser activities across the
    attacker's kill chain.
  id: totrans-801
  prefs: []
  type: TYPE_NORMAL
  zh: 由于Cortana与Metasploit Framework有广泛的连接，脚本可以用于自动启动利用、进行后期利用活动（如跟踪用户活动）并促进攻击者的杀伤链上的多用户活动。
- en: Bypassing IDs and antivirus detection
  id: totrans-802
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 绕过身份验证和防病毒检测
- en: The exploitation phase of the kill chain is the most dangerous one for the penetration
    tester or attacker—they are directly interacting with the target network or system
    and there is a great chance for their activity to be logged or their identity
    discovered. Again, stealth must be employed to minimize risks to the tester. Although
    no specific methodology or tool is undetectable, there are some configuration
    changes and specific tools that will make detection more difficult.
  id: totrans-803
  prefs: []
  type: TYPE_NORMAL
  zh: 杀伤链的利用阶段对于渗透测试人员或攻击者来说是最危险的阶段——他们直接与目标网络或系统进行交互，并且很有可能被记录下他们的活动或发现他们的身份。再次强调，必须采用隐蔽手段来最小化测试人员的风险。虽然没有特定的方法论或工具是不可检测的，但有一些配置更改和特定工具将使检测更加困难。
- en: When considering remote exploits, most networks and systems employ various types
    of defensive controls to minimize the risk of attack. Network devices include
    routers, firewalls, intrusion detection and prevention systems, and malware detection
    software.
  id: totrans-804
  prefs: []
  type: TYPE_NORMAL
  zh: 在考虑远程利用时，大多数网络和系统都采用各种防御控制来最小化攻击风险。网络设备包括路由器、防火墙、入侵检测和防御系统以及恶意软件检测软件。
- en: To facilitate exploitation, most frameworks incorporate features to make the
    attack somewhat stealthy. The Metasploit Framework allows you to manually set
    evasion factors on an exploit-by-exploit basis; however, determining which factors
    (such as encryption, port number, filenames, and others) can be difficult and
    change for each particular ID. The Metasploit Framework also allows communication
    between the target and the attacking systems to be encrypted (the `windows/meterpreter/reverse_tcp_rc4`
    payload), making it difficult for the exploit payload to be detected.
  id: totrans-805
  prefs: []
  type: TYPE_NORMAL
  zh: 为了促进利用，大多数框架都包含使攻击有些隐秘的功能。Metasploit框架允许您在基于特定漏洞的基础上手动设置逃避因素；然而，确定哪些因素（如加密、端口号、文件名等）可能很困难，并且对于每个特定的ID都可能会发生变化。Metasploit框架还允许目标和攻击系统之间的通信进行加密（`windows/meterpreter/reverse_tcp_rc4`有效载荷），使得难以检测到利用有效载荷。
- en: 'Metasploit Pro, available as a trial on the Kali distribution, includes the
    following to specifically bypass intrusion detection systems:'
  id: totrans-806
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit Pro，在Kali发行版上作为试用版提供，包括以下内容，专门用于绕过入侵检测系统：
- en: Scan speed can be adjusted in the settings for **Discovery Scan**, reducing
    the interaction speed with the target by setting the speed to **sneaky** or **paranoid**
  id: totrans-807
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以在**Discovery Scan**的设置中调整扫描速度，通过将速度设置为**sneaky**或**paranoid**来减少与目标的交互速度
- en: Implement transport evasion by sending smaller TCP packets and increasing the
    transmission time between the packets
  id: totrans-808
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过发送更小的TCP数据包并增加数据包之间的传输时间来实现传输逃避
- en: Reducing the number of simultaneous exploits launched against a target system
  id: totrans-809
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 减少针对目标系统启动的同时利用数量
- en: Application-specific evasion options for exploits that involve DCERPC, HTTP,
    and SMB can be automatically set
  id: totrans-810
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动设置涉及DCERPC、HTTP和SMB的漏洞利用的特定于应用程序的逃避选项
- en: Most antivirus software rely on signature matching to locate viruses and other
    malware. They examine each executable for strings of code known to be present
    in viruses (the signature) and create an alarm when a suspect string is detected.
    Many of Metasploit's attacks rely on files that may possess a signature that,
    over time, has been identified by antivirus vendors.
  id: totrans-811
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数防病毒软件依赖于签名匹配来定位病毒和其他恶意软件。它们检查每个可执行文件中已知存在于病毒中的代码字符串（签名），并在检测到可疑字符串时发出警报。Metasploit的许多攻击依赖于可能具有签名的文件，这些签名随着时间的推移已被防病毒供应商识别出来。
- en: In response to this, the Metasploit Framework allows standalone executables
    to be encoded to bypass detection. Unfortunately, extensive testing of these executables
    at public sites, such as [virustotal.com](http://virustotal.com), have lessened
    their effectiveness in bypassing the AV software.
  id: totrans-812
  prefs: []
  type: TYPE_NORMAL
  zh: 作为回应，Metasploit框架允许对独立可执行文件进行编码以绕过检测。不幸的是，对这些可执行文件在[virustotal.com](http://virustotal.com)等公共网站进行的广泛测试减弱了它们绕过防病毒软件的效果。
- en: A new AV-evasion framework, written by Chris Truncer, called Veil-Evasion ([www.Veil-Evasion.com](http://www.Veil-Evasion.com)),
    is now providing effective protection against the detection of standalone exploits.
    Veil-Evasion aggregates various shellcode injection techniques into a framework
    that simplifies management.
  id: totrans-813
  prefs: []
  type: TYPE_NORMAL
  zh: 由Chris Truncer编写的新的AV逃避框架，名为Veil-Evasion（[www.Veil-Evasion.com](http://www.Veil-Evasion.com)），现在提供了有效的保护，可防止独立利用的检测。Veil-Evasion将各种shellcode注入技术聚合到一个框架中，简化了管理。
- en: 'As a framework, Veil-Evasion possesses several features, which includes the
    following:'
  id: totrans-814
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个框架，Veil-Evasion具有以下几个特点：
- en: It incorporates custom shellcode in a variety of programming languages, including
    C, C#, and Python
  id: totrans-815
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它包含各种编程语言的自定义shellcode，包括C、C#和Python
- en: It can use Metasploit-generated shellcode
  id: totrans-816
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以使用Metasploit生成的shellcode
- en: It can integrate third-party tools such as Hyperion (encrypts an EXE file with
    AES-128 bit encryption), PEScrambler, and BackDoor Factory
  id: totrans-817
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以集成第三方工具，如Hyperion（使用AES-128位加密对EXE文件进行加密）、PEScrambler和BackDoor Factory
- en: The `Veil-Evasion_evasion.cna` script allows for Veil-Evasion to be integrated
    into Armitage and its commercial version, Cobalt Strike
  id: totrans-818
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Veil-Evasion_evasion.cna`脚本允许将Veil-Evasion集成到Armitage及其商业版本Cobalt Strike中'
- en: Payloads can be generated and seamlessly substituted into all PsExec calls
  id: totrans-819
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有效载荷可以生成并无缝地替换所有PsExec调用
- en: Users have the ability to reuse shellcode or implement their own encryption
    methods
  id: totrans-820
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户可以重用shellcode或实现自己的加密方法
- en: It's functionality can be scripted to automate deployment
  id: totrans-821
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其功能可以被脚本化以自动部署
- en: Veil-Evasion is under constant development and the framework has been extended
    with modules such as Veil-Evasion-Catapult (the payload delivery system)
  id: totrans-822
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Veil-Evasion在不断发展，框架已经扩展了模块，如Veil-Evasion-Catapult（有效载荷传递系统）
- en: 'Veil-Evasion can generate an exploit payload; the standalone payloads include
    the following options:'
  id: totrans-823
  prefs: []
  type: TYPE_NORMAL
  zh: Veil-Evasion可以生成一个利用有效载荷；独立有效载荷包括以下选项：
- en: Minimal Python installation to invoke shellcode; it uploads a minimal `Python.zip`
    installation and the 7zip binary. The Python environment is unzipped, invoking
    the shellcode. Since the only files that interact with the victim are trusted
    Python libraries and the interpreter, the victim's AV does not detect or alarm
    on any unusual activity.
  id: totrans-824
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最小的Python安装来调用shellcode；它上传了一个最小的`Python.zip`安装包和7zip二进制文件。Python环境被解压缩，调用shellcode。由于与受害者交互的唯一文件是受信任的Python库和解释器，受害者的防病毒软件不会检测或警报任何异常活动。
- en: Sethc backdoor, which configures the victim's registry to launch the sticky
    keys RDP backdoor.
  id: totrans-825
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Sethc后门，配置受害者的注册表以启动粘滞键RDP后门。
- en: PowerShell shellcode injector.
  id: totrans-826
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PowerShell shellcode注入器。
- en: 'When the payloads have been created, they can be delivered to the target in
    one of the following two ways:'
  id: totrans-827
  prefs: []
  type: TYPE_NORMAL
  zh: 有效载荷创建后，可以通过以下两种方式之一交付给目标：
- en: Upload and execute using Impacket and PTH toolkit
  id: totrans-828
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Impacket和PTH工具包上传和执行
- en: UNC invocation
  id: totrans-829
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: UNC调用
- en: Veil-Evasion is available from the Kali repositories, such as Veil-Evasion,
    and it is automatically installed by simply entering `apt-get install veil-evasion`
    in a command prompt.
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
  zh: Veil-Evasion可以从Kali存储库中获取，例如Veil-Evasion，只需在命令提示符中输入`apt-get install veil-evasion`即可自动安装。
- en: Note
  id: totrans-831
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you receive any errors during installation, re-run the `/usr/share/veil-evasion/setup/setup.sh`
    script.
  id: totrans-832
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在安装过程中遇到任何错误，请重新运行`/usr/share/veil-evasion/setup/setup.sh`脚本。
- en: 'Veil-Evasion presents the user with the main menu, which provides the number
    of payload modules that are loaded as well as the available commands. Typing `list`
    will list all available `payloads`, `list langs` will list the available language
    payloads, and `list <language>` will list the payloads for a specific language.
    Veil-Evasion''s initial launch screen is shown in the following screenshot:'
  id: totrans-833
  prefs: []
  type: TYPE_NORMAL
  zh: Veil-Evasion向用户呈现主菜单，提供加载的有效载荷模块数量以及可用的命令。输入`list`将列出所有可用的`payloads`，`list langs`将列出可用的语言有效载荷，`list
    <language>`将列出特定语言的有效载荷。Veil-Evasion的初始启动屏幕如下屏幕截图所示：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_19.jpg)'
  id: totrans-834
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_19.jpg)'
- en: 'Veil-Evasion is undergoing rapid development with significant releases on a
    monthly basis and important upgrades occurring more frequently. Presently, there
    are 24 payloads designed to bypass antivirus by employing encryption or direct
    injection into the memory space. These payloads are shown in the next screenshot:'
  id: totrans-835
  prefs: []
  type: TYPE_NORMAL
  zh: Veil-Evasion正在快速发展，每月发布重要版本，并更频繁地进行重要升级。目前，有24个有效载荷旨在通过加密或直接注入内存空间来绕过防病毒软件。这些有效载荷如下屏幕截图所示：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_20.jpg)'
  id: totrans-836
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_20.jpg)'
- en: 'To obtain information on a specific payload, type `info<payload number / payload
    name>` or `info <tab>` to autocomplete the payloads that are available. You can
    also just enter the number from the list. In the following example, we entered
    `19` to select the `python/shellcode_inject/aes_encrypt` payload:'
  id: totrans-837
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取特定有效载荷的信息，请输入`info<payload number / payload name>`或`info <tab>`以自动完成可用的有效载荷。您也可以直接输入列表中的数字。在下面的示例中，我们输入`19`来选择`python/shellcode_inject/aes_encrypt`有效载荷：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_21.jpg)'
  id: totrans-838
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_21.jpg)'
- en: The exploit includes an `expire_payload` option. If the module is not executed
    by the target user within a specified timeframe, it is rendered inoperable. This
    function contributes to the stealthiness of the attack.
  id: totrans-839
  prefs: []
  type: TYPE_NORMAL
  zh: 利用程序包括一个`expire_payload`选项。如果模块在指定时间内未被目标用户执行，它将变得无法操作。这个功能有助于攻击的隐秘性。
- en: The required options include the name of the options as well as the default
    values and descriptions. If a required value isn't completed by default, the tester
    will need to input a value before the payload can be generated. To set the value
    for an option, enter `set <option name>` and then type the desired value. To accept
    the default options and create the exploit, type `generate` in the command prompt.
  id: totrans-840
  prefs: []
  type: TYPE_NORMAL
  zh: 所需的选项包括选项的名称以及默认值和描述。如果默认情况下未完成必需的值，则测试人员需要在生成有效载荷之前输入一个值。要设置选项的值，请输入`set <option
    name>`，然后输入所需的值。要接受默认选项并创建利用程序，请在命令提示符中输入`generate`。
- en: 'If the payload uses shellcode, you will be presented with the shellcode menu,
    where you can select `msfvenom` (the default shellcode) or a custom shellcode.
    If the custom shellcode option is selected, enter the shellcode in the form of
    `\x01\x02`, without quotes and newlines (`\n`). If the default `msfvenom` is selected,
    you will be prompted with the default payload choice of `windows/meterpreter/reverse_tcp`.
    If you wish to use another payload, press *Tab* to complete the available payloads.
    The available payloads are shown in the following screenshot:'
  id: totrans-841
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有效载荷使用shellcode，您将看到shellcode菜单，您可以选择`msfvenom`（默认shellcode）或自定义shellcode。如果选择自定义shellcode选项，请以`\x01\x02`的形式输入shellcode，不带引号和换行符（`\n`）。如果选择默认的`msfvenom`，您将提示选择`windows/meterpreter/reverse_tcp`的默认有效载荷。如果您希望使用其他有效载荷，请按*Tab*键完成可用的有效载荷。可用的有效载荷如下屏幕截图所示：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_22.jpg)'
  id: totrans-842
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_22.jpg)'
- en: 'In the following example, the `[tab]` command was used to demonstrate some
    of the available payloads; however, the default (`windows/meterpreter/reverse_tcp`)
    was selected, as shown in the following screenshot:'
  id: totrans-843
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的示例中，使用了`[tab]`命令来演示一些可用的有效载荷；然而，默认的（`windows/meterpreter/reverse_tcp`）被选择，如下面的屏幕截图所示：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_23.jpg)'
  id: totrans-844
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_23.jpg)'
- en: 'The user will then be presented with the output menu with a prompt to choose
    the base name for the generated payload files. If the payload was Python-based
    and you selected `compile_to_exe` as an option, the user will have the option
    of either using `Pyinstaller` to create the EXE file, or generating Py2Exe files,
    as shown in the following screenshot:'
  id: totrans-845
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，用户将看到输出菜单，并提示选择生成的有效载荷文件的基本名称。如果有效载荷是基于Python的，并且您选择了`compile_to_exe`作为选项，用户将有两个选项，要么使用`Pyinstaller`创建EXE文件，要么生成Py2Exe文件，如下面的屏幕截图所示：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_24.jpg)'
  id: totrans-846
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_24.jpg)'
- en: 'The final screen displays information on the generated payload, as shown in
    the following screenshot:'
  id: totrans-847
  prefs: []
  type: TYPE_NORMAL
  zh: 最终屏幕显示生成的有效载荷信息，如下面的屏幕截图所示：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_25.jpg)'
  id: totrans-848
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_25.jpg)'
- en: 'The exploit could also have been created directly from a command line using
    the following options:'
  id: totrans-849
  prefs: []
  type: TYPE_NORMAL
  zh: 利用程序也可以直接从命令行创建，使用以下选项：
- en: '[PRE33]'
  id: totrans-850
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Once an exploit has been created, the tester should verify the payload against
    VirusTotal to ensure that it will not trigger an alert when it is placed on the
    target system. If the payload sample is submitted directly to VirusTotal and it's
    behavior flags it as malicious software, then a signature update against the submission
    can be released by **antivirus** (**AV**) vendors in as little as one hour. This
    is why users are clearly admonished with the message "don't submit samples to
    any online scanner!"
  id: totrans-851
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦利用程序被创建，测试人员应该对负载进行VirusTotal验证，以确保在放置在目标系统上时不会触发警报。如果负载样本直接提交给VirusTotal，并且其行为标志着它是恶意软件，那么**防病毒**（AV）供应商可能会在一小时内发布针对提交的签名更新。这就是为什么用户明确被警告“不要将样本提交给任何在线扫描器！”
- en: 'Veil-Evasion allows testers to use a safe check against VirusTotal. When any
    payload is created, a SHA1 hash is created and added to `hashes.txt`, located
    in the `~/veil-output` directory. Testers can invoke the `checkvt` script to submit
    the hashes to VirusTotal, which will check the SHA1 hash values against its malware
    database. If a Veil-Evasion payload triggers a match, then the tester knows that
    it may be detected by the target system. If it does not trigger a match, then
    the exploit payload will bypass the antivirus software. A successful lookup (not
    detectable by AV) using the `checkvt` command is shown as follows:'
  id: totrans-852
  prefs: []
  type: TYPE_NORMAL
  zh: Veil-Evasion允许测试人员对VirusTotal进行安全检查。当创建任何负载时，都会创建一个SHA1哈希并将其添加到`hashes.txt`中，该文件位于`~/veil-output`目录中。测试人员可以调用`checkvt`脚本将哈希提交给VirusTotal，VirusTotal将检查SHA1哈希值与其恶意软件数据库进行匹配。如果Veil-Evasion负载触发了匹配，那么测试人员就知道它可能会被目标系统检测到。如果没有触发匹配，那么利用程序负载将绕过防病毒软件。使用`checkvt`命令进行成功查找（不被AV检测到）如下所示：
- en: '![Bypassing IDs and antivirus detection](img/3121OS_04_26.jpg)'
  id: totrans-853
  prefs: []
  type: TYPE_IMG
  zh: '![绕过ID和防病毒检测](img/3121OS_04_26.jpg)'
- en: Testing, thus far supports the finding that if `checkvt` does not find a match
    on VirusTotal, the payload will not be detected by the target's antivirus software.
    To use with the Metasploit Framework, use `exploit/multi/handler` and set `PAYLOAD`
    to be `windows/meterpreter/reverse_tcp` (the same as the Veil-Evasion payload
    option), with the same LHOST and LPORT used with Veil-Evasion as well. When the
    listener is functional, send the exploit to the target system. When the listeners
    launch it, it will establish a reverse shell back to the attacker's system.
  id: totrans-854
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止的测试支持了这样的发现，即如果`checkvt`在VirusTotal上找不到匹配项，则负载将不会被目标的防病毒软件检测到。要与Metasploit框架一起使用，使用`exploit/multi/handler`并将`PAYLOAD`设置为`windows/meterpreter/reverse_tcp`（与Veil-Evasion负载选项相同），并且与Veil-Evasion一样使用相同的LHOST和LPORT。当监听器正常工作时，将利用程序发送到目标系统。当监听器启动时，它将在攻击者的系统上建立一个反向shell。
- en: Summary
  id: totrans-855
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we focused on exploits as the tool that converts the findings
    from reconnaissance into a defined action that establishes access between the
    tester and the target.
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将利用程序作为将侦察结果转化为定义的行动的工具进行了重点介绍，从而在测试人员和目标之间建立了访问权限。
- en: Kali provides several tools to facilitate the development, selection, and activation
    of exploits, including the internal exploit-db database as well as several frameworks
    that simplify the use and management of the exploits. Among these frameworks,
    the Metasploit Framework and Armitage are particularly important; however, Veil-Evasion
    enhances both with its ability to bypass antivirus detection.
  id: totrans-857
  prefs: []
  type: TYPE_NORMAL
  zh: Kali提供了几种工具来促进利用程序的开发、选择和激活，包括内部exploit-db数据库以及几个简化利用程序使用和管理的框架。在这些框架中，Metasploit框架和Armitage尤为重要；然而，Veil-Evasion通过其绕过防病毒检测的能力增强了两者。
- en: The next two chapters focus on the most important part of the attacker's kill
    chain—the post-exploitation activities. This is the part of the attack where the
    attackers achieve their objective. Typical post-exploitation activities include
    theft and exfiltration of data (proprietary or financial information), horizontal
    escalation by taking advantage of poor access controls, and vertical escalation
    by theft of user credentials.
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的两章将重点放在攻击者杀伤链中最重要的部分 - 攻击者的后期利用活动。这是攻击的一部分，攻击者在其中实现其目标。典型的后期利用活动包括窃取和外流数据（专有或财务信息）、通过利用弱访问控制进行水平升级，以及通过窃取用户凭据进行垂直升级。
- en: Chapter 5. Post Exploit – Action on the Objective
  id: totrans-859
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。攻击后 - 对目标的行动
- en: In the modern world of hacking and system attacks, attackers are not as concerned
    with exploitation as they are with what can be done with that access. This is
    the part of the kill chain where the attacker achieves the full value of the attack.
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
  zh: 在现代黑客和系统攻击的世界中，攻击者不太关心利用，而是关心可以利用该访问权限做什么。这是攻击者实现攻击的全部价值的部分。
- en: 'Once a system has been compromised, the attacker generally performs the following
    activities:'
  id: totrans-861
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦系统被攻击，攻击者通常执行以下活动：
- en: Conducts a rapid assessment to characterize the local environment (infrastructure,
    connectivity, accounts, presence of target files, and applications that can facilitate
    further attacks)
  id: totrans-862
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 进行快速评估以表征本地环境（基础设施、连接性、帐户、目标文件的存在以及可以促进进一步攻击的应用程序）
- en: Locates and copies or modifies target files of interest, such as datafiles (proprietary
    data and financial information)
  id: totrans-863
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定位并复制或修改感兴趣的目标文件，如数据文件（专有数据和财务信息）
- en: Creates additional accounts and modifies the system to support post-exploitation
    activities
  id: totrans-864
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建额外的帐户并修改系统以支持后期利用活动
- en: Attempts to vertically escalate the privilege level used for access by capturing
    administrator or system-level credentials
  id: totrans-865
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尝试通过捕获管理员或系统级凭据来垂直升级用于访问的特权级别
- en: Attempts to attack other data systems (horizontal escalation) by pivoting the
    attack through the compromised system to the remainder of the network
  id: totrans-866
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尝试通过受损系统将攻击转移到网络的其余部分来攻击其他数据系统（水平升级）
- en: Installs persistent backdoors and covert channels to retain control and have
    secure communications with the compromised system (this is covered in [Chapter
    6](ch06.html "Chapter 6. Post Exploit – Persistence"), *Post Exploit – Persistence*)
  id: totrans-867
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装持久后门和隐蔽通道，以保持控制并与受损系统进行安全通信（在[第6章](ch06.html "第6章。后期利用-持久性")中介绍了这一点，*后期利用-持久性*）
- en: Removes indications of the attack from the compromised system
  id: totrans-868
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从受损系统中删除攻击的迹象
- en: To be successful, the post-exploit activities require comprehensive knowledge
    of the target's operating system and file structure to ensure that protective
    controls can be bypassed. The first post-exploitation step is a reconnaissance
    of the compromised system in the context of the local network.
  id: totrans-869
  prefs: []
  type: TYPE_NORMAL
  zh: 要成功，后期利用活动需要对目标操作系统和文件结构有全面的了解，以确保可以绕过保护控制。第一步是在本地网络环境中对受损系统进行侦察。
- en: 'In this chapter, you will learn the following:'
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学到以下内容：
- en: How to bypass Windows **User Account Control** (**UAC**)
  id: totrans-871
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何绕过Windows用户账户控制（UAC）
- en: How to conduct a rapid reconnaissance of a compromised system
  id: totrans-872
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何对受损系统进行快速侦察
- en: How to obtain sensitive data from a compromised system (pillaging)
  id: totrans-873
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何从受损系统获取敏感数据（掠夺）
- en: How to create additional accounts
  id: totrans-874
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何创建额外的账户
- en: How to use Metasploit Framework to conduct post-exploitation activities
  id: totrans-875
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用Metasploit Framework进行后期利用活动
- en: Vertical and horizontal escalation techniques to improve your access rights
    and increase the number of compromised accounts
  id: totrans-876
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 垂直和水平升级技术，以提高您的访问权限并增加受损账户的数量
- en: How to use anti-forensic techniques to cover your tracks and prevent the compromise
    from being discovered
  id: totrans-877
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用反取证技术掩盖踪迹，防止发现受损
- en: Bypassing Windows User Account Control
  id: totrans-878
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 绕过Windows用户账户控制
- en: 'In Windows Vista and higher versions, Microsoft introduced security controls
    to restrict processes from running at three different integrity levels: high,
    medium, and low. A high integrity process has administrator rights, a medium-level
    process runs with a standard user''s rights, and a low integrity process is restricted,
    enforcing that programs do minimal damage if they are compromised.'
  id: totrans-879
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows Vista及更高版本中，微软引入了安全控制，限制进程以三种不同的完整性级别运行：高、中和低。高完整性进程具有管理员权限，中级进程以标准用户权限运行，低完整性进程受限，强制要求程序在受损时造成最小的损害。
- en: 'To perform any privileged actions, a program must run as an administrator and
    comply with the UAC settings. The four UAC settings are as follows:'
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行任何特权操作，程序必须以管理员身份运行，并遵守UAC设置。四个UAC设置如下：
- en: '**Always notify**: This is the most stringent setting, and it will prompt the
    local user whenever any program wants to use higher level privileges.'
  id: totrans-881
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**始终通知**：这是最严格的设置，当任何程序想要使用更高级别的权限时，它将提示本地用户。'
- en: '**Notify me only when programs try to make changes to my computer**: This is
    the default UAC setting. It does not prompt the user when a native Windows program
    requests higher level privileges. However, it will prompt if a third-party program
    wants elevated privileges.'
  id: totrans-882
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**只在程序尝试对计算机进行更改时通知我**：这是默认的UAC设置。当本机Windows程序请求更高级别的权限时，它不会提示用户。但是，如果第三方程序想要提升权限，它将提示。'
- en: '**Notify me only when programs try to make changes to my computer (don''t dim
    my desktop)**: This is the same as the default setting, but it does not dim the
    system''s monitor when prompting the user.'
  id: totrans-883
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**只在程序尝试对计算机进行更改时通知我（不使我的桌面变暗）**：这与默认设置相同，但在提示用户时不会使系统的监视器变暗。'
- en: '**Never notify**: This option reverts the system to pre-Vista days. If the
    user is an administrator, all programs will run with high integrity.'
  id: totrans-884
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**从不通知**：此选项将系统恢复到Vista之前的状态。如果用户是管理员，所有程序都将以高完整性运行。'
- en: 'Therefore, immediately after exploitation, the tester (and attacker) wants
    to know the following two things:'
  id: totrans-885
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在利用后立即，测试人员（和攻击者）希望了解以下两件事：
- en: Who is the user that the system has identified?
  id: totrans-886
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统识别的用户是谁？
- en: What rights do they have on the system?
  id: totrans-887
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们在系统上有什么权限？
- en: 'This can be determined using the following command:'
  id: totrans-888
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用以下命令确定：
- en: '[PRE34]'
  id: totrans-889
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'A compromised system is operating in a high-integrity context, as shown by
    the `Mandatory Label\High Mandatory Level Label` in the following screenshot:'
  id: totrans-890
  prefs: []
  type: TYPE_NORMAL
  zh: 受损系统正在高完整性环境中运行，如下截图中的“强制标签\高强制级别标签”所示：
- en: '![Bypassing Windows User Account Control](img/3121OS_05_01.jpg)'
  id: totrans-891
  prefs: []
  type: TYPE_IMG
  zh: '![绕过Windows用户账户控制](img/3121OS_05_01.jpg)'
- en: If the `Label` is `Mandatory Label\Medium Mandatory Level`, the tester will
    need to elevate from standard user privileges to administrator rights for many
    of the post-exploit steps to be successful.
  id: totrans-892
  prefs: []
  type: TYPE_NORMAL
  zh: 如果“标签”是“强制标签\中等强制级别”，测试人员需要将标准用户权限提升为管理员权限，以便许多后期利用步骤能够成功。
- en: The first option to elevate privileges is to run `exploit/windows/local/ask`,
    from Metasploit, which launches the `RunAs` attack. This will create an executable
    that, when invoked, will run a program to request elevated rights. The executable
    should be created using the `EXE::Custom` option or encrypted using `Veil-Evasion`
    to avoid detection by the local antivirus.
  id: totrans-893
  prefs: []
  type: TYPE_NORMAL
  zh: 提升权限的第一个选项是从Metasploit运行`exploit/windows/local/ask`，这将启动“RunAs”攻击。这将创建一个可执行文件，当调用时，将运行一个程序来请求提升的权限。可执行文件应使用`EXE::Custom`选项创建，或者使用`Veil-Evasion`加密，以避免本地杀毒软件的检测。
- en: The disadvantage of the `RunAs` attack is that the user will be prompted that
    a program from an unknown publisher wants to make changes to the computer. This
    alert may cause the privilege escalation to be identified as an attack.
  id: totrans-894
  prefs: []
  type: TYPE_NORMAL
  zh: “RunAs”攻击的缺点是用户将收到警告，即来自未知发布者的程序想要对计算机进行更改。此警报可能导致特权升级被识别为攻击。
- en: If the system's current user is in an administrator's group, and if the UAC
    is set to the default **Notify me only when programs try to make changes to my
    computer** (it will not work if set to **Always Notify**), an attacker will be
    able to use the Metasploit `exploit/windows/local/bypassuac` module to elevate
    their privileges.
  id: totrans-895
  prefs: []
  type: TYPE_NORMAL
  zh: 如果系统的当前用户属于管理员组，并且UAC设置为默认的“仅在程序尝试更改计算机时通知我”（如果设置为“始终通知”则不起作用），攻击者将能够使用Metasploit
    `exploit/windows/local/bypassuac`模块来提升其权限。
- en: The `bypassuac` module creates multiple artifacts on the target system and can
    be recognized by most antivirus software. However, the `exploit/windows/local/bypassuac_inject`
    module places the executable directly into a reflective DLL running in memory,
    and it does not touch the hard disk, minimizing the opportunity for detection
    by the antivirus software.
  id: totrans-896
  prefs: []
  type: TYPE_NORMAL
  zh: '`bypassuac`模块在目标系统上创建多个工件，并且大多数防病毒软件都能识别。但是，`exploit/windows/local/bypassuac_inject`模块将可执行文件直接放入运行内存中的反射DLL中，并且不会触及硬盘，最大程度地减少了被防病毒软件检测到的机会。'
- en: 'Some caveats when attempting to bypass the UAC controls are as follows:'
  id: totrans-897
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试绕过UAC控制时的一些注意事项如下：
- en: Bypass UAC attacks do not work against Windows Vista where the user needs to
    acknowledge every privileged access.
  id: totrans-898
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绕过UAC攻击不适用于Windows Vista，用户需要确认每个特权访问。
- en: Windows 8 remains vulnerable to this attack. However, Metasploit Framework attack
    does not presently work with Windows 8.1\. If it is attempted, the user will be
    prompted to click on an OK button before the attack can obtain elevated privileges—which
    is hardly a stealthy attack. Attackers can modify the attack by selecting to use
    `exploit/windows/local/ask`, which will improve the chance of success.
  id: totrans-899
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Windows 8仍然容易受到这种攻击。但是，Metasploit Framework攻击目前不适用于Windows 8.1。如果尝试，用户将被提示点击“确定”按钮，然后攻击才能获得提升的特权——这几乎不是一个隐秘的攻击。攻击者可以通过选择使用`exploit/windows/local/ask`来修改攻击，这将提高成功的机会。
- en: When considering system-to-system movement (horizontal/lateral escalation),
    and if the current user is a domain user with local admin privileges on other
    systems, you can use the existing authentication token to gain access and bypass
    UAC. A common attack to achieve this is the Metasploit `exploit/windows/local/current_user_psexec`.
  id: totrans-900
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在考虑系统间移动（水平/横向升级）时，如果当前用户是域用户，并且在其他系统上具有本地管理员特权，您可以使用现有的身份验证令牌来获取访问权限并绕过UAC。实现这一点的常见攻击是Metasploit
    `exploit/windows/local/current_user_psexec`。
- en: Conducting a rapid reconnaissance of a compromised system
  id: totrans-901
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 对受损系统进行快速侦察
- en: Once a system has been compromised, the attacker needs to gain critical information
    about that system, its network environment, users, and user accounts. Usually,
    they will enter a series of commands or a script invoking these commands from
    the shell prompt.
  id: totrans-902
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦系统被攻击，攻击者需要获取有关该系统、其网络环境、用户和用户帐户的关键信息。通常，他们将从shell提示符输入一系列命令或调用这些命令的脚本。
- en: 'If the compromised system is based on the Unix platform, typical local reconnaissance
    commands will include the following:'
  id: totrans-903
  prefs: []
  type: TYPE_NORMAL
  zh: 如果受损系统基于Unix平台，则典型的本地侦察命令将包括以下内容：
- en: '| Command | Description |'
  id: totrans-904
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 描述 |'
- en: '| --- | --- |'
  id: totrans-905
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `/etc/resolv.conf` | Use the `copy` command to access and review the system''s
    current DNS settings. Because it is a global file with read privileges, it will
    not trigger alarms when accessed. |'
  id: totrans-906
  prefs: []
  type: TYPE_TB
  zh: '| `/etc/resolv.conf` | 使用`copy`命令访问和查看系统当前的DNS设置。因为它是一个具有读权限的全局文件，所以在访问时不会触发警报。
    |'
- en: '| `/etc/passwd` and `/etc/shadow` | These are system files that contains username
    and password hashes. It can be copied by a person with root-level access, and
    the passwords can be broken using a tool such as John the Ripper. |'
  id: totrans-907
  prefs: []
  type: TYPE_TB
  zh: '| `/etc/passwd`和`/etc/shadow` | 这些是包含用户名和密码哈希的系统文件。具有根级访问权限的人可以复制它，并可以使用诸如John
    the Ripper之类的工具来破解密码。 |'
- en: '| `whoami and who -a` | Identify the users on a local system. |'
  id: totrans-908
  prefs: []
  type: TYPE_TB
  zh: '| `whoami and who -a` | 识别本地系统上的用户。 |'
- en: '| `ifconfig -a`, `iptables -L -n`, and `netstat -r` | Provide networking information.
    `ifconfig -a` provides IP addressing details, `iptables -L -n` lists all of the
    rules held in the local firewall (if present), and `netstat -r` displays the routing
    information maintained by the kernel. |'
  id: totrans-909
  prefs: []
  type: TYPE_TB
  zh: '| `ifconfig -a`，`iptables -L -n`和`netstat -r` | 提供网络信息。`ifconfig -a`提供IP地址详细信息，`iptables
    -L -n`列出本地防火墙中保存的所有规则（如果存在），`netstat -r`显示内核维护的路由信息。 |'
- en: '| `uname -a` | Prints the kernel version. |'
  id: totrans-910
  prefs: []
  type: TYPE_TB
  zh: '| `uname -a` | 打印内核版本。 |'
- en: '| `ps aux` | Prints currently running services, the process ID, and additional
    information. |'
  id: totrans-911
  prefs: []
  type: TYPE_TB
  zh: '| `ps aux` | 打印当前运行的服务、进程ID和其他信息。 |'
- en: '| `dpkg -l yum list &#124; grep installed` and `dpkg -l rpm -qa --last &#124;
    head` | Identify the installed software packages. |'
  id: totrans-912
  prefs: []
  type: TYPE_TB
  zh: '| `dpkg -l yum list &#124; grep installed`和`dpkg -l rpm -qa --last &#124; head`
    | 识别已安装的软件包。 |'
- en: These commands contain a brief synopsis of the available options. Refer to the
    appropriate command's help file for complete information on how it can be used.
  id: totrans-913
  prefs: []
  type: TYPE_NORMAL
  zh: 这些命令包含了可用选项的简要概述。有关如何使用它的完整信息，请参考相应命令的帮助文件。
- en: 'For a Windows system, the following commands will be entered:'
  id: totrans-914
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Windows系统，将输入以下命令：
- en: '| Command | Description |'
  id: totrans-915
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 描述 |'
- en: '| --- | --- |'
  id: totrans-916
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `whoami /all` | Lists the current user, SID, user privileges, and groups.
    |'
  id: totrans-917
  prefs: []
  type: TYPE_TB
  zh: '| `whoami /all` | 列出当前用户、SID、用户特权和组。 |'
- en: '| `ipconfig /all` and `ipconfig /displaydns` | Display information regarding
    the network interface, connectivity protocols, and local DNS cache. |'
  id: totrans-918
  prefs: []
  type: TYPE_TB
  zh: '| `ipconfig /all`和`ipconfig /displaydns` | 显示有关网络接口、连接协议和本地DNS缓存的信息。 |'
- en: '| `netstat -bnao` and `netstat -r` | List the ports and connections with corresponding
    processes (`-b`) to no lookups (`-n`), all connections (`-a`), and parent process
    IDs (`-o`). The `-r` option displays the routing table. They require administrator
    rights to run. |'
  id: totrans-919
  prefs: []
  type: TYPE_TB
  zh: '| `netstat -bnao`和`netstat -r` | 列出端口和连接以及相应的进程（`-b`）到无查找（`-n`），所有连接（`-a`）和父进程ID（`-o`）。`-r`选项显示路由表。它们需要管理员权限才能运行。
    |'
- en: '| `net view` and `net view /domain` | Queries NBNS/SMB to locate all of the
    hosts in the current workgroup or domain. All of the domains available to the
    host are given by `/domain` . |'
  id: totrans-920
  prefs: []
  type: TYPE_TB
  zh: '| `net view` 和 `net view /domain` | 查询NBNS/SMB以定位当前工作组或域中的所有主机。使用 `/domain`
    可以获取主机可用的所有域。 |'
- en: '| `net user /domain` | Lists all of the users in the defined domain. |'
  id: totrans-921
  prefs: []
  type: TYPE_TB
  zh: '| `net user /domain` | 列出定义域中的所有用户。 |'
- en: '| `net user %username% /domain` | Obtains information on the current user if
    they are part of the queried domain (if you are local user, then `/domain` is
    not required). It includes the login times, the last time that the password was
    changed, the logon scripts, and the group memberships. |'
  id: totrans-922
  prefs: []
  type: TYPE_TB
  zh: '| `net user %username% /domain` | 如果用户是查询的域的一部分，则获取有关当前用户的信息（如果您是本地用户，则不需要
    `/domain`）。它包括登录时间、上次更改密码的时间、登录脚本和组成员资格。 |'
- en: '| `net accounts` | Prints the password policy for the local system. To print
    the password policy for the domain, use `net accounts /domain`. |'
  id: totrans-923
  prefs: []
  type: TYPE_TB
  zh: '| `net accounts` | 打印本地系统的密码策略。要打印域的密码策略，请使用 `net accounts /domain`。 |'
- en: '| `net localgroup administrators` | Prints the members of the administrator''s
    local group. Use the `/domain` switch to obtain the administrators for the current
    domain. |'
  id: totrans-924
  prefs: []
  type: TYPE_TB
  zh: '| `net localgroup administrators` | 打印管理员本地组的成员。使用 `/domain` 开关获取当前域的管理员。 |'
- en: '| `net group "Domain Controllers" /domain` | Prints the list of domain controllers
    for the current domain. |'
  id: totrans-925
  prefs: []
  type: TYPE_TB
  zh: '| `net group "Domain Controllers" /domain` | 打印当前域的域控制器列表。 |'
- en: '| `net share` | Displays the current shared folders, which may not provide
    sufficient access controls for the data shared within the folders, and the paths
    that they point to. |'
  id: totrans-926
  prefs: []
  type: TYPE_TB
  zh: '| `net share` | 显示当前共享的文件夹，这些文件夹中共享的数据可能没有足够的访问控制，并显示它们指向的路径。 |'
- en: Using the WMIC scripting language
  id: totrans-927
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用WMIC脚本语言
- en: 'On newer systems, attackers and penetration testers take advantage of built-in
    scripting languages, for example, **Windows Management Instrumentation Command-line**
    (**WMIC**), a command-line and scripting interface that is used to simplify access
    to Windows Instrumentation. If the compromised system supports WMIC, several commands
    can be used to gather information. Refer to the following table:'
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
  zh: 在较新的系统上，攻击者和渗透测试人员利用内置的脚本语言，例如**Windows管理规范命令行**（**WMIC**），这是一个用于简化访问Windows管理的命令行和脚本接口。如果受损系统支持WMIC，则可以使用多个命令来收集信息。参考以下表格：
- en: '| Command | Description |'
  id: totrans-929
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 描述 |'
- en: '| --- | --- |'
  id: totrans-930
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `wmic nicconfig get ipaddress,macaddress` | Obtains the IP address and MAC
    address |'
  id: totrans-931
  prefs: []
  type: TYPE_TB
  zh: '| `wmic nicconfig get ipaddress,macaddress` | 获取IP地址和MAC地址 |'
- en: '| `wmic computersystem get username` | Verifies the account that was compromised
    |'
  id: totrans-932
  prefs: []
  type: TYPE_TB
  zh: '| `wmic computersystem get username` | 验证被 compromise 的帐户 |'
- en: '| `wmic netlogin get name, lastlogon` | Determines who used this system last
    and when they last logged on |'
  id: totrans-933
  prefs: []
  type: TYPE_TB
  zh: '| `wmic netlogin get name, lastlogon` | 确定谁最后使用了这个系统以及他们上次登录的时间 |'
- en: '| `wmic desktop get screensaversecure, screensavertimeout` | Determines whether
    the screensavers are password protected and what the timeout is |'
  id: totrans-934
  prefs: []
  type: TYPE_TB
  zh: '| `wmic desktop get screensaversecure, screensavertimeout` | 确定屏幕保护程序是否受密码保护以及超时时间
    |'
- en: '| `wmic logon get authenticationpackage` | Determines which logon methods are
    supported |'
  id: totrans-935
  prefs: []
  type: TYPE_TB
  zh: '| `wmic logon get authenticationpackage` | 确定支持哪些登录方法 |'
- en: '| `wmic process get caption, executablepath, commandline` | Identifies system
    processes |'
  id: totrans-936
  prefs: []
  type: TYPE_TB
  zh: '| `wmic process get caption, executablepath, commandline` | 识别系统进程 |'
- en: '| `wmic process where name="process_name" call terminate` | Terminates specific
    processes |'
  id: totrans-937
  prefs: []
  type: TYPE_TB
  zh: '| `wmic process where name="process_name" call terminate` | 终止特定进程 |'
- en: '| `wmic os get name, servicepackmajorversion` | Determines the system''s operating
    system |'
  id: totrans-938
  prefs: []
  type: TYPE_TB
  zh: '| `wmic os get name, servicepackmajorversion` | 确定系统的操作系统 |'
- en: '| `wmic product get name, version` | Identifies installed software |'
  id: totrans-939
  prefs: []
  type: TYPE_TB
  zh: '| `wmic product get name, version` | 识别已安装的软件 |'
- en: '| `wmic product where name="name'' call uninstall /nointeractive` | Uninstalls
    or removes defined software packages |'
  id: totrans-940
  prefs: []
  type: TYPE_TB
  zh: '| `wmic product where name="name'' call uninstall /nointeractive` | 卸载或移除已定义的软件包
    |'
- en: '| `wmic share get /ALL` | Identifies the shares accessible by the user |'
  id: totrans-941
  prefs: []
  type: TYPE_TB
  zh: '| `wmic share get /ALL` | 识别用户可访问的共享 |'
- en: '| `wmic /node:"machinename" path Win32_TerminalServiceSetting where AllowTSConnections="0"
    call SetAllowTSConnections "1"` | Starts RDP remotely |'
  id: totrans-942
  prefs: []
  type: TYPE_TB
  zh: '| `wmic /node:"machinename" path Win32_TerminalServiceSetting where AllowTSConnections="0"
    call SetAllowTSConnections "1"` | 远程启动RDP |'
- en: '| `wmic nteventlog get path, filename, writeable` | Finds all of the system
    event logs and ensures that they can be modified (used when it is time to cover
    your tracks) |'
  id: totrans-943
  prefs: []
  type: TYPE_TB
  zh: '| `wmic nteventlog get path, filename, writeable` | 查找所有系统事件日志，并确保它们可以被修改（在覆盖痕迹时使用）
    |'
- en: PowerShell is a scripting language built on the .NET Framework that runs from
    a console, giving the user access to the Windows filesystem and objects such as
    the registry. It is installed by default on the Windows 7 operating system and
    higher versions. PowerShell extends the scripting support and automation offered
    by WMIC by permitting the use of shell integration and interoperability on both
    local and remote targets.
  id: totrans-944
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell是建立在.NET Framework上的脚本语言，从控制台运行，使用户可以访问Windows文件系统和诸如注册表之类的对象。它默认安装在Windows
    7操作系统和更高版本上。PowerShell通过允许在本地和远程目标上使用shell集成和互操作性，扩展了WMIC提供的脚本支持和自动化。
- en: PowerShell gives testers access to a shell and scripting language on a compromised
    system. Since it is native to the Windows operating system, its use of the commands
    does not trigger the antivirus software. When scripts are run on a remote system,
    PowerShell does not write to the disk, bypassing the antivirus and whitelisting
    the controls (assuming that the user has permitted the use of PowerShell).
  id: totrans-945
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell为测试人员提供了对受损系统上的shell和脚本语言的访问。由于它是Windows操作系统的本机功能，其命令的使用不会触发防病毒软件。当在远程系统上运行脚本时，PowerShell不会写入磁盘，从而绕过防病毒软件和白名单控制（假设用户已允许使用PowerShell）。
- en: 'PowerShell supports a number of built-in functions that are referred to as
    cmdlets. One of the advantages of PowerShell is that cmdlets are aliased to common
    Unix commands, so entering the `ls` command will return a typical directory listing,
    as shown in the following screenshot:'
  id: totrans-946
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell支持许多内置函数，称为cmdlet。PowerShell的一个优点是cmdlet被别名为常见的Unix命令，因此输入`ls`命令将返回典型的目录列表，如下面的屏幕截图所示：
- en: '![Using the WMIC scripting language](img/3121OS_05_02.jpg)'
  id: totrans-947
  prefs: []
  type: TYPE_IMG
  zh: ！[使用WMIC脚本语言](img/3121OS_05_02.jpg)
- en: 'PowerShell is a rich language capable of supporting very complex operations;
    it is recommended that the user spend the time to become familiar with its use.
    Some of the simpler commands that can be used immediately following a compromise
    are described in the following table:'
  id: totrans-948
  prefs: []
  type: TYPE_NORMAL
  zh: PowerShell是一种功能丰富的语言，能够支持非常复杂的操作；建议用户花时间熟悉其使用。以下表格描述了一些可以在受损后立即使用的较简单的命令：
- en: '| Command | Description |'
  id: totrans-949
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 描述 |'
- en: '| --- | --- |'
  id: totrans-950
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `Get-Host &#124; Select Version` | Identifies the version of PowerShell used
    by the victim''s system. Some cmdlets are added or invoked in different versions.
    |'
  id: totrans-951
  prefs: []
  type: TYPE_TB
  zh: '| `Get-Host &#124; Select Version` | 识别受害者系统使用的PowerShell版本。一些cmdlet在不同版本中被添加或调用。'
- en: '| `Get-Hotfix` | Identifies the installed security patches and system hotfixes.
    |'
  id: totrans-952
  prefs: []
  type: TYPE_TB
  zh: '| `Get-Hotfix` | 识别已安装的安全补丁和系统热修复。 |'
- en: '| `Get-Acl` | Identifies the group names and usernames. |'
  id: totrans-953
  prefs: []
  type: TYPE_TB
  zh: '| `Get-Acl` | 识别组名和用户名。 |'
- en: '| `Get-Process, Get-Service` | Lists the current processes and services. |'
  id: totrans-954
  prefs: []
  type: TYPE_TB
  zh: '| `Get-Process, Get-Service` | 列出当前的进程和服务。 |'
- en: '| `gwmi win32_useraccount` | Invokes WMI to list the user accounts. |'
  id: totrans-955
  prefs: []
  type: TYPE_TB
  zh: '| `gwmi win32_useraccount` | 调用WMI列出用户帐户。 |'
- en: '| `Gwmi_win32_group` | Invokes WMI to list the SIDs, names, and domain groups.
    |'
  id: totrans-956
  prefs: []
  type: TYPE_TB
  zh: '| `Gwmi_win32_group` | 调用WMI列出SID、名称和域组。 |'
- en: Penetration testers can use Windows native commands, DLLs, .NET functions, WMI
    calls, and PowerShell cmdlets together to create PowerShell scripts with the extension
    `.ps1`.
  id: totrans-957
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试人员可以将Windows本机命令、DLL、.NET函数、WMI调用和PowerShell cmdlet结合在一起，创建扩展名为`.ps1`的PowerShell脚本。
- en: Tip
  id: totrans-958
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: During a recent penetration test, we were prohibited from installing any executable
    software on the client's systems. We used a PowerShell keylogger on a compromised
    system to grab administrator-level credentials and then compromised most of the
    systems on the network. The most effective exploit and post-exploit scripts, including
    the keylogger, are part of Nikhil Mittal's `Nishang` package ([https://code.google.com/p/nishang/downloads/detail?name=nishang_0.3.0.zip](https://code.google.com/p/nishang/downloads/detail?name=nishang_0.3.0.zip)).
  id: totrans-959
  prefs: []
  type: TYPE_NORMAL
  zh: 在最近的渗透测试中，我们被禁止在客户系统上安装任何可执行软件。我们在一个受损的系统上使用了一个PowerShell键盘记录器来获取管理员级别的凭据，然后侵入了网络上的大多数系统。最有效的利用和后利用脚本，包括键盘记录器，都是Nikhil
    Mittal的`Nishang`包的一部分（[https://code.google.com/p/nishang/downloads/detail?name=nishang_0.3.0.zip](https://code.google.com/p/nishang/downloads/detail?name=nishang_0.3.0.zip)）。
- en: 'Reconnaissance should also extend to the local network. Since you are working
    "blind," you will need to create a map of live systems and subnets that the compromised
    host can communicate with. Start by entering `IFCONFIG` (Unix-based systems) or
    `IPCONFIG /ALL` (Windows systems) in the shell prompt. This will allow an attacker
    to determine the following:'
  id: totrans-960
  prefs: []
  type: TYPE_NORMAL
  zh: 侦察还应扩展到本地网络。由于您是“盲目”的，您需要创建一个可以与受损主机通信的活动系统和子网的地图。首先，在shell提示符中输入`IFCONFIG`（基于Unix的系统）或`IPCONFIG
    /ALL`（Windows系统）。这将允许攻击者确定以下内容：
- en: Whether DHCP addressing is enabled.
  id: totrans-961
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是否启用了DHCP寻址。
- en: The local IP address, which will also identify at least one active subnet.
  id: totrans-962
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本地IP地址，这也将识别至少一个活动子网。
- en: The gateway IP address and DNS server address. System administrators usually
    follow a numbering convention across the network, and if an attacker knows one
    address, such as a gateway server `172.16.21.5`, they will ping addresses such
    as `172.16.20.5`, `172.16.22.5`, and so on to find additional subnets.
  id: totrans-963
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网关IP地址和DNS服务器地址。系统管理员通常在整个网络上遵循编号约定，如果攻击者知道一个地址，比如网关服务器`172.16.21.5`，他们将ping地址，比如`172.16.20.5`，`172.16.22.5`等等，以找到其他子网。
- en: The domain name used to leverage **Active Directory** accounts.
  id: totrans-964
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于利用**Active Directory**账户的域名。
- en: If the attacking system and the target system are using Windows, the `net view`
    command can be used to enumerate other Windows systems on the network. Attackers
    use the `netstat -rn` command to review the routing table, which may contain static
    routes to networks or systems of interest.
  id: totrans-965
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击系统和目标系统都使用Windows，则可以使用`net view`命令枚举网络上的其他Windows系统。攻击者使用`netstat -rn`命令来查看路由表，其中可能包含对感兴趣的网络或系统的静态路由。
- en: The local network can be scanned using `nmap` to sniff for ARP broadcasts. In
    addition, Kali has several tools that can be used for an SNMP endpoint analysis,
    including `nmap`, `onesixtyone`, and `snmpcheck`.
  id: totrans-966
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用`nmap`扫描本地网络以嗅探ARP广播。此外，Kali还有几个工具可用于SNMP端点分析，包括`nmap`、`onesixtyone`和`snmpcheck`。
- en: 'Deploying a packet sniffer to map traffic will help you identify hostnames,
    active subnets, and domain names. If DHCP addressing is not enabled, it will also
    allow attackers to identify any unused, static IP addresses. Kali is preconfigured
    with Wireshark (a GUI-based packet sniffer) but you can also use `tshark` in a
    post-exploitation script or from the command line, as shown in the following screenshot:'
  id: totrans-967
  prefs: []
  type: TYPE_NORMAL
  zh: 部署数据包嗅探器以映射流量将帮助您识别主机名、活动子网和域名。如果未启用DHCP寻址，它还将允许攻击者识别任何未使用的静态IP地址。Kali预配置了Wireshark（基于GUI的数据包嗅探器），但您也可以在后利用脚本中或从命令行中使用`tshark`，如下面的屏幕截图所示：
- en: '![Using the WMIC scripting language](img/3121OS_05_03.jpg)'
  id: totrans-968
  prefs: []
  type: TYPE_IMG
  zh: ！[使用WMIC脚本语言](img/3121OS_05_03.jpg)
- en: Finding and taking sensitive data – pillaging the target
  id: totrans-969
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查找和获取敏感数据-掠夺目标
- en: The term **pillaging** (sometimes known as **pilfering**) is a holdover from
    the days when hackers who had successfully compromised a system saw themselves
    as pirates racing to their target to steal or damage as much data as possible.
    The terms have survived as a reference to the much more careful practice of stealing
    or modifying proprietary or financial data when the objective of the exploit has
    been achieved.
  id: totrans-970
  prefs: []
  type: TYPE_NORMAL
  zh: 术语**掠夺**（有时被称为**偷窃**）是黑客成功侵入系统后，将自己视为海盗，竞相赶到目标地点窃取或破坏尽可能多的数据的遗留物。这些术语作为参考，仍然存在，用于指代在实现利用的目标后，更加谨慎地窃取或修改专有或财务数据的做法。
- en: 'The attacker can then focus on the secondary target—system files that will
    provide information to support additional attacks. The choice of the secondary
    files will depend on the operating system of the target. For example, if the compromised
    system is Unix, then the attacker will also target the following:'
  id: totrans-971
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，攻击者可以专注于次要目标——提供信息以支持额外攻击的系统文件。次要文件的选择将取决于目标的操作系统。例如，如果受损的系统是Unix，则攻击者还将针对以下目标：
- en: The system and configuration files (usually in the `/etc` directory, but depending
    on the implementation, they may be in `/usr/local/etc` or other locations)
  id: totrans-972
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统和配置文件（通常在`/etc`目录中，但根据实现方式，它们可能在`/usr/local/etc`或其他位置）
- en: The password files (`/etc/password` and `/etc/shadow`)
  id: totrans-973
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码文件（`/etc/password`和`/etc/shadow`）
- en: The configuration files and public/private keys in the `.ssh` directory
  id: totrans-974
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`.ssh`目录中的配置文件和公钥/私钥'
- en: The public and private key rings that may be contained in the `.gnupg` directory
  id: totrans-975
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`.gnupg`目录中可能包含的公钥和私钥环'
- en: The e-mail and data files
  id: totrans-976
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电子邮件和数据文件
- en: 'In a Windows system, the attacker will target the following:'
  id: totrans-977
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows系统中，攻击者将针对以下目标：
- en: The system memory, which can be used to extract passwords, encryption keys,
    and so on
  id: totrans-978
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统内存，可用于提取密码、加密密钥等。
- en: The system registry files
  id: totrans-979
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统注册表文件
- en: The **Security Accounts Manager** (**SAM**) database that contains hashed versions
    of the password, or alternative versions of the SAM database which may be found
    in `%SYSTEMROOT%\repair\SAM` and `%SYSTEMROOT%\System32\config\RegBack\SAM`
  id: totrans-980
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含密码的**安全账户管理器**（**SAM**）数据库的哈希版本，或者可能在`%SYSTEMROOT%\repair\SAM`和`%SYSTEMROOT%\System32\config\RegBack\SAM`中找到的SAM数据库的其他版本
- en: Any other password or seed files used for encryption
  id: totrans-981
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于加密的任何其他密码或种子文件
- en: The e-mail and data files
  id: totrans-982
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电子邮件和数据文件
- en: Tip
  id: totrans-983
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Don't forget to review folders that contain temporary items, such as attachments.
    For example, `UserProfile\AppData\Local\Microsoft\Windows\Temporary Internet Files\`
    may contain files, images, and cookies that may be of interest.
  id: totrans-984
  prefs: []
  type: TYPE_NORMAL
  zh: 不要忘记查看包含临时项目的文件夹，例如附件。例如，`UserProfile\AppData\Local\Microsoft\Windows\Temporary
    Internet Files\`可能包含感兴趣的文件、图像和Cookie。
- en: 'As stated, the system memory contains a significant amount of information for
    any attacker. Therefore, it is usually a priority file that you need to obtain.
    The system memory can be downloaded as a single image file from several sources
    as follows:'
  id: totrans-985
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，系统内存对于任何攻击者来说包含大量信息。因此，通常是您需要获取的优先文件。系统内存可以从以下几个来源下载为单个镜像文件：
- en: By uploading a tool to the compromised system and then directly copying the
    memory (the tools include **Belkasoft RAM capturer**, **MandiantMemoryze**, and
    **MonsolsDumpIt**).
  id: totrans-986
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过上传工具到受损系统，然后直接复制内存（工具包括**Belkasoft RAM capturer**、**MandiantMemoryze**和**MonsolsDumpIt**）。
- en: By copying Windows hibernation file, `hiberfil.sys` and then using Volatility
    to decrypt and analyze the file. Volatility, found on Kali in the `Forensics`
    menu, is a framework that was written to analyze memory dumps from the system
    RAM and other files containing system memory. It relies on plugins written in
    Python to analyze the memory and extract data, such as encryption keys, passwords,
    registry information, processes, and connectivity information.
  id: totrans-987
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过复制Windows休眠文件`hiberfil.sys`，然后使用Kali中的`取证`菜单中的Volatility来解密和分析文件。Volatility是一个框架，用于分析系统RAM和其他包含系统内存的文件的内存转储。它依赖于用Python编写的插件来分析内存并提取数据，如加密密钥、密码、注册表信息、进程和连接信息。
- en: By copying a virtual machine and converting the VMEM file to a memory file.
  id: totrans-988
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过复制虚拟机并将VMEM文件转换为内存文件。
- en: Tip
  id: totrans-989
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: If you upload a program designed to capture memory onto a compromised system,
    it is possible that this particular application will be identified as malicious
    software by an antivirus software. Most antivirus software applications recognize
    the hash signature and behavior of memory acquisition software, and act to protect
    the sensitive contents of the physical memory by raising an alarm if it is at
    risk of disclosure. The acquisition software will be quarantined, and the target
    will receive a warning alerting them of the attack.
  id: totrans-990
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您将设计用于捕获内存的程序上传到受损系统，可能会被防病毒软件识别为恶意软件。大多数防病毒软件应用程序会识别内存获取软件的哈希签名和行为，并在内存内容面临泄露风险时发出警报以保护敏感内容。获取软件将被隔离，并且目标将收到警报，提醒他们受到攻击。
- en: 'To avoid this, use Metasploit Framework to run the executable completely in
    the target''s memory using the following command:'
  id: totrans-991
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免这种情况，使用Metasploit Framework在目标的内存中完全运行可执行文件，使用以下命令：
- en: '[PRE35]'
  id: totrans-992
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The previous command executes `calc.exe` as a dummy executable but uploads the
    memory acquisition executable to run in its process space instead.
  id: totrans-993
  prefs: []
  type: TYPE_NORMAL
  zh: 先前的命令将`calc.exe`作为虚拟可执行文件执行，但上传内存获取可执行文件以在其进程空间中运行。
- en: The executable doesn't show up in process lists, such as Task Manager, and detection
    using data forensic techniques is much harder because it's not written to disk.
    Furthermore, it will avoid the system's antivirus software, which generally does
    not scan the memory space in search of malware.
  id: totrans-994
  prefs: []
  type: TYPE_NORMAL
  zh: 可执行文件不会显示在诸如任务管理器之类的进程列表中，使用数据取证技术进行检测要困难得多，因为它没有写入磁盘。此外，它将避开系统的防病毒软件，因为通常不会扫描内存空间以寻找恶意软件。
- en: 'Once the physical memory has been downloaded, it can be analyzed using Volatility
    Framework, a collection of Python scripts designed to forensically analyze memory.
    If the operating system is supported, Volatility will scan the memory file and
    extract the following:'
  id: totrans-995
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦物理内存被下载，就可以使用Volatility Framework对其进行分析，这是一组用于法庭取证分析内存的Python脚本集。如果操作系统受支持，Volatility将扫描内存文件并提取以下内容：
- en: The image information and system data sufficient to *tie* the image to its source
    system.
  id: totrans-996
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 足以将图像与其源系统*联系*起来的图像信息和系统数据。
- en: The running processes, loaded DLLs, threads, sockets, connections, and modules.
  id: totrans-997
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行的进程、加载的DLL、线程、套接字、连接和模块。
- en: The open network sockets and connections, and recently opened network connections.
  id: totrans-998
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 打开的网络套接字和连接，以及最近打开的网络连接。
- en: The memory address, including physical and virtual memory mapping.
  id: totrans-999
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内存地址，包括物理和虚拟内存映射。
- en: 'The LM/NTLM hashes and LSA secrets. **LanMan** (**LM**) password hashes are
    Microsoft''s original attempt at protecting passwords. Over the years, it has
    become simple to break them and convert the hashes back into an actual password.
    **NT LanMan** (**NTLM**) hashes are more recent and resilient to attack. However,
    they are usually stored with the NTLM versions for the purpose of backward compatibility.
    **Local Security Authority** (**LSA**) stores "secrets" that are local passwords:
    remote access (wired or wireless), VPN, autologon passwords, and so on. Any passwords
    stored on the system are vulnerable, especially if the user reuses passwords.'
  id: totrans-1000
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LM/NTLM哈希和LSA秘密。**LanMan**（**LM**）密码哈希是微软最初尝试保护密码的方法。多年来，它变得很容易破解，并将哈希转换回实际密码。**NT
    LanMan**（**NTLM**）哈希是更近期的，对攻击更有韧性。然而，它们通常与NTLM版本一起存储，以实现向后兼容性的目的。**本地安全机构**（**LSA**）存储本地密码的“秘密”：远程访问（有线或无线）、VPN、自动登录密码等。系统上存储的任何密码都是脆弱的，特别是如果用户重复使用密码。
- en: Specific regular expressions or strings stored in memory.
  id: totrans-1001
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储在内存中的特定正则表达式或字符串。
- en: Using the sample image for a system infected with Zeus malware ([https://code.google.com/p/volatility/wiki/SampleMemoryImages](https://code.google.com/p/volatility/wiki/SampleMemoryImages)),
    we'll use Volatility Framework to extract the encrypted LanMan password hashes.
  id: totrans-1002
  prefs: []
  type: TYPE_NORMAL
  zh: 使用感染了Zeus恶意软件的系统的示例图像（[https://code.google.com/p/volatility/wiki/SampleMemoryImages](https://code.google.com/p/volatility/wiki/SampleMemoryImages)），我们将使用Volatility
    Framework来提取加密的LanMan密码哈希。
- en: 'The first step is to determine the type of image and the operating system using
    the following command:'
  id: totrans-1003
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是使用以下命令确定图像类型和操作系统：
- en: '[PRE36]'
  id: totrans-1004
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'The execution of the previous command is shown in the following screenshot:'
  id: totrans-1005
  prefs: []
  type: TYPE_NORMAL
  zh: 上一条命令的执行如下截图所示：
- en: '![Finding and taking sensitive data – pillaging the target](img/3121OS_05_04.jpg)'
  id: totrans-1006
  prefs: []
  type: TYPE_IMG
  zh: '![查找和获取敏感数据-掠夺目标](img/3121OS_05_04.jpg)'
- en: 'The **hivelist** plugin will print out the initial virtual memory location
    for the various registry hives when it is called using the following command:'
  id: totrans-1007
  prefs: []
  type: TYPE_NORMAL
  zh: '**hivelist**插件将在调用以下命令时打印出各个注册表蜂巢的初始虚拟内存位置：'
- en: '[PRE37]'
  id: totrans-1008
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The execution of the previous command is shown in the following screenshot:'
  id: totrans-1009
  prefs: []
  type: TYPE_NORMAL
  zh: 上一条命令的执行如下截图所示：
- en: '![Finding and taking sensitive data – pillaging the target](img/3121OS_05_05.jpg)'
  id: totrans-1010
  prefs: []
  type: TYPE_IMG
  zh: '![查找和获取敏感数据-掠夺目标](img/3121OS_05_05.jpg)'
- en: 'In order to dump the hashes, the initial virtual memory locations of both the
    SAM and SYSTEM hives are required. Using the following command the results are
    piped to a comma-delimited file to be directly imported by a password-cracking
    application:'
  id: totrans-1011
  prefs: []
  type: TYPE_NORMAL
  zh: 为了转储哈希，需要SAM和SYSTEM蜂巢的初始虚拟内存位置。使用以下命令，结果被导入到逗号分隔的文件中，以便由密码破解应用程序直接导入：
- en: '[PRE38]'
  id: totrans-1012
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'The execution of the previous command is shown in the following screenshot:'
  id: totrans-1013
  prefs: []
  type: TYPE_NORMAL
  zh: 上一条命令的执行如下截图所示：
- en: '![Finding and taking sensitive data – pillaging the target](img/3121OS_05_06.jpg)'
  id: totrans-1014
  prefs: []
  type: TYPE_IMG
  zh: '![查找和获取敏感数据-掠夺目标](img/3121OS_05_06.jpg)'
- en: The isolated LM hashes can be cracked using Hashcat, John the Ripper, Ophcrack,
    and Rainbow Tables.
  id: totrans-1015
  prefs: []
  type: TYPE_NORMAL
  zh: 孤立的LM哈希可以使用Hashcat、John the Ripper、Ophcrack和Rainbow Tables进行破解。
- en: Creating additional accounts
  id: totrans-1016
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建额外的帐户
- en: 'The following commands are highly invasive and are usually detected by the
    system owner during the incident response process. However, they are frequently
    planted by an attacker to draw attention away from more persistent access mechanisms.
    Refer to the following table:'
  id: totrans-1017
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令是高度侵入性的，通常会在事件响应过程中被系统所有者检测到。然而，它们经常被攻击者植入，以转移对更持久的访问机制的注意力。请参阅以下表格：
- en: '| Command | Description |'
  id: totrans-1018
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 描述 |'
- en: '| --- | --- |'
  id: totrans-1019
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `net user attacker password /add` | Creates a new local account with a user
    called `attacker` with the password as `password`. |'
  id: totrans-1020
  prefs: []
  type: TYPE_TB
  zh: '| `net user attacker password /add` | 创建一个名为`attacker`的新本地帐户，密码为`password`。|'
- en: '| `net localgroup administrators attacker /add` | Adds the new user `attacker`
    to the local administrator''s group. In some cases, the command will be `net localgroup
    administrators /add attacker`. |'
  id: totrans-1021
  prefs: []
  type: TYPE_TB
  zh: '| `net localgroup administrators attacker /add` | 将新用户`attacker`添加到本地管理员组。在某些情况下，命令将是`net
    localgroup administrators /add attacker`。|'
- en: '| `net user username /active:yes /domain` | Changes an inactive or disabled
    account to active. In a small organization, this will attract attention. Large
    enterprises with poor password management can have 30 percent of their passwords
    flagged as "inactive," so it may be an effective way to gain an account. |'
  id: totrans-1022
  prefs: []
  type: TYPE_TB
  zh: '| `net user username /active:yes /domain` | 将非活动或禁用的帐户更改为活动状态。在小型组织中，这将引起注意。密码管理不善的大型企业可能有30%的密码被标记为“非活动”，因此这可能是一种获得帐户的有效方式。|'
- en: '| `net share name$=C:\ /grant:attacker,FULL /unlimited` | Shares `C:` (or another
    specified drive) as a Windows share, and grants the user (attacker) full rights
    to access or modify all of the content on that drive. |'
  id: totrans-1023
  prefs: []
  type: TYPE_TB
  zh: '| `net share name$=C:\ /grant:attacker,FULL /unlimited` | 将`C:`（或其他指定的驱动器）共享为Windows共享，并授予用户（攻击者）对该驱动器上所有内容的完全访问或修改权限。|'
- en: 'If you create a new user account, it will be noticed when anyone logs onto
    the welcome screen of the compromised system. To make the account invisible, you
    need to modify the registry from the command line using the following `REG` command:'
  id: totrans-1024
  prefs: []
  type: TYPE_NORMAL
  zh: 如果创建一个新用户帐户，当有人登录到受损系统的欢迎屏幕时会被注意到。要使帐户不可见，您需要使用以下`REG`命令从命令行修改注册表：
- en: '[PRE39]'
  id: totrans-1025
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: This will modify the designated registry key to hide the account of the user
    (`/V`). Again, there may be special syntax requirements based on the specific
    version of the target's operating system, so determine the Windows version first
    and then validate it in a controlled test environment before implementing it against
    the target.
  id: totrans-1026
  prefs: []
  type: TYPE_NORMAL
  zh: 这将修改指定的注册表键以隐藏用户的帐户(`/V`)。同样，根据目标操作系统的具体版本可能有特殊的语法要求，因此首先确定Windows版本，然后在受控测试环境中验证它，然后再对目标实施。
- en: Using Metasploit for post-exploit activities
  id: totrans-1027
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Metasploit进行后渗透活动
- en: Metasploit was developed to support both exploit and post-exploit activities.
    The present version contains approximately 200 modules that simplify post-exploit
    activities. We will review some of the most important modules.
  id: totrans-1028
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit被开发用于支持利用和后渗透活动。当前版本包含大约200个模块，简化了后渗透活动。我们将回顾一些最重要的模块。
- en: In the following screenshots, we have successfully exploited a Windows XP system
    (a "classic" attack that is frequently used to validate more complex aspects of
    `meterpreter`). The initial step is to conduct an immediate reconnaissance of
    the network and the compromised system.
  id: totrans-1029
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，我们成功地利用了Windows XP系统（这是一个经常用于验证`meterpreter`更复杂方面的“经典”攻击）。初始步骤是立即对网络和受损系统进行侦察。
- en: The initial `meterpreter` shell is fragile and vulnerable to failure over an
    extended period of time. Therefore, once a system is exploited, we will migrate
    the shell and bind it with a more stable process. This also makes detecting the
    exploit more difficult.
  id: totrans-1030
  prefs: []
  type: TYPE_NORMAL
  zh: 初始的`meterpreter` shell很脆弱，容易在较长时间内失败。因此，一旦系统被利用，我们将迁移shell并将其绑定到更稳定的进程上。这也使得检测利用更加困难。
- en: 'At the `meterpreter` prompt, enter `ps` to obtain a list of running processes,
    as shown in the following screenshot:'
  id: totrans-1031
  prefs: []
  type: TYPE_NORMAL
  zh: 在`meterpreter`提示符下，输入`ps`以获取正在运行的进程列表，如下面的屏幕截图所示：
- en: '![Using Metasploit for post-exploit activities](img/3121OS_05_07.jpg)'
  id: totrans-1032
  prefs: []
  type: TYPE_IMG
  zh: '![使用Metasploit进行后渗透活动](img/3121OS_05_07.jpg)'
- en: The `ps` command also returns the full pathname for each process. This was omitted
    from the previous screenshot. The `ps` list identifies that `c:\windows\Explorer.EXE`
    is running. In this particular case, it is identified with the process ID of `1460`,
    as shown in the following screenshot. As this is a generally stable application,
    we will migrate the shell to that process.
  id: totrans-1033
  prefs: []
  type: TYPE_NORMAL
  zh: '`ps`命令还返回每个进程的完整路径名。这在之前的屏幕截图中被省略了。`ps`列表确定`c:\windows\Explorer.EXE`正在运行。在这种特殊情况下，它被标识为进程ID`1460`，如下面的屏幕截图所示。由于这是一个通常稳定的应用程序，我们将把shell迁移到该进程。'
- en: '![Using Metasploit for post-exploit activities](img/3121OS_05_08.jpg)'
  id: totrans-1034
  prefs: []
  type: TYPE_IMG
  zh: '![使用Metasploit进行后渗透活动](img/3121OS_05_08.jpg)'
- en: Now that we have a stable shell connection to the remote system, we will use
    the `meterpreter` scripts that support post-exploitation activities.
  id: totrans-1035
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经与远程系统建立了稳定的shell连接，我们将使用支持后渗透活动的`meterpreter`脚本。
- en: 'One of the first parameters to identify is: are we on a virtual machine? With
    the `meterpreter` session open between the compromised system and the attacker,
    the command `run checkvm` is issued, as shown in the following screenshot. The
    returned data indicates that `This is a VMware Virtual Machine`.'
  id: totrans-1036
  prefs: []
  type: TYPE_NORMAL
  zh: 要识别的第一个参数之一是：我们是否在虚拟机上？在受损系统和攻击者之间打开`meterpreter`会话后，发出命令`run checkvm`，如下面的屏幕截图所示。返回的数据表明`这是一个VMware虚拟机`。
- en: '![Using Metasploit for post-exploit activities](img/3121OS_05_09.jpg)'
  id: totrans-1037
  prefs: []
  type: TYPE_IMG
  zh: '![使用Metasploit进行后渗透活动](img/3121OS_05_09.jpg)'
- en: 'Some of the most important post-exploit modules available through `meterpreter`
    are described in the following table:'
  id: totrans-1038
  prefs: []
  type: TYPE_NORMAL
  zh: 通过`meterpreter`可用的一些最重要的后渗透模块在下表中描述：
- en: '| Command | Description |'
  id: totrans-1039
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 描述 |'
- en: '| --- | --- |'
  id: totrans-1040
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `run checkvm` | Determines if a virtual machine is present. |'
  id: totrans-1041
  prefs: []
  type: TYPE_TB
  zh: '| `run checkvm` | 确定虚拟机是否存在。 |'
- en: '| `run getcountermeasure` | Checks the security configuration on the exploited
    system (antivirus, firewalls, and so on). |'
  id: totrans-1042
  prefs: []
  type: TYPE_TB
  zh: '| `run getcountermeasure` | 检查受损系统的安全配置（防病毒软件、防火墙等）。 |'
- en: '| `run killav` | Disables most of the antivirus services running on the compromised
    system. This script is frequently out of date, and success should be manually
    verified. |'
  id: totrans-1043
  prefs: []
  type: TYPE_TB
  zh: '| `run killav` | 禁用运行在受损系统上的大多数防病毒服务。这个脚本经常过时，成功应该手动验证。 |'
- en: '| `run hostsedit` | Allows the attacker to add entries to the Windows `HOSTS`
    file. This can divert traffic to a different site (a fake site), which will download
    additional tools or ensure that the antivirus software cannot connect to the Internet
    or a local server to obtain signature updates. |'
  id: totrans-1044
  prefs: []
  type: TYPE_TB
  zh: '| `run hostsedit` | 允许攻击者向Windows `HOSTS`文件添加条目。这可以将流量转向不同的站点（一个假站点），该站点将下载其他工具或确保防病毒软件无法连接到互联网或本地服务器以获取签名更新。
    |'
- en: '| `run winenum` | Performs a command-line and WMIC characterization of the
    exploited system. It dumps the important keys from the registry and LM hashes.
    |'
  id: totrans-1045
  prefs: []
  type: TYPE_TB
  zh: '| `run winenum` | 执行受损系统的命令行和WMIC特性描述。它从注册表和LM哈希中转储重要的键。 |'
- en: '| `run scraper` | Gathers comprehensive information that has not been gathered
    by other scripts, such as the entire Window registry. |'
  id: totrans-1046
  prefs: []
  type: TYPE_TB
  zh: '| `run scraper` | 收集其他脚本未收集的全面信息，例如整个Windows注册表。 |'
- en: '| `run upload` and `run download` | Allows the attacker to upload and download
    files on the target system. |'
  id: totrans-1047
  prefs: []
  type: TYPE_TB
  zh: '| `run upload` 和 `run download` | 允许攻击者在目标系统上上传和下载文件。 |'
- en: '| `run keyscan_start`, `run keyscan_stop`, and `run keyscan_dump` | Starts
    and stops a local keylogger on the exploited system. When the data collection
    is complete, the collected text data is dumped on the attacker''s system. |'
  id: totrans-1048
  prefs: []
  type: TYPE_TB
  zh: '| `run keyscan_start`、`run keyscan_stop` 和 `run keyscan_dump` | 在受损系统上启动和停止本地键盘记录器。当数据收集完成时，收集的文本数据将被转储到攻击者的系统上。
    |'
- en: '| `run getprivs` | Attempts to enable all of the privileges available to the
    current process. It''s very useful for privilege escalation. |'
  id: totrans-1049
  prefs: []
  type: TYPE_TB
  zh: '| `run getprivs` | 尝试启用当前进程可用的所有权限。对于权限提升非常有用。 |'
- en: '| `run getsystem` | Attempts to elevate privileges to the Windows `SYSTEM`
    level; grants the fullest possible escalation of a user''s privileges. |'
  id: totrans-1050
  prefs: []
  type: TYPE_TB
  zh: '| `run getsystem` | 尝试将权限提升到Windows `SYSTEM`级别；授予用户最大可能的权限提升。 |'
- en: '| `Run hashdump` | Dumps the contents of the SAM database on the attacker''s
    system. |'
  id: totrans-1051
  prefs: []
  type: TYPE_TB
  zh: '| `Run hashdump` | 转储攻击者系统上SAM数据库的内容。 |'
- en: '| `run getgui` | Allows the user to enable RDP (`getgui -e`) and set the username
    and password (`getgui -u`). The `gettelnet` script can be run in the same manner.
    |'
  id: totrans-1052
  prefs: []
  type: TYPE_TB
  zh: '| `run getgui` | 允许用户启用RDP（`getgui -e`）并设置用户名和密码（`getgui -u`）。`gettelnet`脚本可以以相同的方式运行。
    |'
- en: '| `run vnc` | Gives the attacker a remote GUI (VNC) to the compromised system.
    |'
  id: totrans-1053
  prefs: []
  type: TYPE_TB
  zh: '| `run vnc` | 为攻击者提供对受损系统的远程GUI（VNC）访问。 |'
- en: 'One of the most effective `meterpreter` scripts is the **Windows enumerator**
    (**winenum**). As seen in the following screenshot, it uses both command-line
    and WMIC calls to fully characterize the target system:'
  id: totrans-1054
  prefs: []
  type: TYPE_NORMAL
  zh: 最有效的`meterpreter`脚本之一是**Windows枚举器**（**winenum**）。如下图所示，它使用命令行和WMIC调用来完全描述目标系统：
- en: '![Using Metasploit for post-exploit activities](img/3121OS_05_10.jpg)'
  id: totrans-1055
  prefs: []
  type: TYPE_IMG
  zh: '![使用Metasploit进行后渗透活动](img/3121OS_05_10.jpg)'
- en: 'In addition to the enumeration, the `winenum` script also dumps the registry
    and collects the system hashes for decryption as shown in the following screenshot:'
  id: totrans-1056
  prefs: []
  type: TYPE_NORMAL
  zh: 除了枚举，`winenum`脚本还会转储注册表并收集系统哈希以便解密，如下面的屏幕截图所示：
- en: '![Using Metasploit for post-exploit activities](img/3121OS_05_11.jpg)'
  id: totrans-1057
  prefs: []
  type: TYPE_IMG
  zh: '![使用Metasploit进行后渗透活动](img/3121OS_05_11.jpg)'
- en: 'The `meterpreter` comes with several useful libraries that support complex
    functions. For example, the `espia` library supports screenshots of the compromised
    system via the following commands:'
  id: totrans-1058
  prefs: []
  type: TYPE_NORMAL
  zh: '`meterpreter`附带了几个支持复杂功能的有用库。例如，`espia`库支持通过以下命令对受损系统进行截屏：'
- en: '[PRE40]'
  id: totrans-1059
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: The `stdapi` library allows a remote attacker to manipulate a webcam by collecting
    audio and video from the compromised system and relaying that data back to the
    attacker.
  id: totrans-1060
  prefs: []
  type: TYPE_NORMAL
  zh: '`stdapi`库允许远程攻击者通过收集受损系统的音频和视频来操纵网络摄像头，并将数据传送回攻击者。'
- en: Escalating user privileges on a compromised host
  id: totrans-1061
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提升受损主机上的用户权限
- en: It is usually possible to get `Guest` or `User` access to a system. Frequently,
    the attacker's ability to access important information will be limited by such
    reduced privilege levels. Therefore, a common post-exploit activity is to escalate
    access privileges from `Guest` to `User` to `Administrator` and, finally, to `SYSTEM`.
    This upward progression of gaining access privileges is usually referred to as
    **vertical escalation**.
  id: totrans-1062
  prefs: []
  type: TYPE_NORMAL
  zh: 通常可以获得对系统的“访客”或“用户”访问权限。攻击者通常受到降低的权限级别的限制，因此，常见的后渗透活动是从“访客”提升访问权限到“用户”再到“管理员”，最终到“系统”。获得访问权限的这种上升过程通常被称为**垂直提升**。
- en: 'The user can implement several methods to gain advanced access credentials,
    including the following:'
  id: totrans-1063
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可以实施多种方法来获取高级访问凭据，包括以下内容：
- en: Employ a network sniffer and/or keylogger to capture transmitted user credentials
    (`dsniff` is designed to extract passwords from live transmissions or a `pcap`
    file saved from a Wireshark or tshark session).
  id: totrans-1064
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用网络嗅探器和/或键盘记录器来捕获传输的用户凭据（`dsniff`旨在从实时传输或从Wireshark或tshark会话保存的`pcap`文件中提取密码）。
- en: Perform a search for locally stored passwords. Some users collect passwords
    in an e-mail folder (frequently called `passwords`). Since password reuse and
    simple password construction systems are common, the passwords that are found
    can be employed during the escalation process.
  id: totrans-1065
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 搜索本地存储的密码。一些用户会在电子邮件文件夹中收集密码（通常称为“密码”）。由于密码重用和简单的密码构建系统很常见，因此在提升过程中找到的密码可以被使用。
- en: NirSoft ([www.nirsoft.net](http://www.nirsoft.net)) produces several free tools
    that can be uploaded to the compromised system using `meterpreter` to extract
    passwords from the operating system and applications that cache passwords (mail,
    remote access software, FTP, and web browsers).
  id: totrans-1066
  prefs: []
  type: TYPE_NORMAL
  zh: NirSoft（[www.nirsoft.net](http://www.nirsoft.net)）制作了几个免费工具，可以使用`meterpreter`上传到受损系统，从操作系统和缓存密码的应用程序（邮件、远程访问软件、FTP和Web浏览器）中提取密码。
- en: Dump the `SAM` and `SYSKEY` files using `meterpreter` or applications such as
    **hobocopy**, **fgdump**, and **pwdump** (these can be uploaded on the target
    using `meterpreter`).
  id: totrans-1067
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`meterpreter`或应用程序（如**hobocopy**、**fgdump**和**pwdump**）转储`SAM`和`SYSKEY`文件（这些可以使用`meterpreter`上传到目标）。
- en: Inject malicious code directly into a service running at the `SYSTEM` level
    using a tool such as process injector ([www.tarasco.org/security/Process_Injector/](http://www.tarasco.org/security/Process_Injector/)).
  id: totrans-1068
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用诸如进程注入器（[www.tarasco.org/security/Process_Injector/](http://www.tarasco.org/security/Process_Injector/)）之类的工具，直接将恶意代码注入到在`SYSTEM`级别运行的服务中。
- en: When some applications load, they read **dynamic link library** (**DLL**) files
    in a particular order. It is possible to create a fake DLL with the same name
    as a legitimate DLL, place it in a specific directory location, and have the application
    load and execute it, resulting in elevated privileges for the attacker. Several
    applications are known to be vulnerable to such DLL hijacking ([www.exploit-db.com/dll-hijacking-vulnerable-applications/](http://www.exploit-db.com/dll-hijacking-vulnerable-applications/)).
  id: totrans-1069
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当一些应用程序加载时，它们会按特定顺序读取**动态链接库**（**DLL**）文件。可以创建一个与合法DLL同名的伪造DLL，将其放置在特定目录位置，并让应用程序加载和执行它，从而使攻击者获得提升的权限。已知有几个应用程序容易受到此类DLL劫持的影响（[www.exploit-db.com/dll-hijacking-vulnerable-applications/](http://www.exploit-db.com/dll-hijacking-vulnerable-applications/)）。
- en: Apply an exploit that uses a buffer overflow or other means to escalate privileges.
  id: totrans-1070
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用使用缓冲区溢出或其他手段来提升权限的漏洞利用。
- en: Execute the `getsystem` script, which will automatically escalate administrator
    privileges to the `SYSTEM` level, from the `meterpreter` prompt.
  id: totrans-1071
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行`getsystem`脚本，将自动将管理员权限提升到`SYSTEM`级别，从`meterpreter`提示符中执行。
- en: Tip
  id: totrans-1072
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: Windows 7 and 2008 don't allow remote access to administrative shares, such
    as `ADMIN$`, `C$`, and so on, from untrusted systems. These shares may be required
    for `meterpreter` scripts, such as incognito, or to support attacks over SMB.
    To address this issue, add `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System`
    to the registry, and add a new DWORD (32-bit) key named `LocalAccountTokenFilterPolicy`
    and set the value to `1`.
  id: totrans-1073
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 7和2008不允许从不受信任的系统远程访问管理共享，如`ADMIN$`、`C$`等。这些共享可能需要`meterpreter`脚本（如incognito）或支持通过SMB进行攻击。为了解决这个问题，将`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System`添加到注册表，并添加一个名为`LocalAccountTokenFilterPolicy`的新DWORD（32位）键，并将值设置为`1`。
- en: Replaying authentication tokens using incognito
  id: totrans-1074
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用隐身模式重播身份验证令牌
- en: One particularly interesting `meterpreter` library is `incognito`, which allows
    you to impersonate and replay user tokens. Tokens are temporary keys that allow
    you to access network and system resources without needing to provide your password
    or other credentials with each particular access. These tokens persist on a system
    until it is rebooted.
  id: totrans-1075
  prefs: []
  type: TYPE_NORMAL
  zh: 一个特别有趣的`meterpreter`库是`incognito`，它允许你模拟和重播用户令牌。令牌是临时密钥，允许你访问网络和系统资源，而无需在每次特定访问时提供密码或其他凭据。这些令牌在系统重启之前会持续存在。
- en: Once you have compromised a system, you can use tokens to impersonate a previous
    user who created tokens, without the need to crack the user's password. This token
    impersonation may allow an attacker to escalate their privileges.
  id: totrans-1076
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你妥协了一个系统，你可以使用令牌模拟之前创建令牌的用户，而无需破解用户的密码。这种令牌模拟可能允许攻击者提升他们的权限。
- en: 'At the prompt, type the following:'
  id: totrans-1077
  prefs: []
  type: TYPE_NORMAL
  zh: 在提示符中输入以下内容：
- en: '[PRE41]'
  id: totrans-1078
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'The execution of the previous command is shown in the following screenshot:'
  id: totrans-1079
  prefs: []
  type: TYPE_NORMAL
  zh: 执行前面的命令的结果如下截屏所示：
- en: '![Replaying authentication tokens using incognito](img/3121OS_05_12.jpg)'
  id: totrans-1080
  prefs: []
  type: TYPE_IMG
  zh: '![使用隐身模式重播身份验证令牌](img/3121OS_05_12.jpg)'
- en: The first step is to identify all of the valid tokens that are present on the
    compromised system. The number of tokens that you can see will depend on the level
    of access that was initially used to compromise the target system.
  id: totrans-1081
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是识别受损系统上存在的所有有效令牌。你能看到的令牌数量将取决于最初用于妥协目标系统的访问级别。
- en: You will also see that there are two types of tokens, as shown in the following
    screenshot. Delegation tokens support interactive logons (for example, logging
    onto a system locally or via a remote desktop). Impersonate tokens are for noninteractive
    sessions, such as for when a system connects to a network drive.
  id: totrans-1082
  prefs: []
  type: TYPE_NORMAL
  zh: 你还会看到有两种类型的令牌，如下面的截屏所示。委派令牌支持交互式登录（例如，本地登录系统或通过远程桌面登录）。模拟令牌用于非交互式会话，例如当系统连接到网络驱动器时。
- en: '![Replaying authentication tokens using incognito](img/3121OS_05_13.jpg)'
  id: totrans-1083
  prefs: []
  type: TYPE_IMG
  zh: '![使用隐身模式重播身份验证令牌](img/3121OS_05_13.jpg)'
- en: As you can see, a delegation token has been identified as an `Administrator`.
    If we can impersonate this token, we can assume its privileges.
  id: totrans-1084
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，一个委派令牌被识别为`管理员`。如果我们可以模拟这个令牌，我们就可以获得它的权限。
- en: 'When invoking the `impersonate_token` command in `incognito` (as shown in the
    following screenshot), note that two backslashes are required in the command:'
  id: totrans-1085
  prefs: []
  type: TYPE_NORMAL
  zh: 在`incognito`中调用`impersonate_token`命令（如下面的截屏所示），请注意命令中需要两个反斜杠：
- en: '![Replaying authentication tokens using incognito](img/3121OS_05_14.jpg)'
  id: totrans-1086
  prefs: []
  type: TYPE_IMG
  zh: '![使用隐身模式重播身份验证令牌](img/3121OS_05_14.jpg)'
- en: Now, if we run the shell command from the `meterpreter` prompt and enter `whoami`,
    it will identify us as the administrator whose token we impersonated.
  id: totrans-1087
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果我们从`meterpreter`提示符中运行shell命令并输入`whoami`，它会将我们标识为我们模拟的管理员令牌。
- en: Manipulating access credentials with Windows Credential Editor
  id: totrans-1088
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Windows凭据编辑器操纵访问凭据
- en: 'The **Windows Credential Editor** (**WCE**)—[http://www.ampliasecurity.com/research/wcefaq.html](http://www.ampliasecurity.com/research/wcefaq.html)—is
    a refined version of the incognito script. It is available in 32-bit and 64-bit
    versions as well as a "universal" version that is claimed to be workable on all
    Windows platforms. WCE allows users to do the following:'
  id: totrans-1089
  prefs: []
  type: TYPE_NORMAL
  zh: '**Windows凭据编辑器**（**WCE**）—[http://www.ampliasecurity.com/research/wcefaq.html](http://www.ampliasecurity.com/research/wcefaq.html）—是`incognito`脚本的改进版本。它有32位和64位版本，以及声称可在所有Windows平台上工作的“通用”版本。WCE允许用户做以下事情：'
- en: Perform pass-the-hash attacks on Windows systems
  id: totrans-1090
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对Windows系统执行传递哈希攻击
- en: Collect NTLM credentials from the system memory (with or without code injection)
  id: totrans-1091
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从系统内存中收集NTLM凭据（带或不带代码注入）
- en: Collect Kerberos tickets from Windows systems
  id: totrans-1092
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从Windows系统收集Kerberos票据
- en: Use the collected Kerberos tickets on other Windows or Unix systems to gain
    access
  id: totrans-1093
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用收集到的Kerberos票据在其他Windows或Unix系统上获取访问权限
- en: Dump cleartext passwords stored by Windows systems (see the following section)
  id: totrans-1094
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 转储Windows系统存储的明文密码（见下一节）
- en: 'To use WCE, upload the executable to the compromised system from the `meterpreter`
    prompt. Then, initiate an interactive shell and execute WCE. As you can see in
    the following screenshot, the `-w` option readily extracted the cleartext `Administrator`
    password:'
  id: totrans-1095
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用WCE，从`meterpreter`提示符上传可执行文件到受损系统。然后，启动交互式shell并执行WCE。如下面的截屏所示，`-w`选项轻松提取了明文`管理员`密码：
- en: '![Manipulating access credentials with Windows Credential Editor](img/3121OS_05_15.jpg)'
  id: totrans-1096
  prefs: []
  type: TYPE_IMG
  zh: '![使用Windows凭据编辑器操纵访问凭据](img/3121OS_05_15.jpg)'
- en: Escalating from Administrator to SYSTEM
  id: totrans-1097
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从管理员升级到SYSTEM
- en: Administrator privileges allow an attacker to create and manage accounts and
    access most data available on a system. However, some complex functionality mandates
    that the requester have `SYSTEM` level access privileges. There are several ways
    to continue this escalation to the `SYSTEM` level. The most common is to use the
    `at` command, which is used by Windows to schedule tasks for a particular time.
    The `at` command always runs with privileges at the `SYSTEM` level.
  id: totrans-1098
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员权限允许攻击者创建和管理帐户，并访问系统上可用的大部分数据。然而，一些复杂的功能要求请求者具有`SYSTEM`级别的访问权限。有几种方法可以继续将权限升级到`SYSTEM`级别。最常见的方法是使用`at`命令，Windows用它来安排特定时间的任务。`at`命令始终以`SYSTEM`级别的权限运行。
- en: 'Using an interactive shell (enter `shell` at the `meterpreter` prompt), open
    a command prompt and determine the compromised system''s local time. If the time
    is 12:50 P.M. (the `at` function uses a 24-hour notation), schedule an interactive
    command shell for a later time, as shown in the following screenshot:'
  id: totrans-1099
  prefs: []
  type: TYPE_NORMAL
  zh: 使用交互式shell（在`meterpreter`提示符下输入`shell`），打开命令提示符并确定受损系统的本地时间。如果时间是下午12:50（`at`函数使用24小时制），则安排一个交互式命令shell在稍后的时间运行，如下面的屏幕截图所示：
- en: '![Escalating from Administrator to SYSTEM](img/3121OS_05_16.jpg)'
  id: totrans-1100
  prefs: []
  type: TYPE_IMG
  zh: '![从管理员升级到SYSTEM](img/3121OS_05_16.jpg)'
- en: 'After the `at` task was scheduled to run, reconfirm your access privileges
    at the `meterpreter` prompt, as shown in the following screenshot:'
  id: totrans-1101
  prefs: []
  type: TYPE_NORMAL
  zh: 在安排`at`任务运行后，在`meterpreter`提示符下重新确认您的访问权限，如下面的屏幕截图所示：
- en: '![Escalating from Administrator to SYSTEM](img/3121OS_05_17.jpg)'
  id: totrans-1102
  prefs: []
  type: TYPE_IMG
  zh: '![从管理员升级到SYSTEM](img/3121OS_05_17.jpg)'
- en: As you can see, the privileges have been escalated to the `SYSTEM` level.
  id: totrans-1103
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，权限已被提升到`SYSTEM`级别。
- en: Accessing new accounts with horizontal escalation
  id: totrans-1104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用水平升级访问新账户
- en: In horizontal escalation, the attacker retains their existing credentials but
    uses them to act on a different user's account. For example, a user on compromised
    system A attacks a user on system B in an attempt to compromise them.
  id: totrans-1105
  prefs: []
  type: TYPE_NORMAL
  zh: 在水平升级中，攻击者保留其现有凭据，但使用它们来操作不同用户的帐户。例如，受损系统A上的用户攻击系统B上的用户，试图对其进行攻击。
- en: We will use horizontal escalation attacks when we review some attack vectors,
    such as remote access attacks.
  id: totrans-1106
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们审查一些攻击向量时，我们将使用水平升级攻击。
- en: Covering your tracks
  id: totrans-1107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 掩盖你的行踪
- en: Once a system has been exploited, the attacker must cover their tracks to avoid
    detection, or at least make the reconstruction of the event more difficult for
    the defender.
  id: totrans-1108
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦系统被利用，攻击者必须掩盖自己的行踪，以避免被发现，或者至少使事件的重建对防御者更加困难。
- en: 'An attacker may completely delete the Windows event logs (if they are being
    actively retained on the compromised server). This can be done via a command shell
    to the system and using the following command:'
  id: totrans-1109
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可以完全删除Windows事件日志（如果它们正在被活跃地保留在受损的服务器上）。这可以通过系统的命令行和以下命令来完成：
- en: '[PRE42]'
  id: totrans-1110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The command directs for all of the logs to be deleted (`/a`), including the
    files from all of the subfolders (`/s`). The `/q` option disables all of the queries,
    asking for a *yes* or *no* response, and the `/f` option forcibly removes the
    files, making recovery more difficult.
  id: totrans-1111
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令指示删除所有日志（`/a`），包括所有子文件夹中的文件（`/s`）。`/q`选项禁用所有查询，要求*是*或*否*的响应，`/f`选项强制删除文件，使恢复更加困难。
- en: This can also be done from the `meterpreter` prompt by issuing the command `clearev`.
    This will clear the application, system, and security logs from the target (there
    are no options or arguments for this command).
  id: totrans-1112
  prefs: []
  type: TYPE_NORMAL
  zh: 这也可以通过在`meterpreter`提示符下发出`clearev`命令来完成。这将清除目标系统的应用程序、系统和安全日志（此命令没有选项或参数）。
- en: Ordinarily, deleting a system log does not trigger any alerts to the user. In
    fact, most organizations configure logging so haphazardly that missing system
    logs are treated as a possible occurrence, and their loss is not deeply investigated.
  id: totrans-1113
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，删除系统日志不会触发用户的任何警报。事实上，大多数组织配置日志记录是如此随意，以至于缺少系统日志被视为可能发生的情况，它们的丢失并不会受到深入调查。
- en: 'Metasploit has an additional trick up its sleeve—the `timestomp` option allows
    an attacker to make changes to the MACE parameters of a file (the last modified,
    Accessed, Created, and MFT Entry modified times of a file). Once a system has
    been compromised and a `meterpreter` shell established, `timestomp` can be invoked,
    as shown in the following screenshot:'
  id: totrans-1114
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit还有一个额外的技巧——`timestomp`选项允许攻击者更改文件的MACE参数（文件的最后修改时间、访问时间、创建时间和MFT条目修改时间）。一旦系统被攻破并建立了`meterpreter`
    shell，就可以调用`timestomp`，如下面的屏幕截图所示：
- en: '![Covering your tracks](img/3121OS_05_18.jpg)'
  id: totrans-1115
  prefs: []
  type: TYPE_IMG
  zh: '![掩盖你的行踪](img/3121OS_05_18.jpg)'
- en: 'For example, `C:` of the compromised system contains a file named `README.txt`.
    The MACE values for this file indicate that it was created recently, as shown
    in the following screenshot:'
  id: totrans-1116
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，受损系统的`C:`包含一个名为`README.txt`的文件。该文件的MACE值表明它是最近创建的，如下面的屏幕截图所示：
- en: '![Covering your tracks](img/3121OS_05_19.jpg)'
  id: totrans-1117
  prefs: []
  type: TYPE_IMG
  zh: '![掩盖你的行踪](img/3121OS_05_19.jpg)'
- en: 'If we want to hide this file, we may move it to a cluttered directory, such
    as `windows\system32`. However, the file would be obvious to anyone who sorted
    the contents of that directory on the basis of the creation dates or another MAC-based
    variable. Therefore, to copy the MAC information from the `cmd.exe` file to the
    `README.txt` file, use the following command:'
  id: totrans-1118
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想隐藏这个文件，可以将它移动到一个杂乱的目录，比如`windows\system32`。然而，任何按照创建日期或其他基于MAC的变量对该目录的内容进行排序的人都会发现这个文件。因此，要将`cmd.exe`文件的MAC信息复制到`README.txt`文件中，请使用以下命令：
- en: '[PRE43]'
  id: totrans-1119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: We can also choose to blank out the MAC data using the `-b` switch. As you can
    see in the following screenshot, we have chosen to change the MAC data to a time
    in the future (the year `2106`).
  id: totrans-1120
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以选择使用`-b`开关来清除MAC数据。如下面的屏幕截图所示，我们选择将MAC数据更改为未来的时间（2106年）。
- en: '![Covering your tracks](img/3121OS_05_20.jpg)'
  id: totrans-1121
  prefs: []
  type: TYPE_IMG
  zh: '![掩盖你的行踪](img/3121OS_05_20.jpg)'
- en: 'Such a change will attract the attention of an investigator, but they will
    not be able to use the data for a forensic analysis. What do the attributes look
    like from the original Windows platform? If the system administrator calls the
    system properties of a file, the creation and modification dates have been changed
    back to the year 1601 (the date used by Microsoft as the initial system start
    time). In contrast, the last accessed time for the file remains accurate. You
    can see this in the following screenshot:'
  id: totrans-1122
  prefs: []
  type: TYPE_NORMAL
  zh: 这样的更改会引起调查人员的注意，但他们将无法使用数据进行法证分析。原始Windows平台的属性是什么样子的？如果系统管理员调用文件的系统属性，创建和修改日期已经改回到1601年（微软用作初始系统启动时间的日期）。相比之下，文件的最后访问时间保持准确。您可以在以下截图中看到：
- en: '![Covering your tracks](img/3121OS_05_21.jpg)'
  id: totrans-1123
  prefs: []
  type: TYPE_IMG
  zh: '![掩盖你的踪迹](img/3121OS_05_21.jpg)'
- en: 'Although this is expected behavior, it still provides clues to an investigator.
    In order to completely foul up an investigation, an attacker may recursively change
    all of the set times in a directory or on a particular drive using the following
    command:'
  id: totrans-1124
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这是预期行为，但它仍然为调查人员提供线索。为了完全破坏调查，攻击者可以使用以下命令递归更改目录或特定驱动器上的所有设置时间：
- en: '[PRE44]'
  id: totrans-1125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: The solution is not perfect. It is very obvious that an attack has occurred.
    Furthermore, it is possible for timestamps to be retained in other locations on
    a hard drive and be accessible for investigation. If the target system is actively
    monitoring changes to system integrity using an intrusion detection system, such
    as Tripwire, alerts of the `timestomp` activity will be generated. Therefore,
    destroying timestamps is of limited value when a stealthy approach is truly required.
  id: totrans-1126
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案并不完美。很明显发生了攻击。此外，时间戳可能会保留在硬盘的其他位置，并可供调查人员访问。如果目标系统正在使用入侵检测系统（如Tripwire）积极监控系统完整性的变化，将生成“timestomp”活动的警报。因此，在真正需要隐蔽方法时，销毁时间戳的价值有限。
- en: Summary
  id: totrans-1127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we focused on the immediate actions that follow exploitation
    of a target system. We reviewed the initial rapid assessment conducted to characterize
    the server and the local environment. We also learned how to identify and locate
    target files of interest, create user accounts, perform vertical escalation to
    improve access privileges, and remove signs of an intrusion.
  id: totrans-1128
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章中，我们关注的是目标系统被利用后紧随其后的行动。我们回顾了对服务器和本地环境进行的初步快速评估。我们还学会了如何识别和定位感兴趣的目标文件，创建用户账户，执行垂直升级以提高访问权限，并消除入侵迹象。
- en: In the next chapter, we will learn how to implement a persistent backdoor to
    retain access, and we will learn techniques to support covert communications with
    the compromised system.
  id: totrans-1129
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何实施持久后门以保留访问权限，并学习支持与被攻击系统进行隐蔽通信的技术。
- en: Chapter 6. Post Exploit – Persistence
  id: totrans-1130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章。后期利用 - 持久性
- en: The final stage of the attacker's kill chain is the "command, control, and communicate"
    phase, where the attacker relies on a persistent connection with the compromised
    system to ensure that they can continue to maintain their control.
  id: totrans-1131
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者杀伤链的最后阶段是“命令、控制和通信”阶段，攻击者依赖与被攻击系统的持久连接，以确保他们可以继续保持控制。
- en: 'To be effective, the attacker must be able to maintain **interactive persistence**—they
    must have a two-way communication channel with the exploited system (interactive)
    that remains on the compromised system for a long period of time without being
    discovered (persistence). This type of connectivity is a requirement because of
    the following reasons:'
  id: totrans-1132
  prefs: []
  type: TYPE_NORMAL
  zh: 为了有效，攻击者必须能够保持**交互式持久性** - 他们必须与被利用的系统保持双向通信渠道（交互式），而不被发现地在被攻击系统上长时间保持（持久性）。这种连接的要求是因为以下原因：
- en: Network intrusions may be detected, and the compromised systems may be identified
    and patched
  id: totrans-1133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络入侵可能会被检测到，并且被攻击的系统可能会被识别并修补
- en: Some exploits only work once because the vulnerability is intermittent, exploitation
    causes the system to fail, or because exploit forces the system to change, rendering
    the vulnerability unusable
  id: totrans-1134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一些漏洞只能利用一次，因为漏洞是间歇性的，利用会导致系统失败，或者因为利用迫使系统改变，使漏洞无法使用
- en: Attackers may need to return multiple times to the same target for various reasons
  id: totrans-1135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击者可能需要多次返回同一目标出于各种原因。
- en: The target's usefulness is not always immediately known at the time it is compromised
  id: totrans-1136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在目标被攻击时，其有用性并不总是立即知晓
- en: The tool used to maintain interactive persistence is usually referred to by
    classical terms such as **backdoor** or **rootkit**. However, the trend towards
    long-term persistence by both automated malware and human attacks has blurred
    the meaning of traditional labels; so instead, we will refer to malicious software
    that is intended to stay on the compromised system for a long period of time as
    **persistent agents**.
  id: totrans-1137
  prefs: []
  type: TYPE_NORMAL
  zh: 用于保持交互式持久性的工具通常被称为经典术语，如**后门**或**rootkit**。然而，自动恶意软件和人为攻击对长期持久性的趋势已经模糊了传统标签的含义；因此，我们将持久代理指的是旨在长期留在被攻击系统上的恶意软件。
- en: 'These persistent agents perform many functions for attackers and penetration
    testers, including the following:'
  id: totrans-1138
  prefs: []
  type: TYPE_NORMAL
  zh: 这些持久代理为攻击者和渗透测试人员执行许多功能，包括以下功能：
- en: Allow additional tools to be uploaded to support new attacks, especially against
    systems located on the same network.
  id: totrans-1139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许上传额外的工具来支持新的攻击，特别是针对位于同一网络上的系统。
- en: Facilitate the exfiltration of data from compromised systems and networks.
  id: totrans-1140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 促进从被攻击系统和网络中窃取数据。
- en: Allow attackers to reconnect to a compromised system, usually via an encrypted
    channel to avoid detection. Persistent agents have been known to remain on systems
    for more than a year.
  id: totrans-1141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许攻击者重新连接到被攻击的系统，通常通过加密通道以避免被发现。已知持久代理在系统上保留了一年以上。
- en: Employ antiforensic techniques to avoid being detected, including hiding in
    the target's filesystem or system memory, using strong authentication, and using
    encryption.
  id: totrans-1142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 采用反取证技术以避免被发现，包括隐藏在目标的文件系统或系统内存中，使用强身份验证和使用加密。
- en: 'In this chapter you will learn about the following:'
  id: totrans-1143
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将了解以下内容：
- en: Compromising existing system and application files for remote access
  id: totrans-1144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 损害现有系统和应用程序文件以进行远程访问
- en: Creating persistent agents
  id: totrans-1145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建持久代理
- en: Maintaining persistence with the Metasploit Framework
  id: totrans-1146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Metasploit Framework保持持久性
- en: Redirecting ports to bypass network controls
  id: totrans-1147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重定端口以绕过网络控制
- en: Compromising the existing system and application files for remote access
  id: totrans-1148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为了远程访问而损害现有系统和应用程序文件
- en: The best persistent agent is one that does not need to be hidden because it
    is part of the existing file structure of the compromised system; the attacker
    only has to add certain functionality to convert regular system files and applications
    into persistent agents. This approach can almost never be detected by security
    controls such as intrusion detection systems.
  id: totrans-1149
  prefs: []
  type: TYPE_NORMAL
  zh: 最佳的持久代理是不需要隐藏的代理，因为它是受损系统现有文件结构的一部分；攻击者只需添加某些功能来将常规系统文件和应用程序转换为持久代理。这种方法几乎永远不会被入侵检测系统等安全控制发现。
- en: Remotely enabling the Telnet service
  id: totrans-1150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 远程启用Telnet服务
- en: One technique used to maintain remote access is to use the Metasploit Framework
    to enable the Telnet service on a Windows platform and use it to provide persistence.
  id: totrans-1151
  prefs: []
  type: TYPE_NORMAL
  zh: 用于保持远程访问的一种技术是使用Metasploit Framework在Windows平台上启用Telnet服务，并使用它提供持久性。
- en: The first step is to compromise the target system to obtain a meterpreter session
    (migrate the session to ensure a stable shell) and then elevate access privileges.
  id: totrans-1152
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是损害目标系统以获得meterpreter会话（迁移会话以确保稳定的shell），然后提升访问特权。
- en: 'Next, obtain a local command shell to access the target system using the following
    command:'
  id: totrans-1153
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令获取本地命令shell以访问目标系统：
- en: '[PRE45]'
  id: totrans-1154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: When executed, this command creates an interactive command shell (`-i`) that
    acts as a hidden process (`-H`).
  id: totrans-1155
  prefs: []
  type: TYPE_NORMAL
  zh: 执行此命令时，会创建一个交互式命令shell（`-i`），作为隐藏进程（`-H`）。
- en: 'Using the command prompt of the shell, create a new user account. When creating
    user accounts to ensure persistence, many attackers use the following two-part
    strategy:'
  id: totrans-1156
  prefs: []
  type: TYPE_NORMAL
  zh: 使用shell的命令提示符，创建一个新的用户帐户。在创建用户帐户以确保持久性时，许多攻击者使用以下两部分策略：
- en: Create an account with a name that will attract attention if the compromise
    is investigated (for example, Leet7737)
  id: totrans-1157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个帐户，如果被调查，会引起注意（例如，Leet7737）
- en: 'Create an account that appears to be part of normal system functions, such
    as `Service_Account`, using the following commands:'
  id: totrans-1158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个看起来像是正常系统功能的帐户，比如`Service_Account`，使用以下命令：
- en: '[PRE46]'
  id: totrans-1159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: When the new user accounts have been created, exit the Windows command shell.
  id: totrans-1160
  prefs: []
  type: TYPE_NORMAL
  zh: 创建新用户帐户后，退出Windows命令shell。
- en: 'To enable Telnet, run the following command from the `meterpreter` prompt:'
  id: totrans-1161
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用Telnet，请从`meterpreter`提示符中运行以下命令：
- en: '[PRE47]'
  id: totrans-1162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'The execution of the previous command is shown in the following screenshot:'
  id: totrans-1163
  prefs: []
  type: TYPE_NORMAL
  zh: 执行前一个命令的结果如下截图所示：
- en: '![Remotely enabling the Telnet service](img/3121OS_06_01.jpg)'
  id: totrans-1164
  prefs: []
  type: TYPE_IMG
  zh: '![远程启用Telnet服务](img/3121OS_06_01.jpg)'
- en: 'The script shown in the previous screenshot creates a persistent Telnet service
    on the compromised system. To access it, connect to the system''s IP address using
    the Telnet protocol and provide the username and password that were used to create
    the account, as shown in the following screenshot:'
  id: totrans-1165
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一个截图中显示的脚本在受损系统上创建了一个持久的Telnet服务。要访问它，请使用Telnet协议连接到系统的IP地址，并提供用于创建帐户的用户名和密码，如下一个截图所示：
- en: '![Remotely enabling the Telnet service](img/3121OS_06_02.jpg)'
  id: totrans-1166
  prefs: []
  type: TYPE_IMG
  zh: '![远程启用Telnet服务](img/3121OS_06_02.jpg)'
- en: 'The Telnet service will persist until it is removed. Unfortunately, there are
    some limitations to using Telnet: it is readily detectable (especially because
    credentials are transmitted in the clear) and it functions only in the command-line
    mode.'
  id: totrans-1167
  prefs: []
  type: TYPE_NORMAL
  zh: Telnet服务将持续存在，直到被移除。不幸的是，使用Telnet存在一些限制：它很容易被发现（特别是因为凭据是明文传输的），并且它只能在命令行模式下运行。
- en: However, what if you need to have a GUI to access certain applications on the
    compromised system?
  id: totrans-1168
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，如果您需要GUI来访问受损系统上的某些应用程序呢？
- en: Remotely enabling Windows Terminal Services
  id: totrans-1169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 远程启用Windows终端服务
- en: One of the most reliable techniques to ensure remote access is to persistently
    enable Windows Terminal Services, also known as the **Remote Desktop Protocol**
    (**RDP**). To do so, you must have administrator privileges and know the version
    of the target's operating system.
  id: totrans-1170
  prefs: []
  type: TYPE_NORMAL
  zh: 确保远程访问的最可靠技术之一是持久地启用Windows终端服务，也称为**远程桌面协议**（**RDP**）。为此，您必须具有管理员特权，并了解目标操作系统的版本。
- en: 'For example, if the target is Windows 7, use `meterpreter` to obtain an interactive
    command shell on the target, and then enter the following commands to change the
    registry:'
  id: totrans-1171
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果目标是Windows 7，使用`meterpreter`在目标上获取交互式命令shell，然后输入以下命令更改注册表：
- en: '[PRE48]'
  id: totrans-1172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'To ensure that RDP will pass through the client-side firewall, add a rule using
    the following command:'
  id: totrans-1173
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保RDP能够通过客户端防火墙，使用以下命令添加规则：
- en: '[PRE49]'
  id: totrans-1174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Now we can start the RDP service using the following command:'
  id: totrans-1175
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以使用以下命令启动RDP服务：
- en: '[PRE50]'
  id: totrans-1176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'The change launch RDP is not yet persistent; use the following command to start
    RDP each time the computer is started:'
  id: totrans-1177
  prefs: []
  type: TYPE_NORMAL
  zh: 更改启动RDP还不是持久的；每次计算机启动时使用以下命令启动RDP：
- en: '[PRE51]'
  id: totrans-1178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: The process of enabling RDP is not too complex, but it is one that should be
    scripted to reduce the possibility of errors, especially when working with the
    system registry. Fortunately, the `meterpreter` framework uses the `GETGUI` script
    to automatically enable RDP services.
  id: totrans-1179
  prefs: []
  type: TYPE_NORMAL
  zh: 启用RDP的过程并不太复杂，但应该编写脚本以减少错误的可能性，特别是在处理系统注册表时。幸运的是，`meterpreter`框架使用`GETGUI`脚本自动启用RDP服务。
- en: When run from the `meterpreter` prompt, the command line shown in the following
    screenshot creates the account's username and password, hides the account from
    the log-in screen, and makes the necessary changes to the registry to remain persistent.
    The following screenshot shows the command used to create a username that appears
    to be a legitimate account (Service Account) with a simple password.
  id: totrans-1180
  prefs: []
  type: TYPE_NORMAL
  zh: 从`meterpreter`提示符运行时，以下屏幕截图中显示的命令行创建了帐户的用户名和密码，隐藏了帐户，使其在登录屏幕上不可见，并对注册表进行了必要的更改以保持持久性。以下屏幕截图显示了用于创建一个看起来像是合法帐户（服务帐户）的用户名的命令，密码很简单。
- en: '![Remotely enabling Windows Terminal Services](img/3121OS_06_03.jpg)'
  id: totrans-1181
  prefs: []
  type: TYPE_IMG
  zh: '![远程启用Windows终端服务](img/3121OS_06_03.jpg)'
- en: To connect to the compromised remote desktop, use Kali's **rdesktop** program.
  id: totrans-1182
  prefs: []
  type: TYPE_NORMAL
  zh: 要连接到受损的远程桌面，请使用Kali的**rdesktop**程序。
- en: Remotely enabling Virtual Network Computing
  id: totrans-1183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 远程启用虚拟网络计算
- en: 'If the system contains applications that are known to be compromised (especially
    remote-access programs), it may be possible to take advantage of the existing
    vulnerabilities to exploit the system. For example:'
  id: totrans-1184
  prefs: []
  type: TYPE_NORMAL
  zh: 如果系统包含已知受损的应用程序（特别是远程访问程序），可能可以利用现有的漏洞来利用系统。例如：
- en: It may be possible to extract remote-access passwords for some programs from
    the registry. VNC stores passwords in the registry, and these can be obtained
    by manually extracting the registry key or by uploading and executing an application
    such as NirSoft's VNCPassView.
  id: totrans-1185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可能可以从注册表中提取一些程序的远程访问密码。VNC将密码存储在注册表中，可以通过手动提取注册表键或上传和执行诸如NirSoft的VNCPassView之类的应用程序来获取这些密码。
- en: Different versions of VNC contain different vulnerabilities that can be exploited
    to compromise the application and gain remote access to the system. If the user
    has a current version installed, it may be possible to uninstall that version
    and install an older version in its place. Due to the similarity of functionality
    among the versions, the user may not notice the substitution, but an attacker
    can use the the authentication bypass exploits found in older VNC versions to
    maintain access in the post-compromise phase.
  id: totrans-1186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同版本的VNC包含可以利用的不同漏洞，以便破坏应用程序并远程访问系统。如果用户安装了当前版本，可能可以卸载该版本并安装旧版本。由于各个版本之间功能的相似性，用户可能不会注意到替换，但攻击者可以利用旧版VNC中发现的身份验证绕过漏洞在后期保持访问。
- en: Metasploit comes with the ability to introduce VNC directly to an exploited
    system using the VNCINJECT module.
  id: totrans-1187
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit具有直接使用VNC将VNC直接引入受攻击系统的能力，使用VNCINJECT模块。
- en: 'In the following screenshot, VNC was selected as the payload instead of the
    regular `reverse_TCP` shell:'
  id: totrans-1188
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中，VNC被选为有效载荷，而不是常规的`reverse_TCP` shell：
- en: '![Remotely enabling Virtual Network Computing](img/3121OS_06_04.jpg)'
  id: totrans-1189
  prefs: []
  type: TYPE_IMG
  zh: '![远程启用虚拟网络计算](img/3121OS_06_04.jpg)'
- en: This attack does not require any authentication. If you're testing a client
    site, ensure that all vulnerable applications are removed from the compromised
    system once the vulnerability has been proved—otherwise, you've created an access
    point that can be found and used by any other attacker!
  id: totrans-1190
  prefs: []
  type: TYPE_NORMAL
  zh: 此攻击不需要任何身份验证。如果您正在测试客户端站点，请确保一旦漏洞已被证明，所有易受攻击的应用程序都已从受损系统中移除 - 否则，您已经创建了一个可以被其他攻击者找到并使用的访问点！
- en: Using persistent agents
  id: totrans-1191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用持久代理
- en: Traditionally, attackers would place a backdoor on a compromised system—if the
    **front door** provided authorized access to legitimate users, the backdoor applications
    allowed attackers to return to an exploited system and access to services and
    data.
  id: totrans-1192
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，攻击者会在受损系统上放置后门 - 如果“前门”为合法用户提供授权访问，后门应用程序允许攻击者返回到受攻击的系统并访问服务和数据。
- en: Unfortunately, the classical backdoors provided limited interactivity and were
    not designed to be persistent on the compromised systems for very long time frames.
    This was viewed as a significant shortcoming by the attacker community, because
    once the backdoor was discovered and removed, there was additional work required
    to repeat the compromise steps and exploit the system, which was made more difficult
    by the forewarned system administrators defending the network and its resources.
  id: totrans-1193
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，传统的后门提供了有限的交互性，并且并不是设计为在受损系统上持久存在很长时间。这被攻击者社区视为一个重大缺点，因为一旦发现并移除了后门，就需要额外的工作来重复妥协步骤并利用系统，而被警告的系统管理员在防御网络及其资源方面更加困难。
- en: Kali now focuses on persistent agents that if properly employed, are more difficult
    to detect. The first tool we will review is the venerable Netcat.
  id: totrans-1194
  prefs: []
  type: TYPE_NORMAL
  zh: Kali现在专注于持久代理，如果正确使用，将更难以检测。我们将首先审查的工具是备受尊敬的Netcat。
- en: Employing Netcat as a persistent agent
  id: totrans-1195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将Netcat作为持久代理
- en: Netcat is an application that supports reading from and writing to network connections
    using "raw" TCP and UDP packets. Unlike packets that are organized by services
    such as Telnet or FTP, Netcat's packets are not accompanied by headers or other
    channel information specific to the service. This simplifies communications and
    allows for an almost-universal communication channel.
  id: totrans-1196
  prefs: []
  type: TYPE_NORMAL
  zh: Netcat是一个支持使用“原始”TCP和UDP数据包从和向网络连接读写的应用程序。与Telnet或FTP等服务组织的数据包不同，Netcat的数据包不附带特定于服务的头部或其他通道信息。这简化了通信，并允许几乎通用的通信通道。
- en: 'The last stable version of Netcat was released by Hobbit in 1996, and it has
    remained as useful as ever; in fact, it is frequently referred to as the **TCP/IP
    Swiss army knife**. Netcat can perform many functions, including the following:'
  id: totrans-1197
  prefs: []
  type: TYPE_NORMAL
  zh: Netcat的最后一个稳定版本是由Hobbit于1996年发布的，它一直像以往一样有用；事实上，它经常被称为**TCP/IP瑞士军刀**。Netcat可以执行许多功能，包括以下内容：
- en: Port scanning
  id: totrans-1198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口扫描
- en: Banner grabbing to identify services
  id: totrans-1199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 横幅抓取以识别服务
- en: Port redirection and proxying
  id: totrans-1200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口重定向和代理
- en: File transfer and chatting, including support for data forensics and remote
    backups
  id: totrans-1201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文件传输和聊天，包括对数据取证和远程备份的支持
- en: Use as a backdoor or an interactive persistent agent, on a compromised system
  id: totrans-1202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用作后门或交互式持久代理，在受损系统上
- en: At this point, we will focus on using Netcat to create a persistent shell on
    a compromised system. Although the following example uses Windows as the target
    platform, it functions the same when used on a Unix-based platform.
  id: totrans-1203
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我们将专注于使用Netcat在受损系统上创建持久shell。尽管以下示例使用Windows作为目标平台，但在基于Unix的平台上使用时功能相同。
- en: In the example shown in the following screenshot, we will retain the executable's
    name—`nc.exe`; however, it is common to rename it prior to use in order to minimize
    detection. Even if it is renamed, it will usually be identified by antivirus software;
    many attackers will alter or remove elements of Netcat's source code that are
    not required and recompile it prior to use; such changes can alter the specific
    signature that antivirus programs use to identify the application as Netcat, making
    it invisible to antivirus programs.
  id: totrans-1204
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的截图中显示的示例中，我们将保留可执行文件的名称—`nc.exe`；但是，通常在使用之前将其重命名以最小化检测。即使它被重命名，通常也会被杀毒软件识别；许多攻击者会修改或删除Netcat源代码中不需要的部分，并在使用之前重新编译它；这些更改可以改变杀毒软件用于识别应用程序为Netcat的特定签名，使其对杀毒软件不可见。
- en: 'Netcat is stored on Kali in the `/usr/share/windows-binaries` repository. To
    upload it to a compromised system, enter the following command from within `meterpreter`:'
  id: totrans-1205
  prefs: []
  type: TYPE_NORMAL
  zh: Netcat存储在Kali的`/usr/share/windows-binaries`存储库中。要将其上传到受损系统，请在`meterpreter`中输入以下命令：
- en: '[PRE52]'
  id: totrans-1206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'The execution of the previous command is shown in the following screenshot:'
  id: totrans-1207
  prefs: []
  type: TYPE_NORMAL
  zh: 前一个命令的执行结果显示在以下截图中：
- en: '![Employing Netcat as a persistent agent](img/3121OS_06_05.jpg)'
  id: totrans-1208
  prefs: []
  type: TYPE_IMG
  zh: '![将Netcat作为持久代理](img/3121OS_06_05.jpg)'
- en: You do not have to place it in the `system32` folder specifically; however,
    due to the number and diversity of filetypes in this folder, this is the best
    location to hide a file in a compromised system.
  id: totrans-1209
  prefs: []
  type: TYPE_NORMAL
  zh: 您不必将其专门放在`system32`文件夹中；但是，由于此文件夹中的文件类型数量和多样性，这是在受损系统中隐藏文件的最佳位置。
- en: Tip
  id: totrans-1210
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: While conducting a penetration test on one client, we identified six separate
    instances of Netcat on one server. Netcat had been installed twice by two separate
    system administrators to support network management; the other four instances
    were installed by external attackers and were not identified until the penetration
    test. Therefore, always look to see whether or not a Netcat is already installed
    on your target!
  id: totrans-1211
  prefs: []
  type: TYPE_NORMAL
  zh: 在对一个客户进行渗透测试时，我们在一个服务器上发现了六个独立的Netcat实例。Netcat被两个不同的系统管理员安装了两次，以支持网络管理；其他四个实例是由外部攻击者安装的，在渗透测试之前没有被发现。因此，始终查看目标系统上是否已安装了Netcat！
- en: If you do not have a `meterpreter` connection, you can use **Trivial File Transfer
    Protocol** (**TFTP**) to transfer the file.
  id: totrans-1212
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有`meterpreter`连接，可以使用**Trivial File Transfer Protocol**（**TFTP**）来传输文件。
- en: 'Next, configure the registry to launch Netcat when the system starts up and
    ensure that it is listening on port 444 (or any other port that you have selected,
    as long as it is not in use) using the following command:'
  id: totrans-1213
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，配置注册表以在系统启动时启动Netcat，并确保它在444端口上监听（或者您选择的任何其他端口，只要它没有被使用），使用以下命令：
- en: '[PRE53]'
  id: totrans-1214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Confirm that the change in the registry was successfully implemented using
    the following `queryval` command:'
  id: totrans-1215
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下`queryval`命令确认注册表中的更改已成功实施：
- en: '[PRE54]'
  id: totrans-1216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Using the `netsh` command, open a port on the local firewall to ensure that
    the compromised system will accept remote connections to Netcat. It is important
    to know the target's operating system. The `netsh advfirewall firewall` command-line
    context is used for Windows Vista, and Windows Server 2008 and later versions;
    the `netsh firewall` command is used for earlier operating systems.
  id: totrans-1217
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`netsh`命令，在本地防火墙上打开一个端口，以确保受损系统将接受对Netcat的远程连接。了解目标操作系统是很重要的。`netsh advfirewall
    firewall`命令行上下文用于Windows Vista和Windows Server 2008及更高版本；`netsh firewall`命令用于早期操作系统。
- en: 'To add a port to the local Windows firewall, enter the `shell` command at the
    `meterpreter` prompt and then enter `rule` using the appropriate command. When
    naming the `rule`, use a name such as `svchostpassthrough` that suggests that
    `rule` is important for the proper functioning of the system. A sample command
    is shown as follows:'
  id: totrans-1218
  prefs: []
  type: TYPE_NORMAL
  zh: 要向本地Windows防火墙添加端口，请在`meterpreter`提示符处输入`shell`命令，然后使用适当的命令输入`rule`。在命名`rule`时，使用一个像`svchostpassthrough`这样的名称，表明`rule`对系统的正常运行很重要。示例命令如下所示：
- en: '[PRE55]'
  id: totrans-1219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Confirm that the change was successfully implemented using the following command:'
  id: totrans-1220
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令确认更改已成功实施：
- en: '[PRE56]'
  id: totrans-1221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'The execution of the previously mentioned commands is shown in the following
    screenshot:'
  id: totrans-1222
  prefs: []
  type: TYPE_NORMAL
  zh: 前面提到的命令的执行结果显示在以下截图中：
- en: '![Employing Netcat as a persistent agent](img/3121OS_06_06.jpg)'
  id: totrans-1223
  prefs: []
  type: TYPE_IMG
  zh: '![将Netcat作为持久代理](img/3121OS_06_06.jpg)'
- en: When the port rule is confirmed, ensure that the reboot option works.
  id: totrans-1224
  prefs: []
  type: TYPE_NORMAL
  zh: 确认端口规则后，确保重启选项有效。
- en: 'Enter the following command from the `meterpreter` prompt:'
  id: totrans-1225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从`meterpreter`提示符输入以下命令：
- en: '[PRE57]'
  id: totrans-1226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Enter the following command from an interactive Windows shell:'
  id: totrans-1227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从交互式Windows shell中输入以下命令：
- en: '[PRE58]'
  id: totrans-1228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'To remotely access the compromised system, type `nc` at a command prompt, indicate
    the verbosity of the connection (`-v` reports basic information and `-vv` reports
    much more information), and then enter the IP address of the target and the port
    number, as shown in the following screenshot:'
  id: totrans-1229
  prefs: []
  type: TYPE_NORMAL
  zh: 要远程访问受损系统，请在命令提示符中输入`nc`，指示连接的详细程度（`-v`报告基本信息，`-vv`报告更多信息），然后输入目标的IP地址和端口号，如下截图所示：
- en: '![Employing Netcat as a persistent agent](img/3121OS_06_07.jpg)'
  id: totrans-1230
  prefs: []
  type: TYPE_IMG
  zh: '![将Netcat作为持久代理](img/3121OS_06_07.jpg)'
- en: Unfortunately, there are some limitations to using Netcat—there is no authentication
    or encryption of transmitted data, and it is detected by nearly all antivirus
    software.
  id: totrans-1231
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，使用Netcat存在一些限制—没有传输数据的身份验证或加密，并且几乎所有杀毒软件都会检测到它。
- en: The lack of encryption can be resolved using **cryptcat**, a Netcat variant
    that uses the Twofish encryption to secure data during transmission between the
    exploited host and the attacker. Twofish encryption, developed by Bruce Schneier,
    is an advanced symmetric block cipher that provides reasonably strong protection
    for encrypted data.
  id: totrans-1232
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用**cryptcat**解决加密问题，它是Netcat的变体，使用Twofish加密来保护被攻击主机和攻击者之间传输的数据。由Bruce Schneier开发的Twofish加密是一种先进的对称分组密码，为加密数据提供了相当强的保护。
- en: 'To use `cryptcat`, ensure that there is a listener ready and configured with
    a strong password, using the following command:'
  id: totrans-1233
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用`cryptcat`，确保有一个准备好并配置了强密码的监听器，使用以下命令：
- en: '[PRE59]'
  id: totrans-1234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Next, upload `cryptcat` to the compromised system and configure it to connect
    with the listener''s IP address using the following command:'
  id: totrans-1235
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，上传`cryptcat`到被攻击系统，并使用以下命令配置它连接到监听器的IP地址：
- en: '[PRE60]'
  id: totrans-1236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: Unfortunately, Netcat and its variants remain detectable by most antivirus applications.
    It is possible to render Netcat undetectable using a hex editor to alter the source
    code of Netcat; this will help avoid triggering the signature matching action
    of the antivirus, but this can be a long trial-and-error process. A more efficient
    approach is to take advantage of the Metasploit Framework's persistence mechanisms.
  id: totrans-1237
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，Netcat及其变体仍然可以被大多数杀毒软件检测到。可以使用十六进制编辑器修改Netcat的源代码使其不可检测；这将有助于避免触发杀毒软件的签名匹配动作，但这可能是一个漫长的反复试验过程。更有效的方法是利用Metasploit
    Framework的持久性机制。
- en: Maintaining persistence with the Metasploit Framework
  id: totrans-1238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Metasploit Framework保持持久性
- en: 'Metasploit''s `meterpreter` contains several scripts that support persistence
    on a compromised system. We will examine two script options for placing a backdoor
    on a compromised system: `metsvc` and `persistence`.'
  id: totrans-1239
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit的`meterpreter`包含几个支持在被攻击系统上保持持久性的脚本。我们将研究两个脚本选项，用于在被攻击系统上放置后门：`metsvc`和`persistence`。
- en: Using the metsvc script
  id: totrans-1240
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用metsvc脚本
- en: The `metsvc` script is a network service wrapper for `meterpreter` that allows
    it to either be used as a Windows service or run as a command-line application.
    It is typically used as a backdoor to maintain communications with a compromised
    system.
  id: totrans-1241
  prefs: []
  type: TYPE_NORMAL
  zh: '`metsvc`脚本是`meterpreter`的网络服务包装器，允许它被用作Windows服务或作为命令行应用程序运行。它通常被用作后门，以维持与被攻击系统的通信。'
- en: To use `metsvc`, first compromise the system and then migrate `meterpreter`
    to the `explorer.exe` process to obtain a more stable shell.
  id: totrans-1242
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用`metsvc`，首先要攻击系统，然后将`meterpreter`迁移到`explorer.exe`进程，以获得更稳定的shell。
- en: Execute the `metsvc` agent by invoking the `run` command, as shown in the following
    screenshot. As you can see, it creates a temporary installation directory, uploads
    three files (`metsrv.dll`, `metsvc-server.exe`, and `metsvc.exe`), and then starts
    `metsvc`.
  id: totrans-1243
  prefs: []
  type: TYPE_NORMAL
  zh: 通过调用`run`命令执行`metsvc`代理，如下截图所示。可以看到，它创建了一个临时安装目录，上传了三个文件（`metsrv.dll`，`metsvc-server.exe`和`metsvc.exe`），然后启动了`metsvc`。
- en: '![Using the metsvc script](img/3121OS_06_08.jpg)'
  id: totrans-1244
  prefs: []
  type: TYPE_IMG
  zh: '![使用metsvc脚本](img/3121OS_06_08.jpg)'
- en: To interact with the persistent `metsvc` agent, the attacker opens the Metasploit
    Framework and selects `use exploit/multi/handler` with the payload `windows/metsvc_bind_tcp`,
    as shown in the following screenshot. The other parameters (IP address and port)
    are also set.
  id: totrans-1245
  prefs: []
  type: TYPE_NORMAL
  zh: 要与持久的`metsvc`代理进行交互，攻击者打开Metasploit Framework，并选择`use exploit/multi/handler`，载荷为`windows/metsvc_bind_tcp`，如下截图所示。还设置了其他参数（IP地址和端口）。
- en: '![Using the metsvc script](img/3121OS_06_09.jpg)'
  id: totrans-1246
  prefs: []
  type: TYPE_IMG
  zh: '![使用metsvc脚本](img/3121OS_06_09.jpg)'
- en: 'When the `exploit` command is executed, a session is opened directly between
    the two systems, allowing for the escalation of privileges and other functions
    to occur from the `meterpreter` command line. The execution of the `exploit` command
    is shown in the following screenshot:'
  id: totrans-1247
  prefs: []
  type: TYPE_NORMAL
  zh: 当执行`exploit`命令时，会直接在两个系统之间打开一个会话，允许从`meterpreter`命令行执行权限提升和其他功能。执行`exploit`命令如下截图所示：
- en: '![Using the metsvc script](img/3121OS_06_10.jpg)'
  id: totrans-1248
  prefs: []
  type: TYPE_IMG
  zh: '![使用metsvc脚本](img/3121OS_06_10.jpg)'
- en: The `metsvc` script requires no authentication; once the agent is in place,
    it can be used by anyone to gain access to the compromised system. Most attackers
    would not use this without altering the source code such that it requires authentication
    or ensuring that there is some method in place to filter out remote connections.
  id: totrans-1249
  prefs: []
  type: TYPE_NORMAL
  zh: '`metsvc`脚本不需要身份验证；一旦代理就位，任何人都可以使用它来访问被攻击系统。大多数攻击者不会在不修改源代码以要求身份验证或确保有某种方法来过滤远程连接的情况下使用它。'
- en: 'More importantly, it is not a stealthy attack. Any attempt to list running
    processes, such as entering the `ps` command from the `meterpreter` prompt, will
    identify the `metsvc` service and the fact that the executable is running from
    a `Temp` directory—which is very suspicious! In the following screenshot, the
    directory with the random name (CvjrsZWOMK) located in the Temp folder is an obvious
    flag that a system has been compromised:'
  id: totrans-1250
  prefs: []
  type: TYPE_NORMAL
  zh: 更重要的是，这不是一个隐秘的攻击。任何尝试列出运行中的进程，比如从`meterpreter`提示输入`ps`命令，都会识别出`metsvc`服务以及可疑地从`Temp`目录运行的可执行文件！在下面的截图中，位于Temp文件夹中的具有随机名称（CvjrsZWOMK）的目录明显标志着系统已被攻击：
- en: '![Using the metsvc script](img/3121OS_06_11.jpg)'
  id: totrans-1251
  prefs: []
  type: TYPE_IMG
  zh: '![使用metsvc脚本](img/3121OS_06_11.jpg)'
- en: A simple inspection of the `Temp` folder will identify the three hostile files,
    as shown in the following screenshot; however, these will usually be flagged by
    an antivirus before they are found by manual inspection.
  id: totrans-1252
  prefs: []
  type: TYPE_NORMAL
  zh: 简单检查`Temp`文件夹将识别出三个敌对文件，如下截图所示；然而，这些通常会在手动检查之前被杀毒软件标记。
- en: '![Using the metsvc script](img/3121OS_06_12.jpg)'
  id: totrans-1253
  prefs: []
  type: TYPE_IMG
  zh: '![使用metsvc脚本](img/3121OS_06_12.jpg)'
- en: Using the persistence script
  id: totrans-1254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用持久性脚本
- en: A more effective approach for gaining persistence is to use the `meterpreter`
    prompt's `persistence` script.
  id: totrans-1255
  prefs: []
  type: TYPE_NORMAL
  zh: 获得持久性的更有效方法是使用`meterpreter`提示的`persistence`脚本。
- en: After a system has been exploited and the migrate command has moved the initial
    shell to a more secure service, an attacker can invoke the `persistence` script
    from the `meterpreter` prompt.
  id: totrans-1256
  prefs: []
  type: TYPE_NORMAL
  zh: 在系统被利用并且迁移命令已将初始shell移动到更安全的服务之后，攻击者可以从`meterpreter`提示符中调用`persistence`脚本。
- en: 'Using `-h` in the command will identify the available options for creating
    a persistent backdoor, as shown in the following screenshot:'
  id: totrans-1257
  prefs: []
  type: TYPE_NORMAL
  zh: 在命令中使用`-h`将识别创建持久后门的可用选项，如下面的屏幕截图所示：
- en: '![Using the persistence script](img/3121OS_06_13.jpg)'
  id: totrans-1258
  prefs: []
  type: TYPE_IMG
  zh: '![使用持久性脚本](img/3121OS_06_13.jpg)'
- en: In the example shown in the following screenshot, we have configured `persistence`
    to run automatically when the system boots and to attempt to connect to our listener
    every 10 seconds. The listener is identified as the remote system (`-r`) with
    a specific IP address and port. Additionally, we could elect to use the `-U` option,
    which will start persistence when a user logs onto the system.
  id: totrans-1259
  prefs: []
  type: TYPE_NORMAL
  zh: 在下面的屏幕截图中的示例中，我们已经配置`persistence`在系统启动时自动运行，并尝试每10秒连接到我们的监听器。监听器被标识为远程系统（`-r`）具有特定的IP地址和端口。此外，我们可以选择使用`-U`选项，它将在用户登录到系统时启动持久性。
- en: '![Using the persistence script](img/3121OS_06_14.jpg)'
  id: totrans-1260
  prefs: []
  type: TYPE_IMG
  zh: '![使用持久性脚本](img/3121OS_06_14.jpg)'
- en: Note
  id: totrans-1261
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that we have arbitrarily selected port 444 for use by persistence; an attacker
    must verify the local firewall settings to ensure that this port is open, or use
    the `reg` command to open the port. Like most Metasploit modules, any port can
    be selected as long as it is not already in use.
  id: totrans-1262
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们已经任意选择了端口444供持久性使用；攻击者必须验证本地防火墙设置，以确保该端口是开放的，或者使用`reg`命令打开该端口。与大多数Metasploit模块一样，只要端口尚未被使用，就可以选择任何端口。
- en: The `persistence` script places a VBS file in a temporary directory; however,
    you can use the `-L` option to specify a different location. The script also adds
    that file to the local autorun sections of the registry.
  id: totrans-1263
  prefs: []
  type: TYPE_NORMAL
  zh: '`persistence`脚本将VBS文件放在临时目录中；但是，您可以使用`-L`选项指定不同的位置。该脚本还将该文件添加到注册表的本地自动运行部分。'
- en: 'Because the `persistence` script is not authenticated and anyone can use it
    to access the compromised system, it should be removed from the system as soon
    as possible after the discovery or completion of penetration testing. To remove
    the script, confirm the location of the resource file for cleanup, and then execute
    the following `resource` command:'
  id: totrans-1264
  prefs: []
  type: TYPE_NORMAL
  zh: 因为`persistence`脚本没有经过身份验证，任何人都可以使用它来访问受损系统，因此应在发现或完成渗透测试后尽快从系统中删除。要删除脚本，请确认清理资源文件的位置，然后执行以下`resource`命令：
- en: '[PRE61]'
  id: totrans-1265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Creating a standalone persistent agent with Metasploit
  id: totrans-1266
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Metasploit创建独立的持久代理
- en: The Metasploit Framework can be used to create a stand-alone executable that
    can persist on a compromised system and allow interactive communications. The
    advantage of a stand-alone package is that it can be prepared and tested in advance
    to ensure connectivity and encoded to bypass local antivirus software.
  id: totrans-1267
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit框架可用于创建一个独立的可执行文件，可以在受损系统上持久存在并允许交互式通信。独立包的优势在于可以提前准备和测试以确保连接，并进行编码以绕过本地防病毒软件。
- en: To make a simple stand-alone agent, launch `msfconsole` on a command prompt
    in Kali.
  id: totrans-1268
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个简单的独立代理，请在Kali的命令提示符上启动`msfconsole`。
- en: Use `msfpayload` to craft the persistence agent. In the example shown in the
    following screenshot, the agent is configured to use a `reverse_tcp` shell that
    will connect to the local host at `192.168.43.130` on port `4444`. The agent,
    named `attack1.exe`, will use a win32 executable template.
  id: totrans-1269
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`msfpayload`来制作持久代理。在下面的屏幕截图中的示例中，代理被配置为使用`reverse_tcp` shell，将连接到端口`4444`上的本地主机`192.168.43.130`。名为`attack1.exe`的代理将使用win32可执行文件模板。
- en: '![Creating a standalone persistent agent with Metasploit](img/3121OS_06_15.jpg)'
  id: totrans-1270
  prefs: []
  type: TYPE_IMG
  zh: '![使用Metasploit创建独立的持久代理](img/3121OS_06_15.jpg)'
- en: The stand-alone agent will only work on compromised systems with no antivirus
    installed, or if the antivirus has first been disabled using the appropriate `meterpreter`
    command. To bypass the antivirus, the backdoor must be encoded.
  id: totrans-1271
  prefs: []
  type: TYPE_NORMAL
  zh: 独立代理只能在未安装防病毒软件的受损系统上运行，或者如果使用适当的`meterpreter`命令先禁用了防病毒软件。要绕过防病毒软件，必须对后门进行编码。
- en: 'There are several different options for encoding the payload, as shown in the
    following screenshot:'
  id: totrans-1272
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种不同的选项可以对有效载荷进行编码，如下面的屏幕截图所示：
- en: '![Creating a standalone persistent agent with Metasploit](img/3121OS_06_16.jpg)'
  id: totrans-1273
  prefs: []
  type: TYPE_IMG
  zh: '![使用Metasploit创建独立的持久代理](img/3121OS_06_16.jpg)'
- en: To see the available options, use the `show encoders` command.
  id: totrans-1274
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看可用选项，请使用`show encoders`命令。
- en: Metasploit uses approximately 30 different encoders; by default, it will select
    the most appropriate encoder if one is not specified.
  id: totrans-1275
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit使用大约30种不同的编码器；默认情况下，如果未指定编码器，它将选择最合适的编码器。
- en: A good general encoder to use is `shikata_ga_nai`. This encoder implements polymorphic
    XOR additive feedback encoding against a 4-byte key, and it is the only encoder
    ranked as "excellent" by Metasploit.
  id: totrans-1276
  prefs: []
  type: TYPE_NORMAL
  zh: 一个很好的通用编码器是`shikata_ga_nai`。该编码器实现了多态XOR加反馈编码，针对4字节密钥，是Metasploit唯一被评为“优秀”的编码器。
- en: 'To encode the previously prepared `attack.exe` agent, we use the following
    command:'
  id: totrans-1277
  prefs: []
  type: TYPE_NORMAL
  zh: 要对先前准备的`attack.exe`代理进行编码，我们使用以下命令：
- en: '[PRE62]'
  id: totrans-1278
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: This encodes the `attack.exe` agent five times using the `shikata_ga_nai` protocol.
    Each time it is re-encoded, it becomes more difficult to detect. However, the
    executable also increases in size.
  id: totrans-1279
  prefs: []
  type: TYPE_NORMAL
  zh: 这使用`shikata_ga_nai`协议对`attack.exe`代理进行了五次编码。每次重新编码，它都变得更难检测。但是，可执行文件的大小也会增加。
- en: 'The full payload can be created directly from the command line in Kali. Not
    only can it be encoded, but we can configure the encoding pattern to avoid certain
    characters. For example, the following characters should be avoided when encoding
    a persistent agent because they may result in discovery and failure of the attack:'
  id: totrans-1280
  prefs: []
  type: TYPE_NORMAL
  zh: 完整的有效载荷可以直接从Kali的命令行中创建。不仅可以对其进行编码，还可以配置编码模式以避免特定字符。例如，在编码持久代理时应避免以下字符，因为它们可能导致攻击被发现和失败：
- en: '`\x00` represents a 0-byte address'
  id: totrans-1281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`\x00`代表0字节地址'
- en: '`\xa0` represents a line feed'
  id: totrans-1282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`\xa0` 代表换行'
- en: '`\xad` represents a carriage return'
  id: totrans-1283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`\xad` 代表回车'
- en: 'To create a multiencoded payload, use the following command:'
  id: totrans-1284
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建多重编码的有效负载，请使用以下命令：
- en: '[PRE63]'
  id: totrans-1285
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'You can also encode `msfpayload` to an existing executable, and both the modified
    executable and the persistent agent will function. To bind the persistent agent
    to an executable such as a calculator (`calc.exe`), first copy the appropriate
    `calc.exe` file into Metasploit''s template folder located at `/usr/share/metasploit-framework/data/templates`.
    When the template is in place, use the following command:'
  id: totrans-1286
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以将`msfpayload`编码为现有的可执行文件，修改后的可执行文件和持久代理都将起作用。要将持久代理绑定到一个可执行文件（如计算器（`calc.exe`）），首先将适当的`calc.exe`文件复制到Metasploit的模板文件夹中，位于`/usr/share/metasploit-framework/data/templates`。当模板就位时，使用以下命令：
- en: '[PRE64]'
  id: totrans-1287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: The agent can be placed on the target system, renamed `calc.exe` to replace
    the original calculator, and then executed.
  id: totrans-1288
  prefs: []
  type: TYPE_NORMAL
  zh: 代理可以放置在目标系统上，重命名为`calc.exe`以替换原始的计算器，然后执行。
- en: Unfortunately, nearly all Metasploit-encoded executables can be detected by
    client antivirus software. This has been attributed to penetration testers who
    have submitted encrypted payloads to sites such as VirusTotal ([www.virustotal.com](http://www.virustotal.com)).
    However, you can create an executable and then encrypt it using Veil-Evasion,
    as described in [Chapter 4](ch04.html "Chapter 4. Exploit"), *Exploit*.
  id: totrans-1289
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，几乎所有Metasploit编码的可执行文件都可以被客户端防病毒软件检测到。这归因于渗透测试人员向VirusTotal（[www.virustotal.com](http://www.virustotal.com)）等网站提交了加密的有效负载。然而，您可以创建一个可执行文件，然后使用Veil-Evasion对其进行加密，如[第4章](ch04.html
    "第4章。利用") *利用*中所述。
- en: Redirecting ports to bypass network controls
  id: totrans-1290
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重定向端口以绕过网络控制
- en: Thus far, we've examined remote control access to the exploited system as if
    we have a direct connection between the victim and the attacker's machines; however,
    such connectivity is frequently controlled or blocked by network devices such
    as a firewall.
  id: totrans-1291
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经检查了对受攻击系统的远程控制访问，就好像我们在受害者和攻击者的机器之间有直接连接；然而，这种连接通常受到网络设备（如防火墙）的控制或阻止。
- en: Attackers can circumvent these controls using port redirection, which is a designated
    system that listens on defined ports and forwards the raw packets to a specific
    secondary location.
  id: totrans-1292
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可以通过端口重定向来规避这些控制，这是一个指定的系统，它监听定义的端口并将原始数据包转发到特定的次要位置。
- en: Kali provides several tools that support port redirection, including `nc`, `cryptcat`,
    `socat`, `ssh`, `fpipe`, and Metasploit's `meterpreter`; we'll look at some examples
    in the following sections.
  id: totrans-1293
  prefs: []
  type: TYPE_NORMAL
  zh: Kali提供了几个支持端口重定向的工具，包括`nc`、`cryptcat`、`socat`、`ssh`、`fpipe`和Metasploit的`meterpreter`；我们将在以下部分中看一些示例。
- en: Example 1 – simple port redirection
  id: totrans-1294
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 示例1 - 简单的端口重定向
- en: Simple port redirection may be used, for example, if you have compromised a
    system on the exterior of the network in the **Demilitarized Zone** (**DMZ**)
    and need to be able to communicate with an internal system from a remote location.
  id: totrans-1295
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的端口重定向可能会被使用，例如，如果您已经在网络外部的**非军事区**（**DMZ**）上损坏了一个系统，并且需要能够从远程位置与内部系统进行通信。
- en: 'On the compromised system in the DMZ, configure an instance of Netcat to listen
    to incoming commands and forward them to the target using the following command:'
  id: totrans-1296
  prefs: []
  type: TYPE_NORMAL
  zh: 在DMZ中受损的系统上，配置一个Netcat实例来监听传入命令并将其转发到目标，使用以下命令：
- en: '[PRE65]'
  id: totrans-1297
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: This command will invoke Netcat (`nc`) to listen (`-l`) to incoming traffic,
    and execute (`-e`) the transfer of this incoming traffic to the target on port
    `444`. Ports are not fixed and they do not have to be the same on both the listening/forwarding
    host and the final target.
  id: totrans-1298
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令将调用Netcat（`nc`）来监听（`-l`）传入的流量，并执行（`-e`）将这些传入的流量传输到端口`444`上的目标。端口不是固定的，它们不必在监听/转发主机和最终目标上相同。
- en: 'If you lack complete information regarding the target''s internal network,
    you may try the following command:'
  id: totrans-1299
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您缺乏有关目标内部网络的完整信息，可以尝试以下命令：
- en: '[PRE66]'
  id: totrans-1300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: This command sets the local (attacker) instance of Netcat to listen (`-l`) on
    a designated port, and then instructs Netcat to create a new process with each
    new connection (`-c`).
  id: totrans-1301
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令将设置本地（攻击者）Netcat实例监听（`-l`）指定的端口，然后指示Netcat在每次新连接（`-c`）时创建一个新进程。
- en: This simple example allows the outsider to connect to the direct network; however,
    it does not permit a bidirectional data connection, which is required for some
    tools.
  id: totrans-1302
  prefs: []
  type: TYPE_NORMAL
  zh: 这个简单的例子允许外部人员连接到直接网络；然而，它不允许双向数据连接，这对于一些工具是必需的。
- en: Example 2 – bidirectional port redirection
  id: totrans-1303
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 示例2 - 双向端口重定向
- en: 'Consider three separate Windows data systems:'
  id: totrans-1304
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑三个独立的Windows数据系统：
- en: '[Attacker] | [Forwarder ] | [Target]'
  id: totrans-1305
  prefs: []
  type: TYPE_NORMAL
  zh: '[攻击者] | [转发者] | [目标]'
- en: In order to enable a bidirectional communications channel using Netcat, we will
    have to use named pipes. A named pipe, also referred to as FIFO, is a means of
    creating defined interprocess communication; this allows us to handle it as an
    object, making it easier to manage when issuing commands. In the following sample
    attack, we create a named pipe called `reverse` to handle bidirectional communications.
  id: totrans-1306
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用Netcat创建双向通信通道，我们将不得不使用命名管道。命名管道，也称为FIFO，是一种创建定义的进程间通信的方法；这使我们可以将其处理为一个对象，在发出命令时更容易管理。在以下示例攻击中，我们创建一个名为`reverse`的命名管道来处理双向通信。
- en: 'The Attacker has an instance of Netcat on his local system set to listen on
    port `6661` using the following command:'
  id: totrans-1307
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者在他的本地系统上有一个Netcat实例，使用以下命令监听端口`6661`：
- en: '[PRE67]'
  id: totrans-1308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'The Forwarder, a compromised box with an instance of Netcat installed, will
    listen for incoming packets and forward them to the target; it is configured to
    listen on port `6666` using the following command:'
  id: totrans-1309
  prefs: []
  type: TYPE_NORMAL
  zh: 转发者，一个安装了Netcat实例的受损主机，将监听传入的数据包并将其转发到目标；它被配置为使用以下命令在端口`6666`上监听：
- en: '[PRE68]'
  id: totrans-1310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'On the target system, enter the following command to create the named pipe:'
  id: totrans-1311
  prefs: []
  type: TYPE_NORMAL
  zh: 在目标系统上，输入以下命令来创建命名管道：
- en: '[PRE69]'
  id: totrans-1312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Then, configure a local instance of Netcat to use that named pipe to establish
    two-way communications across the forwarding system to the Attacker using the
    following command:'
  id: totrans-1313
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，配置本地的Netcat实例，使用命名管道建立跨转发系统与攻击者之间的双向通信，命令如下：
- en: '[PRE70]'
  id: totrans-1314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'The same bidirectional data flow can be achieved using `socat`, which is designed
    to implement connections of this type. The command for this example would be executed
    from the target system and use:'
  id: totrans-1315
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`socat`也可以实现相同的双向数据流，该工具旨在实现这种类型的连接。此示例的命令将从目标系统执行，并使用：
- en: '[PRE71]'
  id: totrans-1316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: Summary
  id: totrans-1317
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we focused on the final stage of the attacker's kill chain—the
    command, control, and communications stage—where the attacker uses a persistent
    agent to communicate with a compromised system.
  id: totrans-1318
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们关注了攻击者杀伤链的最后阶段——命令、控制和通信阶段——在这个阶段，攻击者使用持久代理与被攻击系统进行通信。
- en: That concludes the first part of this book where we examined the attacker's
    kill chain in detail to see how it could be applied towards compromising a network
    or an isolated system.
  id: totrans-1319
  prefs: []
  type: TYPE_NORMAL
  zh: 这就结束了本书的第一部分，我们在其中详细研究了攻击者的杀伤链，以了解如何将其应用于对网络或孤立系统的妥协。
- en: In [Part 2](pt02.html "Part 2. The Delivery Phase"), *The Delivery Phase*, we
    will examine specific applications of the kill chain using various exploit paths.
    In [Chapter 7](ch07.html "Chapter 7. Physical Attacks and Social Engineering"),
    *Physical Attacks and Social Engineering*, we will focus on physical security
    and social engineering attacks. Topics will include an overview of the attack
    methodology, crafting hostile USB devices and rogue microcomputers, the Social
    Engineering Toolkit, and testing the resilience of a system to phishing attacks.
  id: totrans-1320
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第二部分](pt02.html "第二部分。交付阶段")中，*交付阶段*，我们将研究使用各种利用路径的杀伤链的具体应用。在[第七章](ch07.html
    "第七章。物理攻击和社会工程")中，*物理攻击和社会工程*，我们将重点关注物理安全和社会工程攻击。主题将包括攻击方法论概述，制作恶意USB设备和流氓微型计算机，社会工程工具包，以及测试系统对钓鱼攻击的抵抗力。
