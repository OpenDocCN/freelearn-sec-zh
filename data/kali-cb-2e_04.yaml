- en: Finding Exploits in the Target
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在目标中查找漏洞
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将涵盖以下主题：
- en: Searching the local exploit database
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正在搜索本地漏洞数据库
- en: Searching the online exploit database
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 搜索在线漏洞数据库
- en: The Metasploit setup and configuration
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Metasploit 设置和配置
- en: The Armitage setup
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Armitage 设置
- en: Basic exploit attacks with Armitage
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Armitage 进行基本的漏洞攻击
- en: Advanced attacks with Armitage
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Armitage 进行高级攻击
- en: Using the backdoor factory and Armitage
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用后门工厂和 Armitage
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: In this chapter, we will take the host information that we have accumulated
    to determine the potential exploits to use against target machines and services.
    It is important to note that as you work through this section, you are going to
    be launching attacks against hosts. These attacks are going to create noise on
    the network that may be picked up by security devices. Under typical circumstances,
    you will spend substantial time validating whether your target is truly vulnerable
    to an exploit before launching it, so you don't create any unnecessary information
    that could be used to determine an active attack against a device.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用我们收集的主机信息来确定可能的漏洞，进而对目标机器和服务进行攻击。需要注意的是，在您完成此部分内容时，您将对主机发起攻击。这些攻击将会在网络上产生噪音，可能会被安全设备捕捉到。在典型情况下，您将花费大量时间验证目标是否确实易受某个漏洞攻击，然后再发起攻击，以避免产生任何不必要的信息，这些信息可能会被用于确定对设备的主动攻击。
- en: Searching the local exploit database
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 搜索本地漏洞数据库
- en: The searchsploit database is a local exploit database that comes standard with
    Kali. This is a great way to search for exploits offline or when you have no internet
    connectivity. Because of it's offline search capabilities, it's great for when
    you are operating in an air-gapped location.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: searchsploit 数据库是一个本地漏洞数据库，它是 Kali 标准配置的一部分。这是离线搜索漏洞的一个很好的方式，尤其是在没有互联网连接时。由于其离线搜索能力，它非常适合在受限网络环境中使用。
- en: Getting ready
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下前提条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 正在运行，并且您已以 root 用户身份登录
- en: Validate internet connectivity
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证互联网连接
- en: How to do it...
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now search the local exploit database:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将搜索本地漏洞数据库：
- en: Open the terminal screen by clicking on the terminal icon on the top left. ![](assets/7dcddfa6-829b-4b59-8756-ba029ec171d5.png)
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左上角的终端图标，打开终端屏幕。![](assets/7dcddfa6-829b-4b59-8756-ba029ec171d5.png)
- en: From the main terminal screen, you should be at a Command Prompt of `root@kali:~#`.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从主终端屏幕，您应该处于 `root@kali:~#` 命令提示符下。
- en: 'Review searchsploit options by entering the following command:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过输入以下命令，查看 searchsploit 选项：
- en: '[PRE0]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Update searchsploit
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更新 searchsploit
- en: 'We must start by ensuring our searchsploit database is updated:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须首先确保我们的 searchsploit 数据库已更新：
- en: 'From the main terminal prompt, enter the following command to update the searchsploit
    database:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从主终端提示符处，输入以下命令以更新 searchsploit 数据库：
- en: '[PRE1]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Regularly updating Kali with the APT package manager will also automatically
    update the database.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 定期使用 APT 包管理器更新 Kali 也会自动更新数据库。
- en: 'Install additional modules required to run some functions of searchsploit:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装运行 searchsploit 部分功能所需的额外模块：
- en: '[PRE2]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Run a simple query
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 执行一个简单查询
- en: 'We will run a simple query against our searchsploit database:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将对 searchsploit 数据库运行一个简单查询：
- en: 'From the main terminal prompt, let''s run a simple query looking for a known
    SMB vulnerability, `MS17-010`. You may recognize this as the vulnerability associated
    with WannaCry as well as other various malware worms:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从主终端提示符处，运行一个简单的查询，查找已知的 SMB 漏洞 `MS17-010`。您可能会认出这是与 WannaCry 以及其他各种恶意软件蠕虫相关的漏洞：
- en: '[PRE3]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'You will receive the following output:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将收到以下输出：
- en: '![](assets/0b7eb2b9-0ab4-4ac8-b61a-575a9ec7d14e.png)Searchsploit console output'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/0b7eb2b9-0ab4-4ac8-b61a-575a9ec7d14e.png)Searchsploit 控制台输出'
- en: 'Let''s take a look at some of the specifics related to one of the query results:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们来看看与某个查询结果相关的一些具体内容：
- en: '[PRE4]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The following output will show you that you are looking at a Metasploit module.
    This module is specifically designed to search devices to see whether they are
    vulnerable to this exploit.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下输出将显示您正在查看一个 Metasploit 模块。这个模块专门设计用于搜索设备，以查看它们是否容易受到此漏洞的攻击。
- en: We will discuss Metasploit shortly, but it's important to note that if this
    a vulnerability is not included in the default Metasploit database, we can import
    it for use.![](assets/44cf2077-5729-42ed-a9eb-b8044d7ac986.png)Nano output of
    a specific exploit
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 我们稍后会讨论 Metasploit，但需要注意的是，如果某个漏洞没有包含在默认的 Metasploit 数据库中，我们可以导入它以供使用。![](assets/44cf2077-5729-42ed-a9eb-b8044d7ac986.png)
    特定漏洞的 Nano 输出
- en: To exit the nano editor, type `<control>-x`; if you are asked to save modified
    buffer, type `n`.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要退出 nano 编辑器，输入 `<control>-x`；如果系统询问是否保存修改的缓冲区，输入 `n`。
- en: Explore some of the other results; you will note that `41987.py` is an exploit
    for this vulnerability written in Python.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览其他结果，你会注意到 `41987.py` 是一个用 Python 编写的针对该漏洞的利用代码。
- en: Understanding search options in searchsploit
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解 searchsploit 中的搜索选项
- en: There are several parameters you can search for using searchsploit; try the
    following examples.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 searchsploit 搜索多个参数；试试以下示例。
- en: 'The following command will search just the titles of the exploit database for
    `windows` and `remote`, allowing you to find the potential remote windows vulnerabilities:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下命令将仅搜索利用数据库中的`windows`和`remote`标题，从而帮助你找到潜在的远程 Windows 漏洞：
- en: '[PRE5]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'If you exported your nmap or zenmap results in an XML format, you can search
    against that for exploits. Run a quick `nmap` and output its results to `/root/test.xml`.
    The following command is used to search against that output file and will provide
    you with a list of exploits for your nmap search:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你将 nmap 或 zenmap 的结果导出为 XML 格式，可以针对该文件进行漏洞搜索。运行一次 `nmap` 并将其结果输出到 `/root/test.xml`。以下命令用于搜索该输出文件，并将为你提供与
    nmap 搜索相关的漏洞列表：
- en: '[PRE6]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Searching the online exploit database
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 搜索在线漏洞数据库
- en: We will use Firefox to review an online exploit database at [www.exploit-db.com](https://www.exploit-db.com/).
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 Firefox 来查看在线漏洞数据库 [www.exploit-db.com](https://www.exploit-db.com/)。
- en: The `exploit-db.com` site will have all the information in the searchsploit
    database, but some may find the web GUI interface easier to use and navigate.
    There may also be some slightly newer information on the website as the searchsploit
    database is only updated on a weekly basis. The `CAPTCHA` function of the website
    is one significant drawback of using the website.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '`exploit-db.com` 网站将包含 searchsploit 数据库中的所有信息，但有些人可能会觉得网页 GUI 界面更容易使用和浏览。由于
    searchsploit 数据库是每周更新一次，网站上可能还会有一些稍微更新的信息。网站的 `CAPTCHA` 功能是使用该网站的一个显著缺点。'
- en: Getting ready
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 确保以下前提条件：
- en: Kali Linux is running and you are logged in as root
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 正在运行并且你已以 root 身份登录
- en: Validate internet connectivity
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证互联网连接
- en: How to do it...
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now perform searches through the online exploit database:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将通过在线漏洞数据库进行搜索：
- en: From the main interface, launch the Firefox application. ![](assets/cbf60cb0-12d3-497b-ae7e-b13a660fdf39.png)
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从主界面启动 Firefox 应用程序。 ![](assets/cbf60cb0-12d3-497b-ae7e-b13a660fdf39.png)
- en: Go to the site named [https://www.exploit-db.com/search](https://www.exploit-db.com/search).
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问名为 [https://www.exploit-db.com/search](https://www.exploit-db.com/search)
    的网站。
- en: 'Enter `windows remote` in the search term, click on reCAPTCHA, and select Search:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在搜索框中输入 `windows remote`，点击 reCAPTCHA，然后选择搜索：
- en: '![](assets/c2132489-e169-4e5e-acc2-770b0fd935a6.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/c2132489-e169-4e5e-acc2-770b0fd935a6.png)'
- en: Firefox screen capture of the exploit-db.com website
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Firefox 截图，展示 exploit-db.com 网站
- en: 'You will be provided with an output as shown in the following screenshot. You
    will notice that you have a lot of clickable options to navigate through the database.
    You can use this to get more information and refine your searches:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到如下截图所示的输出。你会发现你有很多可点击的选项，可以用来浏览数据库。你可以利用这些选项获取更多信息并优化你的搜索：
- en: '![](assets/46b052eb-77a5-4632-94ad-aed2d805d3c0.png)Firefox screen capture
    of the exploit-db.com website vulnerability listClick on the orange More Optionsbutton
    to see additional search query options and try a few searches.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/46b052eb-77a5-4632-94ad-aed2d805d3c0.png) Firefox 截图，展示 exploit-db.com
    网站漏洞列表。点击橙色的更多选项按钮，查看额外的搜索查询选项，并尝试进行几次搜索。'
- en: The Metasploit setup and configuration
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Metasploit 的设置与配置
- en: The Metasploit Framework now comes as part of the Kali installation, thus making
    the setup and the initial configuration a relatively simple process.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，Metasploit 框架作为 Kali 安装的一部分，因此设置和初始配置过程相对简单。
- en: The Metasploit Framework is an open source development tool for creating and
    executing exploit code against machines. In the later releases of Kali, it has
    now become part of the core bundle of tools, and therefore very little setup is
    required to get it operational. In this recipe, we will take you through those
    few steps and get you up and run.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit框架是一个开源开发工具，用于针对机器创建和执行漏洞代码。在Kali的后续版本中，它已成为核心工具包的一部分，因此启动时几乎不需要任何设置。在本教程中，我们将带你完成这些简单的步骤，帮助你快速上手。
- en: Note that both the Metasploit Framework and Armitage use the same backend database,
    therefore if you have already initialized the database, skip to the heading –
    starting the *Metasploit framework initialization and startup *section.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，Metasploit框架和Armitage使用相同的后端数据库，因此如果你已经初始化了数据库，可以跳过到“启动*Metasploit框架初始化和启动*”部分。
- en: Getting ready
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下前提条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，并且你已以root身份登录
- en: Make sure you have run the updates recently
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保你最近已运行更新
- en: Validate internet connectivity
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证互联网连接
- en: How to do it...
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: There are several steps in preparing to use the Metasploit console that we will
    go through in this section.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 准备使用Metasploit控制台的过程有几个步骤，我们将在这一部分进行讲解。
- en: Metasploit Framework initialization and startup
  id: totrans-75
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Metasploit框架初始化和启动
- en: Begin by opening a terminal window by clicking on the terminal icon on the left. ![](assets/d29267da-7f1a-42a0-a025-e62917507ac8.png)
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，点击左侧的终端图标打开一个终端窗口。![](assets/d29267da-7f1a-42a0-a025-e62917507ac8.png)
- en: 'Metasploit uses a database to store information about targets, exploits, and
    other information. We need to begin by starting the database daemon. From the
    Command Prompt enter the following commands:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Metasploit使用数据库来存储目标、漏洞和其他信息。我们需要首先启动数据库守护进程。从命令提示符输入以下命令：
- en: '[PRE7]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Next, we will initialize the database (this only needs to be done once when
    first starting it):'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将初始化数据库（这只需要在第一次启动时完成一次）：
- en: '[PRE8]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: If you ever need to reinitialize the database to start over, you can use the
    `msfdb reinit` command. Be warned that all the existing data will be lost.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要重新初始化数据库从头开始，可以使用`msfdb reinit`命令。请注意，所有现有的数据将会丢失。
- en: 'Now, we can start the Metasploit console:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以启动Metasploit控制台：
- en: '[PRE9]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You will now be dropped in the main MSF screen. Note that your Command Prompt
    has now changed to `msf >`to indicate you are now in the console:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你将进入MSF的主界面。注意，你的命令提示符已经变成了`msf >`，表示你现在已进入控制台：
- en: '![](assets/732b0aeb-3b85-4df3-8ca0-ff8921333de4.png)msfconsole screenYour screen
    may look different to the previous screenshot. When the Metasploit Framework starts,
    it picks a different text based image (banner) to start with. You can run through
    them by typing `banner` at the `msf >` prompt.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/732b0aeb-3b85-4df3-8ca0-ff8921333de4.png)msfconsole屏幕你的屏幕可能与之前的截图有所不同。当Metasploit框架启动时，它会选择一个不同的文本图像（横幅）开始。你可以通过在`msf
    >`提示符下输入`banner`来查看不同的横幅。'
- en: 'Let''s validate our database is connected and operating properly. From the
    `msf >` prompt type the following command, if all is working well, you should
    see [*] postgresql connected to msf:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们验证数据库是否已连接并正常运行。从`msf >`提示符输入以下命令，如果一切正常，你应该看到[*] postgresql已连接到msf：
- en: '[PRE10]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Starting the Metasploit console
  id: totrans-88
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动Metasploit控制台
- en: 'From the Command Prompt, type the following:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在命令提示符下，输入以下内容：
- en: '[PRE11]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Stopping the Metasploit console
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 停止Metasploit控制台
- en: 'From the `msf >` console, type the following:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 从`msf >`控制台，输入以下内容：
- en: '[PRE12]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: There's more...
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'Although you can do all your work from the command line, we are going to use
    Armitage moving forward, Armitage is a GUI frontend to the Metasploit Framework.
    If you want to get more information on using the command line, two great resources
    are here:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然你可以通过命令行完成所有工作，但接下来我们将使用Armitage，Armitage是Metasploit框架的图形用户界面前端。如果你想获取更多关于使用命令行的信息，下面有两个很棒的资源：
- en: MSFconsole commands tutorial: [https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/](https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/)
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MSFconsole命令教程：[https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/](https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/)
- en: Metasploit cheat sheet: [https://www.sans.org/security-resources/sec560/misc_tools_sheet_v1.pdf](https://www.sans.org/security-resources/sec560/misc_tools_sheet_v1.pdf)
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Metasploit备忘单：[https://www.sans.org/security-resources/sec560/misc_tools_sheet_v1.pdf](https://www.sans.org/security-resources/sec560/misc_tools_sheet_v1.pdf)
- en: The Armitage setup
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Armitage设置
- en: Armitage is a graphical frontend to the Metasploit Framework.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: Armitage是Metasploit框架的图形前端。
- en: In this recipe, we will be setting up the Armitage graphical user interface
    for the Metasploit Framework. Based on your preference, you may like the GUI versus
    the command-line experience. However, you can use them both interchangeably at
    anytime because of their common database.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将为Metasploit框架设置Armitage图形用户界面。根据您的偏好，您可能会更喜欢图形界面，而不是命令行体验。然而，您可以随时互换使用两者，因为它们使用的是相同的数据库。
- en: Note that both the Metasploit Framework and Armitage use the same backend database,
    therefore if you have already initialized the database, skip to the section on
    starting Armitage.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，Metasploit框架和Armitage使用相同的后台数据库，因此如果您已经初始化了数据库，请跳到启动Armitage的部分。
- en: Getting ready
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，并且您以root身份登录
- en: Make sure you have run the updates recently
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保您最近已运行更新
- en: Validate internet connectivity
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证互联网连接
- en: Armitage initialization and startup
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Armitage初始化和启动
- en: 'We shall now initialize and start up Armitage:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将初始化并启动Armitage：
- en: Begin by opening a terminal window by clicking on the terminal icon on the left. ![](assets/404eda68-40fd-4546-b96a-3ff07a0396ff.png)
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先通过点击左侧的终端图标打开一个终端窗口。 ![](assets/404eda68-40fd-4546-b96a-3ff07a0396ff.png)
- en: 'Metasploit uses a database to store information about targets, exploits, and
    other information. We need to begin by starting the database daemon. From the
    Command Prompt, type the following:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Metasploit使用数据库存储关于目标、漏洞和其他信息。我们需要首先启动数据库守护进程。在命令提示符中，键入以下内容：
- en: '[PRE13]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Next, we will initialize the database (this only needs to be done once when
    first starting it):'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将初始化数据库（这只需要在首次启动时执行一次）：
- en: '[PRE14]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: If you ever need to reinitialize the database to start over, you can use the
    `msfdb reinit` command. Be warned that all the existing data will be lost.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要重新初始化数据库以重新开始，可以使用`msfdb reinit`命令。请注意，所有现有数据将会丢失。
- en: 'Start Armitage by typing this:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过键入以下命令启动Armitage：
- en: '[PRE15]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Click on Connect as shown in the following screenshot:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“连接”，如以下截图所示：
- en: '![](assets/699033fc-d7d7-4a38-a059-85d5390c81de.png)Armitage database connection
    screen'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/699033fc-d7d7-4a38-a059-85d5390c81de.png)Armitage数据库连接界面'
- en: 'Select Yes when asked to start the Metasploit RPC server:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在系统提示启动Metasploit RPC服务器时选择“是”：
- en: '![](assets/b9e95aad-124c-45ac-acc0-ebdff6572bb6.png)Armitage start RPC server
    screenYou may be asked for the IP address of your computer. Enter the IP address
    that you assigned to your host-only network. In my case it''s `192.168.56.102`.'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/b9e95aad-124c-45ac-acc0-ebdff6572bb6.png)Armitage启动RPC服务器界面您可能会被要求输入计算机的IP地址。请输入您分配给仅主机网络的IP地址。在我的例子中是`192.168.56.102`。'
- en: Stopping Armitage
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 停止Armitage
- en: 'To stop Armitage and exit:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 要停止Armitage并退出：
- en: 'To exit, click on Armitage at the top, and select Close:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要退出，点击顶部的Armitage，选择“关闭”：
- en: '![](assets/9d210521-6f99-4958-a6f3-02030213e265.png)Armitage menu with close
    option'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/9d210521-6f99-4958-a6f3-02030213e265.png)带有关闭选项的Armitage菜单'
- en: 'From the Command Prompt, type the following:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在命令提示符中，键入以下内容：
- en: '[PRE16]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Basic exploit attacks with Armitage
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Armitage进行基本漏洞攻击
- en: In this recipe, we will perform some very basic tasks of Armitage including
    loading an nmap scan, performing an nmap scan, finding attacks to use against
    the target, and exploiting the target machine.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在本教程中，我们将执行一些Armitage的基础任务，包括加载nmap扫描、执行nmap扫描、查找攻击目标以及攻击目标机器。
- en: Getting ready
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，并且您以root身份登录
- en: Make sure Armitage is running
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保Armitage正在运行
- en: Make sure, at a minimum, the Metasploitable VM and Windows XP VM are running;
    feel free to turn on other target hosts as you wish
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 至少确保Metasploitable虚拟机和Windows XP虚拟机正在运行；如果需要，可以随时启动其他目标主机
- en: How to do it...
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: From the main Armitage screen, we must start by finding our targets on the network.
    We have the ability to import hosts from prior nmap scans or run nmap from the
    Armitage console itself.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 从Armitage主屏幕开始，我们必须首先在网络上查找我们的目标。我们可以导入之前的nmap扫描结果，也可以直接从Armitage控制台运行nmap。
- en: Import an nmap scan
  id: totrans-136
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 导入nmap扫描
- en: 'We will begin by importing an nmap scan into Armitage:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先将nmap扫描导入Armitage：
- en: 'Select Hosts | Import Hosts from the top:'
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从顶部选择“主机”|“导入主机”：
- en: '![](assets/d361e47c-c2cb-4f70-b948-d014ab16390a.png)Armitage import hosts menu'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/d361e47c-c2cb-4f70-b948-d014ab16390a.png)Armitage导入主机菜单'
- en: 'Browse the file system, and select your nmap output XML file; click on Open:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 浏览文件系统，选择您的nmap输出XML文件；点击**打开**：
- en: '![](assets/36dc10cd-5ec4-431b-8150-adbb7cc1e595.png)Armitage open file dialog
    box'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/36dc10cd-5ec4-431b-8150-adbb7cc1e595.png)Armitage 打开文件对话框'
- en: 'You will now see your nmap scan results populated, and you may begin working
    on the devices:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您现在会看到nmap扫描结果已显示，并且可以开始处理设备：
- en: '![](assets/23a07b7d-2464-4b9f-939c-6a54f64c465f.png)Armitage nmap scan import
    results populated on screen'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/23a07b7d-2464-4b9f-939c-6a54f64c465f.png)Armitage nmap 扫描结果导入屏幕'
- en: Perform an nmap scan from the Armitage interface
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从Armitage界面执行nmap扫描
- en: 'To perform an nmap scan from within Armitage do the following:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 要在Armitage中执行nmap扫描，请执行以下操作：
- en: 'Select Hosts | Nmap Scan | Intense Scanfrom the top:'
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从顶部选择**主机**|**Nmap扫描**|**强力扫描**：
- en: '![](assets/62f03cff-1531-4528-9009-d16bf7e099de.png)Armitage nmap scan menu'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/62f03cff-1531-4528-9009-d16bf7e099de.png)Armitage nmap 扫描菜单'
- en: 'Enter our scan range; in this case, we will scan our entire `192.168.56.0/24`
    network, and click on OK. This scan can take a couple minutes to complete, so
    just be patient:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入我们的扫描范围；在此案例中，我们将扫描整个`192.168.56.0/24`网络，然后点击**确定**。此扫描可能需要几分钟时间才能完成，请耐心等待：
- en: '![](assets/ef561ca5-46af-4045-adf2-6dc40f4315fa.png)Armitage nmap input range
    dialog box'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/ef561ca5-46af-4045-adf2-6dc40f4315fa.png)Armitage nmap 输入范围对话框'
- en: 'Once finished, you will see a scan complete notification; and your console
    will now display your hosts. You can also close the nmap output window by clicking
    on the nmap x near nmap toward the middle of the screen:'
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 完成后，您将看到扫描完成通知；您的控制台现在会显示您的主机。您也可以通过点击屏幕中间附近的nmap图标旁的nmap **x**来关闭nmap输出窗口：
- en: '![](assets/2026e7fb-2ba3-4d3e-8f6f-3cdf9ad1089a.png)Armitage nmap scan results
    populated on screen'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/2026e7fb-2ba3-4d3e-8f6f-3cdf9ad1089a.png)Armitage nmap 扫描结果导入屏幕'
- en: Find attacks against a host
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查找针对主机的攻击
- en: 'We will use armitage to find attacks against hosts:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用Armitage来查找针对主机的攻击：
- en: At this point, let's work with our Metasploitable machine, which currently has
    an IP address of `192.168.56.104`. Click on it once to select it (this will be
    denoted with a green dotted outline).
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此时，让我们使用我们的Metasploitable机器，它当前的IP地址是`192.168.56.104`。点击它一次以选择（此时会显示绿色虚线轮廓）。
- en: 'If you right-click on the device, you will see a variety of options - select
    Services. This will bring up a list of all listening ports and services for that
    host. Scroll down a bit and take a look at all the information provided:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您右键点击设备，您会看到各种选项——选择**服务**。这将显示该主机的所有监听端口和服务列表。向下滚动一点，查看所有提供的信息：
- en: '![](assets/6b0bf026-316b-4348-936d-29a9e5004e4e.png)Armitage host services
    screen'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/6b0bf026-316b-4348-936d-29a9e5004e4e.png)Armitage 主机服务屏幕'
- en: 'Let''s find some possible attacks against the hosts. Click on Attacks | Find
    Attacks from the top. This could take a minute or two for it to correlate the
    information. When completed, you will receive an Attack Analysis Complete... dialog
    box. Select OK to close it:'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们寻找一些可能针对主机的攻击。从顶部点击**攻击**|**查找攻击**。这可能需要一两分钟来关联信息。完成后，您将看到一个**攻击分析完成**对话框。选择**确定**以关闭它：
- en: '![](assets/01ffd43c-ede4-4b82-9347-6b8268d2ceb4.png)Armitage find attacks menu'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/01ffd43c-ede4-4b82-9347-6b8268d2ceb4.png)Armitage 查找攻击菜单'
- en: 'Now, if we right-click on our host, we will see a new menu item labeled attack.
    Scroll through all the possible attack options you see there:'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，如果我们右键点击我们的主机，我们会看到一个新菜单项标记为**攻击**。浏览所有可能的攻击选项：
- en: '![](assets/0c1b2e18-2690-40ff-8b55-c1ab2862677a.png)Armitage attack menu'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/0c1b2e18-2690-40ff-8b55-c1ab2862677a.png)Armitage 攻击菜单'
- en: Exploit the host
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 利用主机
- en: 'We will now launch an exploit against a host:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将对主机发起漏洞利用：
- en: Now that we have attacks that will potentially compromise a host, let's go ahead
    and select one to run. Let's right-click on our Metasploitable machine, and select
    Attack | irc | unreal_ircd_3281_backdoor.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们已经有了可能会危及主机的攻击，让我们选择一个来执行。右键点击我们的Metasploitable机器，选择**攻击**|**irc**|**unreal_ircd_3281_backdoor**。
- en: 'You will be presented with options that you may have to scroll through and
    change. For instance, your LHOST should be the interface toward your target VMs.
    Make any needed changes, and click on Launch:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将看到一些选项，您可能需要滚动并进行更改。例如，您的LHOST应该是指向目标虚拟机的接口。进行所需更改后，点击**启动**：
- en: '![](assets/4e97f44a-a269-4600-877d-e290199986e6.png)Armitage exploit launch
    dialogBe patient, it may look like things have stalled or failed, but it will
    continue.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/4e97f44a-a269-4600-877d-e290199986e6.png)Armitage 漏洞利用启动对话框 请耐心等待，可能看起来像是卡住或失败，但它会继续进行。'
- en: 'You will now see that the Metasploitable device icon has changed to show it
    has been owned:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你会看到Metasploitable设备的图标已更改，显示它已被攻陷：
- en: '![](assets/3e477c47-f448-4873-b914-93fd82a729bc.png)Armitage main screen with
    indicator of exploited device'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/3e477c47-f448-4873-b914-93fd82a729bc.png)Armitage主屏幕，显示已攻陷的设备'
- en: 'So now that the device has been owned, let''s run a couple of simple commands.
    By right-clicking on the device, we will now see a new action called Shell 1; from
    there, we will select Interact:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 既然设备已被攻陷，让我们运行几个简单的命令。通过右键点击该设备，我们会看到一个新的操作叫做Shell 1；从这里，我们选择交互：
- en: '![](assets/ba35b338-999f-4f8e-be66-b1c3b642d358.png)Armitage shell interact
    screen'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/ba35b338-999f-4f8e-be66-b1c3b642d358.png)Armitage shell交互界面'
- en: 'You will now be presented with a new Shell 1 tab on the bottom with a $ prompt.
    Let''s see who we are on the box by entering the following command at the $ prompt:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你会看到底部出现一个新的Shell 1标签，并且显示$提示符。让我们通过在$提示符下输入以下命令来查看我们在该机器上是谁：
- en: '[PRE17]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'This should return the user you are currently authenticated as; in our case,
    we are root:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这应该返回你当前认证的用户；在我们的案例中，我们是root：
- en: '![](assets/56bd3121-bcbd-49aa-a7d7-eba470ed1b72.png)Armitage shell whoami output'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/56bd3121-bcbd-49aa-a7d7-eba470ed1b72.png)Armitage shell whoami 输出'
- en: 'Just to validate how much damage we can do to this machine, let''s enter the
    following at the $ prompt:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了验证我们能对这台机器造成多大的破坏，我们在$提示符下输入以下命令：
- en: '[PRE18]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Now, let''s login to our Metasploitable VM login with `msfadmin`/`msfadmin`,
    and run the following command:'
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们登录到我们的Metasploitable虚拟机，使用`msfadmin`/`msfadmin`登录，并运行以下命令：
- en: '[PRE19]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'You will see from the output that the file is there, it exists in the `bin`
    directory, and has read, write, and execute for user, group and everyone:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从输出中可以看到文件存在，位于`bin`目录中，且用户、组和所有人都有读取、写入和执行权限：
- en: '![](assets/8f42c49a-8a5f-4b6a-83eb-1abcd958e78a.png)Armitage command outputThe
    Hail Mary Attack - There is an attack listed as the Hail Mary. In short - Don''t
    do it. It''s noisy and will just throw everything after a target. It might be
    useful in a lab situation if you have a sample VM you are looking for exploits
    in, but for a live network or across the Internet, it will be seen very easily
    and is typically just an indication of the lack of experience and skill of the
    tester.'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/8f42c49a-8a5f-4b6a-83eb-1abcd958e78a.png)Armitage命令输出 “圣母攻击” - 这里有一个列出的攻击叫做圣母攻击。简而言之——不要使用它。它很吵，什么都扔向目标。如果你在实验室环境中有一个虚拟机寻找漏洞，它可能会有用，但在活跃的网络或互联网中，它会很容易被发现，通常只是显示测试者缺乏经验和技巧。'
- en: Advanced attacks with Armitage
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Armitage进行高级攻击
- en: In this recipe, we will now perform an advanced attack with Armitage against
    a Windows XP machine. We will perform several different functions such as initial
    exploitation, VNC access, downloading, and viewing files.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在本部分中，我们将使用Armitage对Windows XP机器进行一次高级攻击。我们将执行多个不同的操作，如初步利用、VNC访问、下载和查看文件。
- en: Getting started
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 入门
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，你已登录为root
- en: Make sure Armitage is running
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保Armitage正在运行
- en: Make sure at a minimum the Windows XP VM is running - feel free to turn on other
    target hosts as you wish
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 至少确保Windows XP虚拟机正在运行——可以根据需要启动其他目标主机
- en: How to do it...
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何执行...
- en: From our Armitage screen, let's select the Windows XP VM for this section.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 从Armitage屏幕中，选择Windows XP虚拟机进行本部分操作。
- en: Initial exploitation
  id: totrans-189
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 初步利用
- en: 'We will perform an initial exploitation of our windows VM:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将对Windows虚拟机进行初步利用：
- en: 'Right-click on the Windows XP VM, and select Attack | smb | ms08_067_netapi:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击Windows XP虚拟机，选择攻击 | smb | ms08_067_netapi：
- en: '![](assets/96b1659e-fce1-4c39-b2c1-9d19983ab78d.png)Armitage attack options'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/96b1659e-fce1-4c39-b2c1-9d19983ab78d.png)Armitage攻击选项'
- en: 'Make any modifications necessary including changing the LHOST if needed to
    the IP address on the VM network. Once ready, click on Launch:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据需要进行任何必要的修改，包括如果需要更改LHOST为虚拟机网络中的IP地址。准备好后，点击启动：
- en: '![](assets/299fa1f8-6539-4150-99ab-a2abff27eb33.png)Armitage attack dialog
    box'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/299fa1f8-6539-4150-99ab-a2abff27eb33.png)Armitage攻击对话框'
- en: You will now see that the Windows XP VM machine device's icon has been changed
    to again identify that this machine has been owned.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你会看到Windows XP虚拟机设备的图标已被更改，再次标识该机器已被攻陷。
- en: '![](assets/663ffd3b-5b13-49d0-9b72-6c0416f39091.png)Armitage main screen with
    indication of exploited device'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/663ffd3b-5b13-49d0-9b72-6c0416f39091.png)Armitage主屏幕，显示已被攻陷的设备'
- en: Dump hashes
  id: totrans-197
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 导出哈希
- en: 'We will now perform a password hash dump of the windows VM:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将对Windows虚拟机执行密码哈希导出：
- en: Let's now dump the user hashes, so we can crack them later and use them as part
    of other exploits. Start by right-clicking on the Windows XP VM, and you will
    see a new option. Select Meterpreter 3 | Access | Dump Hashes | registry method; at
    the next screen, select Launch.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在让我们转储用户哈希，以便稍后破解它们并将其用作其他漏洞利用的一部分。从右击Windows XP虚拟机开始，你将看到一个新的选项。选择Meterpreter
    3 | 访问 | 转储哈希 | 注册表方法；在下一个屏幕中，选择启动。
- en: You will now see the hashes dumped to the screen, and they will also be saved
    in our loot store. Also, take a look through the output file; and you will see
    that password hints were also dumped. Jane Doe's password hint is `jane123` -
    Could that be her password?
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你将看到哈希值显示在屏幕上，并且它们也会被保存在我们的战利品库中。另外，查看输出文件，你会看到密码提示也被转储了。Jane Doe的密码提示是`jane123`——这可能是她的密码吗？
- en: '![](assets/786c8fa7-ca57-45e7-a092-781ceeaf7976.png)armitage hashdump output'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/786c8fa7-ca57-45e7-a092-781ceeaf7976.png)armitage哈希转储输出'
- en: If you close the dump hashes window, you can go back in and click on View | Loot;
    and double-click on the host to see the hashes.
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你关闭了哈希转储窗口，可以重新进入并点击查看 | 战利品；然后双击主机查看哈希值。
- en: Interacting with the Windows machine
  id: totrans-203
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 与Windows机器互动
- en: 'We will now open a command shell to interact with the Windows VM directly:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将打开一个命令行来直接与Windows虚拟机互动：
- en: Right-click on the Windows XP VM, and select Meterpreter 3 | Interact | Command
    Shell.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右击Windows XP虚拟机，选择Meterpreter 3 | 互动 | 命令行。
- en: 'Try running some Windows commands, and see what you get back:'
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 尝试运行一些Windows命令，看看会有什么返回：
- en: '[PRE20]'
  id: totrans-207
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Now, let''s start VNC and see what we can do from the desktop. Right-click
    on the Windows XP VM, and select Meterpreter 3 | Interact | Desktop (VNC). You
    will be presented with a screen similar as follows. Note the port number for this
    VNC session:'
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，让我们启动VNC，看看从桌面可以做些什么。右击Windows XP虚拟机，选择Meterpreter 3 | 互动 | 桌面（VNC）。你将看到类似如下的屏幕。注意此VNC会话的端口号：
- en: '![](assets/998c59d7-bbbd-4270-8b9d-509ec7d9eb62.png)Armitage VNC bind information
    box'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/998c59d7-bbbd-4270-8b9d-509ec7d9eb62.png)Armitage VNC绑定信息框'
- en: Let's now click on our terminal icon from the left. ![](assets/02f2e238-5a98-477c-a161-00d1d2cfb6c2.png)
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在让我们点击左侧的终端图标。![](assets/02f2e238-5a98-477c-a161-00d1d2cfb6c2.png)
- en: 'Enter the following command from the shell:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从shell输入以下命令：
- en: '[PRE21]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'You will now be brought to the Windows XP machine:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你将进入Windows XP机器：
- en: '![](assets/a568e575-8b48-4637-821c-7b1e991f548d.png)VNC view of Windows XP
    VM'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/a568e575-8b48-4637-821c-7b1e991f548d.png)Windows XP虚拟机的VNC视图'
- en: Browsing the target's files
  id: totrans-215
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 浏览目标文件
- en: 'We will now browse the file system of the Windows machine:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将浏览Windows机器的文件系统：
- en: 'Right-click on the Windows XP VM, and select Meterpreter 3 | Explore| Browse
    Files. You will be presented with a familiar file browsing interface:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右击Windows XP虚拟机，选择Meterpreter 3 | 探索 | 浏览文件。你将看到一个熟悉的文件浏览界面：
- en: '![](assets/5f31f37e-e22d-42e8-9bfb-745f0985555f.png)Armitage browse files screen'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/5f31f37e-e22d-42e8-9bfb-745f0985555f.png)Armitage浏览文件屏幕'
- en: 'You will see that you can browse and change directories. You can create directories
    and upload files; and if you right-click on a file, you will have other options
    such as view and download. Download a couple of files, and then go to View | Downloads
    to see them:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到你可以浏览并更改目录。你可以创建目录和上传文件；如果右击文件，你将看到其他选项，如查看和下载。下载几个文件后，去查看 | 下载，看看它们：
- en: '![](assets/2b6bc200-37a1-4449-b663-432eb5611742.png)Armitage downloaded files
    screen'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/2b6bc200-37a1-4449-b663-432eb5611742.png)Armitage下载文件屏幕'
- en: There's more...
  id: totrans-221
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多内容...
- en: We will be covering topics such as cracking the user password in [Chapter 6](868da5dc-85d4-4ac2-9325-1274b75c8c7d.xhtml),
    *Password Cracking* and persistence in [Chapter 10](02e6452a-b223-4edb-954a-fef51f21215e.xhtml),
    *Maintaining Access*. You may want to go do those recipes now, as they are a continuation
    of where we are now.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将涵盖诸如在[第6章](868da5dc-85d4-4ac2-9325-1274b75c8c7d.xhtml)中破解用户密码，*密码破解*以及在[第10章](02e6452a-b223-4edb-954a-fef51f21215e.xhtml)中保持持久性，*保持访问*等主题。你现在可能想要去做这些练习，因为它们是我们现在内容的延续。
- en: Using the backdoor factory and Armitage
  id: totrans-223
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用后门工厂和Armitage
- en: We will use the backdoor factory and Armitage in combination to compromise a
    target system. The backdoor factory is a tool that can insert exploit code to
    a Windows executable file. This is great when you are trying to exploit a user
    through them downloading software, or even through physical attacks such as dropping
    USB keys.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将结合使用后门工厂和Armitage来攻破目标系统。后门工厂是一个工具，可以向Windows可执行文件插入漏洞利用代码。当你试图通过让用户下载软件，甚至通过诸如投放USB密钥等物理攻击来攻击用户时，这个工具非常有用。
- en: Getting ready
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备就绪
- en: 'Let''s ensure the following prerequisites:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们确保以下先决条件：
- en: Kali Linux is running, and you are logged in as root
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux正在运行，并且你已作为root用户登录
- en: Armitage is running
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Armitage正在运行
- en: Your Windows XP VM is running
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你的Windows XP虚拟机正在运行
- en: How to do it...
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'We will now use Backdoor Factory to insert exploit code into an executable:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将使用Backdoor Factory将漏洞利用代码插入到可执行文件中：
- en: First, let's browse and find a popular software package that a user might want
    to download or may seem benign or enticing. In our case, let's go out and grab
    putty. Every network admin has probably used putty at some point in the past.
    Open Firefox ![](assets/6f82804b-8a95-416b-b669-6e8ff80e87d5.png) and browse to
    [www.putty.org](http://www.putty.org/). From this site, download `putty.exe` (32
    bit version); and save the file in your `Downloads` directory.
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，让我们浏览并找到一个用户可能想下载的流行软件包，或者可能看起来无害或诱人的软件。在我们的例子中，让我们去下载putty。每个网络管理员可能都曾在某个时刻使用过putty。打开Firefox ![](assets/6f82804b-8a95-416b-b669-6e8ff80e87d5.png) 并访问[www.putty.org](http://www.putty.org/)。从该站点下载`putty.exe`（32位版本）；并将文件保存到你的`Downloads`目录中。
- en: You will have to scroll down a bit on the page to find the EXE file - do not
    use the MSI file for this exercise.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要在页面上滚动一下才能找到EXE文件——不要使用MSI文件进行此练习。
- en: 'Open terminal ![](assets/676c69cd-bdae-4e05-b279-ba736000eec3.png) and enter
    the following. We will first make an exploit directory, and then copy the `putty.exe`
    file to that directory:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开终端 ![](assets/676c69cd-bdae-4e05-b279-ba736000eec3.png) 并输入以下命令。我们首先创建一个漏洞利用目录，然后将`putty.exe`文件复制到该目录中：
- en: '[PRE22]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Next, let''s take an initial run of backdoor factory and see what we have available
    to insert into `putty.exe`:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，让我们首先运行Backdoor Factory，看看我们可以将哪些内容插入到`putty.exe`中：
- en: '[PRE23]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![](assets/4837a190-8cee-4bf7-9129-af6b869d506f.png)Backdoor factory output
    screen for available shell code'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/4837a190-8cee-4bf7-9129-af6b869d506f.png)Backdoor Factory可用Shell代码输出屏幕'
- en: 'Note the options that are available to use with this executable file. We will
    go ahead and select `reverse_shell_tcp_inline`, use the IP of our Kali machine,
    and use a port number by entering the following command. During the execution
    of the command, you will be asked a question about where you can inject the code;
    let''s simply select `1`:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意可用于此可执行文件的选项。我们将选择`reverse_shell_tcp_inline`，使用我们Kali机器的IP，并输入以下命令来使用端口号。在执行命令时，系统会询问你可以在哪里注入代码；我们简单地选择`1`：
- en: '[PRE24]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![](assets/86baa271-16cd-42ec-bf4e-56bf2bd12265.png)Backdoor factory successfully
    adding shell code to putty.exe fileNote that we used a `-X` for a command-line
    option for backdoor factory. The `-X` option indicates that this file should be
    allowed to run on Windows XP. Also don''t give up if the first time you try building
    the exploit it fails. If you have problems try other options and vectors. As software
    is updated often your results may not work exactly as mine did. This is expected.'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/86baa271-16cd-42ec-bf4e-56bf2bd12265.png)Backdoor Factory成功将Shell代码添加到putty.exe文件中'
- en: Now, we will see a new `backdoored` directory in our `Home` directory that has
    `putty.exe` with the exploit in it. Move that file to your Windows XP machine,
    but don't run it yet.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将在`Home`目录中看到一个新的`backdoored`目录，其中包含带有漏洞利用的`putty.exe`。将该文件移动到你的Windows
    XP机器上，但不要立即运行它。
- en: 'Start Armitage and go to the main screen. From the dropdown directory on the
    left, select exploit | multi | handler, and click on it:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动Armitage并进入主屏幕。从左侧的下拉目录中选择exploit | multi | handler，然后点击它：
- en: '![](assets/4a51b563-07a6-491d-9409-7318e7a4e753.png)Armitage handler menu'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/4a51b563-07a6-491d-9409-7318e7a4e753.png)Armitage处理程序菜单'
- en: 'You will be brought to a dialog screen, so select the proper IP and port number
    that corresponds to what we enter for the information before. In our case, it
    is the Kali machine with an IP of `192.168.56.10`; and we used a port of `8123`.
    Click on Launch:'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 系统将显示一个对话框，选择与我们之前输入的信息对应的正确IP和端口号。在我们的例子中，IP是`192.168.56.10`，端口是`8123`。点击启动：
- en: '![](assets/de1c3924-b8a2-4a2d-9bc0-6e03b0925c0e.png)Armitage launch dialog
    screen'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/de1c3924-b8a2-4a2d-9bc0-6e03b0925c0e.png)Armitage启动对话框'
- en: 'You will see the handler launch; note at the top that your Windows XP machine
    appears normal:'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你将看到处理程序启动；注意顶部，你的Windows XP机器看起来正常：
- en: '![](assets/faf7c8ee-61f5-41a1-a6ab-17cb17cc5ffb.png)Armitage output screen'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/faf7c8ee-61f5-41a1-a6ab-17cb17cc5ffb.png)Armitage输出屏幕'
- en: 'Now, launch `putty.exe` on your Windows VM:'
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，在你的 Windows 虚拟机上启动`putty.exe`：
- en: '![](assets/3eceb676-0ed3-40bb-a86a-5a665f6dc56a.png)Windows XP running exploited
    putty.exe file'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/3eceb676-0ed3-40bb-a86a-5a665f6dc56a.png)Windows XP 正在运行被利用的 putty.exe
    文件'
- en: 'Note that your Windows XP Machine icon will now change to show that it has
    been exploited; and you will also see that the session has opened from the console
    output:'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意，你的 Windows XP 机器图标现在会变化，显示它已被利用；同时你也会看到会话已从控制台输出打开：
- en: '![](assets/52f01d24-1dcf-4c83-9133-84e0b95c5917.png)Armitage screen showing
    successful connection and exploited device icon'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/52f01d24-1dcf-4c83-9133-84e0b95c5917.png)Armitage 屏幕显示成功连接和被利用设备图标'
- en: 'If you right-click on the Windows XP machine, you can select Shell 1 | Interact. You
    will then be dropped into a shell screen to do as you wish:'
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你右键点击 Windows XP 机器，你可以选择 Shell 1 | Interact。然后，你会进入一个 shell 界面，可以根据需要操作：
- en: '![](assets/930e4524-6007-4a05-a746-d4d3ec723dda.png)Armitage showing command
    shell screen'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '![](assets/930e4524-6007-4a05-a746-d4d3ec723dda.png)Armitage 显示命令行界面'
