- en: Chapter 12. Network Forensics
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第12章 网络取证
- en: Network forensics is a separate large area of Computer Forensics. It also includes
    various fields. Under network forensics, we should understand forensics where
    the main evidence is researched digital network traffic logs of network equipment,
    network applications, such as proxies, firewalls, servers, and so on.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 网络取证是计算机取证中的一个独立大领域，也包括多个领域。在网络取证中，我们应当理解取证方法，其中主要证据是研究网络设备、网络应用（如代理、防火墙、服务器等）的数字网络流量日志。
- en: Together with a conventional host-based network, forensics allows us to resolve
    the incident more efficiently. Information from the network layer provides a complete
    picture of what happened. Moreover, in some cases the analyst does not have access
    to these compromised machines because attackers use encryption, delete files,
    or use other techniques to hide information.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 与常规的主机网络取证结合使用时，它可以更有效地解决事件。来自网络层的信息提供了发生事件的完整图景。此外，在某些情况下，分析师无法访问这些被攻陷的机器，因为攻击者使用加密、删除文件或使用其他技术来隐藏信息。
- en: In cases of complex targeted attacks, initial network intrusion is only the
    first stage of an attack. The next steps for the promotion of the network, the
    development of the attack, the collection of information, and data exfiltration
    occur with the use of the network.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在复杂的定向攻击中，初始的网络入侵只是攻击的第一阶段。接下来的步骤包括网络推广、攻击发展、信息收集和数据外泄，这些都需要通过网络进行。
- en: Network traffic data relates to the volatility, therefore, to collect network
    traffic that is necessary to perform a series of preparatory measures for the
    collection of data.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 网络流量数据与易变性有关，因此，为了收集网络流量，有必要进行一系列准备措施来收集数据。
- en: Network data collection
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络数据收集
- en: 'All data that can be retrieved from the network traffic can be divided into
    several levels:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 从网络流量中可以提取的所有数据可以分为几个层级：
- en: Full Packet Capture 100%
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 完整数据包捕获 100%
- en: Packet String Data 4%
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据包字符串数据 4%
- en: Sessions 0.1%
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 会话 0.1%
- en: Statistics
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 统计数据
- en: Logs
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 日志
- en: It is obvious that, from the point of view of a forensics analyst, the most
    preferred method is to collect full traffic, as in this case, we obtain the most
    complete dataset.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 很明显，从取证分析师的角度来看，最优先的方法是收集完整的流量，因为在这种情况下，我们可以获得最完整的数据集。
- en: However, along with the obvious advantages, this approach has a number of drawbacks.
    A large amount of data for storage and subsequent analysis requires a lot of time
    and resources.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，尽管这种方法有明显的优势，但也存在一些缺点。大量的数据存储和后续分析需要大量的时间和资源。
- en: At the same time, other forms of data, such as NetFlow, in many cases is a reasonable
    alternative, and it requires fewer resources for the collection and storage and
    to process.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 与此同时，其他形式的数据，如 NetFlow，在许多情况下是一个合理的替代方案，它需要更少的资源来收集、存储和处理。
- en: Compared to other forms of full traffic, data altogether constitutes only a
    few percent. It require less space for storage and, therefore, can be stored for
    a longer time period.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 与其他形式的完整流量相比，这些数据总共只占几个百分点。它需要更少的存储空间，因此可以存储更长时间。
- en: For clarity, consider the following example. Let's suppose an organization has
    a daily volume of network traffic in a 1 TB per day on weekdays and 100 GB over
    the weekend, while the weekly storage data volume requires 5.2 TB.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更清楚地说明，考虑以下例子。假设一个组织的日常网络流量量在工作日为 1 TB/天，周末为 100 GB，而每周的存储数据量需要 5.2 TB。
- en: The data in other formats require *5200 * 0.041 = 213.2 MB* per week. Thus,
    the total amount required for data storage is the weekly amount 5.4 TB or an average
    of approximately 770 MB per day.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 其他格式的数据每周需要 *5200 * 0.041 = 213.2 MB*。因此，数据存储所需的总量为每周 5.4 TB，或平均每天大约 770 MB。
- en: If we talk about the need to ensure a minimum of three months storage, it will
    require 69 TB space on the disc. In addition to the processing of such large amounts
    of data, it requires a lot of time and power equipment.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们谈到确保至少存储三个月的数据，它将需要 69 TB 的磁盘空间。除了处理如此大量的数据外，还需要大量的时间和电力设备。
- en: However, this problem can be solved by a combined approach to the collection
    and analysis of network data. Namely, it is possible to store a complete traffic
    only for a week and the rest of the data for the year.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这个问题可以通过结合收集和分析网络数据的方法来解决。具体来说，可以只存储一周的完整流量，而将其余的数据存储一年。
- en: Thus, the storage network data for the year 5200 will need *0.041 + 5200 * /
    7 * 365 = 16.32 TB*.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，存储网络数据一年5200将需要*0.041 + 5200 * / 7 * 365 = 16.32 TB*。
- en: As mentioned earlier, the Full Packet Capture data collection and NetFlow prerequire
    arrangements to collect the data before the incident. Unfortunately, often at
    the time of the incident, it appears that the organization has no Full Packet
    Capture, no NetFlow data. In this case, our only hope is that the processes of
    logging has been enabled on the server and networking equipment.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Full Packet Capture数据收集和NetFlow前提条件要求在事件发生之前收集数据。不幸的是，在事件发生时，往往会发现组织没有Full
    Packet Capture，也没有NetFlow数据。在这种情况下，我们唯一的希望是服务器和网络设备上的日志记录过程已经启用。
- en: Next, consider the work with different data types, as often forensics analysts
    work with data that is available at the moment of working on the incident.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，考虑与不同数据类型的工作，因为法医分析师通常处理的是在事件发生时可用的数据。
- en: Exploring logs
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索日志
- en: The most ubiquitous connectivity options of the corporate network to the Internet
    is to use a proxy server. Moreover, all protocols except HTTP and HTTPS are blocked
    by a firewall. Therefore, we consider this particular scheme. A proxy server is
    a server that is an intermediary between the client and server. Proxies can be
    used for almost any network protocol, but they are most often used for the web
    traffic for HTTP and HTTPS.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 企业网络连接到互联网最普遍的方式是使用代理服务器。此外，除HTTP和HTTPS外，所有协议都被防火墙阻止。因此，我们考虑这个特定方案。代理服务器是客户端和服务器之间的中介。代理可以用于几乎所有网络协议，但最常用于Web流量的HTTP和HTTPS。
- en: In this case, a forensics analyst usually has a data proxy server. Proxy logs
    are invaluable in analyzing what URL is accessing the corporate network machines.
    Analysis of the logs of the proxy server allows you to quickly identify which
    workstations are exposed to a malicious resource. This is done much faster than
    in the analysis of each client machine.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，法医分析师通常会有一个数据代理服务器。代理日志在分析访问企业网络机器的URL时非常宝贵。分析代理服务器的日志可以快速识别哪些工作站暴露于恶意资源。比起分析每台客户端机器，这个过程要快得多。
- en: 'Typically, proxy logs include not only the time and IP address of the client
    and the URL, but they also include the status of the HTTP response and the username:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，代理日志不仅包括客户端的时间和IP地址以及URL，还包括HTTP响应状态和用户名：
- en: Unix timestamp (`sec.ms`)
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Unix时间戳（`sec.ms`）
- en: Response time (`ms`)
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 响应时间（`ms`）
- en: Requestor IP/name
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求者IP/名称
- en: Cache status and HTTP status code
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缓存状态和HTTP状态码
- en: Reply size (bytes)
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 回复大小（字节）
- en: Request method (GET, POST, and so on)
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求方法（GET、POST等）
- en: URL requested
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求的URL
- en: Username (if available)
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户名（如果可用）
- en: Squid hierarchy status and Server IP / peer name
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Squid层次状态和服务器IP/对等名称
- en: MIME type
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MIME类型
- en: Also, caching the proxy server allows you to store additional copies of all
    the requested objects. In some cases, this is the only way to obtain the necessary
    files and perform the analysis.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，缓存代理服务器使你能够存储所有请求对象的额外副本。在某些情况下，这是获取所需文件并执行分析的唯一方法。
- en: Today there are many different proxies, both commercial and free. However, probably
    the most popular at the moment is Squid. Among the free servers, NGINX can also
    be noted.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 目前有许多不同的代理服务器，既有商业的也有免费的。然而，可能目前最受欢迎的是Squid。在免费的服务器中，NGINX也可以被提及。
- en: There are also a number of commercial solutions both hardware and in software
    form. Among commercial proxies, one of the most popular is the BlueCoat proxy.
    Among its advantages is its ability to proxy SSL traffic.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 也有许多商业解决方案，既有硬件形式，也有软件形式。在商业代理中，最受欢迎的之一是BlueCoat代理。它的优点之一是能够代理SSL流量。
- en: Other popular solutions in the corporate environment are ForeFront Threat Managment
    Gateway (formerly, Microsoft ISA Server) and the decision of the Barracuda Network.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 其他在企业环境中流行的解决方案包括ForeFront Threat Management Gateway（前身为Microsoft ISA Server）和Barracuda
    Network的解决方案。
- en: All of them have their own formats of log files, and we will not consider all
    of these decisions. We will focus on a detailed examination of Squid.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 它们都有自己日志文件的格式，我们不会考虑所有这些方案。我们将专注于详细检查Squid。
- en: As noted earlier, Squid is one of the most popular and free solutions formed
    around a large community of users. This decision can be found in both small networks
    and large enterprises. Squid has great potential, and it is relatively easy to
    install.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Squid 是围绕着一个庞大的用户社区形成的最流行且免费的解决方案之一。这个决策可以在小型网络和大型企业中找到。Squid 具有巨大的潜力，并且相对容易安装。
- en: An experienced administrator can configure Squid as a caching server with different
    filtering rules for different file types and a large number of additional options.
    All these settings are in the Squid configuration file, and they must be copied
    for analysis along with the log files. The default configuration file is located
    in `/etc/squid/squid.conf`. This file is well documented and explains many settings
    in the configuration file, specified as the location of the log files and cache.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 一个经验丰富的管理员可以将 Squid 配置为一个缓存服务器，针对不同文件类型设定不同的过滤规则，并提供大量额外选项。所有这些设置都在 Squid 配置文件中，并且必须与日志文件一起复制进行分析。默认的配置文件位于
    `/etc/squid/squid.conf`。该文件有详细的文档，解释了配置文件中的许多设置，包括日志文件和缓存的存放位置。
- en: Log files contain information about all client requests made via the HTTP protocol.
    The cache directory contains responses from web servers to clients. During the
    investigation, the analyst can get all the files and analyze them.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 日志文件包含了通过 HTTP 协议发出的所有客户端请求的信息。缓存目录则包含了来自 web 服务器的响应。在调查过程中，分析师可以获取所有文件并对其进行分析。
- en: By default, Squid provides a lot of information about every request it receives
    from customers. Thus, during the investigation, the analyst can get all objects
    from HTTP traffic passing through the proxy. Attackers often use the HTTP protocol
    to deliver malicious software as well as as a means of communication to communicate
    with the C & C servers, so proxy is a good place to collect information about
    such activity.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Squid 会提供关于每个请求的大量信息，这些请求来自客户。因此，在调查过程中，分析师可以获取所有通过代理的 HTTP 流量对象。攻击者通常利用
    HTTP 协议传输恶意软件，并作为与 C&C 服务器进行通信的手段，因此代理是收集此类活动信息的一个好地方。
- en: 'Usually entry in the log file of the proxy server Squid (`access.log`) is as
    follows:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，代理服务器 Squid 的日志文件（`access.log`）中的条目如下：
- en: '[PRE0]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'It is worth noting that the query string is logged and does not default. To
    remedy this situation, it is necessary to make a corresponding change in the configuration
    file, namely this line:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是，查询字符串会被记录并且不会默认启用。为了解决这种情况，必须在配置文件中做相应的更改，即这一行：
- en: '[PRE1]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Besides this, it is also useful to include logging the following information:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 除此之外，记录以下信息也是非常有用的：
- en: '[PRE2]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: These options can be particularly useful in investigations. Also, since the
    Squid 2.6 version, you now have the opportunity to ask your own log format via
    the `logformat` option in the configuration file.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 这些选项在调查中尤其有用。此外，从 Squid 2.6 版本开始，你现在可以通过配置文件中的 `logformat` 选项来指定你自己的日志格式。
- en: Thus, the administrator can specify an alternate log file and format string.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，管理员可以指定备用日志文件和格式字符串。
- en: 'Let''s take the following example:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看以下示例：
- en: '[PRE3]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'As the Squid log file is simply a text file, it is easy to automate using scripting
    languages and command-line utilities. There is also a large number of different
    log file analyzers in Squid. Here are some of them:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 Squid 的日志文件仅仅是一个文本文件，因此可以很容易地通过脚本语言和命令行工具来进行自动化处理。此外，Squid 中还有大量不同的日志文件分析器。以下是其中的一些：
- en: Squidview: [http://www.rillion.net/squidview/](http://www.rillion.net/squidview/)
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Squidview: [http://www.rillion.net/squidview/](http://www.rillion.net/squidview/)
- en: Calamaris: [http://cord.de/calamaris-english](http://cord.de/calamaris-english)
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Calamaris: [http://cord.de/calamaris-english](http://cord.de/calamaris-english)
- en: SARG: [http://sourceforge.net/projects/sarg/](http://sourceforge.net/projects/sarg/)
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SARG: [http://sourceforge.net/projects/sarg/](http://sourceforge.net/projects/sarg/)
- en: 'Each has its advantages and disadvantages, so you need to choose the most appropriate:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 每种方式都有其优缺点，因此需要选择最合适的：
- en: '[PRE4]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Consider the case when the disposal of such, analysts have a full dump of the
    network traffic. In some cases, recording network traffic is included in the investigation
    of the incident after the incident and detection. Even in this situation, network
    traffic analysis can greatly enhance the effectiveness of the investigation.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下情况，当分析师有网络流量的完整转储时。在某些情况下，记录网络流量是事件发生后调查和检测的一部分。即便是在这种情况下，网络流量分析也能大大提高调查的有效性。
- en: To capture network traffic, the most often used format is the PCAP format. This
    format is supported by most of the tools for data collection, analysis, and detection.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 捕获网络流量时，最常用的格式是PCAP格式。大多数数据收集、分析和检测工具都支持这种格式。
- en: Most of the popular utilities are built on the `libpcap` library, including `tcpdump`
    and `wireshark`, and they have similar functionality.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数流行的工具都建立在`libpcap`库之上，包括`tcpdump`和`wireshark`，它们具有类似的功能。
- en: Using tcpdump
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用`tcpdump`
- en: The `tcpdump` tool is used to collect and analyze network packets. It is ideal
    for the analysis of individual packages and for their consistency. In the case
    of automatic processing, `tcpdump` has several advantages.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '`tcpdump`工具用于收集和分析网络数据包。它非常适合分析单个包及其一致性。在自动处理的情况下，`tcpdump`具有多个优点。'
- en: 'To read a previously recorded `pcap` file, you can use the following command:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 要读取之前记录的`pcap`文件，你可以使用以下命令：
- en: '[PRE5]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The default `tcpdump` displays information about each packet, while the output
    format is protocol-dependent:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`tcpdump`显示每个数据包的信息，输出格式取决于协议：
- en: '[PRE6]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'In addition to make the output more informative, `-v -vvv` can be used, as
    in the following example:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使输出更加详细外，还可以使用`-v -vvv`，如以下示例所示：
- en: '[PRE7]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: With the `-x` option, you can make `tcpdump` output packets in the `heh` format
    or into ASCII using`-A` or `-X`, and `tcpdump` allows you to output in two formats
    simultaneously.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`-x`选项，你可以让`tcpdump`以`heh`格式输出数据包，或者使用`-A`或`-X`输出为ASCII格式，并且`tcpdump`允许你同时输出两种格式。
- en: 'In many cases, especially when handling large `pcap` files, the ability to
    use filters to discard unnecessary data is particularly useful. The `tcpdump`
    tools allows BPF filters. For example, to filter only TCP packets to port `80`,
    you can use the following command:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，尤其是处理大型`pcap`文件时，使用过滤器丢弃不必要数据的能力特别有用。`tcpdump`工具支持BPF过滤器。例如，要只过滤TCP数据包到端口`80`，你可以使用以下命令：
- en: '[PRE8]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'To write the filtered data to a file you must use the `-w` option, as follows:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 要将过滤后的数据写入文件，必须使用`-w`选项，如下所示：
- en: '[PRE9]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Sometimes, it is necessary to use a set of filters, and in this case, it is
    more convenient to write the filter set in the file and, thus, to use a file with
    the `-F` optional filters:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，需要使用一组过滤器，在这种情况下，将过滤器集写入文件更为方便，从而使用带有`-F`选项的过滤器文件：
- en: '[PRE10]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: For more information on the various keys to use `tcpdump`, use the `man tcpdump`
    command.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取有关`tcpdump`各种键的更多信息，使用`man tcpdump`命令。
- en: Using tshark
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用`tshark`
- en: Another useful tool for the analysis of `pcap` files is `tshark.`
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个用于分析`pcap`文件的有用工具是`tshark`。
- en: The `tshark` tool is a console version WireShark. `tshark` has virtually the
    same functionality as `tcpdump,` but it adds the possibility of a WireShark protocol
    analyzer and uses syntax to filter.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '`tshark`工具是WireShark的控制台版本。`tshark`几乎具有与`tcpdump`相同的功能，但它增加了WireShark协议分析器的可能性，并使用语法进行过滤。'
- en: To read a previously recorded `pcap` file the `-r` option is also used. The
    output format depends on the protocol. Thus, `tshark` shows application-level
    information.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 要读取之前记录的`pcap`文件，也可以使用`-r`选项。输出格式取决于协议。因此，`tshark`会显示应用层信息。
- en: To obtain additional information, use the `-V` option. To display packets in
    hex and ASCII formats, use the `-x` option.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取更多信息，使用`-V`选项。要以十六进制和ASCII格式显示数据包，使用`-x`选项。
- en: Tshark allows the use of filters capture when using syntax that is similar to
    tcpdump's BPF, and display filters can be used when the built-in protocol analyzers.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Tshark允许使用类似于tcpdump的BPF语法来捕获过滤器，并且在使用内置协议分析器时，可以使用显示过滤器。
- en: 'For the use of, filters should be used with the `-f` option and the `-R` recording
    and read option. So to read `pcap` file of DNS traffic, you can use the following
    command:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 对于过滤器的使用，应结合`-f`选项和`-R`录制及读取选项一起使用。因此，要读取DNS流量的`pcap`文件，可以使用以下命令：
- en: '[PRE11]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Another useful feature is the ability to generate tshark statistics from the
    analyzed traffic. To do this, use the `-z` option. A full list of the available
    statistics are available through the man pages on tshark.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有用的功能是能够从分析的流量中生成`tshark`统计信息。为此，使用`-z`选项。可以通过`tshark`的man页面查看完整的统计信息列表。
- en: 'For example, to view statistics on http traffic, you can use the following
    command:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要查看http流量的统计信息，可以使用以下命令：
- en: '[PRE12]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '**IO**,**phs**: This displays the results in a `pcap` file protocols'
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IO**，**phs**：这会显示`pcap`文件协议的结果。'
- en: '**HTTP**,**tree**: This displays statistics from HTTP requests and responses'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**HTTP**，**tree**：这会显示HTTP请求和响应的统计信息。'
- en: '**SMB**,**srt**: This displays statistics relating to the SMB commands'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**SMB**，**srt**：这会显示与 SMB 命令相关的统计数据。'
- en: However, even so, despite the fact that in some cases command-line utilities
    are well suited for the analysis of packets at a fundamental level, it is better
    to use GUI tools such as WireShark for some tasks.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，即便如此，尽管在某些情况下命令行工具非常适合在基础层面分析数据包，但在某些任务中，最好使用如 WireShark 这样的 GUI 工具。
- en: Using WireShark
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 WireShark
- en: WireShark is used to address various issues that are related to the functioning
    of the network by network administrators, but it also plays an invaluable role
    in cases of network traffic analysis in investigations of incidents.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: WireShark 被网络管理员用来解决与网络运行相关的各种问题，但它在网络流量分析和事件调查中也发挥着不可替代的作用。
- en: The WireShark interface can be divided into three main parts.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: WireShark 界面可以分为三个主要部分。
- en: The upper part displays the list of packages. Each package information is available.
    By default, the packet number, timestamp, source, and destination address, protocol,
    packet length, and special protocols for different information.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 上部显示的是数据包列表。每个数据包的信息都可以查看。默认情况下，显示数据包号、时间戳、源地址、目标地址、协议、数据包长度以及不同信息的特定协议。
- en: The middle section displays detailed information about the package, which is
    selected in the upper part.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 中间部分显示所选数据包的详细信息，该数据包位于上部分。
- en: The bottom window displays the individual bytes package to hex and ASCII formats
    such as conclusions team tcpdump, `-X`.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 底部窗口以十六进制和 ASCII 格式显示单个数据包的字节，如 tcpdump 的 `-X` 选项。
- en: The data in all windows are connected to each other; thus, when we choose data
    in one window, associated data is highlighted in the other windows.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 所有窗口中的数据是相互关联的；因此，当我们在一个窗口中选择数据时，相关数据会在其他窗口中高亮显示。
- en: Wireshark has a lot of possibilities to analyze network packets. Therefore,
    to describe them in a single chapter is almost impossible. There are several good
    books that reveal these features in detail, namely *Practical Packet Analysis*
    and *Wireshark Network Analysis*.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: Wireshark 提供了大量分析网络数据包的功能。因此，要在一章中描述这些功能几乎是不可能的。有几本优秀的书籍详细阐述了这些功能，分别是 *实用数据包分析*
    和 *Wireshark 网络分析*。
- en: In some cases, the timestamps are the only binding element in the investigation.
    For example, sometimes the analyst knows only the approximate time of the incident
    and that they have to filter traffic for a certain period of time. The default
    WireShark displays the timestamps of packets in seconds from the start of the
    recording of traffic in the `pcap` file. Changing the display format of this can
    be done through the menu, as follows: **View** |**Time Display Format** |**Date
    and Time of Day**.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，时间戳是调查中唯一的关键元素。例如，有时分析员只知道事件的大致时间，并且他们必须在特定的时间段内筛选流量。默认情况下，WireShark
    会显示数据包的时间戳，该时间戳是从 `pcap` 文件记录流量开始的秒数。可以通过以下菜单更改显示格式：**查看** | **时间显示格式** | **日期和时间**。
- en: 'In order not have to perform this action every time, you can change these settings
    in Wireshark, as follows: **Edit** |**Preferences**'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免每次都执行此操作，你可以在 Wireshark 中更改这些设置，操作如下：**编辑** | **首选项**
- en: In some cases, it is important to get a general idea of the analyzed traffic.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，了解分析的流量的总体情况非常重要。
- en: You can use the **Statistics** menu item. This displays a wealth of information
    and statistics on the traffic collected.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 **统计** 菜单项。这将显示关于收集的流量的丰富信息和统计数据。
- en: For example, Protocol Hierarchy provides a list of all identified in the traffic
    reports and statistics on them. Very often, this helps identify anomalies in the
    traffic, for example, in the case of tunneling via DNS or ICMP.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，协议层级提供了流量报告中所有已识别的协议列表及其统计信息。通常，这有助于识别流量中的异常情况，例如通过 DNS 或 ICMP 隧道的情况。
- en: In addition to this, WireShark allows you to group the traffic on the traffic
    between the different hosts. Thus, it is possible to determine the amount of transferred
    data between different machines. Statistics on the machines can be viewed via
    **Statistic** | **Endpoints**, and various conversations can be viewed through **Statistics**
    | **Conversations**.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 除此之外，WireShark 允许你根据不同主机之间的流量进行分组。因此，可以确定不同机器之间传输的数据量。可以通过**统计** | **端点**查看机器的统计信息，并通过**统计**
    | **会话**查看各种会话。
- en: In some cases, there are situations when it is necessary to analyze the data
    exchanged between two specific hosts. You can use the `Following TCPStream` option.
    WireShark allows you to perform such actions for UDP, HTTP, and SSL.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，可能需要分析两个特定主机之间交换的数据。你可以使用 `Following TCPStream` 选项。WireShark 允许你对 UDP、HTTP
    和 SSL 执行此类操作。
- en: Another useful WireShark option that should be mentioned is the extraction of
    the responses from the network traffic. WireShark allows you to extract objects
    from the HTTP, SMB, and DICOM streams. To do this, use navigate to **File** |**Export**
    |**Objects** |**HTTP**.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有用的 WireShark 选项是从网络流量中提取响应。WireShark 允许你从 HTTP、SMB 和 DICOM 流中提取对象。为此，请导航至
    **文件** | **导出** | **对象** | **HTTP**。
- en: Then, select a file from the displayed list of files, and use the **Save As**
    to save the file. It should be noted that the need to extract the file, all packets
    of network traffic in the case of at least one `otsutviya` package relating to
    the transfer of the file to get it will not succeed.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，从显示的文件列表中选择一个文件，使用 **另存为** 保存文件。需要注意的是，在提取文件时，如果网络流量中的数据包中至少有一个 `otsutviya`
    包与传输文件有关，则提取文件将失败。
- en: Note that you can extract files from traffic using a number of other utilities,
    such as NetworkMiner or Bro. We discuss On Bro in more details later in this chapter.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，你可以使用其他一些工具（如 NetworkMiner 或 Bro）从流量中提取文件。我们将在本章后面详细讨论 Bro。
- en: 'The default setting displays a specific list of columns in WireShark with the
    data about the packets, as follows:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 默认设置会在 WireShark 中显示关于数据包的特定列列表，如下所示：
- en: The batch number
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 批号
- en: The timestamp
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 时间戳
- en: The source address
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 源地址
- en: The location receiver
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 接收方位置
- en: Protocol
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 协议
- en: The length of the packet
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据包的长度
- en: Fields with more information
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 带有更多信息的字段
- en: In some cases, this may require additional information, such as port numbers
    of the receiver and the source or method of the HTTP request.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，这可能需要额外的信息，例如接收方的端口号和源或 HTTP 请求的方法。
- en: 'Consider the following steps that must be completed in order to add a new column
    with the data on the method that is used by HTTP:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑以下步骤，这些步骤必须完成，以便添加一个新列，显示 HTTP 使用的方法数据：
- en: Start with the WireShark `pcap` traffic test.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 WireShark `pcap` 流量测试开始。
- en: Find the HTTP packet containing the HTTP request method, such as GET or POST.
    This can be done manually or by entering the `http.request` filter.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查找包含 HTTP 请求方法的 HTTP 数据包，例如 GET 或 POST。这可以手动完成，也可以通过输入`http.request`过滤器来完成。
- en: Select the HTTP packet in the window with packets, then expand the HTTP header,
    and find a site with the **Method Request** field.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在包含数据包的窗口中选择 HTTP 数据包，然后展开 HTTP 头部，找到包含 **Method Request** 字段的网站。
- en: Select the field, and right-click on it to select **Â«Apply as ColumnÂ»**.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择字段，然后右键单击它，选择 **“应用为列”**。
- en: After these actions a new column should appear. You can later change the name
    and other attributes of the column.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 执行这些操作后，应该会出现一个新列。之后，你可以更改该列的名称和其他属性。
- en: Often, WireShark plays an invaluable role in the analysis of network traffic
    that is required to handle large quantities of data and rich filtering. To filter
    data using Wireshark BPF filters. BPF filters are the most common method of filtering
    network utilities, including Wireshark, tcpdump, tshark, and so on.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，WireShark 在分析网络流量中发挥着无价的作用，尤其是在处理大量数据和丰富过滤需求时。要使用 Wireshark BPF 过滤器过滤数据。BPF
    过滤器是过滤网络工具（包括 Wireshark、tcpdump、tshark 等）最常见的方法。
- en: BPF filters can be used both during the traffic data collection and the analysis
    data. Consider the structure BPF filter, and a folder created by the BPF, which
    is called expression syntax. The expression includes one or more primitives that
    can be combined by operators. The primitives, in turn, are made up of qualifiers
    and the following values.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: BPF 过滤器可用于流量数据收集和分析数据时。考虑 BPF 过滤器的结构，以及由 BPF 创建的一个文件夹，这个文件夹被称为表达式语法。该表达式包括一个或多个原语，这些原语可以通过运算符组合。原语本身由限定符和以下值组成。
- en: 'There are three types of qualifier, as follows:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 有三种类型的限定符，如下所示：
- en: '**Type:**`host`, `net`, and `port`'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**类型：**`host`、`net` 和 `port`'
- en: '**Dir:**`src` and `dst`'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**方向：**`src` 和 `dst`'
- en: '**Proto:**`ether`, `fddi`, `ip`, `arp`, `rarp`, `decnet`, `lat`, `sca`, `moprc`,
    `mopdl`, `tcp`, and `udp`.'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议：**`ether`、`fddi`、`ip`、`arp`、`rarp`、`decnet`、`lat`、`sca`、`moprc`、`mopdl`、`tcp`
    和 `udp`。'
- en: 'Here is an example with several primitives:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个包含多个原语的示例：
- en: dst host host
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: dst host host
- en: src host host
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: src host host
- en: host host
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: host host
- en: ether src ehost
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ether src ehost
- en: gateway host
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: gateway host
- en: A full list of primitives can be found in the main pages for the `tcpdump` utility.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 所有原始命令的完整列表可以在 `tcpdump` 工具的主页中找到。
- en: 'Primitives are grouped and can be combined using the following operators:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 原始命令被分组，并可以使用以下运算符进行组合：
- en: Negation (`!` Or `not`)
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 否定（`!` 或 `not`）
- en: Concatenation (`&&` or `and`)
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拼接（`&&` 或 `and`）
- en: Alternation (`||` or `or`)
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 交替（`||` 或 `or`）
- en: More information about the BPF syntax can be found on the main page.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 有关 BPF 语法的更多信息，请参见主页。
- en: Knowing Bro
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解 Bro
- en: Another tool to analyze network traffic is Bro. Bro is a very powerful tool,
    which is often positioned as an IDS, but the possibilities are much wider with
    Bro. Discussing all of them in a single chapter is almost impossible, so we will
    consider only some of them. One of the many advantages of Bro is the ability to
    use ready-made parsers different protocols.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个用于分析网络流量的工具是 Bro。Bro 是一个非常强大的工具，通常被视为 IDS，但 Bro 的功能远不止于此。要在单一章节中讨论所有功能几乎是不可能的，因此我们将只讨论其中的一部分。Bro
    的众多优势之一是可以使用现成的协议解析器。
- en: 'For example, the following are some of them:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下是其中的一些：
- en: DHCP
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP
- en: DNS
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DNS
- en: FTP
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FTP
- en: HTTP
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: HTTP
- en: POP3
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: POP3
- en: SMTP
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SMTP
- en: SSH
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSH
- en: The list of these protocols is constantly expanding.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这些协议的列表在不断扩展。
- en: By default, Bro applies the protocol analyzers to traffic, and it records the
    results in the log files that correspond to different protocols.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Bro 会将协议分析器应用于流量，并将结果记录在对应不同协议的日志文件中。
- en: Bro also allows you to write your own handlers in a language called Bro. For
    each event that occurs during the processing of the event may be caused by its
    handler.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: Bro 还允许你使用一种名为 Bro 的语言编写自己的处理器。每个事件发生时，事件的处理器可能会导致该事件的发生。
- en: 'For example, consider the following simple event handler discovery file:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，考虑以下简单的事件处理器发现文件：
- en: '[PRE13]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Next, remove all files from the traffic to keep this code in a file, run the
    `getfiles.bro` command:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，移除所有流量中的文件，将此代码保存在文件中，并运行 `getfiles.bro` 命令：
- en: '[PRE14]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The following is the output of the preceding command:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前述命令的输出：
- en: '![Knowing Bro](img/image_12_001.jpg)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![了解 Bro](img/image_12_001.jpg)'
- en: 'After running this command, the catalog files are created, as follows:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此命令后，将创建目录文件，如下所示：
- en: '`conn.log`'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`conn.log`'
- en: '`files.log`'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`files.log`'
- en: '`http.log`'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`http.log`'
- en: '`ssl.log`'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ssl.log`'
- en: '`ftp.log`'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ftp.log`'
- en: '`dns.log`'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dns.log`'
- en: '`weird.log`'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`weird.log`'
- en: These files contain information about the network traffic for certain protocols.
    For example, `http.log` contains the following fields.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 这些文件包含关于特定协议的网络流量信息。例如，`http.log` 包含以下字段。
- en: In addition to the log files in the startup directory that is created by Bro,
    `extract_files` lists which files are extracted from the traffic. For each file
    in this directory, you can find the corresponding entry in the `files.log` file.
    This entry contains a number of attributes, which are useful.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 Bro 在启动目录中创建的日志文件外，`extract_files` 列出了从流量中提取的文件。对于该目录中的每个文件，你可以在 `files.log`
    文件中找到相应的条目。此条目包含一些有用的属性。
- en: To analyze the contents of these log files in the distribution utility has Bro
    `bro-cut`. The input to this utility is passed through the pipe contents of the
    log file, and it specifies the list of fields to be filtered.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 要分析这些日志文件的内容，可以使用分发工具 Bro 中的 `bro-cut`。该工具的输入通过管道传递日志文件的内容，并指定要过滤的字段列表。
- en: 'For example, to list the types of files extracted from the traffic, you can
    use the following command:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要列出从流量中提取的文件类型，可以使用以下命令：
- en: '[PRE15]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The following is the output of the preceding command:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前述命令的输出：
- en: '![Knowing Bro](img/image_12_002.jpg)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![了解 Bro](img/image_12_002.jpg)'
- en: 'Let''s assume that we are investigating an incident of a viral infection, in
    which case the most interesting types of files are as follows:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们正在调查一个病毒感染事件，那么最感兴趣的文件类型如下：
- en: '[PRE16]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: These are executable files on MS Windows files and the Java virtual machine.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是 MS Windows 文件和 Java 虚拟机上的可执行文件。
- en: 'Then, we learn more about the following files of interest:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们进一步了解以下感兴趣的文件：
- en: '[PRE17]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The following is the output of the preceding command:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前述命令的输出：
- en: '![Knowing Bro](img/image_12_003.jpg)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![了解 Bro](img/image_12_003.jpg)'
- en: These results allow the team to set time, download the resource files, and download
    the protocol by which to transfer these files. You can then find these files in
    the `extract_files` directory and analyze them.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 这些结果使团队能够设置时间，下载资源文件，并下载传输这些文件的协议。然后你可以在 `extract_files` 目录中找到这些文件并进行分析。
- en: For more information about the resource files, go to the IP address `85.17.137.151
    92,123,155,154`, and you can use the data from the `dns.log` file.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 有关资源文件的更多信息，请访问IP地址`85.17.137.151 92,123,155,154`，并可以使用来自`dns.log`文件的数据。
- en: 'The `dns.log` file is the result of Bro, and it describes the events, permits,
    and changes domain names into IP addresses and vice versa. The request to the
    DNS server is represented by a query attribute. The server''s response attribute
    is `answer`, and `ts` is the timestamp request:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '`dns.log`文件是Bro的结果，它描述了事件、许可，并将域名转换为IP地址，反之亦然。请求DNS服务器由查询属性表示。服务器的响应属性是`answer`，`ts`是时间戳请求：'
- en: '[PRE18]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The following is the output of the preceding command:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前述命令的输出：
- en: '![Knowing Bro](img/image_12_004.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![认识 Bro](img/image_12_004.jpg)'
- en: The result is that the IP address `85.17.137.151` resolves to domains `finansial.gov`
    and `w282d1wb.athleticsdrycleaner.pw`.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是，IP地址`85.17.137.151`解析为域名`finansial.gov`和`w282d1wb.athleticsdrycleaner.pw`。
- en: The IP address `92.123.155.154` belongs to `microsoft.com`, which greatly reduces
    the likelihood that the downloaded file is malicious.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: IP地址`92.123.155.154`属于`microsoft.com`，这大大减少了下载文件是恶意的可能性。
- en: 'On the basis of the allocated domain names of the `http.log` file can obtain
    the following information:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 根据`http.log`文件中分配的域名，可以获得以下信息：
- en: '[PRE19]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The following is the output of the preceding command:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前述命令的输出：
- en: '![Knowing Bro](img/image_12_005.jpg)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![认识 Bro](img/image_12_005.jpg)'
- en: 'This suggests that the user downloaded a file from the resource `finansial.gov
    utisl.jar` protocol HTTP (the previously mentioned `FUJlhk2BEJTsb8tozk.jar.jar`
    file). Then, from the same resource, the `''2'' (Fy9phB2NNXKNHKuyHb.exe)` file
    was downloaded:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 这表明用户从资源`finansial.gov utisl.jar`下载了一个HTTP协议的文件（之前提到的`FUJlhk2BEJTsb8tozk.jar.jar`文件）。然后，从同一资源中，下载了`'2'
    (Fy9phB2NNXKNHKuyHb.exe)`文件：
- en: '![Knowing Bro](img/image_12_006.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![认识 Bro](img/image_12_006.jpg)'
- en: Additionally, you must pay attention to suspicious HTTP-POST `gate.php` requests.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您必须关注可疑的HTTP-POST `gate.php`请求。
- en: 'The `resp_fuids` attribute identifies a response from the Web server, and this
    indicates any appropriate entry in the `files.log` file. Thus, the `FI ... Ug`
    identifier can get the `finansial.gov` server''s response in the GET request:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '`resp_fuids`属性标识Web服务器的响应，并指示`files.log`文件中的相关条目。因此，`FI ... Ug`标识符可以获取`finansial.gov`服务器在GET请求中的响应：'
- en: '![Knowing Bro](img/image_12_007.jpg)'
  id: totrans-204
  prefs: []
  type: TYPE_IMG
  zh: '![认识 Bro](img/image_12_007.jpg)'
- en: From the replies provided, it is clear that `utisl.jar` is a java-applet. The
    client opens a page in a frame of the legal site, `www.efinancialnews.com`.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 从回复中可以清楚地看出，`utisl.jar`是一个Java applet。客户端在合法网站`www.efinancialnews.com`的框架中打开了一个页面。
- en: This small example is a clear demonstration of how it is possible to investigate
    with only file traffic using Bro.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 这个小示例清晰地展示了如何仅通过文件流量使用Bro进行调查。
- en: However, the example shows only a small part of all possibilities of Bro. To
    learn about Bro's other capabilities, you can visit [https://www.bro.org/](https://www.bro.org/),
    where you can find a lot of additional material.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，示例仅展示了Bro所有可能功能的一小部分。要了解Bro的其他功能，您可以访问[https://www.bro.org/](https://www.bro.org/)，在那里您可以找到许多额外的资料。
- en: Summary
  id: totrans-208
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we discussed some topics on network forensics. We learned what
    kind of data we could collect from a network and how to analyze logs from a proxy
    server. Also from this chapter, we learned how to collect `pcap` files and how
    to analyze them with WireShark and Bro.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了一些关于网络取证的话题。我们了解了可以从网络中收集哪些数据，以及如何分析代理服务器的日志。此外，我们还学习了如何收集`pcap`文件，并如何使用WireShark和Bro进行分析。
- en: In the following chapter, you will learn how to build a forensic environment.
    We will describe two approaches; one of them is virtualization, and another one
    uses distributed systems. We will describe GRR as an example of a distributed
    system.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，您将学习如何构建取证环境。我们将描述两种方法；其中一种是虚拟化，另一种则使用分布式系统。我们将以GRR作为分布式系统的示例进行说明。
