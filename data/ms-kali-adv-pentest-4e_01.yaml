- en: '1'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '1'
- en: Goal-Based Penetration Testing
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 基于目标的渗透测试
- en: The COVID-19 pandemic has changed the way the world operates. Organizations
    of all sizes have transformed themselves from having none or partial remote working
    to all of their employees adopting this style. With the *new normal*, accessible
    and remote technology has become very important for work and in peoples’ personal
    lives. We can certainly call this a *virtual world*, where confidential activities
    that used to happen in closed rooms now happen over the internet. This has significantly
    increased the number of cyber threats at least five-fold. Threat actors utilize
    this digital transformation to exploit the mistakes made by users and companies
    as their entry point for financial gain, generating reputational damage, or whatever
    else their goal may be. This occurs in the form of ransomware, phishing, and data
    breaches.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 新冠疫情改变了世界的运作方式。各类组织纷纷将工作方式从没有或部分远程工作转变为全员采用这种工作方式。在这种*新常态*下，远程技术对工作和个人生活变得至关重要。我们可以毫不犹豫地称之为*虚拟世界*，过去在封闭空间中进行的机密活动，现在都转移到了互联网中。这显著增加了至少五倍的网络威胁数量。威胁行为者利用这种数字化转型，利用用户和公司犯下的错误作为其进入点，进行财务收益、声誉损害或其他任何目的。此类活动表现为勒索软件、网络钓鱼和数据泄露。
- en: 'To understand the current and future ways of working, let us start by exploring
    the different objectives or goals of threat actors. In this chapter, we will discuss
    the different types of threat actors and the importance of goal-based penetration
    testing with a set of objectives; we investigate misconceptions and how a typical
    vulnerability scan, penetration testing, and red team exercise can fail without
    the importance of a goal. This chapter also provides an overview of security testing
    and setting up a verification lab, focusing on the customization of Kali to support
    some advanced aspects of penetration testing. By the end of this chapter, you
    will have covered the following:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 为了理解当前和未来的工作方式，让我们从探讨威胁行为者的不同目标开始。本章将讨论不同类型的威胁行为者及其基于目标的渗透测试的重要性；我们还会探讨误解以及没有目标的漏洞扫描、渗透测试和红队演练如何失败。本章还提供了安全测试概述，并设置了验证实验室，重点介绍定制
    Kali 以支持渗透测试中的一些高级方面。通过本章学习，你将覆盖以下内容：
- en: The different types of threat actors
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不同类型的威胁行为者
- en: An overview of security testing
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全测试概述
- en: Misconceptions of vulnerability scanning, penetration testing, and red team
    exercises
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞扫描、渗透测试和红队演练的误解
- en: The history and purpose of Kali Linux
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali Linux 的历史与目的
- en: Updating and organizing Kali
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新和组织 Kali
- en: Installing Kali on various services (Amazon Web Services/Google Cloud Platform/Android)
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在各种服务上安装 Kali（亚马逊 Web 服务/谷歌云平台/安卓）
- en: Setting up defined targets
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置明确的目标
- en: Building a verification lab
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建验证实验室
- en: Let us begin with the types of threat actors that exploit technological infrastructure.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从那些利用技术基础设施的威胁行为者类型开始。
- en: Different types of threat actors
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 不同类型的威胁行为者
- en: A threat actor is nothing but an entity or individual who is responsible for
    an event or incident that impacts another entity. It is important that we understand
    the different types of threat actors and their common motivations, which will
    help us throughout this book to understand different perspectives. *Table 1.1*
    provides the common threat actors, their motives, and typical goals.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 威胁行为者指的是对影响另一个实体的事件或事故负责的个体或实体。了解不同类型的威胁行为者及其常见动机非常重要，这将帮助我们在本书中理解不同的视角。*表 1.1*
    提供了常见的威胁行为者、他们的动机和典型目标。
- en: '| **Threat Actor** | **Common Motivation** | **Goal(s)** |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| **威胁行为者** | **常见动机** | **目标** |'
- en: '| State- or government-sponsored actors | Military, political, and technological
    agendas | Cyber espionage, data theft, or any other activity that interests a
    nation for its economic benefits |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| 国家或政府资助的行为者 | 军事、政治和技术议程 | 网络间谍活动、数据盗窃或任何其他国家为其经济利益而感兴趣的活动 |'
- en: '| Organized crime or cybercriminals | Financial gain and profit | Money and
    valuable data |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| 有组织犯罪或网络犯罪分子 | 财务收益和利润 | 资金和有价值的数据 |'
- en: '| Hacktivists/cyber extremists | Motivational overlaps | Focus on exposing
    secrets and disrupting services/organizations that they think are not good for
    society (hacktivists); focus on causing harm and destruction to further their
    cause (extremists) |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| 黑客活动分子/网络极端分子 | 动机重叠 | 关注曝光秘密和破坏他们认为对社会不利的服务/组织（黑客活动分子）；关注造成伤害和破坏，以推动他们的事业（极端分子）
    |'
- en: '| Insiders | Revenge | Money or data ransom or creating revenue loss |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| 内部人员 | 报复 | 金钱或数据勒索或造成收入损失 |'
- en: 'Table 1.1: Various threat actors and their motivations'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 表 1.1：各种威胁行为者及其动机
- en: We have now summarized the four major threat actors and their motivations that
    we can use during goal-based penetration testing and red team exercises to simulate
    real threat scenarios.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经总结了四种主要的威胁行为者及其动机，可以在基于目标的渗透测试和红队演习中使用它们，以模拟真实的威胁场景。
- en: Conceptual overview of security testing
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安全测试的概念概览
- en: Now that we understand the different threat actors; let’s go ahead and understand
    *what the organizations are trying to protect and from whom?* If you asked 100
    security consultants the question, *what is security testing?*, it is very likely
    that you would receive 100 different responses.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了不同的威胁行为者；接下来，让我们理解一下*组织究竟在保护什么，且是为了防范谁？* 如果你问100位安全顾问*什么是安全测试？*，很可能你会收到100个不同的回答。
- en: In its simplest form, security testing is a process to determine that any information
    asset or system is protected and its functionality is maintained as intended.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 安全测试最简单的形式是一个过程，用来确认任何信息资产或系统是受到保护的，并且其功能按预期保持不变。
- en: Common pitfalls of vulnerability assessments, penetration testing, and red team
    exercises
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 漏洞评估、渗透测试和红队演习的常见陷阱
- en: 'In this section, we will discuss some misconceptions and limitations regarding
    traditional/classical vulnerability scanning, penetration testing, and red team
    exercises. Let us now understand the actual meaning of these three topics in simple
    terms and their limitations:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，我们将讨论一些关于传统/经典漏洞扫描、渗透测试和红队演习的误解和局限性。接下来，让我们用简单的术语来理解这三者的实际含义及其局限性：
- en: '**Vulnerability Assessment** **(VA)**: The process of identifying vulnerabilities
    or security loopholes in a system or network through a vulnerability scanner.
    One of the misconceptions about VA is that it will let you find all of the known
    vulnerabilities; well, that’s not true. Limitations with VA include that only
    potential vulnerabilities are found, and it depends purely on the type of scanner
    that you utilize. It might also include a number of false positives and, to the
    business owner, there is no clear indication as to which ones do not pose a relevant
    risk and which one will be initially utilized by the attackers to gain access.
    The biggest pitfall of VA is false negatives, meaning the scanner did not find
    an issue that the system or application has.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**漏洞评估** **(VA)**：通过漏洞扫描仪识别系统或网络中的漏洞或安全漏洞的过程。关于VA的一个误解是，它能够帮助你找到所有已知的漏洞；但这并不正确。VA的局限性在于，它只能找到潜在的漏洞，并且完全取决于你使用的扫描器类型。它也可能包含许多误报，而且对于企业所有者来说，无法明确指出哪些漏洞不构成实际风险，哪些漏洞会被攻击者用来获取访问权限。VA的最大陷阱是漏报，也就是扫描器没有发现系统或应用程序存在的问题。'
- en: '**Penetration testing** **(pentesting)**: The process of safely simulating
    the hacking scenarios by exploiting vulnerabilities without much impact on the
    existing network or business. There is also a lower number of false positives
    since testers will try to validate the vulnerabilities and also attempt to exploit
    them. A limitation with pentesting is that it uses only currently known, publicly
    available exploits; mostly, these are a focus for project testing. We often hear
    from pentesters during an assessment, *Yay! Got Root—*but we never hear the question,
    *what can you do with it?* This could be due to various reasons such as project
    limitations, including the reporting of high-risk issues immediately to the client,
    or the client only being interested in one segment of the network and only wanting
    that part tested.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**渗透测试** **(pentesting)**：通过利用漏洞安全地模拟黑客场景的过程，对现有网络或业务的影响较小。由于测试人员会验证漏洞并尝试利用它们，因此假阳性较少。渗透测试的一个局限性是它仅使用当前已知的、公开的漏洞；这些漏洞大多专注于项目测试。我们经常在评估过程中听到渗透测试人员说，*太棒了！获得
    Root 权限了*——但我们从不听到这样的问题，*你能用它做什么？* 这可能是由于各种原因，如项目限制，包括将高风险问题立即报告给客户，或者客户只对网络的某一部分感兴趣，并且只希望测试该部分。'
- en: One of the misconceptions about the pentest is that it provides the attacker
    with a full view of the network, and you are safe once penetration testing has
    been performed. This is not the case when attackers have found a vulnerability
    in the business process of your secure application.
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 关于渗透测试的一个误解是，它为攻击者提供了网络的完整视图，并且一旦渗透测试完成，你就可以放心了。但当攻击者发现你的安全应用程序中的业务流程漏洞时，情况并非如此。
- en: '**Red Team Exercise** **(RTE)**: A focused process of evaluating the effectiveness
    of an organization to defend against cyber threats and improve its security by
    any possible means; during an RTE, we can discover multiple ways of achieving
    project objectives/scenarios and goals, such as complete coverage of activities
    with the defined project goal, including phishing (enticing a victim to enter
    sensitive information or download malicious content through emails), vishing (enticing
    a victim to provide or do some actions with malicious intent through phone calls),
    “WhatsApping” (engaging a victim through WhatsApp messenger with malicious intent),
    wireless, disk drops (USB and SSD), and physical penetration testing. The limitations
    with RTEs are time-bound, pre-defined scenarios and an assumed rather than real
    environment. Often, the RTE is run with a fully monitored mode for every technique,
    and tactics are executed according to the procedure, but this isn’t the case when
    a real attacker wants to achieve an objective.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**红队演习** **(RTE)**：一种集中评估组织防御网络威胁和通过任何可能手段提高安全性的有效性过程；在 RTE 期间，我们可以发现多种实现项目目标/场景和目标的方法，如通过定义的项目目标对活动的全面覆盖，包括网络钓鱼（诱使受害者通过电子邮件输入敏感信息或下载恶意内容）、语音钓鱼（通过电话诱使受害者提供或做出某些有恶意意图的行为）、“WhatsApp钓鱼”（通过
    WhatsApp 信息与受害者进行恶意互动）、无线、磁盘投放（USB 和 SSD）和物理渗透测试。RTE 的限制是受时间限制、预定义场景和假设环境的约束。通常，RTE
    会在每种技术的全程监控模式下运行，战术按程序执行，但当真正的攻击者想要实现目标时，情况并非如此。'
- en: '*Figure 1.1* showcases the difference between all three activities in terms
    of the length and breadth of their focus:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 1.1* 展示了三种活动在关注的广度和深度上的差异：'
- en: '![](../Images/B17765_01_01.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_01.png)'
- en: 'Figure 1.1: The three methods of assessing the vulnerability of systems and
    the breadth and depth to which they are successful'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.1：三种评估系统脆弱性的方法及其成功的广度和深度
- en: 'Often, all three different testing methodologies refer to the term *hack* or
    *compromise*. We will hack your network and show you where your weaknesses are;
    but wait, does the client or business owner understand the difference between
    these terms? How do we measure it? What are the criteria? And when do we know
    that the hack or compromise is complete? All the questions point to only one thing:
    what the purpose of the testing is, and what the primary goal in mind is.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，三种不同的测试方法都涉及到 *黑客* 或 *破坏* 这个术语。我们将黑进你的网络，告诉你哪里存在弱点；但是等一下，客户或业务负责人能理解这些术语之间的区别吗？我们如何衡量它？标准是什么？我们什么时候知道黑客攻击或破坏已经完成？所有这些问题都指向一个问题：测试的目的是什么，主要目标是什么。
- en: Objective-based penetration testing
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 目标导向渗透测试
- en: The primary goal of a pentest/RTE is to determine the real risk, differentiating
    the risk rating from the scanner and giving a business a risk value for each asset,
    along with the risk to the brand image of the organization. It’s not about how
    much risk they have; rather, how much they are exposed and how easy it is to exploit
    this exposure.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试/红队评估（RTE）的主要目标是确定实际风险，将扫描器的风险评级与实际风险区分开，并为每个资产提供一个风险值，同时评估组织品牌形象的风险。这不仅仅是关于他们有多少风险，而是他们暴露在多少风险中以及这些暴露有多容易被利用。
- en: A threat that has been found does not really constitute a risk and need not
    be demonstrated; for example, **Cross-Site Scripting** (**XSS**) is a script injection
    vulnerability that can steal users’ credentials. If a client running a trading
    company had a brochure website that provides static content to their customers
    was vulnerable to XSS, it may not have a significant impact on the business. In
    this case, a client might accept the risk and put in a mitigation plan using a
    **Web Application Firewall** **(WAF)** to prevent the XSS attacks. If the same
    vulnerability was identified on their main trading website, however, then it would
    be a significant issue in need of rectification as soon as possible since the
    company will be at risk of losing the trust of customers through attackers stealing
    their credentials.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 已经发现的威胁不一定构成风险，也无需进行演示；例如，**跨站脚本攻击**（**XSS**）是一种脚本注入漏洞，能够窃取用户的凭据。如果一个经营交易公司的客户有一个提供静态内容的宣传网站，且该网站存在XSS漏洞，这可能对业务的影响不大。在这种情况下，客户可能会接受风险，并通过使用**Web应用防火墙**（**WAF**）来防止XSS攻击。然而，如果同样的漏洞出现在他们的主要交易网站上，那么这将是一个需要尽快修复的重大问题，因为公司面临着由于攻击者窃取用户凭据而失去客户信任的风险。
- en: 'Objective-based penetration testing is time-based, depending on the specific
    problem that an organization faces. An example of an objective is: *We are most
    worried about our data being stolen and the regulatory fines incurred as a consequence
    of these breaches*. So, the objective now is to compromise the data either by
    exploiting a system flaw or by manipulating the employees through phishing; sometimes
    it will be a surprise to see some of their data is already available on the dark
    web. Every objective comes with its own **Tactics, Techniques, and Procedures**
    (**TTP**) that will support the primary goal of the penetration test activity.
    We will be exploring all of these different methodologies throughout this book
    using Kali Linux 2021.4.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 基于目标的渗透测试是时间驱动的，取决于组织所面临的具体问题。一个目标的例子是：*我们最担心的是我们的数据被盗，以及因此产生的监管罚款*。因此，目标现在是通过利用系统漏洞或通过钓鱼攻击操纵员工来获取数据；有时，当看到一些他们的数据已经出现在暗网上时，可能会感到惊讶。每个目标都有自己的**战术、技术和程序**（**TTP**），这些将支持渗透测试活动的主要目标。在本书中，我们将使用Kali
    Linux 2021.4探索所有这些不同的方法论。
- en: The testing methodology
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试方法论
- en: Methodologies rarely consider why a penetration test is being undertaken or
    which data is critical to the business and needs to be protected. In the absence
    of this vital first step, penetration tests lose their focus.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 方法论很少考虑渗透测试的原因，或者哪些数据对于业务至关重要，必须加以保护。如果没有这个关键的第一步，渗透测试将失去焦点。
- en: Many penetration testers are reluctant to follow a defined methodology, fearing
    that it will hinder their creativity in exploiting a security weakness on the
    network or application. Penetration testing fails to reflect the actual activities
    of a malicious attacker. Frequently, the client wants to see whether you can gain
    administrative access to a particular system (that is, *Can you root the box?*).
    However, the attacker may be focused on copying critical data in a manner that
    does not require root access or cause a denial of service.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 许多渗透测试员不愿意遵循定义好的方法论，担心这会妨碍他们在网络或应用程序中利用安全漏洞时的创造性。渗透测试无法真实反映恶意攻击者的实际活动。客户经常希望看到你是否能够获得某一系统的管理员访问权限（也就是说，*你能获得系统的根权限吗？*）。然而，攻击者可能专注于以不需要根权限或不会造成服务拒绝的方式复制关键信息。
- en: To address the limitations inherent in formal testing methodologies, they must
    be integrated in a framework that views the network from the perspective of an
    attacker, known as the **cyber** **kill chain**.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 为了应对正式测试方法论固有的局限性，必须将其整合到一个框架中，从攻击者的视角来看待网络，这被称为**网络** **杀链**。
- en: In 2009, Mike Cloppert of Lockheed Martin CERT introduced the concept that is
    now known as the cyber kill chain. This includes the steps taken by an adversary
    when they are attacking a network. It does not always proceed in a linear flow,
    as some steps may occur in parallel. Multiple attacks may be launched over time
    at the same target, and overlapping stages may occur.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 2009 年，洛克希德·马丁公司的 Mike Cloppert 提出了如今被称为网络攻击链的概念。它包括对手在攻击网络时采取的步骤。它并不总是按线性流程进行，因为一些步骤可能是并行发生的。针对同一目标可能会在不同时间发起多个攻击，并且可能会出现重叠阶段。
- en: 'In this book, we have modified Cloppert’s cyber kill chain to more accurately
    reflect how attackers apply these steps when exploiting networks, applications,
    and data services. *Figure 1.2* shows a typical cyber kill chain of an attacker:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们修改了 Cloppert 的网络攻击链，以更准确地反映攻击者在利用网络、应用程序和数据服务时如何应用这些步骤。*图 1.2* 显示了攻击者的典型网络攻击链：
- en: '![](../Images/B17765_01_02.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_02.png)'
- en: 'Figure 1.2: The typical cyber kill chain an attacker may follow'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.2：攻击者可能遵循的典型网络攻击链
- en: 'A typical cyber kill chain of an attacker can be described as follows:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者的典型网络攻击链可以描述如下：
- en: '**Explore or reconnaissance phase**: The adage, *reconnaissance time is never
    wasted time*, adopted by most military organizations, acknowledges that it is
    better to learn as much as possible about an enemy before engaging them. For the
    same reason, attackers will conduct extensive reconnaissance of a target before
    attacking. In fact, it is estimated that at least 70 percent of the effort of
    a penetration test or an attack is spent conducting reconnaissance! Generally,
    they will employ two types of reconnaissance:'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**探索或侦察阶段**：大多数军事组织采用的格言是，*侦察时间从不浪费*，这表明在与敌人交战之前，尽可能多地了解敌人是更好的。出于同样的原因，攻击者会在攻击之前对目标进行广泛的侦察。事实上，据估计，渗透测试或攻击的至少
    70% 努力都用于侦察！通常，他们会采用两种类型的侦察：'
- en: '**Passive**: There is no direct interaction with the target in a hostile manner.
    For example, the attacker will review publicly available website(s), assess online
    media (especially social media sites), and attempt to determine the **attack surface**
    of the target. One particular task will be to generate a list of past and current
    employee names, or even an investigation into the breached databases that are
    publicly available.'
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**被动**：没有与目标进行直接的敌对互动。例如，攻击者会审查公开可用的网站，评估在线媒体（尤其是社交媒体网站），并尝试确定目标的**攻击面**。其中一个具体任务是生成过去和当前员工的名单，甚至对公开可用的被攻破数据库进行调查。'
- en: These names will form the basis of attempts to use brute force in guessing passwords.
    They will also be used in social engineering attacks. This type of reconnaissance
    is difficult, if not impossible, to distinguish from the behavior of regular users.
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这些名字将成为使用暴力破解密码的尝试基础。它们还会在社交工程攻击中被使用。这种类型的侦察很难，甚至几乎不可能，与普通用户的行为区分开来。
- en: '**Active**: This can be detected by the target, but it can be difficult to
    distinguish it from the rest of the activity that most online organizations encounter
    from regular traffic. Activities occurring during active reconnaissance include
    physical visits to target premises, port scanning, and remote vulnerability scanning.'
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**主动**：目标可以检测到这一行为，但很难将其与大多数在线组织从常规流量中遇到的其他活动区分开来。在主动侦察阶段发生的活动包括对目标场所的实地访问、端口扫描和远程漏洞扫描。'
- en: '**Delivery phase**: Delivery is the selection and development of the weapon
    that will be used to complete the exploit during the attack. The exact weapon
    chosen will depend on the attacker’s intent as well as the route of delivery (for
    example, across the network, via a wireless connection, or through a web-based
    service). The impact of the delivery phase will be examined in detail in the second
    half of this book.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**交付阶段**：交付是选择和开发在攻击过程中用于完成漏洞利用的武器。所选择的具体武器将取决于攻击者的意图以及交付路线（例如，通过网络、无线连接或基于
    Web 的服务）。交付阶段的影响将在本书的后半部分详细讨论。'
- en: '**Exploit or compromise phase**: This is the point when a particular exploit
    is successfully applied, allowing attackers to gain a foothold in the objective
    system. The compromise may have occurred in a single phase (for example, a known
    operating system vulnerability was exploited using a buffer overflow), or it may
    have been a multiphase compromise (for example, if an attacker could search and
    download the data from the internet from sources such as [https://haveibeenpwned.com](https://haveibeenpwned.com)
    or similar; these sites typically include breached data, including usernames,
    passwords, phone numbers, and email addresses, that will allow them to easily
    create a dictionary of passwords to attempt to access the **Software as a Service**
    **(SaaS)** applications, such as Microsoft Office 365 or Outlook Web, attempt
    to log in to a corporate VPN directly, or use email addresses to perform targeted
    email phishing techniques. The attacker could even send an SMS with malicious
    links to deliver a payload). Multiphase attacks are the norm when a malicious
    attacker targets a specific enterprise.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**利用或破坏阶段**：这是一个特定的漏洞被成功利用的阶段，允许攻击者在目标系统中站稳脚跟。破坏可能发生在单一阶段（例如，通过缓冲区溢出漏洞利用已知操作系统漏洞），也可能是多阶段的破坏（例如，攻击者可能会从
    [https://haveibeenpwned.com](https://haveibeenpwned.com) 或类似网站下载互联网上的数据；这些网站通常包含泄露的数据，包括用户名、密码、电话号码和电子邮件地址，攻击者可以利用这些数据轻松创建密码字典，尝试访问
    **软件即服务** **(SaaS)** 应用程序，如 Microsoft Office 365 或 Outlook Web，尝试直接登录企业 VPN，或使用电子邮件地址进行定向钓鱼攻击。攻击者甚至可能通过短信发送带有恶意链接的内容，进而传送恶意载荷）。多阶段攻击是恶意攻击者针对特定企业时的常见手段。'
- en: '**Achieve phase – Action on the Objective**: This is frequently, and incorrectly,
    referred to as the exfiltration phase because there is a focus on perceiving attacks
    solely as a route to steal sensitive data (such as login information, personal
    information, and financial information). It is in fact common for an attacker
    to have a different objective; for example, an attacker may wish to drop a ransomware
    package on their competitors to drive customers to their own business. Therefore,
    this phase must focus on the many possible actions of an attacker. One of the
    most common exploitation activities occurs when the attackers attempt to improve
    their access privileges to the highest possible level (vertical escalation) and
    to compromise as many accounts as possible (horizontal escalation).'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**达成阶段 – 执行目标**：这一阶段经常被错误地称为数据外泄阶段，因为人们倾向于把攻击视为单纯为了窃取敏感数据（如登录信息、个人信息和财务信息）。实际上，攻击者可能有不同的目标；例如，攻击者可能希望在竞争对手的系统中投放勒索软件包，以迫使客户转向他们自己的业务。因此，这一阶段必须关注攻击者可能采取的多种行动。最常见的攻击行为之一是攻击者试图提升其访问权限至最高级别（纵向升级），并尽可能多地攻破账户（横向升级）。'
- en: '**Achieve phase – Persistence**: If there is value in compromising a network
    or system, then that value can likely be increased if there is persistent access.
    This allows attackers to maintain communications with a compromised system. From
    a defender’s point of view, this is the part of the cyber kill chain that is usually
    the easiest to detect.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**达成阶段 – 持续性**：如果攻击网络或系统具有价值，那么如果能够保持持续访问，这个价值很可能会增加。这允许攻击者与被攻破的系统保持通信。从防御者的角度来看，这是网络杀伤链中通常最容易被检测到的部分。'
- en: Cyber kill chains are merely metamodels of an attacker’s behavior when they
    attempt to compromise a network or a particular data system. As a metamodel, it
    can incorporate any proprietary or commercial penetration testing methodology.
    Unlike the methodologies, however, it ensures a strategic-level focus on how an
    attacker approaches the network. This focus on the attacker’s activities will
    guide the layout and content of this book.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 网络杀伤链仅仅是攻击者在试图破坏网络或特定数据系统时的行为元模型。作为元模型，它可以结合任何专有的或商业的渗透测试方法。然而，与这些方法不同的是，网络杀伤链确保战略层面的重点，聚焦于攻击者如何接近网络。这一对攻击者活动的关注将指导本书的布局和内容。
- en: Introduction to Kali Linux features
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Kali Linux 功能介绍
- en: '**Kali Linux** (**Kali**) is the successor to the BackTrack penetration testing
    platform that is generally regarded as the de facto standard package of tools
    used to facilitate penetration testing to secure data and voice networks. It was
    developed by Mati Aharoni and Devon Kearns of Offensive Security. This distribution
    is mainly meant for penetration testing and digital forensics.'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**Kali Linux**（**Kali**）是 BackTrack 渗透测试平台的继任者，通常被视为用于保护数据和语音网络的渗透测试工具的事实标准包。它由
    Offensive Security 的 Mati Aharoni 和 Devon Kearns 开发。该发行版主要用于渗透测试和数字取证。'
- en: In **2021,** Kali had four updates. The latest rolling version was released
    on December 9, 2021 with kernel 5.14.0 and the Xfce 4.16.3 desktop environment.
    Additionally, there was a minor update on December 23, 2021 with version Kali
    2021.4a.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **2021年**，Kali 发布了四次更新。最新的滚动版本于2021年12月9日发布，内核为 5.14.0，桌面环境为 Xfce 4.16.3。此外，2021年12月23日还发布了一个小版本更新，版本为
    Kali 2021.4a。
- en: 'Some features of this latest version of Kali include the following:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 该版本 Kali 的一些功能包括以下内容：
- en: 'Over 500 advanced penetration testing, data forensics, and defensive tools.
    The majority of the older pre-installed tools are eliminated and replaced by similar
    tools. They provide extensive wireless support with multiple hardware and kernel
    patches to permit the packet injection required by some wireless attacks. *Table
    1.2* provides a breakdown of the tools with respect to their specific task as
    of December 2021:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有超过 500 个先进的渗透测试、数据取证和防御工具。大多数旧的预安装工具已被删除，并由类似工具取代。它们提供广泛的无线支持，包含多个硬件和内核补丁，以支持一些无线攻击所需的包注入。*表
    1.2* 提供了截至2021年12月工具按具体任务的详细分类：
- en: '| **Tool Sections** | **No. of Tools** |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| **工具类别** | **工具数量** |'
- en: '| Information Gathering | 67 |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| 信息收集 | 67 |'
- en: '| Vulnerability Analysis | 27 |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| 漏洞分析 | 27 |'
- en: '| Wireless Attacks | 54 |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| 无线攻击 | 54 |'
- en: '| Web Applications | 43 |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| 网络应用 | 43 |'
- en: '| Exploitation Tools | 21 |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| 利用工具 | 21 |'
- en: '| Forensics Tools | 23 |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| 取证工具 | 23 |'
- en: '| Sniffing & Spoofing | 33 |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| 嗅探与欺骗 | 33 |'
- en: '| Password Attacks | 39 |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| 密码攻击 | 39 |'
- en: '| Maintaining Access | 17 |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| 维持访问 | 17 |'
- en: '| Reverse Engineering | 11 |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| 逆向工程 | 11 |'
- en: '| Hardware Hacking | 6 |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| 硬件黑客 | 6 |'
- en: '| Reporting Tools | 10 |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
  zh: '| 报告工具 | 10 |'
- en: 'Table 1.2: The number of tools available, listed with respect to the specific
    tasks for which they are used'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 表 1.2：可用工具的数量，按其使用的具体任务进行列出
- en: 'Some of the key features of Kali Linux 2021.4 include:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux 2021.4 的一些主要特点包括：
- en: Support for multiple desktop environments such as KDE, GNOME3, Xfce, MATE, e17,
    lxde, and i3wm.021.
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持多种桌面环境，如 KDE、GNOME3、Xfce、MATE、e17、lxde 和 i3wm.021。
- en: By default, Kali Linux has Debian-compliant tools that are synchronized with
    the Debian repositories at least four times daily, making it easier to update
    packages and apply security fixes.
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认情况下，Kali Linux 拥有符合 Debian 标准的工具，并与 Debian 仓库同步，至少每日四次，使得更新包和应用安全修复更加简便。
- en: There are secure development environments and GPG-signed packages and repositories.
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供安全的开发环境和 GPG 签名的包及仓库。
- en: There is support for ISO customization, allowing users to build their own versions
    of customized Kali with a limited set of tools to make it lightweight. The bootstrap
    function also performs enterprise-wide network installs that can be automated
    using pre-seed files.
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持 ISO 定制，允许用户构建自己版本的定制 Kali，并仅包含有限的工具集，从而使其更加轻量。引导功能还执行全企业范围的网络安装，可以使用预种子文件自动化。
- en: Since ARM-based systems have become more prevalent and less expensive, support
    for **ARMEL** and **ARMHF** in Kali Linux can be installed on devices such as
    rk3306 mk/ss808, Raspberry Pi, ODROID U2/X2, Samsung Chromebook, EfikaMX, Beaglebone
    Black, CuBox, and Galaxy Note 10.1.
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于基于 ARM 的系统变得更加普及且价格更低，Kali Linux 支持 **ARMEL** 和 **ARMHF**，可以安装在如 rk3306 mk/ss808、Raspberry
    Pi、ODROID U2/X2、Samsung Chromebook、EfikaMX、Beaglebone Black、CuBox 和 Galaxy Note
    10.1 等设备上。
- en: Kali remains a free open-source project. Most importantly, it is well supported
    by an active online community.
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kali 仍然是一个免费的开源项目。最重要的是，它得到了活跃的在线社区的强力支持。
- en: The role of Kali in red team tactics
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Kali 在红队战术中的作用
- en: 'While pentesters might prefer any type of operating system to perform their
    desired activity, usage of Kali Linux saves significant time and prevents the
    need to search for packages that aren’t typically available in other operating
    systems. Some of the advantages that are not noticed with Kali Linux during a
    red team exercise include the following:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然渗透测试人员可能更喜欢任何类型的操作系统来执行他们想要的操作，但使用 Kali Linux 可以节省大量时间，并避免需要寻找在其他操作系统中通常不可用的软件包。一些在红队演练中不容易注意到的
    Kali Linux 优势包括：
- en: One single source to attack various platforms.
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个单一的来源，可以攻击多种平台。
- en: It’s quick to add sources and install packages and supporting libraries (especially
    those that are not available for Windows).
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加源和安装软件包及支持库非常快速（特别是那些在 Windows 上不可用的）。
- en: It’s even possible to install RPM packages with the usage of alien.
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 alien 工具，甚至可以安装 RPM 包。
- en: The purpose of Kali Linux is to secure network, cloud, and application infrastructure
    and bundle all of the tools to provide a single platform for penetration testers
    and forensic analysts.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: Kali Linux 的目的是确保网络、云和应用程序基础设施的安全，并将所有工具捆绑在一个平台上，为渗透测试人员和取证分析师提供服务。
- en: Installing and updating Kali Linux
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装和更新 Kali Linux
- en: In the previous editions of this book, we focused on the installation of Kali
    Linux to VMware Player, VirtualBox, AWS, and the Raspberry Pi using the Docker
    appliance. In this section, we will touch base on installing Kali Linux on these
    same platforms, along with Google Cloud Platform, and a non-rooted Android phone.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的前几版中，我们重点讲解了如何将 Kali Linux 安装到 VMware Player、VirtualBox、AWS 和使用 Docker 应用程序的
    Raspberry Pi 上。在本节中，我们将介绍如何在这些相同平台上安装 Kali Linux，同时还包括 Google Cloud Platform 和非根安卓手机。
- en: Using as a portable device
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 作为便携设备使用
- en: 'It is fairly simple to install Kali Linux onto a portable device. In some situations,
    clients do not permit the use of an external laptop inside a secure facility.
    In those cases, typically, a testing laptop is provided by the client to the pentesters
    to perform the scan. Running Kali Linux from a portable device has more advantages
    during a pentest or RTE:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 将 Kali Linux 安装到便携设备上相当简单。在某些情况下，客户不允许在安全设施内使用外部笔记本电脑。在这些情况下，通常会由客户提供一台测试笔记本电脑给渗透测试人员进行扫描。通过便携设备运行
    Kali Linux 在渗透测试或红队演练中具有更多优势：
- en: It can fit inside a pocket, in the case of a USB drive or mobile device.
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以放入口袋中（如果是 USB 驱动器或移动设备的话）。
- en: It can be run live without making any changes to the host operating system.
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以在不对主机操作系统进行任何更改的情况下运行。
- en: You can customize the build of Kali Linux and even make the storage persistent.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 你可以自定义 Kali Linux 的构建，甚至使存储具备持久性。
- en: 'There are three simple steps to make a USB drive into a portable form of Kali
    from a Windows PC:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 将 USB 驱动器转化为便携版 Kali Linux 有三个简单步骤：
- en: Download the official Kali Linux image from:[http://docs.kali.org/introduction/download-official-kali-linux-images](http://docs.kali.org/introduction/download-official-kali-linux-images)
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从以下链接下载官方 Kali Linux 镜像：[http://docs.kali.org/introduction/download-official-kali-linux-images](http://docs.kali.org/introduction/download-official-kali-linux-images)
- en: We will be using the Rufus open-source utility to create a bootable disk. Rufus
    helps to create and format bootable drives. Download the latest Rufus from [https://github.com/pbatard/rufus/releases/](https://github.com/pbatard/rufus/releases/)
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用开源工具 Rufus 来创建可启动磁盘。Rufus 有助于创建和格式化可启动驱动器。下载最新版本的 Rufus：[https://github.com/pbatard/rufus/releases/](https://github.com/pbatard/rufus/releases/)
- en: Open the Rufus executable as an administrator. Plug the USB drive into an available
    USB port. Browse to the location where you have downloaded your image. You should
    see what is shown in *Figure 1.3*. Select the right drive name and then click
    **Start**:![](../Images/B17765_01_03.png)
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以管理员身份打开 Rufus 可执行文件。将 USB 驱动器插入可用的 USB 端口。浏览到你下载映像的所在位置。你应该能看到 *图 1.3* 所显示的内容。选择正确的驱动器名称，然后点击
    **开始**：![](../Images/B17765_01_03.png)
- en: 'Figure 1.3: Running Rufus to write Kali Linux to an external disk'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.3：运行 Rufus 将 Kali Linux 写入外部磁盘
- en: 'Once complete, close the Rufus application and safely remove the USB drive.
    Kali Linux is now ready as a portable device to be plugged into any laptop and
    be booted up. If you plan to store information while booted on a live disk, ensure
    you select **Persistence partition size** to have a minimum of 4 GB; then select
    **Live USB persistence** while booting Kali Linux on the portable device. If your
    host operating system is Linux, this can be achieved by two standard commands:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，关闭 Rufus 应用程序并安全地移除 USB 驱动器。Kali Linux 现在已准备好作为一个便携设备，可以插入任何笔记本电脑并启动。如果您计划在启动的实时磁盘上存储信息，请确保选择**持久化分区大小**，至少设置为
    4 GB；然后在启动 Kali Linux 时选择**实时 USB 持久化**。如果您的主操作系统是 Linux，可以通过两个标准命令来实现：
- en: '[PRE0]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This will display all of the disks mounted on the drive. The `dd` command-line
    utility does the convert and copy:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 这将显示驱动器上所有已挂载的磁盘。`dd` 命令行工具执行转换和复制：
- en: '[PRE1]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '`if` is used for the input file, `of` is for the output file, and `bs` is for
    the block size.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '`if` 用于输入文件，`of` 用于输出文件，`bs` 用于块大小。'
- en: Installing Kali on a Raspberry Pi 4
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 Raspberry Pi 4 上安装 Kali
- en: A Raspberry Pi is a single-board device that is compact in nature and can run
    just like a fully loaded computer with minimal functionalities. These devices
    are extremely useful during RTE and penetration testing activities while on site.
    The base of the operating system is loaded from an SD card, just like a hard drive
    for normal computers.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: Raspberry Pi 是一种单板设备，结构紧凑，能够像功能齐全的计算机一样运行，且功能简约。这些设备在现场的 RTE 和渗透测试活动中非常有用。操作系统的基础从
    SD 卡加载，就像普通计算机的硬盘一样。
- en: 'You can perform the same steps as those outlined in the previous section on
    a high-speed SD card that can be plugged into a Raspberry Pi. We are then ready
    to use the system without any issues. If the installation is successful, the following
    screen must be present when Kali Linux is booted from a Raspberry Pi. A Raspberry
    Pi 4 has been used in this demonstration and accessed the Pi’s operating system
    using a monitor:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在一张高速 SD 卡上执行与上一节中概述的相同步骤，然后将其插入 Raspberry Pi。这样我们就可以无障碍地使用系统。如果安装成功，当从 Raspberry
    Pi 启动 Kali Linux 时，应该会出现以下屏幕。此次演示中使用的是 Raspberry Pi 4，并通过显示器访问 Pi 的操作系统：
- en: '![A picture containing text, monitor, electronics, display  Description automatically
    generated](../Images/B17765_01_04.png)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![一张包含文字、显示器、电子设备和屏幕的图片 自动生成的描述](../Images/B17765_01_04.png)'
- en: 'Figure 1.4: Successful installation of Kali Linux on a Raspberry Pi 4'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.4：成功在 Raspberry Pi 4 上安装 Kali Linux
- en: Installing Kali on a VM
  id: totrans-111
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在虚拟机上安装 Kali
- en: In the previous editions, we discussed how to install Kali to different hypervisors.
    We will do the same here, and take a very quick detour on how to install Kali
    on such devices.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 在之前的版本中，我们讨论了如何将 Kali 安装到不同的虚拟化软件中。在这里，我们将做同样的事情，并简要介绍如何在这些设备上安装 Kali。
- en: VMware Workstation Player
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: VMware Workstation Player
- en: VMware Workstation Player, formerly known as VMware Player, is free for personal
    use and is also a commercial product for business use from VMware as a desktop
    application that allows a VM to be run inside your host operating system. This
    application can be downloaded from [https://www.vmware.com/uk/products/workstation-player/workstation-player-evaluation.html](https://www.vmware.com/uk/products/workstation-player/workstation-player-evaluation.html)
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: VMware Workstation Player，前身为 VMware Player，个人使用免费，并且作为 VMware 的商业产品提供给企业使用，作为一种桌面应用程序，允许虚拟机在主操作系统内运行。该应用程序可以从[https://www.vmware.com/uk/products/workstation-player/workstation-player-evaluation.html](https://www.vmware.com/uk/products/workstation-player/workstation-player-evaluation.html)下载。
- en: 'We will be using version 16.1\. Once the installer is downloaded, go ahead
    and install the VMware Player accordingly, based on your host operating system.
    If the installation is complete, you should see a screen similar to that displayed
    in *Figure 1.5*:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用版本 16.1。下载完安装程序后，根据您的主操作系统安装 VMware Player。如果安装完成，您应该看到类似于*图 1.5*中显示的屏幕：
- en: '![Graphical user interface, application, Word  Description automatically generated](../Images/B17765_01_05.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![图形用户界面，应用程序，Word 自动生成的描述](../Images/B17765_01_05.png)'
- en: 'Figure 1.5: Successful installation of VMware Workstation Player'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.5：成功安装 VMware Workstation Player
- en: The next step in order to install Kali Linux on VMware is to click on **Create
    a New Virtual Machine** and select **Installer disc image file (iso)**. Browse
    to your ISO file that was downloaded and then click **Next**. You can now enter
    a name of your choice (for example, `HackBox`) and select the **Custom Location**
    where you would like to store your VMware image. Click **Next** and specify the
    disk capacity. It is recommended that a minimum of 2 GB RAM is used, and 15 GB
    of disk space is needed to run Kali. Click **Next** until you finish.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在 VMware 上安装 Kali Linux 的下一步是点击**创建新的虚拟机**并选择**安装程序磁盘映像文件（iso）**。浏览到您已下载的 ISO
    文件，然后点击**下一步**。现在，您可以输入自己喜欢的名称（例如，`HackBox`）并选择**自定义位置**，指定您想存储 VMware 映像的地方。点击**下一步**并指定磁盘容量。建议使用至少
    2 GB 的 RAM，并且需要 15 GB 的磁盘空间来运行 Kali。点击**下一步**直到完成。
- en: 'Another method is to directly download the VMware image:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种方法是直接下载 VMware 映像：
- en: '[https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/](https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/)'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/](https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/)'
- en: 'Open the `.vmx` file and select **I copied it**. That should boot up the fully
    loaded Kali Linux in VMware. You can either choose to install Kali Linux as the
    host operating system or run it as a live image. Once all of the installation
    steps are complete, you are ready to launch Kali Linux from VMware without any
    problems. *Figure 1.6* shows the screen that should be seen:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 打开 `.vmx` 文件并选择**我已复制它**。这应该会启动完全加载的 Kali Linux 在 VMware 中。您可以选择将 Kali Linux
    安装为主机操作系统，或者作为实时映像运行。一旦所有安装步骤完成，您就可以毫无问题地从 VMware 启动 Kali Linux。*图 1.6* 显示的是应看到的界面：
- en: '![A computer screen capture  Description automatically generated with low confidence](../Images/B17765_01_06.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![计算机屏幕截图  自动生成的描述，信心较低](../Images/B17765_01_06.png)'
- en: 'Figure 1.6: Once Kali Linux has been successfully installed on VMware, this
    display is shown'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.6：Kali Linux 成功安装在 VMware 上后的显示界面
- en: VirtualBox
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: VirtualBox
- en: Similar to VMware workstation player, VirtualBox is a hypervisor that is completely
    open-source and a free desktop application from which you can run any VM from
    the host operating system. This application can be downloaded from [https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 与 VMware 工作站播放器类似，VirtualBox 是一个完全开源的虚拟机管理程序，它是一个免费的桌面应用程序，可以从主机操作系统运行任何虚拟机。此应用程序可以从[https://www.virtualbox.org/wiki/Downloads](https://www.virtualbox.org/wiki/Downloads)下载。
- en: 'We will now go ahead and install Kali on VirtualBox. Similar to VMware, we
    will just execute the downloaded executable until we have a successful installation
    of Oracle VirtualBox, as shown in *Figure 1.7*:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将在 VirtualBox 上安装 Kali。与 VMware 类似，我们只需执行已下载的可执行文件，直到成功安装 Oracle VirtualBox，如*图
    1.7*所示：
- en: '![Graphical user interface, text, application, email  Description automatically
    generated](../Images/B17765_01_07.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图形用户界面，文本，应用程序，电子邮件  自动生成的描述](../Images/B17765_01_07.png)'
- en: 'Figure 1.7: Screen displayed upon the successful installation of VM VirtualBox'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.7：成功安装 VM VirtualBox 后显示的界面
- en: 'During installation, it is recommended that you set the RAM to at least 1 or
    2 GB, and that you create the virtual hard drive with a minimum of 15 GB so that
    no performance issues are encountered. After the final step, you should be able
    to load Kali Linux in VirtualBox, as shown in *Figure 1.8*:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，建议将 RAM 设置为至少 1 或 2 GB，并且创建虚拟硬盘时，最低应为 15 GB，以避免出现性能问题。完成最后一步后，您应该能够在
    VirtualBox 中加载 Kali Linux，如*图 1.8*所示：
- en: '![](../Images/B17765_01_08.png)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_08.png)'
- en: 'Figure 1.8: Kali Linux, as it displays in VM VirtualBox'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.8：Kali Linux 在 VM VirtualBox 中的显示
- en: After this has been completed, we are now ready to use Kali Linux through VirtualBox.
    However, we will be exploring the different network options in a further section,
    *LAB network*.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此步骤后，我们现在可以通过 VirtualBox 使用 Kali Linux。然而，我们将在后面的章节中探讨不同的网络选项，*实验室网络*。
- en: Installing to a Docker appliance
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装到 Docker 设备
- en: Docker is an open-source project that is designed to automate the deployment
    of software containers and applications instantly. Docker also provides the additional
    abstraction and automation layer of operating system-level virtualization on Linux
    or Windows.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: Docker 是一个开源项目，旨在自动化软件容器和应用程序的部署。Docker 还提供了在 Linux 或 Windows 上的操作系统级虚拟化的额外抽象和自动化层。
- en: Docker is available for Windows, Mac, Linux, and AWS. For Windows, Docker can
    be downloaded from [https://www.docker.com/get-started](https://www.docker.com/get-started).
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: Docker适用于Windows、Mac、Linux和AWS。对于Windows，可以从[https://www.docker.com/get-started](https://www.docker.com/get-started)下载Docker。
- en: 'After the Docker installation, it should be fairly simple to run Kali Linux
    using the following commands:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: Docker安装后，使用以下命令运行Kali Linux应该是相当简单的：
- en: '[PRE2]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: These can be executed in the Command Prompt (Windows) or Terminal (Linux or
    Mac) to confirm that the installation has been successful.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这些命令可以在命令提示符（Windows）或终端（Linux或Mac）中执行，以确认安装是否成功。
- en: 'We should be able to run Kali Linux directly from Docker, as shown in *Figure
    1.9*. Also note that Docker utilizes container-based technology, which runs its
    own processes that are isolated from the rest of the operating system, and it
    shares the host OS kernel. While the VirtualBox environment is not container-based
    technology, it virtualizes the hardware and shares the hardware resource from
    the physical host:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该能够直接从Docker运行Kali Linux，如*图1.9*所示。还要注意，Docker使用基于容器的技术，它运行的是与操作系统其余部分隔离的进程，并且共享主机操作系统的内核。虽然VirtualBox环境并非基于容器的技术，但它虚拟化硬件并共享物理主机的硬件资源：
- en: '![Graphical user interface  Description automatically generated with medium
    confidence](../Images/B17765_01_09.png)Figure 1.9: Successful installation of
    Kali Linux using Docker'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '![图形用户界面 描述自动生成，具有中等置信度](../Images/B17765_01_09.png)图1.9：使用Docker成功安装Kali Linux'
- en: 'Once the Kali Linux Docker image download is complete, you can run the Docker
    image by running `docker run --tty --interactive kalilinux/kali-rolling /bin/bash`
    in Command Prompt or Terminal. You should be able to see the same as what is shown
    in *Figure 1.10*:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦Kali Linux Docker镜像下载完成，你可以通过在命令提示符或终端中运行`docker run --tty --interactive kalilinux/kali-rolling
    /bin/bash`来运行Docker镜像。你应该能看到与*图1.10*所示相同的界面：
- en: '![A screenshot of a computer  Description automatically generated with medium
    confidence](../Images/B17765_01_10.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![计算机屏幕截图 描述自动生成，具有中等置信度](../Images/B17765_01_10.png)'
- en: 'Figure 1.10: Successful running of Kali Linux from Docker'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.10：成功运行Kali Linux来自Docker
- en: 'If Windows 10 is your base operating system, ensure that VT-X is enabled on
    your system BIOS, along with **Hyper-V**. Note that enabling **Hyper-V** will
    disable VirtualBox, as shown in *Figure 1.11*:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的基础操作系统是Windows 10，请确保在系统BIOS中启用VT-X以及**Hyper-V**。请注意，启用**Hyper-V**会禁用VirtualBox，如*图1.11*所示：
- en: '![](../Images/B17765_01_11.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_11.png)'
- en: 'Figure 1.11: An alert that will be shown when installing Docker'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.11：安装Docker时显示的警告
- en: Readers should be aware that the following sections involve the usage of commercial
    services, such as AWS and Google Cloud Platform, that might incur charges while
    utilizing the services. It is always recommended that readers completely delete
    or terminate the instances having finished their testing.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 读者应当注意，接下来的部分涉及使用商业服务，如AWS和Google Cloud Platform，这可能会在使用过程中产生费用。建议读者在测试完成后，完全删除或终止实例。
- en: Kali on AWS Cloud
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在AWS云上的Kali
- en: '**Amazon Web Services** **(AWS)** provides Kali Linux as part of **Amazon Machine
    Interface** (**AMI**) and **SaaS.** Nowadays, the majority of the security testing
    companies utilize AWS to conduct penetration testing and more efficient phishing
    attacks. In this section, we will go through the steps to bring up Kali Linux
    on AWS.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '**亚马逊网络服务**(**AWS**)将Kali Linux作为**亚马逊机器接口**(**AMI**)和**SaaS**的一部分提供。如今，大多数安全测试公司利用AWS进行渗透测试和更高效的钓鱼攻击。本节将介绍在AWS上启动Kali
    Linux的步骤。'
- en: 'First, you will need to have a valid AWS account. You can sign up by visiting
    the following URL: [https://console.aws.amazon.com/console/home](https://console.aws.amazon.com/console/home
    )'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你需要拥有一个有效的AWS账户。你可以通过访问以下网址进行注册：[https://console.aws.amazon.com/console/home](https://console.aws.amazon.com/console/home)
- en: When logging in to the AWS account, we should be able to see all of the AWS
    services. Search for Kali Linux, and the following should be displayed, as shown
    in *Figure 1.12*.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到AWS账户时，我们应该能够看到所有的AWS服务。搜索Kali Linux，接着应该会显示以下内容，如*图1.12*所示。
- en: 'The page can also be accessed using the following link: [https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to](https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to):'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '此页面也可以通过以下链接访问：[https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to](https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to):'
- en: '![Graphical user interface, text, website  Description automatically generated](../Images/B17765_01_12.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![图形用户界面，文本，网站 描述自动生成](../Images/B17765_01_12.png)'
- en: 'Figure 1.12: Pre-configured Kali Linux in the AWS Marketplace'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.12：AWS Marketplace 中预配置的 Kali Linux
- en: 'The open-source community has made it very simple to directly launch a pre-configured
    Kali Linux 2021.4 instance from the AWS Marketplace. The following will take us
    to a direct launch of Kali Linux within a few minutes: [https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to](https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to).'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 开源社区已将直接从 AWS Marketplace 启动预配置的 Kali Linux 2021.4 实例变得非常简单。接下来，我们将直接启动 Kali
    Linux，仅需几分钟：[https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to](https://aws.amazon.com/marketplace/pp/prodview-fznsw3f7mq7to)。
- en: 'Follow the instructions; you should then be able to launch the Kali instance
    by selecting **Continue to Subscribe**. This should take you to the login page
    of AWS if not logged in. Click on **Continue to Configuration**, continue to click
    on **Continue to Launch**, and you should arrive at the screen shown in *Figure
    1.13*. From **Choose Action**, select the option **Launch through EC2**, also
    shown in *Figure 1.13*; finally, click **Launch**:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 按照说明操作；然后你应该能够通过选择**继续订阅**来启动 Kali 实例。如果尚未登录，这将带你到 AWS 的登录页面。点击**继续配置**，继续点击**继续启动**，你应该会到达*图
    1.13*所示的页面。从**选择操作**中，选择**通过 EC2 启动**选项，同样在*图 1.13*中显示；最后，点击**启动**：
- en: '![](../Images/B17765_01_13.png)'
  id: totrans-157
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_13.png)'
- en: 'Figure 1.13: Selecting a method to launch Kali Linux through EC2'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.13：选择通过 EC2 启动 Kali Linux 的方法
- en: 'The next screen will allow you to choose the **Instance type**; select **t2.micro
    (Free tier eligible)** and click on **Review and Launch** . Finally, you should
    arrive at **Review Instance Launch**; click on **Launch**. This should take us
    to a screen where a new key pair can be created, as shown in *Figure 1.14*:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个屏幕将允许你选择**实例类型**；选择**t2.micro（符合免费套餐资格）**并点击**审查并启动**。最后，你应该会到达**审查实例启动**页面；点击**启动**。这将带你到一个可以创建新密钥对的页面，如*图
    1.14*所示：
- en: '![](../Images/B17765_01_14.png)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_14.png)'
- en: 'Figure 1.14: Creating a new key pair to connect to AWS instances'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.14：创建新的密钥对以连接到 AWS 实例
- en: 'As usual, to use any AWS VM, you must create your own key pair in order to
    ensure the security of the environment. You should then be able to log in by entering
    the following command from your command shell. In order to use the private key
    to log in without the password, Amazon enforces the file permission to be tunneled.
    We will use the following commands to connect to the Kali Linux instance from
    Terminal:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 如常，为了使用任何 AWS 虚拟机，必须创建自己的密钥对，以确保环境的安全。然后，你应该能够通过在命令行中输入以下命令登录。为了使用私钥免密登录，Amazon
    强制要求文件权限进行隧道传输。我们将使用以下命令从终端连接到 Kali Linux 实例：
- en: '[PRE3]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'All Windows users can utilize Windows PowerShell to connect to the instance
    by running:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 所有 Windows 用户可以通过运行以下命令，利用 Windows PowerShell 连接到实例：
- en: '[PRE4]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '*Figure 1.15* depicts the successful usage of Kali on AWS:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 1.15* 展示了在 AWS 上成功使用 Kali：'
- en: '![](../Images/B17765_01_15.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_15.png)'
- en: 'Figure 1.15: Successful connection to a Kali Linux instance in AWS'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.15：成功连接到 AWS 中的 Kali Linux 实例
- en: All of the terms and conditions must be met in order to utilize AWS to perform
    penetration testing. Legal terms and conditions must be met before launching any
    attacks from the cloud host.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 必须满足所有条款和条件才能利用 AWS 进行渗透测试。在从云主机发起任何攻击之前，必须满足法律条款和条件。
- en: Kali on Google Cloud Platform (GCP)
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 Google Cloud Platform (GCP) 上的 Kali
- en: 'There is no version of Kali Linux already available within the Google Cloud
    Marketplace, unlike AWS. Hence, we will take a different approach to launching
    Kali Linux on the GCP. Following the same instructions that we used to install
    Kali in VirtualBox, also use in this instance 12 GB of hard disk space along with
    2 GB of RAM. We will utilize our local image to upload to a Google bucket and
    Compute Engine to run this instance. Before that, we must ensure that once our
    installation is complete and we log into Kali Linux and start the SSH service
    to make it persistent, the following commands are run in the Kali Linux VM terminal:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 与 AWS 不同，Google Cloud Marketplace 中没有现成的 Kali Linux 版本。因此，我们将采用不同的方法来启动 GCP
    上的 Kali Linux。按照我们安装 Kali 在 VirtualBox 上的相同步骤，这次同样使用 12 GB 的硬盘空间和 2 GB 的内存。我们将利用本地镜像上传到
    Google 存储桶，并通过计算引擎运行此实例。在此之前，我们必须确保在安装完成并登录 Kali Linux 后，启动 SSH 服务以使其保持持久，以下命令将在
    Kali Linux 虚拟机的终端中运行：
- en: '[PRE5]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'For some reason, GCP does not deploy VirtualBox images with the floppy disk
    enabled, hence we are going to remove the floppy disk by selecting Kali and navigating
    to **Settings**, then **System**,and unselecting **Floppy** from **Boot Order**,
    as shown in *Figure 1.16*:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 由于某些原因，GCP 不会部署启用了软盘的 VirtualBox 镜像，因此我们将通过选择 Kali，进入**设置**，然后选择**系统**，并取消选中**启动顺序**中的**软盘**来移除软盘，如*图
    1.16*所示：
- en: '![](../Images/B17765_01_16.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_16.png)'
- en: 'Figure 1.16: With the floppy disk enabled under the Boot Order option, GCP
    does not deploy VirtualBox images'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.16：启用软盘后，在启动顺序选项下，GCP 无法部署 VirtualBox 镜像
- en: 'The next important step involves ensuring that our image is picking up GCP’s
    network in gathering the DHCP, and getting a public IP address; it is important
    that we change the network settings by selecting Kali and navigating to **Settings**,
    then **Network**, and clicking on **Advanced** to change the **Adapter Type**
    to **Paravirtualized Network**, as shown in *Figure 1.17*:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个重要步骤是确保我们的镜像能够连接到 GCP 的网络，获取 DHCP，并获得公共 IP 地址；因此，必须通过选择 Kali，进入**设置**，然后选择**网络**，点击**高级**并将**适配器类型**更改为**虚拟化网络**，如*图
    1.17*所示：
- en: '![](../Images/B17765_01_17.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_17.png)'
- en: 'Figure 1.17: Selecting the Paravirtualized Network in VirtualBox'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.17：在 VirtualBox 中选择虚拟化网络
- en: 'It is also recommended to remove the audio feature to avoid any compatibility
    issues; select Kali and navigate to **Settings**, **Audio**, and uncheck **Enable
    Audio**, as shown in *Figure 1.18*:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 还建议移除音频功能，以避免兼容性问题；选择 Kali，进入**设置**，**音频**，然后取消选中**启用音频**，如*图 1.18*所示：
- en: '![](../Images/B17765_01_18.png)'
  id: totrans-180
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_18.png)'
- en: 'Figure 1.18: With the Enable Audio option selected under the Audio section,
    GCP may not work properly'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.18：在音频部分选择“启用音频”选项时，GCP 可能无法正常工作
- en: Now we must convert the **Virtual Disk Image** (**VDI**) into RAW format and
    apply the naming convention of `disk.raw` that can then be utilized by Google’s
    imaging automation software.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们必须将**虚拟磁盘镜像**（**VDI**）转换为 RAW 格式，并应用命名约定 `disk.raw`，以便 Google 的镜像自动化软件可以使用。
- en: 'We will utilize the generic and open-source machine emulator and virtualizer
    (QEMU) as the tool to convert either VDI or VMDK files to RAW. In the following
    steps, we covert the VDI format (similar steps apply for VMDK files):'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将利用通用的开源机器模拟器和虚拟化工具（QEMU）来转换 VDI 或 VMDK 文件为 RAW 格式。在接下来的步骤中，我们将转换 VDI 格式（类似的步骤也适用于
    VMDK 文件）：
- en: Navigate to the VirtualBox location where you have saved the disk images.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到你保存磁盘镜像的 VirtualBox 位置。
- en: 'Ensure qemu-img is installed on the native system:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保在本地系统中安装了 qemu-img：
- en: This can be installed in Windows by downloading the application from [https://www.qemu.org/download/#windows](https://www.qemu.org/download/#windows)
  id: totrans-186
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以通过从[https://www.qemu.org/download/#windows](https://www.qemu.org/download/#windows)下载应用程序，在
    Windows 中安装此工具
- en: This can be installed in Linux or macOS systems by running the commands `sudo
    apt install qemu-img` or `brew install qemu-img`
  id: totrans-187
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以通过运行命令`sudo apt install qemu-img`或`brew install qemu-img`在 Linux 或 macOS 系统中安装此工具
- en: 'To convert the image, the following command can be run from the respective
    Terminal or Command Prompt:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要转换镜像，可以在相应的终端或命令提示符中运行以下命令：
- en: '[PRE6]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Once the `disk.raw` file is created, to reduce the upload size, we will compress
    the raw disk into the `tar.gz` format. However, it is better to use `gtar` since
    Google relies heavily on this utility. For Windows users, these are not natively
    installed, but the utility can be directly downloaded from [http://gnuwin32.sourceforge.net/packages/gtar.htm](http://gnuwin32.sourceforge.net/packages/gtar.htm).
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦创建了 `disk.raw` 文件，为了减少上传大小，我们将把原始磁盘压缩成 `tar.gz` 格式。然而，最好使用 `gtar`，因为 Google
    强烈依赖此工具。对于 Windows 用户，这些工具并未预安装，但可以从[http://gnuwin32.sourceforge.net/packages/gtar.htm](http://gnuwin32.sourceforge.net/packages/gtar.htm)直接下载该工具。
- en: You can create the final GCP-compliant image by running the command `gtar –cSzf
    kali.tar.gz disk.raw` on Linux and macOS systems or `tar –zcvf kali.tar.gz disk.raw`
    on Windows.
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以通过在 Linux 和 macOS 系统上运行命令`gtar –cSzf kali.tar.gz disk.raw`或在 Windows 上运行`tar
    –zcvf kali.tar.gz disk.raw`来创建最终的 GCP 兼容镜像。
- en: 'We now have our own image ready to be uploaded to GCP. Create a GCP account
    or use an existing one to log in to the service. Similar to Microsoft, GCP also
    provides a free credit option for the user to experience their cloud computing
    services. The following steps are involved in launching Kali Linux on GCP:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好将自己的镜像上传到 GCP。创建一个 GCP 账户或使用现有账户登录该服务。与 Microsoft 类似，GCP 也为用户提供了免费信用额度选项，供用户体验其云计算服务。启动
    Kali Linux 在 GCP 上的步骤如下：
- en: Log in to [https://console.cloud.google.com/](https://console.cloud.google.com/).
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到 [https://console.cloud.google.com/](https://console.cloud.google.com/)。
- en: Navigate to **Cloud Storage** and select **Brower**, and click **Create a Bucket**.
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到 **Cloud Storage** 并选择 **Browser**，然后点击 **Create a Bucket**。
- en: Choose a name for the bucket in compliance with GCP’s policy (no capital letters
    allowed); in our case, we created the bucket name `mastering-kali-linux-edition4`.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据 GCP 的政策选择一个符合规范的桶名称（不允许大写字母）；在我们的例子中，我们创建了桶名称 `mastering-kali-linux-edition4`。
- en: Click on **Upload Files** and select our compressed `kali.tar.gz` image that
    we just created. Once the upload is complete, you should be able to see the same
    screen displayed in *Figure 1.19*:![](../Images/B17765_01_19.png)
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **Upload Files**，选择我们刚刚创建的压缩 `kali.tar.gz` 镜像。上传完成后，您应该能够看到与*图 1.19*中显示相同的屏幕：![](../Images/B17765_01_19.png)
- en: 'Figure 1.19: After uploading the compressed image to GCP, this screen will
    be displayed'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.19：将压缩镜像上传到 GCP 后，将显示此屏幕
- en: Go back to the **Home** page and select **Compute Engine**; select **Images**
    under the storageand then click on **Create Image** and enter a name for the image,
    in this case, we entered `gcp-kali`.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到 **Home** 页面，选择 **Compute Engine**；在存储下选择 **Images**，然后点击 **Create Image**，并为镜像输入名称，在此情况下，我们输入了
    `gcp-kali`。
- en: Once the name has been entered, for the source, select **cloud storage file**,
    click on **Bucket**, and then select our compressed gz image (`kali.tar.gz`).
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入名称后，选择源为 **cloud storage file**，点击 **Bucket**，然后选择我们的压缩 gz 镜像（`kali.tar.gz`）。
- en: You can select any region that you want to run in; we selected the default for
    demonstration purposes. Click **Create**, which should bring you to the screen
    displayed in *Figure 1.20*; if you do not see this, then click on **REFRESH**
    on the same screen:![](../Images/B17765_01_20.png)
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以选择任何您想运行的区域；我们选择了默认区域以供演示。点击 **Create**，这将带您到显示在*图 1.20*中的屏幕；如果没有看到该屏幕，请点击该屏幕上的
    **REFRESH**：![](../Images/B17765_01_20.png)
- en: 'Figure 1.20: The newly created gcp-kali image displaying in the GCP images'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.20：新创建的 gcp-kali 镜像在 GCP 镜像中显示
- en: Once the image is created, click on **Actions** and **Create instance**, as
    shown in *Figure 1.21*:![](../Images/B17765_01_21.png)
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 镜像创建完成后，点击 **Actions** 和 **Create instance**，如*图 1.21*所示：![](../Images/B17765_01_21.png)
- en: 'Figure 1.21: Successful creation of our gcp-kali image that is ready to run
    as an instance'
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.21：成功创建我们的 gcp-kali 镜像，准备作为实例运行
- en: This should take us to the VM instance screen to feed the Kali Linux instance
    information, as shown in *Figure 1.22*:![](../Images/B17765_01_22.png)
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将带我们进入虚拟机实例屏幕，以输入 Kali Linux 实例信息，如*图 1.22*所示：![](../Images/B17765_01_22.png)
- en: 'Figure 1.22: Entering our gcp-kali instance details and selecting the required
    resources to run it'
  id: totrans-205
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.22：输入我们的 gcp-kali 实例详细信息并选择运行所需的资源
- en: We can now select the CPU (Core Processing Unit) platform and GPU (Graphics
    Processing Unit); we will select `E2 medium`, which will provide two virtual cores
    of vCPU and 4 GB RAM. Our image includes the storage that we selected during the
    VM creation (12 GB).
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以选择 CPU（中央处理单元）平台和 GPU（图形处理单元）；我们将选择 `E2 medium`，它提供两个虚拟核心的 vCPU 和 4 GB
    内存。我们的镜像包括我们在创建虚拟机时选择的存储（12 GB）。
- en: Finally, ensure that the boot disk remains as it is—no changes are required—and
    finally click **Create**. This should bring us to the final screen with both the
    internal and public IP addresses, as shown in *Figure 1.23*:![](../Images/B17765_01_23.png)
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，确保启动磁盘保持不变—无需更改—然后点击 **Create**。这将带我们到最后一个屏幕，其中显示了内部和公共 IP 地址，如*图 1.23*所示：![](../Images/B17765_01_23.png)
- en: 'Figure 1.23: Successful installation of Kali Linux as an instance in GCP, with
    an internal and external IP'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.23：成功安装 Kali Linux 作为 GCP 中的实例，具有内部和外部 IP
- en: We now have successfully created and run an instance of Kali Linux on the GCP,
    and we can now log in to the public IP with the username and password that we
    created during the initial creation, as shown in *Figure 1.24*:![](../Images/B17765_01_24.png)
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在已经成功地在 GCP 上创建并运行了 Kali Linux 实例，现在可以使用在最初创建过程中设置的用户名和密码登录到公共 IP，如 *图 1.24*
    所示：![](../Images/B17765_01_24.png)
- en: 'Figure 1.24: Successfully connecting to the Kali Linux instance in GCP externally'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.24：成功外部连接到 GCP 上的 Kali Linux 实例
- en: Kali on Android (non-rooted phones)
  id: totrans-211
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 Android 上运行 Kali（非 Root 手机）
- en: With the support of ARM images, it is possible to directly download the Nethunter
    images from the Kali website; however, in this section we will try a different
    approach, running Kali on any Android device that is configured to a high enough
    standard.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 ARM 镜像的支持，可以直接从 Kali 网站下载 Nethunter 镜像；然而，在本节中我们将尝试不同的方法，在配置达到足够标准的任何 Android
    设备上运行 Kali。
- en: 'We will utilize two applications from the trusted Google Play Store:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用来自受信任的 Google Play 商店的两个应用程序：
- en: 'UserLAnd: This is an open-source app that allows you to run several Linux operating
    systems on Android devices. This can be downloaded to the device through the Play
    Store by visiting [https://play.google.com/store/apps/details?id=tech.ula&hl=en_GB&gl=US](https://play.google.com/store/apps/details?id=tech.ula&hl=en_GB&gl=US).'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: UserLAnd：这是一个开源应用，允许您在 Android 设备上运行多个 Linux 操作系统。您可以通过访问 [https://play.google.com/store/apps/details?id=tech.ula&hl=en_GB&gl=US](https://play.google.com/store/apps/details?id=tech.ula&hl=en_GB&gl=US)
    在 Play 商店下载此应用。
- en: 'ConnectBot: A powerful open-source SSH client, it can manage simultaneous SSH
    sessions, create secure tunnels, and copy/paste between other applications. This
    application can also be downloaded directly through the Play Store or by visiting
    [https://play.google.com/store/apps/details?id=org.connectbot&hl=en_GB&gl=US](https://play.google.com/store/apps/details?id=org.connectbot&hl=en_GB&gl=US).'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ConnectBot：一款功能强大的开源 SSH 客户端，能够管理多个 SSH 会话，创建安全隧道，以及在其他应用之间进行复制/粘贴。此应用也可以直接通过
    Play 商店下载，或者访问 [https://play.google.com/store/apps/details?id=org.connectbot&hl=en_GB&gl=US](https://play.google.com/store/apps/details?id=org.connectbot&hl=en_GB&gl=US)
    进行下载。
- en: 'Once you have downloaded UserLAnd, you should see the same as that shown in
    *Figure 1.25*; select **Kali**:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 下载 UserLAnd 后，您应该看到与 *图 1.25* 中相同的界面；选择 **Kali**：
- en: '![](../Images/B17765_01_25.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_25.png)'
- en: 'Figure 1.25: Selecting Kali Linux in the UserLAnd mobile application'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.25：在 UserLAnd 移动应用中选择 Kali Linux
- en: 'The application should ask for your username, password, and VNC password for
    Kali to log in. Once the action is completed, there should be a pop-up asking
    you to select a connection bot, as shown in *Figure 1.26*:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序应该会要求输入您的用户名、密码和 Kali 的 VNC 密码进行登录。完成操作后，应该会弹出一个提示框，要求您选择连接机器人，如 *图 1.26*
    所示：
- en: '![](../Images/B17765_01_26.png)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_26.png)'
- en: 'Figure 1.26: After the Kali Linux image is downloaded, you will be provided
    with the two options; select ConnectBot'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.26：下载 Kali Linux 镜像后，您将获得两个选项；选择 ConnectBot
- en: 'We now have a lightweight version of Kali Linux (you may have to install the
    tools as and when required; as an example, you may install routersploit by running
    `sudo apt-get update && apt install routersploit` to gather information about
    the router that the mobile device is connected to) on our handheld Android device;
    part of the interface is shown in *Figure 1.27*:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在在手持 Android 设备上拥有一个轻量级的 Kali Linux 版本（您可能需要根据需要安装工具；例如，您可以通过运行 `sudo apt-get
    update && apt install routersploit` 来收集有关移动设备连接的路由器的信息）; 部分界面如 *图 1.27* 所示：
- en: '![](../Images/B17765_01_27.png)'
  id: totrans-223
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_27.png)'
- en: 'Figure 1.27: Successful installation of Kali Linux on an Android device'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.27：在 Android 设备上成功安装 Kali Linux
- en: We have now seen how Kali Linux is installed and run on an Android device without
    having to root the device. The version of Kali Linux on the device operates in
    its own sandbox; therefore, there will be no restrictions on us performing penetration
    testing from the device.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经看到如何在 Android 设备上安装并运行 Kali Linux，而无需对设备进行 root。设备上的 Kali Linux 版本在其自己的沙箱中运行；因此，我们可以自由地从设备上进行渗透测试。
- en: Organizing Kali Linux
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 组织 Kali Linux
- en: Installation is just the beginning; organizing Kali Linux is a very important
    next step. In this section, we will explore the different ways in which our Kali
    Linux can be organized through customization.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 安装只是开始；组织 Kali Linux 是一个非常重要的下一步。在本节中，我们将探讨如何通过自定义组织我们的 Kali Linux。
- en: Configuring and customizing Kali Linux
  id: totrans-228
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置和自定义 Kali Linux
- en: 'Kali is a framework that is used to perform penetration testing. The tester,
    however, should never feel tied to the tools that have been installed by default,
    or by the look and feel of the Kali desktop. By customizing Kali, a tester can
    increase the security of client data that is being collected and make it easier
    to perform a penetration test. Common customization options that can be made in
    Kali include the following:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: Kali是一个用于进行渗透测试的框架。然而，测试者不应该仅仅依赖于默认安装的工具或Kali桌面的外观和感觉。通过定制Kali，测试者可以提高收集的客户端数据的安全性，并使渗透测试更加方便。Kali中常见的定制选项包括以下内容：
- en: Resetting the Kali password
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 重置Kali密码
- en: Adding a non-root user
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加非root用户
- en: Configuring network services and secure communications
  id: totrans-232
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置网络服务和安全通信
- en: Adjusting network proxy settings
  id: totrans-233
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整网络代理设置
- en: Accessing the secure shell
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 访问安全外壳
- en: Speeding up Kali operations
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 加速Kali操作
- en: Sharing folders with Microsoft Windows
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与Microsoft Windows共享文件夹
- en: Creating encrypted folders
  id: totrans-237
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建加密文件夹
- en: Let us now take a further look at these options.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们进一步查看这些选项。
- en: Resetting the default password
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重置默认密码
- en: 'If you downloaded the preconfigured VMware or VirtualBox image, the default
    username and password to access Kali Linux is `kali`. It is recommended to change
    the default password; to do so, run the following command in the Kali Linux terminal:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你下载了预配置的VMware或VirtualBox镜像，访问Kali Linux的默认用户名和密码是`kali`。建议更改默认密码；为此，请在Kali
    Linux终端中运行以下命令：
- en: '[PRE7]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: You will then be prompted to enter a new password, and then to confirm it.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 然后系统会提示你输入新密码，并再次确认。
- en: Configuring network services and secure communications
  id: totrans-243
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置网络服务和安全通信
- en: 'The first step to ensure that we are able to access the internal network is
    to make sure that it has connectivity to either a wired or wireless network to
    support updates and communications. You may need to obtain an IP address through
    **Dynamic Host Configuration Protocol** **(DHCP)** by appending a network configuration
    file and adding an Ethernet adapter to it, in the form of the following commands
    from the Kali Linux terminal:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 确保能够访问内部网络的第一步是确保它能够连接到有线或无线网络，以支持更新和通信。你可能需要通过**动态主机配置协议**（**DHCP**）来获取IP地址，可以通过附加网络配置文件并添加以太网适配器，使用以下来自Kali
    Linux终端的命令形式：
- en: '[PRE8]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Once the network configuration file is appended, you should be able to bring
    up the `ifup` script to automatically assign the IP address, as displayed in *Figure
    1.28*:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦网络配置文件被附加，你应该能够运行`ifup`脚本来自动分配IP地址，如*图1.28*所示：
- en: '![](../Images/B17765_01_28.png)'
  id: totrans-247
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_28.png)'
- en: 'Figure 1.28: Successful assignment of an IP address through DHCP using the
    ifup script'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.28：通过DHCP使用ifup脚本成功分配IP地址
- en: 'In the case of a static IP, you can append the same network configuration file
    with the following lines and quickly set up a static IP to your version of Kali
    Linux:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 在静态IP的情况下，你可以在相同的网络配置文件中附加以下几行，并快速为你的Kali Linux版本设置静态IP：
- en: '[PRE9]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'By default, Kali starts with the DHCP service enabled. Doing so announces the
    new IP address to the network, which may alert administrators to the presence
    of the tester. For some test cases, this may not be an issue, and it may be advantageous
    to have certain services start automatically during boot-up. This can be achieved
    by entering the following commands:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Kali启用了DHCP服务。这样会向网络宣布新的IP地址，这可能会提醒管理员测试者的存在。对于某些测试用例，这可能不是问题，并且在启动时自动启动某些服务可能是有利的。可以通过输入以下命令来实现：
- en: '[PRE10]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Kali installs with network services that can be started or stopped as required,
    including DHCP, HTTP, SSH, TFTP, and the VNC server. These services are usually
    invoked from the command line; however, some are accessible from the Kali menu.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: Kali安装时带有可根据需要启动或停止的网络服务，包括DHCP、HTTP、SSH、TFTP和VNC服务器。这些服务通常从命令行调用；然而，一些服务也可以从Kali菜单中访问。
- en: Adjusting network proxy settings
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调整网络代理设置
- en: 'Users located behind an authenticated or unauthenticated proxy connection must
    modify the `bash.bashrc` and `apt.conf` files. Both files are located in the `/etc/`
    directory. Edit the `bash.bashrc` file, as the following shows, using a text editor
    to add the following lines to the bottom of the `bash.bashrc` file:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 位于认证或未认证代理连接背后的用户必须修改`bash.bashrc`和`apt.conf`文件。这两个文件位于`/etc/`目录下。使用文本编辑器编辑`bash.bashrc`文件，如以下所示，在`bash.bashrc`文件的底部添加以下几行：
- en: '[PRE11]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Replace `proxyIP` and `port` with your proxy IP address and port number, respectively,
    and replace the `username` and `password` with your authentication username and
    password. If there’s no need to authenticate, write only the part following the
    `@` symbol. Save and close the file.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 将 `proxyIP` 和 `port` 替换为您的代理IP地址和端口号，分别将 `username` 和 `password` 替换为您的身份验证用户名和密码。如果不需要身份验证，只需写
    `@` 符号后面的部分。保存并关闭文件。
- en: Accessing the secure shell remotely
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 远程访问安全外壳
- en: 'To minimize detection by a target network during testing, Kali does not enable
    any external listening network services. Some services, such as SSH, are already
    installed. However, they must be enabled prior to use. Kali comes preconfigured
    with default SSH keys. Before starting the SSH service, it is a good idea to disable
    the default keys and generate a unique keyset for use, as the following code shows.
    Move the default SSH keys to a backup folder, and then generate a new SSH keyset
    using the following command:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在测试过程中尽量减少目标网络的检测，Kali 默认不启用任何外部监听网络服务。一些服务，如 SSH，已经安装。但是，它们在使用之前必须启用。Kali
    默认配置了 SSH 密钥。启动 SSH 服务之前，最好禁用默认密钥并生成唯一的密钥集，代码如下所示。将默认的 SSH 密钥移动到备份文件夹，然后使用以下命令生成新的
    SSH 密钥集：
- en: '[PRE12]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: To confirm the SSH service is running, you can verify this by using the command
    `sudo service ssh status`.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 要确认 SSH 服务是否正在运行，您可以使用命令 `sudo service ssh status` 来验证。
- en: Note that with the default configuration of SSH, root login will be disabled.
    If you require access with the root account, you may have to edit `/etc/ssh/sshd_config`
    and set `PermitRootLogin` to `yes`, save, and then exit. Finally, from any system
    on the same network, you should be able to access the SSH service and utilize
    Kali Linux. In this example, we use PuTTY, which is a free and portable SSH client
    for Windows. Now you should be able to access Kali Linux from another machine,
    accept the SSH certificate, and enter your credentials.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，使用默认的 SSH 配置时，root 登录将被禁用。如果需要以 root 账户访问，您可能需要编辑 `/etc/ssh/sshd_config`
    并将 `PermitRootLogin` 设置为 `yes`，然后保存并退出。最后，在同一网络上的任何系统上，您应该能够访问 SSH 服务并使用 Kali
    Linux。在本示例中，我们使用 PuTTY，这是一个免费的便携式 SSH 客户端，适用于 Windows。现在，您应该能够从另一台机器访问 Kali Linux，接受
    SSH 证书并输入您的凭据。
- en: Speeding up Kali operations
  id: totrans-263
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 提升 Kali 操作速度
- en: 'Several tools can be used to optimize and speed up Kali operations:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 有几个工具可以用来优化并加速 Kali 操作：
- en: When using a VM, install its software drive package, either Guest Additions
    (VirtualBox) or VMware Tools (VMware).
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用虚拟机时，安装其软件驱动程序包，选择 Guest Additions（VirtualBox）或 VMware Tools（VMware）。
- en: We have to ensure that we run `apt-get update` before the installation.
  id: totrans-266
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在安装之前，我们必须确保运行 `apt-get update`。
- en: When creating a VM, select a fixed disk size instead of one that is dynamically
    allocated. It is faster to add files to a fixed disk, and there is less file fragmentation.
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建虚拟机时，选择一个固定磁盘大小，而不是动态分配的磁盘。将文件添加到固定磁盘更快，并且文件碎片较少。
- en: 'By default, Kali does not show all applications that are present in the startup
    menu. Each application that is installed during the boot-up process slows the
    system data and may impact memory usage and system performance. This can be performed
    by the following commands in the terminal:'
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认情况下，Kali 不会显示启动菜单中所有的应用程序。启动过程中安装的每个应用程序都会拖慢系统数据，并可能影响内存使用和系统性能。可以通过以下命令在终端执行此操作：
- en: To list all the startup services at bootup, type `sudo systemctl list-unit-files
    --type=service` in the terminal and you can choose to disable the unwanted services
    by running `sudo systemctl disable --now <nameoftheservice>`
  id: totrans-269
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要列出启动时的所有服务，在终端输入 `sudo systemctl list-unit-files --type=service`，然后您可以通过运行
    `sudo systemctl disable --now <nameoftheservice>` 来选择禁用不需要的服务。
- en: Finally, you can list the enabled services by running `sudo systemctl list-unit-files
    --type=service --state=enabled --all` in the terminal
  id: totrans-270
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，您可以通过在终端运行 `sudo systemctl list-unit-files --type=service --state=enabled
    --all` 来列出已启用的服务。
- en: Sharing folders with the host operating system
  id: totrans-271
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 与主机操作系统共享文件夹
- en: 'The Kali toolset has the flexibility to share results with applications residing
    on different operating systems, especially Microsoft Windows. The most effective
    way to share data is to create a folder that is accessible from the host operating
    system as well as the Kali Linux VM guest. When data is placed in a shared folder
    from either the host or the VM, it is immediately available via the shared folder
    to all systems that access that shared folder. To create a shared folder, perform
    the following steps:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: Kali 工具集具有灵活性，可以与位于不同操作系统上的应用程序共享结果，特别是 Microsoft Windows。共享数据最有效的方法是创建一个文件夹，使宿主操作系统和
    Kali Linux 虚拟机客户操作系统都能访问。当数据从宿主或虚拟机放入共享文件夹时，它会立即通过共享文件夹提供给所有访问该共享文件夹的系统。创建共享文件夹的步骤如下：
- en: Create a folder on the host operating system. In this example, it will be called
    `kali_Share`.
  id: totrans-273
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在宿主操作系统上创建一个文件夹。在此示例中，文件夹名称为`kali_Share`。
- en: Right-click on the folder and select the **Sharing** tab. From this menu, select
    **Share**.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键点击文件夹，选择**共享**选项卡。在该菜单中，选择**共享**。
- en: Ensure that the file is shared with **Everyone** and that **Permission Level**
    for this share is set to **Read/Write**.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保文件与**所有人**共享，并且此共享的**权限级别**设置为**读/写**。
- en: If you haven’t already done so, install the VMware tools/Virtual Box Guest additions
    onto Kali Linux, respectively.
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你还没有这样做，请分别在 Kali Linux 上安装 VMware 工具或 VirtualBox 客户端附加组件。
- en: When the installation is complete, go to the VMware player menu and select **Manage**
    and click on **Virtual Machine Settings**. Find the menu that enables **Shared
    Folders** and select **Always Enabled**.
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，进入 VMware 播放器菜单，选择**管理**，然后点击**虚拟机设置**。找到启用**共享文件夹**的菜单，选择**始终启用**。
- en: In the case of Oracle VirtualBox, select the VM and go to **Settings** and select
    **Shared Folders**, as shown in *Figure 1.29*:![](../Images/B17765_01_29.png)
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Oracle VirtualBox 的情况下，选择虚拟机并进入**设置**，然后选择**共享文件夹**，如*图 1.29*所示：![](../Images/B17765_01_29.png)
- en: 'Figure 1.29: Mounting a shared drive from the original operating system to
    the guest operating system'
  id: totrans-279
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.29：从原始操作系统将共享驱动器挂载到客户操作系统
- en: Please note that older versions of VMware Player use a different menu.
  id: totrans-280
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，旧版本的 VMware Player 使用的是不同的菜单。
- en: Now the folder should be automatically mounted to the `/media/` folder, as shown
    in *Figure 1.30*:![](../Images/B17765_01_30.png)
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，文件夹应该会自动挂载到`/media/`文件夹中，如*图 1.30*所示：![](../Images/B17765_01_30.png)
- en: 'Figure 1.30: Successful mounting of the shared drive to the Kali Linux VM'
  id: totrans-282
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.30：成功将共享驱动器挂载到 Kali Linux 虚拟机
- en: Everything placed in the folder will be accessible in the folder of the same
    name on the host operating system, and vice versa.
  id: totrans-283
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有放入该文件夹的内容将在宿主操作系统中以相同名称的文件夹访问，反之亦然。
- en: The shared folder, which will contain sensitive data from a penetration test,
    must be encrypted to protect the client’s network and reduce the tester’s liability
    should the data ever be lost or stolen.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 包含渗透测试敏感数据的共享文件夹必须加密，以保护客户的网络，并减少在数据丢失或被盗时对测试人员的责任。
- en: Using Bash scripts to customize Kali
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Bash 脚本定制 Kali
- en: Typically, to maintain system and software development, command-line interfaces
    were developed as multiple shells in Linux, namely, `sh`, `bash`, `csh`, `tcsh`,
    and `ksh`.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，为了维护系统和软件开发，Linux 开发了多个命令行界面（CLI），即`sh`、`bash`、`csh`、`tcsh` 和 `ksh`。
- en: 'We can utilize the following Bash scripts to customize Kali Linux depending
    upon the goal of our penetration testing: [https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E](https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E).'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以利用以下 Bash 脚本，根据我们的渗透测试目标定制 Kali Linux：[https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E](https://github.com/PacktPublishing/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E)。
- en: Building a verification lab
  id: totrans-288
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 搭建验证实验室
- en: As a penetration tester, it is recommended to set up your own verification lab
    to test any kind of vulnerabilities and have the right proof of concept before
    emulating the same conditions on a live environment.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 作为渗透测试员，建议搭建自己的验证实验室，测试各种漏洞，并在模拟相同环境到生产环境之前，确保有正确的概念验证。
- en: Installing defined targets
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装指定的目标
- en: In order to practice the art of exploitation, it is always recommended to make
    use of well-known vulnerable software. In this section, we will be installing
    Metasploitable3, which has both Windows and Linux versions; Mutillidae, which
    is a PHP framework web application; and we will also utilize CloudGoat, an AWS
    deployment tool designed to deploy vulnerable AWS instances.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 为了练习利用技术，建议使用一些已知存在漏洞的软件。在本节中，我们将安装 Metasploitable3，它有 Windows 和 Linux 版本；Metasploit
    Mutillidae，它是一个 PHP 框架的 Web 应用程序；我们还将使用 CloudGoat，这是一个 AWS 部署工具，用于部署脆弱的 AWS 实例。
- en: Lab Network
  id: totrans-292
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 实验室网络
- en: 'We need to ensure that we create a separate network that can be accessed only
    by testers—hence, we are going to create a NAT network within VirtualBox by running
    the following command from the Command Prompt or Terminal, respective of the directory;
    for Windows, it is `C:\Program Files\Oracle\VirtualBox\`:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要确保创建一个仅供测试人员访问的独立网络——因此，我们将在 VirtualBox 中创建一个 NAT 网络，通过从命令提示符或终端运行以下命令来实现，具体路径取决于操作系统；对于
    Windows 系统，路径是 `C:\Program Files\Oracle\VirtualBox\`：
- en: '[PRE13]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Note that this is a single line of code.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，这是单行代码。
- en: Active Directory and Domain Controller
  id: totrans-296
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 活动目录和域控制器
- en: 'In the previous edition, we discussed how to set up the Active Directory on
    Windows 2008 R2; in this section, we will upgrade our test lab and install Active
    Directory on Windows Server 2016 Datacenter. Once the ISO from Microsoft ([https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2016-essentials](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2016-essentials))
    is downloaded and the operating system on VMware Workstation Player or VirtualBox
    is installed, you should be able to perform the following steps:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一版中，我们讨论了如何在 Windows 2008 R2 上设置活动目录；本节中，我们将升级测试实验室，并在 Windows Server 2016
    Datacenter 上安装活动目录。一旦从 Microsoft 下载了 ISO 文件（[https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2016-essentials](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2016-essentials)），并在
    VMware Workstation Player 或 VirtualBox 上安装了操作系统，你应该能够执行以下步骤：
- en: Ensure the Network adapter is connected to the right network. Select the virtual
    machine and click **Settings**. Then, from the menu, click on **Network**, ensure
    that **Enable network adapter** is checked and that **Attached to** is selected
    as **NAT network**, and that the name is **InsideNetwork** (or the name you used
    to create the lab network). Additionally, click on **Advanced** and select **Allow
    All** under **Promiscuous mode** (this mode will allow all traffic between the
    VMs).
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保网络适配器连接到正确的网络。选择虚拟机并点击 **设置**，然后在菜单中点击 **网络**，确保 **启用网络适配器** 被勾选，并且 **连接方式**
    选择为 **NAT 网络**，名称为 **InsideNetwork**（或者你用来创建实验室网络的名称）。此外，点击 **高级** 并在 **混杂模式**
    下选择 **允许所有**（此模式将允许虚拟机之间的所有流量）。
- en: 'Upon successfully logging into the Windows server, set a static IP to this
    server by running the following in the command line:'
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 成功登录 Windows 服务器后，通过在命令行中运行以下命令设置该服务器的静态 IP：
- en: '[PRE14]'
  id: totrans-300
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: From **Server Manager**, click on **Add roles and features**.
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **服务器管理器** 中，点击 **添加角色和功能**。
- en: Select **Role-based or Features-based installation** from the **Installation
    Type** `screen` and click **Next**.
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 **安装类型** `屏幕` 中选择 **基于角色或基于功能的安装**，然后点击 **下一步**。
- en: By default, the same server will be selected from **Select a server from the
    server pool**; click **Next**.
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 默认情况下，系统会从 **选择服务器池中的服务器** 中选择相同的服务器；点击 **下一步**。
- en: 'From the **Server Roles** page, place a checkmark in the checkbox next to **Active
    Directory Domain Services**. Additional roles, services, or features are also
    required to install Domain Services: click **Add Features** and click **Next**.'
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **服务器角色** 页面中，在 **活动目录域服务** 旁边的复选框中打勾。安装域服务还需要其他角色、服务或功能：点击 **添加功能**，然后点击
    **下一步**。
- en: Select optional features to install during the AD DS installation by placing
    a check in the box next to any desired features, and then click on **Next**.
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 AD DS 安装过程中，通过勾选任何需要的功能旁边的复选框来选择可选功能，然后点击 **下一步**。
- en: That should take us to the confirmation screen with all the selected features
    and services; click on **Install** and, when the installation is complete, click
    on **Close**.
  id: totrans-306
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将带我们进入确认屏幕，显示所有选定的功能和服务；点击 **安装**，安装完成后，点击 **关闭**。
- en: 'Select **AD DS**; it should come up with a warning stating: `Configuration
    required for active directory domain service`. Now click on **More** for post-deployment
    configuration, which should bring us to *Figure 1.31*:![](../Images/B17765_01_31.png)'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**AD DS**；它应该会显示一个警告，指出：`需要配置活动目录域服务`。现在点击**更多**以进行部署后配置，这应该会带我们到*图1.31*：![](../Images/B17765_01_31.png)
- en: 'Figure 1.31: Promoting the server to a domain controller'
  id: totrans-308
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.31：将服务器提升为域控制器
- en: Click on **Promote this server to a domain controller**.
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**将此服务器提升为域控制器**。
- en: Select **Add a new Forest** and enter the **Fully Qualified Domain Name** (**FQDN**).
    In this example, we will create a new FQDN called `mastering.kali.fourthedition`.
    Then click **Next**.
  id: totrans-310
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**添加一个新森林**并输入**完全限定域名**（**FQDN**）。在此示例中，我们将创建一个新的FQDN，名为`mastering.kali.fourthedition`。然后点击**下一步**。
- en: On the next screen, for both **Forest functional level** and **Domain functional
    level**, select **Windows Server 2016** and type the password for **Directory
    Services Restore Mode** (**DSRM**); click **Next**.
  id: totrans-311
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一个屏幕上，对于**森林功能级别**和**域功能级别**，选择**Windows Server 2016**并输入**目录服务恢复模式**（**DSRM**）的密码；点击**下一步**。
- en: Do not select the DNS delegation—directly click on **Next**, where it should
    pick up the NetBIOS domain name as **MASTERING**. Click **Next**.
  id: totrans-312
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 不要选择DNS委派——直接点击**下一步**，它应该会自动识别NetBIOS域名为**MASTERING**。点击**下一步**。
- en: Select the locations for the database, log files, and SYSVOL for Active Directory,
    and finally, you should be presented with a review screen, as shown in *Figure
    1.32*; click **Next**:![](../Images/B17765_01_32.png)
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择Active Directory的数据库、日志文件和SYSVOL的位置，最后，应该会出现一个审查屏幕，如*图1.32*所示；点击**下一步**：![](../Images/B17765_01_32.png)
- en: 'Figure 1.32: Final stage of installation of Active Directory server on Windows
    Server 2016'
  id: totrans-314
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.32：Windows Server 2016上安装Active Directory服务器的最后阶段
- en: All the prerequisites must be met. Ignore the warnings; after this, click on
    **Install**.
  id: totrans-315
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 必须满足所有先决条件。忽略警告；完成后点击**安装**。
- en: On the **Confirm installation selections** screen, review the installation and
    then click **Install**. Doing so should reboot the system and a new Active Directory
    server with a domain controller should have been established.
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**确认安装选项**屏幕上，检查安装内容后点击**安装**。这样操作将重启系统，并且应该会建立一个新的包含域控制器的Active Directory服务器。
- en: 'To create a normal user on the domain, run the following command in the command
    line on the domain controller:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 要在域中创建一个普通用户，在域控制器的命令行中运行以下命令：
- en: '[PRE15]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'To create a domain administrator account, the following commands will create
    such a user and add it to the `domain admins` group:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个域管理员账户，以下命令将创建该用户并将其添加到`domain admins`组中：
- en: '[PRE16]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: To validate whether these users have been created, you can use the domain controller
    by simply running `net user` from the command line; you should be able to see
    all the local users on the server.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证这些用户是否已创建，可以通过在命令行中运行`net user`来使用域控制器；你应该能够看到服务器上的所有本地用户。
- en: 'We will also be creating an additional user for the new exchange server by
    running the following commands on our domain controller:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还将通过在域控制器上运行以下命令来为新的Exchange服务器创建一个额外的用户：
- en: '[PRE17]'
  id: totrans-323
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Installing Microsoft Exchange Server 2016
  id: totrans-324
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装Microsoft Exchange Server 2016
- en: In this section, we will set up a completely new Windows Server 2016 and install
    the Microsoft Exchange service on it. This is to explore some of the Exchange
    Server 2021 vulnerabilities that we will explore in later chapters.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将设置一个全新的Windows Server 2016，并在其上安装Microsoft Exchange服务。这样做是为了探讨我们将在后续章节中探讨的Exchange
    Server 2021的某些漏洞。
- en: 'We will utilize the same Windows 2016 ISO that we downloaded for the Active
    Directory installation and create a brand new server. Once the Windows Server
    is installed and booted up, the first step is to make sure that this server can
    now be communicated to the DNS service of the Domain Controller; hence, set up
    a static IP and DNS by running the following commands or manually by editing the
    Ethernet adapter settings ([https://www.server-world.info/en/note?os=Windows_Server_2016&p=initial_conf&f=4](https://www.server-world.info/en/note?os=Windows_Server_2016&p=initial_conf&f=4)):'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将利用与Active Directory安装时下载的相同Windows 2016 ISO来创建一个全新的服务器。一旦Windows Server安装并启动，第一步是确保该服务器现在可以与域控制器的DNS服务进行通信；因此，通过运行以下命令或手动编辑以太网适配器设置来设置静态IP和DNS（[https://www.server-world.info/en/note?os=Windows_Server_2016&p=initial_conf&f=4](https://www.server-world.info/en/note?os=Windows_Server_2016&p=initial_conf&f=4)）：
- en: '[PRE18]'
  id: totrans-327
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The next step is to set up Exchange Server to the domain. This can be achieved
    by doing the following:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是将Exchange服务器连接到域。这可以通过以下步骤完成：
- en: Go to **System Properties**. Press *Windows Key* + *R*and type `sysdm.cpl`;
    click on **Change**, which should bring up the new screen of **Computer Name/Domain
    Changes**.
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 进入**系统属性**。按*Windows键* + *R*并输入`sysdm.cpl`；点击**更改**，这将打开**计算机名称/域更改**的新界面。
- en: Change the computer name from the default to **ExchangeServer** and click on
    **Domain**; type `Mastering.kali.fourthedition`, and if there is no problem with
    the network, then you should get a prompt asking you to enter your username and
    password.
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将计算机名称从默认名称更改为**ExchangeServer**，然后点击**域**；输入`Mastering.kali.fourthedition`，如果网络没有问题，你应该会看到提示要求你输入用户名和密码。
- en: Enter the username as previously created, called `exchangeadmin`, with the password;
    you should now see the screen shown in *Figure 1.33*, showing that it was successfully
    attached to the domain.
  id: totrans-331
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入先前创建的用户名`exchangeadmin`，并输入密码；此时你应该看到如*图1.33*所示的界面，显示已成功加入域。
- en: The final step is to restart the computer for the change in computer name that
    the domain should now reflect to take place:![Graphical user interface, application  Description
    automatically generated](../Images/B17765_01_33.png)
  id: totrans-332
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一步是重启计算机，以便计算机名称的更改能在域中反映出来：![图形用户界面，应用程序 描述自动生成](../Images/B17765_01_33.png)
- en: 'Figure 1.33: Successfully adding the exchange server to the Active Directory
    domain'
  id: totrans-333
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图1.33：成功将Exchange服务器添加到Active Directory域
- en: 'The following steps will promote our normal Windows Server 2016 to an Exchange
    Server:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将把我们的普通Windows Server 2016升级为Exchange服务器：
- en: Download the Microsoft Exchange Server 2016 image from [https://www.microsoft.com/en-us/download/details.aspx?id=57827](https://www.microsoft.com/en-us/download/details.aspx?id=57827).
  id: totrans-335
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从[https://www.microsoft.com/en-us/download/details.aspx?id=57827](https://www.microsoft.com/en-us/download/details.aspx?id=57827)下载Microsoft
    Exchange Server 2016镜像。
- en: Mount the ISO file to VirtualBox as a drive by navigating to **Settings**, **Storage**,
    and **Select the Optical Drive**, and add the exchange server ISO file.
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将ISO文件通过VirtualBox挂载为驱动器，方法是进入**设置**，**存储**，选择**光驱**，并添加Exchange服务器的ISO文件。
- en: 'Before beginning the installation, we will install some prerequisites, which
    can be directly installed from PowerShell (run as administrator), as the following
    shows:'
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在开始安装之前，我们需要安装一些先决条件，可以直接从PowerShell（以管理员身份运行）安装，如下所示：
- en: '[PRE19]'
  id: totrans-338
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Besides these packages, you will also need to download Unified Communications
    Managed API 4.0 Runtime from [http://www.microsoft.com/en-us/download/details.aspx?id=34992](http://www.microsoft.com/en-us/download/details.aspx?id=34992)
    and install it.
  id: totrans-339
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除了这些软件包，你还需要从[http://www.microsoft.com/en-us/download/details.aspx?id=34992](http://www.microsoft.com/en-us/download/details.aspx?id=34992)下载并安装Unified
    Communications Managed API 4.0 Runtime。
- en: Once all the prerequisites are completed, locate the drive by typing `d:` in
    the command line; then type `setup /PrepareSchema /IAcceptExchangeServerLicenseTerms`.
    If no error occurs, then you should see the same screen as displayed in *Figure
    1.34*:![](../Images/B17765_01_34.png)
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦所有先决条件完成，通过在命令行中输入`d:`来定位驱动器；然后输入`setup /PrepareSchema /IAcceptExchangeServerLicenseTerms`。如果没有错误发生，你应该看到与*图1.34*中相同的屏幕：![](../Images/B17765_01_34.png)
- en: 'Figure 1.34: Prerequisite checks to install Exchange Server'
  id: totrans-341
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图1.34：安装Exchange服务器前的先决条件检查
- en: 'Once all the prerequisite analysis has been completed, we can now move on to
    the next step by preparing our Active Directory by running the following command:'
  id: totrans-342
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦完成所有先决条件分析，我们可以通过运行以下命令来准备我们的Active Directory，进入下一步：
- en: '[PRE20]'
  id: totrans-343
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'As a final step, we will now install the `Mailbox` role on our exchange server
    by running the following command:'
  id: totrans-344
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为最后一步，我们将通过运行以下命令在我们的Exchange服务器上安装`Mailbox`角色：
- en: '[PRE21]'
  id: totrans-345
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: This will lead to the successful installation of the required Exchange Server
    components and packages as shown in *Figure 1.35*:![](../Images/B17765_01_35.png)
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将导致所需的Exchange服务器组件和软件包成功安装，如*图1.35*所示：![](../Images/B17765_01_35.png)
- en: 'Figure 1.35: Installation of Exchange Server tools and their configuration'
  id: totrans-347
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图1.35：安装Exchange服务器工具及其配置
- en: It may take some time, depending on the system performance. Once everything
    is complete, we should now have Outlook web access enabled on the Exchange Server
    on port `443`, as shown in *Figure 1.36*:![](../Images/B17765_01_36.png)
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据系统性能的不同，这可能需要一些时间。一旦完成，Exchange服务器上的Outlook Web Access应该已启用，端口为`443`，如*图1.36*所示：![](../Images/B17765_01_36.png)
- en: 'Figure 1.36: Successful installation of Exchange Server, accessed at https://localhost/owa/'
  id: totrans-349
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.36：Exchange Server 安装成功，访问地址 https://localhost/owa/
- en: Metasploitable3
  id: totrans-350
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Metasploitable3
- en: Metasploitable3 is an indubitably vulnerable Virtual Machine (VM) that is intended
    to be tested for multiple exploits using Metasploit. It is released under a BSD-style
    license. We will be utilizing two VMs, one VM running an obsolete Windows 2008
    server and another running a Linux server Ubuntu 14.04, to practice within our
    lab network. You can achieve this setup by first installing the Vagrant application.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploitable3 是一款明显易受攻击的虚拟机（VM），旨在使用 Metasploit 测试多个漏洞。它是以 BSD 风格的许可证发布的。我们将使用两台虚拟机，一台运行过时的
    Windows 2008 服务器，另一台运行 Ubuntu 14.04 Linux 服务器，在我们的实验室网络中进行练习。你可以通过首先安装 Vagrant
    应用程序来实现此设置。
- en: 'Vagrant is an open-source tool that is predominantly used for building and
    managing virtual machine environments. You can download this tool from [https://www.vagrantup.com/downloads](https://www.vagrantup.com/downloads)
    for your hosting operating system. Once the application is successfully installed,
    install the required plugins, `vagrant-reload` and `vagrant-vbguest`, by running
    the following commands in the Terminal or Command Prompt:'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: Vagrant 是一个开源工具，主要用于构建和管理虚拟机环境。你可以从[https://www.vagrantup.com/downloads](https://www.vagrantup.com/downloads)下载适用于你操作系统的版本。安装应用程序成功后，通过在终端或命令提示符中运行以下命令安装所需插件
    `vagrant-reload` 和 `vagrant-vbguest`：
- en: '[PRE22]'
  id: totrans-353
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'We are now ready to download the Metasploitable3 virtual machines to our local
    system. We will use the `vagrant box add` command along with the repository to
    download the virtual machines; these are hosted on `vagrantcloud.com`:'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在准备将 Metasploitable3 虚拟机下载到本地系统。我们将使用 `vagrant box add` 命令配合仓库来下载虚拟机，这些虚拟机托管在
    `vagrantcloud.com` 上：
- en: '[PRE23]'
  id: totrans-355
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Running the preceding commands should provide you with the options to download
    using different providers, as shown in the following *Figure 1.37*:'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 运行前面的命令应该能提供使用不同服务提供商下载的选项，如下所示的*图 1.37*：
- en: '![A screenshot of a computer  Description automatically generated with medium
    confidence](../Images/B17765_01_37.png)'
  id: totrans-357
  prefs: []
  type: TYPE_IMG
  zh: '![A screenshot of a computer  Description automatically generated with medium
    confidence](../Images/B17765_01_37.png)'
- en: 'Figure 1.37: Downloading Metasploitable3 via vagrant'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.37：通过 vagrant 下载 Metasploitable3
- en: 'These virtual machines are downloaded to the `/home/username/.vagrant.d/boxes/`
    or `c:\users\username\.vagrant.d\boxes\` folder. Check these folders to verify
    the download:'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 这些虚拟机被下载到`/home/username/.vagrant.d/boxes/` 或 `c:\users\username\.vagrant.d\boxes\`
    文件夹。检查这些文件夹以验证下载情况：
- en: Change your folder to the respective location by running cd `C:\Users\user\.vagrant.d\boxes
    or cd /home/username/.vagrant.d/boxes/`
  id: totrans-360
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过运行 cd `C:\Users\user\.vagrant.d\boxes` 或 cd `/home/username/.vagrant.d/boxes/`
    来切换到相应的文件夹。
- en: We can list the downloaded boxes that are installed on our device by running
    `vagrant box list.`
  id: totrans-361
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们可以通过运行 `vagrant box list` 来列出已安装在设备上的下载盒子。
- en: To run these machines, we need to initialize them by running `vagrant init metasploitable3-win2k8`.
    This command creates the required Vagrant configuration file named `Vagrantfile`,
    which includes all the virtual machine settings. Run `vagrant init metasploitable3-ub1404`
    from a different folder to avoid the `Vagrantfile already exists` error message.
  id: totrans-362
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要运行这些虚拟机，我们需要通过运行 `vagrant init metasploitable3-win2k8` 来初始化它们。此命令会创建一个名为 `Vagrantfile`
    的配置文件，其中包含所有虚拟机设置。从不同的文件夹运行 `vagrant init metasploitable3-ub1404` 以避免出现 `Vagrantfile
    already exists` 错误消息。
- en: 'Finally, we will bring the virtual machine up by running `vagrant up`. You
    should see the virtual machine up. Pentesters will receive the warning `default:
    Warning: Authentication failure. Retrying`, which is due to the insecure private
    key used for the SSH access between the VM and Vagrant. You should see the screen
    shown in *Figure 1.38* upon successfully starting the Metasploitable3 windows
    server:![Graphical user interface, text  Description automatically generated](../Images/B17765_01_38.png)'
  id: totrans-363
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '最后，我们通过运行 `vagrant up` 启动虚拟机。你应该能看到虚拟机启动。渗透测试者会收到警告 `default: Warning: Authentication
    failure. Retrying`，这是由于用于 VM 与 Vagrant 之间 SSH 访问的不安全私钥。成功启动 Metasploitable3 Windows
    服务器后，你应该能看到*图 1.38*所示的屏幕：![Graphical user interface, text  Description automatically
    generated](../Images/B17765_01_38.png)'
- en: 'Figure 1.38: VirtualBox running metasploitable 3'
  id: totrans-364
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.38：VirtualBox 运行 metasploitable 3
- en: Validate the systems that are currently initialized by running vagrant `global-status`.
  id: totrans-365
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过运行vagrant `global-status`验证当前初始化的系统。
- en: The next important steps are to change the network settings of these VMs to
    connect them to our lab network. Select the virtual machine and click **Settings**.
    Within the **General** tab, change the **Name** of the VM to your desired name
    and, from the menu, click on **Network**. Ensure **Enable network adapter** is
    checked and **Attached to** is selected as **NAT network** and the name is **InsideNetwork.**
  id: totrans-366
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来的重要步骤是更改这些虚拟机的网络设置，将它们连接到我们的实验室网络。选择虚拟机并点击**设置**。在**常规**标签下，将虚拟机的**名称**更改为所需的名称，然后从菜单中点击**网络**。确保勾选**启用网络适配器**，并选择**附加到**为**NAT网络**，名称为**InsideNetwork**。
- en: We have successfully deployed the vulnerable Metasploitable3 VMs in our VirtualBox
    environment, which we will be utilizing to conduct more advanced exploitations
    in the coming sections.
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经成功地在我们的VirtualBox环境中部署了易受攻击的Metasploitable3虚拟机，接下来我们将在这些虚拟机上进行更高级的漏洞利用操作。
- en: Mutillidae
  id: totrans-368
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Mutillidae
- en: Mutillidae is an open-source insecure web application designed for penetration
    testers to practice all of the web app-specific vulnerability exploitation. XAMPP
    is another such free and open-source cross-platform web server solution stack
    package that can be used, developed by Apache Friends.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: Mutillidae是一个开源的、不安全的Web应用程序，旨在供渗透测试人员练习所有与Web应用程序相关的漏洞利用。XAMPP是另一种免费的开源跨平台Web服务器解决方案堆栈，可以使用，由Apache
    Friends开发。
- en: 'We will now install Mutillidae on our newly installed Microsoft Windows Server
    2016 (domain controller) server to host it:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将在新安装的Microsoft Windows Server 2016（域控制器）服务器上安装Mutillidae并托管它：
- en: 'You can either download XAMPP directly from [https://www.apachefriends.org/download.html](https://www.apachefriends.org/download.html)
    or run the following command in PowerShell:'
  id: totrans-371
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以直接从[https://www.apachefriends.org/download.html](https://www.apachefriends.org/download.html)下载XAMPP，也可以在PowerShell中运行以下命令：
- en: '[PRE24]'
  id: totrans-372
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'In case of any SSL/TLS errors while running `wget` in PowerShell, ensure you
    run the following command within PowerShell: `[Net.ServicePointManager]::SecurityProtocol=[Net.SecurityProtocolType]::Tls12`
    to ensure that TLS1.2 is supported by the Windows Server.'
  id: totrans-373
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果在PowerShell中运行`wget`时遇到任何SSL/TLS错误，确保在PowerShell中运行以下命令：[Net.ServicePointManager]::SecurityProtocol=[Net.SecurityProtocolType]::Tls12，以确保Windows
    Server支持TLS 1.2。
- en: We will utilize XAMPP for Windows version 7.1.30\. Once the application installation
    is complete, ensure you enable Apache and MySQLas services by clicking on the
    tickbox under **Service** within the XAMPP control panel, as shown in *Figure
    1.39*:![Graphical user interface  Description automatically generated](../Images/B17765_01_39.png)
  id: totrans-374
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将使用Windows版本的XAMPP 7.1.30。一旦应用程序安装完成，确保通过点击XAMPP控制面板中的**服务**下的勾选框来启用Apache和MySQL服务，如*图1.39*所示：![图形用户界面
    自动生成的描述](../Images/B17765_01_39.png)
- en: 'Figure 1.39: XAMMP Control Panel showing Apache and MySQL running'
  id: totrans-375
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图1.39：XAMPP控制面板显示Apache和MySQL正在运行
- en: 'You can download the latest version of Mutillidae directly from [https://github.com/webpwnized/mutillidae](https://github.com/webpwnized/mutillidae)
    or by running the following command in PowerShell:'
  id: totrans-376
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以直接从[https://github.com/webpwnized/mutillidae](https://github.com/webpwnized/mutillidae)下载最新版本的Mutillidae，也可以通过在PowerShell中运行以下命令来下载：
- en: '[PRE25]'
  id: totrans-377
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Unzip the file and copy the folder to `C:\yourxampplocation\htdocs\<mutillidae>`.
  id: totrans-378
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解压缩文件并将文件夹复制到`C:\yourxampplocation\htdocs\<mutillidae>`。
- en: Open the `.htacess` file inside the `Mutillidae` folder and add `Allow from
    10.10.10.0/24` under and the IP range are allowed.
  id: totrans-379
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开`Mutillidae`文件夹中的`.htacess`文件，并在其中添加`Allow from 10.10.10.0/24`，以允许该IP范围访问。
- en: Start the Apache and MySQL services by clicking on the **Start** button under
    **Actions** within XAMPP Control Panel. You should see the web application successfully
    deployed on your Windows Server, and it can be accessed by visiting `http://10.10.10.100/mutillidae/`.
  id: totrans-380
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过点击XAMPP控制面板中的**操作**下的**启动**按钮，启动Apache和MySQL服务。您应该能够看到Web应用程序在Windows Server上成功部署，并且可以通过访问`http://10.10.10.100/mutillidae/`来访问它。
- en: 'You will receive the database error messages relating to root access denial
    on MySQL. Open the XAMPP control panel, ensure that the MySQL service is up and
    running, and click on **Shell** and run the following steps to reset the root
    password, as depicted in *Figure 1.40*:'
  id: totrans-381
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将收到与MySQL根访问拒绝相关的数据库错误消息。打开XAMPP控制面板，确保MySQL服务已启动并运行，然后点击**Shell**，并按照*图1.40*中所示的步骤重置root密码：
- en: '[PRE26]'
  id: totrans-382
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![Text  Description automatically generated](../Images/B17765_01_40.png)'
  id: totrans-383
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![文本 自动生成的描述](../Images/B17765_01_40.png)'
- en: 'Figure 1.40: Running the Shell from XAMPP and setting the MySQL password for
    the root user'
  id: totrans-384
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图1.40：从XAMPP运行Shell并为root用户设置MySQL密码
- en: The final successful deployment of the vulnerable web application will lead
    to the screen shown in *Figure 1.41*:![](../Images/B17765_01_41.png)
  id: totrans-385
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最终成功部署漏洞的 Web 应用程序将导致显示 *图 1.41* 所示的界面：![](../Images/B17765_01_41.png)
- en: 'Figure 1.41: Successfully accessing Mutillidae on Kali Linux within the same
    lab network'
  id: totrans-386
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.41：在同一实验室网络内成功访问 Kali Linux 上的 Mutillidae
- en: In case of error messages saying that the database is offline or something similar,
    you have to select **Try to setup/reset the DB** for Mutillidae. If you encounter
    any other error messages of missing files – ensure you disable Defender by running
    `Set-MpPreference -DisableRealtimeMonitoring $true` in PowerShell as administrator.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 如果出现数据库离线或类似的错误消息，你需要选择 **尝试设置/重置数据库** 以修复 Mutillidae。如果遇到其他缺少文件的错误消息 —— 确保通过以管理员身份在
    PowerShell 中运行 `Set-MpPreference -DisableRealtimeMonitoring $true` 来禁用 Defender。
- en: CloudGoat
  id: totrans-388
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: CloudGoat
- en: '**CloudGoat** is an AWS deployment tool that is designed by Rhino Security
    Labs. This tool is written in Python, which deploys a purposefully vulnerable
    AWS resource in the account. We will set up the CloudGoat Docker image within
    Kali Linux and explore the different vulnerabilities that attackers can take advantage
    of in a misconfigured cloud environment.'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: '**CloudGoat** 是由 Rhino Security Labs 设计的 AWS 部署工具。该工具使用 Python 编写，能够在账户中部署一个故意存在漏洞的
    AWS 资源。我们将在 Kali Linux 上设置 CloudGoat Docker 镜像，并探索攻击者在配置错误的云环境中可能利用的各种漏洞。'
- en: 'To make sure that CloudGoat can deploy the AWS resources, the first step is
    to possess a valid AWS account. Assuming that we have one from the *Kali on AWS
    Cloud* section, we will perform the following steps:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保 CloudGoat 能够部署 AWS 资源，第一步是拥有一个有效的 AWS 账户。假设我们已经拥有一个来自 *Kali on AWS Cloud*
    部分的账户，我们将执行以下步骤：
- en: Access [https://console.aws.amazon.com/iam/home?region=us-east-2#/home](https://console.aws.amazon.com/iam/home?region=us-east-2#/home).
  id: totrans-391
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 访问 [https://console.aws.amazon.com/iam/home?region=us-east-2#/home](https://console.aws.amazon.com/iam/home?region=us-east-2#/home)。
- en: Click on the users, then on **Add user**; enter `cloudgoat`and select **Programmatic
    access**; click **Next**, which should bring us to the screen shown in *Figure
    1.42*:![](../Images/B17765_01_42.png)
  id: totrans-392
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击用户，然后点击 **添加用户**；输入 `cloudgoat` 并选择 **程序化访问**；点击 **下一步**，这应该会带我们到 *图 1.42*
    中显示的界面：![](../Images/B17765_01_42.png)
- en: 'Figure 1.42: Creating an IAM user account in the AWS console'
  id: totrans-393
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.42：在 AWS 控制台中创建 IAM 用户账户
- en: Select **Attach existing policies directly** and check **AdministratorAccess**,
    as shown in *Figure 1.43*; click on **Next**:![](../Images/B17765_01_43.png)
  id: totrans-394
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择 **直接附加现有策略** 并勾选 **AdministratorAccess**，如 *图 1.43* 所示；点击 **下一步**：![](../Images/B17765_01_43.png)
- en: 'Figure 1.43: Adding the IAM user to the AdministratorAccess group'
  id: totrans-395
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.43：将 IAM 用户添加到 AdministratorAccess 组
- en: Click on **Next** until you reach the final stage. If no error is displayed,
    then you should see the following screen with the **Success** message, where you
    can download the user **Access key ID** and **Secret access key**:![](../Images/B17765_01_44.png)
  id: totrans-396
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **下一步**，直到你到达最后阶段。如果没有显示错误信息，你应该会看到如下界面，其中显示了 **成功** 消息，你可以下载用户的 **访问密钥 ID**
    和 **秘密访问密钥**：![](../Images/B17765_01_44.png)
- en: 'Figure 1.44: Creation of an Access key ID for the IAM user'
  id: totrans-397
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 1.44：为 IAM 用户创建访问密钥 ID
- en: 'Now that we have created the IAM user with administrative privileges within
    the AWS account, let us go ahead and install CloudGoat on the Docker image within
    Kali Linux by running the following commands in the terminal:'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经在 AWS 账户内创建了具有管理员权限的 IAM 用户，接下来我们将在 Kali Linux 上的 Docker 镜像中安装 CloudGoat，方法是在终端中运行以下命令：
- en: '[PRE27]'
  id: totrans-399
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Finally, configure the AWS client to connect to our AWS infrastructure using
    `aws configure --profile masteringkali` with the latest access key and secret
    that we downloaded from AWS, as shown in *Figure 1.45*. We will be exploring this
    tool in more detail in *Chapter 8*, *Cloud Security Exploitation*:'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，使用 `aws configure --profile masteringkali` 配置 AWS 客户端，以连接到我们的 AWS 基础设施，并使用我们从
    AWS 下载的最新访问密钥和秘密密钥，如 *图 1.45* 所示。我们将在 *第 8 章*，*云安全漏洞利用* 中更详细地探讨此工具：
- en: '![](../Images/B17765_01_45.png)'
  id: totrans-401
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B17765_01_45.png)'
- en: 'Figure 1.45: Configuration of AWS client for our newly created access key'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.45：为新创建的访问密钥配置 AWS 客户端
- en: '*Figure 1.46* depicts the LAB architecture of our setup for practicing penetration
    testing on our defined targets:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 1.46* 描述了我们设置的实验架构，用于在我们定义的目标上进行渗透测试：'
- en: '![Graphical user interface  Description automatically generated with medium
    confidence](../Images/B17765_01_46.png)'
  id: totrans-404
  prefs: []
  type: TYPE_IMG
  zh: '![图形用户界面 描述自动生成，信心中等](../Images/B17765_01_46.png)'
- en: 'Figure 1.46: Our Mastering Kali Linux practice lab architecture'
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.46：我们的《掌握 Kali Linux》实践实验室架构
- en: 'We have successfully built our own virtualized internal lab, and this should
    provide us with a wide range of exposure to identify and exploit multiple vulnerabilities
    within the infrastructure, application, and cloud. We should have the following
    set up:'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经成功构建了自己的虚拟化内部实验室，这应该能为我们提供广泛的暴露机会，帮助识别和利用基础设施、应用程序和云中的多个漏洞。我们应该设置以下内容：
- en: A Domain Controller running on Windows Server 2016 running Mutillidae through
    XAMPP
  id: totrans-407
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个运行在 Windows Server 2016 上的域控制器，通过 XAMPP 运行 Mutillidae
- en: A vulnerable on-premises Microsoft Exchange server running on Windows Server
    2016 with missing patches.
  id: totrans-408
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个易受攻击的本地 Microsoft Exchange 服务器，运行在 Windows Server 2016 上，缺少必要的补丁。
- en: An obsolete Microsoft Windows 2008 R2 (Metasploitable3 server) running multiple
    vulnerable services.
  id: totrans-409
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个过时的 Microsoft Windows 2008 R2（Metasploitable3 服务器），运行多个易受攻击的服务。
- en: One domain administrator, one exchange administrator, and a normal domain user
    – which we will utilize in the latter part of this book to perform privilege escalation
    based on the roles.
  id: totrans-410
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个域管理员，一个 Exchange 管理员，以及一个普通的域用户——我们将在本书的后续部分利用这些角色执行基于角色的权限提升。
- en: The AWS cloud deployment tool on a Docker image to set up vulnerable AWS infrastructure
    resources.
  id: totrans-411
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Docker 镜像上的 AWS 云部署工具，用于设置易受攻击的 AWS 基础设施资源。
- en: Testers have to ensure that all the VMs that are created as part of this lab
    network should always have the settings of the network set to NAT network and
    the network name as InsideNetwork, so that the VMs can communicate with each other.
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 测试人员必须确保所有在此实验室网络中创建的虚拟机，网络设置始终为 NAT 网络，网络名称为 InsideNetwork，以便虚拟机之间可以互相通信。
- en: Managing collaborative penetration testing using Faraday
  id: totrans-413
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Faraday 管理协作渗透测试
- en: One of the most difficult aspects of penetration testing is remembering to test
    all of the relevant parts of the network or system target, or trying to remember
    whether the target was actually tested after the testing has been completed. In
    some cases, a single client may have multiple penetration testers performing scanning
    activities from multiple locations, and management would like to have a single
    view. Faraday can provide this, assuming all of the penetration testers are able
    to ping each other on the same network or on the internet for external assessment.
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 渗透测试中最困难的方面之一是记住测试网络或系统目标的所有相关部分，或者在测试完成后记得目标是否实际测试过。在某些情况下，单个客户可能有多个渗透测试人员在多个位置执行扫描活动，而管理层希望能看到一个单一的视图。Faraday
    可以提供这种功能，前提是所有渗透测试人员能够在同一网络上或通过互联网进行相互 ping 测试，以进行外部评估。
- en: Faraday is a multiuser penetration test **Integrated Development Environment**
    (**IDE**). It is designed for testers to distribute, index, and analyze all of
    the data that is generated during the process of a penetration test or technical
    security audit to provide different views, such as **Management**, **Executive
    Summary**, and **Overall Issues** lists.
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: Faraday 是一个多用户渗透测试 **集成开发环境**（**IDE**）。它旨在帮助测试人员分发、索引和分析渗透测试或技术安全审计过程中生成的所有数据，提供不同的视图，例如
    **管理**、**执行摘要** 和 **总体问题** 列表。
- en: This IDE platform was developed in Python by InfoByte, and version 3.14.3 is
    installed by default in the latest version of Kali Linux. You can navigate, from
    the menu, to **Applications**, click on **12-Reporting tools**, and then click
    on **Faraday start**. It should open up a new screen for you to enter your password
    to perform service changes. You should now be presented with the following screen
    to set up a username and password for the Faraday web portal.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 这个 IDE 平台是由 InfoByte 使用 Python 开发的，最新版本的 Kali Linux 默认安装了版本 3.14.3。你可以从菜单中导航到
    **应用程序**，点击 **12-报告工具**，然后点击 **Faraday 启动**。它应该会打开一个新的屏幕，供你输入密码以执行服务更改。现在，你应该看到以下屏幕，设置
    Faraday Web 门户的用户名和密码。
- en: Once the username and password are both set, the application should open the
    web browser, pointing to `http://localhost:5985/`
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦设置好用户名和密码，应用程序应该打开一个指向 `http://localhost:5985/` 的网页浏览器。
- en: 'You will now be able to create workspaces for each project. The next step is
    to make sure all the testers that are to utilize the Faraday client perform all
    the tasks by running `faraday-client` in the terminal; it should prompt you to
    enter the credentials for the application. Use the same credentials that you just
    created, and you should now be able to see the same screen as that displayed in
    *Figure 1.47*:'
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你将能够为每个项目创建工作空间。下一步是确保所有要使用Faraday客户端的测试人员，通过在终端运行`faraday-client`来执行所有任务；它会提示你输入应用程序的凭据。使用刚刚创建的凭据，你现在应该能够看到与*图1.47*相同的界面：
- en: '![Text  Description automatically generated](../Images/B17765_01_47.png)'
  id: totrans-419
  prefs: []
  type: TYPE_IMG
  zh: '![Text  Description automatically generated](../Images/B17765_01_47.png)'
- en: 'Figure 1.47: Running Nmap scan through the Faraday client'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.47：通过Faraday客户端运行Nmap扫描
- en: 'Following this screen, any scanning command-line activities that you or any
    other penetration testers in your team carry out can be visualized by clicking
    on the **Faraday web** application; this will display something similar to that
    shown in *Figure 1.48*:'
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 在此界面之后，你或你团队中的其他渗透测试人员执行的任何扫描命令行操作都可以通过点击**Faraday web**应用程序进行可视化；这将显示类似于*图1.48*所示的内容：
- en: '![Graphical user interface, text, application  Description automatically generated](../Images/B17765_01_48.png)'
  id: totrans-422
  prefs: []
  type: TYPE_IMG
  zh: '![Graphical user interface, text, application  Description automatically generated](../Images/B17765_01_48.png)'
- en: 'Figure 1.48: The real-time dashboard of Faraday'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 图1.48：Faraday的实时仪表盘
- en: There is a limitation of the free version of Faraday 3.15.0, where real-time
    operations, insights, and data analysis cannot be utilized by testers to visualize
    the whole list of issues in a single place.
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: Faraday 3.15.0免费版存在一个限制，即测试人员无法利用实时操作、洞察和数据分析功能在一个地方可视化所有问题列表。
- en: Summary
  id: totrans-425
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we looked at the different threat actors and their motivations,
    along with certain methodologies and goal-based penetration testing that help
    organizations to test themselves against real-time attacks. We learned how penetration
    testers can use Kali Linux on different platforms to assess the security of data
    systems and networks. We have taken a quick look at how to install Kali on different
    virtualized and cloud platforms and ran a Kali Linux operating system Docker image,
    along with one on a non-rooted Android phone.
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了不同的威胁行为者及其动机，以及一些方法论和基于目标的渗透测试，这些方法有助于组织测试自己应对实时攻击的能力。我们学习了渗透测试人员如何在不同平台上使用Kali
    Linux来评估数据系统和网络的安全性。我们简要了解了如何在不同的虚拟化和云平台上安装Kali，并运行了Kali Linux操作系统的Docker镜像，同时也在一部非root的Android手机上运行了该镜像。
- en: We built our own verification lab, set up Active Directory Domain Services,
    along with an Exchange Server instance, and two VMs on the same network, one of
    which is hosting a vulnerable web application. Most importantly, we learned how
    to customize Kali to increase the security of our tools and the data that they
    collect. We’re working to achieve the goal of making tools support our process
    instead of the other way around!
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 我们建立了自己的验证实验室，设置了Active Directory域服务，以及一个Exchange Server实例，并在同一网络上配置了两台虚拟机，其中一台托管着一个存在漏洞的Web应用程序。最重要的是，我们学习了如何定制Kali，以提高我们工具的安全性和它们收集的数据的安全性。我们的目标是让工具支持我们的过程，而不是让过程适应工具！
- en: In the next chapter, we will learn how we can effectively master **Open-Source
    Intelligence** (**OSINT**) in this era to identify the weak attack surfaces of
    our target and create customized username and password lists to facilitate more
    focused attacks, extracting these details from the dark web, along with other
    methods.
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何在这个时代有效掌握**开源情报**（**OSINT**），以识别目标的薄弱攻击面，并创建定制化的用户名和密码列表，以便进行更有针对性的攻击，并通过暗网等方法提取这些细节。
