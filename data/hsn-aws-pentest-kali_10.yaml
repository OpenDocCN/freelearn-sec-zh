- en: Reconnaissance - Identifying Vulnerable S3 Buckets
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 侦察-识别易受攻击的S3存储桶
- en: '**Simple Storage Service** (**S3**) buckets are one of the most popular attack
    surfaces for AWS infrastructures, and they''re the most prone to hacking attacks.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '**简单存储服务**（**S3**）存储桶是AWS基础设施中最受欢迎的攻击面之一，也是最容易受到黑客攻击的攻击面。'
- en: This chapter explains the concept of AWS S3 buckets, what they're used for,
    and how to set them up and access them. However, the main focus for this chapter
    is on the various S3 bucket permissions, the different ways of identifying poorly
    configured or permissive buckets, as well as connecting to these buckets. Finally,
    we will focus on automated approaches to identifying vulnerable S3 buckets in
    multiple regions based on domain and subdomain names, and probing their permissions
    to find potentially vulnerable buckets.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章解释了AWS S3存储桶的概念，它们的用途以及如何设置和访问它们。然而，本章的主要重点是各种S3存储桶权限、识别配置不当或过于宽松的存储桶的不同方法，以及连接到这些存储桶。最后，我们将重点关注基于域名和子域名的自动化方法，以识别多个地区中易受攻击的S3存储桶，并探测它们的权限，以找到潜在的易受攻击的存储桶。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Setting up our first S3 bucket
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置我们的第一个S3存储桶
- en: Exploring AWS S3 permissions and the access API
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索AWS S3权限和访问API
- en: Reading and writing from a vulnerable S3 bucket
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从一个易受攻击的S3存储桶中读取和写入
- en: Setting up your first S3 bucket
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置您的第一个S3存储桶
- en: 'We will start by heading over to the S3 home page at [https://s3.console.aws.amazon.com/s3/](https://s3.console.aws.amazon.com/s3/):'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先前往S3主页，网址为[https://s3.console.aws.amazon.com/s3/](https://s3.console.aws.amazon.com/s3/)：
- en: 'On the S3 home page, click on Create bucket:'
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在S3主页上，点击“创建存储桶”：
- en: '![](img/1dc4faa2-77a1-43cb-9e8f-b428492b0973.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1dc4faa2-77a1-43cb-9e8f-b428492b0973.png)'
- en: 'In the next page, assign your bucket a name:'
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在下一页上，为您的存储桶分配一个名称：
- en: '![](img/4cf3f66c-8970-47c8-8d2d-4fd9647845c7.png)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4cf3f66c-8970-47c8-8d2d-4fd9647845c7.png)'
- en: 'When assigning the name of the bucket, you must follow these guidelines:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在分配存储桶名称时，您必须遵循以下准则：
- en: Use a unique and **Domain Name System** (DNS)-compliant bucket name for your
    S3 bucket.
  id: totrans-14
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为您的S3存储桶使用唯一的、符合**域名系统**（DNS）的名称。
- en: Bucket names must be a minimum of 3 characters and a maximum of 63 characters.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储桶名称必须至少为3个字符，最多为63个字符。
- en: Uppercase characters or underscores are not allowed.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不允许使用大写字符或下划线。
- en: Bucket names can either start with a lowercase letter or a number.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储桶名称可以以小写字母或数字开头。
- en: Bucket names can contain lowercase letters, numbers, and hyphens. The bucket
    name can also be separated based on labels using the (.) character.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存储桶名称可以包含小写字母、数字和连字符。存储桶名称也可以根据标签使用（.）字符进行分隔。
- en: Do not format bucket names in the form of an IP address (for example, `172.16.1.3`).
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要以IP地址的形式格式化存储桶名称（例如，`172.16.1.3`）。
- en: You can choose the geographic region if you wish to; we are naming our bucket `kirit-bucket`.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果愿意，您可以选择地理区域；我们将为我们的存储桶命名为`kirit-bucket`。
- en: 'Click on Create bucket and your bucket will be created:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“创建存储桶”，您的存储桶将被创建：
- en: '![](img/9efae629-3897-48ba-b40f-19298bf21256.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9efae629-3897-48ba-b40f-19298bf21256.png)'
- en: Once the bucket is up and running, you should be able to upload objects to the
    bucket. In case you are wondering what an object is, it can be any file, such
    as image files, music files, video files, or documents.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦存储桶启动运行，您应该能够上传对象到存储桶中。如果你想知道对象是什么，它可以是任何文件，比如图像文件、音乐文件、视频文件或文档。
- en: 'To upload an object, click on the bucket and select Upload:'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要上传一个对象，点击存储桶并选择“上传”：
- en: '![](img/51ea0628-a832-4384-ad3d-b2d883feee82.png)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![](img/51ea0628-a832-4384-ad3d-b2d883feee82.png)'
- en: A file browser will open and you can upload any file that you want.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 文件浏览器将打开，您可以上传任何您想要的文件。
- en: 'To download an object, simply tick the checkbox of the object, and then choose
    Download:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要下载一个对象，只需勾选对象的复选框，然后选择“下载”：
- en: '![](img/d561c3c4-0852-4687-bc83-cd978f8742fe.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d561c3c4-0852-4687-bc83-cd978f8742fe.png)'
- en: S3 permissions and the access API
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: S3权限和访问API
- en: S3 buckets have two permission systems. The first is **access control policies**
    (**ACPs**), which are primarily used by the web UI. This is a simplified permission
    system that provides a layer of abstraction for the other permission system. Alternatively,
    we have **IAM access policies**, which are JSON objects that give you a granular
    view of permissions.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: S3存储桶有两种权限系统。第一种是**访问控制策略**（**ACPs**），主要由Web UI使用。这是一个简化的权限系统，为其他权限系统提供了一层抽象。另外，我们有**IAM访问策略**，这是给您提供权限的JSON对象。
- en: Permissions apply either to a bucket or an object. Bucket permissions are like
    the master key; in order to provide someone access to an object, you need to provide
    them access to a bucket first, and then the individual objects themselves.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 权限适用于存储桶或对象。存储桶权限就像主钥；为了让某人访问对象，您需要先让他们访问存储桶，然后再让他们访问对象本身。
- en: S3 bucket objects can be accessed from the WebGUI, as we saw earlier. Otherwise,
    they can be accessed from the AWS command-line interface (**CLI**) using the `aws
    s3` cmdlet. You can use it to upload, download, or delete bucket objects.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: S3存储桶对象可以从WebGUI访问，就像我们之前看到的那样。否则，它们可以使用`aws s3` cmdlet从AWS命令行界面（**CLI**）访问。您可以使用它来上传、下载或删除存储桶对象。
- en: 'In order to upload and download objects using the AWS CLI, we can take the
    following approach:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用AWS CLI上传和下载对象，我们可以采取以下方法：
- en: 'Start by installing `awscli`:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先安装`awscli`：
- en: '[PRE0]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Configure `awscli` with the new user credential. For this, we will need the
    access key ID and the secret access key. To get these, follow this procedure:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用新用户凭证配置`awscli`。为此，我们需要访问密钥ID和秘密访问密钥。要获取这些信息，请按照以下步骤进行：
- en: Log in to your AWS Management Console
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到您的AWS管理控制台
- en: Click on your username at the top-right of the page
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击页面右上角的用户名
- en: Click on the Security Credentials link from the drop-down menu
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从下拉菜单中点击“安全凭证”链接
- en: Find the Access Credentials section, and copy the latest access key ID
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到“访问凭证”部分，并复制最新的访问密钥ID
- en: Click on the Show link in the same row, and copy the secret access key
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击同一行中的“显示”链接，并复制“秘密访问密钥”
- en: 'Once you have acquired these, issue the following command:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您获得了这些，发出以下命令：
- en: '[PRE1]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Enter your access key ID and secret access key. Remember to not make this public
    to ensure your accounts are safe. You may leave your default region and output
    format set to none.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 输入您的访问密钥ID和秘密访问密钥。请记住不要公开此信息，以确保您的帐户安全。您可以将默认区域和输出格式设置为无。
- en: 'Once your account has been set up, it is very easy to access the contents of
    the S3 bucket:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您的帐户设置好了，就可以非常容易地访问S3存储桶的内容：
- en: '[PRE2]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '`kirit-bucket` in the preceding code will be replaced by your bucket name.'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码中，`kirit-bucket`将被替换为您的存储桶名称。
- en: 'If you want to traverse directories inside a bucket, simply put `/` followed
    by the directory named listed from the preceding output, for example, if we have
    a folder named `new`:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果要在存储桶内遍历目录，只需在前面的输出中列出的目录名称后面加上`/`，例如，如果我们有一个名为`new`的文件夹：
- en: '[PRE3]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To upload a file to the S3 bucket, issue the `cp` cmdlet, followed by the filename
    and the destination bucket with full file path:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要将文件上传到S3存储桶，发出`cp`命令，后跟文件名和目标存储桶的完整文件路径：
- en: '[PRE4]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'To delete a file on the S3 bucket, issue the `rm` cmdlet followed by the full
    file path:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在S3存储桶上删除文件，发出`rm`命令，后跟完整的文件路径：
- en: '[PRE5]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: ACPs/ACLs
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ACPs/ACLs
- en: The idea of **access control lists** (**ACLs**) is very similar to the firewall
    rules that can be used to allow access to an S3 bucket. Each S3 bucket has an
    ACL attached to it. These ACLs can be configured to provide an AWS account or
    group access to an S3 bucket.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**访问控制列表**（**ACLs**）的概念与可用于允许访问S3存储桶的防火墙规则非常相似。每个S3存储桶都附有ACL。这些ACL可以配置为向AWS帐户或组提供对S3存储桶的访问权限。'
- en: 'There are four main types of ACLs:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 有四种主要类型的ACLs：
- en: '**read**: An authenticated user with read permissions will be able to view
    filenames, size, and the last modified information of an object within a bucket.
    They may also download any object that they have access to.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**读取**：具有读取权限的经过身份验证的用户将能够查看存储桶内对象的文件名、大小和最后修改信息。他们还可以下载他们有权限访问的任何对象。'
- en: '**write**: An authenticated user has the permission to read as well as delete
    objects. A user may also be able to delete objects they don''t have permissions
    to; additionally, they can upload new objects.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**写入**：经过身份验证的用户有权限读取和删除对象。用户还可以删除他们没有权限的对象；此外，他们可以上传新对象。'
- en: '**read-acp**: An authenticated user can view the ACLs of any bucket or object
    they have access to.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**read-acp**：经过身份验证的用户可以查看他们有权限访问的任何存储桶或对象的ACL。'
- en: '**write-acp**: An authenticated user can modify the ACL of any bucket or object
    they have access to.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**write-acp**：经过身份验证的用户可以修改他们有权限访问的任何存储桶或对象的ACL。'
- en: An object can only have a maximum of 20 policies in a combination of the preceding
    four types for a specific grantee. A grantee is referred to any individual AWS
    account (that is, email address) or a predefined group. IAM accounts cannot be
    considered as a grantee.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 一个对象最多只能有20个策略，这些策略是前面四种类型的组合，针对特定的受让人。受让人是指任何个人AWS帐户（即电子邮件地址）或预定义组。IAM帐户不能被视为受让人。
- en: Bucket policies
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 存储桶策略
- en: Each S3 bucket has bucket policies attached to it that can be applied to both
    the bucket and the objects inside it. In case of multiple buckets, the policies
    can be easily replicated. Policies can be applied to individual folders by specifying
    a resource such as `"data/*"`. This will apply the policy to each object in a
    folder.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 每个S3存储桶都附有存储桶策略，可以应用于存储桶内和其中的对象。在多个存储桶的情况下，可以轻松复制策略。可以通过指定资源（例如"data/*"）将策略应用于单个文件夹。这将使策略适用于文件夹中的每个对象。
- en: 'You can add a policy to your S3 bucket using the web UI. The action is under
    the Permissions tab of the bucket Properties page:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用Web UI向S3存储桶添加策略。该操作位于存储桶属性页面的权限选项卡下：
- en: '![](img/927e293d-ef4a-4b0d-b214-b2dcf6080278.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/927e293d-ef4a-4b0d-b214-b2dcf6080278.png)'
- en: Next, we will see how bucket access can be configured for IAM users.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将看到如何为IAM用户配置存储桶访问权限。
- en: IAM user policies
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: IAM用户策略
- en: In order to provide S3 access to individual IAM accounts, we can use IAM user
    policies. They are a very easy way to provide restricted access to any IAM account.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 为了向单个IAM帐户提供S3访问权限，我们可以使用IAM用户策略。这是一种为任何IAM帐户提供受限访问权限的非常简单的方法。
- en: IAM user policies come in handy when an ACL permission must be applied to one
    specific IAM account. If you are wondering whether to use IAM or a bucket policy,
    a simple rule of thumb is to determine whether the permissions are for specific
    users across a number of buckets, or if you have multiple users, each needing
    their own set of permissions. In such a scenario, IAM policies are much better
    suited than bucket policies, as bucket policies are limited to only 20 KB.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: IAM用户策略在必须将ACL权限应用于特定IAM帐户时非常方便。如果您在犹豫是使用IAM还是存储桶策略，一个简单的经验法则是确定权限是针对多个存储桶中的特定用户，还是您有多个用户，每个用户都需要自己的权限集。在这种情况下，IAM策略比存储桶策略更合适，因为存储桶策略仅限于20
    KB。
- en: Access policies
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 访问策略
- en: Access policies are fine-grained permissions that describe permissions granted
    to any user on an object or bucket. They are described in JSON format and can
    be divided into three main sections: `"Statement"`, `"Action"`, and `"Resource"`.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 访问策略是描述授予任何用户对对象或存储桶的权限的细粒度权限。它们以JSON格式描述，并可分为三个主要部分：“Statement”、“Action”和“Resource”。
- en: 'Here is an example of a bucket policy in JSON:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是JSON格式的存储桶策略示例：
- en: '[PRE6]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The JSON object has three main parts. First, within the `"Statement"` section,
    we can see there are two points to note – `"Effect":"Allow"`, and the `"Principal"`
    section containing `"AWS":"arn:aws:iam::Account-ID:user/kirit"`. This essentially
    means that the `"kirit"` user account is being granted permissions to an object.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: JSON对象有三个主要部分。首先，在“Statement”部分中，我们可以看到有两点需要注意——“Effect”：“Allow”，以及包含“AWS”：“arn:aws:iam::Account-ID:user/kirit”的“Principal”部分。这基本上意味着“kirit”用户帐户被授予对对象的权限。
- en: Second, is the `"Action"` section, which describes what permissions are being
    allowed to the user. We can see the user is allowed to list objects inside the
    `"s3:ListBucket"` bucket, and download objects from the `"s3:GetObject"` bucket.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 其次是“操作”部分，描述了用户被允许的权限。我们可以看到用户被允许列出“s3:ListBucket”存储桶内的对象，并从“s3:GetObject”存储桶下载对象。
- en: Finally, the `Resource` part describes on which resource the permissions are
    being granted. To put it all together, the policy summarizes to allow the `kirit`
    user account to `GetBucketLocation`, `ListBucket`, and `GetObject` under the bucket
    named `kirit-bucket`.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，“资源”部分描述了授予权限的资源。综合起来，策略总结为允许“kirit”用户帐户在名为“kirit-bucket”的存储桶下“GetBucketLocation”、“ListBucket”和“GetObject”。
- en: Creating a vulnerable S3 bucket
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建易受攻击的S3存储桶
- en: For our next exercise, we will try to read and write from a vulnerable S3 bucket
    that has been made public to the entire world. In order to do this, we will set
    up an S3 bucket and intentionally make it vulnerable my making it publicly readable
    and writeable.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个练习中，我们将尝试从一个对整个世界公开的易受攻击的S3存储桶中读取和写入。为此，我们将设置一个S3存储桶，并故意使其易受攻击，使其可以公开读取和写入。
- en: 'We will start by heading over to the S3 home page ([https://s3.console.aws.amazon.com/s3/](https://s3.console.aws.amazon.com/s3/))
    and creating a vulnerable bucket that is publicly accessible:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先转到S3主页（[https://s3.console.aws.amazon.com/s3/](https://s3.console.aws.amazon.com/s3/)）并创建一个可以公开访问的易受攻击的存储桶：
- en: Create a new S3 bucket.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的S3存储桶。
- en: 'Once the bucket has been created, select the bucket and click on Edit public
    access settings for selected buckets:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存储桶创建后，选择存储桶，然后单击“编辑所选存储桶的公共访问设置”：
- en: '![](img/23277051-ffc6-4fce-bbce-81b192ca9937.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![](img/23277051-ffc6-4fce-bbce-81b192ca9937.png)'
- en: 'Unselect all the checkboxes and click on Save. This is done in order to remove
    any access restrictions that have been enforced on a bucket:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消选中所有复选框，然后单击保存。这样做是为了删除对存储桶施加的任何访问限制：
- en: '![](img/f0ce3d4e-6436-45c3-b4e8-d25a1a4b6f91.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f0ce3d4e-6436-45c3-b4e8-d25a1a4b6f91.png)'
- en: 'AWS will ask you to confirm the changes; type `confirm` into the field and
    click on Confirm:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: AWS将要求您确认更改；在字段中键入“confirm”并单击确认：
- en: '![](img/2f86b4ed-4524-497b-ae0e-90b12e309d0c.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2f86b4ed-4524-497b-ae0e-90b12e309d0c.png)'
- en: 'Click on the bucket, and then on the side panel, click on the Permissions tab:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击存储桶，然后在侧边栏上单击“权限”选项卡：
- en: '![](img/6e717c5b-5a5c-47c9-a864-c37649115a33.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6e717c5b-5a5c-47c9-a864-c37649115a33.png)'
- en: 'Go to Access Control List, and under Public Access, click on Everyone. A side
    panel will open; enable all the checkboxes. This tells AWS to allow public access
    to the bucket; this is what makes the bucket vulnerable:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到访问控制列表，在公共访问下，单击“所有人”。侧边栏将打开；启用所有复选框。这告诉AWS允许公共访问存储桶；这就是使存储桶容易受攻击的原因：
- en: '![](img/b7cd2860-4115-46e8-9db1-2896bce2b972.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![](img/b7cd2860-4115-46e8-9db1-2896bce2b972.png)'
- en: Click on Save and the bucket will be made public.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单击保存，存储桶将变为公开。
- en: 'Now that we have our vulnerable bucket, we can upload some objects to it and
    make them public; for example, we upload a small text file to the bucket as follows:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了易受攻击的存储桶，我们可以将一些对象上传到其中并使它们公开；例如，我们将一个小文本文件上传到存储桶中：
- en: Create a small text document.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个小文本文档。
- en: 'Enter your bucket and click on Upload:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您的存储桶并单击上传：
- en: '![](img/be799896-8559-499b-8db0-ad538f1f03a9.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](img/be799896-8559-499b-8db0-ad538f1f03a9.png)'
- en: Select the file and upload it.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择文件并上传。
- en: 'Once the file has been uploaded, click on the object, and you will receive an
    S3 URL to access the object from the outside. You can simply point your browser
    to the URL in order to access the bucket:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 文件上传后，单击对象，您将收到一个S3 URL，以从外部访问对象。您可以简单地将浏览器指向URL以访问存储桶：
- en: '![](img/d9e96639-a59e-4eb3-9ff3-03eef463745d.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d9e96639-a59e-4eb3-9ff3-03eef463745d.png)'
- en: The Object URL link is located at the bottom of the page, as demonstrated in
    the preceding screenshot.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 对象URL链接位于页面底部，如前面的屏幕截图所示。
- en: Our vulnerable S3 bucket has now been set up and made accessible to the public;
    anyone can read or write to this bucket.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的易受攻击的S3存储桶现在已经设置并对公众开放；任何人都可以读取或写入该存储桶。
- en: In the next chapter, we will learn how to identify such vulnerable buckets and
    exfiltrate data using AWSBucketDump.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何识别此类易受攻击的存储桶，并使用AWSBucketDump外部传输数据。
- en: Summary
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we have learned about what S3 buckets are, how to set up S3
    buckets, and how access rights are granted on an S3 bucket. We learned about S3
    permissions in detail, as well as how and where each kind of permission is applicable.
    We walked through how to set up the AWS CLI and access the S3 bucket via the CLI.
    We also learned about the kind of settings that can make an S3 bucket vulnerable.
    And finally, we set up our own vulnerable S3 bucket, which we will be using in
    the next chapter.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了什么是S3存储桶，如何设置S3存储桶以及如何在S3存储桶上授予访问权限。我们详细了解了S3权限，以及每种权限适用的方式和位置。我们演示了如何设置AWS
    CLI并通过CLI访问S3存储桶。我们还了解了可以使S3存储桶易受攻击的设置类型。最后，我们设置了我们自己的易受攻击的S3存储桶，这将在下一章中使用。
- en: In the next chapter, we will learn how to exploit S3 buckets. We will look into
    the tools that are used to exploit a vulnerable S3 bucket. And, we will learn
    various post-exploitation techniques that we can apply after exploiting a vulnerable
    S3 bucket.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习如何利用S3存储桶。我们将研究用于利用易受攻击的S3存储桶的工具。此外，我们将学习在利用易受攻击的S3存储桶后可以应用的各种后利用技术。
- en: Further reading
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: '**Amazon S3 REST API Introduction**: [https://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html](https://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html)'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Amazon S3 REST API介绍**：[https://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html](https://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html)'
- en: '**Amazon S3 Examples**: [https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-examples.html](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-examples.html)'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Amazon S3示例**：[https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-examples.html](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-examples.html)'
- en: '**Specifying Permissions in a Policy**: [https://docs.aws.amazon.com/AmazonS3/latest/dev/using-with-s3-actions.html](https://docs.aws.amazon.com/AmazonS3/latest/dev/using-with-s3-actions.html)'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在策略中指定权限：[https://docs.aws.amazon.com/AmazonS3/latest/dev/using-with-s3-actions.html](https://docs.aws.amazon.com/AmazonS3/latest/dev/using-with-s3-actions.html)
