- en: Firewall Placement and Detection Techniques
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙部署和检测技术
- en: In the previous chapter, we learned all about SSL. We also explored how SSL
    provides the authentication, confidentiality, and integrity to achieve transport
    layer security.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们学习了有关SSL的所有内容。我们还探讨了SSL如何提供认证、机密性和完整性，以实现传输层安全性。
- en: 'This chapter provides a brief overview of firewall technology, looking at its
    placement in a network and the services it offers. In this chapter, you will explore
    a different generation of firewalls and use cases. You will also learn where a
    firewall fits into a network and what it can and cannot do. Furthermore, the chapter
    covers the basics of TCP/IP, Traceroute, scanner tools, setting up firewalls,
    testing, the best practices to maintain firewalls, and much more. We will be covering
    the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章简要概述了防火墙技术，介绍了防火墙在网络中的部署及其提供的服务。在本章中，您将探讨不同一代的防火墙及其应用场景。您还将了解防火墙在网络中的作用，以及它能做什么和不能做什么。此外，本章还涵盖了TCP/IP、Traceroute、扫描工具、防火墙设置、测试、维护防火墙的最佳实践等内容。我们将讨论以下主题：
- en: Firewall and design considerations
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防火墙和设计考虑因素
- en: DMZ secure design
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DMZ安全设计
- en: TCP/IP & OSI model
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TCP/IP与OSI模型
- en: Firewall performance, capabilities, and functions
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防火墙性能、能力和功能
- en: Technical requirements
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: You will need a Unix or Linux machine with hping installation, as well as a
    basic knowledge of TCP/IP, firewalls and IP communication.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要一台安装了hping的Unix或Linux机器，并具备TCP/IP、防火墙和IP通信的基础知识。
- en: Firewall and design considerations
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙和设计考虑因素
- en: Security is the most important consideration for any secure network design.
    There are many ways to secure the network, and firewall techniques are one of
    the most important ways to implement network security.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 安全性是任何安全网络设计中最重要的考虑因素。有许多方法可以确保网络安全，而防火墙技术是实现网络安全的最重要手段之一。
- en: 'The term *firewall* was in use as early as 1764 to describe walls that isolate
    the parts of a building most likely to have a fire (for example, a kitchen) from
    the rest of a structure. There are two types of firewalls: one is based on hardware,
    and the second is based on software. Hardware-based firewalls are dedicated hardware
    units used to protect a piece of network or segment, while software-based firewalls
    run on top of the operating system to protect host machines.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '*防火墙*这个术语早在1764年就已使用，描述的是将建筑物中最容易发生火灾的部分（例如厨房）与建筑的其他部分隔离开的墙壁。防火墙有两种类型：一种基于硬件，另一种基于软件。硬件防火墙是专用硬件设备，用于保护网络的一部分或一个区段，而软件防火墙则运行在操作系统之上，用于保护主机。'
- en: A firewall protection strategy totally depends on the expertise of a firewall
    administrator and the efficiency of firewall hardware. Security rules and management
    policies are the most critical tasks for access control policies. IP communication
    is based on five basic tuples, and for each firewall rule you need a valid source
    address, destination address, source port, destination port, and transport protocol
    TCP or UDP, along with action or rejection permits.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙保护策略完全依赖于防火墙管理员的专业知识和防火墙硬件的效率。安全规则和管理策略是访问控制策略中最关键的任务。IP通信基于五个基本元组，对于每条防火墙规则，您需要一个有效的源地址、目标地址、源端口、目标端口和传输协议（TCP或UDP），以及允许或拒绝的操作。
- en: The most commonly implemented solution for enterprise is based on the combination
    of firewall technologies such as packet filtering, **Virtual Private Network**
    (**VPN**) and **Network Address Translation** (**NAT**).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 企业最常实施的解决方案是基于防火墙技术的组合，如数据包过滤、**虚拟私人网络**（**VPN**）和**网络地址转换**（**NAT**）。
- en: Firewall terminology
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙术语
- en: 'Before we discuss firewalls in detail, you must understand the basic terminology:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在详细讨论防火墙之前，您必须理解基本术语：
- en: '**IP Address**: An IP address is a host identity on the internet through which
    reachability is achieved via a routing protocol between networks. There are two
    types of IP address available—IPv4  (32 bit with class A, B, C, or D) and IPv6
    (128 bit with unicast address, any cast address, or multicast address). For example,
    IPv4: `200.10.20.1` and IPv6: `2001:0db8:85a3:0000:0000:8a2e:0370:7334`'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IP地址**：IP地址是互联网上主机的身份，通过路由协议在网络之间实现可达性。有两种类型的IP地址：IPv4（32位，分为A、B、C或D类）和IPv6（128位，具有单播地址、任播地址或多播地址）。例如，IPv4：`200.10.20.1`，IPv6：`2001:0db8:85a3:0000:0000:8a2e:0370:7334`。'
- en: '**Ports**:Any application that is hosted on an operating system makes its service
    available on a network using standard ports. When accessing any application on
    the internet, a dynamic port is opened on source and a standard known port for
    destination. For example, HTTP uses port `80`, FTP uses port `22`, and Telnet
    uses port `23`.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**端口**：任何托管在操作系统上的应用程序都会通过标准端口在网络上提供服务。当访问互联网上的任何应用程序时，源端口会打开一个动态端口，而目标端口则使用标准已知端口。例如，HTTP使用端口`80`，FTP使用端口`22`，Telnet使用端口`23`。'
- en: '![](Images/96d151d4-9c66-4d69-948c-f411b60c9959.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/96d151d4-9c66-4d69-948c-f411b60c9959.png)'
- en: '**Protocol**: A protocol is a standard method and mutual agreement for exchanging
    data over a network host on a local area network, internet, intranet, and WAN.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**协议**：协议是用于在本地网络、互联网、内部网和广域网中的网络主机间交换数据的标准方法和相互协议。'
- en: '**Tuples**: The term 5-tuple refers to the five items (source and destination
    IP, source and destination port, and protocol) in any given IP packet. The firewall
    policy uses these tuples to define the firewall rule of whether to block or allow
    traffic.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**元组**：5-元组这个术语指的是在任何给定的IP数据包中包含的五个项（源和目标IP、源和目标端口、协议）。防火墙策略使用这些元组来定义防火墙规则，决定是否阻止或允许流量。'
- en: Firewall generations
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙的代际发展
- en: A firewall is a network security device that monitors and controls all incoming
    and outgoing network traffic based on a defined and advanced set of security rules.
    Let's discuss the evolution of firewalls and their capabilities.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙是一种网络安全设备，基于一套定义明确且高级的安全规则，监控和控制所有进出网络的流量。让我们讨论一下防火墙的发展历程及其功能。
- en: '**Packet filtering: **First-generation firewalls—these are relatively less
    expensive with a simple filter function called static packet filtering, also referred
    to as stateless firewalls. In firewall terminology, *stateless* refers to rule
    inspection in both directions in and out; hence, the firewall unit does not maintain
    any session or connection state.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据包过滤**：第一代防火墙——这些防火墙相对便宜，采用一种简单的过滤功能，称为静态数据包过滤，也被称为无状态防火墙。在防火墙术语中，*无状态*指的是对进出流量进行规则检查，因此，防火墙设备不会保持任何会话或连接状态。'
- en: 'Basically, packet filtering is performed at Layer 3 (IP) and Layer 4 (Transport)
    by matching the header fields of the packet against four tuples: source and destination
    IP address, and ports and transport protocol (TCP/UDP). A good example would be
    to relate this to a router and an access control list to control traffic going
    in and out.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 基本上，数据包过滤在第3层（IP层）和第4层（传输层）执行，通过将数据包的头部字段与四个元组进行匹配：源和目标IP地址、端口和传输协议（TCP/UDP）。一个好的例子是将其与路由器和访问控制列表相联系，用于控制进出流量。
- en: In 1988, the **Digital Equipment Corporation** (**DEC**) developed the first firewall
    systems, known as packet filter firewalls. Basic packet filtering firewalls are
    vulnerable to IP spoofing as they do not maintain a connection state and can be
    exploited by attackers.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 1988年，**数字设备公司**（**DEC**）开发了第一个防火墙系统，称为数据包过滤防火墙。基础数据包过滤防火墙容易受到IP欺骗攻击，因为它们不维护连接状态，因此攻击者可以利用这一点进行攻击。
- en: '**Stateful firewalls :** Second-generation firewalls—these firewalls have the
    same capabilities as the first generation, but with the added ability to monitor
    and store the session along with the connection state. For any connection, packet
    matching works bidirectionally, which means  that a packet being sent is matched
    with the attribute of a returning packet, confirming that it belongs to the same
    packet flow. Unlike putting an access control list in a stateless device in both
    directions, the firewall allows the return packet based on the packet flow. It
    looks at the TCP header information for SYN, RST, ACK, and FIN to determine the
    state of the connection.'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**有状态防火墙**：第二代防火墙——这些防火墙具有与第一代相同的功能，但增加了监控和存储会话及连接状态的能力。对于任何连接，数据包匹配是双向的，这意味着发送的数据包与返回数据包的属性进行匹配，以确认它们属于同一个数据包流。与在无状态设备中双向放置访问控制列表不同，防火墙会根据数据包流的情况允许返回的数据包。它会查看TCP头部信息中的SYN、RST、ACK和FIN标志来确定连接的状态。'
- en: '**Application Gateway**: Third-generation firewalls—an application gateway
    firewall works based on deep packet inspection to understand the application (Layer
    7) and to act as a proxy between the server and client. Suspicious data and connections
    are dropped by these proxies. Since they are application aware, they can handle
    more complex protocols like web, H.323, SIP, FTP, SQL Net, and so on. The disadvantage
    of an application gateway is establishing proxy connectivity, which requires two
    steps to connect to either an inbound or outbound connection. In simple terms,
    the user needs to connect to the application firewall, rather than connecting
    directly with the host.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用网关**：第三代防火墙——应用网关防火墙基于深度数据包检查来理解应用程序（第七层），并充当服务器和客户端之间的代理。这些代理会丢弃可疑的数据和连接。由于它们了解应用程序，它们可以处理更复杂的协议，如
    Web、H.323、SIP、FTP、SQL Net 等。应用网关的缺点是建立代理连接需要两个步骤，才能连接到入站或出站连接。简单来说，用户需要连接到应用防火墙，而不是直接连接到主机。'
- en: '**Next-Generation Firewalls (NGFW)**:The core and backbone function for next-generation
    firewalls is **Deep Packet Inspection** (**DPI**), which comes with standard features
    like NAT, VPN, and content filtering. The DPI function allows the firewall to
    look deeply into the packet using protocol identification methods. These identifications
    are based on specific parameters of an application, rather than a port-based identification
    of applications. This can also block sophisticated cyberattacks based on IPS engines
    and signatures. Security policies or rules can be implemented based on application
    and network protocol.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**下一代防火墙（NGFW）**：下一代防火墙的核心功能是**深度数据包检查**（**DPI**），它包含像 NAT、VPN 和内容过滤这样的标准功能。DPI
    功能允许防火墙深入检查数据包，使用协议识别方法。这些识别基于应用程序的特定参数，而不是基于端口的应用程序识别。这也可以基于 IPS 引擎和签名阻止复杂的网络攻击。安全策略或规则可以基于应用程序和网络协议进行实施。'
- en: A very similar approach is being followed by SDN implementation, a controlled
    policy to block or allow traffic across multiple gateways installed in multiple
    locations. These policies are based on applications rather than being IP and port
    based. The flexibility we get means that we can centralize controllers and applications
    routed on the network.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: SDN 实现也在遵循类似的方法，通过控制策略来阻止或允许跨多个网关传输的流量，这些网关安装在不同位置。这些策略是基于应用程序的，而不是基于 IP 和端口的。我们获得的灵活性意味着我们可以集中控制器，并且可以在网络上路由应用程序。
- en: 'The different security services of the NGFW offering can work together to provide
    a higher level of security than **Stateful Packet Inspection** (**SPI**) firewalls,
    due to DPI capability:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 由于具有 DPI 功能，下一代防火墙（**NGFW**）提供的不同安全服务可以协同工作，从而提供比**有状态数据包检查**（**SPI**）防火墙更高的安全性：
- en: '![](Images/8add3e97-d20c-43c2-83b5-6388f2f0f7a5.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/8add3e97-d20c-43c2-83b5-6388f2f0f7a5.png)'
- en: Let's take a look at how to choose a firewall fit for business and performance
    criteria.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看如何选择一款适合企业和性能标准的防火墙。
- en: Firewall performance
  id: totrans-33
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙性能
- en: 'The performance of a ﬁrewall is tested under diﬀerent traﬃc loads when considering
    different metrics to evaluate the ﬁrewall performance. The metrics are as follows:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙的性能是在不同的流量负载下进行测试的，考虑到不同的度量标准来评估防火墙性能。具体的度量标准如下：
- en: '**Throughput**: This is the actual payload that is received per unit of time'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**吞吐量**：这是每单位时间接收到的实际负载'
- en: '**Delay**: This is the transit time for a packet to be transmitted from the
    source to the destination'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**延迟**：这是数据包从源头到目的地传输的时间'
- en: '**Jitter**: This measures the variation in delay of the received packets'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**抖动**：这是衡量接收数据包延迟变化的指标'
- en: '**Packet-loss-rate (PLR)**: This is the ratio of the lost packets to the total
    transmitted packets'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据包丢失率（PLR）**：这是丢失数据包与总传输数据包的比例'
- en: If you're upgrading your firewall or buying a new next-generation firewall,
    how do you select one that's appropriate for your business? Vendors will always
    tell you how great their firewall product is and downplay others, so it would
    be difficult to approach them directly for advice.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在升级防火墙或购买新的下一代防火墙，如何选择适合您业务的防火墙？供应商总是告诉您他们的防火墙产品有多好，并贬低其他产品，因此很难直接向他们寻求建议。
- en: You should first determine a list of features and a level of performance, then
    decide what extended functionality or feature you would like to have on top of
    that. Of course, you should also consider budget.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该首先确定一个功能列表和性能水平，然后决定你希望在其基础上添加什么扩展功能或特性。当然，你还应该考虑预算。
- en: '**Security consideration questions**:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '**安全性考虑问题**：'
- en: Is traffic always being scanned in both directions?
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 流量是否始终在两个方向上进行扫描？
- en: Are all ports left open by default?
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有端口默认是否开放？
- en: Is deep packet inspection turned on by default?
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 深度包检测是否默认开启？
- en: Can IPS and application control run together?
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IPS 和应用控制可以一起运行吗？
- en: '**Management consideration question**:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**管理性考虑问题**：'
- en: Is an event analysis dashboard provided?
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是否提供事件分析仪表板？
- en: '**Performance consideration questions**:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '**性能考虑问题**：'
- en: Is the performance claimed by a vendor based on real traffic?
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 供应商所声称的性能是否基于真实流量？
- en: Is testing performed with a large number of security policies?
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 是否对大量安全策略进行过测试？
- en: '**Feature consideration question**:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**功能性考虑问题**：'
- en: Do I need a VPN?
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我需要 VPN 吗？
- en: What would be the throughput for my network?
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我的网络吞吐量是多少？
- en: Which license and size do I need for my network—SOHO or Enterprise?
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我需要什么样的许可证和规模——SOHO 还是企业版？
- en: Do I need high availability?
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我需要高可用性吗？
- en: Should I use a software appliance or a hardware appliance?
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我应该使用软件设备还是硬件设备？
- en: Does the firewall support virtualization and routing?
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防火墙是否支持虚拟化和路由？
- en: What is the total number of sessions?
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 会话的总数是多少？
- en: Is the SSL throughput and remote access connection provided by Firewall?
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防火墙是否提供 SSL 吞吐量和远程访问连接？
- en: These are a few sample questions. Based on the answers to these, you can choose
    the best firewall for your network.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是一些示例问题。根据这些问题的答案，你可以为你的网络选择最佳的防火墙。
- en: Firewall placement  and design network topology
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙位置和设计网络拓扑
- en: 'When we talk about firewall placement architecture, you have two options: a
    single firewall or a multilayer firewall.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们谈论防火墙部署架构时，你有两个选择：单一防火墙或多层防火墙。
- en: Single firewall architecture
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 单一防火墙架构
- en: The placement of a single firewall on a network depends upon a number of factors
    such as the number of IP subnets and services offered and hosted behind firewall.
    Let's take a look at a few scenarios.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 单一防火墙在网络中的位置取决于多个因素，如 IP 子网数量以及防火墙后面提供和托管的服务。我们来看几个场景。
- en: Single firewall architecture with a single IP subnet
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 单一防火墙架构与单一 IP 子网
- en: 'In the following diagram, a single firewall is placed under a WAN router and
    all traffic travels via this firewall. All servers are hosted on a single subnet
    and given equal security protection provided by the firewall, which provides isolation
    from the internet. A firewall having a single subnet may be justified when further
    isolation is not required between the servers and does not cause a significant
    risk:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下图示中，单一防火墙位于 WAN 路由器下方，所有流量都通过此防火墙传输。所有服务器都托管在单一子网中，并由防火墙提供平等的安全保护，从而实现与互联网的隔离。如果服务器之间不需要进一步的隔离，并且不造成重大风险，那么使用单一子网的防火墙可能是合理的：
- en: '![](Images/abfd57da-3b80-48ce-99f1-4e52230a035a.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/abfd57da-3b80-48ce-99f1-4e52230a035a.png)'
- en: Single firewall architecture with multiple IP subnets
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 单一防火墙架构与多个 IP 子网
- en: 'As shown in the diagram below, a simple way to isolate the network resources
    without introducing another set of firewalls is to use multiple interfaces configured
    with multiple subnets. In the design, the web, application and database servers
    are placed in different subnets using different IP subnets with different security
    levels configured on interfaces. Let''s assume that only one web server has to
    be exposed to the internet and the rest of the server will talk to the web server
    internally. This can be easily configured and controlled by inputting firewall
    rules. This can be achieved by exposing the web server to the internet and allowing
    an internet subnet policy. An attacker could only gain access to all subnets if
    a firewall is compromised due to a missed configuration:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 如下图所示，一种隔离网络资源的简单方法是在不引入另一套防火墙的情况下，使用配置了多个子网的多个接口。在这个设计中，Web、应用程序和数据库服务器被放置在不同的子网中，使用不同的
    IP 子网，并且在接口上配置了不同的安全级别。假设只有一台 Web 服务器需要暴露到互联网，其他服务器则通过内部网络与 Web 服务器通信。通过输入防火墙规则，可以轻松配置和控制这一点。通过将
    Web 服务器暴露到互联网并允许互联网子网策略，可以实现这一点。如果防火墙由于配置错误被攻破，攻击者可能会访问所有子网：
- en: '![](Images/d0704adb-d57e-47c3-b1e6-112378a0740e.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/d0704adb-d57e-47c3-b1e6-112378a0740e.png)'
- en: Multilayer firewall architecture
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多层防火墙架构
- en: 'The placement of multilayer firewall security is part of  the network security
    strategy. Keeping everything behind one firewall that offers all services can
    be risky and a single point of failure. Let''s take a look at the firewall sandwich
    security design to protect highly critical assets behind the multilayer security:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 多层防火墙安全布局是网络安全策略的一部分。将所有服务都放在一个防火墙后面可能存在风险，并且存在单点故障的隐患。让我们来看看防火墙沙拉安全设计，如何在多层安全保护下保护关键资产：
- en: Firewall sandwich design
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙沙拉设计
- en: 'You will often see a multi-tier firewall or sandwich design topology deployed
    by an enterprise network. Instead of interfaces being dedicated to different subnets,
    a separate firewall can also be dedicated to server roles. In such a design, applications
    based on roles are *sandwiched* between firewalls, and a dedicated firewall moderates
    communications between adjacent subnets according to the application''s architecture
    and security policy. The basic idea behind this architecture is to dedicate firewall
    roles for simple management and to look for the best size of hardware to support
    the amount of traffic expected on different application segments:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 企业网络中经常会部署多层防火墙或沙拉设计拓扑。与其将接口专门分配给不同的子网，不如为服务器角色配置独立的防火墙。在这种设计中，基于角色的应用被*夹在*防火墙之间，并且专用防火墙根据应用架构和安全策略调节相邻子网之间的通信。该架构的基本理念是为简单管理专门设置防火墙角色，并寻找支持不同应用段流量的硬件最佳规格：
- en: '![](Images/2d8b195a-1ede-4fbd-96eb-d2d8f0539040.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/2d8b195a-1ede-4fbd-96eb-d2d8f0539040.png)'
- en: Demilitarized Zone
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 非军事区
- en: '**Demilitarized Zone** (**DMZ**) is your front line, which protects valuables
    from direct exposure to an untrusted environment. In other words, a DMZ is generally
    a secure network segment that is exposed to the internet, where you keep valuable
    resources like a web server (the most common internet application) to enhance
    application security by adding an extra layer of security. It''s very important
    to carefully plan and design a DMZ because it may not be easy task to fix loopholes
    when handling production traffic.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '**非军事区**（**DMZ**）是你的前线，保护重要资产免受不信任环境的直接暴露。换句话说，DMZ通常是一个暴露于互联网的安全网络段，您可以在其中放置像web服务器这样的有价值资源（最常见的互联网应用），通过增加一层额外的安全性来增强应用程序的安全性。仔细规划和设计DMZ非常重要，因为在处理生产流量时，修复漏洞可能并非易事。'
- en: So how do you design a DMZ? Most of the time, an administrator puts the energy
    into securing and concentrating on DMZ security only and forgets about the rest
    of the internal data communications designed to access valuable information. Access
    to the DMZ from an internal application should be locked down as tightly as possible.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，如何设计DMZ呢？大多数时候，管理员会把精力集中在DMZ安全性上，**只关注**DMZ的安全，而忽略了内部数据通信的安全，这些通信用于访问有价值的信息。内部应用访问DMZ的路径应尽可能严格限制。
- en: DMZ to Internal Access Policy
  id: totrans-79
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DMZ到内部访问策略
- en: Internal systems hold valuable data and are not exposed directly to the internet,
    but a DMZ plays a proxy role in between. Just imagine that a DMZ server is compromised
    and the internal LAN is wide open. In this situation, attackers could find a way
    into your network.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 内部系统存储着重要数据，不直接暴露在互联网上，但DMZ在两者之间起到了代理作用。试想一下，如果DMZ服务器被攻破，而内部局域网又没有任何防护，在这种情况下，攻击者可能会找到进入网络的方式。
- en: Let's take a look at the example for setting up a web server in DMZ.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们来看一下在DMZ中设置web服务器的示例。
- en: You must set a baseline for what you want to protect and consider scalability,
    availability, and agility. You have the freedom to choose the number of firewalls
    for setting up a DMZ, but two firewalls would be a good start. With two firewalls,
    you can put front-line servers behind a perimeter firewall (DMZ) and internal
    resources under a different firewall.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须为您想要保护的内容设定一个基准，并考虑可扩展性、可用性和灵活性。您可以自由选择用于设置DMZ的防火墙数量，但两个防火墙是一个不错的起点。使用两个防火墙，您可以将前端服务器放置在外围防火墙（DMZ）后面，并将内部资源放置在另一个防火墙后面。
- en: You can also have multiple scenarios in this design. I will try to cover those
    as well. A web server can be configured using a private IP and further natted
    with public IP for internet readability. However, you can also configure public
    IP directly on a server. Web servers can be configured with dual NIC , FE NIC
    and BE NIC. A connection coming from the internet will be terminated on FE NIC,
    and a new connection will be made to access app and database servers. Since this
    is a web server, the only rule for port `80` or `443` is required on DMZ firewall.
    Port `1433` on Tier-1 firewall will allow a connection from web to app and database
    servers, assuming it is a SQL server.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个设计中，您还可以有多种场景。我会尽力覆盖这些场景。可以使用私有IP配置Web服务器，并通过NAT将其转换为公共IP以便互联网可访问。然而，您也可以直接在服务器上配置公共IP。Web服务器可以配置为双网卡，前端网卡（FE
    NIC）和后端网卡（BE NIC）。来自互联网的连接将终止于前端网卡，之后会建立新连接以访问应用程序和数据库服务器。由于这是一个Web服务器，DMZ防火墙只需要对端口`80`或`443`设置规则。Tier-1防火墙上的端口`1433`将允许Web与应用程序和数据库服务器之间的连接，假设它是一个SQL服务器。
- en: 'In this diagram, you can see that a new connection has been made for a web
    server on port `80` on public IP `2.2.2.2`. Once this connection hits the front-line
    firewall, the NAT rule will translate this connection to the real IP of the web
    server, which is `10.10.10.1`. The decision of whether single or dual interface
    IPs should be used in order to connect further to database servers will now depend
    upon the NIC design:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个图中，您可以看到已经为公共IP `2.2.2.2`上的Web服务器建立了一个新连接，端口为`80`。一旦该连接到达前端防火墙，NAT规则将把此连接转换为Web服务器的真实IP
    `10.10.10.1`。是否使用单一或双接口IP进一步连接数据库服务器，现将取决于网卡设计：
- en: '![](Images/f2159b32-5a4b-4de7-91f9-fa585b3593f6.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/f2159b32-5a4b-4de7-91f9-fa585b3593f6.png)'
- en: '**Do I really need dual NIC**?  This design is also possible when based on
    single or dual NIC. A dual NIC design is more secure, considering the fact that
    with a single NIC you might need to adjust the routing, switching, and NAT statement
    in order to talk between a private IP space. Dual NICs give an extra physical
    layer of separation to achieve higher security.'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '**我真的需要双网卡**吗？当基于单网卡或双网卡时，这种设计也是可行的。考虑到单网卡可能需要调整路由、交换和NAT语句以便在私有IP空间之间通信，双网卡设计更为安全。双网卡提供了额外的物理层隔离，从而实现更高的安全性。'
- en: Having said that, a DMZ is an important part of your network security architecture.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 话虽如此，DMZ是您网络安全架构中的一个重要部分。
- en: You need a way to expose services to the internet world, but in a controlled
    and secure manner. To create a DMZ  successfully, a proper understanding of access
    policies and configuration is required for firewall detection.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要一种方法将服务暴露给互联网世界，但需要以受控且安全的方式进行。要成功创建DMZ，需要对访问策略和防火墙检测配置有正确的理解。
- en: OSI model versus TCP/IP model
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: OSI模型与TCP/IP模型
- en: Before discussing how a firewall works, we must first understand how the different
    layers of a network interact. Network communication is based on a seven-layer
    model, and each layer has its own set of responsibilities in order to make the
    communication happen. Firewalls can operate on different layers in order to use
    different criteria to block or permit the traffic.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在讨论防火墙如何工作之前，我们必须首先了解网络中各个层级如何交互。网络通信基于七层模型，每一层都有自己的职责，以实现通信。防火墙可以在不同层级上运行，以使用不同的标准来阻止或允许流量。
- en: In general, a firewall is going to have to operate at the network layer (L3)
    and transport layer (L4). The upper layers are more like scanning for viruses
    in data payloads and doing deep packet inspection. The Layer-1 physical layer
    is basically just  a network connectivity requirement.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 一般来说，防火墙必须在网络层（L3）和传输层（L4）上运行。上层则更像是扫描数据负载中的病毒并进行深度包检测。第1层物理层基本上仅仅是网络连接的要求。
- en: TCP/IP, also known as the internet model developed by the **Department of Defense** (**DoD**),
    is a simplified and practical version of the **Open System Interconnection** (**OSI**)
    model (1984), which is based on a theoretical concept.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: TCP/IP，也被称为由**国防部**（**DoD**）开发的互联网模型，是一个简化且实用的**开放系统互联**（**OSI**）模型（1984年），该模型基于一个理论概念。
- en: 'The OSI model is based on server layers and its specific function. The following
    diagram shows layers along with their functions:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: OSI模型基于服务器层级及其具体功能。下图展示了各个层级及其功能：
- en: '![](Images/d8d22905-bc8a-46e8-b549-be5876d1e93a.png)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/d8d22905-bc8a-46e8-b549-be5876d1e93a.png)'
- en: 'The layers in the preceding diagram are as follows:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 前述图中的各个层级如下：
- en: '**Physical layer**: This layer connects networking nodes over physical media
    and encodes bits into electrical signals'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**物理层**：该层通过物理介质连接网络节点，并将比特编码为电信号。'
- en: '**Data Link layer**: This layer is responsible for error detection and flow
    control over physical media'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据链路层**：该层负责物理介质上的错误检测和流量控制。'
- en: '**Network layer**: This layer is responsible for IP routing, switching, and
    network IP addressing'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络层**：该层负责IP路由、交换和网络IP地址分配。'
- en: '**Transport layer**: This layer is responsible for transport protocol TCP/UDP
    and error handling'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**传输层**：该层负责传输协议TCP/UDP及错误处理。'
- en: '**Session layer**: This layer is responsible for connection establishment and
    data flow'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**会话层**：该层负责连接建立和数据流。'
- en: '**Presentation layer**: This layer is responsible for the standard format of
    data as well as encryption and decryption'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**表示层**：该层负责数据的标准格式，以及加密和解密。'
- en: '**Application layer**: This layer provides services directly to user application
    over the network to end users.'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**应用层**：该层提供直接面向用户应用程序的服务，供最终用户通过网络访问。'
- en: 'Let''s take a look at the difference between OSI and TCP/IP models. On the
    right hand side of the diagram, we can see that the TCP/IP model has four layers,
    including the network interface, internet, transport, and application layers. TCP/IP
    follows a top-to-bottom approach, and the OSI model follows a bottom-up approach.
    Of course, it appears simple due to a smaller number of layers:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看一下OSI模型和TCP/IP模型之间的区别。在图的右侧，我们可以看到TCP/IP模型有四层，包括网络接口层、互联网层、传输层和应用层。TCP/IP采用自上而下的方法，而OSI模型采用自下而上的方法。由于层数较少，这使得它看起来相对简单：
- en: '![](Images/4bc349cc-f7f2-4ae4-9bd0-487b82fc3310.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/4bc349cc-f7f2-4ae4-9bd0-487b82fc3310.png)'
- en: Firewall performance, capabilities, and function
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙的性能、功能和作用。
- en: 'So far, we have discussed the basic features of a firewall. There are many
    more functions that can be used for multiple purposes. Let''s list these below:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经讨论了防火墙的基本功能。还有许多其他功能可以用于多种用途。以下是这些功能：
- en: '**URL filtering**: Random web surfing  may expose your network to malware that
    can cause security risks to your organization. URL filtering is a way to limit
    access by comparing web traffic in a database to prevent employees from accessing
    unproductive URLs or contents.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**URL过滤**：随意上网可能会使网络暴露于恶意软件，从而对组织的安全性造成风险。URL过滤是一种通过比较网络流量与数据库中的数据来限制访问的方式，从而防止员工访问无效的URL或内容。'
- en: '**Antivirus and malware protection**: NGFW comes with an inbuilt antivirus
    engine and malware protection, which is capable of inspecting traffic along with
    malicious infected files.'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**病毒和恶意软件保护**：NGFW配备了内建的防病毒引擎和恶意软件保护，能够检查流量并发现恶意感染的文件。'
- en: '**Integrated IPS/IDS**: In a traditional enterprise network, the deployment
    of IPS/IDS is very common as a separate appliance. A next-generation firewall
    comes with an IPS/IDS module and can be enabled or disabled according to requirements.
    The biggest thing to consider is how much traffic we want to pass through the
    IPS/IDS device and that should be supported by these modules.'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**集成IPS/IDS**：在传统的企业网络中，IPS/IDS的部署通常作为独立设备。下一代防火墙配备了IPS/IDS模块，并可以根据需求启用或禁用。需要考虑的最大问题是我们希望通过IPS/IDS设备传输多少流量，并且这些模块应该支持该流量。'
- en: '**Quality of Service (QoS)**: QoS is a framework on a network to guarantee
    bandwidth ability for high-priority applications. Traffic can be classified based
    on DSCP packet marking, application port, source and destination IP, and deep
    packet detection to detect application based approaches.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**服务质量（QoS）**：QoS是一个网络框架，确保高优先级应用程序的带宽能力。流量可以根据DSCP包标记、应用端口、源和目标IP，以及深度包检测来进行分类，以检测基于应用的方法。'
- en: '**Remote Access (VPN)**: Instead of going to a separate unit for terminating
    a VPN, a firewall can be used for the same purpose. There are multiple versions
    of VPN— corporate HQ networks connectivity to their remote location is often built
    on site-to-site VPNs. Remote access VPNs  such as SSL, web VPN, and IPsec VPN
    Client allow individual  users to connect to the corporate network remotely.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**远程访问（VPN）**：通过防火墙代替专用设备来终止VPN连接是一个可行的方案。VPN有多个版本——企业总部与远程位置之间的连接通常基于站点到站点的VPN。远程访问VPN如SSL、Web
    VPN和IPsec VPN客户端允许个人用户远程连接企业网络。'
- en: '**High Availability (HA)**: This is a deployment in which two or more firewalls
    are placed into a group and their configuration is synchronized to prevent a single
    point of failure on a network. High availability can be achieved by putting firewall
    in active-passive mode or active-active mode by sharing traffic.'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**高可用性 (HA)**：这是一种将两个或更多防火墙放入同一组并同步其配置，以防止网络中的单点故障的部署方式。高可用性可以通过将防火墙置于活动-被动模式或活动-活动模式下，通过共享流量来实现。'
- en: '**Virtualization**: This is another important function or feature of a firewall
    to operate in a virtual context mode. Topology can be formed based on requirements,
    and context can operate in active-passive or active-active. This works best in
    a hosting environment where separation between customers is required. Please refer
    to the product documentation to check which features are supported in a virtualized
    environment.'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**虚拟化**：这是防火墙在虚拟化上下文模式下操作的另一个重要功能或特性。可以根据需求形成拓扑结构，并且上下文可以在活动-被动或活动-活动模式下运行。这在需要客户之间隔离的托管环境中效果最佳。请参考产品文档以查看哪些功能在虚拟化环境中受支持。'
- en: Firewall management
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防火墙管理
- en: Firewall protects the enterprise network and plays a critical role on perimeter
    defense. The majority of data breaches take place due to misconfiguration. Consequently,
    it becomes very important for enterprises to leave admin access in the hands of
    experts and not to leave security in auto-pilot mode. A real-time dashboard is
    absolutely required to monitor network firewall traffic continuously to identify
    and respond to threats before the damage is done.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙保护企业网络，并在外围防御中发挥关键作用。大多数数据泄露事件都是由于配置错误引起的。因此，企业必须将管理员访问权限交给专家，并避免将安全设置为自动驾驶模式。必须提供实时仪表盘，以便持续监控网络防火墙流量，在损害发生之前识别和响应威胁。
- en: 'There are couple of best practices that must be implemented to operate firewall
    properly:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 必须实施一些最佳实践，以确保防火墙的正常运行：
- en: '**Change control policy**: Firewall rules or policy changes are very dynamic
    in nature and are mostly inevitable when it comes to accommodating new changes
    in the infrastructure environment and responding to new threats or vulnerabilities.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**变更控制策略**：防火墙规则或策略变更本质上是非常动态的，并且在适应基础设施环境中的新变化或响应新威胁或漏洞时大多是不可避免的。'
- en: '**Perform periodic audit of the configurations**: Auditing is a requirement
    to keep firewall patches up to date and to make sure that a device is compliant
    with standards like SOX, PCI-DSS, and HIPAA.'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**定期审计配置**：审计是确保防火墙补丁保持最新并确保设备符合SOX、PCI-DSS和HIPAA等标准的要求。'
- en: '**Firewall rule consolidation and optimization**: Over time your firewalls
    will accumulate thousands of rules and policies, and many of these rules will
    become out of date or obsolete. This adds complexity to daily tasks, troubleshooting,
    and auditing, and may also cause performance issues to firewall appliances. It''s
    always recommended to consolidate rules in a group based on application and remove
    unused rules from policies.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**防火墙规则整合与优化**：随着时间的推移，防火墙将积累成千上万的规则和策略，其中许多规则会变得过时或废弃。这会增加日常任务、故障排除和审计的复杂性，并可能导致防火墙设备的性能问题。通常建议根据应用程序将规则整合成组，并从策略中移除未使用的规则。'
- en: '**Threat detection signature updates**: Threat detection is based on patterns
    found in an attack. In an ever growing internet environment, new threats are detected
    every day. Because of this, it becomes important to update signatures and fine
    tune policies to avoid false alarms.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**威胁检测签名更新**：威胁检测是基于攻击中发现的模式。在日益增长的互联网环境中，每天都会检测到新的威胁。因此，更新签名和微调策略以避免误报变得非常重要。'
- en: Application proxies
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 应用代理
- en: An application proxy (sometimes called an application-level gateway) often acts
    as a middle layer. These proxy applications are run on top of the firewall. The
    users connect the gateway using applications like Telnet, FTP, or web connect.
    Users are prompted to enter resources they want to access and are also asked to
    validate their credentials. After successful authentication, the gateway will
    establish a connection to a remote application and relay data between the application
    and end user. Since application gateways are application aware, it becomes very
    easy from a gateway management point of view. In a typical firewall, either ports
    will be closed or open, and policies are defined by the administrator.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 应用代理（有时称为应用层网关）通常作为中间层。这些代理应用程序运行在防火墙之上。用户通过 Telnet、FTP 或 Web 连接等应用程序连接网关。系统会提示用户输入要访问的资源，并要求验证其凭证。经过成功认证后，网关将建立与远程应用程序的连接，并在应用程序与最终用户之间转发数据。由于应用网关能够感知应用程序，因此从网关管理的角度来看，它变得非常容易。在典型的防火墙中，端口要么关闭，要么打开，且策略由管理员定义。
- en: 'In the following diagram, you can see that Tom will be authenticated against
    the rule configured as ALG firewall, which allows Tom to access an application
    running on `20.20.20.1` . All other connections will be denied:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在下图中，你可以看到 Tom 将根据配置为 ALG 防火墙的规则进行身份验证，这使得 Tom 可以访问运行在 `20.20.20.1` 上的应用程序。所有其他连接将被拒绝：
- en: '![](Images/80c1f1f8-9bc8-43a8-8e17-b1158088d634.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/80c1f1f8-9bc8-43a8-8e17-b1158088d634.png)'
- en: One of the biggest limitations of an application gateway is that it requires
    a separate application for each network service. Consequently, it is mandatory
    to check which services are supported with the firewall vendor. Another disadvantage
    of ALG is an additional processing overhead on each connection.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 应用网关的最大限制之一是它需要为每个网络服务提供一个单独的应用程序。因此，必须检查防火墙供应商支持哪些服务。ALG 的另一个缺点是每个连接都会增加额外的处理开销。
- en: Detecting firewalls
  id: totrans-126
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检测防火墙
- en: Firewalls secure small to large infrastructure networks from malicious attacks
    and unwanted traffic. But it would be wrong to assume that inputting a firewall
    will solve everything. Vulnerabilities are part of any hardware and software appliance. The
    biggest vulnerability is a misconfiguration of the firewall. A well-configured,
    architecturally designed, updated, and well-maintained firewall is almost impossible
    to penetrate.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙保护从小型到大型的基础设施网络免受恶意攻击和不必要的流量。但如果认为输入防火墙就能解决所有问题，那就是错误的。漏洞是任何硬件和软件设备的一部分。最大的漏洞是防火墙的配置错误。一个配置良好、结构设计合理、更新及时且维护得当的防火墙几乎是不可能被突破的。
- en: There are several methods available that can help you to detect the location
    of
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种方法可以帮助你检测位置
- en: the firewall. A very easy method to locate a firewall is through `traceroute`
    (Unix utility) or `tracert` (Windows utility).
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙。一个非常简单的方法来定位防火墙是通过 `traceroute`（Unix 工具）或 `tracert`（Windows 工具）。
- en: Let's take a brief look at the background of `traceroute` and how it works.
    People commonly say that traceroute uses ICMP, and this is partially true because
    ICMP is used for error message reporting. ICMP, UDP, and TCP are all Layer 4 protocols,
    and IP packets contain a field **Time To Live** (**TTL**). The TTL field is 8
    bit and can reach a maximum of 255 hops. Different operating systems use different
    values. For example, Windows 10 uses 128 by default. Here is quick way to find
    a default value and ping localhosts from a command prompt. Every time a packet
    passes via a router or L3 device, the TTL value decrements by 1.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们简要了解一下 `traceroute` 的背景以及它是如何工作的。人们通常说 traceroute 使用 ICMP，这部分是正确的，因为 ICMP
    用于错误消息报告。ICMP、UDP 和 TCP 都是第四层协议，IP 数据包包含一个字段 **生存时间（TTL）**。TTL 字段为 8 位，最大值为 255
    跳。不同的操作系统使用不同的值。例如，Windows 10 默认使用 128。这里有一种快速的方式可以从命令提示符查找默认值并 ping 本地主机。每当数据包通过路由器或
    L3 设备时，TTL 值会减少 1。
- en: '![](Images/ed087eca-383f-4783-85dc-41366afb525b.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/ed087eca-383f-4783-85dc-41366afb525b.png)'
- en: 'Here is a quick way to find the default value and ping localhosts from a command
    prompt. I did this on my Windows 10 machine. You can also get or adjust the value
    from a Windows registry:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一种快速的方式，可以从命令提示符查找默认值并 ping 本地主机。我是在我的 Windows 10 计算机上进行的。你也可以通过 Windows
    注册表获取或调整该值：
- en: '![](Images/e91d60f3-40b2-4d19-b4a6-67d91f2c2b9a.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/e91d60f3-40b2-4d19-b4a6-67d91f2c2b9a.png)'
- en: 'Let''s assume ICMP is open: take a look at traceroute results. I have taken
    this from an online trace portal, which shows that the last hop is `182.168.6.81`.
    After that, ICMP seems to be blocked by a firewall:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 假设 ICMP 是开放的：查看 traceroute 结果。我从一个在线 trace 门户获取了这个信息，显示最后一跳是 `182.168.6.81`。之后，ICMP
    似乎被防火墙阻止：
- en: '![](Images/ab05c506-3013-485c-82fe-a7cb5a48b8e7.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/ab05c506-3013-485c-82fe-a7cb5a48b8e7.png)'
- en: 'This is another trace which is not based on ICMP but TCP on port `80` and reaches
    the end server. When you compare both you can see that ICMP is being filtered
    by a firewall:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 这是另一个不基于 ICMP，而是基于端口 `80` 上的 TCP 的 traceroute，并到达最终的服务器。当您比较两者时，您可以看到 ICMP 被防火墙过滤：
- en: '![](Images/4ff69216-7a6b-4408-96d0-2bc33afb1cbf.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/4ff69216-7a6b-4408-96d0-2bc33afb1cbf.png)'
- en: In fact, no method is 100% accurate. They just provide you with more information
    so that you can guess  which machine is filtering packets more accurately.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，没有任何方法是 100% 准确的。它们只是为您提供更多信息，以便您可以更准确地猜测是哪台机器在过滤数据包。
- en: A very popular firewall Cisco ASA does not do TTL decrements by default, we
    have to do them manually to see the interfaces of ASA when doing traceroutes.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 一个非常流行的防火墙 Cisco ASA 默认不会执行 TTL 减少，我们必须手动执行这些操作，以便在进行 traceroutes 时查看 ASA 的接口。
- en: '**Firewalking** is a technique used to discover information about a remote
    network protected by a firewall. Firewalking uses a traceroute analysis in backend
    to determine whether or not a data packet can pass a destination host via a packet
    filtering appliance.'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '**Firewalking** 是一种用于发现受防火墙保护的远程网络信息的技术。Firewalking 在后台使用 traceroute 分析来确定数据包是否可以通过数据包过滤设备传递到目标主机。'
- en: 'The firewall fulfils a NAT/PAT function, and multiple applications can be served
    over one single public IP from the internet. You can see one public `20.20.20.10`,
    which is mapped with internal IPs on different port numbers. This is called a
    NAT operation and is performed by a firewall. This way you can create a network
    topology of remote networks:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 防火墙执行 NAT/PAT 功能，多个应用程序可以通过一个公共 IP 在互联网上提供服务。您可以看到一个公共 IP `20.20.20.10`，它与不同端口号上的内部
    IP 进行映射。这称为 NAT 操作，由防火墙执行。通过这种方式，您可以创建远程网络的网络拓扑：
- en: '![](Images/8c04116a-cee9-4d21-b6c3-9f914287bf7c.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/8c04116a-cee9-4d21-b6c3-9f914287bf7c.png)'
- en: Debugging tools
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 调试工具
- en: 'The following debugging tools are used:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下调试工具：
- en: '**ICMP ping scan**: When checking any device on a network, the first thing
    that comes to mind is to test ICMP-based scanning. The way it works is that you
    send an ICMP request packet and expect ICMP echo to reply. The basic idea behind
    this is to get the live host on the network and then launch a port scanner against
    those live hosts. Angry IP Scanner is a very popular tool used for network scanning.
    The problem with ICMP is a network administrator can block ICMP on the network
    or host layers. You can also easily create a script for an IP scanner which can
    scan IPs for their defined range.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ICMP Ping 扫描**：在检查网络中的任何设备时，第一个想到的通常是测试基于 ICMP 的扫描。其工作原理是发送一个 ICMP 请求包，并期待
    ICMP 回显回复。其基本思路是获取网络中的在线主机，然后针对这些在线主机启动端口扫描器。Angry IP Scanner 是一个非常流行的网络扫描工具。ICMP
    的问题在于网络管理员可以在网络或主机层阻止 ICMP。您还可以轻松创建一个 IP 扫描器脚本，扫描其定义范围内的 IP。'
- en: '**TCP ping scan**: We have learned that ICMP can be blocked and is therefore
    not very reliable nowadays. However, instead of using ICMP, a ping probe can be
    sent by a  remote host to a specific port by sending TCP syn. You will then get
    a reply as a TCP syn-ack. If you want to keep your application alive, this cannot
    be be blocked by the network administrator.'
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**TCP Ping 扫描**：我们已经了解到 ICMP 可能被阻止，因此现在并不非常可靠。然而，代替使用 ICMP，可以通过远程主机发送 TCP syn
    到特定端口来进行 ping 探测。然后，您将收到一个 TCP syn-ack 的回复。如果您希望保持您的应用程序在线，这将无法被网络管理员阻止。'
- en: '**Arp ping**: You can use utilities like NMAP for ping sweep, and if you use
    it on a local subnet, it uses an ARP Ping instead of ICMP. NMAP does this by default.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**ARP Ping**：您可以使用像 NMAP 这样的工具进行 Ping 扫描，如果您在本地子网使用它，它会使用 ARP Ping 而不是 ICMP。NMAP
    默认会这样做。'
- en: '**NAMP**: NAMP can do multiple things for you, starting with scanning a host.
    It can even detect the operating system of a remote host using the light capability
    of vulnerability scanning.'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**NAMP**：NAMP 可以为您做多项工作，从扫描主机开始。它甚至可以通过漏洞扫描的轻量级功能来检测远程主机的操作系统。'
- en: '**Hping**: Hping was mainly used as a security tool and can be used for firewall
    testing, port scanning, network testing, MTU discovery, advance traceroute,and
    OS fingerprinting. This tool gives you the ability to craft a packet. I am using
    the Ubuntu server, and you need to install the hping package:'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Hping**：Hping主要用作安全工具，可以用于防火墙测试、端口扫描、网络测试、MTU发现、进阶跟踪路由和操作系统指纹识别。该工具让你能够构造数据包。我正在使用Ubuntu服务器，并且需要安装hping包：'
- en: '![](Images/581eac22-0add-4f4f-a119-d3b3463c0cd7.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/581eac22-0add-4f4f-a119-d3b3463c0cd7.png)'
- en: 'Let''s look at how to run this tool in port scan mode. Syntax has an argument
    of 0-100 (port range to be scanned), -S (Send Syn Packet) and `4.2.2.2` (IP address
    for host) to be scanned. Results show that one port is opened for DNS and this
    is true, `4.2.2.2` is a DNS server and hence the result is as expected:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何在端口扫描模式下运行此工具。语法包含0-100（端口范围待扫描）、-S（发送SYN包）和`4.2.2.2`（待扫描主机的IP地址）作为参数。结果显示，DNS端口是开放的，这是正确的，`4.2.2.2`是一个DNS服务器，因此结果是预期的：
- en: '![](Images/b81c0597-393b-4f60-baa3-8c57c41b1a72.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/b81c0597-393b-4f60-baa3-8c57c41b1a72.png)'
- en: '**TCP connect scan**: TCP connect can be used as port scanning, a simpler form
    of probing a remote host. This involves a full TCP/IP connection, which is established
    with all TCP ports and one of the target hosts in an incremental manner. A TCP/IP
    is reliable as a protocol and such port scanning is a very reliable way to determine
    which TCP services are accessible on a given target host.'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**TCP连接扫描**：TCP连接可以用作端口扫描，这是一种更简单的探测远程主机的方式。此方法涉及到完整的TCP/IP连接，逐步与目标主机的所有TCP端口建立连接。TCP/IP作为协议是可靠的，因此这种端口扫描是一种非常可靠的方式，用于确定给定目标主机上哪些TCP服务是可访问的。'
- en: 'In this example, the `nmap` tool will try to connect to the remote host in
    two ways. The first way is through a syntax argument (`-sS`) , which means that
    a 3-way handshake will be completed. With the other method, an (`-sT`) tool will
    use an application like a  browser in the backend to connect to a remote host:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，`nmap`工具将尝试以两种方式连接到远程主机。第一种方式是通过语法参数（`-sS`），这意味着会完成一个三次握手。另一种方法是使用一个（`-sT`）工具，像浏览器这样的应用程序在后台连接到远程主机：
- en: '![](Images/8eed260e-38a6-434d-bf7c-844501aa1384.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![](Images/8eed260e-38a6-434d-bf7c-844501aa1384.png)'
- en: In case the target port is closed, the source receives an RST/ACK packet directly.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 如果目标端口关闭，源主机将直接接收到一个RST/ACK数据包。
- en: Summary
  id: totrans-157
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter showed you the basics of firewalls and design considerations in
    firewall systems. You were introduced to different generations of firewalls and
    their functions, and you learned how to design a good firewall system. This can
    be something as simple as setting up a basic packet filtering firewall, to something
    as complex as using a stateful firewall with DMZs, ALG authenticated user connections, authenticating
    user connections, using different scanning techniques to probe host behind firewalls,
    and making use of many other features.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 本章向你展示了防火墙的基础知识和防火墙系统的设计考虑因素。你了解了不同代防火墙及其功能，并学习了如何设计一个好的防火墙系统。这可以是设置一个基本的包过滤防火墙，也可以是使用带有DMZ的有状态防火墙、ALG认证用户连接、身份验证用户连接、使用不同的扫描技术探测防火墙后面的主机，以及利用许多其他功能等复杂操作。
- en: In the next chapter, we will discuss VPNs in a public internet infrastructure,
    as well as different attributes within an IPsec framework.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将讨论公共互联网基础设施中的VPN以及IPsec框架中的不同属性。
- en: Questions
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: Which of the following are firewall types?
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以下哪些是防火墙类型？
- en: Packet filtering firewall
  id: totrans-162
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 包过滤防火墙
- en: Application-layer gateway
  id: totrans-163
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用层网关
- en: Screen Host Firewall
  id: totrans-164
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 屏蔽主机防火墙
- en: All of the mentioned
  id: totrans-165
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 所有提到的
- en: 'An application proxy firewall filters at:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用代理防火墙过滤的位置是：
- en: Physical layer 1
  id: totrans-167
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 物理层 1
- en: Data link layer 2
  id: totrans-168
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 数据链路层 2
- en: Network layer 3
  id: totrans-169
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 网络层 3
- en: Application layer 7
  id: totrans-170
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用层 7
- en: 'This 8-bit value identifies the maximum time the packet can remain in the system
    before it is dropped:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这个8位值标识了数据包在系统中可以停留的最大时间，超过这个时间后会被丢弃：
- en: Fragment
  id: totrans-172
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 分段
- en: Time to live
  id: totrans-173
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 存活时间
- en: Protocol
  id: totrans-174
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 协议
- en: Checksum
  id: totrans-175
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 校验和
- en: Further Reading
  id: totrans-176
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'For more information, visit the following links:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 欲了解更多信息，请访问以下链接：
- en: '[https://www.juniper.net/documentation/en_US/learn-about/LA_FIrewallEvolution.pdf](https://www.juniper.net/documentation/en_US/learn-about/LA_FIrewallEvolution.pdf)'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.juniper.net/documentation/en_US/learn-about/LA_FIrewallEvolution.pdf](https://www.juniper.net/documentation/en_US/learn-about/LA_FIrewallEvolution.pdf)'
- en: '[https://www.ietf.org/rfc/rfc1122.txt](https://www.ietf.org/rfc/rfc1122.txt)'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.ietf.org/rfc/rfc1122.txt](https://www.ietf.org/rfc/rfc1122.txt)'
- en: '[https://www.sans.org/reading-room/whitepapers/firewalls/intrusion-detection-response-leveraging-generation-firewall-technology-33053](https://www.sans.org/reading-room/whitepapers/firewalls/intrusion-detection-response-leveraging-generation-firewall-technology-33053)'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.sans.org/reading-room/whitepapers/firewalls/intrusion-detection-response-leveraging-generation-firewall-technology-33053](https://www.sans.org/reading-room/whitepapers/firewalls/intrusion-detection-response-leveraging-generation-firewall-technology-33053)'
