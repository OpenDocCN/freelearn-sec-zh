- en: Setting Up a Pentesting Lab on AWS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在AWS上设置渗透测试实验室
- en: This chapter aims to help penetration testers who don't have direct access to
    targets for penetration testing set up a vulnerable lab environment within AWS.
    This lab will allow testers to practice various exploitation techniques using
    Metasploit and rudimentary scanning and vulnerability assessment using multiple
    tools within Kali. This chapter focuses on setting up a vulnerable Linux VM and
    a generic Windows VM on AWS, putting them on the same network.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章旨在帮助无法直接访问渗透测试目标的渗透测试人员在AWS内部设置易受攻击的实验室环境。这个实验室将允许测试人员使用Metasploit进行各种利用技术的实践，并使用Kali内的多个工具进行基本扫描和漏洞评估。本章重点介绍在AWS上设置易受攻击的Linux
    VM和通用Windows VM，将它们放在同一个网络上。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Setting up a personal pentesting lab for hacking on the cloud
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在云上设置个人渗透测试实验室进行黑客攻击
- en: Configuring and securing the virtual lab to prevent unintended access
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置和保护虚拟实验室以防止意外访问
- en: Technical requirements
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'In this chapter, we are going to use the following tools:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用以下工具：
- en: Damn Vulnerable Web Application
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可恶的易受攻击的Web应用程序
- en: '**Very Secure File Transfer Protocol Daemon** (**vsftpd**) version 2.3.4'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**非常安全的文件传输协议守护程序**（**vsftpd**）版本**2.3.4**'
- en: Setting up a vulnerable Ubuntu instance
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置易受攻击的Ubuntu实例
- en: As the first of the two vulnerable machines that we will be creating, the vulnerable
    instance of Ubuntu will contain a single vulnerable FTP service, as well as some
    other services.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 作为我们将要创建的两台易受攻击的机器中的第一台，易受攻击的Ubuntu实例将包含一个易受攻击的FTP服务，以及一些其他服务。
- en: Provisioning an Ubuntu EC2 instance
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提供一个Ubuntu EC2实例
- en: The very first step in setting up our vulnerable lab in the cloud will be to
    provision an instance that will be running a vulnerable operating system. For
    this purpose, we can use an Ubuntu LTS version. This can be accessed from the
    AWS Marketplace for quick deployment.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在云中设置易受攻击的实验室的第一步将是提供一个运行易受攻击操作系统的实例。为此，我们可以使用Ubuntu LTS版本。这可以从AWS Marketplace快速部署。
- en: 'We will use Ubuntu 16.04 for this purpose:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用Ubuntu 16.04来实现这一目的：
- en: '![](img/9fc1fba3-0bfd-4d8f-b9ca-cf0a3c67344a.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9fc1fba3-0bfd-4d8f-b9ca-cf0a3c67344a.png)'
- en: Once we click on the Continue to Subscribe button, we are prompted to configure
    the instance that we are going to launch. Since this is a pretty standard image,
    we will proceed with the default settings except for Region and VPC settings.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦单击“继续订阅”按钮，我们将提示配置要启动的实例。由于这是一个非常标准的镜像，我们将使用默认设置，除了区域和VPC设置。
- en: For Region, you can use the AWS Region that is closest to yourself. However,
    keep in mind that all the other instances you create on AWS need to be hosted
    in the same region or they cannot be a part of the same network.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 对于区域，您可以使用距离自己最近的AWS区域。但是，请记住，您在AWS上创建的所有其他实例都需要托管在同一个区域，否则它们无法成为同一网络的一部分。
- en: 'For VPC, make sure you note down the VPC and the subnet IDs that you are using
    to set up this instance. We will need to reuse them for all the other hosts in
    the lab. In this case, I will be using the following:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 对于VPC，请确保您记下了用于设置此实例的VPC和子网ID。我们需要为实验室中的所有其他主机重复使用它们。在这种情况下，我将使用以下内容：
- en: '![](img/8af80f17-d919-4eda-88bb-47208f2797e0.png)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8af80f17-d919-4eda-88bb-47208f2797e0.png)'
- en: It should be noted that the VPC IDs and the subnet IDs will be unique for everyone.
    Once done, we can proceed to deploy the EC2 instance by clicking on the Launch
    with the 1-Click button.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 应该注意的是，VPC ID和子网ID对每个人都是唯一的。完成后，我们可以通过单击“一键启动”按钮来部署EC2实例。
- en: 'Once done, the next step is to SSH into the newly created VM using the following
    command:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，下一步是使用以下命令SSH到新创建的VM：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Once connected, run the following command:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 连接后，运行以下命令：
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: These commands will update the repository listing and all the packages installed
    on the instance, so we don't have to deal with any old packages.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 这些命令将更新存储库列表和实例上安装的所有软件包，因此我们不必处理任何旧软件包。
- en: Installing a vulnerable service on Ubuntu
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Ubuntu上安装易受攻击的服务
- en: For this Ubuntu host, we will be installing a vulnerable version of an FTP server,
    `vsftpd`. Version 2.3.4 of this FTP software was found to be backdoored. In this
    chapter, we will be installing this backdoored version and then will attempt to
    identify it using a pentesting box we will set up in the next chapter, and finally
    we will exploit it.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个Ubuntu主机，我们将安装一个易受攻击版本的FTP服务器`vsftpd`。发现2.3.4版本的这个FTP软件被植入了后门。在本章中，我们将安装这个带有后门的版本，然后将尝试使用我们将在下一章中设置的渗透测试盒来识别它，最后我们将利用它。
- en: 'To make things easier, the backdoored version of `vsftpd 2.3.4` is archived
    on GitHub. We shall be using that code base to install the vulnerable software.
    To start with, we need to clone the `git` repository:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使事情变得更容易，`vsftpd 2.3.4`的后门版本被存档在GitHub上。我们将使用该代码库来安装易受攻击的软件。首先，我们需要克隆`git`存储库：
- en: '[PRE2]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Next, we need to install packages for setting up a primary build environment.
    To do this, we run the following:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要安装用于设置主要构建环境的软件包。为此，我们运行以下命令：
- en: '[PRE3]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, we `cd` into the `vsftpd` folder to build it from source. However, before
    doing that, we need to make a small change to the `Makefile`. The `-lcrypt` value
    needs to be added as a linker flag:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们`cd`进入`vsftpd`文件夹以从源代码构建它。但是，在这之前，我们需要对`Makefile`进行一些小改动。需要添加`-lcrypt`值作为链接器标志：
- en: '![](img/d9b46007-7258-4dc3-91a4-16178cba3cdc.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d9b46007-7258-4dc3-91a4-16178cba3cdc.png)'
- en: Once done, save the file and just run `make`.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，保存文件并运行`make`。
- en: 'If all goes well, we should see a `vsftpd` binary in the same folder:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切顺利，我们应该在同一个文件夹中看到一个`vsftpd`二进制文件：
- en: '![](img/e1551d0e-a19f-4364-b5a5-7f538385bb6a.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e1551d0e-a19f-4364-b5a5-7f538385bb6a.png)'
- en: 'Next, we need to set up some prerequisites before installing `vsftpd`. Namely,
    we need to add a user called `nobody` and a folder called `empty`. To do that,
    run the following commands:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要在安装`vsftpd`之前设置一些先决条件。即，我们需要添加一个名为`nobody`的用户和一个名为`empty`的文件夹。要做到这一点，请运行以下命令：
- en: '[PRE4]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Once done, we can run the installation by executing the following commands:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，我们可以通过执行以下命令来运行安装：
- en: '[PRE5]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'With that done, we need to execute the `vsftpd` binary to confirm whether we
    can connect to the `localhost`:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，我们需要执行`vsftpd`二进制文件，以确认我们是否可以连接到`localhost`：
- en: '![](img/274a3cfc-db75-4b33-bd04-dcbee35055e6.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![](img/274a3cfc-db75-4b33-bd04-dcbee35055e6.png)'
- en: 'The next step is to set up anonymous access to the FTP server. To do this,
    we need to run the following commands:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是设置FTP服务器的匿名访问。为此，我们需要运行以下命令：
- en: '[PRE6]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Finally, enable local login to the `vsftpd` server by making the following
    change to `/etc/vsftpd.conf`:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，通过对`/etc/vsftpd.conf`进行以下更改，启用对`vsftpd`服务器的本地登录：
- en: '![](img/6d445a60-e1fc-4b35-9e1e-3bfacf67df75.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6d445a60-e1fc-4b35-9e1e-3bfacf67df75.png)'
- en: Setting up a vulnerable Windows instance
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置易受攻击的Windows实例
- en: With a vulnerable Linux Server set up, we now set up an attack vector through
    a Windows server that's running a vulnerable web application. This application
    shall provide two environments that readers without an actual test environment
    can try their hand at.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 通过设置易受攻击的Linux服务器，我们现在通过运行易受攻击的Web应用程序的Windows服务器来设置一个攻击向量。该应用程序将提供两个环境，读者可以在其中尝试他们的手，而无需实际的测试环境。
- en: Provisioning a vulnerable Windows server instance
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置易受攻击的Windows服务器实例
- en: 'For the purpose of this lab host, we will be using a Server 2003 instance from
    the AWS Marketplace:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 为了本实验宿主的目的，我们将使用AWS Marketplace上的Server 2003实例：
- en: '![](img/1470f873-c326-4b00-be42-5ffb48a7a4d5.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1470f873-c326-4b00-be42-5ffb48a7a4d5.png)'
- en: The provisioning steps are pretty much identical to what we used to set up the
    Linux instance earlier. Care should be taken that the VPC settings are similar
    to what we used for the previous instance. This will later allow us to configure
    the VMs to be on the same network.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 配置步骤与我们之前设置Linux实例的步骤基本相同。应注意VPC设置与我们为以前的实例使用的设置相似。这将稍后允许我们配置VM以处于相同的网络上。
- en: 'After verifying the VPC settings and the region, we proceed to launch the instance—precisely
    as we did earlier. Finally, we set the key-pair that we have been using all along
    and we are good to go. Once the instance has been launched, we need to follow
    a slightly different process to access a Windows instance remotely. Since **Remote
    Desktop Protocol** (**RDP**) doesn''t support certificate-based authentication,
    we need to provide the private key to decrypt and get the password using which
    we can log in. This is done by simply right-clicking on the instance and selecting
    Get Windows Password:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在验证VPC设置和区域后，我们继续启动实例，就像我们之前做的那样。最后，我们设置一直在使用的密钥对，然后就可以开始了。实例启动后，我们需要遵循稍有不同的流程来远程访问Windows实例。由于**远程桌面协议**（**RDP**）不支持基于证书的身份验证，我们需要提供私钥来解密并获取密码，以便我们可以登录。只需右键单击实例，然后选择获取Windows密码：
- en: '![](img/f7064e60-0172-49da-a088-44fba472bd8f.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f7064e60-0172-49da-a088-44fba472bd8f.png)'
- en: 'On the following screen, we are required to upload the private key that was
    downloaded earlier:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的屏幕上，我们需要上传之前下载的私钥：
- en: '![](img/7c197943-5ce7-43cc-9968-133dd87b66ca.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7c197943-5ce7-43cc-9968-133dd87b66ca.png)'
- en: Once done, simply clicking on Decrypt Password will provide us with the password
    that we can use to RDP into our Windows server instance. Once done, it's a simple
    matter of firing up Remote Desktop and connecting to the IP address using the
    displayed credentials.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，只需单击“解密密码”即可为我们提供密码，我们可以使用该密码远程桌面连接到我们的Windows服务器实例。完成后，只需启动远程桌面并使用显示的凭据连接到IP地址即可。
- en: 'Once we are logged in, the next step is to set up XAMPP on the Windows server
    so we can host a vulnerable website on the server. But before we proceed, we need
    to install the latest version of Firefox on the server, since the Internet Explorer
    version that comes packaged with Windows Server 2003 is pretty old and doesn''t
    support some website configurations. To download XAMPP, just access [https://www.apachefriends.org/download.html](https://www.apachefriends.org/download.html)
    and download the version that''s built for XP and Windows Server 2003:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们登录，下一步是在Windows服务器上设置XAMPP，这样我们就可以在服务器上托管一个易受攻击的网站。但在继续之前，我们需要在服务器上安装最新版本的Firefox，因为随Windows
    Server 2003捆绑的Internet Explorer版本相当陈旧，不支持一些网站配置。要下载XAMPP，只需访问[https://www.apachefriends.org/download.html](https://www.apachefriends.org/download.html)并下载适用于XP和Windows
    Server 2003的版本：
- en: '![](img/20733b18-76c1-46df-92ba-fcdf3274caf5.png)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![](img/20733b18-76c1-46df-92ba-fcdf3274caf5.png)'
- en: 'Note that you will need to scroll down and download the correct version of
    XAMPP:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，您需要向下滚动并下载正确版本的XAMPP：
- en: '![](img/3c4e5bef-6397-4283-824d-8d4363d17b6b.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3c4e5bef-6397-4283-824d-8d4363d17b6b.png)'
- en: Finally, we need to follow the default installation process, and we will be
    set up with a working installation of PHP, Apache, and MySQL, along with a few
    necessary utilities that we need to manage a website.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要按照默认安装过程进行，然后我们将获得一个可用的PHP、Apache和MySQL安装，以及一些必要的实用程序，用于管理网站。
- en: Configuring a vulnerable web application on Windows
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Windows上配置易受攻击的Web应用程序
- en: In this section, we will be setting up an extremely vulnerable web application
    for the pentesting lab. To begin with, let's clear up the XAMPP hosting folder
    by accessing `C:\xampp\htdocs`.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将为渗透测试实验室设置一个极易受攻击的Web应用程序。首先，让我们通过访问`C:\xampp\htdocs`来清理XAMPP托管文件夹。
- en: Create a new folder called `_bak` and cut and paste all the existing files into
    that folder. Now, let's download the vulnerable website's source code. For this,
    we will use one of the many vulnerable PHP samples that are available on GitHub: [https://github.com/ShinDarth/sql-injection-demo/](https://github.com/ShinDarth/sql-injection-demo/).
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个名为`_bak`的新文件夹，并将所有现有文件剪切并粘贴到该文件夹中。现在，让我们下载易受攻击的网站源代码。为此，我们将使用GitHub上提供的众多易受攻击的PHP示例之一：[https://github.com/ShinDarth/sql-injection-demo/](https://github.com/ShinDarth/sql-injection-demo/)。
- en: 'The fastest way to get the files is to directly download the ZIP file:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 最快获取文件的方法是直接下载ZIP文件：
- en: '![](img/cce34f3c-df63-4dd5-a15b-79b9479b626f.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cce34f3c-df63-4dd5-a15b-79b9479b626f.png)'
- en: Downloading the source code
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 下载源代码
- en: 'Once downloaded, it''s simply a matter of copying the contents of the ZIP file
    into the `C:\xampp\htdocs` folder. If done correctly, this is what the file structure
    should look like:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 下载后，只需将ZIP文件的内容复制到`C:\xampp\htdocs`文件夹中。如果操作正确，文件结构应如下所示：
- en: '![](img/6a2f430b-c1ea-4781-9409-508b8dcc8cc4.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6a2f430b-c1ea-4781-9409-508b8dcc8cc4.png)'
- en: The file structure
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 文件结构
- en: 'Once completed, the next step is to create a database for the application and
    import the data into it. To achieve this, you need to access the phpMyAdmin interface,
    which is accessible at `http://127.0.0.1/phpmyadmin`. Once here, select the New option
    under Recent:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，下一步是为应用程序创建数据库并将数据导入其中。为了实现这一点，您需要访问phpMyAdmin界面，该界面可在`http://127.0.0.1/phpmyadmin`访问。在这里，选择最近的“新建”选项：
- en: '![](img/04d6b2bd-31fb-4f05-9aea-618a3deb561c.png)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![](img/04d6b2bd-31fb-4f05-9aea-618a3deb561c.png)'
- en: 'Here we create a new database called `sqli`:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们创建一个名为`sqli`的新数据库：
- en: '![](img/c751633d-f942-4efe-a228-639e79c9621d.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c751633d-f942-4efe-a228-639e79c9621d.png)'
- en: 'Next, to import data into the newly created database, we go into the Import
    tab and browse to the `database.sql` file that we just extracted into the `htdocs`
    folder:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，要将数据导入到新创建的数据库中，我们进入导入选项卡，并浏览到刚刚提取到`htdocs`文件夹中的`database.sql`文件：
- en: '![](img/47b3d1b6-a89c-411f-aca1-f680a9f70d7d.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/47b3d1b6-a89c-411f-aca1-f680a9f70d7d.png)'
- en: 'Once we click on Go we will see a success message. Now, if we browse to `http://127.0.0.1` in
    our browser, we will be able to access the vulnerable website:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 点击Go后，我们将看到一个成功的消息。现在，如果我们在浏览器中浏览`http://127.0.0.1`，我们将能够访问易受攻击的网站：
- en: '![](img/7b766f5a-38ed-4ee6-934f-6ed16af1c008.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7b766f5a-38ed-4ee6-934f-6ed16af1c008.png)'
- en: Congratulations, you have successfully configured a vulnerable web application
    on the Windows server! The next step will be to set up the networking rules within
    our VPC so that the vulnerable hosts are accessible from the other EC2 instances.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜，您已成功在Windows服务器上配置了一个易受攻击的Web应用程序！下一步将是在我们的VPC内设置网络规则，以便易受攻击的主机可以从其他EC2实例访问。
- en: Configuring security groups within the lab
  id: totrans-80
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在实验室内配置安全组
- en: Now that we have set up two vulnerable servers, the next step is to configure
    network so that our web application isn't accessible to outsiders and, at the
    same time, so that the other lab machines can communicate with each other.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经设置了两个易受攻击的服务器，下一步是配置网络，使我们的Web应用程序对外部不可访问，同时使其他实验室机器可以相互通信。
- en: Configuring security groups
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置安全组
- en: We had originally set all of the EC2 instances to be on the same VPC. This implied
    that the EC2 instances would be on the same subnet and would be able communicate
    with each other through internal IP addresses. However, AWS doesn't want to allow
    all 4,096 addresses on the same VPC to be communicating with each other. As a
    result, the default security groups don't allow communication between EC2 instances.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们最初将所有EC2实例设置为在同一个VPC上。这意味着EC2实例将位于同一子网上，并且可以通过内部IP地址相互通信。但是，AWS不希望允许同一VPC上的所有4,096个地址相互通信。因此，默认安全组不允许EC2实例之间的通信。
- en: 'To allow connectivity from the Ubuntu instance to the Windows instance (you
    can repeat these steps for the Kali instance that will be set up in the next chapter),
    the first step is to get the Private IP address of the Ubuntu host:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 为了允许Ubuntu实例连接到Windows实例（您可以在下一章中为Kali实例重复这些步骤），第一步是获取Ubuntu主机的私有IP地址：
- en: '![](img/36e57154-2299-4e2e-8adc-d85ed0430062.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![](img/36e57154-2299-4e2e-8adc-d85ed0430062.png)'
- en: Description tab showing the Private IPs
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 显示私有IP的描述选项卡
- en: 'Next, we need to modify the security group rules for the first Windows instance.
    This is as simple as clicking on the security Group Name in the summary pane to
    get to the Security Group screen:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要修改第一个Windows实例的安全组规则。只需在摘要窗格中点击安全组名称即可进入安全组屏幕：
- en: '![](img/6cfc515d-07d6-450c-89c2-a57b0260a197.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6cfc515d-07d6-450c-89c2-a57b0260a197.png)'
- en: Security Group screen
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 安全组屏幕
- en: 'Now we simply need to click on the Edit button and add the rule allowing all
    traffic from the Kali Linux instance:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们只需要点击编辑按钮，添加规则允许从Kali Linux实例中访问所有流量：
- en: '![](img/a5dbb1c7-34b4-4f58-8c68-79ad2f1c46c8.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a5dbb1c7-34b4-4f58-8c68-79ad2f1c46c8.png)'
- en: 'Once done, just save this configuration. To confirm that Kali can now communicate
    with the Windows server, let''s run a `curl` command to see if the site is accessible:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，只需保存此配置。为了确认Kali现在可以与Windows服务器通信，让我们运行一个`curl`命令，看看网站是否可访问：
- en: '[PRE7]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Make sure to replace the IP address with your IP address for Windows. If all
    is well, there should be a bunch of JavaScript in response:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 确保用您的Windows IP地址替换IP地址。如果一切顺利，应该会有一堆JavaScript作为响应：
- en: '![](img/ef9ce96e-d12c-490a-9fbc-215004ce5fc1.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ef9ce96e-d12c-490a-9fbc-215004ce5fc1.png)'
- en: In the next chapter, once the Kali PentestBox has been set up, the preceding
    steps can be used to whitelist the Kali Linux IP address on both the Ubuntu and
    the Windows server instances so we can get started with hacking the lab environment!
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，一旦Kali PentestBox设置完成，可以使用上述步骤在Ubuntu和Windows服务器实例上将Kali Linux IP地址列入白名单，以便开始对实验室环境进行黑客攻击！
- en: Summary
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we have set up a lab that can prove useful to beginner penetration
    testers who do not have access to a test environment or hands-on exposure to a
    lab. In our lab, we have set up one Ubuntu host with a vulnerable service running
    on it, and we also set up a Windows server host that is running a vulnerable web
    application. This represents the two biggest surface areas for an attack in any
    environment. Additionally, we also went through the process of establishing a
    network connection between the various instances that we have set up so far. With
    these steps taken care of, the user can set up any operating system instances
    in the cloud, set up security groups to configure networking, and protect against
    unauthorized access as well.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们已经建立了一个实验室，对于没有测试环境或实际实验经验的初学者渗透测试人员来说，这可能是有用的。在我们的实验室中，我们设置了一个运行易受攻击服务的Ubuntu主机，还设置了一个运行易受攻击Web应用程序的Windows服务器主机。这代表了任何环境中攻击的两个最大的表面区域。此外，我们还经历了建立各个实例之间的网络连接的过程。通过这些步骤，用户可以在云中设置任何操作系统实例，设置安全组以配置网络，并防止未经授权的访问。
- en: In the next chapter, we will be looking at setting up a Kali PentestBox, using
    which we can perform scanning, enumeration, and exploitation of the two vulnerable
    EC2 instances that we have set up.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将研究如何设置Kali PentestBox，使用它可以对我们设置的两个易受攻击的EC2实例进行扫描、枚举和利用。
- en: Further reading
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'Vulnerability and Exploit Database: [https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor](https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor)'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞和利用数据库：[https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor](https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor)
- en: Amazon Virtual Private Cloud (User Guide): [https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html](https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html)
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Amazon虚拟私有云（用户指南）：[https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html](https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html)
