- en: Breaking the Authentication for a Large Online Retailer
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 突破大型在线零售商的身份验证
- en: In the previous chapters, we reviewed how to detect many types of vulnerabilities,
    and how to exploit them. We also reviewed how to use a large variety of extensions,
    and also how to develop our extensions. In this chapter, we will recapitulate
    all the concepts from the previous chapters to assess an application in production
    and try to break its authentication.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在之前的章节中，我们回顾了如何检测许多类型的漏洞，以及如何利用它们。我们还回顾了如何使用各种扩展，以及如何开发我们自己的扩展。在本章中，我们将总结前几章的所有概念，以评估正在生产中的应用程序，并尝试突破其身份验证。
- en: 'We will cover the following topics in the chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章中涵盖以下主题：
- en: Remembering about authentication
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 关于身份验证的事项
- en: Large online retailers
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 大型在线零售商
- en: Performing information gathering
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行信息收集
- en: Remembering about authentication
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 关于身份验证的事项
- en: 'As you remember from [Chapter 7](907db073-60ef-4d85-a4cb-03f9fcc76855.xhtml), *Detecting
    Vulnerabilities Using Burp Suite*, the issues that affect authentication controls
    are the following:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你在[第7章](907db073-60ef-4d85-a4cb-03f9fcc76855.xhtml)中所记得的，*使用Burp Suite检测漏洞*，影响身份验证控制的问题如下：
- en: Weak storage for credentials
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 凭证的弱存储
- en: Predictable login credentials
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可预测的登录凭证
- en: Session IDs exposed in the URL
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 会话ID暴露在URL中
- en: Session IDs susceptible to session fixations attacks
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 会话ID容易受到会话固定攻击的影响
- en: Wrong time out implementation
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 错误的超时实现
- en: The session is not destructed after the logout
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 会话在注销后没有被销毁
- en: Sensitive information sent via unprotected channels
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过不安全的通道发送敏感信息
- en: Now, using Burp Suite, we are going to analyze all of these.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，使用Burp Suite，我们将分析所有这些。
- en: Large online retailers
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 大型在线零售商
- en: 'The list of online retailers is huge, but the following is a list of the more
    popular ones:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在线零售商的列表很长，但以下是一些较受欢迎的：
- en: eBay (all regional variants)
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: eBay（所有地区变体）
- en: Mercado Libre
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Mercado Libre
- en: Amazon
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 亚马逊
- en: We will analyze one of them as an example. Bear in mind that all the information
    used in this chapters is public; we are not going to disclose any public or private
    vulnerabilities on these applications and the explanations do not affect the functionality
    of the applications.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将以其中一个作为例子进行分析。请记住，本章中使用的所有信息都是公开的；我们不会公开这些应用程序的任何公开或私人漏洞，解释也不会影响应用程序的功能。
- en: Performing information gathering
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 执行信息收集
- en: We are going to start collecting information about the targets. The most basic
    way to detect information about the technology used in a specific application
    and to determine potential security issues is to first navigate all through the
    application, use the normal flows, detect and take note of each entry point in
    the application, and add the different URLs that are interesting to us to the
    **Scope** option in the **Target** tool.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将开始收集有关目标的信息。检测特定应用程序中使用的技术以及确定潜在的安全问题的最基本方法是首先浏览整个应用程序，使用正常流程，检测并记录应用程序的每个入口点，并将我们感兴趣的不同URL添加到**目标**工具中的**范围**选项中。
- en: Port scanning
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 端口扫描
- en: In a real assessment, an agreement between the person or company that is reviewing
    the application and the application's owners is established. This is one of the
    first steps involved in detecting the services.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在真实的评估中，评估应用的人或公司与应用的所有者之间建立了一项协议。这是检测服务所涉及的第一步。
- en: 'This task is usually carried out using Nmap ([https://nmap.org/](https://nmap.org/)),
    which is a command-line tool that is used to detect ports and services running
    on a remote host. Using Nmap is not complicated; you can just type `nmap` on a
    command line to see all the different options we have, as shown in the following
    screenshot:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 通常使用Nmap（[https://nmap.org/](https://nmap.org/)）来执行此任务，这是一个用于检测远程主机上运行的端口和服务的命令行工具。使用Nmap并不复杂；你只需在命令行上输入`nmap`，就可以看到我们有哪些不同的选项，如下面的屏幕截图所示：
- en: '![](img/a52f2146-d715-4574-bebf-643722baa56a.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/a52f2146-d715-4574-bebf-643722baa56a.png)'
- en: 'To perform a standard scan to a host, we can use the following command:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 要对主机执行标准扫描，我们可以使用以下命令：
- en: '[PRE0]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Authentication method analysis
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 身份验证方法分析
- en: You should analyze an application issue by issue to determine whether it is
    vulnerable or not, as explained in the following sections.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该逐个分析应用程序的问题，以确定它是否容易受到攻击，就像下面的章节中所解释的那样。
- en: Weak storage for credentials
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 凭证的弱存储
- en: 'The application is storing the session ID in a ciphered way, so it is not vulnerable
    to being extracted. Also, the session ID is combined with more than one token,
    and cookies are protected from extraction as shown in the following screenshot:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序以加密的方式存储会话ID，因此不容易被提取。此外，会话ID与一个以上的令牌结合，cookie也受到保护，如下面的屏幕截图所示：
- en: '![](img/9fd5d310-2548-47ff-8295-2f3fef7b6293.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/9fd5d310-2548-47ff-8295-2f3fef7b6293.png)'
- en: Discovering Blind SQL injection
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发现盲目SQL注入
- en: The URL that we will be analyzing is [www.dhl.com](http://www.dhl.com). This
    is the international page, but if you visualize the regional websites, they are
    similar, so it is possible that a vulnerability in one of them replicates others.
    This happens to a lot of companies that have operations in various countries.
    Actually, sometimes the company has a different representation in a different
    country, but the web application is the same.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将要分析的URL是[www.dhl.com](http://www.dhl.com)。这是国际页面，但如果你查看地区网站，它们是相似的，所以可能一个网站的漏洞会复制到其他网站。这经常发生在许多在不同国家有业务的公司。有时候公司在不同国家有不同的代表，但是网站应用是一样的。
- en: 'To determine whether [dhl.com](http://dhl.com) has an SQL injection, we will
    do three different analyses:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确定[dhl.com](http://dhl.com)是否存在SQL注入，我们将进行三种不同的分析：
- en: Automatic scan
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动扫描
- en: SQLMap detection
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SQLMap检测
- en: Intruder detection
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 入侵检测
- en: Predictable login credentials
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 可预测的登录凭证
- en: The user enters the application using a username or an email, so the credentials
    are not predictable.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 用户使用用户名或电子邮件登录应用程序，因此凭证是不可预测的。
- en: Session IDs exposed in the URL
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 会话ID暴露在URL中
- en: 'Reviewing the History tool, we can see that there are some tokens and sessions
    exposed in the URL as follows:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查看历史工具，我们可以看到URL中暴露了一些令牌和会话，如下所示：
- en: '![](img/50d480e0-6c02-47b1-8575-27a66ed8213a.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![](img/50d480e0-6c02-47b1-8575-27a66ed8213a.png)'
- en: 'However, the application does not use just one token, so, having only one of
    them is not useful. Actually, one of the tokens sent in the URL is a request tracker,
    as shown in the following screenshots:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，该应用程序并不仅仅使用一个令牌，因此仅有一个令牌是没有用的。实际上，在URL中发送的令牌之一是一个请求跟踪器，如下截图所示：
- en: '![](img/97a734de-9032-42d4-a691-12d57cb44fad.png)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![](img/97a734de-9032-42d4-a691-12d57cb44fad.png)'
- en: '![](img/f348b9a0-bfaf-43ad-ad49-934269eff7b0.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f348b9a0-bfaf-43ad-ad49-934269eff7b0.png)'
- en: '![](img/38d2a7f7-cf3d-4bda-9163-10d3ead5edde.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](img/38d2a7f7-cf3d-4bda-9163-10d3ead5edde.png)'
- en: '![](img/1d89c217-a584-410b-b1d2-6092cc19732f.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1d89c217-a584-410b-b1d2-6092cc19732f.png)'
- en: The conclusion is that, despite there being tokens exposed in the URL, they
    are not exploitable.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 结论是，尽管URL中暴露了令牌，但它们是不可利用的。
- en: Session IDs susceptible to session fixations attacks
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 会话ID容易受到会话固定攻击的影响
- en: Open a user's session in a browser in the normal way.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 以正常方式在浏览器中打开用户会话。
- en: Then, open an other session for a completely different user.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，为完全不同的用户打开另一个会话。
- en: 'Now, intercept a request using the **Proxy** tool, and modify the user''s information
    to try to access the second user''s information, as follows:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，使用**代理**工具拦截一个请求，并修改用户信息以尝试访问第二个用户的信息，如下所示：
- en: '![](img/1cd10312-3a41-4268-b0a6-69058ee9a794.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1cd10312-3a41-4268-b0a6-69058ee9a794.png)'
- en: When you open the [https://www.mercadolibre.com.mx/](https://www.mercadolibre.com.mx/)
    web page, you notice that the application shows the first information's user.
    So, it is not vulnerable to session fixation.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 当您打开[https://www.mercadolibre.com.mx/](https://www.mercadolibre.com.mx/)网页时，您会注意到应用程序显示了用户的第一条信息。因此，它不容易受到会话固定攻击。
- en: The session is not destructed after the logout
  id: totrans-58
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 注销后会话并没有被销毁。
- en: 'Close the session using the logout option, then go to **History**, and look
    for a request made while the user was logged in. Right-click on **Send to repeater**,
    and, without modifying any value, click on **Go** to resend the request, as follows:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 使用注销选项关闭会话，然后转到**历史记录**，查找用户登录时进行的请求。右键单击**发送到重复器**，然后在不修改任何值的情况下，单击**Go**重新发送请求，如下所示：
- en: '![](img/84d70dbf-a882-4b31-8a4b-76bbbc0ac643.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![](img/84d70dbf-a882-4b31-8a4b-76bbbc0ac643.png)'
- en: The result is the application being shown without the user being logged in.
    So, the application is not vulnerable.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是应用程序显示出未登录用户的状态。因此，该应用程序不容易受到攻击。
- en: Since we have used a Mexican website for authentication, some of the text in
    the screenshot is in Spanish.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们使用了一个墨西哥的网站进行身份验证，所以截图中的一些文本是西班牙语。
- en: Sensitive information sent via unprotected channels
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过不受保护的通道发送的敏感信息
- en: 'Just using passive scanning, which means without aggressive actions, Burp Suite
    detected that the users can force the application to be used in an unprotected
    channel. This means that instead of using the HTTPS protocol, a user can force
    the use of the HTTP protocol and send information in clear text. It could be exploited
    by a malicious user, combined with other flaws to steal a user''s information,
    as shown in the following example:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 仅使用被动扫描，也就是没有侵略性的操作，Burp Suite就检测到用户可以强制应用程序在不受保护的通道中使用。这意味着用户可以强制使用HTTP协议而不是HTTPS协议，并以明文发送信息。这可能会被恶意用户利用，结合其他漏洞来窃取用户信息，如下例所示：
- en: '![](img/d6ba5748-8939-42a3-b7ac-dee9ff803d3e.png)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d6ba5748-8939-42a3-b7ac-dee9ff803d3e.png)'
- en: This flaw is confirmed.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 这个漏洞得到了确认。
- en: Summary
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we showed the analysis of a real application. The tasks performed
    included protocol and service detection, request and post analysis, and vulnerability
    detection.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们展示了对一个真实应用程序的分析。执行的任务包括协议和服务检测、请求和提交分析以及漏洞检测。
- en: 'In the next chapter, we will perform the same activities that we discussed
    in this chapter using one of the most popular shipping companies: DHL.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将使用最流行的快递公司之一：DHL，执行与本章讨论的相同活动。
